<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><link rel=manifest href=/manifest.json><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>动力云客项目 | Shelter</title><meta name="author" content="Shelter"><meta name="copyright" content="Shelter"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="动力云客项目1.  项目准备项目数据库导入sql文件 前端项目安装nodejs工具，npm是nodejs自带的 下载：https:&#x2F;&#x2F;nodejs.org&#x2F;en&#x2F;download 安装：解压即完成安装；node-v20.10.0-win-x64.zip版本； Nodejs环境变量配置在 D:\course\tool\node-v20.10.0-win-x64 下创建2个文件夹：  node_glo">
<meta property="og:type" content="article">
<meta property="og:title" content="动力云客项目">
<meta property="og:url" content="http://localhost:4000/posts/336277b5.html">
<meta property="og:site_name" content="Shelter">
<meta property="og:description" content="动力云客项目1.  项目准备项目数据库导入sql文件 前端项目安装nodejs工具，npm是nodejs自带的 下载：https:&#x2F;&#x2F;nodejs.org&#x2F;en&#x2F;download 安装：解压即完成安装；node-v20.10.0-win-x64.zip版本； Nodejs环境变量配置在 D:\course\tool\node-v20.10.0-win-x64 下创建2个文件夹：  node_glo">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.dreamshelter.cn/blog/source/img/cover/20.jpg">
<meta property="article:published_time" content="2025-06-12T02:50:00.000Z">
<meta property="article:modified_time" content="2026-02-11T17:34:41.112Z">
<meta property="article:author" content="Shelter">
<meta property="article:tag" content="java">
<meta property="article:tag" content="springboot">
<meta property="article:tag" content="项目">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.dreamshelter.cn/blog/source/img/cover/20.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "动力云客项目",
  "url": "http://localhost:4000/posts/336277b5.html",
  "image": "https://cdn.dreamshelter.cn/blog/source/img/cover/20.jpg",
  "datePublished": "2025-06-12T02:50:00.000Z",
  "dateModified": "2026-02-11T17:34:41.112Z",
  "author": [
    {
      "@type": "Person",
      "name": "Shelter",
      "url": "https://github.com/Shelter67"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.dreamshelter.cn/blog/source/img/favicon.png"><link rel="canonical" href="http://localhost:4000/posts/336277b5.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="#49b1f5"/><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/128.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"/><link rel="mask-icon" href="/img/siteicon/128.png" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":3,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '动力云客项目',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><style>#waifu { left: auto !important; right: 20px !important; }</style><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-veeink@1.0.7/lib/clock-min.css" /><link rel="stylesheet" href="https://www.fomal.cc/static/css/runtime.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 8.1.1"></head><body><div class="bg-animation" id="web_bg" style="background-image: url(https://cdn.dreamshelter.cn/blog/source/img/background.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/touxiang.jpg" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/zhuifan.html"><i class="fa-fw fas fa-tv"></i><span> 追番</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/zhuiju.html"><i class="fa-fw fas fa-video"></i><span> 追剧</span></a></div><div class="menus_item"><a class="site-page" href="/gongxianban"><i class="fa-fw fab fa-github-alt"></i><span> 贡献板</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.dreamshelter.cn/blog/source/img/cover/20.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Shelter</span></a><a class="nav-page-title" href="/"><span class="site-name">动力云客项目</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/zhuifan.html"><i class="fa-fw fas fa-tv"></i><span> 追番</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/zhuiju.html"><i class="fa-fw fas fa-video"></i><span> 追剧</span></a></div><div class="menus_item"><a class="site-page" href="/gongxianban"><i class="fa-fw fab fa-github-alt"></i><span> 贡献板</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">动力云客项目</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-06-12T02:50:00.000Z" title="发表于 2025-06-12 10:50:00">2025-06-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-11T17:34:41.112Z" title="更新于 2026-02-12 01:34:41">2026-02-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">76.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>335分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2026-02-12 01:34:41&quot;}" hidden></div><h1 id="动力云客项目"><a href="#动力云客项目" class="headerlink" title="动力云客项目"></a>动力云客项目</h1><h1 id="1-项目准备"><a href="#1-项目准备" class="headerlink" title="1.  项目准备"></a>1.  项目准备</h1><h2 id="项目数据库"><a href="#项目数据库" class="headerlink" title="项目数据库"></a>项目数据库</h2><p>导入sql文件</p>
<h2 id="前端项目"><a href="#前端项目" class="headerlink" title="前端项目"></a>前端项目</h2><p>安装nodejs工具，npm是nodejs自带的</p>
<p>下载：<a target="_blank" rel="noopener" href="https://nodejs.org/en/download">https://nodejs.org/en/download</a></p>
<p>安装：解压即完成安装；node-v20.10.0-win-x64.zip版本；</p>
<h3 id="Nodejs环境变量配置"><a href="#Nodejs环境变量配置" class="headerlink" title="Nodejs环境变量配置"></a>Nodejs环境变量配置</h3><p>在 D:\course\tool\node-v20.10.0-win-x64 下创建2个文件夹：</p>
<ol>
<li>node_global （依赖库）</li>
<li>node_cache （缓存）</li>
</ol>
<p>然后在当前目录下cmd进入dos窗口，执行：</p>
<ul>
<li>npm config set prefix “D:\course\tool\node-v20.10.0-win-x64\node_global” </li>
<li>npm config set cache “D:\course\tool\node-v20.10.0-win-x64\node_cache”</li>
</ul>
<p>然后你可以查一下，看看有没有设置成功：</p>
<ul>
<li>npm config get prefix</li>
<li>npm config get cache</li>
</ul>
<p>在windows环境变量配置Path，在path变量中添加如下路径：</p>
<ul>
<li>D:\course\tool\node-v20.10.0-win-x64 </li>
<li>D:\course\tool\node-v20.10.0-win-x64\node_global</li>
</ul>
<p>在任意目录打开dos窗口测试下：</p>
<ul>
<li>node -v</li>
<li>npm -v</li>
</ul>
<h3 id="配置npm仓库"><a href="#配置npm仓库" class="headerlink" title="配置npm仓库"></a>配置npm仓库</h3><p>新版的Node.js已经自带npm，安装Node.js时就已经安装npm，所以不需要再安装npm，只需要配置一下npm仓库源即可；</p>
<p>查看目前的npm仓库源（位置）：</p>
<p>npm config get registry</p>
<p>在使用npm命令时，如果直接从国外的仓库<a target="_blank" rel="noopener" href="https://www.npmjs.com/">https://www.npmjs.com/</a> 下载依赖，下载速度很慢，甚至会下载失败，我们可以更换npm的仓库源，提高下载速度，淘宝给我们提供了一个npm源；</p>
<p>&#x2F;&#x2F;设置淘宝源</p>
<p>npm config set registry <a target="_blank" rel="noopener" href="https://registry.npmmirror.com/">https://registry.npmmirror.com/</a></p>
<p>原来的老的淘宝npm地址（<a target="_blank" rel="noopener" href="http://registry.npm.taobao.org/%EF%BC%89%E5%8D%B3%E5%B0%86%E5%81%9C%E6%AD%A2%E8%A7%A3%E6%9E%90%EF%BC%8C%E6%89%80%E4%BB%A5%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8%E6%96%B0%E5%9C%B0%E5%9D%80%EF%BC%8C%E5%8F%82%E8%80%83https://npmmirror.com/%E7%9A%84%E9%A1%B5%E9%9D%A2%E8%AF%B4%E6%98%8E%EF%BC%9B">http://registry.npm.taobao.org/）即将停止解析，所以建议使用新地址，参考https://npmmirror.com/的页面说明；</a></p>
<p>安装一个模块（js依赖库）测试一下看看：两个都是一样的</p>
<ol>
<li>npm install axios -g #其中-g是全局安装的意思；</li>
<li>npm i axios -g #其中-g是全局安装的意思；</li>
</ol>
<p>全局安装就会把axios模块安装到；</p>
<p>E:\course\tool\node-v20.9.0-win-x64\node_global目录下，如果不加-g就会安装到了当前执行命令所在的目录下：C:\Users\Administrator</p>
<h3 id="Vite安装"><a href="#Vite安装" class="headerlink" title="Vite安装"></a>Vite安装</h3><p>vite是vue.js的脚手架，用于自动生成vue.js的项目模板（项目基础骨架）；</p>
<p>官网：<a target="_blank" rel="noopener" href="https://cn.vitejs.dev/">https://cn.vitejs.dev/</a> ( 之前使用Vue-Cli ，停止更新了)，用下面这个指令可以直接安装，latest是最新版本的意思，这个执行结果是创建一个工程文件，最好是先创建一个文件夹然后用路径去执行cmd。然后输y安装，vue工程名默认vite-project，框架vue，语言选javascript</p>
<p>npm create vite@latest </p>
<p>npm是Node Package Manager的缩写，是Node.js的一个包管理工具。create是一个npm的命令，用于创建新的npm包。vite是一个基于Vue.js的静态网站生成器，@latest表示使用最新版本的vite，即npm create vite@latest为创建一个使用最新版本vite的npm包；</p>
<h3 id="Vue项目开发工具"><a href="#Vue项目开发工具" class="headerlink" title="Vue项目开发工具"></a>Vue项目开发工具</h3><p>项目代码开发工具，这里选择idea</p>
<p>1、VScode （全称Visual Studio Code）</p>
<p>2、WebStorm；（也是idea公司出品的）</p>
<p>3、Idea (新版本的idea自带了vue插件) </p>
<p>4、Hbuilder；</p>
<h3 id="MAVEN的配置"><a href="#MAVEN的配置" class="headerlink" title="MAVEN的配置"></a>MAVEN的配置</h3><p>新建好项目后检查设置，先看maven，搜索一下，然后设置maven home path，user setting file</p>
<p>然后importing设置jdk版本</p>
<p>然后runner设置jre版本</p>
<p>然后搜compiler找到annotation processors勾选enable annotation processing</p>
<p>然后检查file encodings，编码格式设置成utf-8</p>
<p>nodejs的路径要设置上</p>
<h1 id="登录模块开发"><a href="#登录模块开发" class="headerlink" title="登录模块开发"></a>登录模块开发</h1><p>先写前端再写后端</p>
<h2 id="创建vue项目工程"><a href="#创建vue项目工程" class="headerlink" title="创建vue项目工程"></a>创建vue项目工程</h2><p>在工程目录F:\Java\dlyk_code下运行cmd输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm create vite@latest </span><br></pre></td></tr></table></figure>

<p>选择工程名称dlyk-front，框架vue，javascript语言</p>
<h2 id="Vue项目工程结构说明"><a href="#Vue项目工程结构说明" class="headerlink" title="Vue项目工程结构说明"></a>Vue项目工程结构说明</h2><p>1、node_modules&#x2F; 项目依赖的各种js依赖包，没有安装的话就没有；</p>
<p>2、public&#x2F; 公共的静态文件，比如一个网站图标；</p>
<p>3、src&#x2F; 源代码，我们前端写的源代码都会在这个文件夹下；其他的文件几乎不用管，管这个写代码的就行</p>
<p>4、gitignore 提交git时忽略哪些文件；</p>
<p>5、index.html 项目的首页，访问入口文件；</p>
<p>6、package.json 整个项目对js依赖库的配置，还包括了启动、构建项目命令等；（类似maven的pom.xml）</p>
<p>7、package-lock.json 锁定各个js依赖包的来源和版本；</p>
<p>8、README.md 项目的使用帮助文档；</p>
<p>9、vite.config.js vite的配置文件；</p>
<p>10、vscode文件夹是给vscode工具使用的可以删掉</p>
<h2 id="启动Vue项目工程"><a href="#启动Vue项目工程" class="headerlink" title="启动Vue项目工程"></a>启动Vue项目工程</h2><p>原来老的vue前端项目占用了8080，启动前修改一下启动端口vite.config.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">vue</span>()],</span><br><span class="line"></span><br><span class="line">  <span class="attr">server</span>:&#123;</span><br><span class="line">    <span class="attr">host</span>:<span class="string">&#x27;0.0.0.0&#x27;</span> ,<span class="comment">//ip地址</span></span><br><span class="line">    <span class="attr">port</span>: <span class="number">8081</span>, <span class="comment">// 设置服务启动端口号</span></span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// 设置服务启动时是否自动打开浏览器</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>命令行启动： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd dlyk_front// 切换目录</span><br><span class="line">npm install  或者  npm i //安装依赖</span><br><span class="line">npm run dev// 运行</span><br><span class="line">用这个运行后如果想停止运行就按ctrl+c，如果运行失败了就删掉package-lock.json和node_modules重新安装一次</span><br></pre></td></tr></table></figure>

<p>或者是在idea中点击package.json里面的绿色箭头运行；这里提示问题就检查设置里的nodejs路径</p>
<h2 id="Vue工程运行流程分析"><a href="#Vue工程运行流程分析" class="headerlink" title="Vue工程运行流程分析"></a>Vue工程运行流程分析</h2><p>main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import ... from ...语句，大括号里一般是函数，从vue框架导入createApp函数</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入css样式，不需要from子句</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从当前路径./App.vue页面导入APP组件，可以把文件名当组件名，类似导入java自己写的类</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用上面所导入的createApp（）函数，创建一个vue应用，mount是挂载到#app地方</span></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>app.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--写一个标签&lt;script&gt;，里面写javascript代码--&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--写一个标签&lt;template&gt;，里面写html页面要展示的内容--&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    这是项目登录页面</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--写一个标签&lt;style&gt;，里面写css样式--&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/svg+xml&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/vite.svg&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vite + Vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--vue应用运行的结果在该div里面显示，是动态渲染的--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/src/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Element-plus"><a href="#Element-plus" class="headerlink" title="Element plus"></a>Element plus</h2><p>饿了么团队开发并开源的；它非常适合于开发后台系统；</p>
<p>基于Vue2.x （element-ui） <a target="_blank" rel="noopener" href="https://element.eleme.cn/">https://element.eleme.cn/</a> </p>
<p>基于Vue3.x （element-plus） <a target="_blank" rel="noopener" href="http://element-plus.gitee.io/">http://element-plus.gitee.io/</a></p>
<p>我们的项目，需要使用到一些页面的效果（表单、输入框、表格、按钮、布局、图标等等），我们采用的都是element-plus给我们提供的；</p>
<p>1、项目中要安装element-plus：直接在dlyk-front运行cmd就可以安装到node_modules里</p>
<ul>
<li>npm install element-plus –save</li>
<li>npm i element-plus –save</li>
</ul>
<p>-g 全局安装，安装到D:\course\tool\node-v20.9.0-win-x64\node_global</p>
<p>–save表示安装包信息会写入package.json的dependencies中，在dependencies中，那么项目打包就会依赖到该模块，如果项目打包时不需要依赖该模块，那么就使用–save-dev，它会在devDependencies下，表示项目开发需要依赖该模块，项目打包发布就不需要它；</p>
<p>2、使用element-plus</p>
<p>在main.js中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import ... from ...语句导入，从ElementPlus框架导入ElementPlus函数</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementPlus</span> <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入element-plus的css样式，不需要from子句</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用上面所导入的createApp（）函数，创建一个vue应用，mount是挂载到#app地方</span></span><br><span class="line"><span class="comment">// 使用一下，挂载是最后一步</span></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>element-plus提供的组件：<a target="_blank" rel="noopener" href="https://element-plus.org/zh-CN/component/button.html">https://element-plus.org/zh-CN/component/button.html</a></p>
<p>1、Basic 基础组件</p>
<p>2、配置组件</p>
<p>3、Form 表单组件</p>
<p>4、Data 数据展示</p>
<p>5、Navigation 导航</p>
<p>6、Feedback 反馈组件</p>
<p>7、Others 其他</p>
<p>找到需要应用的代码然后拷贝到app.vue里就可以，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button&gt;Default&lt;/el-button&gt;</span><br><span class="line">  &lt;el-button type=&quot;primary&quot;&gt;Primary&lt;/el-button&gt;</span><br><span class="line">  &lt;el-button type=&quot;success&quot;&gt;Success&lt;/el-button&gt;</span><br><span class="line">  &lt;el-button type=&quot;info&quot;&gt;Info&lt;/el-button&gt;</span><br><span class="line">  &lt;el-button type=&quot;warning&quot;&gt;Warning&lt;/el-button&gt;</span><br><span class="line">  &lt;el-button type=&quot;danger&quot;&gt;Danger&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>这个的效果就是一些按钮</p>
<h2 id="编写登录页面"><a href="#编写登录页面" class="headerlink" title="编写登录页面"></a>编写登录页面</h2><p>使用框架的布局容器代码</p>
<p>在src下新建一个view文件，再新建一个vue项目，两个选项，composition api是组合式api，适合大型项目使用，新手一般选options api，新建LoginView.vue，然后把复制的代码粘进去，并且注意css样式，浏览器级 CSS 只支持 <code>/* */</code> 注释。</p>
<p>左右结构；40% ：60%，把老工程的src下的assets的loginBox.svg图片复制到新工程同文件下，然后调整，右边根据网站找到需要的表格，复制表单代码</p>
<p>右边的区域原本是百分之100，然后给输入框设置宽度为60后，左右的边距自动换成各20</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250609193205780.png" alt="image-20250609193205780"></p>
<p>按钮对不齐的问题：<strong>使用深度选择器覆盖 Element Plus 样式</strong>，自己问ai的，但后来一对比是因为复制过来的是label-width&#x3D;auto，改成120px就可以了</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250609225930292.png" alt="image-20250609225930292"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250609225854632.png"></p>
<p>运行后发现左边上下都有白条，还有滚动条，是因为白色的边框把整个页面撑高了，就需要在index.html里加一个全局样式，顺便把标题改成动力云客管理系统</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--vue应用运行的结果在该div里面显示，是动态渲染的--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/src/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">       <span class="selector-tag">body</span>&#123;</span></span><br><span class="line"><span class="language-css">           <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>LoginView.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">  &lt;el-container&gt;</span><br><span class="line">    &lt;!--左侧--&gt;</span><br><span class="line">    &lt;el-aside width=&quot;200px&quot;&gt;</span><br><span class="line">        &lt;!--..是上一级目录--&gt;</span><br><span class="line">      &lt;img src=&quot;../assets/loginBox.svg&quot;&gt;</span><br><span class="line">      &lt;!--加一个class后就可以在下面设置css--&gt;</span><br><span class="line">      &lt;p class=&quot;imgTitle&quot;&gt;</span><br><span class="line">        欢迎使用动力云客系统</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">    &lt;/el-aside&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--右侧--&gt;</span><br><span class="line">    &lt;el-main&gt;</span><br><span class="line">      &lt;div class=&quot;loginTile&quot;&gt;欢迎登录&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form :model=&quot;form&quot; label-width=&quot;120px&quot; style=&quot;max-width: 600px&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;账号&quot;&gt;</span><br><span class="line">          &lt;!--报错说这个form没有定义，在下面的script里定义data，用的vue2固定写法--&gt;</span><br><span class="line">          &lt;el-input v-mdel=&quot;form.name&quot; /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form-item label=&quot;密码&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;form.name&quot; /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form-item&gt;</span><br><span class="line">          &lt;!--放这里面可以对齐--&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot;&gt;登 录&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form-item&gt;</span><br><span class="line">          &lt;el-checkbox label=&quot;记住我&quot; name=&quot;remeberMe&quot; /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">    &lt;/el-main&gt;</span><br><span class="line">  &lt;/el-container&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default (&#123;</span><br><span class="line">  // 组件的名字，上面的defineComponent可以省略</span><br><span class="line">  name: &quot;LoginView&quot;,</span><br><span class="line"></span><br><span class="line">  // 定义页面使用到的变量，定义时初始值都是给空的</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      // 对象变量定义：是&#123;&#125;</span><br><span class="line">      form : &#123;&#125;,</span><br><span class="line">      // 字符串变量定义，是&quot;&quot;</span><br><span class="line">      name : &#x27;&#x27;,</span><br><span class="line">      // 数字变量定义，是0</span><br><span class="line">      age : 0,</span><br><span class="line">      // 数组变量定义，是[]</span><br><span class="line">      arr : [],</span><br><span class="line">      // list集合对象（对象数组）是[&#123;&#125;]</span><br><span class="line">      userList : [&#123;&#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.el-aside&#123;</span><br><span class="line">   /*左侧的黑色宽度百分比*/</span><br><span class="line">  background: #1a1a1a;</span><br><span class="line">  width: 40%;</span><br><span class="line">  text-align: center;/*居中*/</span><br><span class="line">&#125;</span><br><span class="line">.el-main&#123;</span><br><span class="line">  /*calc是计算，100vh是整个屏幕*/</span><br><span class="line">  height: calc(100vh);</span><br><span class="line">&#125;</span><br><span class="line">img&#123;</span><br><span class="line">  height: 413px;</span><br><span class="line">&#125;</span><br><span class="line">.imgTitle&#123;</span><br><span class="line">  color: #f9f9f9;</span><br><span class="line">  font-size: 20px;</span><br><span class="line">&#125;</span><br><span class="line">.el-form&#123;</span><br><span class="line">  width: 60%;</span><br><span class="line">  /*边距自动对齐*/</span><br><span class="line">  margin: auto;</span><br><span class="line">&#125;</span><br><span class="line">.loginTile&#123;</span><br><span class="line">  /*文字居中，上面给100像素的边框，下面给20的边框，然后字体加粗*/</span><br><span class="line">  text-align: center;</span><br><span class="line">  margin-top: 100px;</span><br><span class="line">  margin-bottom: 25px;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">&#125;</span><br><span class="line">.el-button&#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">&#125;</span><br><span class="line">/* 使用深度选择器覆盖 Element Plus 样式，这个是我自己问ai的，因为按钮总是对不齐，只能这样 */</span><br><span class="line">/*:deep(.el-form-item__label-wrap) &#123;</span><br><span class="line">  width: 50px; !* 设置标签宽度 *!</span><br><span class="line">&#125;*/</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>然后再main.js导入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从当前路径./App.vue页面导入APP组件，可以把文件名当组件名，类似导入java自己写的类</span></span><br><span class="line"><span class="comment">// 使用LoginView作为主页面</span></span><br><span class="line"><span class="comment">// import App from &#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//从./view/LoginView.vue导入loginview组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">LoginView</span> <span class="keyword">from</span> <span class="string">&quot;./view/LoginView.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用上面所导入的createApp（）函数，创建一个vue应用，mount是挂载到#app地方</span></span><br><span class="line"><span class="comment">// 使用一下，挂载是最后一步</span></span><br><span class="line"><span class="comment">// createApp(App).use(ElementPlus).mount(&#x27;#app&#x27;)</span></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">LoginView</span>).<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><p>1、在<el-form>里面定义一个:rules&#x3D;”rules”；找到网站form表单的表单校验，先在代码后面加上这个，然后去data定义loginRules : {}</p>
<p>2、在要验证的el-input上的<el-form-item>中定义prop&#x3D;xx，在el-input上面的标签里加个property体，缩写是prop，需要验证的都加，然后改一下model后面的名字，下面所有的都更新</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--:rules前面是v-bind，绑定的意思，但是可以省略为一个冒号，引号里的是名字变量，有变量后需要在data里定义--&gt;</span><br><span class="line">&lt;el-form :model=&quot;user&quot; label-width=&quot;120px&quot; style=&quot;max-width: 600px&quot; :rules=&quot;loginRules&quot;&gt;</span><br><span class="line">  &lt;el-form-item label=&quot;账号&quot; prop=&quot;loginAct&quot;&gt;&lt;!--需要验证的都加property（缩写prop--&gt;</span><br><span class="line">    &lt;!--报错说这个form没有定义，在下面的script里定义data，用的vue2固定写法--&gt;</span><br><span class="line">    &lt;el-input v-mdel=&quot;user.loginAct&quot; /&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">  &lt;el-form-item label=&quot;密码&quot; prop=&quot;loginPwd&quot;&gt;</span><br><span class="line">    &lt;el-input v-model=&quot;user.loginPwd&quot; /&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure>

<p>3、给要验证的字段定义验证规则；规则可以有多个，所以用数组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">data()&#123;</span><br><span class="line">   return&#123;</span><br><span class="line">loginRules : &#123;</span><br><span class="line">	// 定义账号的验证规则，规则可以有多个，所以是数组</span><br><span class="line">       loginAct : [</span><br><span class="line">         /*required是必须的意思，就是必须输入东西，否则会提示消息，trigger是触发器，blur是光标离开时触发，账号不需要限定长度*/</span><br><span class="line">         &#123; required: true, message: &#x27;请输入登录账号&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">       ],</span><br><span class="line">       loginPwd : [</span><br><span class="line">         &#123; required: true, message: &#x27;请输入登录密码&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">         /*登录账号最少3位最大5位，如果不是就警告*/</span><br><span class="line">         &#123; min: 3, max: 5, message: &#x27;登录密码长度为6-16位&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">       ]</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>然后在登录按钮写一个点击事件@click，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--放el-form-item这里面可以对齐,按钮需要添加一个事件，添加@click，后面是函数名，不加括号也可以，点击触发，函数写在methods里--&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; @click=&quot;login&quot;&gt;登 录&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>然后在form添加ref引用对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--这里要加一个ref用来引用验证规则--&gt;</span><br><span class="line">&lt;el-form ref=&quot;loginRefForm&quot; :model=&quot;user&quot; label-width=&quot;120px&quot; style=&quot;max-width: 600px&quot; :rules=&quot;loginRules&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>在script里写函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数都写在这里面，页面上需要使用功能的js函数，都在methods属性中定义</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="comment">// 登录函数</span></span><br><span class="line">  <span class="title function_">login</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 提交前验证输入框的合法性，就是密码长度是不是6-16位，需要给上面的form加一个ref属性</span></span><br><span class="line">    <span class="comment">//当前的.$refs是一个引用对象.loginRefForm表单的验证规则，规则是rules里面的，严重完后会返回一个回调函数，</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">loginRefForm</span>.<span class="title function_">validate</span>(<span class="function">(<span class="params">isValid</span>) =&gt;</span>&#123;</span><br><span class="line">      <span class="comment">// isValid是验证后的结果，名字可以随便写，如果是true表示验证通过，否则未通过</span></span><br><span class="line">      <span class="keyword">if</span>(isValid)&#123;</span><br><span class="line">        <span class="comment">// 验证通过，可以提交登录</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="安装axios依赖"><a href="#安装axios依赖" class="headerlink" title="安装axios依赖"></a>安装axios依赖</h2><p>主要用来发请求</p>
<p>Vue中我们一般都是采用axios发送异步ajax请求；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios --save (两个杠)</span><br></pre></td></tr></table></figure>

<p>主要就是封装4个方法；</p>
<ul>
<li>doGet() 查询</li>
<li>doPost() 新增</li>
<li>doPut() 修改</li>
<li>doDelete() 删除</li>
</ul>
<p>在src文件下建http文件，建httpRequest.js文件，封装四个方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要加一个导出才可以在其他页面导入使用</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义后端接口地址的前缀</span></span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">baseURL</span> = <span class="string">&quot;http://localhost:8089&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">doGet</span>(<span class="params">url, params</span>)  &#123;</span><br><span class="line">    <span class="title function_">axios</span>(&#123;<span class="comment">//如果有黄色波浪线就alt+enter导入</span></span><br><span class="line">        <span class="comment">//方法可以写死</span></span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">        <span class="comment">//下面两个都不要写死</span></span><br><span class="line">        <span class="attr">url</span>: url,</span><br><span class="line">        <span class="attr">params</span>: params,<span class="comment">//传入的格式是这样&#123;name: &quot;对的&quot;, age:22&#125;,</span></span><br><span class="line">        <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">rep</span>)&#123;</span><br><span class="line">        <span class="comment">// rep.data = [(&quot;name&quot;:&quot;李四&quot;, &quot;age&quot;:22),&#123;&quot;name&quot;:&quot;张三&quot;,&quot;name&quot;:&quot;王五&quot;,&quot;age&quot;:24&#125;]</span></span><br><span class="line">        <span class="keyword">var</span> s = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        rep.<span class="property">data</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">stu</span>)&#123;</span><br><span class="line">            s += stu.<span class="property">name</span> + <span class="string">&quot;-----------&quot;</span> + stu.<span class="property">age</span> + <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;mydiv&quot;</span>).<span class="property">innerHTML</span> = s;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">doPost</span>(<span class="params">url, data</span>) &#123;</span><br><span class="line">    <span class="comment">//需要return结果</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">axios</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: url,</span><br><span class="line">        <span class="comment">//注意这里的传入参数是data，不要和上面的混淆</span></span><br><span class="line">        <span class="attr">data</span>:data,<span class="comment">//&#123;name: &quot;好的呢&quot;, age:22&#125;,</span></span><br><span class="line">        <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//和post一样，只需要改方法名</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">doPut</span>(<span class="params">url, data</span>) &#123;</span><br><span class="line">    <span class="title function_">axios</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;put&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: url,</span><br><span class="line">        <span class="attr">data</span>:data,</span><br><span class="line">        <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">rep</span>)&#123;</span><br><span class="line">        <span class="comment">// rep.data = [(&quot;name&quot;:&quot;李四&quot;, &quot;age&quot;:22),&#123;&quot;name&quot;:&quot;张三&quot;,&quot;name&quot;:&quot;王五&quot;,&quot;age&quot;:24&#125;]</span></span><br><span class="line">        <span class="keyword">var</span> s = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        rep.<span class="property">data</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">stu</span>)&#123;</span><br><span class="line">            s += stu.<span class="property">name</span> + <span class="string">&quot;-----------&quot;</span> + stu.<span class="property">age</span> + <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;mydiv&quot;</span>).<span class="property">innerHTML</span> = s;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//和get一样</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">doDelete</span>(<span class="params">url, params</span>)&#123;</span><br><span class="line">    <span class="title function_">axios</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;delete&quot;</span>,</span><br><span class="line">        <span class="comment">//下面两个都不要写死</span></span><br><span class="line">        <span class="attr">url</span>: url,</span><br><span class="line">        <span class="attr">params</span>: params,</span><br><span class="line">        <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">rep</span>)&#123;</span><br><span class="line">        <span class="comment">// rep.data = [(&quot;name&quot;:&quot;李四&quot;, &quot;age&quot;:22),&#123;&quot;name&quot;:&quot;张三&quot;,&quot;name&quot;:&quot;王五&quot;,&quot;age&quot;:24&#125;]</span></span><br><span class="line">        <span class="keyword">var</span> s = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        rep.<span class="property">data</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">stu</span>)&#123;</span><br><span class="line">            s += stu.<span class="property">name</span> + <span class="string">&quot;-----------&quot;</span> + stu.<span class="property">age</span> + <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;mydiv&quot;</span>).<span class="property">innerHTML</span> = s;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后去vue里写登录函数，调用js里的方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数都写在这里面，页面上需要使用功能的js函数，都在methods属性中定义</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="comment">// 登录函数</span></span><br><span class="line">  <span class="title function_">login</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 提交前验证输入框的合法性，就是密码长度是不是6-16位，需要给上面的form加一个ref属性</span></span><br><span class="line">    <span class="comment">//当前的.$refs是一个引用对象.loginRefForm表单的验证规则，规则是rules里面的，严重完后会返回一个回调函数，</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">loginRefForm</span>.<span class="title function_">validate</span>(<span class="function">(<span class="params">isValid</span>) =&gt;</span>&#123;</span><br><span class="line">      <span class="comment">// isValid是验证后的结果，如果是true表示验证通过，否则未通过</span></span><br><span class="line">      <span class="keyword">if</span>(isValid)&#123;</span><br><span class="line">        <span class="comment">// 验证通过，可以提交登录</span></span><br><span class="line">        <span class="comment">// FormData是一个js对象，用于传输数据，以键值对的方式</span></span><br><span class="line">        <span class="keyword">let</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">        <span class="comment">//loginact是键，后面的是值，这样就把值赋给了formData</span></span><br><span class="line">        formData.<span class="title function_">append</span>(<span class="string">&quot;loginAct&quot;</span>, <span class="variable language_">this</span>.<span class="property">user</span>.<span class="property">loginAct</span>);</span><br><span class="line">        formData.<span class="title function_">append</span>(<span class="string">&quot;loginPwd&quot;</span>, <span class="variable language_">this</span>.<span class="property">user</span>.<span class="property">loginPwd</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用httpRequest里的方法，then是需要的结果，因为结果不固定所以放到这里写，这个箭头的写法类似于Lambda表达式</span></span><br><span class="line">        <span class="title function_">doPost</span>(<span class="string">&quot;/api/login&quot;</span>,formData).<span class="title function_">then</span>( <span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="后端项目搭建"><a href="#后端项目搭建" class="headerlink" title="后端项目搭建"></a>后端项目搭建</h2><p>需要这些依赖</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250612162206536.png" alt="image-20250612162206536"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250612162154496.png" alt="image-20250612162154496"></p>
<p>简单检查一下pom依赖，然后把配置文件改为yml</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250612162420764.png" alt="image-20250612162420764"></p>
<p>然后在application.yml里配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8089</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置数据库链接相关信息</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/dlyk</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">liuqi3711022</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="comment">#最大连接数，默认是10</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">30</span></span><br><span class="line">      <span class="comment">#最小空闲链接，默认是10</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">30</span></span><br><span class="line">      <span class="comment">#等待链接池分配链接的最大时长，超过该时长还没有可用连接则发生超时异常（单位毫秒）</span></span><br><span class="line">      <span class="attr">connection-timeout:</span> <span class="number">5000</span></span><br><span class="line">      <span class="comment">#空闲连接的最大时长，空闲多久就被释放回收，设置为0不让连接回收</span></span><br><span class="line">      <span class="attr">idle-timeout:</span> <span class="number">0</span></span><br><span class="line">      <span class="comment">#一个连接的最大生命时间，超过该时间还没有使用就回收掉（单位毫秒），最好不要超过8小时</span></span><br><span class="line">      <span class="attr">max-lifetime:</span> <span class="number">18000000</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#配置redis的连接信息</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">liuqi3711022</span></span><br><span class="line">      <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#指定mapper.xml文件的位置</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置好后反向工程一下</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="动力云客项目.assets/image-20250612193539061.png" alt="image-20250612193539061" style="zoom:67%;" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="动力云客项目.assets/image-20250612193720466.png" alt="image-20250612193720466" style="zoom: 80%;" /> </p>
<p>如果连不上可以在url连接的后面加上jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306?userSSL&#x3D;false，然后点击这里选择all schemas</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250612194011735.png" alt="image-20250612194011735"> </p>
<p>然后选中dlyk里所有的表，然后右击选择mybatis生成，</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250613163635538.png" alt="image-20250613163635538"></p>
<p>然后给要在入口程序那边写上包扫描</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(basePackages = &#123;&quot;com.bjpowernode.mapper&quot;&#125;)</span></span><br></pre></td></tr></table></figure>

<h2 id="项目分层（后端项目）"><a href="#项目分层（后端项目）" class="headerlink" title="项目分层（后端项目）"></a>项目分层（后端项目）</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250613164243076.png" alt="image-20250613164243076"></p>
<p>需要在bjpowernode包下分别建立manager、service、web、query、result（R对象）包，model是DO</p>
<p>领域对象划分：</p>
<p>【参考】分层领域模型规约：</p>
<p>• DO（Data Object）：此对象与数据库表结构一一对应，通过 DAO 层向上传输数据源对象。</p>
<p>• DTO（Data Transfer Object）：数据传输对象，Service 或 Manager 向外传输的对象。</p>
<p>• BO（Business Object）：业务对象，可以由 Service 层输出的封装业务逻辑的对象。</p>
<p>• Query：数据查询对象，各层接收上层的查询请求。注意超过 2 个参数的查询封装，禁止使用 Map 类来传输。</p>
<p>• VO（View Object）：显示层对象，通常是Web向模板渲染引擎层传输的对象。</p>
<p><span style="color:blue;">我们只使用其中的三个，如果都使用的话，反而把代码弄得复杂繁琐一些了；</span></p>
<p><span style="color:blue;">1、DO（等价于我们的model）</span></p>
<p><span style="color:blue;">2、Query （controller –&gt; service –&gt;manager –&gt; dao 上一层往下一层传参数）</span></p>
<p><span style="color:blue;">3、VO（等价于我们的result中的R对象）</span></p>
<p>要用到R对象就需要使用之前SpringBoot里学到的r对象封装，把代码复制到R.java和CodeEnum.java里（但是这个里面少了一些方法，需要再添加进去</p>
<p>R：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span> <span class="comment">// 建造模式</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">// 响应的状态码: 200、500、404</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="comment">// 响应的消息描述：成功，失败，删除失败，修改失败，添加失败</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="comment">// 响应的对象：支持任意类型的对象</span></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为了方便返回数据，一般这里的方法都是静态方法。</span></span><br><span class="line">    <span class="comment">// 方法一般包括两大类：一类是成功，一类是失败。（重载）</span></span><br><span class="line">    <span class="comment">// 响应成功的消息，但是不携带任何数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">OK</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">                .code(CodeEnum.OK.getCode())</span><br><span class="line">                .msg(CodeEnum.OK.getMsg())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 响应成功的消息，携带数据data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">OK</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">                .code(CodeEnum.OK.getCode())</span><br><span class="line">                .msg(CodeEnum.OK.getMsg())</span><br><span class="line">                .data(data)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">OK</span><span class="params">(<span class="type">int</span> code, String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">                .code(code)</span><br><span class="line">                .msg(msg)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 响应失败的消息。默认的code是400，失败的消息：失败</span></span><br><span class="line">    <span class="comment">// 失败是不可能携带数据。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">FAIL</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">                .code(CodeEnum.FAIL.getCode())</span><br><span class="line">                .msg(CodeEnum.FAIL.getMsg())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 改成了传入一个codeEnum对象，然后调用里面的方法，获得code和msg</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">FAIL</span><span class="params">(CodeEnum codeEnum)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">                .code(codeEnum.getCode())</span><br><span class="line">                .msg(codeEnum.getMsg())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//接受字符串参数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">FAIL</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">                .code(CodeEnum.FAIL.getCode())  <span class="comment">// 使用默认的错误码</span></span><br><span class="line">                .msg(message)                   <span class="comment">// 使用传入的自定义消息</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CodeEnum</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 专门维护code+msg的一个枚举类型</span></span><br><span class="line"><span class="comment">//@Data 不能用data，就需要手动添加setter getter注解或者方法</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="comment">//@Setter这里也不能添加</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">CodeEnum</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ;</span></span><br><span class="line">    <span class="comment">//这地方没有写枚举值，那么由于后面有其他代码，这里至少要写一个“;”</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//这些会传到下面的字段上，统一去维护</span></span><br><span class="line">    OK(<span class="number">200</span>, <span class="string">&quot;成功&quot;</span>),</span><br><span class="line">    FAIL(<span class="number">400</span>, <span class="string">&quot;失败&quot;</span>),</span><br><span class="line">    BAD_REQUEST(<span class="number">400</span>, <span class="string">&quot;请求错误&quot;</span>),</span><br><span class="line">    NOT_FOUND(<span class="number">404</span>, <span class="string">&quot;Not Found&quot;</span>),</span><br><span class="line">    INTERNAL_ERROR(<span class="number">500</span>, <span class="string">&quot;内部服务器错误&quot;</span>),</span><br><span class="line">    MODIFICATION_FAILED(<span class="number">400</span>, <span class="string">&quot;修改失败&quot;</span>),</span><br><span class="line">    DELETION_FAILED(<span class="number">400</span>, <span class="string">&quot;删除失败&quot;</span>),</span><br><span class="line">    CREATION_FAILED(<span class="number">400</span>, <span class="string">&quot;创建失败&quot;</span>),</span><br><span class="line">    DATA_ACCESS_EXCEPTION(<span class="number">500</span>,<span class="string">&quot;数据库操作失败&quot;</span>),</span><br><span class="line">    ACCESS_DENIED(<span class="number">500</span>, <span class="string">&quot;权限不足&quot;</span>)</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// javase当中详细讲过枚举类型</span></span><br><span class="line">    <span class="comment">// 枚举类型当中可以有属性</span></span><br><span class="line">    <span class="comment">// 枚举类型当中可以有构造方法</span></span><br><span class="line">    <span class="comment">// 枚举类型当中可以有setter和getter方法。</span></span><br><span class="line">    <span class="comment">// 在枚举类型当中有一个语法要求，枚举的大括号一开始的位置必须编写枚举值。</span></span><br><span class="line">    <span class="comment">// 每一个枚举值就是一个枚举类型的实例。</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Setter</span><span class="comment">// 只能加在字段上</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Season</span> &#123;</span><br><span class="line">    <span class="comment">// 这些就是枚举值</span></span><br><span class="line">    <span class="comment">// 其中每一个枚举值都是 Season类型的对象/实例。</span></span><br><span class="line">    SPRING, SUMMER, AUTUMN, WINTER;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 枚举值下面如果没有代码，枚举值列表最后的那个“;”可以省略。</span></span><br><span class="line">    <span class="comment">// 枚举值下面如果有代码，则枚举值列表最后的&quot;;&quot;是不能省略的。</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在service包里新建UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个UserDetailsService是自定义类实现详情服务接口，里面包含用户的信息</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service里新建impl和实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span><span class="comment">//注入</span></span><br><span class="line">    <span class="keyword">private</span> TUserMapper tUserMapper;<span class="comment">//查询用户</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">TUser</span> <span class="variable">tUser</span> <span class="operator">=</span> tUserMapper.selectByLoginAct(username);<span class="comment">//查询登录用户，按alt+回车创建查询，然后点击左边的箭头写查询语句</span></span><br><span class="line">        <span class="keyword">if</span>(tUser == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;登录账号不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tUser;<span class="comment">//因为要求返回的是UserDetails，所以需要改造一下tUser对象</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>按alt+回车创建查询后会在TUserMappper.java里多一行这个代码，点一下左边的图标跳转到xml里写查询语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TUser <span class="title function_">selectByLoginAct</span><span class="params">(String username)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  根据账号查询--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByLoginAct&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span> /&gt;</span>/*查询的表*/</span><br><span class="line">    from t_user</span><br><span class="line">    where login_act = #&#123;username,jdbcType=VARCHAR&#125;/*username是传过来的用户名，类型是VARCHAR*/</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后因为要求返回的是UserDetails，所以需要改造一下return的tUser对象，点击TUser.java，继承UserDetails接口然后实现里面的七个方法，按alt+insert选择implementxxxx的实现，写一个角色List和权限标识符list，给下面的七个方法都重写</p>
<p>在数据库里选择t_user选设计表，可以看到这些信息，主要看账户密码是否过期启动这些，然后设置返回值，但接口里的这几个变量后面到时候也会返回到js对象里面去，所以需要加上@JsonIgnore来忽略掉<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250616172953545.png" alt="image-20250616172953545"></p>
<p>tUser：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 角色LIst</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; roleList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 权限标识符List</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; permissionList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//------------------实现UserDetails接口的七个方法---------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;</span><br><span class="line">        <span class="comment">// 返回类型是上面继承的</span></span><br><span class="line">        List&lt;GrantedAuthority&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 角色</span></span><br><span class="line">        <span class="keyword">if</span> (!ObjectUtils.isEmpty(<span class="built_in">this</span>.getRoleList()))&#123;<span class="comment">//意思是这个角色如果不为空</span></span><br><span class="line">            <span class="built_in">this</span>.getRoleList().forEach(role -&gt; &#123;</span><br><span class="line">                list.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(role));</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (!ObjectUtils.isEmpty(<span class="built_in">this</span>.getRoleList()))&#123;</span><br><span class="line">            <span class="comment">// 权限标识符，拿到权限</span></span><br><span class="line">            <span class="built_in">this</span>.getPermissionList().forEach(permission -&gt; &#123;</span><br><span class="line">                list.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(permission));</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getLoginPwd();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getLoginAct();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span> &#123;<span class="comment">//账号是否过期，等于1就是true然后返回</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getAccountNoExpired() == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span> &#123;<span class="comment">// 账户是否锁定</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getAccountNoLocked() == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span> &#123;<span class="comment">// 密码是否过期</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getCredentialsNoExpired() == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123;<span class="comment">//是否启用</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getAccountEnabled() == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后写个配置类把这些配置一下，可以直接创建java，写上config.SecurityConfig，注入的myAuthenticationSuccessHandler和myAuthenticationFailureHandler类里面的东西都是直接复制过来的（config的handler文件夹里），可以看Security课应该有讲，然后把util.JSONUtils.java和util.ResponseUtils.java复制到powernode下，复制进来的util.JSONUtils.java和ResponseUtils.java可以不用动，上面复制进config里的都需要</p>
<p>SecurityConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span><span class="comment">//把登录成功注入进来</span></span><br><span class="line">    <span class="keyword">private</span> MyAuthenticationSuccessHandler myAuthenticationSuccessHandler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span><span class="comment">//注入登录失败</span></span><br><span class="line">    <span class="keyword">private</span> MyAuthenticationFailureHandler myAuthenticationFailureHandler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> httpSecurity</span><br><span class="line">                    .formLogin( (formLogin) -&gt; &#123;</span><br><span class="line">                        formLogin.loginProcessingUrl(<span class="string">&quot;/api/login&quot;</span>)<span class="comment">//这是处理登录的登录地址，前端要往这里提交，不需要写Controller</span></span><br><span class="line">                                .usernameParameter(<span class="string">&quot;loginAct&quot;</span>)<span class="comment">//用户名参数和密码参数</span></span><br><span class="line">                                .passwordParameter(<span class="string">&quot;loginPwd&quot;</span>)</span><br><span class="line">                                .successHandler(myAuthenticationSuccessHandler)</span><br><span class="line">                                .failureHandler(myAuthenticationFailureHandler);<span class="comment">//登陆成功和登录失败，这里的代码就是复制原工程，没有教</span></span><br><span class="line">                    &#125;)<span class="comment">//要做登录，所以从form表单传参数，用Lambda表达式，里面的名字建议用formLogin会工整一些</span></span><br><span class="line">                    .authorizeHttpRequests( (authorize) -&gt; &#123;</span><br><span class="line">                        authorize.anyRequest().authenticated();<span class="comment">// 任何请求都需要登录后才能访问</span></span><br><span class="line">                    &#125;)<span class="comment">//要对请求拦截</span></span><br><span class="line">                    .build();<span class="comment">//链式编程</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>登陆成功的处理器MyAuthenticationSuccessHandler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAuthenticationSuccessHandler</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationSuccessHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">//登录成功，执行该方法，在该方法中返回json给前端，就行了</span></span><br><span class="line">        <span class="type">TUser</span> <span class="variable">tUser</span> <span class="operator">=</span> (TUser) authentication.getPrincipal();<span class="comment">//通过authentication可以拿到登录用户</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//登录成功的统一结果，登陆成功把用户信息返回给前台</span></span><br><span class="line">        <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> R.OK(tUser);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把R对象转成json</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resultJSON</span> <span class="operator">=</span> JSONUtils.toJSON(result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把R以json返回给前端</span></span><br><span class="line">        ResponseUtils.write(response, resultJSON);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>登录失败的处理器MyAuthenticationFailureHandler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAuthenticationFailureHandler</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationFailureHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationFailure</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">//登录失败，执行该方法，在该方法中返回json给前端，就行了</span></span><br><span class="line">        <span class="comment">//登录失败的统一结果</span></span><br><span class="line">        <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> R.FAIL(exception.getMessage());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把R对象转成json</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resultJSON</span> <span class="operator">=</span> JSONUtils.toJSON(result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把R以json返回给前端</span></span><br><span class="line">        ResponseUtils.write(response, resultJSON);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>退出成功处理器MyLogoutSuccessHandler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLogoutSuccessHandler</span> <span class="keyword">implements</span> <span class="title class_">LogoutSuccessHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLogoutSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">//退出成功，执行该方法，在该方法中返回json给前端，就行了</span></span><br><span class="line">        <span class="type">TUser</span> <span class="variable">tUser</span> <span class="operator">=</span> (TUser)authentication.getPrincipal();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//退出成功的统一结果</span></span><br><span class="line">        <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> R.OK(<span class="number">200</span>, <span class="string">&quot;退出成功&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把R对象转成json</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resultJSON</span> <span class="operator">=</span> JSONUtils.toJSON(result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把R以json返回给前端</span></span><br><span class="line">        ResponseUtils.write(response, resultJSON);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后发现JWTUtils里的auth0爆红了，需要添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 2023年10月最新版 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Apifox"><a href="#Apifox" class="headerlink" title="Apifox"></a>Apifox</h2><p>使用这个工具，然后测试这些东西，还是具体的看视频吧懒得整理了</p>
<p>注意是通过form-data提交</p>
<p>运行后有个<h2>Please sign in</h2>就是请求登录界面，这时候需要把接口地址放开（&#x2F;api&#x2F;login)，修改SecurityConfig，修改好后因为pom里有devtools热部署插件，然后右击dlyk-server选build module dlyk重启，重新发送后还是请求登录，这就是属于跨站伪造请求导致的，需要写个关闭跨域请求保护代码，这个Lambda表达式可以鼠标停留上面改进为方法引用</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250618161854895.png" alt="image-20250618161854895"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Bean</span><span class="comment">//这个是解决后面查找问题时遇到的There is no passwordEncoder mapped for the id &quot;null&quot;</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//禁用跨站请求伪造</span></span><br><span class="line">        <span class="keyword">return</span> httpSecurity</span><br><span class="line">                    .formLogin( (formLogin) -&gt; &#123;</span><br><span class="line">                        formLogin.loginProcessingUrl(<span class="string">&quot;api/login&quot;</span>)<span class="comment">//这是处理登录的登录地址，前端要往这里提交，不需要写Controller</span></span><br><span class="line">                                .usernameParameter(<span class="string">&quot;loginAct&quot;</span>)<span class="comment">//用户名参数和密码参数</span></span><br><span class="line">                                .passwordParameter(<span class="string">&quot;loginPwd&quot;</span>)</span><br><span class="line">                                .successHandler(myAuthenticationSuccessHandler)</span><br><span class="line">                                .failureHandler(myAuthenticationFailureHandler);<span class="comment">//登陆成功和登录失败，这里的代码就是复制原工程，没有教</span></span><br><span class="line">                    &#125;)<span class="comment">//要做登录，所以从form表单传参数，用Lambda表达式，里面的名字建议用formLogin会工整一些</span></span><br><span class="line">                    .authorizeHttpRequests( (authorize) -&gt; &#123;</span><br><span class="line">                        authorize.requestMatchers(<span class="string">&quot;/api/login&quot;</span>).permitAll()<span class="comment">//应该是批准这个的所有请求</span></span><br><span class="line">                                .anyRequest().authenticated();<span class="comment">// 其他任何请求都需要登录后才能访问</span></span><br><span class="line">                    &#125;)<span class="comment">//要对请求拦截</span></span><br><span class="line"></span><br><span class="line">                   <span class="comment">/* .csrf((csrf) -&gt;&#123;</span></span><br><span class="line"><span class="comment">                        csrf.disable();//禁用跨站请求伪造</span></span><br><span class="line"><span class="comment">                    &#125;)*/</span></span><br><span class="line">                    .csrf(AbstractHttpConfigurer::disable)<span class="comment">//方法引用，禁用跨站请求伪造</span></span><br><span class="line">                    .build();<span class="comment">//链式编程</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重新运行后还是不行，需要用debug看看有没有进入到登录人的filter里，怎么弄看视频，最后登陆成功返回了结果，然后接着写前台，去掉所有的断点方法是点</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250619022204633.png" alt="image-20250619022204633"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250619022222573.png" alt="image-20250619022222573"></p>
<p>接着打开网页输入admin和aaa111，在控制台可以看到这个错误CORS policy，这个错误是跨域错误</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250619202547120.png" alt="image-20250619202547120"></p>
<p><span style="color:red;">跨域报错：Access to XMLHttpRequest at ‘<a href="http://localhost:8089/api/login">http://localhost:8089/api/login</a>‘ from origin ‘<a href="http://localhost:8081/">http://localhost:8081</a>‘ has been blocked by CORS policy；</span></p>
<p>跨域：</p>
<p>源头：<a href="http://localhost:8081/">http://localhost:8081</a> 目的地：<a href="http://localhost:8080/api">http://localhost:8089/api</a>&#x2F;login，这就是跨域，然后被阻断</p>
<p>1、协议不同， <a href="http://localhost:8080/">http://localhost:8080</a>   <a href="http://localhost:8080/">https://localhost:8080</a></p>
<p>2、域名不同， <a href="http://localhost:8080/">http://localhost:8080</a>   <a href="http://localhost:8080/">http://dlyk.bjpowernode.com:8080</a></p>
<p>3、端口不同  <a href="http://localhost:8080/">http://localhost:8080</a>   <a href="http://localhost:8080/">http://localhost:8082</a></p>
<p>三个里面只要有任何一个不同就是跨域；</p>
<p>需要在后端的SecurityConfig添加跨域请求，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity httpSecurity,CorsConfigurationSource configurationSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//禁用跨站请求伪造</span></span><br><span class="line">        <span class="keyword">return</span> httpSecurity</span><br><span class="line">                    .formLogin( (formLogin) -&gt; &#123;</span><br><span class="line">                        formLogin.loginProcessingUrl(<span class="string">&quot;/api/login&quot;</span>)<span class="comment">//这是处理登录的登录地址，前端要往这里提交，不需要写Controller</span></span><br><span class="line">                                .usernameParameter(<span class="string">&quot;loginAct&quot;</span>)<span class="comment">//用户名参数和密码参数</span></span><br><span class="line">                                .passwordParameter(<span class="string">&quot;loginPwd&quot;</span>)</span><br><span class="line">                                .successHandler(myAuthenticationSuccessHandler)</span><br><span class="line">                                .failureHandler(myAuthenticationFailureHandler);<span class="comment">//登陆成功和登录失败，这里的代码就是复制原工程，没有教</span></span><br><span class="line">                    &#125;)<span class="comment">//要做登录，所以从form表单传参数，用Lambda表达式，里面的名字建议用formLogin会工整一些</span></span><br><span class="line">                    .authorizeHttpRequests( (authorize) -&gt; &#123;</span><br><span class="line">                        authorize.requestMatchers(<span class="string">&quot;/api/login&quot;</span>).permitAll()<span class="comment">//应该是批准这个的所有请求</span></span><br><span class="line">                                .anyRequest().authenticated();<span class="comment">// 其他任何请求都需要登录后才能访问</span></span><br><span class="line">                    &#125;)<span class="comment">//要对请求拦截</span></span><br><span class="line"></span><br><span class="line">                   <span class="comment">/* .csrf((csrf) -&gt;&#123;</span></span><br><span class="line"><span class="comment">                        csrf.disable();//禁用跨站请求伪造</span></span><br><span class="line"><span class="comment">                    &#125;)*/</span></span><br><span class="line">                    .csrf(AbstractHttpConfigurer :: disable)<span class="comment">//方法引用，禁用跨站请求伪造</span></span><br><span class="line">                    <span class="comment">//支持跨域请求</span></span><br><span class="line">                    .cors( (cors) -&gt;&#123;</span><br><span class="line">                        cors.configurationSource(configurationSource);<span class="comment">//这里面放一个bean对象就可以实现跨域，上面参数被注入后就可以放在这里</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                    .build();<span class="comment">//链式编程</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsConfigurationSource <span class="title function_">configurationSource</span><span class="params">()</span>&#123;<span class="comment">//CorsConfigurationSource是个接口，需要实现，按ctrl+h可以看到怎么实现</span></span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        configuration.setAllowedOrigins(Arrays.asList(<span class="string">&quot;*&quot;</span>));<span class="comment">//允许任何来源，比如http://localhost:8081</span></span><br><span class="line">        configuration.setAllowedMethods(Arrays.asList(<span class="string">&quot;*&quot;</span>));<span class="comment">//允许任何请求方法，比如post、get、put、delete</span></span><br><span class="line">        configuration.setAllowedHeaders(Arrays.asList(<span class="string">&quot;*&quot;</span>));<span class="comment">//允许任何的请求头</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//是基于url的，导入这个的时候注意不要选reactive的，写好后在上面的Bean的securityFilterChain后面注入</span></span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();<span class="comment">//这个就是需要实现的类，然后new出来去注册CorsConfiguration这个配置</span></span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>,configuration);  <span class="comment">//这个配置就是上面定义的给传进来，/**就是可以任何路径都可以使用这个configuration</span></span><br><span class="line">        <span class="keyword">return</span> source;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后再看网页console控制台返回的数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;data: &#123;…&#125;, status: 200, statusText: &#x27;&#x27;, headers: AxiosHeaders, config: &#123;…&#125;, …&#125;</span><br><span class="line">config</span><br><span class="line">: </span><br><span class="line">&#123;transitional: &#123;…&#125;, adapter: Array(3), transformRequest: Array(1), transformResponse: Array(1), timeout: 0, …&#125;</span><br><span class="line">data</span><br><span class="line">: </span><br><span class="line">&#123;code: 200, msg: &#x27;成功&#x27;, data: &#123;…&#125;&#125;</span><br><span class="line">headers</span><br><span class="line">: </span><br><span class="line">AxiosHeaders &#123;cache-control: &#x27;no-cache, no-store, max-age=0, must-revalidate&#x27;, content-type: &#x27;application/json;charset=UTF-8&#x27;, expires: &#x27;0&#x27;, pragma: &#x27;no-cache&#x27;&#125;</span><br><span class="line">request</span><br><span class="line">: </span><br><span class="line">XMLHttpRequest &#123;onreadystatechange: null, readyState: 4, timeout: 0, withCredentials: fals.e, upload: XMLHttpRequestUpload, …&#125;</span><br><span class="line">status</span><br><span class="line">: </span><br><span class="line">200</span><br><span class="line">statusText</span><br><span class="line">: </span><br><span class="line">&quot;&quot;</span><br><span class="line">[[Prototype]]</span><br><span class="line">: </span><br><span class="line">Object</span><br></pre></td></tr></table></figure>

<p>其中data就是后端springboot响应返回的那个R对象；里面就有code、msg、data，关注data就行，headers、request、statusText这些都不用关注，然后找到饿了么的那个文档，找到feedback反馈组件，找到message消息提示，找可关闭的消息提示，找到</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">ElMessage</span>(&#123;</span><br><span class="line">    <span class="attr">showClose</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;Congrats, this is a success message.&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">加进去是这样的</span><br><span class="line"><span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                <span class="comment">// 登陆成功，提示一下</span></span><br><span class="line">              <span class="title class_">ElMessage</span>(&#123;</span><br><span class="line">                <span class="attr">showClose</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&#x27;Congrats, this is a success message.&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>然后加到loginview代码里，如果ElMessage有黄色下划线，就alt+回车导入一下，加完后再登录看看登陆成功有没有弹出绿色的提示，但考虑到这个代码后面要经常使用，可以封装一下，前端新建个util包和util.js，放在里面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">ElMessage</span>&#125; <span class="keyword">from</span> <span class="string">&quot;element-plus&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//从饿了么拷贝的</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">messageTip</span>(<span class="params">msg, type</span>) &#123;<span class="comment">//加上export是导出的意思</span></span><br><span class="line">    <span class="title class_">ElMessage</span>(&#123;</span><br><span class="line">        <span class="attr">showClose</span>: <span class="literal">true</span>,<span class="comment">//是否显示关闭按钮</span></span><br><span class="line">        <span class="attr">center</span>: <span class="literal">true</span>, <span class="comment">//文字是否可以居中</span></span><br><span class="line">        <span class="attr">duration</span>: <span class="number">3000</span>,<span class="comment">//显示时间，单位为毫秒</span></span><br><span class="line">        <span class="comment">// message: &#x27;Congrats, this is a success message.&#x27;,不去写死</span></span><br><span class="line">        <span class="comment">// type: &#x27;success&#x27;,</span></span><br><span class="line">        <span class="attr">message</span>:msg,<span class="comment">//提示的消息内容</span></span><br><span class="line">        <span class="attr">type</span>:type,<span class="comment">//消息类型：&#x27;success&#x27; | &#x27;warning&#x27; | &#x27;info&#x27; | &#x27;error&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后vue里引用这些</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">doPost</span>(<span class="string">&quot;/api/login&quot;</span>,formData).<span class="title function_">then</span>( <span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(resp);</span><br><span class="line">            <span class="comment">//这里去对resp结果的data（一共六种）的code码是不是200，这里===是相对判断就必须是数字，这样假如是&quot;200&quot;，他就会判断不相等，==可能就判断相等了</span></span><br><span class="line">            <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                <span class="comment">// 登陆成功，提示一下</span></span><br><span class="line">                <span class="title function_">messageTip</span>(<span class="string">&quot;登陆成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">                <span class="comment">//跳转到系统的主页面，英文的意思是仪表盘，也就是系统首页</span></span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;/dashboard&quot;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">// 登录失败也提示一下</span></span><br><span class="line">              <span class="title function_">messageTip</span>(<span class="string">&quot;登录失败&quot;</span>,<span class="string">&quot;error&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br></pre></td></tr></table></figure>

<p>登陆成功后页面没有发生变化，就需要引入路由解决这个问题</p>
<h2 id="添加路由"><a href="#添加路由" class="headerlink" title="添加路由"></a>添加路由</h2><p>路由：就是vue访问的路径；</p>
<p>比如: &#x2F;</p>
<p>比如：&#x2F;dashboard</p>
<p>1、用npm命令安装路由</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-router --save</span><br></pre></td></tr></table></figure>

<p>2、在src下面新建一个router文件夹(这个名字无所谓，在router文件夹下新建一个router.js文件，在router.js文件里面写入以下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从vue-router这个依赖库中导入createRouter函数, createWebHistory函数</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个变量</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">    <span class="comment">//创建路由历史，比如访问哪个网页就会有历史记录</span></span><br><span class="line">    <span class="attr">history</span>:<span class="title function_">createWebHistory</span>(),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置路由：是一个数组，里面可以配置多个路由</span></span><br><span class="line">    <span class="attr">routes</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 设置路径</span></span><br><span class="line">            <span class="attr">path</span>:<span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">            <span class="comment">// 路由路径所对应的页面</span></span><br><span class="line">            component : <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/DashboardView.vue&#x27;</span>),<span class="comment">//两个点就是上级目录</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//导出创建的路由对象，default</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>

<p>然后在view里创建DashboardView.vue</p>
<p>3、在使用路由时导入路由：在main.js中导入：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//router.js导入router组件，main与router是同级目录所以一个点</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router/router.js&#x27;</span></span><br></pre></td></tr></table></figure>

<p>4、在main.js中使用路由</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.use(router);</span><br><span class="line">效果是</span><br><span class="line">createApp(LoginView).use(ElementPlus).use(router).mount(&#x27;#app&#x27;)</span><br></pre></td></tr></table></figure>

<p>5、使用 <router-view/>标签渲染路由地址所对应的页面组件；</p>
<p>需要把main.js前面的app取消注释，然后加入到创建里</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从当前路径./App.vue页面导入APP组件，可以把文件名当组件名，类似导入java自己写的类</span></span><br><span class="line"><span class="comment">// 使用LoginView作为主页面</span></span><br><span class="line"> <span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span><span class="comment">//根组件，最底下的底地基</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//这是引入路由，router.js导入router组件，main与router是同级目录所以一个点</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router/router.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//从./view/LoginView.vue导入loginview组件</span></span><br><span class="line"><span class="comment">//import LoginView from &quot;./view/LoginView.vue&quot;;引入路由后这个就不要了，后面的页面根据地址决定渲染哪个</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>).<span class="title function_">use</span>(router).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)变成这样</span><br></pre></td></tr></table></figure>

<p>再打开app.vue，这个是网页的基层，可以把其他的都删除，只留下template标签（html）代码，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;!--渲染路由地址所对应的页面组件--&gt;</span><br><span class="line">&lt;!--  你访问/，那么此次就渲染显示LoginView.vue页面--&gt;</span><br><span class="line">&lt;!--  访问/dashboard，那么此次就渲染显示DashboardView.vue页面--&gt;</span><br><span class="line">  &lt;router-view/&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h1 id="驾驶舱页面整体布局"><a href="#驾驶舱页面整体布局" class="headerlink" title="驾驶舱页面整体布局"></a>驾驶舱页面整体布局</h1><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250622191202952.png" alt="image-20250622191202952"></p>
<p>想实现这样的布局需要找到form表单的Container 布局容器，找到下面这个，然后复制代码</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250622191335357.png" alt="image-20250622191335357"></p>
<p>然后左侧的布局是黑色，右边的中间是白色，上下都有颜色，然后在css样式里加上颜色代码，然后把缩放搞一下，高度固定一下，底部的文本需要左右上下居中。上下居中可以用行高，<strong>行高与下面的高度保持一致比如就是35就可以实现，是个小技巧</strong>，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-container&gt;</span><br><span class="line">    &lt;!--左侧--&gt;</span><br><span class="line">    &lt;el-aside width=&quot;200px&quot;&gt;Aside&lt;/el-aside&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--右侧--&gt;</span><br><span class="line">    &lt;el-container class=&quot;rightContent&quot;&gt;</span><br><span class="line">      &lt;!-- 右侧：上--&gt;</span><br><span class="line">      &lt;el-header&gt;Header&lt;/el-header&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--右侧：中--&gt;</span><br><span class="line">      &lt;el-main&gt;Main&lt;/el-main&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--右侧：下--&gt;</span><br><span class="line">      &lt;el-footer&gt;@版权所有 2009-2099 动力节点 北京市通州区马驹桥镇景盛中街17号顺景总部公元B4栋&lt;/el-footer&gt;</span><br><span class="line">    &lt;/el-container&gt;</span><br><span class="line">  &lt;/el-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;DashboardView&quot;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.el-aside&#123;</span><br><span class="line">  background: #1a1a1a;</span><br><span class="line">&#125;</span><br><span class="line">.el-header&#123;</span><br><span class="line">  background: azure;</span><br><span class="line">  height: 35px;//固定高度</span><br><span class="line">&#125;</span><br><span class="line">.el-footer&#123;</span><br><span class="line">  background: aliceblue;</span><br><span class="line">  height: 35px;</span><br><span class="line">  line-height: 35px;//上下保持</span><br><span class="line">  text-align: center;//左右居中</span><br><span class="line">&#125;</span><br><span class="line">.rightContent&#123;</span><br><span class="line">  height: calc(100vh);//缩放</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="然后就是制作左侧的菜单"><a href="#然后就是制作左侧的菜单" class="headerlink" title="然后就是制作左侧的菜单"></a>然后就是制作左侧的菜单</h2><p>找到navigation导航里的menu菜单，然后找到需要的测栏，左边是默认颜色右边是自定义颜色，复制代码进去，然后根据页面留下自己需要的代码，页面是二级菜单，加好之后需要加图标来对齐，在form表单里找到icon图标，使用图标也需要安装图片库</p>
<p>1、安装图标，还是那个文件夹安装这些</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @element-plus/icons-vue --save</span><br></pre></td></tr></table></figure>

<p>2、注册所有图标，在main.js中注册：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">ElementPlusIconsVue</span> <span class="keyword">from</span> <span class="string">&#x27;@element-plus/icons-vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [key, component] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(<span class="title class_">ElementPlusIconsVue</span>)) &#123;</span><br><span class="line"> app.<span class="title function_">component</span>(key, component)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">效果：</span><br><span class="line"><span class="comment">// 把图标库的整体导入</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">ElementPlusIconsVue</span> <span class="keyword">from</span> <span class="string">&#x27;@element-plus/icons-vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// for循环图标注册，需要app组件，但是下面的createApp(App)这样不太好继续写，就拿到上面用个变量接收app，下面再继续使用app</span></span><br><span class="line"><span class="keyword">let</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [key, component] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(<span class="title class_">ElementPlusIconsVue</span>)) &#123;</span><br><span class="line">    app.<span class="title function_">component</span>(key, component)<span class="comment">//注册组件</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用上面所导入的createApp（）函数，创建一个vue应用，mount是挂载到#app地方</span></span><br><span class="line"><span class="comment">// 使用一下，挂载是最后一步</span></span><br><span class="line"><span class="comment">// createApp(App).use(ElementPlus).mount(&#x27;#app&#x27;)</span></span><br><span class="line"><span class="comment">// createApp(App).use(ElementPlus).use(router).mount(&#x27;#app&#x27;)</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>).<span class="title function_">use</span>(router).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、使用图标，复制图标的代码，粘贴到项目中即可；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-icon&gt;&lt;Plus /&gt;&lt;/el-icon&gt;</span><br><span class="line"></span><br><span class="line">&lt;el-icon&gt;&lt;Minus /&gt;&lt;/el-icon&gt;</span><br><span class="line"></span><br><span class="line">&lt;el-icon&gt;&lt;CirclePlus /&gt;&lt;/el-icon&gt;</span><br></pre></td></tr></table></figure>

<p>Vue中：</p>
<p>$refs 拿到页面上ref属性的那个dom元素；</p>
<p>$router vue路由对象，里面提供了一些方法供什么使用；</p>
<p>然后再加上标题：动力云客系统，侧栏背景颜色改一下，然后标题的框和下面按钮的框实际是有1px的差别，按f12然后右击这两个地方选检查，就会显示大小，然后右击这个按钮，向上找到ui标签，在右侧有个.el-menu的标签，里面的border-right-&gt;solid 1px就是罪魁祸首，要在代码里修改这个为0px，也就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-menu</span><br><span class="line">    style=&quot;border-right: solid 1px&quot;</span><br></pre></td></tr></table></figure>



<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250624022656635.png" alt="image-20250624022656635"></p>
<p>然后想保持左侧菜单只保持一个子菜单的展开，就找到menu菜单，往下翻到菜单api，里面就有个unique-opened</p>
<p>添加后的代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-container&gt;</span><br><span class="line">    &lt;!--左侧--&gt;</span><br><span class="line">    &lt;el-aside width=&quot;200px&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;menuTitle&quot;&gt;动力云客管理系统&lt;/div&gt; &lt;!--标题--&gt;</span><br><span class="line">      &lt;!--style=&quot;border-right: solid 0px&quot;是左侧边框1像素偏差修正代码</span><br><span class="line">          unique-opened=&quot;true&quot;只保持一个子菜单的展开</span><br><span class="line">          @open=&quot;handleOpen&quot;</span><br><span class="line">          @close=&quot;handleClose&quot;这两个用不到就删掉了</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-menu</span><br><span class="line">          active-text-color=&quot;#ffd04b&quot;</span><br><span class="line">          background-color=&quot;#334157&quot;</span><br><span class="line">          class=&quot;el-menu-vertical-demo&quot;</span><br><span class="line">          default-active=&quot;2&quot;</span><br><span class="line">          text-color=&quot;#fff&quot;</span><br><span class="line">          style=&quot;border-right: solid 0px&quot;</span><br><span class="line">          unique-opened=&quot;true&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--市场活动菜单--&gt;</span><br><span class="line">        &lt;el-sub-menu index=&quot;1&quot;&gt;&lt;!--如果index都是1，就是同时展开，需要更改--&gt;</span><br><span class="line">          &lt;template #title&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;OfficeBuilding /&gt;&lt;/el-icon&gt;&lt;!--图标--&gt;</span><br><span class="line">            &lt;span&gt;市场活动&lt;/span&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">            &lt;el-menu-item index=&quot;1-1&quot;&gt;</span><br><span class="line">              &lt;el-icon&gt;&lt;Notification /&gt;&lt;/el-icon&gt;&lt;!--图标--&gt;</span><br><span class="line">              市场活动</span><br><span class="line">            &lt;/el-menu-item&gt;</span><br><span class="line">            &lt;el-menu-item index=&quot;1-2&quot;&gt;</span><br><span class="line">              &lt;el-icon&gt;&lt;DataAnalysis /&gt;&lt;/el-icon&gt;</span><br><span class="line">              市场统计</span><br><span class="line">            &lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-sub-menu&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--线索管理菜单--&gt;</span><br><span class="line">        &lt;el-sub-menu index=&quot;2&quot;&gt;</span><br><span class="line">          &lt;template #title&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;Operation /&gt;&lt;/el-icon&gt;</span><br><span class="line">            &lt;span&gt;线索管理&lt;/span&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;1-1&quot;&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;Film /&gt;&lt;/el-icon&gt;</span><br><span class="line">            线索管理</span><br><span class="line">          &lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-sub-menu&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--客户管理菜单--&gt;</span><br><span class="line">        &lt;el-sub-menu index=&quot;3&quot;&gt;</span><br><span class="line">          &lt;template #title&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;User /&gt;&lt;/el-icon&gt;</span><br><span class="line">            &lt;span&gt;客户管理&lt;/span&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;1-1&quot;&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;CreditCard /&gt;&lt;/el-icon&gt;</span><br><span class="line">            客户管理</span><br><span class="line">          &lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-sub-menu&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--交易管理菜单--&gt;</span><br><span class="line">        &lt;el-sub-menu index=&quot;4&quot;&gt;</span><br><span class="line">          &lt;template #title&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;CreditCard /&gt;&lt;/el-icon&gt;</span><br><span class="line">            &lt;span&gt;交易管理&lt;/span&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;1-1&quot;&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;User /&gt;&lt;/el-icon&gt;</span><br><span class="line">            交易管理</span><br><span class="line">          &lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-sub-menu&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--产品管理菜单--&gt;</span><br><span class="line">        &lt;el-sub-menu index=&quot;5&quot;&gt;</span><br><span class="line">          &lt;template #title&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;Memo /&gt;&lt;/el-icon&gt;</span><br><span class="line">            &lt;span&gt;产品管理&lt;/span&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;1-1&quot;&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;User /&gt;&lt;/el-icon&gt;</span><br><span class="line">            产品管理</span><br><span class="line">          &lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-sub-menu&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--字典管理菜单--&gt;</span><br><span class="line">        &lt;el-sub-menu index=&quot;6&quot;&gt;</span><br><span class="line">          &lt;template #title&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;Grid /&gt;&lt;/el-icon&gt;</span><br><span class="line">            &lt;span&gt;字典管理&lt;/span&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;1-1&quot;&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;User /&gt;&lt;/el-icon&gt;</span><br><span class="line">            字典管理</span><br><span class="line">          &lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-sub-menu&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--用户管理菜单--&gt;</span><br><span class="line">        &lt;el-sub-menu index=&quot;7&quot;&gt;</span><br><span class="line">          &lt;template #title&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;UserFilled /&gt;&lt;/el-icon&gt;</span><br><span class="line">            &lt;span&gt;用户管理&lt;/span&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;1-1&quot;&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;User /&gt;&lt;/el-icon&gt;</span><br><span class="line">            用户管理</span><br><span class="line">          &lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-sub-menu&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--系统管理菜单--&gt;</span><br><span class="line">        &lt;el-sub-menu index=&quot;8&quot;&gt;</span><br><span class="line">          &lt;template #title&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;Tools /&gt;&lt;/el-icon&gt;</span><br><span class="line">            &lt;span&gt;系统管理&lt;/span&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;1-1&quot;&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;User /&gt;&lt;/el-icon&gt;</span><br><span class="line">            系统管理</span><br><span class="line">          &lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-sub-menu&gt;</span><br><span class="line"></span><br><span class="line">      &lt;/el-menu&gt;</span><br><span class="line">    &lt;/el-aside&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--右侧--&gt;</span><br><span class="line">    &lt;el-container class=&quot;rightContent&quot;&gt;</span><br><span class="line">      &lt;!-- 右侧：上--&gt;</span><br><span class="line">      &lt;el-header&gt;Header&lt;/el-header&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--右侧：中--&gt;</span><br><span class="line">      &lt;el-main&gt;Main&lt;/el-main&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--右侧：下--&gt;</span><br><span class="line">      &lt;el-footer&gt;@版权所有 2009-2099 动力节点 北京市通州区马驹桥镇景盛中街17号顺景总部公元B4栋&lt;/el-footer&gt;</span><br><span class="line">    &lt;/el-container&gt;</span><br><span class="line">  &lt;/el-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;CreditCard, DataAnalysis&#125; from &quot;@element-plus/icons-vue&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;DashboardView&quot;,</span><br><span class="line">  components: &#123;CreditCard, DataAnalysis&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.el-aside&#123;</span><br><span class="line">  background: #1a1a1a;</span><br><span class="line">&#125;</span><br><span class="line">.el-header&#123;</span><br><span class="line">  background: azure;</span><br><span class="line">  height: 35px;/*固定高度*/</span><br><span class="line">&#125;</span><br><span class="line">.el-footer&#123;</span><br><span class="line">  background: aliceblue;</span><br><span class="line">  height: 35px;</span><br><span class="line">  line-height: 35px;/*上下保持，和高度一样，这个是小技巧*/</span><br><span class="line">  text-align: center;/*左右居中*/</span><br><span class="line">&#125;</span><br><span class="line">.rightContent&#123;</span><br><span class="line">  height: calc(100vh);/*缩放*/</span><br><span class="line">&#125;</span><br><span class="line">.menuTitle&#123;</span><br><span class="line">  height: 35px;</span><br><span class="line">  line-height: 35px;</span><br><span class="line">  text-align: center;</span><br><span class="line">  color:#f9f9f9;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="右侧菜单"><a href="#右侧菜单" class="headerlink" title="右侧菜单"></a>右侧菜单</h2><h3 id="上部分"><a href="#上部分" class="headerlink" title="上部分"></a>上部分</h3><p>接着还想要侧边栏的折叠效果，先弄个图标，弄完后也要上下对齐，在.el-header里加上line-height：35px，接着需要光标放在图标上变成手的样子，加个样式show，再加个效果@click&#x3D;showMenu，然后在js里写代码，在menu菜单的menu attributes里也有个collapse是水平折叠收起菜单，默认是false就是展开，所以这个需要变成一个变量去开关。点击是就调用showMenu函数，调用showMenu函数时就把isCollapse改一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">     &lt;el-menu</span><br><span class="line">          :collapse=&quot;isCollapse&quot;</span><br><span class="line"></span><br><span class="line">&lt;!--右侧--&gt;</span><br><span class="line">    &lt;el-container class=&quot;rightContent&quot;&gt;</span><br><span class="line">      &lt;!-- 右侧：上--&gt;</span><br><span class="line">      &lt;el-header&gt;</span><br><span class="line">       &lt;el-icon class=&quot;show&quot; @click=&quot;showMenu&quot;&gt;&lt;Fold/&gt;&lt;/el-icon&gt;</span><br><span class="line">      &lt;/el-header&gt;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;CreditCard, DataAnalysis&#125; from &quot;@element-plus/icons-vue&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  // 定义组件名</span><br><span class="line">  name: &quot;DashboardView&quot;,</span><br><span class="line">  components: &#123;CreditCard, DataAnalysis&#125;,</span><br><span class="line"></span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      //控制左侧菜单左右的展开和折叠，true是折叠，false是展开</span><br><span class="line">      isCollapse : false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods : &#123;</span><br><span class="line">    //点击是就调用showMenu函数，调用showMenu函数时就把isCollapse改一下</span><br><span class="line">    // 左侧菜单左右展开和折叠</span><br><span class="line">    showMenu()&#123;</span><br><span class="line">      //取相反结果</span><br><span class="line">      this.isCollapse = !this.isCollapse;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.el-header&#123;</span><br><span class="line">  background: azure;</span><br><span class="line">  height: 35px;/*固定高度*/</span><br><span class="line">  line-height: 35px;</span><br><span class="line">&#125;</span><br><span class="line">.show&#123;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>然后就需要控制背景，看到这个图标的大小只有64px，所以就是缩小到这个就可以，就需要修改代码，在width前面加个冒号的意思是动态变量，然后点击按钮发现有点卡，是因为动画的缘故，需要把动画关掉，在menu菜单有个collapse-transition是否开启折叠动画给关掉就好</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250624030221877.png" alt="image-20250624030221877"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-menu</span><br><span class="line">	:collapse-transition=&quot;false    </span><br><span class="line"></span><br><span class="line">&lt;!--左侧--&gt;</span><br><span class="line">    &lt;el-aside :width=&quot;isCollapse ? &#x27;64px&#x27; : &#x27;200px&#x27;&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;menuTitle&quot;&gt;动力云客管理系统&lt;/div&gt; &lt;!--标题--&gt;</span><br></pre></td></tr></table></figure>

<p>然后右边还想做个显示用户名字的功能，还有下拉菜单，然后在表单找到dropdown下拉菜单复制代码，刚开始是在左边的，需要调整样式往右边，上下居中用行高来调整，并且在退出登录的上面有个横杠，这个是在5或者6才会有，所以保留。但要把每个用户的名字都放在那里就需要用到生命周期中的一个函数钩子，在doGet请求里，把调用的axios保留，.then结果放到loadLoginUser里，也就是doGet(“&#x2F;api&#x2F;login&#x2F;info”, {})这段代码相当于axios的那段，然后把axios return一下。然后对doGet按alt+回车引入js。然后.then(function (rep){改为箭头函数，不写方程式，否则到时用不了this，返回结果暂时不知道弄什么，先把控制台打印一下</p>
<p>弹幕：这个项目到后面引入了token后，就改成用户登录后只返回token字符串了给前端了，这时想要获取用户名就必须要发请求查询了，老师这样写是考虑到了后面的改动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">      &lt;!-- 右侧：上--&gt;</span><br><span class="line">      &lt;el-header&gt;</span><br><span class="line">       &lt;el-icon class=&quot;show&quot; @click=&quot;showMenu&quot;&gt;&lt;Fold/&gt;&lt;/el-icon&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-dropdown&gt;</span><br><span class="line">          &lt;span class=&quot;el-dropdown-link&quot;&gt;</span><br><span class="line">            用户</span><br><span class="line">            &lt;el-icon class=&quot;el-icon--right&quot;&gt;</span><br><span class="line">              &lt;arrow-down /&gt;</span><br><span class="line">            &lt;/el-icon&gt;</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">          &lt;template #dropdown&gt;</span><br><span class="line">            &lt;el-dropdown-menu&gt;</span><br><span class="line">              &lt;el-dropdown-item&gt;我的资料&lt;/el-dropdown-item&gt;</span><br><span class="line">              &lt;el-dropdown-item&gt;修改密码&lt;/el-dropdown-item&gt;</span><br><span class="line">              &lt;el-dropdown-item divided&gt;退出登录&lt;/el-dropdown-item&gt;</span><br><span class="line">            &lt;/el-dropdown-menu&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/el-dropdown&gt;</span><br><span class="line">      &lt;/el-header&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;CreditCard, DataAnalysis&#125; from &quot;@element-plus/icons-vue&quot;;</span><br><span class="line">import &#123;doGet&#125; from &quot;../http/httpRequest.js&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  // 定义组件名</span><br><span class="line">  name: &quot;DashboardView&quot;,</span><br><span class="line">  components: &#123;CreditCard, DataAnalysis&#125;,</span><br><span class="line"></span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      //控制左侧菜单左右的展开和折叠，true是折叠，false是展开</span><br><span class="line">      isCollapse : false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  //vue的生命周期中的一个函数钩子，该钩子是在页面渲染后执行，页面一渲染就会执行下面的方法</span><br><span class="line">  mounted()&#123;</span><br><span class="line">    //加载当前登录用户</span><br><span class="line">    this.loadLoginUser();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods : &#123;</span><br><span class="line">    //点击是就调用showMenu函数，调用showMenu函数时就把isCollapse改一下</span><br><span class="line">    // 左侧菜单左右展开和折叠</span><br><span class="line">    showMenu()&#123;</span><br><span class="line">      //取相反结果</span><br><span class="line">      this.isCollapse = !this.isCollapse;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    //加载当前登录用户</span><br><span class="line">    loadLoginUser()&#123;</span><br><span class="line">      //读请求，传接口和参数，参数为空，doGet(&quot;/api/login/info&quot;, &#123;&#125;)这段代码相当于axios的那段，然后把axios里的.then拿了过来</span><br><span class="line">      //.then(function (rep)&#123;改为箭头函数，不写方程式，否则到时用不了this</span><br><span class="line">      doGet(&quot;/api/login/info&quot;, &#123;&#125;).then( (resp) =&gt; &#123;</span><br><span class="line">        //返回结果暂时不知道弄什么，先把控制台打印一下</span><br><span class="line">        console.log(resp)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">.el-dropdown&#123;</span><br><span class="line">  float: right;</span><br><span class="line">  line-height: 35px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>httpRequest.js改动</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">doGet</span>(<span class="params">url, params</span>)  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">axios</span>(&#123;<span class="comment">//如果有黄色波浪线就alt+enter导入</span></span><br><span class="line">        <span class="comment">//方法可以写死</span></span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">        <span class="comment">//下面两个都不要写死</span></span><br><span class="line">        <span class="attr">url</span>: url,</span><br><span class="line">        <span class="attr">params</span>: params,<span class="comment">//传入的格式是这样&#123;name: &quot;对的&quot;, age:22&#125;,</span></span><br><span class="line">        <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前面的包含了：</p>
<p>前后端登录的调试:</p>
<p>1、vue前端通过axios提交loginAct、loginPwd参数；</p>
<p>2、后端UsernamePasswordAuthenticationFilter接收；</p>
<p>3、调用UserDetailsService的实现方法loadUserByUsername(String username)查询数据库；</p>
<p>4、返回UserDetails对象给Spring Security框架进行密码比较，比较通过，登录成功；</p>
<p>5、登录成功回调登录成功的handler，登录失败回调登录失败的handler；</p>
<p>6、前端获取后端返回的json结果：</p>
<p>结果response对象包含6个字段：</p>
<p>（1）config</p>
<p>（2）data 这个里面才是后端返回的数据，所以我们取该字段就行了；</p>
<p>（3）headers</p>
<p>（4）request</p>
<p>（5）status</p>
<p>（6）statusText</p>
<p>Spring Security的跨域解决；</p>
<p>&#x2F;api&#x2F;login 地址，该地址没有controller，是spring security框架提供的，所以需要从spring security中解决跨域问题；</p>
<p>密码加密：</p>
<p>bcrypt加密，是目前最安全的加密方式，不容易被破解;</p>
<p>MD5加密，安全性比bcrypt差一些，更容易被破解；</p>
<p>管理面板主页面：DashboardView.vue</p>
<h3 id="获取用户的后端接口"><a href="#获取用户的后端接口" class="headerlink" title="获取用户的后端接口"></a>获取用户的后端接口</h3><p>在后端的web里新建UserController获取登录信息，写完后去测测接口能不能跑通，先get接口发现需要登录，就运行一下post登录再运行get，渲染页面就会执行js的方法，然后返回结果，在控制台查看返回的结果，因为前后端分离没有session机制，不能使用session，先登录，然后双击data看到返回了结果。我们要把session用jwt去代替，用于保持登录状态，否则会一直提示未登录</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250627201404692.png" alt="image-20250627201404692"></p>
<h4 id="前后端分离登录状态保持："><a href="#前后端分离登录状态保持：" class="headerlink" title="前后端分离登录状态保持："></a>前后端分离登录状态保持：</h4><p>前后端分离的项目一般会使用token（jwt）实现登录状态的保持；（java web ： session）<br> token其实就是一个随机字符串（字符串要求是唯一的，不同人的token都不能相同），当用户在登录页面输入账号和密码后，前端将账号密码发送给后端，后端检验完账号和密码后，会生成一个随机不重复的字符串即（token）,并将其响应给前端，前端拿到token后，需要在客户端进行持久化存储（一般会写在<strong>localStorage</strong>或者<strong>sessionStorage</strong>中），那么下次在向后端数据接口发送请求的时候，一般需要将token一并发送给后端数据接口，后端数据接口会对token进行校验，如果合法则正常响应请求，如果不合法，则提示未登录。</p>
<h4 id="sessionStorage与localStorage"><a href="#sessionStorage与localStorage" class="headerlink" title="sessionStorage与localStorage"></a>sessionStorage与localStorage</h4><p>它们是javascript对象，浏览器支持这两个对象，可以直接使用；</p>
<p>localStorage和sessionStorage都是用来在浏览器客户端存储临时信息的对象；</p>
<p>sessionStorage、localStorage区别？</p>
<p>sessionStorage只在一个浏览器页面有效，比如你打开一个新的tab浏览器页会失效，你关闭浏览器后，再打开浏览器也会失效；</p>
<p>localStorage在整个浏览器中都有效，重启浏览器也有效；除非你手动删除了localStorage，才会失效；</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250628184803826.png" alt="image-20250628184803826"></p>
<p>通过这里可以知道还需要一个记住我的登录参数，就需要在LoginView里再添加一下remeberMe参数，在login里添加完后就是把这三个参数传给后台，后台在springSecurity中接受参数，但这里面的UsernamePasswordAuthenticationFilter只能接收到用户名和密码，是否记住我接收不到，接收到后调用service，然后调mapper，再调数据库，查询到后返回结果，构建UserDetails返回给springSecurity，然后就是图里第七个事情，出发hander，生成jwt然后写入redis，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">     &lt;el-form-item&gt;</span><br><span class="line">          &lt;!--&lt;el-checkbox label=&quot;记住我&quot; name=&quot;remeberMe&quot; /&gt;--&gt;</span><br><span class="line">          &lt;!--user在data里已经定义过，vmodel是双向绑定--&gt;</span><br><span class="line">          &lt;el-checkbox label=&quot;记住我&quot; v-model=&quot;user.remeberMe&quot; /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">methods: &#123;</span><br><span class="line">    // 登录函数</span><br><span class="line">    login()&#123;</span><br><span class="line">          //loginact是键，后面的是值，这样就把值赋给了formData</span><br><span class="line">          formData.append(&quot;loginAct&quot;, this.user.loginAct);</span><br><span class="line">          formData.append(&quot;loginPwd&quot;, this.user.loginPwd);</span><br><span class="line">          formData.append(&quot;remeberMe&quot;, this.user.remeberMe);</span><br></pre></td></tr></table></figure>

<p>接下来是添加生成jwt和写入redis代码，再把jwtUtils工具类复制进util文件，出现auth0红色错误就需要加入jwt依赖，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 2023年10月最新版 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在MyAuthenticationSuccessHandler添加代码，在写入redis后要设置过期时间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Resource</span></span><br><span class="line">   <span class="keyword">private</span> RedisService redisService;<span class="comment">//注入RedisService接口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">       <span class="comment">//登录成功，执行该方法，在该方法中返回json给前端，就行了</span></span><br><span class="line">       <span class="type">TUser</span> <span class="variable">tUser</span> <span class="operator">=</span> (TUser) authentication.getPrincipal();<span class="comment">//通过authentication可以拿到登录用户</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//1,生成jwt，用工具类创建jwt</span></span><br><span class="line">       <span class="comment">// 把tUser对象转成json作为负载数据放入jwt</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">userJSON</span> <span class="operator">=</span> JSONUtils.toJSON(tUser);</span><br><span class="line">       <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> JWTUtils.createJWT(userJSON);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//2、写入redis，需要一个redis接口</span></span><br><span class="line">       redisService.setValue(Constant.REDIS_JWT_KEY + tUser.getId(),jwt);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.设置jwt的过期时间，也就是redis里的key设置（如果选择了记住我，过期时间是7天，否则是30分钟</span></span><br><span class="line">       <span class="comment">// 传过来的参数是remeberMe，所以用request拿一下</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">remeberMe</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;remeberMe&quot;</span>);</span><br><span class="line">       <span class="comment">//字符串要做转型，用if转，如果是true就设置7天，所以要在service里写个设置7天的方法</span></span><br><span class="line">       <span class="keyword">if</span> (Boolean.parseBoolean(remeberMe))&#123;</span><br><span class="line">           <span class="comment">// key是REDIS_JWT_KEY + tUser.getId()，过期时间7天，单位是秒，否则是30分钟</span></span><br><span class="line">           redisService.expire(Constants.REDIS_JWT_KEY + tUser.getId(), Constants.EXPIRE_TIME, TimeUnit.SECONDS);</span><br><span class="line">       &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">           redisService.expire(Constants.REDIS_JWT_KEY + tUser.getId(), Constants.DEFAULT_EXPIRE_TIME, TimeUnit.SECONDS);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//登录成功的统一结果，登陆成功把用户信息返回给前台</span></span><br><span class="line">       <span class="comment">//R result = R.OK(tUser); 之前是tUser现在不行了，要返回jwt</span></span><br><span class="line">       <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> R.OK(jwt);</span><br></pre></td></tr></table></figure>

<p>然后redis接口从别的地方复制过来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RedisService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//放数据</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(String key, Object value)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取数据</span></span><br><span class="line">    Object <span class="title function_">getValue</span><span class="params">(String key)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删数据</span></span><br><span class="line">    Boolean <span class="title function_">removeValue</span><span class="params">(String key)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//给某个key设置过期时间，然后把过期时间和时间单位传过去</span></span><br><span class="line">    Boolean <span class="title function_">expire</span><span class="params">(String key, Long timeOut, TimeUnit timeUnit)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">RedisService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getValue</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">removeValue</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">expire</span><span class="params">(String key, Long timeOut, TimeUnit timeUnit)</span> &#123;</span><br><span class="line">        <span class="comment">// 调用redisTemplate的expire</span></span><br><span class="line">        <span class="keyword">return</span> redisTemplate.expire(key, timeOut, timeUnit);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后定义Constant常量，把constant文件夹拷贝过来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Constants</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LOGIN_URI</span> <span class="operator">=</span> <span class="string">&quot;/api/login&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//redis的key的命名规范： 项目名:模块名:功能名:唯一业务参数(比如用户id)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REDIS_JWT_KEY</span> <span class="operator">=</span> <span class="string">&quot;dlyk:user:login:&quot;</span>;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">//jwt过期时间7天，单位是秒</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Long</span> <span class="variable">EXPIRE_TIME</span> <span class="operator">=</span> <span class="number">7</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60L</span>;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//jwt过期时间30分钟</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Long</span> <span class="variable">DEFAULT_EXPIRE_TIME</span> <span class="operator">=</span> <span class="number">30</span> * <span class="number">60L</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>LoginView:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">        &lt;el-form-item&gt;</span><br><span class="line">          &lt;!--&lt;el-checkbox label=&quot;记住我&quot; name=&quot;remeberMe&quot; /&gt;--&gt;</span><br><span class="line">          &lt;!--user在data里已经定义过，vmodel是双向绑定--&gt;</span><br><span class="line">          &lt;el-checkbox label=&quot;记住我&quot; v-model=&quot;user.remeberMe&quot; /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">//loginact是键，后面的是值，这样就把值赋给了formData</span><br><span class="line">          formData.append(&quot;loginAct&quot;, this.user.loginAct);</span><br><span class="line">          formData.append(&quot;loginPwd&quot;, this.user.loginPwd);</span><br><span class="line">          formData.append(&quot;remeberMe&quot;, this.user.remeberMe);</span><br><span class="line"></span><br><span class="line">//调用httpRequest里的方法，then是需要的结果，也就需要return回来结果，因为结果不固定所以放到这里写，这个箭头的写法类似于Lambda表达式</span><br><span class="line">          doPost(&quot;/api/login&quot;,formData).then( (resp) =&gt; &#123;</span><br><span class="line">            console.log(resp);</span><br><span class="line">            //这里去对resp结果的data（一共六种）的code码是不是200，这里===是相对判断就必须是数字，这样假如是&quot;200&quot;，他就会判断不相等，==可能就判断相等了</span><br><span class="line">            if (resp.data.code === 200)&#123;</span><br><span class="line">                // 登陆成功，提示一下</span><br><span class="line">                messageTip(&quot;登陆成功&quot;, &quot;success&quot;);</span><br><span class="line">                // 前端存储jwt，如果选择了记住我就要存到local里</span><br><span class="line">              if( this.user.remeberMe === true)&#123;</span><br><span class="line">                //setItem用于存数据，dlyk token是名字，resp.data等同于R对象，因为resp里面有六个字段，data就是r对象，R对象里面有msg code和data，可以调用</span><br><span class="line">                window.localStorage.setItem(&quot;dlyk token&quot;, resp.data.data);</span><br><span class="line">              &#125;else&#123;</span><br><span class="line">                window.sessionStorage.setItem(&quot;dlyk token&quot;, resp.data.data)</span><br><span class="line">              &#125;</span><br></pre></td></tr></table></figure>

<p>然后打开页面，按f12看看控制台有没有错误，然后登录不勾选记住我，去application里有个local storage和session storage，里面有没有数据</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250630165104773.png" alt="image-20250630165104773"></p>
<p>然后勾选了记住我就会出现在local storage里，然后在代码里的login里加个alert(this.user.remeberMe)打印结果，把window.location.href &#x3D; “&#x2F;dashboard”;注释掉，让他先别跳转，然后刷新页面点登录，第一次是undefind，第二次勾选是true，第三次取消勾选是false，这个结果没有问题，只要没勾选的时候不是true就放session里，</p>
<h3 id="验证token"><a href="#验证token" class="headerlink" title="验证token"></a>验证token</h3><p>根据流程图可知，前后端分离需要用请求头携带token去验证，这时候可以用axios拦截器完成，这个拦截器的方法可以在axios-http.com里找到，但打开太慢就直接复制源代码。</p>
<p>httpRequest.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="comment">// 在发送请求之前做些什么，在请求头中放一个token（jwt），传给后端接口</span></span><br><span class="line">    <span class="keyword">let</span> token = <span class="variable language_">window</span>.<span class="property">sessionStorage</span>.<span class="title function_">getItem</span>(<span class="title function_">getTokenName</span>());<span class="comment">//获取token名字</span></span><br><span class="line">    <span class="keyword">if</span> (!token)&#123;<span class="comment">// 前面加了一个!，表示如果token不存在，token是空的没有值这个意思</span></span><br><span class="line">        token = <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="title function_">getTokenName</span>());<span class="comment">//从localStorage拿</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(token)&#123;<span class="comment">// 表示token存在，token有值的意思</span></span><br><span class="line">        <span class="comment">//通过config这个变量，给请求头一个名字，然后token赋值给头</span></span><br><span class="line">        config.<span class="property">headers</span>[<span class="string">&#x27;Authorization&#x27;</span>] = token;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="comment">// 这个是发生错误时对请求错误做些什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="comment">// 2xx 范围内的状态码都会触发该函数。</span></span><br><span class="line">    <span class="comment">// 对响应数据做点什么</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="comment">// 超出 2xx 范围的状态码都会触发该函数。</span></span><br><span class="line">    <span class="comment">// 对响应错误做点什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>写好请求头后就要写个filter去验证token，而这个filter最后要添加到Spring security里，还是复制代码到config的filter文件夹里，如果是登录请求，此时还没有生成jwt，那不需要对登录请求进行jwt验证，这里我们统一路径，把&#x2F;api&#x2F;login改成常量表达</p>
<p>在SecurityConfig修改代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public SecurityFilterChain securityFilterChain(HttpSecurity httpSecurity,CorsConfigurationSource configurationSource) throws Exception &#123;</span><br><span class="line">    //禁用跨站请求伪造</span><br><span class="line">    return httpSecurity</span><br><span class="line">                .formLogin( (formLogin) -&gt; &#123;</span><br><span class="line">                    formLogin.loginProcessingUrl(&quot;/api/login&quot;)//这是处理登录的登录地址，前端要往这里提交，不需要写Controller</span><br><span class="line">                    </span><br><span class="line">                    改为 formLogin.loginProcessingUrl(Constants.LOGIN_URI)</span><br></pre></td></tr></table></figure>

<p>codeEnum里添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TOKEN_IS_EMPTY(<span class="number">901</span>,<span class="string">&quot;请求Token参数为空&quot;</span>),</span><br><span class="line">TOKEN_IS_EXPIRED(<span class="number">902</span>,<span class="string">&quot;请求Token已过期&quot;</span>)</span><br><span class="line">TOKEN_IS_ERROR(<span class="number">903</span>,<span class="string">&quot;请求Token有误&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>R方法里新弄一个失败方法，参数是枚举，注意如果有了就不用了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">FAIL</span><span class="params">(CodeEnum codeEnum)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">            .code(codeEnum.getCode())</span><br><span class="line">            .msg(codeEnum.getMsg())</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TokenVerifyFilter.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenVerifyFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisService redisService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//spring boot框架的ioc容器中已经创建好了该线程池，可以注入直接使用</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ThreadPoolTaskExecutor threadPoolTaskExecutor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (request.getRequestURI().equals(Constants.LOGIN_URI)) &#123; <span class="comment">//如果是登录请求，此时还没有生成jwt，那不需要对登录请求进行jwt验证</span></span><br><span class="line">            <span class="comment">//验证jwt通过了 ，让Filter链继续执行，也就是继续执行下一个Filter</span></span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.hasText(token)) &#123;</span><br><span class="line">                <span class="comment">//token验证未通过的统一结果</span></span><br><span class="line">                <span class="comment">//R result = R.FAIL(&quot;请求Token参数为空&quot;);//请求token的文字部分用枚举包装</span></span><br><span class="line">                <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> R.FAIL(CodeEnum.TOKEN_IS_EMPTY);</span><br><span class="line">                <span class="comment">//把R对象转成json</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">resultJSON</span> <span class="operator">=</span> JSONUtils.toJSON(result);</span><br><span class="line">                <span class="comment">//把R以json返回给前端</span></span><br><span class="line">                ResponseUtils.write(response, resultJSON);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">				</span><br><span class="line">            <span class="comment">//从token中解析User</span></span><br><span class="line">            <span class="type">TUser</span> <span class="variable">tUser</span> <span class="operator">=</span> JWTUtils.parseUserFromJWT(token);</span><br><span class="line">            <span class="comment">//去redis里查</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">redisToken</span> <span class="operator">=</span> (String) redisService.getValue(Constants.REDIS_JWT_KEY + tUser.getId());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//如果Token里没有值</span></span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.hasText(redisToken)) &#123;</span><br><span class="line">                <span class="comment">//token验证未通过统一结果</span></span><br><span class="line">                <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> R.FAIL(CodeEnum.TOKEN_IS_EXPIRED);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//把R对象转成json</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">resultJSON</span> <span class="operator">=</span> JSONUtils.toJSON(result);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//把R以json返回给前端</span></span><br><span class="line">                ResponseUtils.write(response, resultJSON);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">               <span class="comment">//看token是否相同</span></span><br><span class="line">            <span class="keyword">if</span> (!token.equals(redisToken)) &#123;</span><br><span class="line">                <span class="comment">//token验证未通过的统一结果</span></span><br><span class="line">                <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> R.FAIL(CodeEnum.TOKEN_IS_ERROR);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//把R对象转成json</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">resultJSON</span> <span class="operator">=</span> JSONUtils.toJSON(result);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//把R以json返回给前端</span></span><br><span class="line">                ResponseUtils.write(response, resultJSON);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">             <span class="comment">//jwt验证通过了，那么在spring security的上下文环境中要设置一下，设置当前这个人是登录过的，你后续不要再拦截他了</span></span><br><span class="line">            <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(tUser, tUser.getLoginPwd(), tUser.getAuthorities());</span><br><span class="line">            SecurityContextHolder.getContext().setAuthentication(authenticationToken);</span><br><span class="line">            </span><br><span class="line">             <span class="comment">//验证jwt通过了 ，让Filter链继续执行，也就是继续执行下一个Filter</span></span><br><span class="line">            filterChain.doFilter(request, response);</span><br></pre></td></tr></table></figure>

<p>然后token失败返回前端的结果会被axios拦截一下，然后提示用户这个有问题，再跳转到登录页面，所以要在拦截器里做一个对结果的处理，当code大于900说明是token验证未通过，就需要给前端用户提示，并且跳转页面，提示的话不用之前的util的messageTip，换成可交互的提示，在form表单里找到MessageBox 消息弹框，找到<strong>确认消息</strong>，不过这个代码是用组合式的写，我们用选项式的，把触发的open事件里面的代码拷贝就行，复制进去后记得导入ElMessageBox</p>
<p>httpRequest.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="comment">// 2xx 范围内的状态码都会触发该函数。</span></span><br><span class="line">    <span class="comment">// 对响应数据做点什么，拦截token验证的结果，进行相应的提示和页面跳转</span></span><br><span class="line">    <span class="comment">// 上面的response就是相应结果，和vue里的resp是一样的，里面有六个字段（loginview里的）</span></span><br><span class="line">    <span class="keyword">if</span> (response.<span class="property">data</span>.<span class="property">code</span> &gt; <span class="number">900</span>) &#123;<span class="comment">//code大于900说明是token验证未通过，在常量里有设置的</span></span><br><span class="line">        <span class="comment">// 给前端用户提示，并且跳转页面，提示的话不用之前的util的messageTip，换成可交互的提示</span></span><br><span class="line">        <span class="title class_">ElMessageBox</span>.<span class="title function_">confirm</span>(</span><br><span class="line">            response.<span class="property">data</span>.<span class="property">msg</span> + <span class="string">&#x27;，是否重新去登录?&#x27;</span>,<span class="comment">//提示语，data.msg里有三个错误的返回信息，放在前面</span></span><br><span class="line">            <span class="string">&#x27;Warning&#x27;</span>,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">confirmButtonText</span>: <span class="string">&#x27;OK&#x27;</span>,</span><br><span class="line">                <span class="attr">cancelButtonText</span>: <span class="string">&#x27;Cancel&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        ).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;<span class="comment">//用户点击“确定”按钮就会触发then函数</span></span><br><span class="line">            <span class="comment">//跳到登录页</span></span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;/&quot;</span>;</span><br><span class="line">            &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;<span class="comment">// 用户点击“取消”按钮就会触发then函数</span></span><br><span class="line">                <span class="title function_">messageTip</span>(<span class="string">&quot;取消去登录&quot;</span>, <span class="string">&quot;warning&quot;</span>);<span class="comment">//messageTip是封装好的消息提示</span></span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="comment">// 超出 2xx 范围的状态码都会触发该函数。</span></span><br><span class="line">    <span class="comment">// 对响应错误做点什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="测试登录token的存储位置"><a href="#测试登录token的存储位置" class="headerlink" title="测试登录token的存储位置"></a>测试登录token的存储位置</h4><p>然后登录一下试试，点击记住我后登录。localStorage里存储了token，session里没有token，然后重新登录不点记住我，发现local和session里都有token，就需要清除</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250704172550124.png" alt="image-20250704172550124"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250704172601904.png" alt="image-20250704172601904"></p>
<p>思路是如果登陆成功，因为是重新登陆，就把之前的记录删一下，写个删除token工具类</p>
<p>util.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  删除localStorage和sessionStorage中存储的token</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">removeToken</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">sessionStorage</span>.<span class="title function_">removeItem</span>(<span class="title function_">getTokenName</span>());<span class="comment">//通过getTokenName获取名字</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">removeItem</span>(<span class="title function_">getTokenName</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LoginView.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (resp.data.code === 200)&#123;</span><br><span class="line">    // 登陆成功，提示一下</span><br><span class="line">    messageTip(&quot;登陆成功&quot;, &quot;success&quot;);</span><br><span class="line"></span><br><span class="line">    // 删除一下历史ocalStorage和sessionStorage中存储的token</span><br><span class="line">  removeToken();</span><br></pre></td></tr></table></figure>

<h4 id="测试拦截"><a href="#测试拦截" class="headerlink" title="测试拦截"></a>测试拦截</h4><p>dashboard这个页面会有个请求，就是mounted(){this.LoadLoginUser};.页面渲染时就会调这个方法，这个方法会发起请求获取当前登录用户，发送请求会先走filter进行拦截，之前已经写好了filter，现在要加到SecurityConfig里面去，而前后端分离也是没有session机制是失效的，需要用代码把这个session机制禁用一下</p>
<p>SecurityConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Resource</span><span class="comment">//把TokenVerifyFilter作为bean注入</span></span><br><span class="line">    <span class="keyword">private</span> TokenVerifyFilter tokenVerifyFilter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">                    .sessionManagement( (session) -&gt; &#123;</span><br><span class="line">                        <span class="comment">//session创建策略</span></span><br><span class="line">                        session.sessionCreationPolicy(SessionCreationPolicy.STATELESS); <span class="comment">// 无session状态，也就是禁用session</span></span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 添加自定义的Filter</span></span><br><span class="line">                    .addFilterBefore(tokenVerifyFilter, LogoutFilter.class)</span><br><span class="line"></span><br><span class="line">                    .build();<span class="comment">//链式编程</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>再次运行报错了，我们在验证之前加一个验证方法，把传入的token验证一下，如果返回的是false，下面的代码就不用走了</p>
<p>添加和修改代码</p>
<p>TokenVerifyFilter.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">         <span class="comment">//验证token有没有被篡改过</span></span><br><span class="line">         <span class="keyword">if</span> (!JWTUtils.verifyJWT(token)) &#123;</span><br><span class="line">             <span class="comment">//token验证未通过统一结果</span></span><br><span class="line">             <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> R.FAIL(CodeEnum.TOKEN_IS_ERROR);</span><br><span class="line"></span><br><span class="line">             <span class="comment">//把R对象转成json</span></span><br><span class="line">             <span class="type">String</span> <span class="variable">resultJSON</span> <span class="operator">=</span> JSONUtils.toJSON(result);</span><br><span class="line"></span><br><span class="line">             <span class="comment">//把R以json返回给前端</span></span><br><span class="line">             ResponseUtils.write(response, resultJSON);</span><br><span class="line"></span><br><span class="line">             <span class="keyword">return</span>;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改</span></span><br><span class="line"> <span class="comment">//看token(格式)是否相同</span></span><br><span class="line">         <span class="keyword">if</span> (!token.equals(redisToken)) &#123;</span><br><span class="line">             <span class="comment">//token验证未通过的统一结果</span></span><br><span class="line">             <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> R.FAIL(CodeEnum.TOKEN_IS_NONE_MATCH);</span><br><span class="line"></span><br><span class="line">             <span class="comment">//把R对象转成json</span></span><br><span class="line">             <span class="type">String</span> <span class="variable">resultJSON</span> <span class="operator">=</span> JSONUtils.toJSON(result);</span><br><span class="line"></span><br><span class="line">             <span class="comment">//把R以json返回给前端</span></span><br><span class="line">             ResponseUtils.write(response, resultJSON);</span><br><span class="line">             <span class="keyword">return</span>;</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure>

<p>CodeEnum.java添加和修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TOKEN_IS_EMPTY(<span class="number">901</span>,<span class="string">&quot;请求Token参数为空&quot;</span>),</span><br><span class="line">TOKEN_IS_ERROR(<span class="number">902</span>,<span class="string">&quot;请求Token有误&quot;</span>),</span><br><span class="line">TOKEN_IS_EXPIRED(<span class="number">903</span>,<span class="string">&quot;请求Token已过期&quot;</span>),</span><br><span class="line">TOKEN_IS_NONE_MATCH(<span class="number">904</span>,<span class="string">&quot;请求Token不匹配&quot;</span>),</span><br></pre></td></tr></table></figure>

<p>然后重新登陆修改token，会出现这个，点击ok就返回登录页面，点取消就停留在当前页面</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250706153506380.png" alt="image-20250706153506380"></p>
<p>再完善一下，如果token响应验证没有通过，就把前端的token删除一下</p>
<p>httpRequest.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line">    ).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;<span class="comment">//用户点击“确定”按钮就会触发then函数</span></span><br><span class="line">            <span class="comment">// 既然后端验证token未通过，那么前端的token肯定是有问题的，那没必要存储在浏览器中，直接删除一下</span></span><br><span class="line">            <span class="title function_">removeToken</span>();</span><br></pre></td></tr></table></figure>

<h3 id="免登录（自动登录）"><a href="#免登录（自动登录）" class="headerlink" title="免登录（自动登录）"></a>免登录（自动登录）</h3><p>不需要登录，就直接进入系统；</p>
<p><a href="http://localhost:8081/">http://localhost:8081/</a> 访问斜杆，那么渲染的是LoginView.vue，在该页面中判断是否要免登录？</p>
<p>如果要免登录，则渲染LoginView.vue这个页面的时候，就自动请求后端完成登录；</p>
<p>免登录的条件：上一次登录，用户选择了“记住我”，则在7天内自动给用户登录，也就是用户不需要输入账号和密码去登录；</p>
<p>图里的问号是判断的意思，如果token验证通过，就返回给Controller，然后返回200给前台</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250707185718752.png" alt="image-20250707185718752"></p>
<p>让loginview在渲染页面的时候就触发函数钩子，这时候进行判断，如果token没问题，一直到Controller直接返回200就可以，因为如果有问题就会在前面的验证时未通过，</p>
<h3 id="退出登录"><a href="#退出登录" class="headerlink" title="退出登录"></a>退出登录</h3><p>用户在系统中做完了相关操作了，不需要再使用系统，他可以选择退出登录；</p>
<p>1、把后端redis中的登录token删除；</p>
<p>2、把前端sessionStorage&#x2F;localStorage里面的登录token删除；</p>
<p>先设计显示用户名字信息，思路是打开控制台看打印的字段，先取response的data数据，然后里面有六个字段，取data，再取name</p>
<p>resp.data.data就是这些数据，传给this.user，这样user:{}就有值了，再用{ { user.name } }取name</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250710015936511.png" alt="image-20250710015936511"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">DashboardView.vue</span><br><span class="line">&lt;el-dropdown&gt;</span><br><span class="line">          &lt;span class=&quot;el-dropdown-link&quot;&gt;</span><br><span class="line">            &lt;!--使用vue差值表，user被下面的data赋值后取里面的name--&gt;</span><br><span class="line">            &#123;&#123; user.name &#125;&#125;</span><br><span class="line">              </span><br><span class="line">              </span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      //控制左侧菜单左右的展开和折叠，true是折叠，false是展开</span><br><span class="line">      isCollapse : false,</span><br><span class="line">      // 登录用户对象，初始值是空，被下面方法的user.name赋值</span><br><span class="line">      user : &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,         </span><br><span class="line">              </span><br><span class="line">    methods : &#123;            </span><br><span class="line">      //加载当前登录用户</span><br><span class="line">    loadLoginUser()&#123;</span><br><span class="line">      //读请求，传接口和参数，参数为空，doGet(&quot;/api/login/info&quot;, &#123;&#125;)这段代码相当于axios的那段，然后把axios里的.then拿了过来</span><br><span class="line">      //.then(function (rep)&#123;改为箭头函数，不写方程式，否则到时用不了this</span><br><span class="line">      doGet(&quot;/api/login/info&quot;, &#123;&#125;).then( (resp) =&gt; &#123;</span><br><span class="line">        //返回结果暂时不知道弄什么，先把控制台打印一下</span><br><span class="line">        console.log(resp)</span><br><span class="line">        this.user = resp.data.data;//把信息赋给user</span><br><span class="line">      &#125;)     </span><br></pre></td></tr></table></figure>

<p>然后给退出登录添加点击事件，logout后面的括号可以省略，没问题的话就会返回200，然后执行删除token方法，提示退出成功，如果不是200而是其他的，就提示是否强制退出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dropdown-item divided @click=&quot;logout&quot;&gt;退出登录&lt;/el-dropdown-item&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">methods : &#123;</span><br><span class="line">    <span class="comment">// 退出登录</span></span><br><span class="line">    <span class="title function_">logout</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/logout&quot;</span>, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line">              <span class="title function_">removeToken</span>();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>在写强制退出提示的时候对httpRequest.js的下面代码进行封装，放进util.js，而.then和.catch是具体的业务代码，要去实际业务中写，response.data.msg + ‘，是否重新去登录?’,这一段就变成传进来的变量，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (response.<span class="property">data</span>.<span class="property">code</span> &gt; <span class="number">900</span>) &#123;<span class="comment">//code大于900说明是token验证未通过，在常量里有设置的</span></span><br><span class="line">    <span class="comment">// 给前端用户提示，并且跳转页面，提示的话不用之前的util的messageTip，换成可交互的提示</span></span><br><span class="line">    <span class="title class_">ElMessageBox</span>.<span class="title function_">confirm</span>(</span><br><span class="line">        response.<span class="property">data</span>.<span class="property">msg</span> + <span class="string">&#x27;，是否重新去登录?&#x27;</span>,<span class="comment">//提示语，data.msg里有三个错误的返回信息，放在前面</span></span><br><span class="line">        <span class="string">&#x27;Warning&#x27;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">confirmButtonText</span>: <span class="string">&#x27;OK&#x27;</span>,</span><br><span class="line">            <span class="attr">cancelButtonText</span>: <span class="string">&#x27;Cancel&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    ).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;<span class="comment">//用户点击“确定”按钮就会触发then函数</span></span><br><span class="line">        <span class="comment">// 既然后端验证token未通过，那么前端的token肯定是有问题的，那没必要存储在浏览器中，直接删除一下</span></span><br><span class="line">        <span class="title function_">removeToken</span>();</span><br><span class="line">        <span class="comment">//跳到登录页</span></span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;/&quot;</span>;</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;<span class="comment">// 用户点击“取消”按钮就会触发then函数</span></span><br><span class="line">            <span class="title function_">messageTip</span>(<span class="string">&quot;取消去登录&quot;</span>, <span class="string">&quot;warning&quot;</span>);<span class="comment">//messageTip是封装好的消息提示</span></span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>util.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 确认消息提示</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise&lt;MessageBoxData&gt;</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">messageConfirm</span>(<span class="params">msg</span>)&#123;</span><br><span class="line">    <span class="comment">// 给前端用户提示，并且跳转页面，提示的话不用之前的util的messageTip，换成可交互的提示</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">ElMessageBox</span>.<span class="title function_">confirm</span>(</span><br><span class="line">       msg,<span class="comment">//提示语，data.msg里有三个错误的返回信息，放在前面</span></span><br><span class="line">        <span class="string">&#x27;Warning&#x27;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">confirmButtonText</span>: <span class="string">&#x27;OK&#x27;</span>,</span><br><span class="line">            <span class="attr">cancelButtonText</span>: <span class="string">&#x27;Cancel&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后httpRequset就变成了这个</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (response.<span class="property">data</span>.<span class="property">code</span> &gt; <span class="number">900</span>) &#123;<span class="comment">//code大于900说明是token验证未通过，在常量里有设置的</span></span><br><span class="line">       <span class="comment">// 给前端用户提示，并且跳转页面，提示的话不用之前的util的messageTip，换成可交互的提示</span></span><br><span class="line">      <span class="title function_">messageConfirm</span>(response.<span class="property">data</span>.<span class="property">msg</span> + <span class="string">&quot;，是否重新去登录？&quot;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;<span class="comment">//用户点击“确定”按钮就会触发then函数</span></span><br><span class="line">           <span class="comment">// 既然后端验证token未通过，那么前端的token肯定是有问题的，那没必要存储在浏览器中，直接删除一下</span></span><br><span class="line">           <span class="title function_">removeToken</span>();</span><br><span class="line">           <span class="comment">//跳到登录页</span></span><br><span class="line">           <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;/&quot;</span>;</span><br><span class="line">           &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;<span class="comment">// 用户点击“取消”按钮就会触发catch函数</span></span><br><span class="line">               <span class="title function_">messageTip</span>(<span class="string">&quot;取消去登录&quot;</span>, <span class="string">&quot;warning&quot;</span>);<span class="comment">//messageTip是封装好的消息提示</span></span><br><span class="line">           &#125;)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>然后把刚才封装的代码复制进去，在修改一下文字 </p>
<h4 id="退出登录后端"><a href="#退出登录后端" class="headerlink" title="退出登录后端"></a>退出登录后端</h4><p>不需要单独写Controller，是在securityConfig完成，然后里面的myLogoutSuccessHandler在之前handler里也写好了，注入进去就行</p>
<p>securityConfig,java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> MyLogoutSuccessHandler myLogoutSuccessHandler;  </span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity httpSecurity,CorsConfigurationSource configurationSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">              <span class="comment">// 退出登录</span></span><br><span class="line">                    .logout((logout) -&gt;&#123;</span><br><span class="line">                        logout.logoutUrl(<span class="string">&quot;/api/logout&quot;</span>) <span class="comment">//退出提交到该地址，该地址不需要我们写Controller的，是框架处理</span></span><br><span class="line">                                .logoutSuccessHandler(myLogoutSuccessHandler);<span class="comment">//退出成功触发这个handler，但是没有返回失败</span></span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                    .build();<span class="comment">//链式编程</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>然后看退出登录器MyLogoutSuccessHandler，退出成功后要删除redis中用户的jwt，要继续添加代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">**</span><br><span class="line"> * 退出成功处理器</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLogoutSuccessHandler</span> <span class="keyword">implements</span> <span class="title class_">LogoutSuccessHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisService redisService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLogoutSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">//退出成功，执行该方法，在该方法中返回json给前端，就行了</span></span><br><span class="line">        <span class="type">TUser</span> <span class="variable">tUser</span> <span class="operator">=</span> (TUser)authentication.getPrincipal();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//删除一下redis中用户的jwt</span></span><br><span class="line">        redisService.removeValue(Constants.REDIS_JWT_KEY + tUser.getId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//退出成功的统一结果</span></span><br><span class="line">        <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> R.OK(<span class="number">200</span>, <span class="string">&quot;退出成功&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把R对象转成json</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resultJSON</span> <span class="operator">=</span> JSONUtils.toJSON(result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把R以json返回给前端</span></span><br><span class="line">        ResponseUtils.write(response, resultJSON);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后上面的ok200觉得可以封装，就在codeEnum写 user_logout(),下面加一个CodeEnum方法，但是可以加一个@RequiredArgsConstructor注解，然后在private String msg;上加个@NonNull，这样就可以把CodeEnum方法省略不写了，自动生成一个构造器，可以在下图看到</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250713000835036.png" alt="image-20250713000835036"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">CodeEnum</span> &#123;</span><br><span class="line">        user_logout(<span class="string">&quot;退出成功&quot;</span>),</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    </span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">    上面加了@RequiredArgsConstructor和    @NonNull就可以不写这个</span></span><br><span class="line"><span class="comment">    CodeEnum(String msg)&#123;</span></span><br><span class="line"><span class="comment">        this.msg = msg;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br></pre></td></tr></table></figure>

<p>有了新枚举后在R对象里可以多提供几个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">OK</span><span class="params">(CodeEnum codeEnum)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">              .code(CodeEnum.OK.getCode())<span class="comment">//这是枚举里的code码</span></span><br><span class="line">              .msg(codeEnum.getMsg())<span class="comment">//这是传进来的CodeEnum的消息</span></span><br><span class="line">              .build();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>然后修改MyLogoutSuccessHandler里的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">      <span class="comment">//退出成功的统一结果</span></span><br><span class="line">      <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> R.OK(<span class="number">200</span>, <span class="string">&quot;退出成功&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//改为</span></span><br><span class="line">      <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> R.OK(CodeEnum.USER_LOGOUT);</span><br></pre></td></tr></table></figure>

<h3 id="token续期"><a href="#token续期" class="headerlink" title="token续期"></a>token续期</h3><p>选择了记住我，token有效期7天；</p>
<p>没有选择了记住我，token有效期30分钟；</p>
<p>在用户操作页面功能的过程中，要对token进行续期，也就是延长token失效时间；</p>
<p>就和java web的session，默认是30分钟；</p>
<p>5分钟我对页面不做任何，此时session的过期时间就变成了25分钟；</p>
<p>我现在过5分钟后点一下页面，此时要把session的过期时间再改成30分钟；</p>
<p><strong>然后token需要虚拟化，老师说的是之前redis的课程，后面再补吧</strong>，</p>
<p>主入口程序DlykServerApplication</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(basePackages = &#123;&quot;com.bjpowernode.mapper&quot;&#125;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DlykServerApplication</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DlykServerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//springboot项目启动后，把redisTemplate这个Bean修改一下，修改一下key和value的序列化方式</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置key序列化</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对象映射工具，Java对象 和 json对象进行相互转化</span></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        <span class="comment">//设置可见性</span></span><br><span class="line">        mapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        <span class="comment">//激活类型</span></span><br><span class="line">        mapper.activateDefaultTyping(mapper.getPolymorphicTypeValidator(), ObjectMapper.DefaultTyping.EVERYTHING);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置value序列化</span></span><br><span class="line">        redisTemplate.setValueSerializer(<span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>&lt;Object&gt;(mapper, Object.class));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置hashKey序列化</span></span><br><span class="line">        redisTemplate.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置haskValue序列化</span></span><br><span class="line">        redisTemplate.setHashValueSerializer(<span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>&lt;Object&gt;(mapper, Object.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>视频里的之前项目用的0号数据库，这里改成1号</p>
<p>application.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置redis的连接信息</span></span><br><span class="line">      <span class="attr">database:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>只要是操作页面，就会进入到filter执行一下，除非是登录，登录不执行，是放行，刷新token最好是异步处理（多线程），这样可以提高效率缩短执行时间，新建线程后，刷新token的代码从MyAuthenticationSuccessHandler里复制，类似设置jwt的过期时间，然后看用户有没有选择记住我，根据这个来判断时间</p>
<p>TokenVerifyFilter.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span>&#123;。。。</span><br><span class="line"><span class="comment">//刷新一下token（异步处理，new一个线程去执行）</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="comment">//刷新token，从请求头里拿rememberMe</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">rememberMe</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;rememberMe&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (Boolean.parseBoolean(rememberMe)) &#123;</span><br><span class="line">                    redisService.expire(Constants.REDIS_JWT_KEY + tUser.getId(), Constants.EXPIRE_TIME, TimeUnit.SECONDS);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    redisService.expire(Constants.REDIS_JWT_KEY + tUser.getId(), Constants.DEFAULT_EXPIRE_TIME, TimeUnit.SECONDS);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br></pre></td></tr></table></figure>

<p>而remember这个值怎么拿，就需要在请求头的拦截器里判断一下是否“记住我”，也就是local里面有没有值，有值就在头里放一个rememberme</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="comment">// 在发送请求之前做些什么，在请求头中放一个token（jwt），传给后端接口</span></span><br><span class="line">    <span class="keyword">let</span> token = <span class="variable language_">window</span>.<span class="property">sessionStorage</span>.<span class="title function_">getItem</span>(<span class="title function_">getTokenName</span>());<span class="comment">//获取token名字</span></span><br><span class="line">    <span class="keyword">if</span> (!token)&#123;<span class="comment">// 前面加了一个!，表示如果token不存在，token是空的没有值这个意思</span></span><br><span class="line">        token = <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="title function_">getTokenName</span>());<span class="comment">//session里没有值就从localStorage拿</span></span><br><span class="line">        <span class="keyword">if</span> (token) &#123;</span><br><span class="line">            <span class="comment">//如果local有值就说明选择了记住我，就给个值true</span></span><br><span class="line">            config.<span class="property">headers</span>[ <span class="string">&#x27;rememberMe&#x27;</span> ] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>也有更好的方式，比如线程池，在DlykServerApplication里先拿到Spring容器，从这个容器拿到Executor.class这个是线程池最顶层的接口，拿到名字，返回的是数组，输出结果是applicationTaskExecutor，然后通过拿到bean的这个名字打印一下，先用object接受一下看看是什么，这个本身就有的话就可以直接注入使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//拿到Spring容器</span></span><br><span class="line">    <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> SpringApplication.run(DlykServerApplication.class, args);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从这个容器拿到Executor.class这个是线程池最顶层的接口，拿到名字，返回的是数组，</span></span><br><span class="line">    String[] beanNamesForType = context.getBeanNamesForType(Executor.class);</span><br><span class="line">    <span class="keyword">for</span> (String s : beanNamesForType)&#123;</span><br><span class="line">        System.out.println(s);<span class="comment">//输出结果是applicationTaskExecutor</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//然后通过拿到bean的这个名字打印一下，先用object接受一下看看是什么</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;applicationTaskExecutor&quot;</span>);</span><br><span class="line">    System.out.println(obj);</span><br><span class="line">    <span class="comment">//输出org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor@1312876b，这个本身就有的话就可以直接注入使用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后TokenVerifyFilter.java，注入后用threadPoolTaskExecutor调用一个execute方法，方法里面存的是Runnable，也就是上面的括号里的那些，老的代码就不用了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//spring boot框架的ioc容器中已经创建好了该线程池，可以注入直接使用</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ThreadPoolTaskExecutor threadPoolTaskExecutor;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* //刷新一下token（异步处理，new一个线程去执行）</span></span><br><span class="line"><span class="comment">            new Thread(() -&gt; &#123;</span></span><br><span class="line"><span class="comment">                //刷新token，从请求头里拿rememberMe</span></span><br><span class="line"><span class="comment">                String rememberMe = request.getHeader(&quot;rememberMe&quot;);</span></span><br><span class="line"><span class="comment">                if (Boolean.parseBoolean(rememberMe)) &#123;</span></span><br><span class="line"><span class="comment">                    redisService.expire(Constants.REDIS_JWT_KEY + tUser.getId(), Constants.EXPIRE_TIME, TimeUnit.SECONDS);</span></span><br><span class="line"><span class="comment">                &#125; else &#123;</span></span><br><span class="line"><span class="comment">                    redisService.expire(Constants.REDIS_JWT_KEY + tUser.getId(), Constants.DEFAULT_EXPIRE_TIME, TimeUnit.SECONDS);</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;).start();*/</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//异步处理（更好的方式，使用线程池去执行），调用execute方法，方法里面存的是Runnable，也就是上面的括号里的那些</span></span><br><span class="line">            threadPoolTaskExecutor.execute(() -&gt; &#123;</span><br><span class="line">                <span class="comment">//刷新token</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">rememberMe</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;rememberMe&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (Boolean.parseBoolean(rememberMe)) &#123;</span><br><span class="line">                    redisService.expire(Constants.REDIS_JWT_KEY + tUser.getId(), Constants.EXPIRE_TIME, TimeUnit.SECONDS);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    redisService.expire(Constants.REDIS_JWT_KEY + tUser.getId(), Constants.DEFAULT_EXPIRE_TIME, TimeUnit.SECONDS);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br></pre></td></tr></table></figure>

<p>然后再去登录页面试试操作后有没有刷新这个TTL</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250717161452110.png" alt="image-20250717161452110"></p>
<h3 id="重新登陆弹窗两次的问题"><a href="#重新登陆弹窗两次的问题" class="headerlink" title="重新登陆弹窗两次的问题"></a>重新登陆弹窗两次的问题</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250717161705428.png" alt="image-20250717161705428"></p>
<p>点击取消后显示<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250717161729250.png" alt="image-20250717161729250"> </p>
<p>因为后天token删掉了，调用退出接口的时候也会验证token，验证也就没有通过，而验证是走filter，验证的代码应该是901之类的，就是redis不存在那种错误，然后返回空结果，所以会弹两个结果，一个是返回不是200，是901之类的，一个是httpRequest里大于900也会弹</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250717162515274.png" alt="image-20250717162515274"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250717162550507.png" alt="image-20250717162550507"></p>
<p>然后是想让&gt;900的这个先执行或者只执行，思路是在if里直接加一个return，这样的话正常是返回给response，不正常就直接返回空的，再测试一遍发现只弹一个了，老师说是因为异步，导致不一定谁先拿到结果，就出现弹两次的情况，但弹幕说“还是拦截器先，后弹的覆盖掉前弹的了，如果是异步的那还有拦截器干嘛”，所以不清楚</p>
<p>httpRequest.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (response.<span class="property">data</span>.<span class="property">code</span> &gt; <span class="number">900</span>) &#123;</span><br></pre></td></tr></table></figure>
<pre><code>    return ;
}     
</code></pre>
<h1 id="账户管理"><a href="#账户管理" class="headerlink" title="账户管理"></a>账户管理</h1><p>权限等后面再加，现在没有功能菜单不太好加</p>
<p>这是以4s店为项目背景的客户营销管理系统，（4s店即汽车经销商），4s店里面有很多销售顾问，每个销售人员都可以登录该系统，每个销售人员都有一个账号；这个账号需要管理员创建和维护；</p>
<p>1、所有人员的账号信息列表进行分页展示；（OK）</p>
<p>2、查看某个账号的详情；（OK）</p>
<p>3、新增创建一个新账号；（OK）</p>
<p>4、修改某个人的账号；（修改他的账户名、状态（锁定、禁用…..））（OK）</p>
<p>5、删除一个账号；（OK）</p>
<p>6、批量删除；(OK)</p>
<p>当点击用户管理时是打开一个新页面，前端页面跳转是通过路由控制的，然后找到用户管理菜单，找到二级菜单，设置点一下就触发一个事件，事件是切换路由，就需要在菜单里启用路由模式，</p>
<p>DashboardView</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-menu</span><br><span class="line"> :router=&quot;true&quot;</span><br></pre></td></tr></table></figure>

<p>在饿了么菜单里，找到menu菜单，有个menu attributes，</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250729003913929.png" alt="image-20250729003913929"></p>
<p>这个的意思也就是点击用户管理时可以用index作为路径，就可以把用户管理的代码改成如下，index就是路由地址，对应的路由页面在router.js里配。</p>
<p>dashboardView.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-menu-item index=&quot;/dashboard/user&quot;&gt;</span><br><span class="line">  &lt;el-icon&gt;&lt;User /&gt;&lt;/el-icon&gt;</span><br><span class="line">  用户管理</span><br><span class="line"> &lt;/el-menu-item&gt;</span><br></pre></td></tr></table></figure>

<p>而点击时页面的左边上边下边都是不变的，只有右边是变化的页面，这时候需要用到父子路由，父路由要先渲染出来，也就是dashboard，在父路由里面再渲染子路由，子路由可以有多个所以用数组，每个路由用括号括起来。</p>
<p>router.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">            <span class="comment">// 设置路径</span></span><br><span class="line">            <span class="attr">path</span>:<span class="string">&#x27;/dashboard&#x27;</span>,</span><br><span class="line">            <span class="comment">// 路由路径所对应的页面</span></span><br><span class="line">            component : <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/DashboardView.vue&#x27;</span>),</span><br><span class="line">            <span class="comment">//子路由（多个，数组）</span></span><br><span class="line">            children : [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//路由路径，子路由不能以斜杠开头</span></span><br><span class="line">                    <span class="attr">path</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">                    <span class="comment">// 路由路径所对应的页面</span></span><br><span class="line">                    component : <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/UserView.vue&#x27;</span>),</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure>

<p>然后在view里新建一个vue，看看到时候会不会渲染这个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;UserView&quot;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">用户列表页</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>然后在右侧中间改为如下代码，router-view是根据路由去显示，可以参考app.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--右侧：中--&gt;</span><br><span class="line">   &lt;el-main&gt;</span><br><span class="line">     &lt;router-view/&gt;</span><br><span class="line">   &lt;/el-main&gt;</span><br></pre></td></tr></table></figure>

<h2 id="设计页面前端"><a href="#设计页面前端" class="headerlink" title="设计页面前端"></a>设计页面前端</h2><p>先弄两个按钮，从饿了么复制一个蓝色一个红色按钮，然后修改文字，然后再准备一个表格，找有多选的那种，改好名字，show-overflow-tooltip单元格内容过长时会隐藏多余内容，如果操作不需要显示信息，就不加property了</p>
<p>关于table属性，可以看饿了么最下面会有相关的，如果没有就说明是html自带的属性，比如ref是饿了么没有的就是html的属性，可以删掉，data是显示的数据，可以修改一下为userList，style是html的宽度，@selection-change是一个点击事件，就要往下找事件，然后也要写触发事件的函数</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250730191214597.png" alt="image-20250730191214597"></p>
<p>然后是el-table-column，找到对应的地方，可以看到type有三个取值对应三个功能，根据需求更改</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250730192118361.png" alt="image-20250730192118361"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250731020845731.png" alt="image-20250731020845731"></p>
<p>UserView.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">  &lt;el-button type=&quot;primary&quot;&gt;添加用户&lt;/el-button&gt;</span><br><span class="line">  &lt;el-button type=&quot;danger&quot;&gt;批量删除&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!--ref=&quot;multipleTableRef&quot;是html的属性可以删掉--&gt;</span><br><span class="line">  &lt;!--想要data数据就要去data定义--&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">        :data=&quot;userList&quot;</span><br><span class="line">        row-key=&quot;id&quot;</span><br><span class="line">        style=&quot;width: 100%&quot;</span><br><span class="line">        @selection-change=&quot;handleSelectionChange&quot;&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-table-column type=&quot;selection&quot; :selectable=&quot;selectable&quot; width=&quot;55&quot; /&gt;</span><br><span class="line">      &lt;!-- &lt;el-table-column label=&quot;序号&quot; width=&quot;120&quot;&gt;</span><br><span class="line">        &lt;template #default=&quot;scope&quot;&gt;&#123;&#123; scope.row.date &#125;&#125;&lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;这个是插槽模式，现在暂时不用，先用下面的这种--&gt;</span><br><span class="line">      &lt;!--show-overflow-tooltip单元格内容过长时会隐藏多余内容--&gt;</span><br><span class="line">      &lt;el-table-column type=&quot;index&quot; label=&quot;序号&quot; width=&quot;60&quot; /&gt;</span><br><span class="line">      &lt;el-table-column property=&quot;name&quot; label=&quot;账号&quot;  /&gt;</span><br><span class="line">      &lt;el-table-column property=&quot;address&quot; label=&quot;姓名&quot; show-overflow-tooltip/&gt;</span><br><span class="line">      &lt;el-table-column property=&quot;address&quot; label=&quot;手机&quot; show-overflow-tooltip/&gt;</span><br><span class="line">      &lt;el-table-column property=&quot;address&quot; label=&quot;邮箱&quot; show-overflow-tooltip/&gt;</span><br><span class="line">      &lt;el-table-column property=&quot;address&quot; label=&quot;创建时间&quot; show-overflow-tooltip/&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; show-overflow-tooltip&gt;&lt;!--操作不需要显示信息，就不加property了--&gt;</span><br><span class="line">          详情 编辑 删除</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;doGet&#125; from &quot;../http/httpRequest.js&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;UserView&quot;,</span><br><span class="line"></span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      //用户列表数据，初始值是空</span><br><span class="line">      userList : [&#123;&#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  //想要页面一打开就要把用户查询出来，直接查询第一页就可以</span><br><span class="line">  mounted()&#123;</span><br><span class="line">    this.getData(1);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods : &#123;</span><br><span class="line">    //勾选或者取消勾选时，触发该函数</span><br><span class="line">    handleSelectionChange()&#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    //查询用户列表数据</span><br><span class="line">    getData(current)&#123;</span><br><span class="line">      doGet(&quot;/api/users&quot;, &#123;</span><br><span class="line">        current : current//当前查询第几页，值从方法传过来</span><br><span class="line">      &#125;).then(resp =&gt; &#123;</span><br><span class="line">        if(resp.data.code === 200)&#123;</span><br><span class="line">          this.userList = resp.data.data;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="后端代码"><a href="#后端代码" class="headerlink" title="后端代码"></a>后端代码</h2><p>写一个get请求，从userView传过来一个参数current，也就是接收分页参数，这个参数是通过get请求传过来的，就可以通过@RequestParam接收参数，传过来的结果是1，就用Integer接收，required &#x3D; false就是参数可以传也可以不传，然后调用userService的分页方法</p>
<p>UserController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span><span class="comment">//返回json</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">        <span class="meta">@GetMapping(value = &quot;/api/users&quot;)</span></span><br><span class="line">    <span class="comment">//从userView传过来一个参数current，也就是接收分页参数，这个参数是通过get请求传过来的，就可以通过@RequestParam接收参数</span></span><br><span class="line">    <span class="comment">// 传过来的结果是1，就用Integer接收</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">userPage</span><span class="params">(<span class="meta">@RequestParam(value = &quot;current&quot;, required = false)</span> Integer current)</span>&#123;</span><br><span class="line">        <span class="comment">//required = false表示参数可以传也可以不传</span></span><br><span class="line">        <span class="comment">//required = true 表示参数必须传，否则报错，默认是true</span></span><br><span class="line">        <span class="keyword">if</span>(current == <span class="literal">null</span>)&#123;</span><br><span class="line">            current = <span class="number">1</span>;<span class="comment">//变成默认是1</span></span><br><span class="line">        &#125;</span><br><span class="line">        PageInfo&lt;TUser&gt; pageInfo = userService.getUserByPage(current);</span><br><span class="line">        <span class="keyword">return</span> R.OK(pageInfo);<span class="comment">//pageInfo获得返回的数据，然后传到前台</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">getUserByPage</span><span class="params">(Integer current)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后点一下这个图标就可以进入到实现方法里<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250731182507800.png" alt="image-20250731182507800">，再按alt+insert创建实现方法代码</p>
<p>UserServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUserByPage</span><span class="params">(Integer current)</span> &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后去装分页插件的依赖，装完后不需要配置，然后就是写相关的代码，写在上面的实现里。里面的PAGE_SIZE要配置上，也就是constants里面的分页时每页显示10条数据</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Page Helper分页插件的依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>UserServiceImpl.java变成</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageInfo&lt;TUser&gt; <span class="title function_">getUserByPage</span><span class="params">(Integer current)</span> &#123;</span><br><span class="line">        <span class="comment">//这条方法是通过接口里的方法去按alt+insert然后选实现方法来创建的</span></span><br><span class="line">        <span class="comment">// 1.设置PageHelper</span></span><br><span class="line">        PageHelper.startPage(current, Constants.PAGE_SIZE);</span><br><span class="line">        <span class="comment">// 2.查询</span></span><br><span class="line">        List&lt;TUser&gt; list = tUserMapper.selectUserByPage();</span><br><span class="line">        <span class="comment">// 3.封装分页数据到PageInfo</span></span><br><span class="line">        PageInfo&lt;TUser&gt; info = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(list);</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserService接口变成</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    PageInfo&lt;TUser&gt; <span class="title function_">getUserByPage</span><span class="params">(Integer current)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后对selectUserByPage按alt+回车去创建分页查询，再点箭头去写查询语句，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TUserMapper:</span><br><span class="line">    List&lt;TUser&gt; <span class="title function_">selectUserByPage</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByPage&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">  <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span> /&gt;</span></span><br><span class="line">  from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后启动apifox，新建一个分页查询用户列表接口，&#x2F;api&#x2F;users，参数名current，参数值1，类型Integer，然后发送，这时候显示，说明请求时不带token，就可以通过请求头携带token的方式进入<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250731194411799.png" alt="image-20250731194411799"></p>
<p>token可以从登录接口获取，点击发送后从下面复制，粘贴到头里，参数名是Authorization，再次点击发送就可以进入了，并且里面是打印了十条数据</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250731214021479.png" alt="image-20250731214021479"></p>
<p>和前端对接的话，要拿到用户的list，如果不知道怎么取的话可以先把resp打印出来，用console.log(resp);打印，输出结果是这样的<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250731215226238.png" alt="image-20250731215226238"></p>
<p>所以UserView的代码变成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">	&lt;el-table-column type=&quot;index&quot; label=&quot;序号&quot; width=&quot;60&quot; /&gt;</span><br><span class="line">      &lt;el-table-column property=&quot;loginAct&quot; label=&quot;账号&quot;  /&gt;</span><br><span class="line">      &lt;el-table-column property=&quot;name&quot; label=&quot;姓名&quot; show-overflow-tooltip/&gt;</span><br><span class="line">      &lt;el-table-column property=&quot;phone&quot; label=&quot;手机&quot; show-overflow-tooltip/&gt;</span><br><span class="line">      &lt;el-table-column property=&quot;email&quot; label=&quot;邮箱&quot; show-overflow-tooltip/&gt;</span><br><span class="line">      &lt;el-table-column property=&quot;createTime&quot; label=&quot;创建时间&quot; show-overflow-tooltip/&gt;</span><br><span class="line"></span><br><span class="line">this.userList = resp.data.data.list;</span><br></pre></td></tr></table></figure>

<p>然后在用户管理里面可以看到创建时间显示格式是有问题的，而且时间是晚了八小时，这里就要在yml里设置，然后就正常了</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250801014133101.png" alt="image-20250801014133101"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250801014416253.png" alt="image-20250801014416253"></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line"> <span class="comment">#设置jackson返回json数据时，时区和格式</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br></pre></td></tr></table></figure>

<h2 id="添加分页条"><a href="#添加分页条" class="headerlink" title="添加分页条"></a>添加分页条</h2><p>在饿了么找到pagination分页，找带有背景色的分页，复制代码，然后发现表格和分页都离得很近，都加上点距离样式，分页条的属性也都是同样的方法查阅，代码的意思是total是总共1000条，page-size是每页显示100条，这样就分成了10页。所以只需要控制这两个值就行，在data定义一下，初始先赋值0，后面查完然后给他赋值就可以，那么就在下面写，具体看怎么拿值还是上面的方法，找到data.data里面的total和pagesize，这样就可以完成赋值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> &lt;el-pagination</span><br><span class="line">      background</span><br><span class="line">      layout=&quot;prev, pager, next&quot;</span><br><span class="line">      :page-size=&quot;pageSize&quot;</span><br><span class="line">      :total=&quot;total&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      //用户列表数据，初始值是空</span><br><span class="line">      userList : [&#123;&#125;],</span><br><span class="line">      pageSize : 0,</span><br><span class="line">      total : 0,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"> getData(current)&#123;</span><br><span class="line">      doGet(&quot;/api/users&quot;, &#123;</span><br><span class="line">        current : current//当前查询第几页，值从方法传过来</span><br><span class="line">      &#125;).then(resp =&gt; &#123;</span><br><span class="line">        if(resp.data.code === 200)&#123;</span><br><span class="line">          this.userList = resp.data.data.list;</span><br><span class="line">          this.pageSize = resp.data.data.pageSize;</span><br><span class="line">          this.total = resp.data.data.total;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.el-table&#123;</span><br><span class="line">  margin-top: 12px;</span><br><span class="line">&#125;</span><br><span class="line">.el-pagination&#123;</span><br><span class="line">  margin-top: 12px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="给分页条添加点击事件"><a href="#给分页条添加点击事件" class="headerlink" title="给分页条添加点击事件"></a>给分页条添加点击事件</h3><p>还是查询文档，里面有关于事件的名称，@prev-click上一页，@next-click下一页，@current-change当前页，点击触发事件传递当前页</p>
<p>Userview.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-pagination</span><br><span class="line">   @prev-click=&quot;toPage&quot;</span><br><span class="line">    @next-click=&quot;toPage&quot;</span><br><span class="line">    @current-change=&quot;toPage&quot;</span><br><span class="line">/&gt;</span><br><span class="line"></span><br><span class="line">methods : &#123;</span><br><span class="line">  //分页函数，上面点事件时会传当前是第几页的值，（current这个参数是ele-plus组件传过来的，传的当前页）</span><br><span class="line">  toPage(current)&#123;</span><br><span class="line">    this.getData(current);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="route与-router"><a href="#route与-router" class="headerlink" title="$route与$router"></a>$route与$router</h2><p><strong>$route</strong>: 获取当前路由对象的属性信息；比如：</p>
<p>this.$route.path； 拿到路由路径</p>
<p>this.$route.params.id； 拿到路由地址中的id参数</p>
<p><strong>$router</strong>: 调用当前路由对象的方法，比如：</p>
<p>this.$router.push(“&#x2F;dashboard&#x2F;user”)；&#x2F;&#x2F;跳转到指定的路由地址；</p>
<p>this.$router.go(-1); &#x2F;&#x2F;跳转到上一个路由地址</p>
<h2 id="用户详情"><a href="#用户详情" class="headerlink" title="用户详情"></a>用户详情</h2><p>给详情添加一个按钮，然后点按钮的时候要触发一个事件，view里的括号是用来接收id参数的，也就是查看哪个用户的详情，这里的代码也就需要改成使用“插槽”，在table表格里，有个column插槽，按钮要放在插槽里面，这样可以通过scope.row拿到数据，再拿到id。然后去写方法，通过scope.row.id传过来的就是id，然后要实现点击详情跳转到&#x2F;dashboard&#x2F;user&#x2F;1路由，用下面方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">   &lt;el-table-column label=&quot;操作&quot; show-overflow-tooltip&gt;&lt;!--操作不需要显示信息，就不加property了--&gt;</span><br><span class="line">        &lt;!--这个是插槽，给插槽添加按钮和点击时间后，view里的括号是用来接收id参数的，也就是查看哪个用户的详情，通过scope.row拿到数据，再拿到id--&gt;</span><br><span class="line">        &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; @click=&quot;view(scope.row.id)&quot;&gt;详情&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;success&quot; @click=&quot;edit(scope.row.id)&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;danger&quot; @click=&quot;del(scope.row.id)&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line"> methods : &#123;</span><br><span class="line">    //上面的插槽详情按钮，通过scope.row.id传过来的就是id，然后要实现点击详情跳转到/dashboard/user/1路由，用下面方法</span><br><span class="line">    view(id)&#123;</span><br><span class="line">      console.log(id);</span><br><span class="line">      //跳转到/dashboard/user/1路由上</span><br><span class="line">      this.$router.push(&quot;/dashboard/user/&quot; + id);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>然后配置路由，点击的页面还是在右侧中间显示，所以是子路由，在router.js里配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">                    <span class="comment">//路由路径，子路由不能以斜杠开头，id是动态变量，这个叫动态路由</span></span><br><span class="line">                    <span class="comment">//原本的&quot;/dashboard/user/&quot; + id改为如下格式</span></span><br><span class="line">                    <span class="attr">path</span>: <span class="string">&#x27;user/:id&#x27;</span>,</span><br><span class="line">                    <span class="comment">// 路由路径所对应的页面</span></span><br><span class="line">                    component : <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/UserDetailView.vue&#x27;</span>),</span><br><span class="line">                &#125;,</span><br></pre></td></tr></table></figure>

<p>然后就是写UserDetailView页面</p>
<h3 id="用户详细页面"><a href="#用户详细页面" class="headerlink" title="用户详细页面"></a>用户详细页面</h3><p>页面加载出来后就是查数据，把用户的所有字段展示一下，写好方法后用饿了么的form表单效果显示，从登录表单里复制过来，因为不需要验证所以要删点代码</p>
<p>执行流程就是页面渲染时执行mounted，mounted会掉loadUserDetail函数，这个函数去后台查，查完给userDetail赋值，赋值完去显示。然后就是写后台接口，但需要id，怎么拿到id？可以通过路由地址拿，也就是通过$route拿路由信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">  &lt;el-form ref=&quot;loginRefForm&quot; :model=&quot;userDetail&quot; label-width=&quot;120px&quot;&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;ID&quot; &gt;</span><br><span class="line">      &#123;&#123; userDetail.id &#125;&#125;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;账号&quot;&gt;</span><br><span class="line">      &#123;&#123; userDetail.id &#125;&#125;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">  &lt;/el-form&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;UserDetailView&quot;,</span><br><span class="line"></span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      //用户详情对象，初始值是空</span><br><span class="line">      userDetail : &#123;&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  mounted()&#123;</span><br><span class="line">    this.loadUserDetail();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods : &#123;</span><br><span class="line">    //加载用户详情</span><br><span class="line">    loadUserDetail()&#123;</span><br><span class="line">      let id = this.$route.params.id;//id名字要和动态路由中配置的path:&#x27;user/:id&#x27;，名字相同，也就是user/:xxx，前面的id就改为xxx</span><br><span class="line">      doGet(&quot;/api/user/&quot; + id, &#123;&#125;).then(resp =&gt; &#123;</span><br><span class="line">        if(resp.data.code === 200)&#123;//200就登陆成功</span><br><span class="line">          this.userDetail = resp.data.data;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="后端接口"><a href="#后端接口" class="headerlink" title="后端接口"></a>后端接口</h3><p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/api/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//需要接收的参数在路径中，就用PathVariable去接收</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">userDetail</span><span class="params">(<span class="meta">@PathVariable(value = &quot;id&quot;)</span> Integer id )</span>&#123;</span><br><span class="line">        <span class="comment">//用userService通过id查一下，查到tuser对象</span></span><br><span class="line">        <span class="type">TUser</span> <span class="variable">tUser</span> <span class="operator">=</span> userService.getUserByID(id);</span><br><span class="line">        <span class="keyword">return</span> R.OK(tUser);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>然后对getUserByID按alt+回车生成方法，UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TUser <span class="title function_">getUserByID</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<p>点一下箭头转到UserServiceImpl，然后实现代码查询方法，因为id本来就是主键，所以用主键查，而根据主键查询是底层生成好的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> TUser <span class="title function_">getUserByID</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">     <span class="comment">//使用tUserMapper去查，因为id本来就是主键，所以用主键查，而根据主键查询是底层生成好的</span></span><br><span class="line">     <span class="keyword">return</span> tUserMapper.selectByPrimaryKey(id);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="完善页面"><a href="#完善页面" class="headerlink" title="完善页面"></a>完善页面</h3><p>1，什么不显示的时候也显示背景色，就可以加个空格&amp;nbsp;</p>
<p>2.密码不需要显示，直接加***</p>
<p>3.创建人和编辑人都需要显示具体的人，就需要换个查询，在impl里修改代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> tUserMapper.selectDetailById(id);</span><br></pre></td></tr></table></figure>

<p>TUserMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TUser <span class="title function_">selectDetailById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<p>TUserMapper.xml，查询语句写完后这个映射只适合tu.*这一个表，还有四个字段怎么办，需要改个新映射去映射，先复制老映射，然后修改id名字</p>
<p>原本关联的TUser现在又关联一个用户对象createByDO，也就是创建人的用户对象，里面只查两个字段，对应到java的TUser里是id和name</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;UserResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.bjpowernode.model.TUser&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;login_act&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;loginAct&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;login_pwd&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;loginPwd&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;account_no_expired&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;accountNoExpired&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;credentials_no_expired&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;credentialsNoExpired&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;account_no_locked&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;accountNoLocked&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;account_enabled&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;accountEnabled&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_by&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createBy&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;edit_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;editTime&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;edit_by&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;editBy&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_login_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastLoginTime&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;createByDo&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TUser&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;createById&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;createByName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--一对一关联--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;editByDo&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TUser&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;editById&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;editByName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectDetailById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;UserResultMap&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">    tu.*,</span><br><span class="line">    tu2.id createById, tu2.name createByName,</span><br><span class="line">    tu3.id editById, tu3.name editByName</span><br><span class="line">    from t_user tu left join t_user tu2 on tu.create_by = tu2.id</span><br><span class="line">                        left join t_user tu3 on tu.edit_by = tu3.id</span><br><span class="line">    where tu.id = #&#123;id,jdbcType=INTEGER&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在TUser注入关联</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一对一关联</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> TUser createByDo;</span><br><span class="line"><span class="keyword">private</span> TUser editByDo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------实现UserDetails接口的七个方法---------------------</span></span><br></pre></td></tr></table></figure>

<p>在UserDetailView.vue里，里面要关联两个对象，然后初始值为空，然后编辑人创建人代码改成这样就行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">   &lt;el-form-item label=&quot;创建人&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;detail&quot;&gt;&amp;nbsp;&#123;&#123;userDetail.createByDo.name&#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;编辑人&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;detail&quot;&gt;&amp;nbsp;&#123;&#123;userDetail.editByDo.name&#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      //用户详情对象，初始值是空</span><br><span class="line">      userDetail : &#123;</span><br><span class="line">        createByDo : &#123;&#125;,</span><br><span class="line">        editByDo : &#123;&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>然后再去测试页面，发现当创建人之类的为空时报错，就说明后台数据库是没有这个人的，写代码兼容一下，做个判断然后赋值，然后给返回按钮写上方法，根据历史返回</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">methods : &#123;</span><br><span class="line">  <span class="comment">//加载用户详情</span></span><br><span class="line">  <span class="title function_">loadUserDetail</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> id = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>;<span class="comment">//id名字要和动态路由中配置的path:&#x27;user/:id&#x27;，名字相同，也就是user/:xxx，前面的id就改为xxx</span></span><br><span class="line">    <span class="title function_">doGet</span>(<span class="string">&quot;/api/user/&quot;</span> + id, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>)&#123;<span class="comment">//200就登陆成功</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">userDetail</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">userDetail</span>.<span class="property">createByDo</span>)&#123;<span class="comment">//做个判断，如果userDetail被赋值为空就是不存在，就赋个空值</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">userDetail</span>.<span class="property">createByDo</span> = &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">userDetail</span>.<span class="property">editByDo</span>)&#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">userDetail</span>.<span class="property">editByDo</span> = &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">//返回</span></span><br><span class="line">  <span class="title function_">goBack</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//根据历史返回是-1</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">go</span>(-<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="新增账号功能"><a href="#新增账号功能" class="headerlink" title="新增账号功能"></a>新增账号功能</h3><p>第一步点击新增按钮后要弹窗，找到dialog对话框，找到可拖拽对话框，找到UserView里面写，关于怎么弹窗就是看dialogVisible是true还是false，这样就在添加用户按钮写一个触发函数add，复制进去的表单也需要定义用户表单对象userQuery。在数据库里还有四个需要选择的，比如账号未过期，需要做一个下拉选项，在饿了么表单里找select选择器，</p>
<p>UserView</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">  &lt;el-button type=&quot;primary&quot; @click=&quot;add&quot;&gt;添加用户&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--新增用户的弹窗（对话框）--&gt;</span><br><span class="line">  &lt;el-dialog v-model=&quot;userDialogVisible&quot; title=&quot;Tips&quot; width=&quot;500&quot; draggable&gt;</span><br><span class="line">    //&lt;span&gt;It&#x27;s a draggable Dialog&lt;/span&gt;</span><br><span class="line">    &lt;template #footer&gt;</span><br><span class="line">      &lt;div class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;Cancel&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;dialogVisible = false&quot;&gt;</span><br><span class="line">          Confirm</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/el-dialog&gt;</span><br><span class="line"></span><br><span class="line"> data()&#123;</span><br><span class="line">	return&#123;</span><br><span class="line">	//用户的弹窗是否弹出来，true就弹出来，false就不弹出来</span><br><span class="line">     userDialogVisible : false,</span><br><span class="line">	  //定义用户表单对象，初始值是空</span><br><span class="line">      userQuery : &#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">   &#125;,</span><br><span class="line"></span><br><span class="line">methods : &#123;</span><br><span class="line">    //新增用户</span><br><span class="line">    add()&#123;</span><br><span class="line">      this.userDialogVisible = true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.el-select&#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>然后就可以点击弹窗了，把弹窗里的内容改成表单，要把   &lt;span&gt;It’s a draggable Dialog</span>改成之前loginView里的表单就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--新增用户的弹窗（对话框）center是居中--&gt;</span><br><span class="line">  &lt;el-dialog v-model=&quot;userDialogVisible&quot; title=&quot;新增用户&quot; width=&quot;55%&quot; center draggable&gt;</span><br><span class="line">    &lt;el-form ref=&quot;loginRefForm&quot; :model=&quot;userQuery&quot; label-width=&quot;110px&quot;  :rules=&quot;loginRules&quot;&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;账号&quot; prop=&quot;loginAct&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;userQuery.loginAct&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">       &lt;el-form-item label=&quot;密码&quot; prop=&quot;loginPwd&quot;&gt;</span><br><span class="line">        &lt;el-input type=&quot;password&quot; v-model=&quot;userQuery.loginPwd&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;姓名&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">        &lt;el-input type=&quot;password&quot; v-model=&quot;userQuery.name&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;手机&quot; prop=&quot;phone&quot;&gt;</span><br><span class="line">        &lt;el-input  v-model=&quot;userQuery.phone&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;邮箱&quot; prop=&quot;email&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;userQuery.email&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;账号未过期&quot; prop=&quot;accountNoExpired&quot;&gt;</span><br><span class="line">        &lt;!--placeholder是提示语，accountNoExpired是账号未过期字段的名字--&gt;</span><br><span class="line">        &lt;el-select v-model=&quot;userQuery.accountNoExpired&quot; placeholder=&quot;请选择&quot;&gt;</span><br><span class="line">          &lt;el-option label=&quot;是&quot; value=&quot;1&quot;/&gt;</span><br><span class="line">          &lt;el-option label=&quot;否&quot; value=&quot;0&quot;/&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;密码未过期&quot; prop=&quot;credentialsNoExpired&quot;&gt;</span><br><span class="line">        &lt;!--placeholder是提示语，accountNoExpired是账号未过期字段的名字--&gt;</span><br><span class="line">        &lt;el-select v-model=&quot;userQuery.credentialsNoExpired&quot; placeholder=&quot;请选择&quot;&gt;</span><br><span class="line">          &lt;el-option label=&quot;是&quot; value=&quot;1&quot;/&gt;</span><br><span class="line">          &lt;el-option label=&quot;否&quot; value=&quot;0&quot;/&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;账号未锁定&quot; prop=&quot;accountNoLocked&quot;&gt;</span><br><span class="line">        &lt;!--placeholder是提示语，accountNoExpired是账号未过期字段的名字--&gt;</span><br><span class="line">        &lt;el-select v-model=&quot;userQuery.accountNoLocked&quot; placeholder=&quot;请选择&quot;&gt;</span><br><span class="line">          &lt;el-option label=&quot;是&quot; value=&quot;1&quot;/&gt;</span><br><span class="line">          &lt;el-option label=&quot;否&quot; value=&quot;0&quot;/&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;账号是否启用&quot; prop=&quot;accounEnabled&quot;&gt;</span><br><span class="line">        &lt;!--placeholder是提示语，accountNoExpired是账号未过期字段的名字--&gt;</span><br><span class="line">        &lt;el-select v-model=&quot;userQuery.accounEnabled&quot; placeholder=&quot;请选择&quot;&gt;</span><br><span class="line">          &lt;el-option label=&quot;是&quot; value=&quot;1&quot;/&gt;</span><br><span class="line">          &lt;el-option label=&quot;否&quot; value=&quot;0&quot;/&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line"></span><br><span class="line">    &lt;template #footer&gt;</span><br><span class="line">      &lt;div class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;Cancel&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;dialogVisible = false&quot;&gt;</span><br><span class="line">          Confirm</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<h3 id="验证和提交功能（前端"><a href="#验证和提交功能（前端" class="headerlink" title="验证和提交功能（前端"></a>验证和提交功能（前端</h3><p>在form里面写一个验证规则userRules，把ref的loginRefForm改成userRefForm。百度到的正则表达式要记得验证一下看看对不对</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">   &lt;el-form ref=&quot;userRefForm&quot; :model=&quot;userQuery&quot; label-width=&quot;110px&quot;  :rules=&quot;userRules&quot;&gt;</span><br><span class="line">       </span><br><span class="line">    &lt;!--关闭就是框关闭，让userDialogVisible为false就可以，所以把click的dialogVisible换成userDialogVisible--&gt;</span><br><span class="line">   &lt;template #footer&gt;</span><br><span class="line">     &lt;div class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">       &lt;el-button @click=&quot;userDialogVisible = false&quot;&gt;关 闭&lt;/el-button&gt;</span><br><span class="line">       &lt;el-button type=&quot;primary&quot; @click=&quot;userSubmit&quot;&gt;提 交&lt;/el-button&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line">   &lt;/template&gt;</span><br><span class="line">       </span><br><span class="line">data()&#123;</span><br><span class="line">   return&#123;</span><br><span class="line">     //用户列表数据，初始值是空</span><br><span class="line">     userList : [&#123;&#125;],</span><br><span class="line">     pageSize : 0,</span><br><span class="line">     total : 0,</span><br><span class="line">     //用户的弹窗是否弹出来，true就弹出来，false就不弹出来</span><br><span class="line">     userDialogVisible : false,</span><br><span class="line">     //定义用户表单对象，初始值是空</span><br><span class="line">     userQuery : &#123;&#125;,</span><br><span class="line">     //定义用户验证规则，规则可以有多个所以是数组</span><br><span class="line">     userRules : &#123;</span><br><span class="line">       loginAct : [</span><br><span class="line">           //required是必须填写，</span><br><span class="line">         &#123; required : true, message : &#x27;请输入登录账号&#x27;, trigger : &#x27;blur&#x27; &#125;</span><br><span class="line">       ],</span><br><span class="line">       loginPwd : [</span><br><span class="line">         &#123; required : true, message : &#x27;请输入登录密码&#x27;, trigger : &#x27;blur&#x27; &#125;,</span><br><span class="line">         &#123; min : 6, max : 16, massage : &#x27;登录密码长度为6-16位&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">       ],</span><br><span class="line">       name : [</span><br><span class="line">           //验证姓名是不是中文有个正则表达式，是pattern里</span><br><span class="line">         &#123; required : true, message : &#x27;请输入姓名&#x27;, trigger : &#x27;blur&#x27; &#125;,</span><br><span class="line">         &#123; pattern: /^[\u4E00-\u9FA5]&#123;1,5&#125;$/, message: &#x27;姓名必须是中文&#x27;, trigger: &#x27;blur&#x27;&#125;</span><br><span class="line">       ],</span><br><span class="line">       phone : [</span><br><span class="line">         &#123; required: true, message: &#x27;请输入手机号码&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">         &#123; pattern : /^1[3-9]\d&#123;9&#125;$/, message: &#x27;手机号码格式有误&#x27;, trigger: &#x27;blur&#x27;&#125;</span><br><span class="line">       ],</span><br><span class="line">       email : [</span><br><span class="line">         &#123; required: true, message: &#x27;请输入邮箱&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">         &#123; pattern : /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]&#123;2,&#125;$/, message: &#x27;邮箱格式有误&#x27;, trigger: &#x27;blur&#x27;&#125;</span><br><span class="line">       ],</span><br><span class="line">       accountNoExpired : [</span><br><span class="line">         &#123; required: true, message: &#x27;请选择账号是否未过期&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">       ],</span><br><span class="line">       credentialsNoExpired : [</span><br><span class="line">         &#123; required: true, message: &#x27;请选择密码是否未过期&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">       ],</span><br><span class="line">       accountNoLocked : [</span><br><span class="line">         &#123; required: true, message: &#x27;请选择账号是否未未锁定&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">       ],</span><br><span class="line">       accountEnabled : [</span><br><span class="line">         &#123; required: true, message: &#x27;请选择账号是否可用&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">       ]</span><br><span class="line">     &#125;,</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;,</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">    //新增用户提交保存</span><br><span class="line">   userSubmit()&#123;</span><br><span class="line">     //用formdata提交，把每个字段都加到这里面</span><br><span class="line">     let formData = new FormData;</span><br><span class="line">     //提交用户是用query对象提交，就循环userQuery拿到每一个对象，field就是字段名，后面的是通过字段名拿到字段值</span><br><span class="line">     for (let field in this.userQuery)&#123;</span><br><span class="line">       formData.append(field, this.userQuery[field]);</span><br><span class="line">     &#125;</span><br><span class="line">     doPost(&quot;/api/user&quot;, formData).then(resp =&gt; &#123;</span><br><span class="line">       if (resp.data.code === 200)&#123;</span><br><span class="line">         messageTip(&quot;提交成功&quot;, &quot;success&quot;);</span><br><span class="line">       &#125;else &#123;</span><br><span class="line">         messageTip(&quot;提交失败&quot;, &quot;error&quot;);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="后端接口-1"><a href="#后端接口-1" class="headerlink" title="后端接口"></a>后端接口</h3><p>因为是个doPost，所以用postmapping，接收的数据是formdata，可以把里面的每个字段用一个对象映射来接收，所以搞一个userQuery接收，query这个包的目的就是从前端往下一层传参数的时候用这个接收，提交的名字都是和tUser相同，只要保证这里面的名字和页面上的名字相同就可以接收到，接收到就可以保存用户了</p>
<p>在query包下新建userQuery</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjpowernode.query;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserQuery</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主键，自动增长，用户ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录账号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String loginAct;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String loginPwd;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户姓名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户手机</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户邮箱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 账户是否没有过期，0已过期 1正常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer accountNoExpired;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码是否没有过期，0已过期 1正常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer credentialsNoExpired;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 账号是否没有锁定，0已锁定 1正常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer accountNoLocked;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 账号是否启用，0禁用 1启用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer accountEnabled;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>UseController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(value = &quot;/api/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">addUser</span><span class="params">(UserQuery userQuery)</span>&#123;</span><br><span class="line">    <span class="comment">//保存后返回一个结果，保存成功时save应该是1，但是判断的时候一般都写大于等于</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">save</span> <span class="operator">=</span> userService.savaUser(userQuery);</span><br><span class="line">    <span class="comment">//如果大于等于1就是成功否则失败</span></span><br><span class="line">    <span class="keyword">return</span> save &gt;= <span class="number">1</span> ? R.OK() : R.FAIL();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">savaUser</span><span class="params">(UserQuery userQuery)</span>;</span><br></pre></td></tr></table></figure>

<p>UserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">savaUser</span><span class="params">(UserQuery userQuery)</span> &#123;</span><br><span class="line">        <span class="comment">//这里的映射用insertSelective而不用insert是因为insertSelective的sql语句里有个判断，如果为空就不插数据，另一个则都可以插</span></span><br><span class="line">        <span class="comment">//然后看到insertSelective是需要传个tUser的，就new一个</span></span><br><span class="line">        <span class="type">TUser</span> <span class="variable">tUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TUser</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把UserQuery对象里面的属性数据复制到TUser对象里面去，用一个Spring工具类，这个就能把数据复制一下</span></span><br><span class="line">        <span class="comment">//复制要求：两个对象的属性名相同，属性类型相同，这样才能复制</span></span><br><span class="line">        BeanUtils.copyProperties(userQuery, tUser);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tUserMapper.insertSelective(tUser);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="调整"><a href="#调整" class="headerlink" title="调整"></a>调整</h4><p>现在还存在密码是明文，创建时间之类的是空问题，在SecurityConfig里已经设置过密码加密器passwordEncoder，所以直接注入就行</p>
<p>UserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//密码加密器</span></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> PasswordEncoder passwordEncoder; </span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">savaUser</span><span class="params">(UserQuery userQuery)</span> &#123;</span><br><span class="line">    <span class="comment">//这里的映射用insertSelective而不用insert是因为insertSelective的sql语句里有个判断，如果为空就不插数据，另一个则都可以插</span></span><br><span class="line">    <span class="comment">//然后看到insertSelective是需要传个tUser的，就new一个</span></span><br><span class="line">    <span class="type">TUser</span> <span class="variable">tUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TUser</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把UserQuery对象里面的属性数据复制到TUser对象里面去，用一个Spring工具类，这个就能把数据复制一下</span></span><br><span class="line">    <span class="comment">//复制要求：两个对象的属性名相同，属性类型相同，这样才能复制</span></span><br><span class="line">    BeanUtils.copyProperties(userQuery, tUser);</span><br><span class="line">    <span class="comment">//复制过来后给tuser的密码加密，因为复制过来的密码是明文</span></span><br><span class="line">    tUser.setLoginPwd(passwordEncoder.encode(userQuery.getLoginPwd()));<span class="comment">//密码加密</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tUserMapper.insertSelective(tUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SecurityConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="comment">//密码加密器</span></span><br><span class="line"><span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建人就是当前登录的人，所以要拿到当前登录人的id，这个id页面和query里都没有，所以用jwt解析，因为很多Query都需要用到这个jwt，所以弄个父类继承一下</p>
<p>BaseQuery</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseQuery</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String token;<span class="comment">//也就是jwt</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserQuery</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">//因为很多Query都需要用到这个jwt，所以继承一下</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserQuery</span> <span class="keyword">extends</span> <span class="title class_">BaseQuery</span>&#123;</span><br></pre></td></tr></table></figure>

<p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(value = &quot;/api/user&quot;)</span></span><br><span class="line"><span class="comment">//前端请求后端接口时会携带jwt请求头，通过RequestHeader拿，Authorization是请求拦截器里的名字</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">addUser</span><span class="params">(UserQuery userQuery, <span class="meta">@RequestHeader(value = &quot;Authorization&quot;)</span> String token)</span>&#123;</span><br><span class="line">    <span class="comment">//这样userQuery里面就有token了</span></span><br><span class="line">    userQuery.setToken(token);</span><br><span class="line">    <span class="comment">//保存后返回一个结果，保存成功时save应该是1，但是判断的时候一般都写大于等于</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">save</span> <span class="operator">=</span> userService.savaUser(userQuery);</span><br><span class="line">    <span class="comment">//如果大于等于1就是成功否则失败</span></span><br><span class="line">    <span class="keyword">return</span> save &gt;= <span class="number">1</span> ? R.OK() : R.FAIL();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">savaUser</span><span class="params">(UserQuery userQuery)</span> &#123;</span><br><span class="line">        <span class="comment">//这里的映射用insertSelective而不用insert是因为insertSelective的sql语句里有个判断，如果为空就不插数据，另一个则都可以插</span></span><br><span class="line">        <span class="comment">//然后看到insertSelective是需要传个tUser的，就new一个</span></span><br><span class="line">        <span class="type">TUser</span> <span class="variable">tUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TUser</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把UserQuery对象里面的属性数据复制到TUser对象里面去，用一个Spring工具类，这个就能把数据复制一下</span></span><br><span class="line">        <span class="comment">//复制要求：两个对象的属性名相同，属性类型相同，这样才能复制</span></span><br><span class="line">        BeanUtils.copyProperties(userQuery, tUser);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//复制过来后给tuser的密码加密，因为复制过来的密码是明文</span></span><br><span class="line">        tUser.setLoginPwd(passwordEncoder.encode(userQuery.getLoginPwd()));<span class="comment">//密码加密</span></span><br><span class="line">        <span class="comment">//创建时间就是保存数据的时间，所以new一个data</span></span><br><span class="line">        tUser.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建人就是当前登录的人，所以要拿到当前登录人的id，这个id页面和query里都没有，所以通过token可以解析用户id，之前的jwt工具里有个解析user对象的，解析完再getid</span></span><br><span class="line">        <span class="comment">//登录人的id</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">loginUserId</span> <span class="operator">=</span> JWTUtils.parseUserFromJWT(userQuery.getToken()).getId();</span><br><span class="line">        tUser.setCreateBy(loginUserId);<span class="comment">//创建人id</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tUserMapper.insertSelective(tUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserVIew加个验证</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新增用户提交保存</span></span><br><span class="line"><span class="title function_">userSubmit</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">//用formdata提交，把每个字段都加到这里面</span></span><br><span class="line">  <span class="keyword">let</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>;</span><br><span class="line">  <span class="comment">//提交用户是用query对象提交，就循环userQuery拿到每一个对象，field就是字段名，后面的是通过字段名拿到字段值</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> field <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">userQuery</span>)&#123;</span><br><span class="line">    formData.<span class="title function_">append</span>(field, <span class="variable language_">this</span>.<span class="property">userQuery</span>[field]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//在提交前应该还有个验证，如果回调函数是true就提交</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">userRefForm</span>.<span class="title function_">validate</span>( <span class="function">(<span class="params">isValid</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isValid)&#123;</span><br><span class="line">      <span class="title function_">doPost</span>(<span class="string">&quot;/api/user&quot;</span>, formData).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line">          <span class="title function_">messageTip</span>(<span class="string">&quot;提交成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">messageTip</span>(<span class="string">&quot;提交失败&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>



<p>然后重新新建用户时发生Duplicate entry ‘17569155171’ for key ‘t_user.phone’错误，因为数据库索引里，是把账号名，手机号和邮箱作为唯一索引的不可以重复</p>
<h3 id="页面刷新"><a href="#页面刷新" class="headerlink" title="页面刷新"></a>页面刷新</h3><p>需要做提交后关闭窗口并刷新页面功能</p>
<p>window.location.reload(); &#x2F;&#x2F;原始的js的方式刷新，是整个页面都刷新；</p>
<p>我们想实现局部的页面组件进行刷新，也就是右边中间那块刷新，这个可以使用重新调用查询方法实现，也可以采用provide &#x2F; inject 组合，实现页面组件局部刷新；</p>
<p>1、修改DashboardView.vue页面:</p>
<p>页面1 – 页面2 – 页面3 – 页面4 – 页面5</p>
<p>页面1的数据可以传给页面3、页面5… 都是可以的；</p>
<p>多级页面的数据穿透；（provide&#x2F;inject组合就行了）</p>
<p>声明reload函数，具体实现是通过isRouterAlive等于true或false来控制router-view的显示或隐藏，从而控制页面的再次加载（达到刷新的目的）；</p>
<p>2、在需要进行刷新的页面中注入DashboardView.vue组件提供（provide）的 reload函数，然后直接用this.reload()来调用进行刷新；</p>
<p>3、$nextTick()函数表示vue执行完渲染后会执行this.nextTick()里面的callback函数；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--右侧：中，加一个判断，isRouterAlive是变量，可以是true也可以是false，在data定义--&gt;</span><br><span class="line">  &lt;el-main&gt;</span><br><span class="line">    &lt;router-view v-if=&quot;isRouterAlive&quot;/&gt;</span><br><span class="line">  &lt;/el-main&gt;</span><br></pre></td></tr></table></figure>

<p>2.添加data变量和provide，在这里定义后就存在dashboard这个父级里，下面的所有子页面都可以使用里面的数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">        isRouterAlive : <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line"><span class="comment">//提供者（生产者）</span></span><br><span class="line"><span class="title function_">provide</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">//提供一个函数（要求是箭头函数</span></span><br><span class="line">    <span class="attr">reload</span>: <span class="function">()=&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isRouterAlive</span> = <span class="literal">false</span>;<span class="comment">//右侧内容隐藏</span></span><br><span class="line">      <span class="variable language_">this</span>.$nextTick(<span class="keyword">function</span> (<span class="params"></span>) &#123;<span class="comment">//$nextTick(), 当数据更新了，在dom中渲染后，自动执行该函数，</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isRouterAlive</span> = <span class="literal">true</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">      </span><br><span class="line">    <span class="comment">//提供一个字符串</span></span><br><span class="line">    <span class="attr">content</span>: <span class="string">&quot;是对负荷计算东方红郡凯撒的合法户籍卡&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提供一个数字</span></span><br><span class="line">    <span class="attr">age</span>: <span class="number">28</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提供一个对象</span></span><br><span class="line">    user : &#123;<span class="attr">id</span>: <span class="number">1098</span>, <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提供一个数组</span></span><br><span class="line">    arr : [<span class="number">12</span>, <span class="number">56</span>, <span class="number">109</span>, <span class="number">356</span>, <span class="number">8901</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,    </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250806162905679.png" alt="image-20250806162905679"></p>
<p>而UserVIew是可以使用provide的，因为这个页面是渲染在  <el-main>这个位置，使用的时候需要使用inject注入，而做页面刷新主要用的是reload，而main里面是有这个reload的直接用this调用就行</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250806163558271.png" alt="image-20250806163558271"></p>
<p>UserVIew</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//注入父级页面提供的所有属性、函数、对象等等</span></span><br><span class="line">  <span class="attr">inject</span>: [<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;arr&#x27;</span>, <span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;reload&#x27;</span>, <span class="string">&#x27;user&#x27;</span>],</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//在提交前应该还有个验证，如果回调函数是true就提交</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">userRefForm</span>.<span class="title function_">validate</span>( <span class="function">(<span class="params">isValid</span>) =&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isValid)&#123;</span><br><span class="line">          <span class="title function_">doPost</span>(<span class="string">&quot;/api/user&quot;</span>, formData).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line">              <span class="title function_">messageTip</span>(<span class="string">&quot;提交成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">              <span class="comment">//页面刷新</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">reload</span>();</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">age</span>)</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">content</span>)</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">arr</span>)</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">user</span>)</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="title function_">messageTip</span>(<span class="string">&quot;提交失败&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="编辑用户"><a href="#编辑用户" class="headerlink" title="编辑用户"></a>编辑用户</h2><p>点击编辑也是需要弹窗，所以写个弹窗函数，弹窗的时候需要把数据都查出来，就再写个加载user数据的函数，以前在UserController里写过根据id查用户的userDetail方法，不用再新写。原来的框都是用的UserQuery对象，查出来的值可以直接赋给Query。然后把弹窗的新增用户改成编辑用户，可以把新增用户变成一个变量，因为在编辑的时候查了一下用户对象，那么这个用户对象一定有个用户id，而且id是大于0的，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--新增用户的弹窗（对话框）center是居中,因为在编辑的时候查了一下用户对象，那么这个用户对象一定有个用户id，而且id是大于0的--&gt;</span><br><span class="line">  &lt;el-dialog v-model=&quot;userDialogVisible&quot; :title=&quot;userQuery.id &gt; 0 ? &#x27;编辑用户&#x27; : &#x27;新增用户&#x27;&quot; width=&quot;55%&quot; center draggable&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//编辑用户</span></span><br><span class="line"><span class="title function_">edit</span>(<span class="params">id</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">userDialogVisible</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">loadUser</span>(id);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">//加载用户信息</span></span><br><span class="line"><span class="title function_">loadUser</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="title function_">doGet</span>(<span class="string">&quot;/api/user/&quot;</span> + id, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">userQuery</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>然后测试页面，发现点击编辑用户后再点新增用户，新增用户的标题变成了编辑用户，因为他们是共用的Query对象，所以点完编辑会有值，这样的话就需要在每次点新增的时候都去重置一下为空</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新增用户</span></span><br><span class="line"><span class="title function_">add</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">userQuery</span> = &#123;&#125;;</span><br></pre></td></tr></table></figure>

<p>然后编辑的时候密码是加密显示的，不需要这样，就处理一下，先判断id是编辑还是新增，如果是编辑，在查询信息时把密码设置为空（个人感觉这样不太好），然后prop删除掉，因为编辑的时候密码可修改也可以不改，所以不做验证，但如果是新增就需要验证，不做验证时前面没有红色的星号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form-item label=&quot;密码&quot; v-if=&quot;userQuery.id &gt; 0&quot;&gt;&lt;!--编辑--&gt;</span><br><span class="line">  &lt;el-input type=&quot;password&quot; v-model=&quot;userQuery.loginPwd&quot; /&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">&lt;el-form-item label=&quot;密码&quot; prop=&quot;loginPwd&quot; v-else&gt;&lt;!--新增--&gt;</span><br><span class="line">  &lt;el-input type=&quot;password&quot; v-model=&quot;userQuery.loginPwd&quot; /&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载用户信息</span></span><br><span class="line"><span class="title function_">loadUser</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="title function_">doGet</span>(<span class="string">&quot;/api/user/&quot;</span> + id, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">userQuery</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">userQuery</span>.<span class="property">loginPwd</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250806194539328.png" alt="image-20250806194539328"> </p>
<p>然后这里的应该是显示中文<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250806194610971.png" alt="image-20250806194610971">再找到饿了么select选择器，复制option循环代码，然后把之前写死的option去掉，弹幕说这个方法有问题，说：value 使用 : 绑定就行了，直接写 1 是字符串格式他识别不对</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form-item label=&quot;账号未过期&quot; prop=&quot;accountNoExpired&quot;&gt;</span><br><span class="line">  &lt;!--placeholder是提示语，accountNoExpired是账号未过期字段的名字--&gt;</span><br><span class="line">  &lt;el-select v-model=&quot;userQuery.accountNoExpired&quot; placeholder=&quot;请选择&quot;&gt;</span><br><span class="line">    &lt;!--从option里取出item对象，下面是对应的值，key是增加渲染效率的。这里要定义options循环的数组--&gt;</span><br><span class="line">    &lt;!--因为数据库后台查的是1，然后options是做了个循环，把这个1和数组的值进行匹配，匹配了就默认选中--&gt;</span><br><span class="line">    &lt;el-option</span><br><span class="line">          v-for = &quot;item in options&quot;</span><br><span class="line">          :key=&quot;item.value&quot;</span><br><span class="line">          :label = &quot;item.label&quot;</span><br><span class="line">          :value=&quot;item.value&quot;/&gt;</span><br><span class="line">  &lt;/el-select&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">&lt;el-form-item label=&quot;密码未过期&quot; prop=&quot;credentialsNoExpired&quot;&gt;</span><br><span class="line">  &lt;el-select v-model=&quot;userQuery.credentialsNoExpired&quot; placeholder=&quot;请选择&quot;&gt;</span><br><span class="line">    &lt;el-option</span><br><span class="line">        v-for = &quot;item in options&quot;</span><br><span class="line">        :key=&quot;item.value&quot;</span><br><span class="line">        :label = &quot;item.label&quot;</span><br><span class="line">        :value=&quot;item.value&quot;/&gt;</span><br><span class="line">  &lt;/el-select&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">&lt;el-form-item label=&quot;账号未锁定&quot; prop=&quot;accountNoLocked&quot;&gt;</span><br><span class="line">  &lt;el-select v-model=&quot;userQuery.accountNoLocked&quot; placeholder=&quot;请选择&quot;&gt;</span><br><span class="line">    &lt;el-option</span><br><span class="line">        v-for = &quot;item in options&quot;</span><br><span class="line">        :key=&quot;item.value&quot;</span><br><span class="line">        :label = &quot;item.label&quot;</span><br><span class="line">        :value=&quot;item.value&quot;/&gt;</span><br><span class="line">  &lt;/el-select&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">&lt;el-form-item label=&quot;账号是否启用&quot; prop=&quot;accountEnabled&quot;&gt;</span><br><span class="line">  &lt;el-select v-model=&quot;userQuery.accountEnabled&quot; placeholder=&quot;请选择&quot;&gt;</span><br><span class="line">    &lt;el-option</span><br><span class="line">        v-for = &quot;item in options&quot;</span><br><span class="line">        :key=&quot;item.value&quot;</span><br><span class="line">        :label = &quot;item.label&quot;</span><br><span class="line">        :value=&quot;item.value&quot;/&gt;</span><br><span class="line">  &lt;/el-select&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="keyword">return</span>&#123;      </span><br><span class="line"><span class="comment">//下拉选项数组</span></span><br><span class="line">     options : [</span><br><span class="line">       &#123;label : <span class="string">&#x27;是&#x27;</span>, value : <span class="number">1</span>&#125;,</span><br><span class="line">       &#123;<span class="attr">label</span>: <span class="string">&#x27;否&#x27;</span>, <span class="attr">value</span>: <span class="number">0</span>&#125;</span><br><span class="line">     ]</span><br></pre></td></tr></table></figure>

<p>然后是提交，都是共用userSubmit方法，所以需要做个验证，验证成功是编辑的话用put提交，否则是post </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">userRefForm</span>.<span class="title function_">validate</span>( <span class="function">(<span class="params">isValid</span>) =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(isValid)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">userQuery</span>.<span class="property">id</span> &gt; <span class="number">0</span>)&#123;<span class="comment">//编辑</span></span><br><span class="line">      <span class="title function_">doPut</span>(<span class="string">&quot;/api/user&quot;</span>, formData).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line">          <span class="title function_">messageTip</span>(<span class="string">&quot;编辑成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">          <span class="comment">//页面刷新</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">reload</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">messageTip</span>(<span class="string">&quot;编辑失败&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">doPost</span>(<span class="string">&quot;/api/user&quot;</span>, formData).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;<span class="comment">//新增</span></span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line">          <span class="title function_">messageTip</span>(<span class="string">&quot;提交成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">          <span class="comment">//页面刷新</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">reload</span>();</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">age</span>)</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">content</span>)</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">arr</span>)</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">user</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">messageTip</span>(<span class="string">&quot;提交失败&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>然后点击doPut跳转到httpRequest.js，把.then代码删除，因为这部分的结果是在业务代码中写</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//和post一样，只需要改方法名</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">doPut</span>(<span class="params">url, data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">axios</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;put&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: url,</span><br><span class="line">        <span class="attr">data</span>:data,</span><br><span class="line">        <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//和get一样</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">doDelete</span>(<span class="params">url, params</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">axios</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;delete&quot;</span>,</span><br><span class="line">        <span class="comment">//下面两个都不要写死</span></span><br><span class="line">        <span class="attr">url</span>: url,</span><br><span class="line">        <span class="attr">params</span>: params,</span><br><span class="line">        <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="后端代码-1"><a href="#后端代码-1" class="headerlink" title="后端代码"></a>后端代码</h3><p>和新增用户差不多，直接复制修改就行</p>
<p>UserController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编辑用户</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userQuery</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(value = &quot;/api/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">editUser</span><span class="params">(UserQuery userQuery, <span class="meta">@RequestHeader(value = &quot;Authorization&quot;)</span> String token)</span>&#123;</span><br><span class="line">    userQuery.setToken(token);</span><br><span class="line">    <span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> userService.updateUser(userQuery);</span><br><span class="line">    <span class="keyword">return</span> update &gt;= <span class="number">1</span> ? R.OK() : R.FAIL();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">updateUser</span><span class="params">(UserQuery userQuery)</span>;</span><br></pre></td></tr></table></figure>

<p>UserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateUser</span><span class="params">(UserQuery userQuery)</span> &#123;</span><br><span class="line">       <span class="comment">//和上面的一样</span></span><br><span class="line">       <span class="type">TUser</span> <span class="variable">tUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TUser</span>();</span><br><span class="line"></span><br><span class="line">       BeanUtils.copyProperties(userQuery, tUser);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//看传过来的参数有没有密码，有的话就给密码加密一下，没有就不用了</span></span><br><span class="line">       <span class="keyword">if</span>(StringUtils.hasText(userQuery.getLoginPwd()))&#123;</span><br><span class="line">           tUser.setLoginPwd(passwordEncoder.encode(userQuery.getLoginPwd()));</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       tUser.setEditTime(<span class="keyword">new</span> <span class="title class_">Date</span>());<span class="comment">//编辑时间</span></span><br><span class="line"></span><br><span class="line">       <span class="type">Integer</span> <span class="variable">loginUserId</span> <span class="operator">=</span> JWTUtils.parseUserFromJWT(userQuery.getToken()).getId();</span><br><span class="line">       tUser.setEditBy(loginUserId);<span class="comment">//编辑人</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//这个也是和updateByPrimaryKey有区别的，有个空判断，如果是空就不更新，但是还需要在sql里添加一点判断</span></span><br><span class="line">       <span class="comment">//因为在前端给密码加了个空字符串，所以也要不为空字符串才可以</span></span><br><span class="line">       <span class="keyword">return</span> tUserMapper.updateByPrimaryKeySelective(tUser);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>TUserMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;loginPwd != null and loginPwd != &#x27;&#x27; &quot;</span> &gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h2><h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><p>删除用户的时候需要有个提示，在util.js里有封装过确认消息提示</p>
<p>UserView</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除</span></span><br><span class="line"><span class="title function_">del</span>(<span class="params">id</span>)&#123;</span><br><span class="line">  <span class="comment">//删除用户的时候需要有个提示，在util.js里有封装过确认消息提示</span></span><br><span class="line">  <span class="title function_">messageConfirm</span>(<span class="string">&quot;您确定要删除该数据吗？&quot;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;<span class="comment">//用户点击“确定”按钮就会触发then函数</span></span><br><span class="line">    <span class="title function_">doDelete</span>(<span class="string">&quot;/api/user/&quot;</span> + id, &#123;&#125;),<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line">        <span class="title function_">messageTip</span>(<span class="string">&quot;删除成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">        <span class="comment">//删除成功刷新页面</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">reload</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">messageTip</span>(<span class="string">&quot;删除失败&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;<span class="comment">// 用户点击“取消”按钮就会触发catch函数</span></span><br><span class="line">    <span class="title function_">messageTip</span>(<span class="string">&quot;取消删除&quot;</span>, <span class="string">&quot;warning&quot;</span>);<span class="comment">//messageTip是封装好的消息提示</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3><p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用PathVariable接收id数据，然后删除多少条就返回多少条，只要大于等于1就是删除成功</span></span><br><span class="line"><span class="meta">@DeleteMapping(value = &quot;/api/user/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">delUser</span><span class="params">(<span class="meta">@PathVariable(value = &quot;id&quot;)</span> Integer id)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">del</span> <span class="operator">=</span> userService.delUserById(id);</span><br><span class="line">    <span class="keyword">return</span> del &gt;= <span class="number">1</span> ? R.OK() : R.FAIL();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">delUserById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<p>impl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delUserById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="comment">//根据主键删除</span></span><br><span class="line">    <span class="keyword">return</span> tUserMapper.deleteByPrimaryKey(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试的时候发现提示标题是warning，改一下代码<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250809214247726.png" alt="image-20250809214247726"> </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 确认消息提示</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise&lt;MessageBoxData&gt;</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">messageConfirm</span>(<span class="params">msg</span>)&#123;</span><br><span class="line">    <span class="comment">// 给前端用户提示，并且跳转页面，提示的话不用之前的util的messageTip，换成可交互的提示</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">ElMessageBox</span>.<span class="title function_">confirm</span>(</span><br><span class="line">       msg,<span class="comment">//提示语，data.msg里有三个错误的返回信息，放在前面</span></span><br><span class="line">        <span class="string">&#x27;系统提醒&#x27;</span>,<span class="comment">//提示的标题</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">            <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除时外键约束"><a href="#删除时外键约束" class="headerlink" title="删除时外键约束"></a>删除时外键约束</h3><p>删除管理员用户时什么提示也没有，也没有删除成功，是因为后台报异常了但是没有被捕获，程序停止运行没有返回结果，报错原因是发生在数据库，活动表activity这个子表的owner_id字段在引用user这个父表的id，所以不能删，点击活动表查看设计表外键，更新时的cascade是级联的意思，父表更新时子表跟着一起更新，RESTRICT是限制拒绝的意思，点开来看里面是有四个选项，这四个就叫做外键约束</p>
<p>第一行空白是Default，默认级别。接下来介绍一下这五种级别的差异。</p>
<p>Set default方式<br>父表有变更时，子表将外键列设置成一个默认的值，但Innodb不能识别；（很少用），比如用户表的id是1，id是1的数据要删掉了，但activity的owner_id在引用，那就只能随便变成一个字符串</p>
<p>cascade方式 （常用）<br>在父表上update&#x2F;delete记录时，同步update&#x2F;delete掉子表的匹配记录，比如user删除了id是1的，那么activity也会跟着删除</p>
<p>No action方式（拒绝策略） （很少用）<br>如果子表中有匹配的记录，则不允许对父表对应候选键进行update&#x2F;delete操作  </p>
<p>Restrict方式（拒绝策略） （常用）<br>和no action一样, 都是立即检查外键约束，拒绝删除&#x2F;更新</p>
<p>set null方式 （很少用）<br>在父表上update&#x2F;delete记录时，将子表上匹配记录的列设为null，比如父表删除了，子表找不到就设置为null<br>要注意子表的外键列不能为not null  </p>
<p>主要是为了保证数据的一致性和完整性</p>
<h2 id="加入全局捕获异常"><a href="#加入全局捕获异常" class="headerlink" title="加入全局捕获异常"></a>加入全局捕获异常</h2><p>老师是直接从SpringBoot复制的代码，GlobalExceptionHandler.java，然后修改一些代码，运行代码时可以看到报的异常叫DataIntegrityViolationException，在异常的精确匹配里先导入这个，然后点进去看看继承的父类是什么，最终用DataAccessException。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250810155135081.png" alt="image-20250810155135081"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统一异常处理类，controller发生了异常，统一用该类进行处理</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span> <span class="comment">//aop。拦截标注了@RestController的controller中的所有方法</span></span><br><span class="line"><span class="comment">//@ControllerAdvice //aop。拦截标注了@Controller的controller中的所有方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常处理的方法（controller方法发生了异常，那么就使用该方法来处理）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = Exception.class)</span><span class="comment">//捕获所有异常</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">handException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        e.printStackTrace(); <span class="comment">//在控制台打印异常信息</span></span><br><span class="line">        <span class="keyword">return</span> R.FAIL(e.getMessage());<span class="comment">//返回异常信息</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常的精确匹配，先精确匹配，匹配不到了，就找父类的异常处理</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = DataAccessException.class)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">handException3</span><span class="params">(DataAccessException e)</span> &#123;</span><br><span class="line">        e.printStackTrace(); <span class="comment">//在控制台打印异常信息</span></span><br><span class="line">        <span class="keyword">return</span> R.FAIL(CodeEnum.DATA_ACCESS_EXCEPTION);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后在codeEnum弄个文字，就相当于把异常信息翻译了一下，如果在上面的是return R.FAIL(e.getMessage())就会拿到一大堆异常信息，R.FAIL(CodeEnum.DATA_ACCESS_EXCEPTION);就只说数据库操作失败了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DATA_ACCESS_EXCEPTION(<span class="number">500</span>,<span class="string">&quot;数据库操作失败&quot;</span>),</span><br></pre></td></tr></table></figure>

<p>这样就可以显示删除失败了，然后还想加个失败的原因，就在UserVIew里写，效果：<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250810161412639.png" alt="image-20250810161412639"> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除</span></span><br><span class="line">    del(id)&#123;</span><br><span class="line">      <span class="comment">//删除用户的时候需要有个提示，在util.js里有封装过确认消息提示</span></span><br><span class="line">      messageConfirm(<span class="string">&quot;您确定要删除该数据吗？&quot;</span>).then(() =&gt; &#123;<span class="comment">//用户点击“确定”按钮就会触发then函数</span></span><br><span class="line">        doDelete(<span class="string">&quot;/api/user/&quot;</span> + id, &#123;&#125;).then(resp =&gt; &#123;</span><br><span class="line">          <span class="keyword">if</span> (resp.data.code === <span class="number">200</span>)&#123;</span><br><span class="line">            messageTip(<span class="string">&quot;删除成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">            <span class="comment">//删除成功刷新页面</span></span><br><span class="line">            <span class="built_in">this</span>.reload();</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            messageTip(<span class="string">&quot;删除失败，原因：&quot;</span> + resp.data.msg, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;).<span class="keyword">catch</span>(() =&gt; &#123;<span class="comment">// 用户点击“取消”按钮就会触发catch函数</span></span><br><span class="line">        messageTip(<span class="string">&quot;取消删除&quot;</span>, <span class="string">&quot;warning&quot;</span>);<span class="comment">//messageTip是封装好的消息提示</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h2><p>批量删除就也是点击触发事件和函数，Userview，批量删除是勾选前面的复选框，然后根据复选框的id去删除，而点击复选框的时候会触发一个@selection-change&#x3D;”handleSelectionChange”选择改变事件，触发handleSelectionChange函数，可以去拿一下目前勾选了哪些数据，这个函数不需要括号但是会传参数到函数里，类似于注入</p>
<p>测试的时候发现会拿到重复数据比如1,   1,1.2   1,1.2,1.2.3这样的情况，就是每次点击就会往数组里放数据，数组原有的不会清空，然后把所有选中的都全部放进去，所以只需要以最后一次为准就可以解决，每次触发函数的时候都清空一下数组。</p>
<p>然后还应该在删除前弄个确认删除操作，把del的messageConfirm部分复制过来然后修改就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button type=&quot;danger&quot; @click = &quot;batchDel&quot;&gt;批量删除&lt;/el-button&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="keyword">return</span>&#123;</span><br><span class="line">     <span class="comment">//用户id的数组，数组用中括号</span></span><br><span class="line">     userIdArray : [],</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;,</span><br><span class="line">     </span><br><span class="line"> methods : &#123;</span><br><span class="line">   <span class="comment">//勾选或者取消勾选时，触发该函数（已经勾选的数据或传给我们这个函数）</span></span><br><span class="line">   <span class="comment">//测试的时候发现会拿到重复数据比如1,   1,1.2   1,1.2,1.2.3这样的情况，就是每次点击就会往数组里放数据</span></span><br><span class="line">   <span class="comment">// 数组原有的不会清空，然后把所有选中的都全部放进去，所以只需要以最后一次为准就可以解决，每次触发函数的时候都清空一下数组。</span></span><br><span class="line">   <span class="title function_">handleSelectionChange</span>(<span class="params">selectionDataArray</span>)&#123;</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">userIdArray</span> = [];<span class="comment">//清空数组</span></span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(selectionDataArray);<span class="comment">//控制台打印</span></span><br><span class="line">     selectionDataArray.<span class="title function_">forEach</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;<span class="comment">//selectionDataArray是数组，存着每一行对象，data就是单独一行对象</span></span><br><span class="line">       <span class="keyword">let</span> userId = data.<span class="property">id</span>;<span class="comment">//这个id可以在存起来，就写到上面的data函数变量里</span></span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">userIdArray</span>.<span class="title function_">push</span>(userId);<span class="comment">//js数组放东西是push</span></span><br><span class="line">     &#125;)</span><br><span class="line">     <span class="comment">//alert(this.userIdArray);//选中后会有提示</span></span><br><span class="line">   &#125;,</span><br><span class="line">       </span><br><span class="line">      <span class="comment">//批量删除</span></span><br><span class="line">   <span class="title function_">batchDel</span>(<span class="params"></span>)&#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">userIdArray</span>.<span class="property">length</span> &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">       <span class="comment">//提示一下</span></span><br><span class="line">       <span class="title function_">messageTip</span>(<span class="string">&quot;请选择要删除的数据&quot;</span>, <span class="string">&quot;warning&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span>;<span class="comment">//结束语句</span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="title function_">messageConfirm</span>(<span class="string">&quot;您确定要删除这些数据吗？&quot;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;<span class="comment">//用户点击“确定”按钮就会触发then函数</span></span><br><span class="line">       <span class="comment">//原来是数组：[1,3,5,6,7,11] --&gt; ids = &quot;1,3,5,6,7,11&quot;;</span></span><br><span class="line">       <span class="keyword">let</span> ids = <span class="variable language_">this</span>.<span class="property">userIdArray</span>.<span class="title function_">join</span>(<span class="string">&quot;,&quot;</span>);<span class="comment">//通过join转换成字符串并用逗号分隔</span></span><br><span class="line">       <span class="title function_">doDelete</span>(<span class="string">&quot;/api/user&quot;</span>, &#123;<span class="comment">//传的参数是个数组</span></span><br><span class="line">         ids : ids</span><br><span class="line">       &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;<span class="comment">//这段拷贝的上面del</span></span><br><span class="line">         <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line">           <span class="title function_">messageTip</span>(<span class="string">&quot;批量删除成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">           <span class="comment">//删除成功刷新页面</span></span><br><span class="line">           <span class="variable language_">this</span>.<span class="title function_">reload</span>();</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="title function_">messageTip</span>(<span class="string">&quot;批量删除失败，原因：&quot;</span> + resp.<span class="property">data</span>.<span class="property">msg</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;)</span><br><span class="line">     &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;<span class="comment">// 用户点击“取消”按钮就会触发catch函数</span></span><br><span class="line">       <span class="title function_">messageTip</span>(<span class="string">&quot;取消批量删除&quot;</span>, <span class="string">&quot;warning&quot;</span>);<span class="comment">//messageTip是封装好的消息提示</span></span><br><span class="line">     &#125;)</span><br><span class="line">   &#125;,</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="后端-1"><a href="#后端-1" class="headerlink" title="后端"></a>后端</h3><p>先复制一份代码，把名字改成batchDelUser，传递的参数从UserView里看，点击doDelete转到httpRequest，看到是params传递参数，所以要用@RequestParam</p>
<p>UserController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(value = &quot;/api/user&quot;)</span></span><br><span class="line"><span class="comment">//点击doDelete转到httpRequest，看到是params传递参数，所以要用@RequestParam</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">batchDelUser</span><span class="params">(<span class="meta">@RequestParam(value = &quot;ids&quot;)</span> String ids)</span>&#123;</span><br><span class="line">    <span class="comment">//ids = &quot;1,3,5,6,7,11&quot;，把数组变成list，用逗号分隔</span></span><br><span class="line">    List&lt;String&gt; idList = Arrays.asList(ids.split(<span class="string">&quot;,&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">batchDel</span> <span class="operator">=</span> userService.batchDelUserIds(idList);<span class="comment">//删除数据，删几条就返回几</span></span><br><span class="line">    <span class="keyword">return</span> batchDel &gt;= idList.size() ? R.OK() : R.FAIL();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">batchDelUserIds</span><span class="params">(List&lt;String&gt; idList)</span>;</span><br></pre></td></tr></table></figure>

<p>UserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">batchDelUserIds</span><span class="params">(List&lt;String&gt; idList)</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> tUserMapper.deleteByIds(idList);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>因为没有这个查询语句所以要创建</p>
<p>TUserMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">deleteByIds</span><span class="params">(List&lt;String&gt; idList)</span>;</span><br></pre></td></tr></table></figure>

<p>TUserMapper.xml，传过来的是list</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByIds&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.util.List&quot;</span>&gt;</span></span><br><span class="line">    delete from t_user</span><br><span class="line">    where id in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;idList&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">      #&#123;id,jdbcType=INTEGER&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"></span><br><span class="line">/*       最终效果类似于下面，collection遍历，item取出，开头(结束)，逗号分隔</span><br><span class="line">    delete from t_user</span><br><span class="line">    where id in (1,2,4,5,11)*/</span><br><span class="line">  <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后测试，先点击一下批量删除，提示请选择要删除的数据，然后批量删除时选中admin，提示无法删除，然后选个其他的数据批量删除，提示批量删除成功</p>
<h2 id="数据权限"><a href="#数据权限" class="headerlink" title="数据权限"></a>数据权限</h2><p>管理员可以看到所有用户的信息；</p>
<p>其他人员只能看到自己的信息；</p>
<p>数据权限：sql语句进行过滤，管理员登录查询所有数据，普通用户登录就只查询自己的数据；但因为要每个sql语句都要写一遍，所以要把这个语句用aop的方式提取出来做一个切面，公共的功能</p>
<p>新建一个包角commons，新建一个叫DataScope的Annotation注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjpowernode.commons;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数据范围注解</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span><span class="comment">//这个是注解写在什么地方，写在方法上，这三个是自定义注解的范围</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span><span class="comment">//这个注解在运行时生效</span></span><br><span class="line"><span class="meta">@Documented</span><span class="comment">//生成文档还是啥的</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DataScope &#123;</span><br><span class="line">    <span class="comment">//要在sql语句的末尾添加一个过滤条件</span></span><br><span class="line">    <span class="comment">//select * from t_user （管理员）</span></span><br><span class="line">    <span class="comment">//select * from t_user tu where tu.id = 2 （普通用户：于嫣）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//select * from t_activity （管理员）这个是市场统计表</span></span><br><span class="line">    <span class="comment">//select * from t_activity ta where ta.owner_id = 2 （普通用户：于嫣）owner_id是属于某个人负责的，而2就是负责人的id就是于嫣的id</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 表的别名，比如上面的tu和ta，默认为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">tableAlias</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 表的字段名，就是上面的id和owner_id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">tableField</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后找到UserController的分页查询，添加个注释，然后点击里面的getUserByPage，点左边的箭头，再点selectUserByPage，转到TUserMapper的selectUserByPage，添加代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户列表分页查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> current</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/api/users&quot;)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   TUserMapper:</span><br><span class="line"><span class="meta">@DataScope(tableAlias = &quot;tu&quot;, tableField = &quot;id&quot;)</span><span class="comment">//表名叫tu，根据id过滤</span></span><br><span class="line">   List&lt;TUser&gt; <span class="title function_">selectUserByPage</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>前端传后端是通过Query，使用BaseQuery，添加个字段，这个就是要在sql语句后面拼接一块代码，拼好就传到sql里</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseQuery</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String token;<span class="comment">//也就是jwt</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String filterSQL;<span class="comment">//数据权限的SQL过滤条件：等价于tu.id = 2或者ta.owner_id = 2，需要传sql语句</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在TUserMapper.java里，impl里需要个对象，就需要在Base里弄个建造模式，加上注解，这样就有对象了只不过是空的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TUser&gt; <span class="title function_">selectUserByPage</span><span class="params">(BaseQuery query)</span>;<span class="comment">//加上BaseQuery query就要在impl里也加上</span></span><br></pre></td></tr></table></figure>

<p>impl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TUser&gt; list = tUserMapper.selectUserByPage(BaseQuery.builder().build());<span class="comment">//分页查询，按alt+回车创建查询</span></span><br></pre></td></tr></table></figure>

<p>然后搞过滤条件，过滤条件需要拦截方法，新建一个包aspect，新建DataScopeAspect，拦截这个注解，拦截需要@Pointcut切点注解，但是需要aop的依赖，先导入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--aop--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250811124842334.png" alt="image-20250811124842334"></p>
<p>value写切入点路径</p>
<p>DataScopeAspect，点击JoinPoint然后按ctrl+h可以看到除了JoinPoint父接口还有个ProceedingJoinPoint子接口，用这个。拿到token后需要知道里面的角色，那么就需要在生成token的时候把角色放进去，但生成的时候有没有放角色是不知道的，生成token时是在MyAuthenticationSuccessHandler.java里生成，那么就看tUser里有没有，而tUser的角色来自于登录时有没有放角色，就在UserServiceImpl写一个查询角色。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataScopeAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//aspectJ 实现aop，切入点是切在注解上，</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//切入点,value写切入点路径</span></span><br><span class="line">    <span class="meta">@Pointcut(value = &quot;@annotation(com.bjpowernode.commons.DataScope)&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//环绕增强，把切入点方法传进来</span></span><br><span class="line">    <span class="meta">@Around(value = &quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="comment">//连接点，点击JoinPoint然后按ctrl+h可以看到除了JoinPoint父接口还有个ProceedingJoinPoint子接口，用这个</span></span><br><span class="line">    <span class="comment">//这个连接点可以拿到TUserMapper里的selectUserByPage那个方法</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">process</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//获取签名并转型成方法签名，然后拿到</span></span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">methodSignature</span> <span class="operator">=</span> (MethodSignature) joinPoint.getSignature();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//先拿方法再拿注解</span></span><br><span class="line">        <span class="type">DataScope</span> <span class="variable">dataScope</span> <span class="operator">=</span> methodSignature.getMethod().getDeclaredAnnotation(DataScope.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">tableAlias</span> <span class="operator">=</span> dataScope.tableAlias();<span class="comment">//拿到表的别名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">tableField</span> <span class="operator">=</span> dataScope.tableField();<span class="comment">//拿到表的字段</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//在spring web容器中，可以拿到当前请求的request对象，然后分辨是管理员还是其他人</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//token名字作为常量放在了Constants.java里</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(Constants.TOKEN_NAME);</span><br><span class="line">        <span class="comment">//从token中反向解析出该用户是管理员还是普通用户</span></span><br><span class="line">        <span class="type">TUser</span> <span class="variable">tUser</span> <span class="operator">=</span> JWTUtils.parseUserFromJWT(token);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//拿到用户的角色</span></span><br><span class="line">        List&lt;String&gt; roleList = tUser.getRoleList();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!roleList.contains(<span class="string">&quot;admin&quot;</span>)) &#123;<span class="comment">//不包含admin角色，只查当前用户自己的数据，否则查所有数据</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">params</span> <span class="operator">=</span> joinPoint.getArgs()[<span class="number">0</span>]; <span class="comment">//方法的参数可能有多个所以是数组，这里拿selectUserByPage方法的第一个参数，参数的顺序不可以乱</span></span><br><span class="line">            <span class="keyword">if</span> (params <span class="keyword">instanceof</span> BaseQuery) &#123;<span class="comment">//验证类型</span></span><br><span class="line">                <span class="type">BaseQuery</span> <span class="variable">query</span> <span class="operator">=</span> (BaseQuery)params;<span class="comment">//强制转型</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//效果是select * from t_user tu where tu.id = 2 （普通用户：于嫣），需要加的是tu.id = 2</span></span><br><span class="line">                query.setFilterSQL(<span class="string">&quot; and &quot;</span> + tableAlias + <span class="string">&quot;.&quot;</span> + tableField + <span class="string">&quot; = &quot;</span> + tUser.getId());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;目标方法执行之前....&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();<span class="comment">//这里开始执行查询方法，目标方法</span></span><br><span class="line">        System.out.println(<span class="string">&quot;目标方法执行之后....&quot;</span>);<span class="comment">//执行目标方法之后也会执行，因为是环绕增强</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Constants.java，token名字经常用所以放在这里</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//请求token的名称</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOKEN_NAME</span> <span class="operator">=</span> <span class="string">&quot;Authorization&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>UserServiceImpl先注入TRoleMapper，然后把角色list数组查出来，并创建查询方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> TRoleMapper tRoleMapper;<span class="comment">//查角色的mapper</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>TRoleMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TRole&gt; <span class="title function_">selectByUserId</span><span class="params">(Integer userId)</span>;</span><br></pre></td></tr></table></figure>

<p>TRoleMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--查询用户角色--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByUserId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">  SELECT</span><br><span class="line">    tr.*</span><br><span class="line">  FROM</span><br><span class="line">    t_role tr</span><br><span class="line">      LEFT JOIN t_user_role tur ON tr.id = tur.role_id</span><br><span class="line">  where tur.user_id = #&#123;userId, jdbcType=INTEGER&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在上面能拿到角色并拼接后，可以在这里加个where条件，这个where条件普通用户才会触发，里面的数据用占位符拿到，也就是BaseQuery的filterSQL</p>
<p>TUserMapper</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByPage&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">      <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        $&#123;filterSQL&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span> /&gt;</span></span><br><span class="line">  from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后运行程序，报错<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250813165702335.png" alt="image-20250813165702335"> </p>
<p>就是必须要给查询语句取个别名为tu</p>
<p>TUserMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByPage&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">  <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span> /&gt;</span></span><br><span class="line">  from t_user tu</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    $&#123;filterSQL&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>要是需要打印sql语句可以去application配置一下</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">#指定mapper.xml文件的位置</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">    <span class="attr">configuration:</span></span><br><span class="line">      <span class="comment">#在控制台打印sql语句</span></span><br><span class="line">      <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>

<h1 id="市场活动"><a href="#市场活动" class="headerlink" title="市场活动"></a>市场活动</h1><p>市场活动就是为了汽车销售进行的一些销售活动，比如：在一些网站投放广告、抖音上直播、线下车展、零首付活动、以旧换新活动…….，目的是为了销售汽车，提高销售额，获取更大市场份额，让更多消费者认识xx品牌，提高知名度等；</p>
<p>1、市场活动数据分页展示; （OK）</p>
<p>2、市场活动的搜索；（OK）</p>
<p>3、录入市场活动；（OK）</p>
<p>4、编辑市场活动；（OK）</p>
<p>5、查看市场活动详情；（OK）</p>
<p>6、市场活动备注（包括备注信息的编辑、删除）；（OK）</p>
<p>7、删除市场活动；</p>
<p>8、批量删除市场活动；</p>
<h2 id="页面制作"><a href="#页面制作" class="headerlink" title="页面制作"></a>页面制作</h2><p>先做个点击跳转页面，要点击跳转的话得记得启动路由模式:router&#x3D;”true”，然后也是右边中间的页面变化，所以属于子路由，在router.js里添加代码跳转到ActivityView，并创建ActivityView</p>
<p>DashboardView</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-menu-item index=&quot;/dashboard/activity&quot;&gt;</span><br><span class="line">   &lt;el-icon&gt;&lt;Notification /&gt;&lt;/el-icon&gt;&lt;!--图标--&gt;</span><br><span class="line">   市场活动</span><br><span class="line">   &lt;/el-menu-item&gt;</span><br></pre></td></tr></table></figure>

<p>router.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">//路由路径，子路由路径不能以斜杠开头</span></span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;activity&#x27;</span>,</span><br><span class="line">    <span class="comment">//路由路径所对应的页面</span></span><br><span class="line">    component : <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/ActivityView.vue&#x27;</span>),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>然后找个行内表单，横着的那种，第一个是相关负责人，所以把select的相关的放到第一个，日期的话需要开始和结束时间连一起的那种，就找DateTimePicker 日期时间选择器的下拉列表中的日期和时间格式，如果选不上就要调整model，重置需要没有背景色的，看按钮代码里有个plain，写进去就行。其他的表格和之前用户管理的一摸一样，直接复制就行。然后调试页面发现按钮部分的删除被隐藏了，是因为show-overflow-tooltip代码，过长就被隐藏，所以删除，但是因为宽度不够导致删除换行，就需要在操作那里设置宽度，分页查询的代码也复制一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;!--  inline是一行，activityQuery是名字，需要定义，还有个demo样式用不上就删了--&gt;</span><br><span class="line">  &lt;el-form :inline=&quot;true&quot; :model=&quot;activityQuery&quot; class=&quot;demo-form-inline&quot;&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;负责人&quot;&gt;</span><br><span class="line">      &lt;!--  model是上面定义的，placeholder是提示语    --&gt;</span><br><span class="line">      &lt;el-select</span><br><span class="line">          v-model=&quot;activityQuery.ownerId&quot;</span><br><span class="line">          placeholder=&quot;请选择负责人&quot;</span><br><span class="line">          clearable&gt;</span><br><span class="line">        &lt;el-option label=&quot;Zone one&quot; value=&quot;shanghai&quot; /&gt;</span><br><span class="line">        &lt;el-option label=&quot;Zone two&quot; value=&quot;beijing&quot; /&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;活动名称&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;activityQuery.user&quot; placeholder=&quot;请输入活动名称&quot; clearable /&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--type是类型范围，start-placeholder开始时间提示语--&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;活动时间&quot;&gt;</span><br><span class="line">      &lt;el-date-picker</span><br><span class="line">          v-model=&quot;activityQuery.startTime&quot;</span><br><span class="line">          type=&quot;datetimerange&quot;</span><br><span class="line">          start-placeholder=&quot;开始时间&quot;</span><br><span class="line">          end-placeholder=&quot;结束时间&quot;</span><br><span class="line">          format=&quot;YYYY-MM-DD HH:mm:ss&quot;</span><br><span class="line">          date-format=&quot;YYYY/MM/DD ddd&quot;</span><br><span class="line">          time-format=&quot;A hh:mm:ss&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;活动预算&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;activityQuery.cost&quot; placeholder=&quot;请输入活动预算&quot; clearable /&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;创建时间&quot;&gt;</span><br><span class="line">      &lt;el-date-picker</span><br><span class="line">          v-model=&quot;activityQuery.createTime&quot;</span><br><span class="line">          type=&quot;datetime&quot;</span><br><span class="line">          placeholder=&quot;请选择创建时间&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--plain是没有背景色的意思--&gt;</span><br><span class="line">    &lt;el-form-item&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;onSearch&quot;&gt;搜 索&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; plain @click=&quot;onReset&quot;&gt;重 置&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">  &lt;/el-form&gt;</span><br><span class="line"></span><br><span class="line">  &lt;el-button type=&quot;primary&quot; @click=&quot;add&quot;&gt;录入市场活动&lt;/el-button&gt;</span><br><span class="line">  &lt;el-button type=&quot;danger&quot; @click = &quot;batchDel&quot;&gt;批量删除&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!--ref=&quot;multipleTableRef&quot;是html的属性可以删掉--&gt;</span><br><span class="line">  &lt;!--想要data数据就要去data定义--&gt;</span><br><span class="line">  &lt;el-table</span><br><span class="line">      :data=&quot;activityList&quot;</span><br><span class="line">      row-key=&quot;id&quot;</span><br><span class="line">      style=&quot;width: 100%&quot;</span><br><span class="line">      @selection-change=&quot;handleSelectionChange&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-table-column type=&quot;selection&quot; :selectable=&quot;selectable&quot; width=&quot;55&quot; /&gt;</span><br><span class="line">    &lt;!-- &lt;el-table-column label=&quot;序号&quot; width=&quot;120&quot;&gt;</span><br><span class="line">      &lt;template #default=&quot;scope&quot;&gt;&#123;&#123; scope.row.date &#125;&#125;&lt;/template&gt;</span><br><span class="line">    &lt;/el-table-column&gt;这个是插槽模式，现在暂时不用，先用下面的这种--&gt;</span><br><span class="line">    &lt;!--show-overflow-tooltip单元格内容过长时会隐藏多余内容--&gt;</span><br><span class="line">    &lt;el-table-column type=&quot;index&quot; label=&quot;序号&quot; width=&quot;60&quot; /&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;loginAct&quot; label=&quot;负责人&quot;  /&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;name&quot; label=&quot;活动名称&quot; show-overflow-tooltip/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;phone&quot; label=&quot;开始时间&quot; show-overflow-tooltip/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;email&quot; label=&quot;结束时间&quot; show-overflow-tooltip/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;email&quot; label=&quot;活动预算&quot; show-overflow-tooltip/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;createTime&quot; label=&quot;创建时间&quot; show-overflow-tooltip/&gt;</span><br><span class="line">    &lt;el-table-column label=&quot;操作&quot; width=&quot;230&quot;&gt;&lt;!--操作不需要显示信息，就不加property了--&gt;</span><br><span class="line">      &lt;!--这个是插槽，给插槽添加按钮和点击时间后，view里的括号是用来接收id参数的，也就是查看哪个用户的详情，通过scope.row拿到数据，再拿到id--&gt;</span><br><span class="line">      &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;view(scope.row.id)&quot;&gt;详情&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;success&quot; @click=&quot;edit(scope.row.id)&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;danger&quot; @click=&quot;del(scope.row.id)&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-table-column&gt;</span><br><span class="line">  &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">  &lt;el-pagination</span><br><span class="line">      background</span><br><span class="line">      layout=&quot;prev, pager, next&quot;</span><br><span class="line">      :page-size=&quot;pageSize&quot;</span><br><span class="line">      :total=&quot;total&quot;</span><br><span class="line">      @prev-click=&quot;toPage&quot;</span><br><span class="line">      @next-click=&quot;toPage&quot;</span><br><span class="line">      @current-change=&quot;toPage&quot;</span><br><span class="line">  /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;doGet&#125; from &quot;../http/httpRequest.js&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;ActivityView&quot;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      //市场活动搜索表单对象，初始值是空</span><br><span class="line">      activityQuery : &#123;&#125;,</span><br><span class="line">      //市场活动列表对象，初始值是空</span><br><span class="line">      activityList : [&#123;</span><br><span class="line"></span><br><span class="line">      &#125;],</span><br><span class="line">      //分页时每页显示多少条数据</span><br><span class="line">      pageSize : 0,</span><br><span class="line">      //分页总共查询出多少条数据</span><br><span class="line">      total : 0,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  //页面渲染时分页查询</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    this.getData(1);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods : &#123;</span><br><span class="line">    //查询用户列表数据</span><br><span class="line">    getData(current)&#123;</span><br><span class="line">      doGet(&quot;/api/activitys&quot;, &#123;</span><br><span class="line">        current : current//当前查询第几页，值从方法传过来</span><br><span class="line">      &#125;).then(resp =&gt; &#123;</span><br><span class="line">        if(resp.data.code === 200)&#123;</span><br><span class="line">          this.activityList = resp.data.data.list;</span><br><span class="line">          this.pageSize = resp.data.data.pageSize;</span><br><span class="line">          this.total = resp.data.data.total;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    //分页函数(current这个参数是ele-plus组件传过来，就是传的当前页)</span><br><span class="line">    toPage(current) &#123;</span><br><span class="line">      this.getData(current);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="后端-2"><a href="#后端-2" class="headerlink" title="后端"></a>后端</h3><p>开发的时候有个原则，要让每个类的职责单一，新建ActivityController.java，查询方法和用户列表分页查询是一样的，可以复制，查的对象是TActivity，在注入的时候可以用idea插件 Easy Code 插件生成全部代码，但怕新手接受不了，就手敲了，选interface生成，设置路径，创建getActivityByPage方法，然后创建impl，查询语句因为用的是插件生成的所以都是固定的，直接从UserServiceImpl复制，修改好名字后创建</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250818170229568.png" alt="image-20250818170229568"> getActivityByPage查询方法，</p>
<p>ActivityController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivityController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ActivityService activityService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户列表分页查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> current</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/api/activitys&quot;)</span></span><br><span class="line">    <span class="comment">//从userView传过来一个参数current，也就是接收分页参数，这个参数是通过get请求传过来的，就可以通过@RequestParam接收参数</span></span><br><span class="line">    <span class="comment">// 传过来的结果是1，就用Integer接收</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">activityPage</span><span class="params">(<span class="meta">@RequestParam(value = &quot;current&quot;, required = false)</span> Integer current)</span>&#123;</span><br><span class="line">        <span class="comment">//required = false表示参数可以传也可以不传</span></span><br><span class="line">        <span class="comment">//required = true 表示参数必须传，否则报错，默认是true</span></span><br><span class="line">        <span class="keyword">if</span>(current == <span class="literal">null</span>)&#123;</span><br><span class="line">            current = <span class="number">1</span>;<span class="comment">//变成默认是1</span></span><br><span class="line">        &#125;</span><br><span class="line">        PageInfo&lt;TActivity&gt; pageInfo = activityService.getActivityByPage(current);</span><br><span class="line">        <span class="keyword">return</span> R.OK(pageInfo);<span class="comment">//pageInfo获得返回的数据，然后传到前台</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ActivityService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Easy Code 插件（Idea插件生成  controller 、service、dao）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ActivityService</span> &#123;</span><br><span class="line">    PageInfo&lt;TActivity&gt; <span class="title function_">getActivityByPage</span><span class="params">(Integer current)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ActivityServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivityServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ActivityService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TActivityMapper tActivityMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageInfo&lt;TActivity&gt; <span class="title function_">getActivityByPage</span><span class="params">(Integer current)</span> &#123;</span><br><span class="line">        <span class="comment">//这条方法是通过接口里的方法去按alt+insert然后选实现方法来创建的</span></span><br><span class="line">        <span class="comment">// 1.设置PageHelper</span></span><br><span class="line">        PageHelper.startPage(current, Constants.PAGE_SIZE);</span><br><span class="line">        <span class="comment">// 2.查询</span></span><br><span class="line">        List&lt;TActivity&gt; list = tActivityMapper.selectActivityByPage(BaseQuery.builder().build());<span class="comment">//分页查询，按alt+回车创建查询</span></span><br><span class="line">        <span class="comment">// 3.封装分页数据到PageInfo</span></span><br><span class="line">        PageInfo&lt;TActivity&gt; info = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(list);</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TActivityMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加aop过滤条件，起表的别名为ta，owner_id是负责人id也就是当前登录人id</span></span><br><span class="line"><span class="meta">@DataScope(tableAlias = &quot;ta&quot;, tableField = &quot;owner_id&quot;)</span></span><br><span class="line">List&lt;TActivity&gt; <span class="title function_">selectActivityByPage</span><span class="params">(BaseQuery query)</span>;</span><br></pre></td></tr></table></figure>

<p>\TActivityMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--要写一个过滤条件，aop的什么数据权限拦截。parameterType=&quot;java.lang.Integer&quot;可以省略，因为没有传参数，但如果要写的话得写baseQuery参数，写就要写对--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--起个别名叫ta--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectActivityByPage&quot;</span>  <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">  <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span> /&gt;</span></span><br><span class="line">  from t_activity ta</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    $&#123;filterSQL&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后测试代码，如果没有显示数据，对应的类型再调整一下，然后再测试，yuyan的只显示两条没问题，admin显示所有没问题，但是负责人都是id而不是名字，所以要关联用户表，重新设置查询语句，查询语句因为要查询两个字段，所以映射不符合要求，要重新弄个一对一映射<br>TAcitivity.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;ActivityResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.bjpowernode.model.TActivity&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;owner_id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;ownerId&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;start_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;startTime&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;end_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;endTime&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cost&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;DECIMAL&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cost&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_by&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createBy&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;edit_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;editTime&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;edit_by&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;editBy&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  一对一关联  --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--查出来叫owner_id对应到user对象里是id，ownerName对应是name--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;ownerDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TUser&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;owner_id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;ownerName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--要写一个过滤条件，aop的什么数据权限拦截。parameterType=&quot;java.lang.Integer&quot;可以省略，因为没有传参数，但如果要写的话得写baseQuery参数，写就要写对--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--起个别名叫ta--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectActivityByPage&quot;</span>  <span class="attr">resultMap</span>=<span class="string">&quot;ActivityResultMap&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">  ta.*,</span><br><span class="line">  tu.id ownerId, tu.name ownerName</span><br><span class="line">  from t_activity ta left join t_user tu on ta.owner_id = tu.id</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    $&#123;filterSQL&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>TAcitivity.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  *一对一关联</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">private</span> TUser ownerDO;</span><br></pre></td></tr></table></figure>

<p>弄好后把前端的负责人重新弄一下，这样就显示了负责人名称<br>ActivityView.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table-column property=&quot;ownerDO.name&quot; label=&quot;负责人&quot;  /&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ActivityView&quot;</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="comment">//市场活动搜索表单对象，初始值是空</span></span><br><span class="line">      activityQuery : &#123;&#125;,</span><br><span class="line">      <span class="comment">//市场活动列表对象，初始值是空，里面的大括号表示user，user放个ownerDO，上面的负责人就可以是ownerDO.name</span></span><br><span class="line">      activityList : [&#123;</span><br><span class="line">        ownerDO : &#123;&#125;</span><br><span class="line">      &#125;],</span><br></pre></td></tr></table></figure>

<p>然后发现页面高度不太合适，就把样式拷贝过来，上面的按钮也和点击的表格太近了，弄点距离</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;/script&gt;</span><br><span class="line">.<span class="property">el</span>-form&#123;</span><br><span class="line">  margin-<span class="attr">bottom</span>: 20px;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">el</span>-table&#123;</span><br><span class="line">  margin-<span class="attr">top</span>: 12px;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">el</span>-pagination&#123;</span><br><span class="line">  margin-<span class="attr">top</span>: 12px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="搜索查询"><a href="#搜索查询" class="headerlink" title="搜索查询"></a>搜索查询</h2><p>想实现效果点击负责人就显示下拉列表所有负责人的名字然后选择，可以先设置一个点击事件，数据的渲染参考之前用户对话框的做法，里面有个账号未过期的v-for循环</p>
<p>ActivityView.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-select</span><br><span class="line">    v-model=&quot;activityQuery.ownerId&quot;</span><br><span class="line">    placeholder=&quot;请选择负责人&quot;</span><br><span class="line">    @click=&quot;loadOwner&quot;</span><br><span class="line">    clearable&gt;</span><br><span class="line">  &lt;!-- ownerOptions是循环的数组，item是数据，然后就是负责人的名字和id值，key是提高渲染效率，给个唯一值，用id就行--&gt;</span><br><span class="line">  &lt;el-option</span><br><span class="line">      v-for=&quot;item in ownerOptions&quot;</span><br><span class="line">      :key=&quot;item.id&quot;</span><br><span class="line">      :label=&quot;item.name&quot;</span><br><span class="line">      :value=&quot;item.id&quot;/&gt;</span><br><span class="line">&lt;/el-select&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ActivityView&quot;</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="comment">//负责人的下拉列表数据</span></span><br><span class="line">      ownerOptions : [&#123;&#125;],</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">    </span><br><span class="line"> methods : &#123;</span><br><span class="line">  <span class="comment">//加载负责人</span></span><br><span class="line">  <span class="title function_">loadOwner</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">doGet</span>(<span class="string">&quot;/api/owner&quot;</span>, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>)  &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ownerOptions</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="后端-3"><a href="#后端-3" class="headerlink" title="后端"></a>后端</h3><p>负责人属于用户，所以查用户表<br>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/api/owner&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> R <span class="title function_">owner</span><span class="params">()</span> &#123;</span><br><span class="line">     List&lt;TUser&gt; ownerList = userService.getOwnerList();</span><br><span class="line">     <span class="keyword">return</span> R.OK(ownerList);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TUser&gt; <span class="title function_">getOwnerList</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>UserServiceImpl，这里要加一个缓存功能，先去redis里查，如果查不到就去数据库查。从redis里查时可以通过manager层去查，适合第二条的缓存方案<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="动力云客项目.assets/image-20250820021539205.png" alt="image-20250820021539205" style="zoom:67%;" /></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedisManager redisManager;</span><br><span class="line"></span><br><span class="line"><span class="comment">//缓存</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;TUser&gt; <span class="title function_">getOwnerList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//1.从redis查询</span></span><br><span class="line">    <span class="comment">//2、redis查不到，就从数据库查询，并且把数据放入redis（5分钟过期）</span></span><br><span class="line">    <span class="comment">//使用Lambda表达式实现这个方法，第一步拷贝参数列表，第二步加个箭头，第三步加个大括号，第二个也是生产者，同样的步骤，第三个是接受一个数据没有返回值</span></span><br><span class="line">    <span class="keyword">return</span> CacheUtils.getCacheData( () -&gt; &#123;</span><br><span class="line">        <span class="comment">//生产，从redis查询数据，返回因为是(List&lt;TUser&gt;)所以要强制转换</span></span><br><span class="line">        <span class="keyword">return</span> (List&lt;TUser&gt;)redisManager.getValue(Constants.REDIS_OWNER_KEY);</span><br><span class="line">    &#125;,</span><br><span class="line">    () -&gt; &#123;</span><br><span class="line">    <span class="comment">//生产，从mysql查询数据</span></span><br><span class="line">        <span class="keyword">return</span> (List&lt;TUser&gt;)tUserMapper.selectByOwner();</span><br><span class="line">    &#125;,</span><br><span class="line">    (t) -&gt; &#123;</span><br><span class="line">    <span class="comment">//消费，把数据放入缓存redis，(T t)的T可以省略，会自动设置类型</span></span><br><span class="line">        redisManager.setValue(Constants.REDIS_OWNER_KEY, t);</span><br><span class="line">    &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在util新建一个CacheUtils工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 带有缓存的查询工具方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cacheSelector</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> databaseSelector</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cacheSave</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//T是泛型，使用时要加个&lt;T&gt;修饰符否则报错，Supplier是生产者，一个从缓存查一个从数据库查，Consumer是消费者，存储到缓存里</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getCacheData</span><span class="params">(Supplier&lt;T&gt; cacheSelector, Supplier&lt;T&gt; databaseSelector, Consumer&lt;T&gt; cacheSave)</span> &#123;</span><br><span class="line">        <span class="comment">//从redis查询</span></span><br><span class="line">        <span class="type">T</span> <span class="variable">data</span> <span class="operator">=</span> cacheSelector.get();</span><br><span class="line">        <span class="comment">//如果redis没查到</span></span><br><span class="line">        <span class="comment">//if (Object.isNull(data)) &#123;这个方法判断不了list，因为对象是有的但是没有值ObjectUtils是Spring提供的方法，底层是如果是个集合，就用isEmpty判断有没有元素</span></span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isEmpty(data)) &#123;</span><br><span class="line">            <span class="comment">//从数据库查</span></span><br><span class="line">            data = databaseSelector.get();</span><br><span class="line">            <span class="comment">//数据库查到了数据</span></span><br><span class="line">            <span class="keyword">if</span> (!ObjectUtils.isEmpty(data)) &#123;</span><br><span class="line">                <span class="comment">//把数据放入redis</span></span><br><span class="line">                cacheSave.accept(data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回数据</span></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在manager新建一个RedisManager</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisManager</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//String, Object是key键</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getValue</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="comment">//常用的五种类型：string，list，hash，set，zset，思考应该用哪个，string就是一长串，list是一个一个，hash是键值对</span></span><br><span class="line">        <span class="comment">//这里用String，因为直接拿个key可以直接把里面的值拿出来，拿出来就是个list，0到-1就可以拿到所有的值，返回list（按住ctrl鼠标放在range上可以看到返回什么）</span></span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForList().range(key, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这个是保存缓存里的方法</span></span><br><span class="line">    <span class="comment">//之前参数是String key, Object data，把他变成了一个集合</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; Object <span class="title function_">setValue</span><span class="params">(String key,  Collection&lt;T&gt; data)</span> &#123;</span><br><span class="line">        <span class="comment">//把传进来的data转换成数组，否则会以1条list的形式传所有数据，这样就变成了一条一条传</span></span><br><span class="line">        Object[] t  = <span class="keyword">new</span> <span class="title class_">Object</span>[data.size()];</span><br><span class="line">        data.toArray(t);</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForList().leftPushAll(key, t);<span class="comment">//这里查出来可能是倒序，变正序用rightPushAll</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>起一个常量，是负责人的key<br>Constants，创建常量可以直接输psf然后回车</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//redis中负责人的key</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REDIS_OWNER_KEY</span> <span class="operator">=</span> <span class="string">&quot;dlyk:user:owner&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>生成selectByOwner，TUserMapper.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TUser&gt; <span class="title function_">selectByOwner</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>TUserMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--查所有负责人，没有传参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByOwner&quot;</span>  <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">      id, name</span><br><span class="line">  from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="市场活动搜索过滤条件"><a href="#市场活动搜索过滤条件" class="headerlink" title="市场活动搜索过滤条件"></a>市场活动搜索过滤条件</h3><p>活动预算应该规范格式，不能输入英文只能输入数子,然后做一下搜索查询，而这个方法最终是以TActivity为模型的，里面的字段要符合，所以更改activityQuery.user为activityQuery.name，再弄几个字段就可以了，这四个参数需要在后台接受一下，新建一个ActivityQuery接收一下<br>ActivityView：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  inline是一行，activityQuery是名字，需要定义，还有个demo样式用不上就删了，添加rules规则规范输入格式--&gt;</span><br><span class="line">  &lt;el-form :inline=&quot;true&quot; :model=&quot;activityQuery&quot; :rules=&quot;activityRules&quot;&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;负责人&quot;&gt;</span><br><span class="line">       </span><br><span class="line">    &lt;el-form-item label=&quot;活动名称&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;activityQuery.name&quot; placeholder=&quot;请输入活动名称&quot; clearable /&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;el-form-item label=&quot;活动时间&quot;&gt;</span><br><span class="line">      &lt;el-date-picker</span><br><span class="line">          v-model=&quot;activityQuery.activityTime&quot; ~~~</span><br><span class="line">     &lt;/el-form-item&gt;</span><br><span class="line">        </span><br><span class="line">     &lt;!--prop是验证--&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;活动预算&quot; prop=&quot;cost&quot;&gt;</span><br><span class="line">        </span><br><span class="line">   </span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ActivityView&quot;</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="comment">//定义市场活动搜索表单验证规则</span></span><br><span class="line">      activityRules : &#123;</span><br><span class="line">        cost : [</span><br><span class="line">          <span class="comment">//正则表达式，从网上找，或者AI工具找，找到后需要测试一下，因为有可能找到的正则有问题</span></span><br><span class="line">          &#123; pattern : <span class="regexp">/^[0-9]+(\.[0-9]&#123;2&#125;)?$/</span>, <span class="attr">message</span>: <span class="string">&#x27;活动预算必须是整数或者两位小数&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,   </span><br><span class="line">        </span><br><span class="line">    methods : &#123;</span><br><span class="line">    <span class="comment">//查询用户列表数据</span></span><br><span class="line">    <span class="title function_">getData</span>(<span class="params">current</span>)&#123;</span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/activitys&quot;</span>, &#123;</span><br><span class="line">        current : current,<span class="comment">//当前查询第几页，值从方法传过来</span></span><br><span class="line">        ownerId : <span class="variable language_">this</span>.<span class="property">activityQuery</span>.<span class="property">ownerId</span> ,<span class="comment">//传负责人</span></span><br><span class="line">        activityTime : <span class="variable language_">this</span>.<span class="property">activityQuery</span>.<span class="property">activityTime</span>,<span class="comment">//活动时间可能传过来的是字符串</span></span><br><span class="line">        cost : <span class="variable language_">this</span>.<span class="property">activityQuery</span>.<span class="property">cost</span>,<span class="comment">//预算</span></span><br><span class="line">        createTime : <span class="variable language_">this</span>.<span class="property">activityQuery</span>.<span class="property">createTime</span>,<span class="comment">//创建时间 </span></span><br></pre></td></tr></table></figure>

<p>ActivityQuery</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivityQuery</span> <span class="keyword">extends</span> <span class="title class_">BaseQuery</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer ownerId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String activityTIme;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BigDecimal cost;<span class="comment">//和钱相关的都要用BigDecimal</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>搜索查询的时候调用的是查活动分页的方法&#x2F;api&#x2F;activitys，在ActivityController里新加个接收参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> R <span class="title function_">activityPage</span><span class="params">(<span class="meta">@RequestParam(value = &quot;current&quot;, required = false)</span> Integer current, ActivityQuery activityQuery)</span>&#123;</span><br></pre></td></tr></table></figure>

<p>然后测试开始和结合时间出现了跨域问题，可以先打印时间看看，发现是个Object对象，老师让查js遍历对象的几种方法，可以看到key是String类型，然后根据key去设置循环赋值。活动时间里的格式只留一个value-format，这个是设置传给后端的日期格式，具体用法看文档，也要注意前端的格式和后端的格式大小写是有区别的，写好后测试时间看看有没有传过来值，结果报了错，是创建时间有错误并且String无法转换成date，需要把创建时间也弄上格式传给后台就行了<br>ActivityView</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250823010834062.png" alt="image-20250823010834062"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">    &lt;el-form-item label=<span class="string">&quot;活动时间&quot;</span>&gt;</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">el-date-picker</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">v-model</span>=<span class="string">&quot;activityQuery.activityTime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;datetimerange&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">start-placeholder</span>=<span class="string">&quot;开始时间&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">end-placeholder</span>=<span class="string">&quot;结束时间&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value-format</span>=<span class="string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span>/&gt;</span></span></span><br><span class="line">    &lt;/el-form-item&gt;  </span><br><span class="line"></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;创建时间&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-date-picker</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">v-model</span>=<span class="string">&quot;activityQuery.createTime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;datetime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">placeholder</span>=<span class="string">&quot;请选择创建时间&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value-format</span>=<span class="string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">methods : &#123;</span><br><span class="line">    <span class="comment">//查询用户列表数据</span></span><br><span class="line">    <span class="title function_">getData</span>(<span class="params">current</span>)&#123;</span><br><span class="line">      <span class="comment">//测试开始和结合时间出现了跨域问题，可以先打印时间看看，用下面的这些输出了&#123;0: Thu Aug 07 2025 00:00:00 GMT+0800 (中国标准时间), 1: Thu Sep 25 2025 00:00:00 GMT+0800 (中国标准时间)&#125;</span></span><br><span class="line">      <span class="comment">//0和1相当于字段值，0是开始1是结束</span></span><br><span class="line">      <span class="comment">// console.log(this.activityQuery.activityTime);//打印时间数据</span></span><br><span class="line">      <span class="comment">// console.log(typeof  this.activityQuery.activityTime);//打印时间类型</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> startTime = <span class="string">&#x27;&#x27;</span>;<span class="comment">//开始时间</span></span><br><span class="line">      <span class="keyword">let</span> endTime = <span class="string">&#x27;&#x27;</span>; <span class="comment">//结束时间</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">activityQuery</span>.<span class="property">activityTime</span>) &#123;</span><br><span class="line">        <span class="comment">// console.log(typeof key);//从控制台输出key的类型可以看到是String</span></span><br><span class="line">        <span class="keyword">if</span> (key === <span class="string">&#x27;0&#x27;</span>) &#123;</span><br><span class="line">          startTime = <span class="variable language_">this</span>.<span class="property">activityQuery</span>.<span class="property">activityTime</span>[key];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (key === <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">          endTime = <span class="variable language_">this</span>.<span class="property">activityQuery</span>.<span class="property">activityTime</span>[key];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/activitys&quot;</span>, &#123;</span><br><span class="line">        current : current,<span class="comment">//当前查询第几页，值从方法传过来</span></span><br><span class="line">        <span class="comment">//6个搜索条件参数</span></span><br><span class="line">        ownerId : <span class="variable language_">this</span>.<span class="property">activityQuery</span>.<span class="property">ownerId</span> ,<span class="comment">//传负责人</span></span><br><span class="line">        name : <span class="variable language_">this</span>.<span class="property">activityQuery</span>.<span class="property">name</span>,</span><br><span class="line">        startTime : startTime,</span><br><span class="line">        endTime  : endTime,</span><br><span class="line">        <span class="comment">//activityTime : this.activityQuery.activityTime,//活动时间可能传过来的是字符串，出现跨域问题，所以不用这个了</span></span><br><span class="line">        cost : <span class="variable language_">this</span>.<span class="property">activityQuery</span>.<span class="property">cost</span>,<span class="comment">//预算</span></span><br><span class="line">        createTime : <span class="variable language_">this</span>.<span class="property">activityQuery</span>.<span class="property">createTime</span>,<span class="comment">//创建时间，上面四个传递给ActivityQuery</span></span><br><span class="line">      &#125;    </span><br></pre></td></tr></table></figure>

<p>然后就是传到后台ActivityQuery</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Integer ownerId;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Date startTime;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Date endTime;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> BigDecimal cost;<span class="comment">//和钱相关的都要用BigDecimal</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Date createTime;</span><br></pre></td></tr></table></figure>

<p>以上设置完后添加断电测试搜索，看到activityQuery拿到了值，就可以放到下面的方法里，这样的话对应的方法都要多加个参数，而在ActivityServiceImpl里，之前是在selectActivityByPage查询里弄了个空的BaseQuery，但是ActivityQuery是继承了BaseQuery，就可以直接把activityQuery传进来，再点进selectActivityByPage看到用的是BaseQuery，改成ActivityQuery，然后在对应的xml里写对应的if判断语句和模糊匹配<br>ActivityController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PageInfo&lt;TActivity&gt; pageInfo = activityService.getActivityByPage(current, activityQuery);</span><br></pre></td></tr></table></figure>

<p>ActivityService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PageInfo&lt;TActivity&gt; <span class="title function_">getActivityByPage</span><span class="params">(Integer current, ActivityQuery activityQuery)</span>;</span><br></pre></td></tr></table></figure>

<p>ActivityServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageInfo&lt;TActivity&gt; <span class="title function_">getActivityByPage</span><span class="params">(Integer current, ActivityQuery activityQuery)</span> &#123;</span><br></pre></td></tr></table></figure>
<pre><code>             List&lt;TActivity&gt; list = tActivityMapper.selectActivityByPage(activityQuery);//分页查询，按alt+回车创建查询   
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">TActivityMapper</span><br><span class="line">~~~java</span><br><span class="line">    @DataScope(tableAlias = &quot;ta&quot;, tableField = &quot;owner_id&quot;)    </span><br><span class="line">	List&lt;TActivity&gt; selectActivityByPage(ActivityQuery query);</span><br></pre></td></tr></table></figure>

<p>TActivityMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectActivityByPage&quot;</span>  <span class="attr">resultMap</span>=<span class="string">&quot;ActivityResultMap&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">    ta.*,</span><br><span class="line">    tu.id ownerId, tu.name ownerName</span><br><span class="line">    from t_activity ta left join t_user tu on ta.owner_id = tu.id</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--查询的数据都来自活动表，加ta，ownerId是负责人id， #&#123;ownerId&#125;是传过来的值，like是模糊查询 ，concat是连接，就类似&#x27;%推广%&#x27;这样的效果--&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--开始结束的不等号类似于区间，结束时间的&lt;=可能会报错，需要转义一下，用&lt;![CDATA[ ]]&gt;括起来，创建时间用&gt;=是在数据库里我输入创建时间之后的数据，但不清楚是不是=  --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;ownerId  != null&quot;</span>&gt;</span></span><br><span class="line">        and ta.owner_id = #&#123;ownerId&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name  != null&quot;</span>&gt;</span></span><br><span class="line">        and ta.name like concat (&#x27;%&#x27;, #&#123;name&#125;, &#x27;%&#x27;)</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;startTime  != null&quot;</span>&gt;</span></span><br><span class="line">        and ta.start_time &gt;= #&#123;startTime&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;endTime  != null&quot;</span>&gt;</span></span><br><span class="line">        &lt;![CDATA[  and ta.end_time &lt;= #&#123;endTime&#125;  ]]&gt;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;cost  != null&quot;</span>&gt;</span></span><br><span class="line">        and ta.cost &gt;= #&#123;cost&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;createTime  != null&quot;</span>&gt;</span></span><br><span class="line">        and ta.create_time &gt;= #&#123;createTime&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      $&#123;filterSQL&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="日期的国际化（中文）"><a href="#日期的国际化（中文）" class="headerlink" title="日期的国际化（中文）"></a>日期的国际化（中文）</h2><p>要弄个中文插件，在饿了么的指南里，进阶有个国际化，</p>
<p>1、在main.js中导入国际化的中文包</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入element-plus国际化的中文包组件</span></span><br><span class="line"><span class="keyword">import</span> zhCn <span class="keyword">from</span> <span class="string">&#x27;element-plus/dist/locale/zh-cn.mjs&#x27;</span></span><br></pre></td></tr></table></figure>

<p>2、在app对象使用ElementPlus的时候，要指定使用的语言环境<br>app.use(ElementPlus, {<br>  locale: zhCn,<br>})</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>, &#123;locale : zhCn&#125;).<span class="title function_">use</span>(router).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="录入市场活动页面"><a href="#录入市场活动页面" class="headerlink" title="录入市场活动页面"></a>录入市场活动页面</h2><p>点击录入市场活动就会跳转路由页面，添加子路由<br>ActivityView.vue</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">methods : &#123;</span><br><span class="line">  <span class="comment">//录入市场活动</span></span><br><span class="line">  <span class="title function_">add</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//跳转到指定页面</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&quot;/dashboard/activity/add&quot;</span>);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>router.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="comment">//路由路径，子路由路径不能以斜杠开头</span></span><br><span class="line">     <span class="attr">path</span>: <span class="string">&#x27;activity/add&#x27;</span>,</span><br><span class="line">   <span class="comment">//路由路径所对应的页面</span></span><br><span class="line">     component : <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/ActivityRecordView.vue&#x27;</span>),</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>然后新建ActivityRecordView.vue，测试一下是否能跳转，没问题就把之前的做过类似的表单复制过来，是UserVIew.vue，开始结束日期也是复制的创建时间，活动描述是个文本域，就从饿了么找个复制进去。改好代码后发现框有长有短，就加个width样式调整百分百。然后再做负责人的下拉选项，从ActivityView复制负责人方法过来就行，同时在页面渲染时就调用一下这个方法。做好后再添加两个按钮，一个是提交一个是返回，而返回在UserDetailView里写过对应方法，复制一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-form ref=&quot;ActivityRefForm&quot; :model=&quot;activityQuery&quot; label-width=&quot;110px&quot;  :rules=&quot;activityRules&quot;&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;负责人&quot; prop=&quot;ownerId&quot;&gt;</span><br><span class="line">      &lt;el-select v-model=&quot;activityQuery.ownerId&quot; placeholder=&quot;请选择&quot; class=&quot;width&quot;&gt;</span><br><span class="line">        &lt;el-option</span><br><span class="line">            v-for = &quot;item in ownerOptions&quot;</span><br><span class="line">            :key=&quot;item.id&quot;</span><br><span class="line">            :label = &quot;item.name&quot;</span><br><span class="line">            :value=&quot;item.id&quot;/&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;活动名称&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">      &lt;el-input  v-model=&quot;activityQuery.name&quot; /&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;开始时间&quot; prop=&quot;startTime&quot;&gt;</span><br><span class="line">      &lt;el-date-picker</span><br><span class="line">          v-model=&quot;activityQuery.startTime&quot;</span><br><span class="line">          type=&quot;datetime&quot;</span><br><span class="line">          placeholder=&quot;请选择创建时间&quot;</span><br><span class="line">          value-format=&quot;YYYY-MM-DD HH:mm:ss&quot; style=&quot;width:100%;&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;结束时间&quot; prop=&quot;endTime&quot;&gt;</span><br><span class="line">      &lt;el-date-picker</span><br><span class="line">          v-model=&quot;activityQuery.endTime&quot;</span><br><span class="line">          type=&quot;datetime&quot;</span><br><span class="line">          placeholder=&quot;请选择创建时间&quot;</span><br><span class="line">          value-format=&quot;YYYY-MM-DD HH:mm:ss&quot; style=&quot;width:100%;&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;活动预算&quot; prop=&quot;cost&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;activityQuery.cost&quot; /&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;活动描述&quot; prop=&quot;description&quot;&gt;</span><br><span class="line">      &lt;el-input</span><br><span class="line">          v-model=&quot;activityQuery.description&quot;</span><br><span class="line">          :rows=&quot;6&quot;</span><br><span class="line">          type=&quot;textarea&quot;</span><br><span class="line">          placeholder=&quot;请输入活动描述&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;activitySubmit&quot;&gt;提 交&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button @click=&quot;goBack&quot;&gt;返 回&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">  &lt;/el-form&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123;doGet&#125; <span class="keyword">from</span> <span class="string">&quot;../http/httpRequest.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ActivityRecordView&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">//市场活动表单对象，初始值是空</span></span><br><span class="line">      activityQuery : &#123;&#125;,</span><br><span class="line">      <span class="comment">//市场活动表单验证规则</span></span><br><span class="line">      activityRules : &#123;&#125;,</span><br><span class="line">      <span class="comment">//负责人的下拉选项，初始值是空</span></span><br><span class="line">      ownerOptions : [&#123;&#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadOwner</span>();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods : &#123;</span><br><span class="line">    <span class="comment">//加载负责人</span></span><br><span class="line">    <span class="title function_">loadOwner</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/owner&quot;</span>, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">ownerOptions</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回</span></span><br><span class="line">    <span class="title function_">goBack</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">go</span>(-<span class="number">1</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.width</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="添加验证规则"><a href="#添加验证规则" class="headerlink" title="添加验证规则"></a>添加验证规则</h3><p>负责人活动名称和开始结束时间都是只要选了就行，预算就需要验证一下，首先要输入，然后一定要是个数字；活动描述首先要输入，然后有个长度范围，点击t_activity设计表，找到description可以看到长度最大是255。另外注意饿了么的下拉选项当鼠标离开时是没有验证提示的，其它的都有。然后写点击提交时触发的函数，因为参数比较多一个一个提交慢，所以循环这个对象，复制一下UserView里的新增用户提交保存那个代码</p>
<p>ActivityRecordView</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注入</span></span><br><span class="line">  inject : [<span class="string">&#x27;reload&#x27;</span>],</span><br><span class="line"></span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">//市场活动表单对象，初始值是空</span></span><br><span class="line">      activityQuery : &#123;&#125;,</span><br><span class="line">      <span class="comment">//市场活动表单验证规则</span></span><br><span class="line">      activityRules : &#123;</span><br><span class="line">        ownerId : [</span><br><span class="line">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请选择负责人&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;</span><br><span class="line">        ],</span><br><span class="line">        name : [</span><br><span class="line">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请输入活动名称&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;</span><br><span class="line">        ],</span><br><span class="line">        startTime : [</span><br><span class="line">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请选择开始时间&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;</span><br><span class="line">        ],</span><br><span class="line">        endTime : [</span><br><span class="line">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请选择结束时间&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;</span><br><span class="line">        ],</span><br><span class="line">        cost : [</span><br><span class="line">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请输入活动预算&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;,</span><br><span class="line">          <span class="comment">//正则表达式，从网上找，或者AI工具找，找到后需要测试一下，因为有可能找到的正则有问题</span></span><br><span class="line">          &#123; pattern : <span class="regexp">/^[0-9]+(\.[0-9]&#123;2&#125;)?$/</span>, <span class="attr">message</span>: <span class="string">&#x27;活动预算必须是整数或者两位小数&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;</span><br><span class="line">        ],</span><br><span class="line">        description : [</span><br><span class="line">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请输入活动描述&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">min</span>: <span class="number">5</span>, <span class="attr">max</span>: <span class="number">255</span>, <span class="attr">message</span>: <span class="string">&#x27;活动描述长度为5-255个字符&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">//负责人的下拉选项，初始值是空</span></span><br><span class="line">      ownerOptions : [&#123;&#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">    methods : &#123;</span><br><span class="line">     <span class="comment">//市场活动提交，因为参数比较多一个一个提交慢，所以循环这个对象</span></span><br><span class="line">    <span class="title function_">activitySubmit</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="comment">//用formdata提交，把每个字段都加到这里面</span></span><br><span class="line">      <span class="keyword">let</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">      <span class="comment">//提交用户是用query对象提交，就循环activityQuery拿到每一个对象，field就是字段名，后面的是通过字段名拿到字段值</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> field <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">activityQuery</span>)&#123;</span><br><span class="line">        formData.<span class="title function_">append</span>(field, <span class="variable language_">this</span>.<span class="property">activityQuery</span>[field]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//在提交前应该还有个验证，如果回调函数是true就提交</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">ActivityRefForm</span>.<span class="title function_">validate</span>( <span class="function">(<span class="params">isValid</span>) =&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isValid)&#123;</span><br><span class="line">          <span class="title function_">doPost</span>(<span class="string">&quot;/api/activity&quot;</span>, formData).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;<span class="comment">//新增</span></span><br><span class="line">            <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line">              <span class="title function_">messageTip</span>(<span class="string">&quot;提交成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">               <span class="comment">//跳转到市场互动列表页</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">$router</span>,<span class="title function_">push</span>(<span class="string">&quot;/dashboard/activity&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="title function_">messageTip</span>(<span class="string">&quot;提交失败&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="后端-4"><a href="#后端-4" class="headerlink" title="后端"></a>后端</h3><p>这个和之前写的用户提交差不多，也可以从复制过来<br>ActivityController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(value = &quot;/api/activity&quot;)</span></span><br><span class="line"><span class="comment">//前端请求后端接口时会携带jwt请求头，通过RequestHeader拿，Authorization是请求拦截器里的名字</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">addActivity</span><span class="params">(ActivityQuery activityQuery, <span class="meta">@RequestHeader(value = &quot;Authorization&quot;)</span> String token)</span>&#123;</span><br><span class="line">    <span class="comment">//在activityQuery里面设置token</span></span><br><span class="line">    activityQuery.setToken(token);</span><br><span class="line">    <span class="comment">//保存activity这个对象进去</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">save</span> <span class="operator">=</span> activityService.savaActivity(activityQuery);</span><br><span class="line">    <span class="comment">//如果大于等于1就是成功否则失败</span></span><br><span class="line">    <span class="keyword">return</span> save &gt;= <span class="number">1</span> ? R.OK() : R.FAIL();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ActivityController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">savaActivity</span><span class="params">(ActivityQuery activityQuery)</span>;</span><br></pre></td></tr></table></figure>

<p>ActivityServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">savaActivity</span><span class="params">(ActivityQuery activityQuery)</span> &#123;</span><br><span class="line">      <span class="comment">//这里的映射用insertSelective而不用insert是因为insertSelective的sql语句里有个判断，如果为空就不插数据，另一个则都可以插</span></span><br><span class="line">      <span class="comment">//然后看到insertSelective是需要传个tActivity的，就new一个</span></span><br><span class="line">      <span class="type">TActivity</span> <span class="variable">tActivity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TActivity</span>();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//把ActivityQuery对象里面的属性数据复制到TActivity对象里面去，用一个Spring工具类，这个就能把数据复制一下</span></span><br><span class="line">      <span class="comment">//复制要求：两个对象的属性名相同，属性类型相同，这样才能复制</span></span><br><span class="line">      BeanUtils.copyProperties(activityQuery, tActivity);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//创建时间就是保存数据的时间，所以new一个data</span></span><br><span class="line">      tActivity.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">      <span class="comment">//创建人就是当前登录的人，所以要拿到当前登录人的id，这个id页面和query里都没有，所以通过token可以解析用户id，之前的jwt工具里有个解析user对象的，解析完再getid</span></span><br><span class="line">      <span class="comment">//登录人的id</span></span><br><span class="line">      <span class="type">Integer</span> <span class="variable">loginUserId</span> <span class="operator">=</span> JWTUtils.parseUserFromJWT(activityQuery.getToken()).getId();</span><br><span class="line">      tActivity.setCreateBy(loginUserId);<span class="comment">//创建人id</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> tActivityMapper.insertSelective(tActivity);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>测试完后觉得提交后页面其实不需要刷新，可以跳转到之前的列表页面，代码放上面了，然后再做个重置按钮的效果，思路就是把每个框的对象清空，就在ActivityView里添加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">methods : &#123;</span><br><span class="line">  <span class="comment">//搜索条件重置（清空）</span></span><br><span class="line">  <span class="title function_">onReset</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">activityQuery</span> = &#123;&#125;;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="编辑市场活动"><a href="#编辑市场活动" class="headerlink" title="编辑市场活动"></a>编辑市场活动</h2><h3 id="前端-1"><a href="#前端-1" class="headerlink" title="前端"></a>前端</h3><p>要写一个触发函数方法，在ActivitView里，然后再router.js里配置子路由。而在加载的时候应该直接就把数据查询出来然后显示，所以要在ActivityRecordView页面渲染写个方法，区分是录入还是编辑的方法是路径里带不带id值（比如2），有值就是编辑需要去查。这里有个细节，点击编辑再点录入市场时不要清空数据了，因为是跳转的新路由，而之前的用户管理的新增用户是清空了Query，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//页面渲染时分页查询</span></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getData</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;,  </span><br><span class="line"></span><br><span class="line">methods : &#123;~~~</span><br><span class="line">  <span class="comment">//编辑市场活动</span></span><br><span class="line">  <span class="title function_">edit</span>(<span class="params">id</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&quot;/dashboard/activity/edit/&quot;</span>  + id);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>router</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">//路由路径，子路由路径不能以斜杠开头，id是动态变量要加冒号，这个叫动态路由</span></span><br><span class="line"> <span class="attr">path</span>: <span class="string">&#x27;activity/edit/:id&#x27;</span>,</span><br><span class="line">  <span class="comment">//路由路径所对应的页面</span></span><br><span class="line">   component : <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/ActivityRecordView.vue&#x27;</span>),</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>ActivityRecordView</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">loadOwner</span>();</span><br><span class="line">  <span class="comment">//加载要编辑的数据（由于录入和编辑共用一个页面，所以要判断是 编辑还是录入）</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">loadActivity</span>();</span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line"> methods : &#123;</span><br><span class="line">  <span class="comment">//加载要编辑的市场活动数据</span></span><br><span class="line">  <span class="title function_">loadActivity</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> id =  <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>;<span class="comment">//这里的id也可以是其他的名字，但一定要和路由里的id相同，也就是path: &#x27;activity/edit/:id&#x27;,</span></span><br><span class="line">    <span class="keyword">if</span> (id) &#123; <span class="comment">//id存在，id有值，id不为空，说明是编辑</span></span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/activity/&quot;</span> + id, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">activityQuery</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>后端代码，ActivitController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/api/activity/&#123;id&#125;&quot;)</span><span class="comment">//需要用PathVariable接收参数</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">loadActivity</span><span class="params">(<span class="meta">@PathVariable(value = &quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="type">TActivity</span> <span class="variable">tActivity</span> <span class="operator">=</span> activityService.getActivityById(id);</span><br><span class="line">    <span class="keyword">return</span> R.OK(tActivity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ActivityService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TActivity <span class="title function_">getActivityById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<p>ActivityServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> TActivity <span class="title function_">getActivityById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> tActivityMapper.selectByPrimaryKey(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="后端-5"><a href="#后端-5" class="headerlink" title="后端"></a>后端</h3><p>就是提交到后台了，录入和编辑都是共用activitySubmit函数，所以做个判断就行， 可以参考Userview，如果是编辑id就是大于0，这样就复制一下代码过来，编辑成功也是跳转到市场列表页。impl的那个写法也和userController里的是一样的，<br>ActivityRecordView</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//市场活动提交，因为参数比较多一个一个提交慢，所以循环这个对象</span></span><br><span class="line">   <span class="title function_">activitySubmit</span>(<span class="params"></span>)&#123;</span><br><span class="line">     <span class="comment">//用formdata提交，把每个字段都加到这里面</span></span><br><span class="line">     <span class="keyword">let</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">     <span class="comment">//提交用户是用query对象提交，就循环activityQuery拿到每一个对象，field就是字段名，后面的是通过字段名拿到字段值</span></span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">let</span> field <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">activityQuery</span>)&#123;</span><br><span class="line">       formData.<span class="title function_">append</span>(field, <span class="variable language_">this</span>.<span class="property">activityQuery</span>[field]);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">//在提交前应该还有个验证，如果回调函数是true就提交</span></span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">ActivityRefForm</span>.<span class="title function_">validate</span>( <span class="function">(<span class="params">isValid</span>) =&gt;</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(isValid)&#123;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">activityQuery</span>.<span class="property">id</span> &gt; <span class="number">0</span>) &#123;<span class="comment">//编辑</span></span><br><span class="line">           <span class="title function_">doPut</span>(<span class="string">&quot;/api/activity&quot;</span>, formData).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">             <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line">               <span class="title function_">messageTip</span>(<span class="string">&quot;编辑成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">               <span class="comment">//跳转到市场互动列表页</span></span><br><span class="line">               <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&quot;/dashboard/activity&quot;</span>);</span><br><span class="line">             &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="title function_">messageTip</span>(<span class="string">&quot;编辑失败&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">             &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">         &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           <span class="title function_">doPost</span>(<span class="string">&quot;/api/activity&quot;</span>, formData).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;<span class="comment">//新增</span></span><br><span class="line">             <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line">               <span class="title function_">messageTip</span>(<span class="string">&quot;提交成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">               <span class="comment">//跳转到市场互动列表页</span></span><br><span class="line">               <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&quot;/dashboard/activity&quot;</span>);</span><br><span class="line">             &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="title function_">messageTip</span>(<span class="string">&quot;提交失败&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">             &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;)</span><br><span class="line">   &#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ActivityControllar</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping(value = &quot;/api/activity&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R <span class="title function_">editActivity</span><span class="params">(ActivityQuery activityQuery, <span class="meta">@RequestHeader(value = &quot;Authorization&quot;)</span> String token)</span> &#123;</span><br><span class="line">       activityQuery.setToken(token);</span><br><span class="line">       <span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> activityService.updateActivity(activityQuery);</span><br><span class="line">       <span class="keyword">return</span> update &gt;= <span class="number">1</span> ? R.OK() : R.FAIL();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>ActivityService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">updateActivity</span><span class="params">(ActivityQuery activityQuery)</span>;</span><br></pre></td></tr></table></figure>

<p>ActivityServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateActivity</span><span class="params">(ActivityQuery activityQuery)</span> &#123;</span><br><span class="line">    <span class="type">TActivity</span> <span class="variable">tActivity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TActivity</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把ActivityQuery对象里面的属性数据复制到tActivity对象里面去，用一个Spring工具类，这个就能把数据复制一下</span></span><br><span class="line">    <span class="comment">//复制要求：两个对象的属性名相同，属性类型相同，这样才能复制</span></span><br><span class="line">    BeanUtils.copyProperties(activityQuery, tActivity);</span><br><span class="line"></span><br><span class="line">    tActivity.setEditTime(<span class="keyword">new</span> <span class="title class_">Date</span>());<span class="comment">//编辑时间</span></span><br><span class="line"></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">loginUserId</span> <span class="operator">=</span> JWTUtils.parseUserFromJWT(activityQuery.getToken()).getId();</span><br><span class="line">    tActivity.setEditBy(loginUserId);<span class="comment">//编辑人</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//这个也是和updateByPrimaryKey有区别的，有个空判断，如果是空就不更新，但是还需要在sql里添加一点判断</span></span><br><span class="line">    <span class="comment">//因为在前端给密码加了个空字符串，所以也要不为空字符串才可以</span></span><br><span class="line">    <span class="keyword">return</span> tActivityMapper.updateByPrimaryKeySelective(tActivity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后测试，发现前端传到后端的参数id接收不到，是null，原因是前端在循环activityQuery这个对象，但后台的Query没有这个id，需要加上<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250826023646789.png" alt="image-20250826023646789"></p>
<p>ActivityQuery</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Integer id;</span><br></pre></td></tr></table></figure>

<p>再次运行发生错误，说是创建时间什么什么的转换问题，先在循环里打印一下，可以看到前端传过来的参数,创建时间是个空，但是传到query时是需要转成java的data的，还需要进行格式化，所以就报错了，可以兼容判断一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> field <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">activityQuery</span>)&#123;</span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>(field  + <span class="string">&quot; -- &quot;</span> + <span class="variable language_">this</span>.<span class="property">activityQuery</span>[field])<span class="comment">//控制台打印</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">activityQuery</span>[field])  &#123; <span class="comment">//this.activityQuery[field]有值，不是空，存在，没有值则不提交</span></span><br><span class="line">         formData.<span class="title function_">append</span>(field, <span class="variable language_">this</span>.<span class="property">activityQuery</span>[field]);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250826152648959.png" alt="image-20250826152648959"></p>
<h2 id="市场活动详情"><a href="#市场活动详情" class="headerlink" title="市场活动详情"></a>市场活动详情</h2><h3 id="前端-2"><a href="#前端-2" class="headerlink" title="前端"></a>前端</h3><p>点击详情的时候跳转到一个带有id的页面，在ActivitView里写查看详情，然后在router.js里配置子路由，然后新建ActivityDetailView页面，详情页面在之前的用户详情做过一次，直接复制修改一下，然后把页面中的变量都定义一下，值可以先不写。然后也还是页面一打开的时候就渲染</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查看详情</span></span><br><span class="line">    <span class="title function_">view</span>(<span class="params">id</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&quot;/dashboard/activity/&quot;</span> + id);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>router</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">//路由路径，子路由路径不能以斜杠开头，id是动态变量，这个叫动态路由</span></span><br><span class="line">     <span class="attr">path</span>: <span class="string">&#x27;activity/:id&#x27;</span>,</span><br><span class="line">     <span class="comment">//路由路径所对应的页面</span></span><br><span class="line">  component : <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/ActivityDetailView.vue&#x27;</span>),</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>ActivityDetailView</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-form ref=&quot;activityRemarkRefForm&quot; :model=&quot;activityRemarkQuery&quot; label-width=&quot;120px&quot; :rules=&quot;activityRemarkRules&quot;&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;ID&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;activityDetail.id&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;负责人&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt; &#123;&#123;activityDetail.ownerDO.name&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;活动名称&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;activityDetail.name&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;开始时间&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;activityDetail.startDate&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;结束时间&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;activityDetail.endDate&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;活动预算&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;activityDetail.cost&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;活动描述&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;activityDetail.description&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;创建时间&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;activityDetail.createTime&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;创建人&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;activityDetail.createByDO.name&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;编辑时间&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;activityDetail.editTime&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;编辑人&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;activityDetail.editByDO.name&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/el-form&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;doGet&#125; from &quot;../http/httpRequest.js&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;ActivityDetailView&quot;,</span><br><span class="line"></span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      //活动详情对象,po就是pojo的简称实体类可以被叫做pojo，domain，entity，bean等等，之前写的是po写错了，换成do</span><br><span class="line">      activityDetail : &#123;</span><br><span class="line">        ownerDO : &#123;&#125;,</span><br><span class="line">        createByDO : &#123;&#125;,</span><br><span class="line">        editByDO : &#123;&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      //</span><br><span class="line">      activityRemarkQuery : &#123;&#125;,</span><br><span class="line">      //</span><br><span class="line">      activityRemarkRules : &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  mounted() &#123;</span><br><span class="line">    this.loadActivityDetail();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods : &#123;</span><br><span class="line">    //加载市场活动详情</span><br><span class="line">    loadActivityDetail() &#123;</span><br><span class="line">      let id = this.$route.params.id;</span><br><span class="line">      doGet(&quot;/api/activity/&quot; + id, &#123;&#125;).then(resp =&gt; &#123;</span><br><span class="line">        if (resp.data.code === 200) &#123;</span><br><span class="line">          this.activityDetail = resp.data.data;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="后端-6"><a href="#后端-6" class="headerlink" title="后端"></a>后端</h3><p>可以看到有个方法是@GetMapping(value &#x3D; “&#x2F;api&#x2F;activity&#x2F;{id}”)，可以共用，就完善一下这个代码，但这个是根据主键id查询，可是前台需要把负责人编辑人之类的都查出来，就需要关联数据表，映射里之前有了负责人，再新加创建人和编辑人，然后在TActivity里添加关联字段</p>
<p>ActivityServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> TActivity <span class="title function_">getActivityById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">   把这个修改成下面 <span class="keyword">return</span> tActivityMapper.selectByPrimaryKey(id);</span><br><span class="line">       <span class="keyword">return</span> tActivityMapper.selectDetailByPrimaryKey(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TActivityMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TActivity <span class="title function_">selectDetailByPrimaryKey</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<p>TActivityMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;ActivityResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.bjpowernode.model.TActivity&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  一对一关联  --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--查出来叫owner_id对应到user对象里是id，ownerName对应是name--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;ownerDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TUser&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;owner_id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;ownerName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  一对一关联  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;createByDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TUser&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;createById&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;createByName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  一对一关联  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;editByDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TUser&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;editById&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;editByName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectDetailByPrimaryKey&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;ActivityResultMap&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">    ta.*,</span><br><span class="line">    tu1.id ownerId, tu1.name ownerName,</span><br><span class="line">    tu2.id createById, tu2.name createByName,</span><br><span class="line">    tu3.id editById, tu3.name editByName</span><br><span class="line">    from t_activity ta left join t_user tu1 on ta.owner_id = tu1.id</span><br><span class="line">                                left join t_user tu2 on ta.create_by = tu2.id</span><br><span class="line">                                left join t_user tu3 on ta.edit_by = tu3.id</span><br><span class="line">    where ta.id = #&#123;id,jdbcType=INTEGER&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">TActivity.java</span><br><span class="line">~~~java</span><br><span class="line">    /**</span><br><span class="line">     *一对一关联，关联tUser对象，对象名ownerDO</span><br><span class="line">     */</span><br><span class="line">    private TUser ownerDO;</span><br><span class="line">    private TUser createByDO;</span><br><span class="line">    private TUser editByDO;</span><br></pre></td></tr></table></figure>

<p>然后测试，发现报错，创建人的name为null，看了数据库发现确实没有创建人之类的，所以要加个判断赋值，然后再加个颜色样式就行了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//加载市场活动详情</span></span><br><span class="line">    <span class="title function_">loadActivityDetail</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> id = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/activity/&quot;</span> + id, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">activityDetail</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">          <span class="comment">//空判断兼容</span></span><br><span class="line">          <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">activityDetail</span>.<span class="property">ownerDO</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">activityDetail</span>.<span class="property">ownerDO</span> = &#123;&#125;;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">activityDetail</span>.<span class="property">createByDO</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">activityDetail</span>.<span class="property">createByDO</span> = &#123;&#125;;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">activityDetail</span>.<span class="property">editByDO</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">activityDetail</span>.<span class="property">editByDO</span> = &#123;&#125;;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.<span class="property">desc</span> &#123;</span><br><span class="line">  background-<span class="attr">color</span>: #<span class="variable constant_">F0FFFF</span>;</span><br><span class="line">  <span class="attr">width</span>: <span class="number">100</span>%;</span><br><span class="line">  padding-<span class="attr">left</span>: 15px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="备注前端"><a href="#备注前端" class="headerlink" title="备注前端"></a>备注前端</h3><p>拷贝一下文本域代码，写备注功能，然后再加上两个按钮，然后返回函数因为很多地方都需要用，所以封装一下到util.js，然后在vue里导入一下goback,然后提交备注到数据库的表名是叫t_activity_remark，然后加上验证规则，然后在提交的时候就可以去验证<br>ActivityDetailView</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">~~~</span><br><span class="line">    &lt;el-form-item&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;activityRemarkSubmit&quot;&gt;提 交&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button @click=&quot;goBack&quot;&gt;返 回&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">	&lt;el-form-item&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;activityRemarkSubmit&quot;&gt;提 交&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button @click=&quot;goBack&quot;&gt;返 回&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//注入</span></span><br><span class="line">  inject : [<span class="string">&#x27;reload&#x27;</span>],</span><br><span class="line">    </span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;~~~</span><br><span class="line">	  <span class="comment">//提交活动备注的验证规则</span></span><br><span class="line">      activityRemarkRules : &#123;</span><br><span class="line">     	  noteContent : [</span><br><span class="line">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请输入活动备注&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">min</span>: <span class="number">5</span>, <span class="attr">max</span>: <span class="number">255</span>, <span class="attr">message</span>: <span class="string">&#x27;活动备注长度为5-255个字符&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;</span><br><span class="line">        ]      </span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">methods : &#123;</span><br><span class="line">    <span class="comment">//声明一下该函数，页面才能使用</span></span><br><span class="line">    goBack,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//提交活动备注</span></span><br><span class="line">    <span class="title function_">activityRemarkSubmit</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">activityRemarkRefForm</span>.<span class="title function_">validate</span>(<span class="function">(<span class="params">isValid</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isValid) &#123;</span><br><span class="line">          <span class="title function_">doPost</span>(<span class="string">&quot;/api/activity/remark&quot;</span>, &#123;</span><br><span class="line">            <span class="comment">//activityId是活动id，noteContent是活动内容，id除了从路由路径里拿，还可以从上面的activityDetail拿，因为之前做过市场活动查询也有id</span></span><br><span class="line">            activityId : <span class="variable language_">this</span>.<span class="property">activityDetail</span>.<span class="property">id</span>,</span><br><span class="line">            <span class="attr">noteContent</span>: <span class="variable language_">this</span>.<span class="property">activityRemarkQuery</span>.<span class="property">noteContent</span></span><br><span class="line">          &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">              <span class="title function_">messageTip</span>(<span class="string">&quot;提交成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">              <span class="comment">//刷新，reload需要注入</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">reload</span>();</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="title function_">messageTip</span>(<span class="string">&quot;提交失败&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>util.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装返回函数</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">goBack</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">go</span>(-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="备注后端"><a href="#备注后端" class="headerlink" title="备注后端"></a>备注后端</h3><p>因为要让Controller功能单一，所以要新建一个ActivityRemarkController，传过来的是json数据，为了开发方便，会把传过来的两个字段放到一个query对象去，然后用@RequestBody接收，再新建一个ActivityRemarkService接口</p>
<p>ActivityRemarkController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivityRemarkController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ActivityRemarkService activityRemarkService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//axios提交post请求，提交过来的是json数据，使用@RequestBody注解接收</span></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/api/activity/remark&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">addActivityRemark</span><span class="params">(<span class="meta">@RequestBody</span> ActivityRemarkQuery activityRemarkQuery,<span class="meta">@RequestHeader(value = &quot;Authorization&quot;)</span> String token)</span> &#123;</span><br><span class="line">        <span class="comment">//需要token是因为有个创建时间和创建人，就需要从token拿登录用户的id</span></span><br><span class="line">        activityRemarkQuery.setToken(token);</span><br><span class="line">        <span class="comment">//保存活动备注，把activityRemarkQuery传进去</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">save</span> <span class="operator">=</span> activityRemarkService.saveActivityRemark(activityRemarkQuery);</span><br><span class="line">        <span class="keyword">return</span> save &gt;= <span class="number">1</span> ? R.OK( ) : R.FAIL();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ActivityRemarkQuery</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivityRemarkQuery</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer activityId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String noteContent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ActivityRemarkService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ActivityRemarkService</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">saveActivityRemark</span><span class="params">(ActivityRemarkQuery activityRemarkQuery)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ActivityRemarkServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivityRemarkServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ActivityRemarkService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TActivityRemarkMapper tActivityRemarkMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">saveActivityRemark</span><span class="params">(ActivityRemarkQuery activityRemarkQuery)</span> &#123;</span><br><span class="line">        <span class="type">TActivityRemark</span> <span class="variable">tActivityRemark</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TActivityRemark</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把ActivityRemarkQuery对象里面的属性数据复制到TActivityRemark对象里面去(复制要求：两个对象的属性名相同，属性类型要相同，这样才能复制)</span></span><br><span class="line">        BeanUtils.copyProperties(activityRemarkQuery, tActivityRemark);</span><br><span class="line"></span><br><span class="line">        tActivityRemark.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>()); <span class="comment">//创建时间</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//登录人的id</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">loginUserId</span> <span class="operator">=</span> JWTUtils.parseUserFromJWT(activityRemarkQuery.getToken()).getId();</span><br><span class="line">        tActivityRemark.setCreateBy(loginUserId); <span class="comment">//创建人</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tActivityRemarkMapper.insertSelective(tActivityRemark);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="备注记录查询前端"><a href="#备注记录查询前端" class="headerlink" title="备注记录查询前端"></a>备注记录查询前端</h3><p>之前用户表格复制一下代码并且修改，然后写活动备注的列表对象，因为有两个参数所以是数组，然后要做分页，写上分页参数，查参数还是页面渲染时调用getData方法，改名成loadActivityRemarkList，然后写查询用户列表数据，从UserView里复制修改就行<br>ActivityDetailView</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;~~~</span><br><span class="line">&lt;el-table</span><br><span class="line">      :data=&quot;activityRemarkList&quot;</span><br><span class="line">      style=&quot;width: 100%&quot;&gt;</span><br><span class="line">    &lt;el-table-column type=&quot;index&quot; label=&quot;序号&quot; width=&quot;60&quot;/&gt;</span><br><span class="line">    &lt;el-table-column prop=&quot;noteContent&quot; label=&quot;备注内容&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;createTime&quot; label=&quot;备注时间&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;createByDO.name&quot; label=&quot;备注人&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;editTime&quot; label=&quot;编辑时间&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;editByDO.name&quot; label=&quot;编辑人&quot;/&gt;</span><br><span class="line">    &lt;el-table-column label=&quot;操作&quot;&gt;</span><br><span class="line">      &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;a href=&quot;javascript:&quot; @click=&quot;edit(scope.row.id)&quot;&gt;编辑&lt;/a&gt;</span><br><span class="line">        &amp;nbsp;</span><br><span class="line">        &lt;a href=&quot;javascript:&quot; @click=&quot;del(scope.row.id)&quot;&gt;删除&lt;/a&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-table-column&gt;</span><br><span class="line">  &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">  &lt;el-pagination</span><br><span class="line">      background</span><br><span class="line">      layout=&quot;prev, pager, next&quot;</span><br><span class="line">      :page-size=&quot;pageSize&quot;</span><br><span class="line">      :total=&quot;total&quot;</span><br><span class="line">      @prev-click=&quot;toPage&quot;</span><br><span class="line">      @next-click=&quot;toPage&quot;</span><br><span class="line">      @current-change=&quot;toPage&quot;/&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;~~~</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;   </span><br><span class="line">	  <span class="comment">//活动备注的列表对象，这是个数组，初始值是空</span></span><br><span class="line">      activityRemarkList : [&#123;</span><br><span class="line">        createByDO : &#123;&#125;,</span><br><span class="line">        <span class="attr">editByDO</span>: &#123;&#125;</span><br><span class="line">      &#125;],</span><br><span class="line"> 	  <span class="comment">//分页时每页显示多少条数据</span></span><br><span class="line">      pageSize : <span class="number">0</span>,</span><br><span class="line">      <span class="comment">//分页总共查询出多少条数据</span></span><br><span class="line">      total : <span class="number">0</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">   <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadActivityDetail</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadActivityRemarkList</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">    methods : &#123;</span><br><span class="line">    <span class="comment">//查询用户列表数据</span></span><br><span class="line">    <span class="title function_">loadActivityRemarkList</span>(<span class="params">current</span>) &#123;</span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/activity/remark&quot;</span>, &#123;</span><br><span class="line">        current : current, <span class="comment">//当前查询第几页</span></span><br><span class="line">        activityId : <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span><span class="comment">//从路径里拿id</span></span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(resp);</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">activityRemarkList</span> = resp.<span class="property">data</span>.<span class="property">data</span>.<span class="property">list</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">pageSize</span> = resp.<span class="property">data</span>.<span class="property">data</span>.<span class="property">pageSize</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">total</span> = resp.<span class="property">data</span>.<span class="property">data</span>.<span class="property">total</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分页函数(current这个参数是ele-plus组件传过来，就是传的当前页)</span></span><br><span class="line">    <span class="title function_">toPage</span>(<span class="params">current</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">loadActivityRemarkList</span>(current);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="备注记录查询后端"><a href="#备注记录查询后端" class="headerlink" title="备注记录查询后端"></a>备注记录查询后端</h3><p>实现分页查询是那三条固定代码，然后要从路径里拿id，让这个只能看自己的，（但实际上市场活动本来就只能查看自己的，没必要传query，但还是跟着课程走） new一个ActivityRemarkQuery，把id赋进去就可以传了。加上个aop过滤，只能看自己的备注，并且备注人和编辑人的名字要显示出来，要加上映射，然后在<br>ActivityRemarkController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/api/activity/remark&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">activityRemarkPage</span><span class="params">(<span class="meta">@RequestParam(value = &quot;current&quot;, required = false)</span> Integer current,</span></span><br><span class="line"><span class="params">                            <span class="meta">@RequestParam(value = &quot;activityId&quot;)</span> Integer activityId)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">ActivityRemarkQuery</span> <span class="variable">activityRemarkQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActivityRemarkQuery</span>();</span><br><span class="line">    activityRemarkQuery.setActivityId(activityId);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (current == <span class="literal">null</span>) &#123;</span><br><span class="line">        current = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    PageInfo&lt;TActivityRemark&gt; pageInfo = activityRemarkService.getActivityRemarkByPage(current, activityRemarkQuery);</span><br><span class="line">    <span class="keyword">return</span> R.OK(pageInfo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ActivityRemarkService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PageInfo&lt;TActivityRemark&gt; <span class="title function_">getActivityRemarkByPage</span><span class="params">(Integer current, ActivityRemarkQuery activityRemarkQuery)</span>;</span><br></pre></td></tr></table></figure>

<p>ActivityRemarkServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageInfo&lt;TActivityRemark&gt; <span class="title function_">getActivityRemarkByPage</span><span class="params">(Integer current, ActivityRemarkQuery activityRemarkQuery)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.设置PageHelper</span></span><br><span class="line">    PageHelper.startPage(current, Constants.PAGE_SIZE);</span><br><span class="line">    <span class="comment">// 2.查询</span></span><br><span class="line">    List&lt;TActivityRemark&gt; list = tActivityRemarkMapper.selectActivityRemarkByPage(activityRemarkQuery);</span><br><span class="line">    <span class="comment">// 3.封装分页数据到PageInfo</span></span><br><span class="line">    PageInfo&lt;TActivityRemark&gt; info = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(list);</span><br><span class="line">    <span class="keyword">return</span> info;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TActivityRemarkMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//tableAlias表的别名，tableField表的字段</span></span><br><span class="line">   <span class="meta">@DataScope(tableAlias = &quot;tar&quot;, tableField = &quot;create_by&quot;)</span>    </span><br><span class="line">List&lt;TActivityRemark&gt; <span class="title function_">selectActivityRemarkByPage</span><span class="params">(ActivityRemarkQuery activityRemarkQuery)</span>;</span><br></pre></td></tr></table></figure>

<p>TActivityRemarkMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;ActivityRemarkResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.bjpowernode.model.TActivityRemark&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;activity_id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;activityId&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;note_content&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;noteContent&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_by&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createBy&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;edit_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;editTime&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;edit_by&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;editBy&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;deleted&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;deleted&quot;</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--一对一关联查询--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;createByDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TUser&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;createById&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;createByName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--一对一关联查询--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;editByDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TUser&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;editById&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;editByName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectActivityRemarkByPage&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;ActivityRemarkResultMap&quot;</span>&gt;</span></span><br><span class="line">   select</span><br><span class="line">           tar.*,</span><br><span class="line">           tu1.id createById, tu1.name createByName,</span><br><span class="line">           tu2.id editById, tu2.name editByName</span><br><span class="line">   from t_activity_remark tar left join t_user tu1 on tar.create_by  = tu1.id</span><br><span class="line">                                           left join t_user tu2 on tar.edit_by  = tu2.id</span><br><span class="line">   <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    tar.activity_id = #&#123;activityId, jdbcType=INTEGER&#125;</span><br><span class="line">     $&#123;filterSQL&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>TActivityRemark</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一对一关联</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> TUser ownerDO;</span><br><span class="line"><span class="keyword">private</span> TUser createByDO;</span><br><span class="line"><span class="keyword">private</span> TUser editByDO;</span><br></pre></td></tr></table></figure>

<h3 id="备注记录编辑功能"><a href="#备注记录编辑功能" class="headerlink" title="备注记录编辑功能"></a>备注记录编辑功能</h3><p>先做个点击编辑然后出现弹窗功能，还是从之前的userVIew里复制，弹窗里只需要一个文本域，这里面把查询到的东西都显示出来然后修改，查询方法在后端ActivityRemarkController也写上。老师讲的是用了同一个query对象导致下面的备注记录点击编辑后，上面的填写备注也被查询到了，这时候就需要重新定义一个editActivityRemarkQuery对象就行了，然后再写这个编辑备注的验证规则和提交功能，提交与上面的提交活动备注是类似的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--活动备注记录的弹窗--&gt;</span><br><span class="line">  &lt;el-dialog v-model=&quot;activityRemarkDialogVisible&quot; title=&quot;编辑市场活动备注记录&quot; width=&quot;55%&quot; center draggable&gt;</span><br><span class="line">    &lt;el-form ref=&quot;editActivityRemarkRefForm&quot; :model=&quot;editActivityRemarkQuery&quot; label-width=&quot;110px&quot; :rules=&quot;editActivityRemarkRules&quot;&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;活动备注&quot; prop=&quot;noteContent&quot;&gt;</span><br><span class="line">        &lt;el-input</span><br><span class="line">            v-model=&quot;editActivityRemarkQuery.noteContent&quot;</span><br><span class="line">            :rows=&quot;8&quot;</span><br><span class="line">            type=&quot;textarea&quot;</span><br><span class="line">            placeholder=&quot;请输入活动备注&quot;/&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line"></span><br><span class="line">    &lt;template #footer&gt;</span><br><span class="line">      &lt;span class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;activityRemarkDialogVisible = false&quot;&gt;关 闭&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;editActivityRemarkSubmit&quot;&gt;提 交&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span>&#123;~~~</span><br><span class="line">    <span class="comment">//市场活动备注对象，初始值是空</span></span><br><span class="line">    activityRemarkQuery : &#123;&#125;,</span><br><span class="line">    editActivityRemarkQuery : &#123;&#125;,</span><br></pre></td></tr></table></figure>
<pre><code>  //编辑活动备注的弹窗，true弹，false不弹
  activityRemarkDialogVisible : false,
   //编辑活动备注的验证规则
  editActivityRemarkRules : {
    noteContent : [
      { required: true, message: &#39;请输入活动备注&#39;, trigger: &#39;blur&#39; },
      { min: 5, max: 255, message: &#39;活动备注长度为5-255个字符&#39;, trigger: &#39;blur&#39; }
    ]
  }
</code></pre>
<p>   methods : {~~~<br>    &#x2F;&#x2F;编辑备注记录<br>    edit(id) {<br>      this.activityRemarkDialogVisible &#x3D; true;<br>      doGet(“&#x2F;api&#x2F;activity&#x2F;remark&#x2F;“ + id, {}).then(resp &#x3D;&gt; {<br>        if (resp.data.code &#x3D;&#x3D;&#x3D; 200) {<br>          this.editActivityRemarkQuery &#x3D; resp.data.data;<br>        }<br>      })<br>    }</p>
<pre><code> //编辑活动备注（提交保存）
editActivityRemarkSubmit() {
  this.$refs.editActivityRemarkRefForm.validate((isValid) =&gt; {
    if (isValid) {
      doPut(&quot;/api/activity/remark&quot;, {
        id : this.editActivityRemarkQuery.id,
        noteContent: this.editActivityRemarkQuery.noteContent
      }).then(resp =&gt; {
        if (resp.data.code === 200) {
          messageTip(&quot;编辑成功&quot;, &quot;success&quot;);
          //刷新
          this.reload();
        } else {
          messageTip(&quot;编辑失败&quot;, &quot;error&quot;);
        }
      })
    }
  })
},
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ActivityRemarkController</span><br><span class="line">~~~java</span><br><span class="line">    @GetMapping(value = &quot;/api/activity/remark/&#123;id&#125;&quot;)</span><br><span class="line">    public R activityRemarkPage(@PathVariable(value = &quot;id&quot;) Integer id) &#123;</span><br><span class="line">        TActivityRemark tActivityRemark = activityRemarkService.getActivityRemarkById(id);</span><br><span class="line">        return R.OK(tActivityRemark);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ActivityRemarkService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TActivityRemark <span class="title function_">getActivityRemarkById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<p>ActivityRemarkServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> TActivityRemark <span class="title function_">getActivityRemarkById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> tActivityRemarkMapper.selectByPrimaryKey(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后写后端，在ActivityRemarkQuery新加个id，private Integer id;，然后创建和实现方法，<br>ActivityRemarkController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping(value = &quot;/api/activity/remark&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">editActivityRemark</span><span class="params">(<span class="meta">@RequestBody</span> ActivityRemarkQuery activityRemarkQuery, <span class="meta">@RequestHeader(value = &quot;Authorization&quot;)</span> String token)</span> &#123;</span><br><span class="line">    <span class="comment">//axios提交post请求，提交过来的是json数据，使用@RequestBody注解接收</span></span><br><span class="line">    activityRemarkQuery.setToken(token);</span><br><span class="line">    <span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> activityRemarkService.updateActivityRemark(activityRemarkQuery);</span><br><span class="line">    <span class="keyword">return</span> update &gt;= <span class="number">1</span> ? R.OK( ) : R.FAIL();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ActivityRemarkService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">updateActivityRemark</span><span class="params">(ActivityRemarkQuery activityRemarkQuery)</span>;</span><br></pre></td></tr></table></figure>

<p>ActivityRemarkServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateActivityRemark</span><span class="params">(ActivityRemarkQuery activityRemarkQuery)</span> &#123;</span><br><span class="line">    <span class="type">TActivityRemark</span> <span class="variable">tActivityRemark</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TActivityRemark</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把ActivityRemarkQuery对象里面的属性数据复制到TActivityRemark对象里面去(复制要求：两个对象的属性名相同，属性类型要相同，这样才能复制)</span></span><br><span class="line">    BeanUtils.copyProperties(activityRemarkQuery, tActivityRemark);</span><br><span class="line"></span><br><span class="line">    tActivityRemark.setEditTime(<span class="keyword">new</span> <span class="title class_">Date</span>()); <span class="comment">//编辑时间</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//登录人的id</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">loginUserId</span> <span class="operator">=</span> JWTUtils.parseUserFromJWT(activityRemarkQuery.getToken()).getId();</span><br><span class="line">    tActivityRemark.setEditBy(loginUserId); <span class="comment">//创建人</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tActivityRemarkMapper.updateByPrimaryKeySelective(tActivityRemark);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="备注记录删除功能"><a href="#备注记录删除功能" class="headerlink" title="备注记录删除功能"></a>备注记录删除功能</h3><p>写删除方法，还是从之前的用户复制，写完后测试页面，删除后在数据库里Deleted的数字为1，就需要在前端不显示，就在之前的TActivityRemarkMapper.xml里添加条件语句</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  methods : &#123;  </span><br><span class="line"><span class="comment">//删除活动备注</span></span><br><span class="line">    <span class="title function_">del</span>(<span class="params">id</span>) &#123;</span><br><span class="line">      <span class="title function_">messageConfirm</span>(<span class="string">&quot;您确定要删除该数据吗？&quot;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//用户点击“确定”按钮就会触发then函数</span></span><br><span class="line">        <span class="title function_">doDelete</span>(<span class="string">&quot;/api/activity/remark/&quot;</span> + id, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(resp);</span><br><span class="line">          <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="title function_">messageTip</span>(<span class="string">&quot;删除成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">            <span class="comment">//页面刷新</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">reload</span>();</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">messageTip</span>(<span class="string">&quot;删除失败，原因：&quot;</span> + resp.<span class="property">data</span>.<span class="property">msg</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//用户点击“取消”按钮就会触发catch函数</span></span><br><span class="line">        <span class="title function_">messageTip</span>(<span class="string">&quot;取消删除&quot;</span>, <span class="string">&quot;warning&quot;</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ActivityRemarkService</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title class_">DeleteMapping</span>(value = <span class="string">&quot;/api/activity/remark/&#123;id&#125;&quot;</span>)</span><br><span class="line">  public R <span class="title function_">delActivityRemark</span>(<span class="params">@PathVariable(value = <span class="string">&quot;id&quot;</span>) Integer id</span>) &#123;</span><br><span class="line">      int del =activityRemarkService.<span class="title function_">delActivityRemarkById</span>(id);</span><br><span class="line">      <span class="keyword">return</span> del &gt;= <span class="number">1</span> ? R.<span class="title function_">OK</span>( ) : R.<span class="title function_">FAIL</span>();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>ActivityRemarkService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">delActivityRemarkById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<p>ActivityRemarkServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delActivityRemarkById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="comment">//逻辑删除：不删数据，只是修改一下数据的状态，数据依然还在表里面；这里用到的是逻辑删除</span></span><br><span class="line">    <span class="comment">//物理删除：真正的把数据从表里面删掉</span></span><br><span class="line">    <span class="type">TActivityRemark</span> <span class="variable">tActivityRemark</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TActivityRemark</span>();</span><br><span class="line">    <span class="comment">//传过来主键</span></span><br><span class="line">    tActivityRemark.setId(id);</span><br><span class="line">    tActivityRemark.setDeleted(<span class="number">1</span>); <span class="comment">//删除状态（null或者0正常，1删除）</span></span><br><span class="line">    <span class="keyword">return</span> tActivityRemarkMapper.updateByPrimaryKeySelective(tActivityRemark);<span class="comment">//查询方法反向生成了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TActivityRemarkMapper</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line"> tar.activity_id = #&#123;activityId, jdbcType=INTEGER&#125; and (tar.deleted is null or tar.deleted = 0)</span><br><span class="line">  $&#123;filterSQL&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="线索管理"><a href="#线索管理" class="headerlink" title="线索管理"></a>线索管理</h1><p>线索：就是有一定意向的客户的联系方式，（有购买需求，不一定会买），拿到这些意向客户的联系方式（手机号、微信…..）把这些有需求的客户信息拿到，录入到系统里面，后续跟踪这些线索(联系他，打电话、微信)，促使交易（让他来买我们的产品，他能买车）；有的线索最后可能不会成交，有的线索会成交；</p>
<p>这些线索（客户的联系方式）通过各种各样的途径获得：线下车展、抖音直播、投放广告、客户上门来看车……；</p>
<p>重复代码会省略不写</p>
<h2 id="页面准备"><a href="#页面准备" class="headerlink" title="页面准备"></a>页面准备</h2><h3 id="前端-3"><a href="#前端-3" class="headerlink" title="前端"></a>前端</h3><p>在DashBoardVIew里的线索管理添加路径，router添加子路径，三个按钮和列表复制之前代码，然后定义线索列表数据，分页数据，然后页面一点开就要查询数据显示出来，就加个getData，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-menu-item index=&quot;/dashboard/clue&quot;&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="comment">//路由路径，子路由路径不能以斜杠开头</span></span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;clue&#x27;</span>,</span><br><span class="line"> 	 <span class="comment">//路由路径所对应的页面</span></span><br><span class="line">    component : <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/ClueView.vue&#x27;</span>),</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>ClueView</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-button type=&quot;primary&quot; class=&quot;btn&quot; @click=&quot;addClue&quot; v-hasPermission=&quot;&#x27;clue:add&#x27;&quot;&gt;录入线索&lt;/el-button&gt;</span><br><span class="line">  &lt;el-button type=&quot;success&quot; class=&quot;btn&quot; @click=&quot;importExcel&quot; v-hasPermission=&quot;&#x27;clue:import&#x27;&quot;&gt;导入线索(Excel)&lt;/el-button&gt;</span><br><span class="line">  &lt;el-button type=&quot;danger&quot; class=&quot;btn&quot; @click=&quot;batchDelClue&quot; v-hasPermission=&quot;&#x27;clue:delete&#x27;&quot;&gt;批量删除&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">  &lt;el-table</span><br><span class="line">      :data=&quot;clueList&quot;</span><br><span class="line">      style=&quot;width: 100%&quot;</span><br><span class="line">      @selection-change=&quot;handleSelectionChange&quot;&gt;</span><br><span class="line">    &lt;el-table-column type=&quot;selection&quot; width=&quot;50&quot;/&gt;</span><br><span class="line">    &lt;el-table-column type=&quot;index&quot; label=&quot;序号&quot; width=&quot;65&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;ownerDO.name&quot; label=&quot;负责人&quot; width=&quot;120&quot; /&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;activityDO.name&quot; label=&quot;所属活动&quot;/&gt;</span><br><span class="line">    &lt;el-table-column label=&quot;姓名&quot;&gt;</span><br><span class="line">      &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;a href=&quot;javascript:&quot; @click=&quot;view(scope.row.id)&quot;&gt;&#123;&#123; scope.row.fullName &#125;&#125;&lt;/a&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-table-column&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;appellationDO.typeValue&quot; label=&quot;称呼&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;phone&quot; label=&quot;手机&quot; width=&quot;120&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;weixin&quot; label=&quot;微信&quot; width=&quot;120&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;needLoanDO.typeValue&quot; label=&quot;是否贷款&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;intentionStateDO.typeValue&quot; label=&quot;意向状态&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;intentionProductDO.name&quot; label=&quot;意向产品&quot;/&gt;</span><br><span class="line">    &lt;el-table-column label=&quot;线索状态&quot;&gt;</span><br><span class="line">      &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;span style=&quot;background: lightgoldenrodyellow&quot; v-if=&quot;scope.row.state === -1&quot;&gt; &#123;&#123; scope.row.stateDO.typeValue &#125;&#125; &lt;/span&gt;</span><br><span class="line">        &lt;span v-else&gt; &#123;&#123; scope.row.stateDO.typeValue &#125;&#125; &lt;/span&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-table-column&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;sourceDO.typeValue&quot; label=&quot;线索来源&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;nextContactTime&quot; label=&quot;下次联系时间&quot; width=&quot;165&quot;/&gt;</span><br><span class="line">    &lt;el-table-column label=&quot;操作&quot; width=&quot;230&quot;&gt;</span><br><span class="line">      &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;view(scope.row.id)&quot; v-hasPermission=&quot;&#x27;clue:view&#x27;&quot;&gt;详情&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;success&quot; @click=&quot;edit(scope.row.id)&quot; v-hasPermission=&quot;&#x27;clue:edit&#x27;&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;danger&quot; @click=&quot;del(scope.row.id)&quot; v-hasPermission=&quot;&#x27;clue:delete&#x27;&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-table-column&gt;</span><br><span class="line">  &lt;/el-table&gt;</span><br><span class="line">  &lt;p&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">        background</span><br><span class="line">        layout=&quot;prev, pager, next&quot;</span><br><span class="line">        :page-size=&quot;pageSize&quot;</span><br><span class="line">        :total=&quot;total&quot;</span><br><span class="line">        @prev-click=&quot;toPage&quot;</span><br><span class="line">        @next-click=&quot;toPage&quot;</span><br><span class="line">        @current-change=&quot;toPage&quot;/&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123;doGet&#125; <span class="keyword">from</span> <span class="string">&quot;../http/httpRequest.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ClueView&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>)  &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">//线索列表对象，初始值是空</span></span><br><span class="line">      clueList : [&#123;</span><br><span class="line">        ownerDO : &#123;&#125;,</span><br><span class="line">        activityDO : &#123;&#125;,</span><br><span class="line">        appellationDO : &#123;&#125;,</span><br><span class="line">        needLoanDO : &#123;&#125;,</span><br><span class="line">        intentionStateDO : &#123;&#125;,</span><br><span class="line">        intentionProductDO : &#123;&#125;,</span><br><span class="line">        stateDO : &#123;&#125;,</span><br><span class="line">        sourceDO : &#123;&#125;</span><br><span class="line">      &#125;],</span><br><span class="line">      <span class="comment">//分页时每页显示多少条数据</span></span><br><span class="line">      pageSize : <span class="number">0</span>,</span><br><span class="line">      <span class="comment">//分页总共查询出多少条数据</span></span><br><span class="line">      total : <span class="number">0</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getData</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods : &#123;</span><br><span class="line">    <span class="comment">//勾选数据的函数</span></span><br><span class="line">    <span class="title function_">handleSelectionChange</span>(<span class="params"></span>) &#123;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询用户列表数据</span></span><br><span class="line">    <span class="title function_">getData</span>(<span class="params">current</span>) &#123;</span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/clues&quot;</span>, &#123;</span><br><span class="line">        current : current <span class="comment">//当前查询第几页</span></span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(resp);</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">clueList</span> = resp.<span class="property">data</span>.<span class="property">data</span>.<span class="property">list</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">pageSize</span> = resp.<span class="property">data</span>.<span class="property">data</span>.<span class="property">pageSize</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">total</span> = resp.<span class="property">data</span>.<span class="property">data</span>.<span class="property">total</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分页函数(current这个参数是ele-plus组件传过来，就是传的当前页)</span></span><br><span class="line">    <span class="title function_">toPage</span>(<span class="params">current</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">getData</span>(current);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.el-table</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">margin-top</span>: <span class="number">15px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="后端-7"><a href="#后端-7" class="headerlink" title="后端"></a>后端</h3><p>创建ClueController和ClueService、ClueServiceImpl，在里面写上分页代码，然后创建查询方法。到时候要显示的是名字不是id，在t_clue表里需要注意这样的是owner_id和Activity_id，appellation（性别），need_loan（是否需要贷款）后面省略，写完再加个映射，写好后去TClue.java一对一关联</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClueController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ClueService clueService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/api/clues&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">cluePage</span><span class="params">(<span class="meta">@RequestParam(value = &quot;current&quot;, required = false)</span> Integer current)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (current == <span class="literal">null</span>) &#123;</span><br><span class="line">            current = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        PageInfo&lt;TClue&gt; pageInfo = clueService.getClueByPage(current);</span><br><span class="line">        <span class="keyword">return</span> R.OK(pageInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ClueService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PageInfo&lt;TClue&gt; <span class="title function_">getClueByPage</span><span class="params">(Integer current)</span>;</span><br></pre></td></tr></table></figure>

<p>ClueServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClueServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ClueService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TClueMapper tClueMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageInfo&lt;TClue&gt; <span class="title function_">getClueByPage</span><span class="params">(Integer current)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.设置PageHelper</span></span><br><span class="line">        PageHelper.startPage(current, Constants.PAGE_SIZE);</span><br><span class="line">        <span class="comment">// 2.查询</span></span><br><span class="line">        List&lt;TClue&gt; list = tClueMapper.selectClueByPage(BaseQuery.builder().build());</span><br><span class="line">        <span class="comment">// 3.封装分页数据到PageInfo</span></span><br><span class="line">        PageInfo&lt;TClue&gt; info = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(list);</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TClueMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TClue&gt; <span class="title function_">selectClueByPage</span><span class="params">(BaseQuery build)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;ClueResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.bjpowernode.model.TClue&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;owner_id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;ownerId&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;activity_id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;activityId&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;full_name&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;fullName&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;appellation&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;appellation&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;weixin&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;weixin&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;qq&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;qq&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;job&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;job&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;year_income&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;DECIMAL&quot;</span> <span class="attr">property</span>=<span class="string">&quot;yearIncome&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;need_loan&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;needLoan&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;intention_state&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;intentionState&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;intention_product&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;intentionProduct&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;source&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;source&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;next_contact_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;nextContactTime&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_by&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createBy&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;edit_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;editTime&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;edit_by&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;editBy&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;ownerDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TUser&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;ownerId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;ownerName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;activityDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TActivity&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;activityId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;activityName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;appellationDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TDicValue&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;appellationId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;appellationName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;typeValue&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;needLoanDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TDicValue&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;needLoanId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;needLoanName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;typeValue&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;intentionStateDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TDicValue&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;intentionStateId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;intentionStateName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;typeValue&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;intentionProductDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TProduct&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;intentionProductId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;intentionProductName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;stateDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TDicValue&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;stateId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;stateName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;typeValue&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;sourceDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TDicValue&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;sourceId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sourceName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;typeValue&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectClueByPage&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;ClueResultMap&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">        tc.*,</span><br><span class="line">        tu1.id ownerId, tu1.name ownerName,</span><br><span class="line">        ta.id activityId, ta.name activityName,</span><br><span class="line">        tdv.id appellationId, tdv.type_value appellationName,</span><br><span class="line">        tdv2.id needLoanId, tdv2.type_value needLoanName,</span><br><span class="line">        tdv3.id intentionStateId, tdv3.type_value intentionStateName,</span><br><span class="line">        tp.id intentionProductId,  tp.name intentionProductName,</span><br><span class="line">        tdv4.id stateId, tdv4.type_value stateName,</span><br><span class="line">        tdv5.id sourceId, tdv5.type_value sourceName</span><br><span class="line">    from t_clue tc left join t_user tu1 on tc.owner_id = tu1.id</span><br><span class="line">                   left join t_activity ta on tc.activity_id = ta.id</span><br><span class="line">                   left join t_dic_value tdv on tc.appellation = tdv.id</span><br><span class="line"></span><br><span class="line">                   left join t_dic_value tdv2 on tc.need_loan = tdv2.id</span><br><span class="line">                   left join t_dic_value tdv3 on tc.intention_state = tdv3.id</span><br><span class="line"></span><br><span class="line">                   left join t_product tp on tc.intention_product = tp.id</span><br><span class="line"></span><br><span class="line">                   left join t_dic_value tdv4 on tc.state = tdv4.id</span><br><span class="line">                   left join t_dic_value tdv5 on tc.source = tdv5.id</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>TClue.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一对一关联</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//这里全都new一个对象是为了如果字段查不到的话可以避免null报错，这样字段为空但对象不为空</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">TUser</span> <span class="variable">ownerDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TUser</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="type">TActivity</span> <span class="variable">activityDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TActivity</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="type">TDicValue</span> <span class="variable">appellationDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TDicValue</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="type">TDicValue</span> <span class="variable">needLoanDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TDicValue</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="type">TDicValue</span> <span class="variable">intentionStateDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TDicValue</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="type">TProduct</span> <span class="variable">intentionProductDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TProduct</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="type">TDicValue</span> <span class="variable">stateDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TDicValue</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="type">TDicValue</span> <span class="variable">sourceDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TDicValue</span>();</span><br></pre></td></tr></table></figure>

<h3 id="导入线索excel功能前端"><a href="#导入线索excel功能前端" class="headerlink" title="导入线索excel功能前端"></a>导入线索excel功能前端</h3><p>既然要导入excel，就要约定一个模板格式，点击按钮时要弹个窗，里面是提示的内容，复制之前ActivityDetailView的活动备注记录弹窗代码稍微修改一下，从饿了么组件找到upload上传，选择手动上传的代码，然后写上文字，给文字加个class样式，要实现手动上传要翻阅文档里面有个http-request，取名uploadFile，这个函数会上传然后回调一个参数过来，然后写提交请求方法，但是点提交的时候也需要一个触发函数，就写一个submitExcel。提交成功后要清理一下上传的文件，用文档里的一个clearFiles方法。刷新页面记得导入路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--活动备注记录的弹窗，http-request是手动上传--&gt;</span><br><span class="line">&lt;el-dialog v-model=&quot;importExcelDialogVisible&quot; title=&quot;导入线索Excel&quot; width=&quot;55%&quot; center draggable&gt;</span><br><span class="line">  &lt;el-upload</span><br><span class="line">      ref=&quot;uploadRef&quot;</span><br><span class="line">      method=&quot;post&quot;</span><br><span class="line">      :http-request=&quot;uploadFile&quot;</span><br><span class="line">      :auto-upload=&quot;false&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;template #trigger&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot;&gt;选择Excel文件&lt;/el-button&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    仅支持后缀名为.xls或.xlsx的文件</span><br><span class="line"></span><br><span class="line">    &lt;template #tip&gt;</span><br><span class="line">      &lt;div class=&quot;fileTip&quot;&gt;</span><br><span class="line">        重要提示：</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">          &lt;li&gt;上传仅支持后缀名为.xls或.xlsx的文件；&lt;/li&gt;</span><br><span class="line">          &lt;li&gt;给定Excel文件的第一行将视为字段名；&lt;/li&gt;</span><br><span class="line">          &lt;li&gt;请确认您的文件大小不超过50MB；&lt;/li&gt;</span><br><span class="line">          &lt;li&gt;日期值以文本形式保存，必须符合yyyy-MM-dd格式；&lt;/li&gt;</span><br><span class="line">          &lt;li&gt;日期时间以文本形式保存，必须符合yyyy-MM-dd HH:mm:ss的格式；&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/el-upload&gt;</span><br><span class="line"></span><br><span class="line">  &lt;template #footer&gt;</span><br><span class="line">    &lt;span class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">      &lt;el-button @click=&quot;importExcelDialogVisible = false&quot;&gt;关 闭&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;submitExcel&quot;&gt;导 入&lt;/el-button&gt;</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">&lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ClueView&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">//注入</span></span><br><span class="line">  inject : [<span class="string">&#x27;reload&#x27;</span>],</span><br><span class="line">    </span><br><span class="line"> methods : &#123;</span><br><span class="line"> <span class="comment">//线索导入（Excel）</span></span><br><span class="line">    <span class="title function_">importExcel</span>(<span class="params"></span>)  &#123;</span><br><span class="line">      <span class="comment">//弹个窗</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">importExcelDialogVisible</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//上传文件的请求提交</span></span><br><span class="line">    <span class="title function_">uploadFile</span>(<span class="params">param</span>) &#123;</span><br><span class="line">      <span class="comment">//打印回调的参数，需要先导入文件然后提交</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(param);</span><br><span class="line">      <span class="keyword">let</span> fileObj = param.<span class="property">file</span> <span class="comment">// 拿到文件，相当于input里取得的files</span></span><br><span class="line">      <span class="keyword">let</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>() <span class="comment">// new一个FormData对象，把文件放进去</span></span><br><span class="line">      formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, fileObj)<span class="comment">//文件对象，前面file是参数名，后面fileObj是参数值</span></span><br><span class="line">      <span class="title function_">doPost</span>(<span class="string">&quot;/api/importExcel&quot;</span>, formData).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="comment">//Excel导入成功，提示一下</span></span><br><span class="line">          <span class="title function_">messageTip</span>(<span class="string">&quot;导入成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">          <span class="comment">//清理一下上传的文件</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">uploadRef</span>.<span class="title function_">clearFiles</span>();</span><br><span class="line">          <span class="comment">//页面刷新</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">reload</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">//Excel导入失败</span></span><br><span class="line">          <span class="title function_">messageTip</span>(<span class="string">&quot;导入失败&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提交山传Excel文件</span></span><br><span class="line">    <span class="title function_">submitExcel</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">//相当于引用ref这个组件</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">uploadRef</span>.<span class="title function_">submit</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="导入线索excel功能后端"><a href="#导入线索excel功能后端" class="headerlink" title="导入线索excel功能后端"></a>导入线索excel功能后端</h3><p>前端传过来的文件fileObj，怎么去接收？用MultipartFile类型，这个在后面总结里也会有代码如下，点击view可以看到存放的路径</p>
<p>，这个是tomcat的临时文件目录，这个临时文件就是上传的那个excel，可以直接用excel打开，我们需要把这个上传的文件读出来然后传到数据库里，需要使用easyExcel组件<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250905153556319.png" alt="image-20250905153556319"></p>
<h4 id="EasyExcel"><a href="#EasyExcel" class="headerlink" title="EasyExcel"></a>EasyExcel</h4><p>官网：<a target="_blank" rel="noopener" href="https://easyexcel.opensource.alibaba.com/">https://easyexcel.opensource.alibaba.com/</a></p>
<p>EasyExcel是一个基于Java的、快速、简洁、解决大文件内存溢出的Excel处理工具（jar包）。</p>
<p>他能让你在不用考虑性能、内存的等因素的情况下，快速完成Excel的读、写等功能。</p>
<p>原来操作Excel使用apache poi和jxl项目，这两个项目：</p>
<p>1、代码开发繁琐一些；</p>
<p>2、大文件解析会产生内存溢出；（2G的Excel文件需要导入&#x2F;导出）</p>
<p>EasyExcel完美解决了上面的两个问题；</p>
<p>添加依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--EasyExcel--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="后端代码-2"><a href="#后端代码-2" class="headerlink" title="后端代码"></a>后端代码</h4><p>查看文档复制代码过来，然后解决红字，代码里要传一个dao，在Controller里传不方便，放到service去实现，就用clueService调用。下面这行代码先解决第一个，是个文件输入流，就在控制层通过文件调用输入流，有异常就抛出，然后传给服务层，再传给impl。写监听器的话要在config里新建一个listener包，UploadDataListener类，然后把tClueMapper传进去。这里面怎么写还是要参考他的代码，往上翻到gitee网址，easyexcel&#x2F; easyexcel-test &#x2F; src &#x2F; test &#x2F; java &#x2F; com &#x2F; alibaba &#x2F; easyexcel &#x2F; test &#x2F; demo &#x2F; web这个路径里找到UploadDataListener.java，然后全复制过来，模板类改成TClue，加上@Slf4j注解。DAO是导入到线索里的，所以改成TClueMapper。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3个参数, 第一个参数是要读取的Excel文件，第二个参数是Excel模板类，模板也就是excel最上面的字段名,用TClue，第三个参数是文件读取的监听器</span></span><br><span class="line">EasyExcel.read(file.getInputStream(), UploadData.class, <span class="keyword">new</span> <span class="title class_">UploadDataListener</span>(uploadDAO)).sheet().doRead();</span><br></pre></td></tr></table></figure>

<p>ClueController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(value = &quot;/api/importExcel&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">importExcel</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    clueService.importExcel(file.getInputStream());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.OK();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ClueService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">importExcel</span><span class="params">(InputStream inputStream)</span>;</span><br></pre></td></tr></table></figure>

<p>ClueServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">importExcel</span><span class="params">(InputStream inputStream)</span> &#123;</span><br><span class="line">    <span class="comment">//链式编程，3个参数, 第一个参数是要读取的Excel文件，第二个参数是Excel模板类，模板也就是excel最上面的字段名，用TClue，第三个参数是文件读取的监听器</span></span><br><span class="line">    <span class="comment">//sheet是Excel表格最底下的那个子表</span></span><br><span class="line">    EasyExcel.read(inputStream, TClue.class, <span class="keyword">new</span> <span class="title class_">UploadDataListener</span>(tClueMapper))</span><br><span class="line">            .sheet()</span><br><span class="line">            .doRead();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UploadDataListener</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 每读一行Excel的数据，就会触发该监听器中的invoke()方法，Excel读完之后会触发该监听器中的doAfterAllAnalysed()方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadDataListener</span> <span class="keyword">implements</span> <span class="title class_">ReadListener</span>&lt;TClue&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 每隔100条存储数据库，实际使用中可以100条，然后清理list ，方便内存回收</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BATCH_COUNT</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//缓存List，ListUtils是easyExcel提供的，new一个指定大小的ArrayList，在上面的BATCH_COUNT设置大小</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;TClue&gt; cachedDataList = ListUtils.newArrayListWithExpectedSize(BATCH_COUNT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 假设这个是一个DAO，当然有业务逻辑这个也可以是一个service。当然如果不用存储这个对象没用。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> TClueMapper tClueMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String token;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化TClueMapper，把传进来的TClueMapper赋进来</span></span><br><span class="line"><span class="comment">     * 如果使用了spring,请使用这个构造方法。每次创建Listener的时候需要把spring管理的类传进来</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tClueMapper</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UploadDataListener</span><span class="params">(TClueMapper tClueMapper)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.tClueMapper = tClueMapper;</span><br><span class="line">        <span class="built_in">this</span>.token = token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这个每一条数据解析都会来调用</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tClue    one row value. It is same as &#123;<span class="doctag">@link</span> AnalysisContext#readRowHolder()&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//tclue会变成模板类对象，这个对象一定包含所有字段，但是怎么映射所有字段，点进tclue类，给所有的字段加上@ExcelProperty注解，后面的值就是模板的字段名</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(TClue tClue, AnalysisContext context)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;读取到的每一条数据:&#123;&#125;&quot;</span>, JSONUtils.toJSON(tClue));<span class="comment">//做个打印</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//给读到的clue对象设置创建时间(导入时间)和创建人（导入人）</span></span><br><span class="line">        tClue.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//每读取一行，就把该数据放入到一个缓存List中，在上方有</span></span><br><span class="line">        cachedDataList.add(tClue);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 达到BATCH_COUNT了，需要去存储一次数据库，防止数据几万条数据在内存，容易OOM</span></span><br><span class="line">        <span class="keyword">if</span> (cachedDataList.size() &gt;= BATCH_COUNT) &#123;</span><br><span class="line">            <span class="comment">//把缓存list中的数据写入到数据库</span></span><br><span class="line">            saveData();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//存储完成清空list</span></span><br><span class="line">            cachedDataList = ListUtils.newArrayListWithExpectedSize(BATCH_COUNT);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 所有数据解析完成了 都会来调用</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// 这里也要保存数据，确保最后遗留的数据也存储到数据库</span></span><br><span class="line">        saveData();</span><br><span class="line">        log.info(<span class="string">&quot;所有数据解析完成！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加上存储数据库</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveData</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;&#123;&#125;条数据，开始存储数据库！&quot;</span>, cachedDataList.size());</span><br><span class="line">        tClueMapper.saveClue(cachedDataList);</span><br><span class="line">        log.info(<span class="string">&quot;存储数据库成功！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><p>先看invoke方法，每读一行就触发一次，tclue会变成模板类对象，这个对象一定包含所有字段，但是怎么映射所有字段，点进tclue类，给所有的字段加上**@ExcelProperty**注解，后面的值就是模板的字段名，类似下面这种写法，然后读取一行就调用cachedDataList.add方法存到list缓存里，这里设置list缓存的指定大小为100，达到100了就去存储一次数据库。所有数据读完之后调用doAfterAllAnalysed方法，把剩下的数据也保存。</p>
</li>
<li><p>先把保存数据库的代码注释一下，然后运行一下，发现报数据转换错误，这是因为在TClue里比如称呼是int类型，但表里是中文，所以要在注解后面加个转换器，但是内置的转换器有很多，不一定有我们需要的，所以自己写，Excel表里点开t_dic_value里可以看到称呼对应的id，在config里写个converter包，新建AppellationConverter，然后快捷键实现方法，里面有四个converTo开头的，tojava是从excal转java，另一个则相反，然后一个是拿单元格数据的，一个是拿上下文的，使用单元格数据。</p>
</li>
<li><p>写好获取单元格字符串数据代码后要从数据库读到内存里，设置个时间隔多久读一下数据库的数据放到内存中，到时候从内存拿代码，这里写个task定时任务，新建一个task包，这里也是老师直接拿以前讲过的代码直接复制的。然后在yml里设置每三秒执行一次。要查什么数值先从字典里查出来然后再从内存中搜索就行了，新建个字典类型DicTypeService，然后回到task里用这个调用查询代码，把所有字典查询出来。</p>
</li>
<li><p>然后在DlykServerApplication.java里弄一个map，从内存放到map里，就在tadaTask里循环遍历list集合然后存入，存入了再在转换器类里，根据code去查称呼的字典值，这里在result里新建一个DicEnum枚举类，然后拿value遍历</p>
</li>
<li><p>这里写完后去测试代码，但是有一部分数据转换还没有写完，可以在TClue的顶部加上@ExcelIgnoreUnannotated  &#x2F;&#x2F;没有加注解的字段就不参与Excel的读写，然后把没转换的@ExcelProperty注解注释掉，然后在ClueController的return r.ok加个断点，把listen里所有save数据的给注释掉，看看能不能导入，导入成功会打印这些数据，并且可以在AppellationConverter.java的cacheMap，鼠标悬停可以看到值</p>
</li>
<li></li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250907220712961.png" alt="image-20250907220712961"></p>
<p>TClue</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExcelProperty(value = &quot;负责人&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Integer ownerId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 称呼，converter是转换器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;称呼&quot;, converter = AppellationConverter.class)</span></span><br><span class="line">    <span class="keyword">private</span> Integer appellation;</span><br></pre></td></tr></table></figure>

<p>AppellationConverter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 称呼的转换器，继承的时候注意选alibaba的包</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Excel中的 “先生”  ----&gt; Java类中是 18</span></span><br><span class="line"><span class="comment"> * Excel中的 “女士”  ----&gt; Java类中是 41</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppellationConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;Integer&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 把Excel中的数据转换为Java中的数据</span></span><br><span class="line"><span class="comment">     * 也就是Excel中的 “先生”  ----&gt; Java类中是 18</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cellData</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentProperty</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> globalConfiguration</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span><span class="comment">//里面三个参数目前用到的只有第一个，单元格数据</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">convertToJavaData</span><span class="params">(ReadCellData&lt;?&gt; cellData, ExcelContentProperty contentProperty, GlobalConfiguration globalConfiguration)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//cellData是Excel中读取到的数据，是“先生”、“女士”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cellAppellationName</span> <span class="operator">=</span> cellData.getStringValue();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过dataTask存放在cacheMap里的数据拿到code，根据code这个key拿value，原来拿到的值可能是Object，转型一下</span></span><br><span class="line">        <span class="comment">//后面运行报异常的，这里线程休眠一会，让数据可以先读入内存再被拿出来</span></span><br><span class="line">        List&lt;TDicValue&gt; tDicValueList = (List&lt;TDicValue&gt;) DlykServerApplication.cacheMap.get(DicEnum.APPELLATION.getCode());</span><br><span class="line">        <span class="keyword">for</span> (TDicValue tDicValue : tDicValueList) &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">id</span>  <span class="operator">=</span> tDicValue.getId();</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> tDicValue.getTypeValue();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cellAppellationName.equals(name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>DataTask</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableScheduling</span> <span class="comment">//开启定时任务</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataTask</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DicTypeService dicTypeService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ProductService productService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ActivityService activityService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调度的意思</span></span><br><span class="line">    <span class="comment">//@Scheduled(fixedDelay = 3000)//确定的延迟时间，数字表示，单位是 毫秒;</span></span><br><span class="line">    <span class="comment">//@scheduled(fixedDelaystring =&quot;3000&quot;)//确定的延迟时间，字符串表示，单位是 毫秒;</span></span><br><span class="line">    <span class="comment">//@Scheduled(fixedRate = 3000)//确定的速率/比例，数字表示，单位是 毫秒;</span></span><br><span class="line">    <span class="comment">//@Scheduled(fixedRatestring =&quot;3000&quot;)//确定的速率/比例，字符串表示，单位是 毫秒:</span></span><br><span class="line">    <span class="comment">//@scheduled(initialDelay = 3000,fixedRate = 3000)//initialDelay表示第一次执行延迟多久，后面是确定的速率/比例,</span></span><br><span class="line">    <span class="comment">//@Scheduled(initialDelaystring =&quot;3000&quot;，fixedRate= 3000)//initialDelay表示第一次执行延迟多久，后面是确定的速率</span></span><br><span class="line">    <span class="comment">//@Scheduled(cron = &quot;*/3 * * * * *&quot;, zone = &quot;Asia/Shanghai&quot;, timeUnit = TimeUnit.MILLISECONDS)，前面的应该是每三秒执行一次的意思</span></span><br><span class="line">    <span class="comment">//调度的意思</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;$&#123;project.task.cron&#125;&quot;, zone = &quot;Asia/Shanghai&quot;, timeUnit = TimeUnit.MILLISECONDS)</span></span><br><span class="line"><span class="comment">//    @Scheduled(fixedDelayString = &quot;$&#123;project.task.delay&#125;&quot;, zone = &quot;Asia/Shanghai&quot;, timeUnit = TimeUnit.MILLISECONDS, initialDelay  = 1000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">task</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//定时任务要执行的业务逻辑代码</span></span><br><span class="line">        System.out.println(<span class="string">&quot;定时任务业务逻辑执行......&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">        List&lt;TDicType&gt; tDicTypeList = dicTypeService.loadAllDicData();<span class="comment">//查询所有字典</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历list集合，拿到字典类型编码，再拿到字典值，</span></span><br><span class="line">        tDicTypeList.forEach(tDicType -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">typeCode</span> <span class="operator">=</span> tDicType.getTypeCode();</span><br><span class="line">            List&lt;TDicValue&gt; tDicValueList = tDicType.getDicValueList();</span><br><span class="line">            DlykServerApplication.cacheMap.put(typeCode, tDicValueList);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询所有在售产品</span></span><br><span class="line">        List&lt;TProduct&gt; tProductList = productService.getAllOnSaleProduct();</span><br><span class="line">        DlykServerApplication.cacheMap.put(DicEnum.PRODUCT.getCode(), tProductList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询所有正在进行的市场活动</span></span><br><span class="line">        List&lt;TActivity&gt; tActivityList = activityService.getOngoingActivity();</span><br><span class="line">        DlykServerApplication.cacheMap.put(DicEnum.ACTIVITY.getCode(), tActivityList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>application.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义定时任务的调度时间</span></span><br><span class="line"><span class="attr">project:</span></span><br><span class="line">  <span class="attr">task:</span></span><br><span class="line">   <span class="attr">cron:</span> <span class="string">&#x27;*/3 * * * * *&#x27;</span></span><br></pre></td></tr></table></figure>

<p>DicTypeService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TDicType&gt; <span class="title function_">loadAllDicData</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>DicTypeServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DicTypeServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DicTypeService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TDicTypeMapper tDicTypeMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;TDicType&gt; <span class="title function_">loadAllDicData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tDicTypeMapper.selectByAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TDicTypeMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TDicType&gt; <span class="title function_">selectByAll</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>TDicTypeMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;DicTypeResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.bjpowernode.model.TDicType&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;type_code&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;typeCode&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;type_name&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;typeName&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;remark&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;remark&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 一对多关联用collection标签  ofType是所属类型  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;dicValueList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.bjpowernode.model.TDicValue&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;dicId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dicName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;typeValue&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;DicTypeResultMap&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">    tdt.*,</span><br><span class="line">    tdv.id dicId, tdv.type_value dicName</span><br><span class="line">  from t_dic_type tdt left join t_dic_value tdv on tdt.type_code = tdv.type_code</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>TDicType</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一对多关联</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;TDicValue&gt; dicValueList;</span><br></pre></td></tr></table></figure>

<p>DlykServerApplication</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DlykServerApplication</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用来在DataTask.java里存放字典值的集合，存到内存里再给</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Object&gt; cacheMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>

<p>DicEnum</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这里不让用data注解，就在下面加getset</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">DicEnum</span> &#123;</span><br><span class="line"></span><br><span class="line">    APPELLATION(<span class="string">&quot;appellation&quot;</span>),</span><br><span class="line"></span><br><span class="line">    SOURCE(<span class="string">&quot;source&quot;</span>),</span><br><span class="line"></span><br><span class="line">    STATE(<span class="string">&quot;clueState&quot;</span>),</span><br><span class="line"></span><br><span class="line">    INTENTIONSTATE(<span class="string">&quot;intentionState&quot;</span>),</span><br><span class="line"></span><br><span class="line">    NEEDLOAN(<span class="string">&quot;needLoan&quot;</span>),</span><br><span class="line"></span><br><span class="line">    PRODUCT(<span class="string">&quot;product&quot;</span>),</span><br><span class="line"></span><br><span class="line">    ACTIVITY(<span class="string">&quot;activity&quot;</span>)</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="完善转换器"><a href="#完善转换器" class="headerlink" title="完善转换器"></a>完善转换器</h4><p>再给其他model对象写转换器，在converter里新建一个NeedLoanConverter、IntentionStateConverter、IntentionProductConverter、StateConverter、SourceConverter，注意在IntentionProductConverter里是放的产品名，然后要在dataTask里把产品放进cacheMap里，新建一个ProductService和impl，并在dataTask注入，然后创建查询方法之类的<br>NeedLoanConverter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否需要贷款的转换器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NeedLoanConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 把Excel中的数据转换为Java中的数据</span></span><br><span class="line"><span class="comment">     * 也就是Excel中的 “需要”  ----&gt; Java类中是 49</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cellData</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentProperty</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> globalConfiguration</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">convertToJavaData</span><span class="params">(ReadCellData&lt;?&gt; cellData, ExcelContentProperty contentProperty, GlobalConfiguration globalConfiguration)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//cellData是Excel中读取到的数据，是“需要”、“不需要”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cellNeedLoanName</span> <span class="operator">=</span> cellData.getStringValue();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过dataTask存放在cacheMap里的数据拿到code，根据code这个key拿value，原来拿到的值可能是Object，转型一下，写常量可以避免写死</span></span><br><span class="line">        List&lt;TDicValue&gt; tDicValueList = (List&lt;TDicValue&gt;) DlykServerApplication.cacheMap.get(DicEnum.NEEDLOAN.getCode());</span><br><span class="line">        <span class="keyword">for</span> (TDicValue tDicValue : tDicValueList) &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">id</span>  <span class="operator">=</span> tDicValue.getId();</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> tDicValue.getTypeValue();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cellNeedLoanName.equals(name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StateConverter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 线索状态转换器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StateConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 把Excel中的数据转换为Java中的数据</span></span><br><span class="line"><span class="comment">     * 也就是Excel中的 “已联系”  ----&gt; Java类中是 27</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cellData</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentProperty</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> globalConfiguration</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">convertToJavaData</span><span class="params">(ReadCellData&lt;?&gt; cellData, ExcelContentProperty contentProperty, GlobalConfiguration globalConfiguration)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//cellData是Excel中读取到的数据，是“已联系”、“未联系”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cellStateName</span> <span class="operator">=</span> cellData.getStringValue();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过dataTask存放在cacheMap里的数据拿到code，根据code这个key拿value，原来拿到的值可能是Object，转型一下，写常量可以避免写死</span></span><br><span class="line">        List&lt;TDicValue&gt; tDicValueList = (List&lt;TDicValue&gt;) DlykServerApplication.cacheMap.get(DicEnum.STATE.getCode());</span><br><span class="line">        <span class="keyword">for</span> (TDicValue tDicValue : tDicValueList) &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">id</span>  <span class="operator">=</span> tDicValue.getId();</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> tDicValue.getTypeValue();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cellStateName.equals(name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SourceConverter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 线索来源的转换器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Excel中的 “车展会”  ----&gt; Java类中是 3</span></span><br><span class="line"><span class="comment"> * Excel中的 “网络广告”  ----&gt; Java类中是 16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SourceConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 把Excel中的数据转换为Java中的数据</span></span><br><span class="line"><span class="comment">     * 也就是Excel中的 “车展会”  ----&gt; Java类中是 3</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cellData</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentProperty</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> globalConfiguration</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">convertToJavaData</span><span class="params">(ReadCellData&lt;?&gt; cellData, ExcelContentProperty contentProperty, GlobalConfiguration globalConfiguration)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//cellData是Excel中读取到的数据，是“车展会”、“网络广告”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cellSourceName</span> <span class="operator">=</span> cellData.getStringValue();</span><br><span class="line"></span><br><span class="line">        List&lt;TDicValue&gt; tDicValueList = (List&lt;TDicValue&gt;) DlykServerApplication.cacheMap.get(DicEnum.SOURCE.getCode());</span><br><span class="line">        <span class="keyword">for</span> (TDicValue tDicValue : tDicValueList) &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">id</span>  <span class="operator">=</span> tDicValue.getId();</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> tDicValue.getTypeValue();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cellSourceName.equals(name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>IntentionStateConverter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 意向状态转换器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntentionStateConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 把Excel中的数据转换为Java中的数据</span></span><br><span class="line"><span class="comment">     * 也就是Excel中的 “意向不明”  ----&gt; Java类中是 48</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cellData</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentProperty</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> globalConfiguration</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">convertToJavaData</span><span class="params">(ReadCellData&lt;?&gt; cellData, ExcelContentProperty contentProperty, GlobalConfiguration globalConfiguration)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//cellData是Excel中读取到的数据，是“意向不明”、“有意向”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cellIntentionStateName</span> <span class="operator">=</span> cellData.getStringValue();</span><br><span class="line"></span><br><span class="line">        List&lt;TDicValue&gt; tDicValueList = (List&lt;TDicValue&gt;) DlykServerApplication.cacheMap.get(DicEnum.INTENTIONSTATE.getCode());</span><br><span class="line">        <span class="keyword">for</span> (TDicValue tDicValue : tDicValueList) &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">id</span>  <span class="operator">=</span> tDicValue.getId();</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> tDicValue.getTypeValue();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cellIntentionStateName.equals(name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>IntentionProductConverter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 意向产品的转换器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Excel中的比亚迪e2   --&gt;  java中的 2</span></span><br><span class="line"><span class="comment"> * 秦PLUS EV  --&gt;  7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntentionProductConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 把Excel中的数据转换为Java中的数据</span></span><br><span class="line"><span class="comment">     * 也就是Excel中的 “比亚迪e2”  ----&gt; Java类中是 2</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cellData</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentProperty</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> globalConfiguration</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">convertToJavaData</span><span class="params">(ReadCellData&lt;?&gt; cellData, ExcelContentProperty contentProperty, GlobalConfiguration globalConfiguration)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//cellData是Excel中读取到的数据，是“比亚迪e2”、“秦PLUS EV”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cellIntentionProductName</span> <span class="operator">=</span> cellData.getStringValue();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查的不是字典，是产品名，然后在dataTask里把产品放进cacheMap里</span></span><br><span class="line">        List&lt;TProduct&gt; tDicValueList = (List&lt;TProduct&gt;) DlykServerApplication.cacheMap.get(DicEnum.PRODUCT.getCode());</span><br><span class="line">        <span class="keyword">for</span> (TProduct tProduct : tDicValueList) &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">id</span>  <span class="operator">=</span> tProduct.getId();</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> tProduct.getName();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cellIntentionProductName.equals(name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ProductService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductService</span> &#123;</span><br><span class="line">    List&lt;TProduct&gt; <span class="title function_">getAllOnSaleProduct</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ProductServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ProductService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TProductMapper tProductMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;TProduct&gt; <span class="title function_">getAllOnSaleProduct</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tProductMapper.selectAllOnSaleProduct();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TProductMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TProduct&gt; <span class="title function_">selectAllOnSaleProduct</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>TProductMapper.xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectAllOnSaleProduct&quot;</span> resultMap=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span><br><span class="line">  select</span><br><span class="line">  &lt;include refid=<span class="string">&quot;Base_Column_List&quot;</span> /&gt;</span><br><span class="line">  from t_product</span><br><span class="line">  <span class="type">where</span> <span class="variable">state</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>弄完这些再去测试，还是给ClueController的return加个断点，然后3秒执行一次太快了，换成5分钟，在yml里设置成cron: ‘* * &#x2F;5 * * * *’，再给加个启动后延迟一秒，启动后报错了，因为initialDelay不能和cron同时使用，换成下面的，第一次执行是一秒后，后面是3分钟执行一次，然后运行没问题的话就是写怎么保存到数据库<br>yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义定时任务的调度时间，delay后面用的是毫秒</span></span><br><span class="line"><span class="attr">project:</span></span><br><span class="line">  <span class="attr">task:</span></span><br><span class="line">    <span class="attr">cron:</span> <span class="string">&#x27;* * /5 * * * *&#x27;</span></span><br><span class="line">    <span class="attr">delay:</span> <span class="number">180000</span></span><br></pre></td></tr></table></figure>

<p>DataTask</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Scheduled(cron = &quot;$&#123;project.task.cron&#125;&quot;, zone = &quot;Asia/Shanghai&quot;, timeUnit = TimeUnit.MILLISECONDS, initialDelay  = 1000)//initialDelay是启动后延迟一秒，但是不能和cron同时使用，换成下面的</span></span><br><span class="line"><span class="comment">//fixedDelay要求是个long，但是接受到的是字符串，所以用fixedDelayString。第一次执行是一秒后，后面是五分钟执行一次</span></span><br><span class="line"><span class="meta">@Scheduled(fixedDelayString = &quot;$&#123;project.task.delay&#125;&quot;, zone = &quot;Asia/Shanghai&quot;, timeUnit = TimeUnit.MILLISECONDS, initialDelay  = 1000)</span></span><br></pre></td></tr></table></figure>

<h4 id="导入到数据库"><a href="#导入到数据库" class="headerlink" title="导入到数据库"></a>导入到数据库</h4><p>创建UploadDataListener里的saveClue查询语句，因为是个list集合导入到数据库里，代码会不太一样，要循环list里面的value，传过来的list名字叫tClueList，item是取出来的一项，叫tClue，separator是分隔符，这里是在下面直接加了个括号，不然用open和close加也可以，相当于所有的字段(),()，这样分隔<br>TClueMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">saveClue</span><span class="params">(List&lt;TClue&gt; cachedDataList)</span>;</span><br></pre></td></tr></table></figure>

<p>TClueMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--批量保存，这个传过来的是list，传过来的list名字叫tClueList，item是取出来的一项，叫tClue，separator是分隔符，这里是在下面直接加了个括号，不然用open和close加也可以，相当于所有的字段(),()，这样分隔--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;saveClue&quot;</span> <span class="attr">keyColumn</span>=<span class="string">&quot;id&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.bjpowernode.model.TClue&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  insert into t_clue (owner_id, activity_id, full_name,</span><br><span class="line">  appellation, phone, weixin,</span><br><span class="line">  qq, email, age, job,</span><br><span class="line">  year_income, address, need_loan,</span><br><span class="line">  intention_state, intention_product, `state`,</span><br><span class="line">  `source`, description, next_contact_time,</span><br><span class="line">  create_time, create_by, edit_time,</span><br><span class="line">  edit_by)</span><br><span class="line">  values</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;tClueList&quot;</span> <span class="attr">item</span>=<span class="string">&quot;tClue&quot;</span>  <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> &gt;</span></span><br><span class="line">    (#&#123;tClue.ownerId,jdbcType=INTEGER&#125;, #&#123;tClue.activityId,jdbcType=INTEGER&#125;, #&#123;tClue.fullName,jdbcType=VARCHAR&#125;,</span><br><span class="line">    #&#123;tClue.appellation,jdbcType=INTEGER&#125;, #&#123;tClue.phone,jdbcType=VARCHAR&#125;, #&#123;tClue.weixin,jdbcType=VARCHAR&#125;,</span><br><span class="line">    #&#123;tClue.qq,jdbcType=VARCHAR&#125;, #&#123;tClue.email,jdbcType=VARCHAR&#125;, #&#123;tClue.age,jdbcType=INTEGER&#125;, #&#123;tClue.job,jdbcType=VARCHAR&#125;,</span><br><span class="line">    #&#123;tClue.yearIncome,jdbcType=DECIMAL&#125;, #&#123;tClue.address,jdbcType=VARCHAR&#125;, #&#123;tClue.needLoan,jdbcType=INTEGER&#125;,</span><br><span class="line">    #&#123;tClue.intentionState,jdbcType=INTEGER&#125;, #&#123;tClue.intentionProduct,jdbcType=INTEGER&#125;, #&#123;tClue.state,jdbcType=INTEGER&#125;,</span><br><span class="line">    #&#123;tClue.source,jdbcType=INTEGER&#125;, #&#123;tClue.description,jdbcType=VARCHAR&#125;, #&#123;tClue.nextContactTime,jdbcType=TIMESTAMP&#125;,</span><br><span class="line">    #&#123;tClue.createTime,jdbcType=TIMESTAMP&#125;, #&#123;tClue.createBy,jdbcType=INTEGER&#125;, #&#123;tClue.editTime,jdbcType=TIMESTAMP&#125;,</span><br><span class="line">    #&#123;tClue.editBy,jdbcType=INTEGER&#125;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后是测试，先打开数据库的t_clue看看有多少条数据库，共有65条，再次导入Excel表，报错Cannot add or update a child row: a foreign key constraint fails (<code>dlyk</code>.<code>t_clue</code>, CONSTRAINT <code>t_clue_ibfk_4</code> FOREIGN KEY (<code>owner_id</code>) REFERENCES <code>t_user</code> (<code>id</code>) ON DELETE RESTRICT ON UPDATE CASCADE)，问题出于产品引用的是字典表，这里数据库弄错了，应该改成产品表。然后重新导入，看看有没有问题。给的数据表最后一个人的id是21，但是t_user里没有21这个，所以需要更改成t_user里面有的就可以</p>
<p>然后给弄一个导入时间和导入人，谁登陆的就取谁的名字就行，但是导入人的id要从token拿，这里Request和token都不好拿，但是要想办法从前面传过来，可以从ClueController拿，然后把token传进去，再通过UploadDataListener构造器传进去<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250910170712872.png" alt="image-20250910170712872"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250910170814334.png" alt="image-20250910170814334"> </p>
<p>ClueController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> R <span class="title function_">importExcel</span><span class="params">(MultipartFile file, <span class="meta">@RequestHeader(value = &quot;Authoriazation&quot;)</span> String token)</span> <span class="keyword">throws</span> IOException &#123;</span><br></pre></td></tr></table></figure>

<p>ClueService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">importExcel</span><span class="params">(InputStream inputStream, String token)</span>;</span><br></pre></td></tr></table></figure>

<p>ClueServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">importExcel</span><span class="params">(InputStream inputStream, String token)</span> &#123;</span><br><span class="line">            EasyExcel.read(inputStream, TClue.class, <span class="keyword">new</span> <span class="title class_">UploadDataListener</span>(tClueMapper, token))</span><br><span class="line">            .sheet()</span><br><span class="line">            .doRead();</span><br></pre></td></tr></table></figure>

<p>UploadDataListener</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadDataListener</span> <span class="keyword">implements</span> <span class="title class_">ReadListener</span>&lt;TClue&gt; &#123;~~~</span><br><span class="line">	<span class="keyword">private</span> String token;~~~</span><br><span class="line">                                                                </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UploadDataListener</span><span class="params">(TClueMapper tClueMapper, String token)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.tClueMapper = tClueMapper;</span><br><span class="line">        <span class="built_in">this</span>.token = token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(TClue tClue, AnalysisContext context)</span> &#123;</span><br><span class="line">		<span class="comment">//给读到的clue对象设置创建时间(导入时间)和创建人（导入人），导入人的id要从token拿，这里Request和token都不好拿，但是要想办法从前面传过来，可以从ClueController拿</span></span><br><span class="line">        tClue.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">TUser</span> <span class="variable">tUser</span> <span class="operator">=</span> JWTUtils.parseUserFromJWT(token);<span class="comment">//用JWTUtils解析token</span></span><br><span class="line">        tClue.setCreateBy(tUser.getId());</span><br></pre></td></tr></table></figure>

<h2 id="录入线索"><a href="#录入线索" class="headerlink" title="录入线索"></a>录入线索</h2><h3 id="前端-4"><a href="#前端-4" class="headerlink" title="前端"></a>前端</h3><p>录入线索触发的函数就是addClue，写完函数再在router加上子路由，然后新建ClueRecordView，测试没问题的话就复制之前的表单进来修改，然后下拉选项是要先初始化给查出来，有的是查字典有的是查产品，<br>ClueView.vue</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//录入线索</span></span><br><span class="line"><span class="title function_">addClue</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&quot;/dashboard/clue/add&quot;</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>router.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">//路由路径，子路由路径不能以斜杠开头</span></span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;clue/add&#x27;</span>,</span><br><span class="line">    <span class="comment">//路由路径所对应的页面</span></span><br><span class="line">    component : <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/ClueRecordView.vue&#x27;</span>),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!--  label-width是下面表单laber的宽度样式，style=&quot;max-width: 95%是占整个页面百分之95  --&gt;</span><br><span class="line">  &lt;el-form</span><br><span class="line">      ref=&quot;clueRefForm&quot;</span><br><span class="line">      :model=&quot;clueQuery&quot;</span><br><span class="line">      :rules=&quot;clueRules&quot;</span><br><span class="line">      label-width=&quot;100px&quot;</span><br><span class="line">      style=&quot;max-width: 95%;&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;负责人&quot;&gt;</span><br><span class="line">      &lt;el-select</span><br><span class="line">          v-model=&quot;clueQuery.ownerId&quot;</span><br><span class="line">          placeholder=&quot;请选择负责人&quot;</span><br><span class="line">          style=&quot;width: 100%&quot;</span><br><span class="line">          clearable</span><br><span class="line">          disabled&gt;</span><br><span class="line">        &lt;el-option</span><br><span class="line">            v-for=&quot;item in ownerOptions&quot;</span><br><span class="line">            :key=&quot;item.id&quot;</span><br><span class="line">            :label=&quot;item.name&quot;</span><br><span class="line">            :value=&quot;item.id&quot;/&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;所属活动&quot;&gt;</span><br><span class="line">      &lt;el-select</span><br><span class="line">          v-model=&quot;clueQuery.activityId&quot;</span><br><span class="line">          placeholder=&quot;请选择所属活动&quot;</span><br><span class="line">          style=&quot;width: 100%&quot;</span><br><span class="line">          clearable&gt;</span><br><span class="line">        &lt;el-option</span><br><span class="line">            v-for=&quot;item in activityOptions&quot;</span><br><span class="line">            :key=&quot;item.id&quot;</span><br><span class="line">            :label=&quot;item.name&quot;</span><br><span class="line">            :value=&quot;item.id&quot;/&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;姓名&quot; prop=&quot;fullName&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;clueQuery.fullName&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;称呼&quot;&gt;</span><br><span class="line">      &lt;el-select</span><br><span class="line">          v-model=&quot;clueQuery.appellation&quot;</span><br><span class="line">          placeholder=&quot;请选择称呼&quot;</span><br><span class="line">          style=&quot;width: 100%&quot;</span><br><span class="line">          clearable&gt;</span><br><span class="line">        &lt;el-option</span><br><span class="line">            v-for=&quot;item in appellationOptions&quot;</span><br><span class="line">            :key=&quot;item.id&quot;</span><br><span class="line">            :label=&quot;item.typeValue&quot;</span><br><span class="line">            :value=&quot;item.id&quot;/&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;手机&quot; v-if=&quot;clueQuery.id &gt; 0&quot;&gt;&lt;!--此时是编辑，加上disabled就是不能改的意思--&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;clueQuery.phone&quot; disabled/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;手机&quot; prop=&quot;phone&quot; v-else&gt;&lt;!--此时是录入--&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;clueQuery.phone&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;微信&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;clueQuery.weixin&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;QQ&quot; prop=&quot;qq&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;clueQuery.qq&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;邮箱&quot; prop=&quot;email&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;clueQuery.email&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;年龄&quot; prop=&quot;age&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;clueQuery.age&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;职业&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;clueQuery.job&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;年收入&quot; prop=&quot;yearIncome&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;clueQuery.yearIncome&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;住址&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;clueQuery.address&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;贷款&quot;&gt;</span><br><span class="line">      &lt;el-select</span><br><span class="line">          v-model=&quot;clueQuery.needLoan&quot;</span><br><span class="line">          placeholder=&quot;请选择是否需要贷款&quot;</span><br><span class="line">          style=&quot;width: 100%&quot;</span><br><span class="line">          clearable&gt;</span><br><span class="line">        &lt;el-option</span><br><span class="line">            v-for=&quot;item in needLoanOptions&quot;</span><br><span class="line">            :key=&quot;item.id&quot;</span><br><span class="line">            :label=&quot;item.typeValue&quot;</span><br><span class="line">            :value=&quot;item.id&quot;/&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;意向状态&quot;&gt;</span><br><span class="line">      &lt;el-select</span><br><span class="line">          v-model=&quot;clueQuery.intentionState&quot;</span><br><span class="line">          placeholder=&quot;请选择意向状态&quot;</span><br><span class="line">          style=&quot;width: 100%&quot;</span><br><span class="line">          clearable&gt;</span><br><span class="line">        &lt;el-option</span><br><span class="line">            v-for=&quot;item in intentionStateOptions&quot;</span><br><span class="line">            :key=&quot;item.id&quot;</span><br><span class="line">            :label=&quot;item.typeValue&quot;</span><br><span class="line">            :value=&quot;item.id&quot;/&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;意向产品&quot;&gt;</span><br><span class="line">      &lt;el-select</span><br><span class="line">          v-model=&quot;clueQuery.intentionProduct&quot;</span><br><span class="line">          placeholder=&quot;请选择意向产品&quot;</span><br><span class="line">          style=&quot;width: 100%&quot;</span><br><span class="line">          clearable&gt;</span><br><span class="line">        &lt;el-option</span><br><span class="line">            v-for=&quot;item in productOptions&quot;</span><br><span class="line">            :key=&quot;item.id&quot;</span><br><span class="line">            :label=&quot;item.name&quot;</span><br><span class="line">            :value=&quot;item.id&quot;/&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;线索状态&quot;&gt;</span><br><span class="line">      &lt;el-select</span><br><span class="line">          v-model=&quot;clueQuery.state&quot;</span><br><span class="line">          placeholder=&quot;请选择线索状态&quot;</span><br><span class="line">          style=&quot;width: 100%&quot;</span><br><span class="line">          clearable&gt;</span><br><span class="line">        &lt;el-option</span><br><span class="line">            v-for=&quot;item in clueStateOptions&quot;</span><br><span class="line">            :key=&quot;item.id&quot;</span><br><span class="line">            :label=&quot;item.typeValue&quot;</span><br><span class="line">            :value=&quot;item.id&quot;/&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;线索来源&quot;&gt;</span><br><span class="line">      &lt;el-select</span><br><span class="line">          v-model=&quot;clueQuery.source&quot;</span><br><span class="line">          placeholder=&quot;请选择线索来源&quot;</span><br><span class="line">          style=&quot;width: 100%&quot;</span><br><span class="line">          clearable&gt;</span><br><span class="line">        &lt;el-option</span><br><span class="line">            v-for=&quot;item in sourceOptions&quot;</span><br><span class="line">            :key=&quot;item.id&quot;</span><br><span class="line">            :label=&quot;item.typeValue&quot;</span><br><span class="line">            :value=&quot;item.id&quot;/&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;线索描述&quot; prop=&quot;description&quot;&gt;</span><br><span class="line">      &lt;el-input</span><br><span class="line">          v-model=&quot;clueQuery.description&quot;</span><br><span class="line">          :rows=&quot;5&quot;</span><br><span class="line">          type=&quot;textarea&quot;</span><br><span class="line">          placeholder=&quot;请输入线索描述&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;下次联系时间&quot;&gt;</span><br><span class="line">      &lt;el-date-picker</span><br><span class="line">          v-model=&quot;clueQuery.nextContactTime&quot;</span><br><span class="line">          type=&quot;datetime&quot;</span><br><span class="line">          style=&quot;width: 100%;&quot;</span><br><span class="line">          value-format=&quot;YYYY-MM-DD HH:mm:ss&quot;</span><br><span class="line">          placeholder=&quot;请选择下次联系时间&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;addClueSubmit&quot;&gt;提 交&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;success&quot; plain @click=&quot;goBack&quot;&gt;返 回&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">  &lt;/el-form&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123;doGet&#125; <span class="keyword">from</span> <span class="string">&quot;../http/httpRequest.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ClueRecordView&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">//线索表单对象，初始值是空</span></span><br><span class="line">      clueQuery : &#123;&#125;,</span><br><span class="line">      <span class="comment">//负责人的下拉选项</span></span><br><span class="line">      ownerOptions : [&#123;&#125;],</span><br><span class="line">      <span class="comment">//市场活动的下拉选项数据，初始值是空</span></span><br><span class="line">      activityOptions : [&#123;&#125;],</span><br><span class="line">      <span class="comment">//意向产品的下拉选项</span></span><br><span class="line">      productOptions : [&#123;&#125;],</span><br><span class="line">      appellationOptions : [&#123;&#125;],</span><br><span class="line">      needLoanOptions : [&#123;&#125;],</span><br><span class="line">      intentionStateOptions : [&#123;&#125;],</span><br><span class="line">      clueStateOptions : [&#123;&#125;],</span><br><span class="line">      sourceOptions : [&#123;&#125;],</span><br><span class="line">      <span class="comment">//录入线索验证规则</span></span><br><span class="line">      clueRules : &#123;</span><br><span class="line">        phone : [</span><br><span class="line">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请输入手机号码&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;,</span><br><span class="line">          &#123; pattern : <span class="regexp">/^1[3-9]\d&#123;9&#125;$/</span>, <span class="attr">message</span>: <span class="string">&#x27;手机号码格式有误&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;,</span><br><span class="line">          &#123; validator : <span class="variable language_">this</span>.<span class="property">checkPhone</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;</span><br><span class="line">        ],</span><br><span class="line">        fullName : [</span><br><span class="line">          &#123; <span class="attr">min</span>: <span class="number">2</span>, <span class="attr">message</span>: <span class="string">&#x27;姓名至少2个汉字&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;,</span><br><span class="line">          &#123; pattern : <span class="regexp">/^[\u4e00-\u9fa5]&#123;0,&#125;$/</span>, <span class="attr">message</span>: <span class="string">&#x27;姓名必须为中文汉字&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;,</span><br><span class="line">        ],</span><br><span class="line">        qq : [</span><br><span class="line">          &#123; <span class="attr">min</span>: <span class="number">5</span>, <span class="attr">message</span>: <span class="string">&#x27;QQ号至少为5位&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;,</span><br><span class="line">          &#123; pattern : <span class="regexp">/^\d+$/</span>, <span class="attr">message</span>: <span class="string">&#x27;QQ号码必须为数字&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;,</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">email</span>: [</span><br><span class="line">          &#123; pattern : <span class="regexp">/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]&#123;2,&#125;$/</span>, <span class="attr">message</span>: <span class="string">&#x27;邮箱格式有误&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;,</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">age</span>: [</span><br><span class="line">          &#123; pattern : <span class="regexp">/^\d+$/</span>, <span class="attr">message</span>: <span class="string">&#x27;年龄必须为数字&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;,</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">yearIncome</span>: [</span><br><span class="line">          &#123; pattern : <span class="regexp">/^[0-9]+(\.[0-9]&#123;2&#125;)?$/</span>, <span class="attr">message</span>: <span class="string">&#x27;年收入必须是整数或者两位小数&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">description</span>: [</span><br><span class="line">          &#123; <span class="attr">min</span>: <span class="number">5</span>, <span class="attr">max</span>: <span class="number">255</span>, <span class="attr">message</span>: <span class="string">&#x27;线索描述长度为5-255个字符&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>)&#123;<span class="comment">//去调用下面的方法赋值</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadDicValue</span>(<span class="string">&#x27;appellation&#x27;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadDicValue</span>(<span class="string">&#x27;needLoan&#x27;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadDicValue</span>(<span class="string">&#x27;intentionState&#x27;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadDicValue</span>(<span class="string">&#x27;clueState&#x27;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadDicValue</span>(<span class="string">&#x27;source&#x27;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadDicValue</span>(<span class="string">&#x27;activity&#x27;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadDicValue</span>(<span class="string">&#x27;product&#x27;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadOwner</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadLoginUser</span>();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods : &#123;</span><br><span class="line">    <span class="comment">//加载字典数据，传过来一个字典类型，然后查对应的值，等于什么就给什么赋值</span></span><br><span class="line">    <span class="title function_">loadDicValue</span>(<span class="params">typeCode</span>) &#123;</span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/dicvalue/&quot;</span> + typeCode, &#123;&#125;).<span class="title function_">then</span>( <span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (typeCode === <span class="string">&#x27;appellation&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">appellationOptions</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeCode === <span class="string">&#x27;needLoan&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">needLoanOptions</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeCode === <span class="string">&#x27;intentionState&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">intentionStateOptions</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeCode === <span class="string">&#x27;clueState&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">clueStateOptions</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeCode === <span class="string">&#x27;source&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">sourceOptions</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeCode === <span class="string">&#x27;activity&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">activityOptions</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeCode === <span class="string">&#x27;product&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">productOptions</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="后端-8"><a href="#后端-8" class="headerlink" title="后端"></a>后端</h3><p>新建一个DicController，根据typeCode从cacheMap去拿数据。然后是从属活动，这个从属活动干脆也用定时任务放到内存里，几分钟一更新</p>
<p>DicController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DicController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/api/dicvalue/&#123;typeCode&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">dicData</span><span class="params">(<span class="meta">@PathVariable(value = &quot;typeCode&quot;)</span> String typeCode)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (typeCode.equals(DicEnum.ACTIVITY.getCode())) &#123; <span class="comment">//加个判断，是活动还是产品，都不是那就是字典表了</span></span><br><span class="line">            List&lt;TActivity&gt; tActivityList = (List&lt;TActivity&gt;)DlykServerApplication.cacheMap.get(typeCode);<span class="comment">//根据typeCode去拿数据</span></span><br><span class="line">            <span class="keyword">return</span> R.OK(tActivityList);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeCode.equals(DicEnum.PRODUCT.getCode())) &#123;</span><br><span class="line">            List&lt;TProduct&gt; tProductList = (List&lt;TProduct&gt;)DlykServerApplication.cacheMap.get(typeCode);</span><br><span class="line">            <span class="keyword">return</span> R.OK(tProductList);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            List&lt;TDicValue&gt; tDicValueList = (List&lt;TDicValue&gt;)DlykServerApplication.cacheMap.get(typeCode);</span><br><span class="line">            <span class="keyword">return</span> R.OK(tDicValueList);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>DataTask</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> ActivityService activityService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Scheduled(fixedDelayString = &quot;$&#123;project.task.delay&#125;&quot;, zone = &quot;Asia/Shanghai&quot;, timeUnit = TimeUnit.MILLISECONDS, initialDelay  = 1000)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">task</span><span class="params">()</span> &#123;~~~</span><br><span class="line">    <span class="comment">//查询所有正在进行的市场活动</span></span><br><span class="line">    List&lt;TActivity&gt; tActivityList = activityService.getOngoingActivity();</span><br><span class="line">    DlykServerApplication.cacheMap.put(DicEnum.ACTIVITY.getCode(), tActivityList);<span class="comment">//放进map</span></span><br></pre></td></tr></table></figure>

<p>ActivityService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TActivity&gt; <span class="title function_">getOngoingActivity</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>ActivityServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;TActivity&gt; <span class="title function_">getOngoingActivity</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> tActivityMapper.selectOngoingActivity();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TActivityMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TActivity&gt; <span class="title function_">selectOngoingActivity</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>TActivityMapper.xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--下面的那个开始结束时间要记得转义一下--&gt;</span><br><span class="line">&lt;select id=<span class="string">&quot;selectOngoingActivity&quot;</span> resultMap=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span><br><span class="line">  select</span><br><span class="line">  &lt;include refid=<span class="string">&quot;Base_Column_List&quot;</span> /&gt;</span><br><span class="line">  from t_activity</span><br><span class="line">  where  &lt;![CDATA[  start_time &lt;= now() and end_time &gt;= now() ]]&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h3 id="录入表单验证"><a href="#录入表单验证" class="headerlink" title="录入表单验证"></a>录入表单验证</h3><p>表单手机号是必填的，负责人就是当前登录人，页面渲染时加载一下登录人，写个加载当前登录用户方法，然后是写录入线索规则，代码在上面，手机要做个区分，编辑的时候是不能改的，录入的时候要做个验证。其他的可以不录入，但如果录入就必须要符合规范，并且手机号不能重复，避免销售人员录入同一个人，要去数据库查一下才知道有没有录入，验证里面支持一个叫方法验证的，</p>
<p>ClueRecordView</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">//录入线索验证规则，validator是验证方法，检查手机号，blur触发条件是光标离开后触发</span></span><br><span class="line">      clueRules : &#123;</span><br><span class="line">        phone : [</span><br><span class="line">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请输入手机号码&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;,</span><br><span class="line">          &#123; pattern : <span class="regexp">/^1[3-9]\d&#123;9&#125;$/</span>, <span class="attr">message</span>: <span class="string">&#x27;手机号码格式有误&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;,</span><br><span class="line">          &#123; validator : <span class="variable language_">this</span>.<span class="property">checkPhone</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>&#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line"><span class="title function_">mounted</span>(<span class="params"></span>)&#123;<span class="comment">//去调用下面的方法赋值~~~</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadOwner</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadLoginUser</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods : &#123;</span><br><span class="line">    <span class="comment">//加载负责人，让下面的用户id匹配上负责人的称呼，他会自动选中下拉菜单里符合id的名字</span></span><br><span class="line">    <span class="title function_">loadOwner</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/owner&quot;</span>, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>)  &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">ownerOptions</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//加载当前登录用户</span></span><br><span class="line">    <span class="title function_">loadLoginUser</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/login/info&quot;</span>, &#123;&#125;).<span class="title function_">then</span>( <span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(resp)</span><br><span class="line">        <span class="keyword">let</span> user = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">clueQuery</span>.<span class="property">ownerId</span> = user.<span class="property">id</span>;<span class="comment">//把用户赋给负责人</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">      </span><br><span class="line">    <span class="comment">//验证手机号有没有录入过，录入过的手机号，是不能再录入的</span></span><br><span class="line">    <span class="title function_">checkPhone</span>(<span class="params">rule, value, callback</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(rule)<span class="comment">//打印这三个函数看看，这个是验证规则</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(value) <span class="comment">// value 就是我们input框里面输入的手机号</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(callback)<span class="comment">//回调</span></span><br><span class="line">      <span class="comment">//验证该手机号是否已经录入过，如果录入过了，就不能再录入了，500是没通过，200是通过</span></span><br><span class="line">      <span class="keyword">let</span> phone = value;</span><br><span class="line">      <span class="keyword">if</span> (phone) &#123;</span><br><span class="line">        <span class="title function_">doGet</span>(<span class="string">&quot;/api/clue/&quot;</span> + phone, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;<span class="comment">//发个请求验证一下手机号</span></span><br><span class="line">          <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">500</span>) &#123;</span><br><span class="line">            <span class="comment">//手机号录入过了，不能再录入了</span></span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;该手机号录入过了，不能再录入.&#x27;</span>))</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">callback</span>(); <span class="comment">//验证通过了，直接调用一下callback()函数</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>后端<br>ClueController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/api/clue/&#123;phone&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">checkPhone</span><span class="params">(<span class="meta">@PathVariable(value = &quot;phone&quot;)</span> String phone)</span> &#123;</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">check</span> <span class="operator">=</span> clueService.checkPhone(phone);<span class="comment">//检查手机号返回布尔值</span></span><br><span class="line">    <span class="keyword">return</span> check ? R.OK() : R.FAIL();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ClueService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Boolean <span class="title function_">checkPhone</span><span class="params">(String phone)</span>;</span><br></pre></td></tr></table></figure>

<p>ClueServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Boolean <span class="title function_">checkPhone</span><span class="params">(String phone)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> tClueMapper.selectByCount(phone);</span><br><span class="line">    <span class="keyword">return</span> count &lt;= <span class="number">0</span>; <span class="comment">//没有查到手机号是true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TClueMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">selectByCount</span><span class="params">(String phone)</span>;</span><br></pre></td></tr></table></figure>

<p>TClueMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--count(0)是查总数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCount&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">    count(0)</span><br><span class="line">  from t_clue</span><br><span class="line">  where phone = #&#123;phone, jdbcType=VARCHAR&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="提交表单"><a href="#提交表单" class="headerlink" title="提交表单"></a>提交表单</h3><p>因为提交数据比较多，需要分开提交，用FormData取出数据提交。然后准备一个query接收参数，参数来自TClue。这里保存的时候如果连续点两次，后台会出现重复的两个数据，这里的解决方式是分布式锁或者synchronized做个线程，不过这里遇到的是可以一前一后插入的，老师在前端少写了个括号导致循环多次提交。返回按钮的话是goBack导入一下就可以使用了，methods里自动加goBack,<br>ClueRecordView</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~~~</span><br><span class="line"></span><br><span class="line"><span class="title class_">ClueController</span></span><br><span class="line">~~~java</span><br><span class="line">    @<span class="title class_">PreAuthorize</span>(value = <span class="string">&quot;hasAuthority(&#x27;clue:add&#x27;)&quot;</span>)</span><br><span class="line">    @<span class="title class_">PostMapping</span>(value = <span class="string">&quot;/api/clue&quot;</span>)</span><br><span class="line">    public R <span class="title function_">addClue</span>(<span class="params">ClueQuery clueQuery, @RequestHeader(value = <span class="string">&quot;Authorization&quot;</span>) <span class="built_in">String</span> token</span>) &#123;<span class="comment">//用query接收参数</span></span><br><span class="line">        clueQuery.<span class="title function_">setToken</span>(token);</span><br><span class="line">        int save = clueService.<span class="title function_">saveClue</span>(clueQuery);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> save &gt;= <span class="number">1</span> ? R.<span class="title function_">OK</span>() : R.<span class="title function_">FAIL</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ClueQuery</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">略 </span><br></pre></td></tr></table></figure>

<p>ClueService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">saveClue</span><span class="params">(ClueQuery clueQuery)</span>;</span><br></pre></td></tr></table></figure>

<p>ClueServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">saveClue</span><span class="params">(ClueQuery clueQuery)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> tClueMapper.selectByCount(clueQuery.getPhone());</span><br><span class="line">    <span class="keyword">if</span> (count &lt;= <span class="number">0</span>) &#123;<span class="comment">//没查到手机号才可以执行，防止重复录入</span></span><br><span class="line">        <span class="type">TClue</span> <span class="variable">tClue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TClue</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把前端提交过来的参数数据对象ClueQuery复制到TClue对象中</span></span><br><span class="line">        <span class="comment">//Spring框架有个工具类BeanUtils可以进行对象的复制,复制的条件要求是：两个对象的字段名要相同，字段的类型也相同，这样才可以复制</span></span><br><span class="line">        BeanUtils.copyProperties(clueQuery, tClue);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//解析jwt得到userId</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">loginUserId</span> <span class="operator">=</span> JWTUtils.parseUserFromJWT(clueQuery.getToken()).getId();</span><br><span class="line"></span><br><span class="line">        tClue.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>()); <span class="comment">//创建时间</span></span><br><span class="line">        tClue.setCreateBy(loginUserId); <span class="comment">//创建人id</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tClueMapper.insertSelective(tClue);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;该手机号已经录入过了，不能再录入&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="编辑功能"><a href="#编辑功能" class="headerlink" title="编辑功能"></a>编辑功能</h3><p>点击编辑也是跳入同一个页面，但是会查出数据，写个页面加载方法，然后后端也写上，运行一下报了个错，是说什么什么模糊不清的，是因为上面有个”&#x2F;api&#x2F;clue&#x2F;{phone}”，比如id是7，传phone也可以id也可以，会有个歧义，就可以改一下路径解决。编辑提交和录入共用一个方法，所以加个if判断，代码在前面，Controller里写个编辑方法，然后写写查询代码。测试一下，编辑提交没问题，但是有些有空值的提交会报错，这样可以加个判断，如果if  (this.clueQuery[field])有值就提交，没值就不提交，</p>
<p>ClueVIew</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">methods : &#123;</span><br><span class="line">  <span class="comment">//编辑</span></span><br><span class="line">  <span class="title function_">edit</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&quot;/dashboard/clue/edit/&quot;</span> + id);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>router.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">//路由路径，子路由路径不能以斜杠开头，id是动态变量，这个叫动态路由</span></span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;clue/edit/:id&#x27;</span>,</span><br><span class="line">    <span class="comment">//路由路径所对应的页面</span></span><br><span class="line">    component : <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/ClueRecordView.vue&#x27;</span>),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>ClueRecordView</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">//加载要编辑的数据（由于录入和编辑共用一个页面，所以要判断是编辑还是录入）</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">loadClue</span>();</span><br><span class="line"></span><br><span class="line">methods : &#123;</span><br><span class="line">  <span class="comment">//加载要编辑的线索数据</span></span><br><span class="line">  <span class="title function_">loadClue</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> id =  <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line">    <span class="keyword">if</span> (id) &#123; <span class="comment">//id存在，id有值，id不为空，说明的编辑</span></span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/clue/detail/&quot;</span> + id, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">clueQuery</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>ClueController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">@GetMapping(value = &quot;/api/clue/detail/&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">loadClue</span><span class="params">(<span class="meta">@PathVariable(value = &quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">      <span class="type">TClue</span> <span class="variable">tClue</span> <span class="operator">=</span> clueService.getClueById(id);</span><br><span class="line">      <span class="keyword">return</span> R.OK(tClue);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PutMapping(value = &quot;/api/clue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">editClue</span><span class="params">(ClueQuery clueQuery, <span class="meta">@RequestHeader(value = &quot;Authorization&quot;)</span> String token)</span> &#123;</span><br><span class="line">  clueQuery.setToken(token);</span><br><span class="line">  <span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> clueService.updateClue(clueQuery);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> update &gt;= <span class="number">1</span> ? R.OK() : R.FAIL();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ClueService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  TClue <span class="title function_">getClueById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateClue</span><span class="params">(ClueQuery clueQuery)</span>;</span><br></pre></td></tr></table></figure>

<p>ClueServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> TClue <span class="title function_">getClueById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> tClueMapper.selectByPrimaryKey(id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateClue</span><span class="params">(ClueQuery clueQuery)</span> &#123;</span><br><span class="line">    <span class="type">TClue</span> <span class="variable">tClue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TClue</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把前端提交过来的参数数据对象ClueQuery复制到TClue对象中</span></span><br><span class="line">    <span class="comment">//Spring框架有个工具类BeanUtils可以进行对象的复制,复制的条件要求是：两个对象的字段名要相同，字段的类型也相同，这样才可以复制</span></span><br><span class="line">    BeanUtils.copyProperties(clueQuery, tClue);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//解析jwt得到userId</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">loginUserId</span> <span class="operator">=</span> JWTUtils.parseUserFromJWT(clueQuery.getToken()).getId();</span><br><span class="line"></span><br><span class="line">    tClue.setEditTime(<span class="keyword">new</span> <span class="title class_">Date</span>()); <span class="comment">//编辑时间</span></span><br><span class="line">    tClue.setEditBy(loginUserId); <span class="comment">//编辑人id</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tClueMapper.updateByPrimaryKeySelective(tClue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ClueRecordView</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">addClueSubmit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">clueRefForm</span>.<span class="title function_">validate</span>( <span class="function">(<span class="params">isValid</span>) =&gt;</span>  &#123;<span class="comment">//验证clueRefForm表单是不是true</span></span><br><span class="line">      <span class="keyword">if</span> (isValid) &#123;</span><br><span class="line">        <span class="keyword">let</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();<span class="comment">//因为提交数据比较多，需要分开提交，用FormData取出数据提交</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> field <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">clueQuery</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span>  (<span class="variable language_">this</span>.<span class="property">clueQuery</span>[field]) &#123; <span class="comment">//this.clueQuery[field]有值，this.clueQuery[field]存在，this.clueQuery[field]不为空</span></span><br><span class="line">            formData.<span class="title function_">append</span>(field, <span class="variable language_">this</span>.<span class="property">clueQuery</span>[field]);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h3 id="详情功能"><a href="#详情功能" class="headerlink" title="详情功能"></a>详情功能</h3><p>点详情按钮或者点名字都可以进入到详情页面，然后新建ClueDetailView，这里就直接只读展示就行了，用div去弄，弄完把对象定义一下，看看报没报错。然后每个字段对应要查的表也不一样，所以是多表关联查询，页面加载时就查出所有参数。之前的ClueController里有个根据主键查询，我们需要连表查询，但是目前没有连表，所以改一下，然后就用这个方法查询，把ClueServiceImpl的getClueById方法的selectByPrimaryKey改为selectDetailById然后创建方法修改查询语句，弄完后把关联的对象写在data里，vue上面的代码也要修改成对应对象的取值。写好代码后测试一下看看问题，然后加个背景颜色，然后把goback导入一下</p>
<p>然后弄个跟踪记录，就是一些客户的后续内容写在这里t_clue_remark，id是自增的，线索id对应那个人，，note_ways是联系到的方式，后面是备注内容，点提交就是往这里插。提交写一下，然后初始化跟踪方式下拉框写上方法，让点一次就查一次。然后新建一个ClueRemarkController，前端参数用ClueRemarkQuery包装，创建service接口，实现后写个记录保存提交测试一下。以前要是跟踪联系过，就要展示一下跟踪方式之类的，之前在活动编辑里有个分页效果是差不多的，复制过来修改一下，然后把参数定义一下，查表语句也要把跟踪方式关联上<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250919222531771.png" alt="image-20250919222531771"></p>
<p>ClueView</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  这里是做了个插槽，scope是拿到clueList当前的对象，.row是拿到当前循环的clue对象，.id拿id，. fullName拿名字，javascript:让链接失效 --&gt;</span><br><span class="line">&lt;el-table-column label=&quot;姓名&quot;&gt;</span><br><span class="line">  &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">    &lt;a href=&quot;javascript:&quot; @click=&quot;view(scope.row.id)&quot;&gt;&#123;&#123; scope.row.fullName &#125;&#125;&lt;/a&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">&lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//详情</span></span><br><span class="line"> <span class="title function_">view</span>(<span class="params">id</span>) &#123;</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&quot;/dashboard/clue/detail/&quot;</span> + id);</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<p>router</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">                  <span class="comment">//路由路径，子路由路径不能以斜杠开头，id是动态变量，这个叫动态路由</span></span><br><span class="line">                  <span class="attr">path</span>: <span class="string">&#x27;clue/detail/:id&#x27;</span>,</span><br><span class="line">                  <span class="comment">//路由路径所对应的页面</span></span><br><span class="line">                  component : <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/ClueDetailView.vue&#x27;</span>),</span><br><span class="line">              &#125;,</span><br></pre></td></tr></table></figure>

<p>ClueDetailView</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-form</span><br><span class="line">      ref=&quot;clueRemarkRefForm&quot;</span><br><span class="line">      :model=&quot;clueRemark&quot;</span><br><span class="line">      label-width=&quot;110px&quot;</span><br><span class="line">      :rules=&quot;clueRemarkRules&quot;</span><br><span class="line">      style=&quot;max-width: 95%;&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;负责人&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.ownerDO.name&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;所属活动&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.activityDO.name&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;姓名&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.fullName&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;称呼&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.appellationDO.typeValue&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;手机&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.phone&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;微信&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.weixin&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;QQ&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.qq&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;邮箱&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.email&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;年龄&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.age&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;职业&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.job&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;年收入&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.yearIncome&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;住址&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.address&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;贷款&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.needLoanDO.typeValue&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;意向状态&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.intentionStateDO.typeValue&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;意向产品&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.intentionProductDO.name&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;线索状态&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.stateDO.typeValue&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;线索来源&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.sourceDO.typeValue&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;线索描述&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.description&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;下次联系时间&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;desc&quot;&gt;&#123;&#123;clueDetail.nextContactTime&#125;&#125;&amp;nbsp;&lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form-item label=&quot;填写跟踪记录&quot; prop=&quot;noteContent&quot;&gt;</span><br><span class="line">      &lt;el-input</span><br><span class="line">          v-model=&quot;clueRemark.noteContent&quot;</span><br><span class="line">          :rows=&quot;8&quot;</span><br><span class="line">          type=&quot;textarea&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;跟踪方式&quot; prop=&quot;noteWay&quot;&gt;</span><br><span class="line">      &lt;el-select</span><br><span class="line">          v-model=&quot;clueRemark.noteWay&quot;</span><br><span class="line">          placeholder=&quot;请选择跟踪方式&quot;</span><br><span class="line">          style=&quot;width: 100%&quot;</span><br><span class="line">          @click=&quot;loadDicValue(&#x27;noteWay&#x27;)&quot;</span><br><span class="line">          clearable&gt;</span><br><span class="line">        &lt;el-option</span><br><span class="line">            v-for=&quot;item in noteWayOptions&quot;</span><br><span class="line">            :key=&quot;item.id&quot;</span><br><span class="line">            :label=&quot;item.typeValue&quot;</span><br><span class="line">            :value=&quot;item.id&quot;/&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 如果state不是-1就显示转换按钮 --&gt;</span><br><span class="line">    &lt;el-form-item&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;clueRemarkSubmit&quot;&gt;提 交&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;success&quot; @click=&quot;convertCustomer&quot; v-if=&quot;clueDetail.state !== -1&quot;&gt;转换客户&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;success&quot; plain @click=&quot;goBack&quot;&gt;返 回&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">  &lt;/el-form&gt;</span><br><span class="line"></span><br><span class="line">  &lt;el-table</span><br><span class="line">      :data=&quot;clueRemarkList&quot;</span><br><span class="line">      style=&quot;width: 100%&quot;&gt;</span><br><span class="line">    &lt;el-table-column type=&quot;index&quot; label=&quot;序号&quot; width=&quot;60&quot;/&gt;</span><br><span class="line">    &lt;el-table-column prop=&quot;noteWayDO.typeValue&quot; label=&quot;跟踪方式&quot;/&gt;</span><br><span class="line">    &lt;el-table-column prop=&quot;noteContent&quot; label=&quot;跟踪内容&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;createTime&quot; label=&quot;跟踪时间&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;createByDO.name&quot; label=&quot;跟踪人&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;editTime&quot; label=&quot;编辑时间&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;editByDO.name&quot; label=&quot;编辑人&quot;/&gt;</span><br><span class="line">    &lt;el-table-column label=&quot;操作&quot;&gt;</span><br><span class="line">      &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;a href=&quot;javascript:&quot; @click=&quot;edit(scope.row.id)&quot;&gt;编辑&lt;/a&gt;</span><br><span class="line">        &amp;nbsp;</span><br><span class="line">        &lt;a href=&quot;javascript:&quot; @click=&quot;del(scope.row.id)&quot;&gt;删除&lt;/a&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-table-column&gt;</span><br><span class="line">  &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">  &lt;el-pagination</span><br><span class="line">      background</span><br><span class="line">      layout=&quot;prev, pager, next&quot;</span><br><span class="line">      :page-size=&quot;pageSize&quot;</span><br><span class="line">      :total=&quot;total&quot;</span><br><span class="line">      @prev-click=&quot;toPage&quot;</span><br><span class="line">      @next-click=&quot;toPage&quot;</span><br><span class="line">      @current-change=&quot;toPage&quot;/&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123;doGet, doPost&#125; <span class="keyword">from</span> <span class="string">&quot;../http/httpRequest.js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;goBack, messageTip&#125; <span class="keyword">from</span> <span class="string">&quot;../util/util.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ClueDetailView&quot;</span>,</span><br><span class="line"></span><br><span class="line">  inject : [<span class="string">&#x27;reload&#x27;</span>],</span><br><span class="line"></span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">//线索详情对象，初始值是空</span></span><br><span class="line">      clueDetail : &#123;</span><br><span class="line">        ownerDO : &#123;&#125;,</span><br><span class="line">        activityDO : &#123;&#125;,</span><br><span class="line">        appellationDO : &#123;&#125;,</span><br><span class="line">        needLoanDO : &#123;&#125;,</span><br><span class="line">        intentionStateDO : &#123;&#125;,</span><br><span class="line">        intentionProductDO : &#123;&#125;,</span><br><span class="line">        stateDO : &#123;&#125;,</span><br><span class="line">        sourceDO  : &#123;&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">//线索跟踪记录对象，初始值是空</span></span><br><span class="line">      clueRemark : &#123;&#125;,</span><br><span class="line">      <span class="comment">//跟踪方式的下拉选项，初始值是空</span></span><br><span class="line">      noteWayOptions : [&#123;&#125;],</span><br><span class="line">      <span class="comment">//线索跟踪记录列表，初始值是空</span></span><br><span class="line">      clueRemarkList : [&#123;</span><br><span class="line">        noteWayDO : &#123;&#125;,</span><br><span class="line">        createByDO : &#123;&#125;,</span><br><span class="line">        editByDO : &#123;&#125;</span><br><span class="line">      &#125;],</span><br><span class="line">      <span class="comment">//分页时每页显示多少条数据</span></span><br><span class="line">      pageSize : <span class="number">0</span>,</span><br><span class="line">      <span class="comment">//分页总共查询出多少条数据</span></span><br><span class="line">      total : <span class="number">0</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadClueDetail</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadClueRemarkList</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods : &#123;</span><br><span class="line">    goBack,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//加载线索详情</span></span><br><span class="line">    <span class="title function_">loadClueDetail</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> id = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/clue/detail/&quot;</span> + id, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">clueDetail</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提交线索跟踪记录</span></span><br><span class="line">    <span class="title function_">clueRemarkSubmit</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">doPost</span>(<span class="string">&quot;/api/clue/remark&quot;</span>, &#123;</span><br><span class="line">        clueId : <span class="variable language_">this</span>.<span class="property">clueDetail</span>.<span class="property">id</span>,<span class="comment">//拿到id，输入框内容，跟踪方式</span></span><br><span class="line">        noteContent : <span class="variable language_">this</span>.<span class="property">clueRemark</span>.<span class="property">noteContent</span>,</span><br><span class="line">        noteWay : <span class="variable language_">this</span>.<span class="property">clueRemark</span>.<span class="property">noteWay</span></span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="title function_">messageTip</span>(<span class="string">&quot;提交成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">          <span class="comment">//刷新</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">reload</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">messageTip</span>(<span class="string">&quot;提交失败&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//加载字典数据</span></span><br><span class="line">    <span class="title function_">loadDicValue</span>(<span class="params">typeCode</span>) &#123;</span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/dicvalue/&quot;</span> + typeCode, &#123;&#125;).<span class="title function_">then</span>( <span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (typeCode === <span class="string">&#x27;noteWay&#x27;</span>) &#123;<span class="comment">//如果是跟踪方式就赋值</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">noteWayOptions</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span>(typeCode === <span class="string">&#x27;product&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">productOptions</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询用户列表数据</span></span><br><span class="line">    <span class="title function_">loadClueRemarkList</span>(<span class="params">current</span>) &#123;</span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/clue/remark&quot;</span>, &#123;</span><br><span class="line">        current : current, <span class="comment">//当前查询第几页,</span></span><br><span class="line">        clueId : <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(resp);</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">clueRemarkList</span> = resp.<span class="property">data</span>.<span class="property">data</span>.<span class="property">list</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">pageSize</span> = resp.<span class="property">data</span>.<span class="property">data</span>.<span class="property">pageSize</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">total</span> = resp.<span class="property">data</span>.<span class="property">data</span>.<span class="property">total</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分页函数(current这个参数是ele-plus组件传过来，就是传的当前页)</span></span><br><span class="line">    <span class="title function_">toPage</span>(<span class="params">current</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">loadClueRemarkList</span>(current);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.desc</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">background-color</span>: <span class="number">#F0FFFF</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">padding-left</span>: <span class="number">15px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>TClueMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TClue <span class="title function_">selectDetailById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<p>TClueMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--可以直接复制上面的--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectDetailById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;ClueResultMap&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">    tc.*,</span><br><span class="line">    tu1.id ownerId, tu1.name ownerName,</span><br><span class="line">    ta.id activityId, ta.name activityName,</span><br><span class="line">    tdv.id appellationId, tdv.type_value appellationName,</span><br><span class="line">    tdv2.id needLoanId, tdv2.type_value needLoanName,</span><br><span class="line">    tdv3.id intentionStateId, tdv3.type_value intentionStateName,</span><br><span class="line">    tp.id intentionProductId,  tp.name intentionProductName,</span><br><span class="line">    tdv4.id stateId, tdv4.type_value stateName,</span><br><span class="line">    tdv5.id sourceId, tdv5.type_value sourceName</span><br><span class="line">  from t_clue tc left join t_user tu1 on tc.owner_id = tu1.id</span><br><span class="line">                 left join t_activity ta on tc.activity_id = ta.id</span><br><span class="line">                 left join t_dic_value tdv on tc.appellation = tdv.id</span><br><span class="line"></span><br><span class="line">                 left join t_dic_value tdv2 on tc.need_loan = tdv2.id</span><br><span class="line">                 left join t_dic_value tdv3 on tc.intention_state = tdv3.id</span><br><span class="line"></span><br><span class="line">                 left join t_product tp on tc.intention_product = tp.id</span><br><span class="line"></span><br><span class="line">                 left join t_dic_value tdv4 on tc.state = tdv4.id</span><br><span class="line">                 left join t_dic_value tdv5 on tc.source = tdv5.id</span><br><span class="line">  where tc.id = #&#123;id, jdbcType=INTEGER&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ClueRemarkController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClueRemarkController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ClueRemarkService clueRemarkService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/api/clue/remark&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">addActivityRemark</span><span class="params">(<span class="meta">@RequestBody</span> ClueRemarkQuery clueRemarkQuery, <span class="meta">@RequestHeader(value = &quot;Authorization&quot;)</span> String token)</span> &#123;</span><br><span class="line">        <span class="comment">//axios提交post请求，提交过来的是json数据，使用@RequestBody注解接收</span></span><br><span class="line">        clueRemarkQuery.setToken(token);</span><br><span class="line">        <span class="type">int</span> <span class="variable">save</span> <span class="operator">=</span> clueRemarkService.saveClueRemark(clueRemarkQuery);</span><br><span class="line">        <span class="keyword">return</span> save &gt;= <span class="number">1</span> ? R.OK( ) : R.FAIL();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="meta">@GetMapping(value = &quot;/api/clue/remark&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">clueRemarkPage</span><span class="params">(<span class="meta">@RequestParam(value = &quot;current&quot;, required = false)</span> Integer current,</span></span><br><span class="line"><span class="params">                            <span class="meta">@RequestParam(value = &quot;clueId&quot;)</span> Integer clueId)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ClueRemarkQuery</span> <span class="variable">clueRemarkQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClueRemarkQuery</span>();</span><br><span class="line">        clueRemarkQuery.setClueId(clueId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (current == <span class="literal">null</span>) &#123;</span><br><span class="line">            current = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        PageInfo&lt;TClueRemark&gt; pageInfo = clueRemarkService.getClueRemarkByPage(current, clueRemarkQuery);</span><br><span class="line">        <span class="keyword">return</span> R.OK(pageInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ClueRemarkQuery</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClueRemarkQuery</span> <span class="keyword">extends</span> <span class="title class_">BaseQuery</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer clueId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String noteContent;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer noteWay;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ClueRemarkService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   <span class="type">int</span> <span class="title function_">saveClueRemark</span><span class="params">(ClueRemarkQuery clueRemarkQuery)</span>;</span><br><span class="line"></span><br><span class="line">PageInfo&lt;TClueRemark&gt; <span class="title function_">getClueRemarkByPage</span><span class="params">(Integer current, ClueRemarkQuery clueRemarkQuery)</span>;</span><br></pre></td></tr></table></figure>

<p>ClueRemarkServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClueRemarkServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ClueRemarkService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TClueRemarkMapper tClueRemarkMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">saveClueRemark</span><span class="params">(ClueRemarkQuery clueRemarkQuery)</span> &#123;</span><br><span class="line">        <span class="type">TClueRemark</span> <span class="variable">tClueRemark</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TClueRemark</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把ClueRemarkQuery对象里面的属性数据复制到TClueRemark对象里面去(复制要求：两个对象的属性名相同，属性类型要相同，这样才能复制)</span></span><br><span class="line">        BeanUtils.copyProperties(clueRemarkQuery, tClueRemark);</span><br><span class="line"></span><br><span class="line">        tClueRemark.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>()); <span class="comment">//创建时间</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//登录人的id</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">loginUserId</span> <span class="operator">=</span> JWTUtils.parseUserFromJWT(clueRemarkQuery.getToken()).getId();</span><br><span class="line">        tClueRemark.setCreateBy(loginUserId); <span class="comment">//创建人</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tClueRemarkMapper.insertSelective(tClueRemark);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageInfo&lt;TClueRemark&gt; <span class="title function_">getClueRemarkByPage</span><span class="params">(Integer current, ClueRemarkQuery clueRemarkQuery)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.设置PageHelper</span></span><br><span class="line">        PageHelper.startPage(current, Constants.PAGE_SIZE);</span><br><span class="line">        <span class="comment">// 2.查询</span></span><br><span class="line">        List&lt;TClueRemark&gt; list = tClueRemarkMapper.selectClueRemarkByPage(clueRemarkQuery);</span><br><span class="line">        <span class="comment">// 3.封装分页数据到PageInfo</span></span><br><span class="line">        PageInfo&lt;TClueRemark&gt; info = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(list);</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TClueRemarkMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DataScope(tableAlias = &quot;tcr&quot;,tableField = &quot;create_by&quot;)</span><span class="comment">//权限过滤</span></span><br><span class="line">List&lt;TClueRemark&gt; <span class="title function_">selectClueRemarkByPage</span><span class="params">(ClueRemarkQuery clueRemarkQuery)</span>;</span><br></pre></td></tr></table></figure>

<p>TClueRemarkMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;ClueRemarkResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.bjpowernode.model.TClueRemark&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;clue_id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;clueId&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;note_way&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;noteWay&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;note_content&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;noteContent&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_by&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createBy&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;edit_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;editTime&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;edit_by&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;editBy&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;deleted&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;deleted&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;createByDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TUser&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;createById&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;createByName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;editByDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TUser&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;editById&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;editByName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;noteWayDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TDicValue&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;noteWayId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;noteWayName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;typeValue&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectClueRemarkByPage&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;ClueRemarkResultMap&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">    tcr.*,</span><br><span class="line">    tu1.id createById, tu1.name createByName,</span><br><span class="line">    tu2.id editById, tu2.name editByName,</span><br><span class="line">    tdv.id noteWayId, tdv.type_value noteWayName</span><br><span class="line">    from t_clue_remark tcr left join t_user tu1 on tcr.create_by  = tu1.id</span><br><span class="line">    left join t_user tu2 on tcr.edit_by  = tu2.id</span><br><span class="line">    left join t_dic_value tdv on tcr.note_way = tdv.id</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">      tcr.clue_id = #&#123;clueId, jdbcType=INTEGER&#125; and (tcr.deleted is null or tcr.deleted = 0)</span><br><span class="line"></span><br><span class="line">      $&#123;filterSQL&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>TClueRemark关联表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> TUser createByDO;</span><br><span class="line"><span class="keyword">private</span> TUser editByDO;</span><br><span class="line"><span class="keyword">private</span> TDicValue noteWayDO;</span><br></pre></td></tr></table></figure>

<h4 id="转成客户"><a href="#转成客户" class="headerlink" title="转成客户"></a>转成客户</h4><p>然后是如果这个人有意向购买之类的就转成客户，点击转成客户后要弹个窗，之前的活动备注记录弹窗代码可以复制修改一下，再加个点击事件，把产品也查出来 ，然后做提交功能，因为参数比较少可以直接一个一个传，然后提交也要加上验证。先传一个线索id，就是哪个id要转成客户，其他的再分别调用自己的，因为是线索传客户，所以要弄个客户Controller，然后使用post传过来是个json，所以用RequestBody接收，接收用query封装。实现这个方法向客户表插入数据的同时也要把线索表的数据状态改为-1，也就是t_clue里的state。这里涉及到对多个表操作，根据阿里手册，manager层有个特征是与dao层交互，对多个dao的组合复用，就不放在service写了。新建一个CustomerManager，然后把注入的bean也放在这里面组合复用，写好代码后，<strong>之前所有的增删改操作都没有加上事务管理，所以后面要挨个加上，如果有异常就把事务回滚</strong>，这里先添加了一下@Transactional，这里嫌麻烦懒得写笔记了。然后测试代码，如果已经是客户了就不会显示这个转换客户按钮，是在vue按钮代码那里做了个判断，代码还是在上面。已经转成客户的可以不显示也可以弄个颜色区分一下，代码是clueView的线索状态里<br>ClueDetailView</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--线索转换为客户的弹窗（对话框）--&gt;</span><br><span class="line"> &lt;el-dialog v-model=&quot;convertCustomerDialogVisible&quot; title=&quot;线索转换客户&quot; width=&quot;55%&quot; center&gt;</span><br><span class="line">   &lt;el-form ref=&quot;convertCustomerRefForm&quot; :model=&quot;customerQuery&quot; label-width=&quot;110px&quot; :rules=&quot;convertCustomerRules&quot;&gt;</span><br><span class="line">     &lt;el-form-item label=&quot;意向产品&quot; prop=&quot;product&quot;&gt;</span><br><span class="line">       &lt;el-select v-model=&quot;customerQuery.product&quot; placeholder=&quot;请选择&quot; style=&quot;width: 100%;&quot; @click=&quot;loadDicValue(&#x27;product&#x27;)&quot;&gt;</span><br><span class="line">         &lt;el-option</span><br><span class="line">             v-for=&quot;item in productOptions&quot;</span><br><span class="line">             :key=&quot;item.id&quot;</span><br><span class="line">             :label=&quot;item.name&quot;</span><br><span class="line">             :value=&quot;item.id&quot;/&gt;</span><br><span class="line">       &lt;/el-select&gt;</span><br><span class="line">     &lt;/el-form-item&gt;</span><br><span class="line">     &lt;el-form-item label=&quot;客户描述&quot; prop=&quot;description&quot;&gt;</span><br><span class="line">       &lt;el-input</span><br><span class="line">           v-model=&quot;customerQuery.description&quot;</span><br><span class="line">           :rows=&quot;8&quot;</span><br><span class="line">           type=&quot;textarea&quot;</span><br><span class="line">           placeholder=&quot;请输入客户描述&quot;/&gt;</span><br><span class="line">     &lt;/el-form-item&gt;</span><br><span class="line">     &lt;el-form-item label=&quot;下次跟踪时间&quot; prop=&quot;nextContactTime&quot;&gt;</span><br><span class="line">       &lt;el-date-picker</span><br><span class="line">           v-model=&quot;customerQuery.nextContactTime&quot;</span><br><span class="line">           type=&quot;datetime&quot;</span><br><span class="line">           style=&quot;width: 100%;&quot;</span><br><span class="line">           value-format=&quot;YYYY-MM-DD HH:mm:ss&quot;</span><br><span class="line">           placeholder=&quot;请选择下次跟踪时间&quot;/&gt;</span><br><span class="line">     &lt;/el-form-item&gt;</span><br><span class="line">   &lt;/el-form&gt;</span><br><span class="line">   &lt;template #footer&gt;</span><br><span class="line">     &lt;span class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">       &lt;el-button @click=&quot;convertCustomerDialogVisible = false&quot;&gt;关 闭&lt;/el-button&gt;</span><br><span class="line">       &lt;el-button type=&quot;primary&quot; @click=&quot;convertCustomerSubmit&quot;&gt;转 换&lt;/el-button&gt;</span><br><span class="line">     &lt;/span&gt;</span><br><span class="line">   &lt;/template&gt;</span><br><span class="line"> &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="comment">//定义转换客户的弹窗是否弹出来，默认是false不弹出来，true就弹出来</span></span><br><span class="line">      convertCustomerDialogVisible : <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">//线索转换为客户的form表单对象，初始值是空</span></span><br><span class="line">      customerQuery : &#123;&#125;,</span><br><span class="line">      <span class="comment">//定义线索转换为客户的验证规则</span></span><br><span class="line">      convertCustomerRules : &#123;</span><br><span class="line">        product : [</span><br><span class="line">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请选择意向产品&#x27;</span>, <span class="attr">trigger</span>: [<span class="string">&#x27;blur&#x27;</span>, <span class="string">&#x27;change&#x27;</span>] &#125;</span><br><span class="line">        ],</span><br><span class="line">        description : [</span><br><span class="line">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;客户描述不能为空&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">min</span>: <span class="number">5</span>, <span class="attr">max</span>: <span class="number">255</span>, <span class="attr">message</span>: <span class="string">&#x27;客户描述长度为5-255个字符&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;</span><br><span class="line">        ],</span><br><span class="line">        nextContactTime : [</span><br><span class="line">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请选择下次联系时间&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CustomerQuery</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerQuery</span> <span class="keyword">extends</span> <span class="title class_">BaseQuery</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer clueId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer product;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date nextContactTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CustomerController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CustomerService customerService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/api/clue/customer&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">convertCustomer</span><span class="params">(<span class="meta">@RequestBody</span> CustomerQuery customerQuery, <span class="meta">@RequestHeader(value = &quot;Authorization&quot;)</span> String token)</span> &#123;</span><br><span class="line">        customerQuery.setToken(token);</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">convert</span> <span class="operator">=</span> customerService.convertCustomer(customerQuery);</span><br><span class="line">        <span class="keyword">return</span> convert ? R.OK() : R.FAIL();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CustomerService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CustomerService</span> &#123;</span><br><span class="line">    Boolean <span class="title function_">convertCustomer</span><span class="params">(CustomerQuery customerQuery)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CustomerServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CustomerService</span> &#123;</span><br><span class="line"><span class="comment">/*    @Resource</span></span><br><span class="line"><span class="comment">    private TCustomerMapper tCustomerMapper;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    @Resource</span></span><br><span class="line"><span class="comment">    private TClueMapper tClueMapper;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    @Override</span></span><br><span class="line"><span class="comment">    public Boolean convertCustomer(CustomerQuery customerQuery) &#123;</span></span><br><span class="line"><span class="comment">        //1、验证该线索是否已经转过客户，转过了就不能再转了</span></span><br><span class="line"><span class="comment">        //2、向客户表插入一条数据</span></span><br><span class="line"><span class="comment">        //3、把线索表的数据状态改为-1（已转客户）</span></span><br><span class="line"><span class="comment">        return null;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    上面这些代码都放到CustomerManager里了</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CustomerManager customerManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">convertCustomer</span><span class="params">(CustomerQuery customerQuery)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> customerManager.convertCustomer(customerQuery);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CustomerManager</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerManager</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TCustomerMapper tCustomerMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TClueMapper tClueMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span><span class="comment">//事务管理，出异常就回滚</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">convertCustomer</span><span class="params">(CustomerQuery customerQuery)</span> &#123;</span><br><span class="line">        <span class="comment">//1、验证该线索是否已经转过客户，转过了就不能再转了</span></span><br><span class="line">        <span class="type">TClue</span> <span class="variable">tClue</span> <span class="operator">=</span> tClueMapper.selectByPrimaryKey(customerQuery.getClueId());</span><br><span class="line">        <span class="keyword">if</span> (tClue.getState() == -<span class="number">1</span>) &#123;<span class="comment">//如果已经是-1了就是客户了，new个全局异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;该线索已经转过客户，不能再转了.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、向客户表插入一条数据</span></span><br><span class="line">        <span class="type">TCustomer</span> <span class="variable">tCustomer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TCustomer</span>();</span><br><span class="line">        <span class="comment">//把CustomerQuery对象里面的属性数据复制到TCustomer对象里面去(复制要求：两个对象的属性名相同，属性类型要相同，这样才能复制)</span></span><br><span class="line">        BeanUtils.copyProperties(customerQuery, tCustomer);</span><br><span class="line">        tCustomer.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>()); <span class="comment">//创建时间</span></span><br><span class="line">        <span class="comment">//登录人的id</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">loginUserId</span> <span class="operator">=</span> JWTUtils.parseUserFromJWT(customerQuery.getToken()).getId();</span><br><span class="line">        tCustomer.setCreateBy(loginUserId); <span class="comment">//创建人</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">insert</span> <span class="operator">=</span> tCustomerMapper.insertSelective(tCustomer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、把线索表的数据状态改为-1（已转客户）</span></span><br><span class="line">        <span class="type">TClue</span> <span class="variable">clue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TClue</span>();<span class="comment">//new一个线索表，把id更新，然后设置-1这个状态，最后更新表</span></span><br><span class="line">        clue.setId(customerQuery.getClueId());</span><br><span class="line">        clue.setState(-<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> tClueMapper.updateByPrimaryKeySelective(clue);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> insert &gt;= <span class="number">1</span> &amp;&amp; update &gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ClueView</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 做了个插槽用以区分是否成为客户，这里如果是-1就是成为了，加个颜色，否则就不加   --&gt;</span><br><span class="line">&lt;el-table-column label=&quot;线索状态&quot;&gt;</span><br><span class="line">  &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">    &lt;span style=&quot;background: lightgoldenrodyellow&quot; v-if=&quot;scope.row.state === -1&quot;&gt; &#123;&#123; scope.row.stateDO.typeValue &#125;&#125; &lt;/span&gt;</span><br><span class="line">    &lt;span v-else&gt; &#123;&#123; scope.row.stateDO.typeValue &#125;&#125; &lt;/span&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">&lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure>

<h1 id="客户管理"><a href="#客户管理" class="headerlink" title="客户管理"></a>客户管理</h1><p>还是老样子的代码，先在dashboardVIew里添加路由，然后router子路由，然后新建vue，然后在CustomerController传数据，后面就是关联九个映射表，老师展示了个替换的快捷键<strong>ctrl+r</strong></p>
<p>DashboardView</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-menu-item index=&quot;/dashboard/customer&quot;&gt;</span><br><span class="line">  &lt;el-icon&gt;&lt;CreditCard /&gt;&lt;/el-icon&gt;</span><br><span class="line">  客户管理</span><br><span class="line">&lt;/el-menu-item&gt;</span><br></pre></td></tr></table></figure>

<p>router</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">//路由路径，子路由路径不能以斜杠开头</span></span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;customer&#x27;</span>,</span><br><span class="line">    <span class="comment">//路由路径所对应的页面</span></span><br><span class="line">    component : <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/CustomerView.vue&#x27;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CustomerView</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-button type=&quot;primary&quot; class=&quot;btn&quot; @click=&quot;batchExportExcel&quot;&gt;批量导出(Excel)&lt;/el-button&gt;</span><br><span class="line">  &lt;el-button type=&quot;success&quot; class=&quot;btn&quot; @click=&quot;chooseExportExcel&quot;&gt;选择导出(Excel)&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">  &lt;el-table</span><br><span class="line">      :data=&quot;customerList&quot;</span><br><span class="line">      style=&quot;width: 100%&quot;</span><br><span class="line">      @selection-change=&quot;handleSelectionChange&quot;&gt;</span><br><span class="line">    &lt;el-table-column type=&quot;selection&quot; width=&quot;50&quot;/&gt;</span><br><span class="line">    &lt;el-table-column type=&quot;index&quot; label=&quot;序号&quot; width=&quot;65&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;ownerDO.name&quot; label=&quot;负责人&quot; width=&quot;120&quot; /&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;activityDO.name&quot; label=&quot;所属活动&quot;/&gt;</span><br><span class="line">    &lt;el-table-column label=&quot;姓名&quot;&gt;</span><br><span class="line">      &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;a href=&quot;javascript:&quot; @click=&quot;view(scope.row.id)&quot;&gt;&#123;&#123; scope.row.clueDO.fullName &#125;&#125;&lt;/a&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-table-column&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;appellationDO.typeValue&quot; label=&quot;称呼&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;clueDO.phone&quot; label=&quot;手机&quot; width=&quot;120&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;clueDO.weixin&quot; label=&quot;微信&quot; width=&quot;120&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;needLoanDO.typeValue&quot; label=&quot;是否贷款&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;intentionStateDO.typeValue&quot; label=&quot;意向状态&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;stateDO.typeValue&quot; label=&quot;线索状态&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;sourceDO.typeValue&quot; label=&quot;线索来源&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;intentionProductDO.name&quot; label=&quot;意向产品&quot;/&gt;</span><br><span class="line">    &lt;el-table-column property=&quot;nextContactTime&quot; label=&quot;下次联系时间&quot; width=&quot;165&quot;/&gt;</span><br><span class="line">    &lt;el-table-column label=&quot;操作&quot; width=&quot;85&quot;&gt;</span><br><span class="line">      &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;view(scope.row.id)&quot;&gt;详情&lt;/el-button&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-table-column&gt;</span><br><span class="line">  &lt;/el-table&gt;</span><br><span class="line">  &lt;p&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">        background</span><br><span class="line">        layout=&quot;prev, pager, next&quot;</span><br><span class="line">        :page-size=&quot;pageSize&quot;</span><br><span class="line">        :total=&quot;total&quot;</span><br><span class="line">        @prev-click=&quot;page&quot;</span><br><span class="line">        @next-click=&quot;page&quot;</span><br><span class="line">        @current-change=&quot;page&quot;/&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123;defineComponent&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;doGet&#125; <span class="keyword">from</span> <span class="string">&quot;../http/httpRequest.js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;messageTip&#125; <span class="keyword">from</span> <span class="string">&quot;../util/util.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;CustomerView&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">//客户列表数据对象，初始值是空</span></span><br><span class="line">      customerList : [&#123;</span><br><span class="line">        clueDO : &#123;&#125;,</span><br><span class="line">        ownerDO : &#123;&#125;,</span><br><span class="line">        activityDO : &#123;&#125;,</span><br><span class="line">        appellationDO : &#123;&#125;,</span><br><span class="line">        needLoanDO : &#123;&#125;,</span><br><span class="line">        intentionStateDO : &#123;&#125;,</span><br><span class="line">        stateDO : &#123;&#125;,</span><br><span class="line">        sourceDO : &#123;&#125;,</span><br><span class="line">        intentionProductDO : &#123;&#125;,</span><br><span class="line">      &#125;],</span><br><span class="line">      <span class="comment">//分页时每页显示多少条数据</span></span><br><span class="line">      pageSize : <span class="number">0</span>,</span><br><span class="line">      <span class="comment">//总共有多少条</span></span><br><span class="line">      total : <span class="number">0</span>,</span><br><span class="line">      <span class="comment">//客户的id数组，初始值是空</span></span><br><span class="line">      customerIdArray : []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getData</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods : &#123;</span><br><span class="line">    <span class="comment">//获取线索分页列表数据</span></span><br><span class="line">    <span class="title function_">getData</span>(<span class="params">current</span>) &#123;</span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/customers&quot;</span>, &#123;</span><br><span class="line">        current : current <span class="comment">//当前页，前面是参数名，后面是参数值</span></span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">customerList</span> = resp.<span class="property">data</span>.<span class="property">data</span>.<span class="property">list</span>; <span class="comment">// resp.data  =  R 对象</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">pageSize</span> = resp.<span class="property">data</span>.<span class="property">data</span>.<span class="property">pageSize</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">total</span> = resp.<span class="property">data</span>.<span class="property">data</span>.<span class="property">total</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分页函数</span></span><br><span class="line">    <span class="title function_">page</span>(<span class="params">number</span>) &#123; <span class="comment">//number值是element-plus回调时传给我们的，number这个值就是当前页</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">getData</span>(number);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.el-table</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>CustomerController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/api/customers&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">cluePage</span><span class="params">(<span class="meta">@RequestParam(value = &quot;current&quot;, required = false)</span> Integer current)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (current == <span class="literal">null</span>) &#123;</span><br><span class="line">        current = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PageInfo&lt;TCustomer&gt; pageInfo = customerService.getCustomerByPage(current);</span><br><span class="line">    <span class="keyword">return</span> R.OK(pageInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CustomerService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PageInfo&lt;TCustomer&gt; <span class="title function_">getCustomerByPage</span><span class="params">(Integer current)</span>;</span><br></pre></td></tr></table></figure>

<p>CustomerServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> TCustomerMapper tCustomerMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageInfo&lt;TCustomer&gt; <span class="title function_">getCustomerByPage</span><span class="params">(Integer current)</span> &#123;</span><br><span class="line">    <span class="comment">//1.设置PageHelper</span></span><br><span class="line">    PageHelper.startPage(current, Constants.PAGE_SIZE);</span><br><span class="line">    <span class="comment">//2.查询</span></span><br><span class="line">    List&lt;TCustomer&gt; list = tCustomerMapper.selectCustomerPage();</span><br><span class="line">    <span class="comment">//3.封装分页数据到PageInfo</span></span><br><span class="line">    PageInfo&lt;TCustomer&gt; info = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(list);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> info;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TCustomerMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TCustomer&gt; <span class="title function_">selectCustomerPage</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>TCustomerMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;CustomerResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.bjpowernode.model.TCustomer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;clue_id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;clueId&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;product&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;product&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;next_contact_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;nextContactTime&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_by&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createBy&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;edit_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;editTime&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;edit_by&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;editBy&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联线索--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;clueDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TClue&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;clueId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;full_name&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;fullName&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;weixin&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;weixin&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;qq&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;qq&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;job&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;job&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;year_income&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;DECIMAL&quot;</span> <span class="attr">property</span>=<span class="string">&quot;yearIncome&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;ownerDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TUser&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;ownerId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;ownerName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;activityDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TActivity&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;activityId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;activityName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;appellationDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TDicValue&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;appellationId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;appellationName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;typeValue&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;needLoanDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TDicValue&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;needLoanId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;needLoanName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;typeValue&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;intentionStateDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TDicValue&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;intentionStateId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;intentionStateName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;typeValue&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;stateDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TDicValue&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;stateId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;stateName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;typeValue&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;sourceDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TDicValue&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;sourceId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sourceName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;typeValue&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关联查询的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;intentionProductDO&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.bjpowernode.model.TProduct&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;intentionProductId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;intentionProductName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectCustomerPage&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CustomerResultMap&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">      tct.*,</span><br><span class="line">      tc.id clueId, tc.full_name, tc.phone, tc.weixin,</span><br><span class="line">      tu1.id ownerId, tu1.name ownerName,</span><br><span class="line">      ta.id activityId, ta.name activityName,</span><br><span class="line">      tdv.id appellationId, tdv.type_value appellationName,</span><br><span class="line">      tdv2.id needLoanId, tdv2.type_value needLoanName,</span><br><span class="line">      tdv3.id intentionStateId, tdv3.type_value intentionStateName,</span><br><span class="line">      tdv4.id stateId, tdv4.type_value stateName,</span><br><span class="line">      tdv5.id sourceId, tdv5.type_value sourceName,</span><br><span class="line">      tp.id intentionProductId, tp.name intentionProductName</span><br><span class="line">    from t_customer tct left join t_clue tc on tct.clue_id = tc.id</span><br><span class="line">                        left join t_user tu1 on tc.owner_id = tu1.id</span><br><span class="line">                        left join t_activity ta on tc.activity_id = ta.id</span><br><span class="line">                        left join t_dic_value tdv on tc.appellation = tdv.id</span><br><span class="line">                        left join t_dic_value tdv2 on tc.need_loan = tdv2.id</span><br><span class="line">                        left join t_dic_value tdv3 on tc.intention_state = tdv3.id</span><br><span class="line">                        left join t_dic_value tdv4 on tc.state = tdv4.id</span><br><span class="line">                        left join t_dic_value tdv5 on tc.source = tdv5.id</span><br><span class="line">                        left join t_product tp on tct.product = tp.id</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>TCustomer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一对一关联8个对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">TClue</span> <span class="variable">clueDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TClue</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="type">TUser</span> <span class="variable">ownerDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TUser</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="type">TActivity</span> <span class="variable">activityDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TActivity</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="type">TDicValue</span> <span class="variable">appellationDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TDicValue</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="type">TDicValue</span> <span class="variable">needLoanDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TDicValue</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="type">TDicValue</span> <span class="variable">intentionStateDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TDicValue</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="type">TProduct</span> <span class="variable">intentionProductDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TProduct</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="type">TDicValue</span> <span class="variable">stateDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TDicValue</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="type">TDicValue</span> <span class="variable">sourceDO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TDicValue</span>();</span><br></pre></td></tr></table></figure>

<h2 id="默认展开当前菜单"><a href="#默认展开当前菜单" class="headerlink" title="默认展开当前菜单"></a>默认展开当前菜单</h2><p>然后要做个侧边栏点到哪里就一直显示的功能，刷新也是一直展开当前那个页面的侧边栏，思路是在DashboardView里把点开的菜单路径赋值到&lt;el-menu   default-active&#x3D;””这里面，然后先给个变量，每次页面渲染时去变动一下。但是有个问题，三层的路径会出现找不到的情况，因为和点击触发的页面路径不一样，也就不匹配了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-menu</span><br><span class="line">       default-active=&quot;currentRouterPath&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span>&#123;</span><br><span class="line">    <span class="comment">//当前访问的路由路径</span></span><br><span class="line">    currentRouterPath : <span class="string">&#x27;&#x27;</span></span><br><span class="line">      </span><br><span class="line"> <span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span><br><span class="line">         <span class="variable language_">this</span>.<span class="title function_">loadCurrentRouterPath</span>();</span><br><span class="line">     </span><br><span class="line">methods : &#123;</span><br><span class="line">  <span class="comment">//加载当前路由路径</span></span><br><span class="line">  <span class="title function_">loadCurrentRouterPath</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> path = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">path</span>; <span class="comment">//   /dashboard/activity/add，会出现三层匹配不到路径的问题</span></span><br><span class="line">    <span class="keyword">let</span> arr = path.<span class="title function_">split</span>(<span class="string">&quot;/&quot;</span>); <span class="comment">//   [  ,dashboard, activity, add]被拆分成逗号分隔的数组，这里面有四个元素</span></span><br><span class="line">    <span class="keyword">if</span> (arr.<span class="property">length</span> &gt; <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">currentRouterPath</span> = <span class="string">&quot;/&quot;</span> + arr[<span class="number">1</span>] + <span class="string">&quot;/&quot;</span> + arr[<span class="number">2</span>];<span class="comment">//arr[0]是空字符</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">currentRouterPath</span> = path;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="excel批量导出"><a href="#excel批量导出" class="headerlink" title="excel批量导出"></a>excel批量导出</h2><p>批量导出就是把所有的数据都导出，选择导出就是选择的导出，导出的代码还是看之前的excel文档，里面有个web上传下载的那个。这里使用iframe标签，这个相当于在页面打个洞，里面显示一些东西，比如下图，内容来自src，页面发送个请求，请求给后台然后返回文件流，文件流被浏览器识别到后弹出一个下载框。前端写好后到后端，根据excel文档给出的代码去修改，然后在result新建一个CustomerExcel类，里面写上从数据库需要查出来然后导入到excel里的字段。<br>要想让浏览器弹出下载框，你后端要设置一下响应头信息,原版的officedocument比较特殊，用下面这个代表任意二进制流就行，也就是内容类型，然后查出CustomerExcel里的所有字段，再然后把文件输出。查询方法里是selectCustomerPage复制过来的可以直接用，不需要参数，然后把从数据库查询出来的List<TCustomer>数据，转换为 List<CustomerExcel>数据，不能直接复制，因为字段对不上。<br>所有的请求都会被filter拦截，就需要手动加个token ?Authorization，要拿到token值的话就要去util.js写个方法，从两个范围去拿,一个是session，一个是local，如果session没有值就从local拿一下，如果拿到了就返回token，还没拿到就提示重新登陆。然后在view拼好token，然后修改TokenVerifyFilter，然后在Constants写上导出路径，这样就完成了，转到前端测试一下下载。<br>导出的文件前面暂时用的固定的12345.xlsx，后面定义一个，在Constants写上名字+时间戳的形式，但是名字有中文可能出现乱码，所以可以用URLEncoder.encode(xxx, “utf-8”)来编码，但是加在Constants里的时间戳就会变成常量，所以改成在vue命名里写时间戳</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250923030015218.png" alt="image-20250923030015218"></p>
<p>CustomerView</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//批量导出客户的Excel数据</span></span><br><span class="line"><span class="title function_">exportExcel</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> token = <span class="title function_">getToken</span>();</span><br><span class="line">  <span class="comment">//1、向后端发送一个请求 （我们来实现）</span></span><br><span class="line">  <span class="keyword">let</span> iframe = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;iframe&quot;</span>)<span class="comment">//创建一个iframe对象</span></span><br><span class="line">    <span class="comment">//这里的地址是后台地址，在httpRequest.js里，后面是调用的接口</span></span><br><span class="line">    iframe.<span class="property">src</span> = axios.<span class="property">defaults</span>.<span class="property">baseURL</span> + <span class="string">&quot;/api/exportExcel?Authorization=&quot;</span>+token</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(iframe);<span class="comment">//添加一个子标签，把iframe放到body里，这就是往后端发送请求了</span></span><br><span class="line">  <span class="comment">//2、后端查询数据库的数据，把数据写入Excel，然后把Excel以IO流的方式输出到前端浏览器（我们来实现）</span></span><br><span class="line">  <span class="comment">//3、前端浏览器弹出一个下载框进行文件下载（浏览器本身实现的，不需要我们去实现）</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>CustomerController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 导出Excel</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/api/exportExcel&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportExcel</span><span class="params">(HttpServletResponse response, <span class="meta">@RequestParam(value = &quot;ids&quot;, required = false)</span> String ids)</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//要想让浏览器弹出下载框，你后端要设置一下响应头信息,原版的officedocument比较特殊，用下面这个代表任意二进制流就行，也就是内容类型</span></span><br><span class="line">    response.setContentType(<span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">    response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="comment">//头里面的这个叫内容部署Content-disposition，是固定写法</span></span><br><span class="line">    <span class="comment">//Content-disposition是一个 HTTP 响应头用于指示浏览器如何处理响应体中的内容(下载附件、直接展示) 。attachment是该响应头的一个值，表示响应体中的内容以附件的形式下载</span></span><br><span class="line">    response.setHeader(<span class="string">&quot;Content-disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + URLEncoder.encode(Constants.EXCEL_FILE_NAME+System.currentTimeMillis(), StandardCharsets.UTF_8) + <span class="string">&quot;.xlsx&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、后端查询数据库的数据，把数据写入Excel，然后把Excel以IO流的方式输出到前端浏览器（我们来实现）</span></span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; idList = StringUtils.hasText(ids) ? Arrays.asList(ids.split(<span class="string">&quot;,&quot;</span>)) : <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//查出CustomerExcel里的所有字段</span></span><br><span class="line">    List&lt;CustomerExcel&gt; dataList = customerService.getCustomerByExcel(idList);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//getOutputStream是获得了流，CustomerExcel是查完数据库要写的excel模板类，dataList是里面的数据，然后把文件输出</span></span><br><span class="line">    EasyExcel.write(response.getOutputStream(), CustomerExcel.class)</span><br><span class="line">            .sheet()</span><br><span class="line">            .doWrite(dataList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CustomerExcel</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerExcel</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Excel表头的字段如下：</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 所属人	所属活动	客户姓名	客户称呼	客户手机	客户微信	客户QQ</span></span><br><span class="line"><span class="comment">     * 客户邮箱	客户年龄	客户职业	客户年收入</span></span><br><span class="line"><span class="comment">     * 客户住址	是否贷款	客户产品	客户来源	客户描述	下次联系时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ExcelProperty就是表头</span></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;所属人&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String ownerName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;所属活动&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String activityName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;客户姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String fullName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;客户称呼&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appellationName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;客户手机&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;客户微信&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String weixin;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;客户QQ&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String qq;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;客户邮箱&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;客户年龄&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;客户职业&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String job;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;客户年收入&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal yearIncome;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;客户住址&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;是否贷款&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String needLoadName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;客户产品&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String productName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;客户来源&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String sourceName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;客户描述&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;下次联系时间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date nextContactTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CustomerService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;CustomerExcel&gt; <span class="title function_">getCustomerByExcel</span><span class="params">(List&lt;String&gt; idList)</span>;</span><br></pre></td></tr></table></figure>

<p>CustomerServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;CustomerExcel&gt; <span class="title function_">getCustomerByExcel</span><span class="params">(List&lt;String&gt; idList)</span> &#123;</span><br><span class="line">    List&lt;CustomerExcel&gt; customerExcelList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先查出来的是TCustomer，再转换到CustomerExcel里</span></span><br><span class="line">    List&lt;TCustomer&gt; tCustomerList = tCustomerMapper.selectCustomerByExcel(idList);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把从数据库查询出来的List&lt;TCustomer&gt;数据，转换为 List&lt;CustomerExcel&gt;数据</span></span><br><span class="line">    tCustomerList.forEach(tCustomer -&gt; &#123;</span><br><span class="line">        <span class="type">CustomerExcel</span> <span class="variable">customerExcel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomerExcel</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//需要一个一个设置，没有办法，因为没法使用BeanUtils复制</span></span><br><span class="line">        customerExcel.setOwnerName(ObjectUtils.isEmpty(tCustomer.getOwnerDO()) ? Constants.EMPTY : tCustomer.getOwnerDO().getName());</span><br><span class="line">        customerExcel.setActivityName(ObjectUtils.isEmpty(tCustomer.getActivityDO()) ? Constants.EMPTY : tCustomer.getActivityDO().getName());</span><br><span class="line">        customerExcel.setFullName(tCustomer.getClueDO().getFullName());</span><br><span class="line">        customerExcel.setAppellationName(ObjectUtils.isEmpty(tCustomer.getAppellationDO()) ? Constants.EMPTY : tCustomer.getAppellationDO().getTypeValue());</span><br><span class="line">        customerExcel.setPhone(tCustomer.getClueDO().getPhone());</span><br><span class="line">        customerExcel.setWeixin(tCustomer.getClueDO().getWeixin());</span><br><span class="line">        customerExcel.setQq(tCustomer.getClueDO().getQq());</span><br><span class="line">        customerExcel.setEmail(tCustomer.getClueDO().getEmail());</span><br><span class="line">        customerExcel.setAge(tCustomer.getClueDO().getAge());</span><br><span class="line">        customerExcel.setJob(tCustomer.getClueDO().getJob());</span><br><span class="line">        customerExcel.setYearIncome(tCustomer.getClueDO().getYearIncome());</span><br><span class="line">        customerExcel.setAddress(tCustomer.getClueDO().getAddress());</span><br><span class="line">        customerExcel.setNeedLoadName(ObjectUtils.isEmpty(tCustomer.getNeedLoanDO()) ? Constants.EMPTY : tCustomer.getNeedLoanDO().getTypeValue());</span><br><span class="line">        customerExcel.setProductName(ObjectUtils.isEmpty(tCustomer.getIntentionProductDO()) ? Constants.EMPTY : tCustomer.getIntentionProductDO().getName());</span><br><span class="line">        customerExcel.setSourceName(ObjectUtils.isEmpty(tCustomer.getSourceDO()) ? Constants.EMPTY : tCustomer.getSourceDO().getTypeValue());</span><br><span class="line">        customerExcel.setDescription(tCustomer.getDescription());</span><br><span class="line">        customerExcel.setNextContactTime(tCustomer.getNextContactTime());</span><br><span class="line"></span><br><span class="line">        customerExcelList.add(customerExcel);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> customerExcelList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TCustomerMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TCustomer&gt; <span class="title function_">selectCustomerByExcel</span><span class="params">(List&lt;String&gt; idList)</span>;</span><br></pre></td></tr></table></figure>

<p>TCustomerMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectCustomerByExcel&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.util.List&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CustomerResultMap&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">  tct.*,</span><br><span class="line">  tc.id clueId, tc.full_name, tc.phone, tc.weixin, tc.qq, tc.email, tc.age, tc.job, tc.year_income, tc.address,</span><br><span class="line">  tu1.id ownerId, tu1.name ownerName,</span><br><span class="line">  ta.id activityId, ta.name activityName,</span><br><span class="line">  tdv.id appellationId, tdv.type_value appellationName,</span><br><span class="line">  tdv2.id needLoanId, tdv2.type_value needLoanName,</span><br><span class="line">  tdv3.id intentionStateId, tdv3.type_value intentionStateName,</span><br><span class="line">  tdv4.id stateId, tdv4.type_value stateName,</span><br><span class="line">  tdv5.id sourceId, tdv5.type_value sourceName,</span><br><span class="line">  tp.id intentionProductId, tp.name intentionProductName</span><br><span class="line">  from t_customer tct left join t_clue tc on tct.clue_id = tc.id</span><br><span class="line">  left join t_user tu1 on tc.owner_id = tu1.id</span><br><span class="line">  left join t_activity ta on tc.activity_id = ta.id</span><br><span class="line">  left join t_dic_value tdv on tc.appellation = tdv.id</span><br><span class="line">  left join t_dic_value tdv2 on tc.need_loan = tdv2.id</span><br><span class="line">  left join t_dic_value tdv3 on tc.intention_state = tdv3.id</span><br><span class="line">  left join t_dic_value tdv4 on tc.state = tdv4.id</span><br><span class="line">  left join t_dic_value tdv5 on tc.source = tdv5.id</span><br><span class="line">  left join t_product tp on tct.product = tp.id</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;idList != null and idList.size() &gt; 0&quot;</span>&gt;</span></span><br><span class="line">      and tct.id in</span><br><span class="line">      <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;idList&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Constants</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EMPTY</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出Excel的接口路径</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXPORT_EXCEL_URI</span> <span class="operator">=</span> <span class="string">&quot;/api/exportExcel&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCEL_FILE_NAME</span> <span class="operator">=</span> <span class="string">&quot;客户信息数据&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>util.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取token</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">string</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getToken</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//拿token有两个方面，一个是session，一个是local，如果session没有值就从local拿一下，如果拿到了就返回token，还没拿到就提示重新登陆</span></span><br><span class="line">    <span class="keyword">let</span> token = <span class="variable language_">window</span>.<span class="property">sessionStorage</span>.<span class="title function_">getItem</span>(<span class="title function_">getTokenName</span>());</span><br><span class="line">    <span class="keyword">if</span> (!token) &#123; <span class="comment">//前面加了一个！，表示token不存在，token是空的，token没有值，这个意思</span></span><br><span class="line">        token = <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="title function_">getTokenName</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (token) &#123; <span class="comment">//表示token存在，token不是空的，token有值，这个意思</span></span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">messageConfirm</span>(<span class="string">&quot;请求token为空，是否重新去登录？&quot;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//用户点击“确定”按钮就会触发then函数</span></span><br><span class="line">            <span class="comment">//既然后端验证token未通过，那么前端的token肯定是有问题的，那没必要存储在浏览器中，直接删除一下</span></span><br><span class="line">            <span class="title function_">removeToken</span>();</span><br><span class="line">            <span class="comment">//跳到登录页</span></span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;/&quot;</span>;</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//用户点击“取消”按钮就会触发catch函数</span></span><br><span class="line">            <span class="title function_">messageTip</span>(<span class="string">&quot;取消去登录&quot;</span>, <span class="string">&quot;warning&quot;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TokenVerifyFilter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (request.getRequestURI().equals(Constants.LOGIN_URI)) &#123; <span class="comment">//如果是登录请求，此时还没有生成jwt，那不需要对登录请求进行jwt验证，可以直接放行</span></span><br><span class="line">        <span class="comment">//验证jwt通过了 ，让Filter链继续执行，也就是继续执行下一个Filter</span></span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//String token = request.getHeader(&quot;Authorization&quot;);</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (request.getRequestURI().equals(Constants.EXPORT_EXCEL_URI)) &#123;</span><br><span class="line">            <span class="comment">//如果是导出Excel的接口路径，就从请求路径的参数中获取token，在CustomerView里</span></span><br><span class="line">            token = request.getParameter(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//其他请求都是从请求头中获取token</span></span><br><span class="line">            token = request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h2 id="选择导出"><a href="#选择导出" class="headerlink" title="选择导出"></a>选择导出</h2><p>写上选择方法时会出现一个页面显示iframe框的东西，每下载一次就多一个，所以要在导出的时候让iframe在下面隐藏，就要给这个iframe添加一个样式。<br>选择的时候会触发一个handleSelectionChange函数，代码在之前的用户管理写过，可以复制修改，选择导出的方法和批量导出一样，只是传的参数不一样，选择导出要传参数，再写一个就有点重复，所以拆开<br>然后传给后端，写个ids接受参数，但是这个可有可无，所以加上required &#x3D; false</p>
<p>CustomerView</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">//客户的id数组，初始值是空</span></span><br><span class="line">    customerIdArray : []</span><br><span class="line"> methods : &#123;</span><br><span class="line">  <span class="comment">//勾选或者取消勾选时，触发该函数注入进来(已经勾选的数据或传给我们这个函数，是个数组)</span></span><br><span class="line">  <span class="title function_">handleSelectionChange</span>(<span class="params">selectionnDataArray</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">customerIdArray</span> = [];</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(selectionnDataArray);</span><br><span class="line">    selectionnDataArray.<span class="title function_">forEach</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> customerId = data.<span class="property">id</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">customerIdArray</span>.<span class="title function_">push</span>(customerId);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">      ~~~~</span><br><span class="line">  <span class="comment">//批量导出客户的Excel数据</span></span><br><span class="line">  <span class="title function_">exportExcel</span>(<span class="params">ids</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> token = <span class="title function_">getToken</span>();<span class="comment">//这个方法是util.js里的</span></span><br><span class="line">    <span class="comment">//1、向后端发送一个请求 （我们来实现）</span></span><br><span class="line">    <span class="keyword">let</span> iframe = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;iframe&quot;</span>)<span class="comment">//创建一个iframe对象</span></span><br><span class="line">    <span class="keyword">if</span> (ids) &#123;</span><br><span class="line">      <span class="comment">//这里的地址是后台地址，在httpRequest.js里，后面是调用的接口，?Authorization=是手动传的token，因为所有的请求都会被filter拦截</span></span><br><span class="line">  	<span class="comment">//有ids就拼这个名字，没有就拼不带id的名字</span></span><br><span class="line">      iframe.<span class="property">src</span> = axios.<span class="property">defaults</span>.<span class="property">baseURL</span> + <span class="string">&quot;/api/exportExcel?Authorization=&quot;</span>+token + <span class="string">&quot;&amp;ids=&quot;</span>+ ids;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      iframe.<span class="property">src</span> = axios.<span class="property">defaults</span>.<span class="property">baseURL</span> + <span class="string">&quot;/api/exportExcel?Authorization=&quot;</span>+token</span><br><span class="line">    &#125;</span><br><span class="line">    iframe.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>; <span class="comment">//iframe隐藏样式，页面上不要显示出来</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(iframe);<span class="comment">//添加一个子标签，把iframe放到body里，这就是往后端发送请求了</span></span><br><span class="line">    <span class="comment">//2、后端查询数据库的数据，把数据写入Excel，然后把Excel以IO流的方式输出到前端浏览器（我们来实现）</span></span><br><span class="line">    <span class="comment">//3、前端浏览器弹出一个下载框进行文件下载（浏览器本身实现的，不需要我们去实现）</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//批量导出客户的Excel数据</span></span><br><span class="line">  <span class="title function_">batchExportExcel</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//选择导出的方法和批量导出一样，只是传的参数不一样，选择导出要传参数，再写一个就有点重复，所以拆开</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">exportExcel</span>(<span class="literal">null</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//选择导出</span></span><br><span class="line">  <span class="title function_">chooseExportExcel</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">customerIdArray</span>.<span class="property">length</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="title function_">messageTip</span>(<span class="string">&quot;请选择要导出的数据&quot;</span>, <span class="string">&quot;warning&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ids = &quot;1,3,6,11,15&quot;;</span></span><br><span class="line">    <span class="keyword">let</span> ids = <span class="variable language_">this</span>.<span class="property">customerIdArray</span>.<span class="title function_">join</span>(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">exportExcel</span>(ids);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>CustomerController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//required = false意思是这个id可有可无</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/api/exportExcel&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportExcel</span><span class="params">(HttpServletResponse response, <span class="meta">@RequestParam(value = &quot;ids&quot;, required = false)</span> String ids)</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//要想让浏览器弹出下载框，你后端要设置一下响应头信息,原版的officedocument比较特殊，用下面这个代表任意二进制流就行，也就是内容类型</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">//头里面的这个叫内容部署Content-disposition，是固定写法</span></span><br><span class="line">        <span class="comment">//Content-disposition是一个 HTTP 响应头用于指示浏览器如何处理响应体中的内容(下载附件、直接展示) 。attachment是该响应头的一个值，表示响应体中的内容以附件的形式下载</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;Content-disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + URLEncoder.encode(Constants.EXCEL_FILE_NAME+System.currentTimeMillis(), StandardCharsets.UTF_8) + <span class="string">&quot;.xlsx&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、后端查询数据库的数据，把数据写入Excel，然后把Excel以IO流的方式输出到前端浏览器（我们来实现）</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果ids有值那么hasText就不是空，就转成list，如果没有值就new一个list</span></span><br><span class="line">        List&lt;String&gt; idList = StringUtils.hasText(ids) ? Arrays.asList(ids.split(<span class="string">&quot;,&quot;</span>)) : <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//查出CustomerExcel里的所有字段</span></span><br><span class="line">        List&lt;CustomerExcel&gt; dataList = customerService.getCustomerByExcel(idList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//getOutputStream是获得了流，CustomerExcel是查完数据库要写的excel模板类，dataList是里面的数据，然后把文件输出</span></span><br><span class="line">        EasyExcel.write(response.getOutputStream(), CustomerExcel.class)</span><br><span class="line">                .sheet()</span><br><span class="line">                .doWrite(dataList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CustomerService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;CustomerExcel&gt; <span class="title function_">getCustomerByExcel</span><span class="params">(List&lt;String&gt; idList)</span>;</span><br></pre></td></tr></table></figure>

<p>CustomerServiceImpl，这个其实没有动过代码，是传进来了参数，点进去这个查询方法也要放进去参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;CustomerExcel&gt; <span class="title function_">getCustomerByExcel</span><span class="params">(List&lt;String&gt; idList)</span> &#123;~~~</span><br><span class="line">   List&lt;TCustomer&gt; tCustomerList = tCustomerMapper.selectCustomerByExcel(idList);</span><br></pre></td></tr></table></figure>

<p>TCustomerMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--传进来了参数所以要加上parameterType=&quot;java.util.List&quot;，再加个where判断一下，不等于空并且大于0就是有值，是选择导出然后就拼接--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--in后面是个循环，范围是idList，item是取出id，左右括号分隔，还有分隔符--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectCustomerByExcel&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.util.List&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CustomerResultMap&quot;</span>&gt;</span>~~~</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;idList != null and idList.size() &gt; 0&quot;</span>&gt;</span></span><br><span class="line">      and tct.id in</span><br><span class="line">      <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;idList&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="用户权限"><a href="#用户权限" class="headerlink" title="用户权限"></a>用户权限</h1><h2 id="用户菜单权限"><a href="#用户菜单权限" class="headerlink" title="用户菜单权限"></a>用户菜单权限</h2><p>首先要理清用户有哪些菜单，去数据库查一下，这些都可以在t_permission表里的menu类型，button是功能，用查询语句查menu查出来17条，里面是父菜单和子菜单，然后要查用户有哪些菜单，看看t_role里，1是管理员，2是销售员，yuyan的id是2，然后从t_user_role里看2是什么角色，role_id是2销售，然后从t_role_permission里看2有哪些权限，是从10-27这些权限，然后要顾虑属于菜单的有哪些</p>
<p>点一下<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250925194334649.png" alt="image-20250925194334649"> 这个图标，然后进入到视图，下面两个是中间表，上面三个是主表，都是多对多的关系，要连接三次表，然后根据菜单查出一对多的关系<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250926010319331.png" alt="image-20250926010319331"></p>
<p>这里可以看到父菜单下面有个子菜单，子菜单的parent_id对应着父菜单的id，父表left join子表</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250926011458894.png" alt="image-20250926011458894"></p>
<p>查询语句是这样的，实际效果是管理员进入页面是显示所有菜单，yuyan这种进入只显示自己权限里的菜单，这样的话在登录的一瞬间就要查出来这个人有哪些菜单，然后放到用户对象里去，然后左侧菜单遍历用户对象的那个字段</p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>用户登录的时候会调userService，所以在UserServiceImpl添加代码，查询语句就是上面的，然后弄个新映射。然后把菜单放到用户对象里去，要弄个list，放在TUser里，登录成功后调用MyAuthenticationSuccessHandler，但是应该暂时不用动，先进入到DashboardView页面，之前这些菜单都是写死的顺序，这里搞个for循环就可以，只需要知道用户菜单的list数据就行，而这个需要页面渲染时就要拿，而加载当前用户方法里的user通过后端Authentication可以直接转成user，里面就带有list，具体的可以看代码注释，写好后之前的那些菜单就可以删掉了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> TPermissionMapper tPermissionMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;~~~</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//查询一下该用户有哪些菜单权限</span></span><br><span class="line">    List&lt;TPermission&gt; menuPermisssionList = tPermissionMapper.selectMenuPermissionByUserId(tUser.getId());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tUser;<span class="comment">//因为要求返回的是UserDetails，所以需要改造一下tUser对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TPermissionMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TPermission&gt; <span class="title function_">selectMenuPermissionByUserId</span><span class="params">(Integer userId)</span>;</span><br></pre></td></tr></table></figure>

<p>TPermissionMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--用的是ofType不是javaType，因为是Collection--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;PermissionResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.bjpowernode.model.TPermission&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;code&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;code&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;url&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;url&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;type&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;type&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;parent_id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;parentId&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;order_no&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderNo&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;icon&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--一对多关联映射，一个父菜单下有多个子菜单--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;subPermissionList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.bjpowernode.model.TPermission&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;curl&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;url&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cicon&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;icon&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectMenuPermissionByUserId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;PermissionResultMap&quot;</span>&gt;</span></span><br><span class="line">  SELECT</span><br><span class="line">    tp.*,</span><br><span class="line">    childTp.id cid, childTp.name cname, childTp.url curl, childTp.icon cicon</span><br><span class="line">  FROM</span><br><span class="line">    t_permission tp</span><br><span class="line">      LEFT JOIN t_permission childTp ON tp.id = childTp.parent_id</span><br><span class="line">      LEFT JOIN t_role_permission trp ON tp.id = trp.permission_id</span><br><span class="line">      LEFT JOIN t_role tr ON trp.role_id = tr.id</span><br><span class="line">      LEFT JOIN t_user_role tur ON tr.id = tur.role_id</span><br><span class="line">  WHERE</span><br><span class="line">    tur.user_id = #&#123;userId, jdbcType=INTEGER&#125;</span><br><span class="line">    AND tp.type = &#x27;menu&#x27;</span><br><span class="line">    and childTp.type = &#x27;menu&#x27;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>TPermission</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一对多关联</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;TPermission&gt; subPermissionList;</span><br></pre></td></tr></table></figure>

<p>TUser</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 菜单的List</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;TPermission&gt; menuPermissionList;</span><br></pre></td></tr></table></figure>

<p>DashboardView</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--user里通过后端的Authentication可以直接转成user，里面就带有list，把里面的对象取出一个到menuPermission，然后定义个key可以提高循环效率，index是序号变量--&gt;</span><br><span class="line">&lt;!-- menuPermission.name取的是一级菜单的名字，二级菜单可能不止一个所以要循环，这个对象本来就拿到了TPermission，然后里面又关联了subPermissionList所以可以直接调用，后面的参数都可以从subPermission拿 --&gt;</span><br><span class="line">&lt;!--图标也要动态可变的，图标名称都在数据库里有，是叫icon，用component标签，:is后面是图标的参数名字--&gt;</span><br><span class="line">&lt;el-sub-menu :index=&quot;index&quot; v-for=&quot;(menuPermission, index) in user.menuPermissionList&quot; :key=&quot;menuPermission.id&quot;&gt;</span><br><span class="line">  &lt;template #title&gt;</span><br><span class="line">    &lt;el-icon&gt;&lt;component :is=&quot;menuPermission.icon&quot;&gt;&lt;/component&gt;&lt;/el-icon&gt;</span><br><span class="line">    &lt;span&gt; &#123;&#123;menuPermission.name&#125;&#125; &lt;/span&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">  &lt;el-menu-item v-for=&quot;subPermission in menuPermission.subPermissionList&quot; :key=&quot;subPermission.id&quot; :index=&quot;subPermission.url&quot;&gt;</span><br><span class="line">    &lt;el-icon&gt;&lt;component :is=&quot;subPermission.icon&quot;&gt;&lt;/component&gt;&lt;/el-icon&gt;</span><br><span class="line">    &#123;&#123;subPermission.name&#125;&#125;</span><br><span class="line">  &lt;/el-menu-item&gt;</span><br><span class="line">&lt;/el-sub-menu&gt;</span><br></pre></td></tr></table></figure>

<h2 id="用户功能权限"><a href="#用户功能权限" class="headerlink" title="用户功能权限"></a>用户功能权限</h2><p>比如说一个页面有些功能是不能点的，就需要用方法注解去实现，先去数据库查yuyan这个人的功能有哪些，功能就是button，2就是yuyan，然后可以看到比如线索管理就没有删除权限。首先是登录要查询用户有哪些功能，功能也就是TUser的权限标识符，也就是数据库查出来的code，然后放到permissionList里，框架会调TUser里的getAuthorities方法来判断权限，如果list不是空就遍历转换然后返回list。然后在SecurityConfig开启注解方式的权限管理，然后给挨个加权限，删除线索代码也暂时添加一下，这个人现在没有删除权限，在线索页面添加删除权限，再次运行发现错误提示里没有变成中文，被全局异常捕获了，这里是在全局异常里写个捕获这个异常的方法，GlobalExceptionHandler和MyAccessDeniedHandler同时存在时应该是有冲突的，把GlobalExceptionHandler注解注释掉后就正常走了MyAccessDeniedHandler异常</p>
<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="动力云客项目.assets/image-20250926023824554.png" alt="image-20250926023824554" style="zoom: 67%;" />

<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="动力云客项目.assets/image-20250926023932967.png" alt="image-20250926023932967" style="zoom:67%;" />

<p>UserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;~~~</span><br><span class="line"><span class="comment">//查询一下该用户有哪些功能权限</span></span><br><span class="line">     List&lt;TPermission&gt; buttonPermissionList = tPermissionMapper.selectButtonPermissionByUserId(tUser.getId());</span><br><span class="line">     List&lt;String&gt; stringPermissionList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">     buttonPermissionList.forEach(tPermission -&gt; &#123;<span class="comment">//循环从buttonPermissionList拿出来标识符放到stringPermissionList去</span></span><br><span class="line">         stringPermissionList.add(tPermission.getCode());<span class="comment">//权限标识符</span></span><br><span class="line">     &#125;);</span><br><span class="line">     tUser.setPermissionList(stringPermissionList);<span class="comment">//设置用户的权限标识符放到里面去</span></span><br></pre></td></tr></table></figure>

<p>SecurityConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableMethodSecurity</span><span class="comment">//开启方法级别的权限检查</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MyAccessDeniedHandler myAccessDeniedHandler;</span><br><span class="line">    </span><br><span class="line">      <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity httpSecurity,CorsConfigurationSource configurationSource)</span> <span class="keyword">throws</span> Exception &#123;~~~</span><br><span class="line">                      <span class="comment">//这个是没有权限访问时触发</span></span><br><span class="line">                    .exceptionHandling((exceptionHandling) -&gt; &#123;</span><br><span class="line">                     exceptionHandling.accessDeniedHandler(myAccessDeniedHandler);  </span><br></pre></td></tr></table></figure>

<p>ClueController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//相当于当前用户如果有clue:list这个标识符就可以执行这个方法，掉用不了就要拒绝，在SecurityConfig配置</span></span><br><span class="line"><span class="meta">@PreAuthorize(value = &quot;hasAuthority(&#x27;clue:list&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/api/clues&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">cluePage</span><span class="params">(<span class="meta">@RequestParam(value = &quot;current&quot;, required = false)</span> Integer current)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PreAuthorize(value = &quot;hasAuthority(&#x27;clue:import&#x27;)&quot;)</span></span><br><span class="line"><span class="comment">//通过Authoriazation就会走拦截器，拦截器的头里会带一个token，所以这个接口可以接收头里的token</span></span><br><span class="line"><span class="meta">@PostMapping(value = &quot;/api/importExcel&quot;)</span></span><br><span class="line">    </span><br><span class="line">     <span class="meta">@PreAuthorize(value = &quot;hasAuthority(&#x27;clue:add&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(value = &quot;/api/clue&quot;)</span></span><br><span class="line">    </span><br><span class="line">        <span class="meta">@PreAuthorize(value = &quot;hasAuthority(&#x27;clue:view&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/api/clue/detail/&#123;id&#125;&quot;)</span></span><br><span class="line">    </span><br><span class="line"> <span class="meta">@PreAuthorize(value = &quot;hasAuthority(&#x27;clue:edit&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@PutMapping(value = &quot;/api/clue&quot;)</span></span><br><span class="line">    </span><br><span class="line">        <span class="meta">@PreAuthorize(value = &quot;hasAuthority(&#x27;clue:delete&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(value = &quot;/api/clue/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">delClue</span><span class="params">(<span class="meta">@PathVariable(value = &quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">del</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">//clueService.delClueById(id);先直接让他强行是1就是删除成功，后面再写代码</span></span><br><span class="line">    <span class="keyword">return</span> del &gt;= <span class="number">1</span> ? R.OK() : R.FAIL();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注入的MyAccessDeniedHandler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 没有权限时的处理器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAccessDeniedHandler</span> <span class="keyword">implements</span> <span class="title class_">AccessDeniedHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">//没有权限访问，执行该方法，在该方法中返回json给前端，就行了</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//登录失败的统一结果</span></span><br><span class="line">        <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> R.FAIL(CodeEnum.ACCESS_DENIED);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把R对象转成json</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resultJSON</span> <span class="operator">=</span> JSONUtils.toJSON(result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把R以json返回给前端</span></span><br><span class="line">        ResponseUtils.write(response, resultJSON);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CodeEnum</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ACCESS_DENIED(<span class="number">500</span>, <span class="string">&quot;权限不足&quot;</span>),</span><br></pre></td></tr></table></figure>

<p>ClueView</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除线索</span></span><br><span class="line"><span class="title function_">del</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="title function_">messageConfirm</span>(<span class="string">&quot;您确定要删除该数据吗？&quot;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//用户点击“确定”按钮就会触发then函数</span></span><br><span class="line">    <span class="title function_">doDelete</span>(<span class="string">&quot;/api/clue/&quot;</span> + id, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(resp);</span><br><span class="line">      <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="title function_">messageTip</span>(<span class="string">&quot;删除成功&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">        <span class="comment">//页面刷新</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">reload</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">messageTip</span>(<span class="string">&quot;删除失败，原因：&quot;</span> + resp.<span class="property">data</span>.<span class="property">msg</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//用户点击“取消”按钮就会触发catch函数</span></span><br><span class="line">    <span class="title function_">messageTip</span>(<span class="string">&quot;取消删除&quot;</span>, <span class="string">&quot;warning&quot;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GlobalExceptionHandler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 权限不足的异常处理</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExceptionHandler(value = AccessDeniedException.class)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">handException</span><span class="params">(AccessDeniedException e)</span> &#123;</span><br><span class="line">    e.printStackTrace(); <span class="comment">//在控制台打印异常信息</span></span><br><span class="line">    <span class="keyword">return</span> R.FAIL(CodeEnum.ACCESS_DENIED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="按钮权限隐藏"><a href="#按钮权限隐藏" class="headerlink" title="按钮权限隐藏"></a>按钮权限隐藏</h2><p>用户功能没有删除权限时就隐藏起来，可以在按钮标签加个v-if，但是需要循环遍历标识符看看有没有那个delete的权限，这里一般是用自定义指令去做，可能不止一个页面需要这个判断，所以写个通用的。如何拿到这个标识符数据，可以每次都查一下后台，也可以从返回的jwt拿到，方法有很多，这里用的是调用UserController里的loginInfo方法的&#x2F;api&#x2F;login&#x2F;info接口。自定义指令的话找到vue官方文档有个快速上手选项，左上角可以切换api风格偏好，然后找到自定义指令，然后在main.js里写上方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//directive是自定义指令，里面的是名字，后面的是回调函数</span></span><br><span class="line"><span class="comment">//el：指令所绑定到的页面dom元素。这可以用于直接操作DOM。</span></span><br><span class="line"><span class="comment">//binding：是一个对象，里面包含很多属性，重点看value属性：传递给指令的值。我们是从前端页面传过来 clue:delete 这个值</span></span><br><span class="line">app.<span class="title function_">directive</span>(<span class="string">&quot;hasPermission&quot;</span>,  <span class="function">(<span class="params">el, binding</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 这会在 `mounted` 和 `updated` 时都调用</span></span><br><span class="line">    <span class="comment">//在这里面做个判断，后台会拿到user，里面有权限标识符，</span></span><br><span class="line">    <span class="title function_">doGet</span>(<span class="string">&quot;/api/login/info&quot;</span>, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> user = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">        <span class="keyword">let</span> permissionList = user.<span class="property">permissionList</span>;<span class="comment">//从后台拿到权限列表</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> flag = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> permissionList) &#123;</span><br><span class="line">            <span class="keyword">if</span> (permissionList[key] === binding.<span class="property">value</span>) &#123;<span class="comment">//把页面传过来的值和后台搜的比对一下看看能不能匹配上</span></span><br><span class="line">                flag = <span class="literal">true</span>;<span class="comment">//相等的时候就改成true</span></span><br><span class="line">                <span class="keyword">break</span>;<span class="comment">//退出循环</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">            <span class="comment">//没有权限，把页面元素隐藏掉</span></span><br><span class="line">            <span class="comment">//el.style.display = &#x27;none&#x27;;这个老代码有删除按钮一闪而过的问题，用下面新的</span></span><br><span class="line">            <span class="comment">//如果el的父节点存在的话，删除子节点，也就是把没有权限的按钮dom元素删除</span></span><br><span class="line">            el.<span class="property">parentNode</span> &amp;&amp; el.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(el)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ClueView</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> &lt;el-button type=&quot;primary&quot; class=&quot;btn&quot; @click=&quot;addClue&quot; v-hasPermission=&quot;&#x27;clue:add&#x27;&quot;&gt;录入线索&lt;/el-button&gt;</span><br><span class="line"> &lt;el-button type=&quot;success&quot; class=&quot;btn&quot; @click=&quot;importExcel&quot; v-hasPermission=&quot;&#x27;clue:import&#x27;&quot;&gt;导入线索(Excel)&lt;/el-button&gt;</span><br><span class="line"> &lt;el-button type=&quot;danger&quot; class=&quot;btn&quot; @click=&quot;batchDelClue&quot; v-hasPermission=&quot;&#x27;clue:delete&#x27;&quot;&gt;批量删除&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">&lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">       &lt;el-button type=&quot;primary&quot; @click=&quot;view(scope.row.id)&quot; v-hasPermission=&quot;&#x27;clue:view&#x27;&quot;&gt;详情&lt;/el-button&gt;</span><br><span class="line">       &lt;el-button type=&quot;success&quot; @click=&quot;edit(scope.row.id)&quot; v-hasPermission=&quot;&#x27;clue:edit&#x27;&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">       &lt;el-button type=&quot;danger&quot; @click=&quot;del(scope.row.id)&quot; v-hasPermission=&quot;&#x27;clue:delete&#x27;&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">     &lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>UserVIew</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button type=&quot;primary&quot; @click=&quot;add&quot; v-hasPermission=&quot;&#x27;user:add&#x27;&quot;&gt;添加用户&lt;/el-button&gt;</span><br><span class="line">&lt;el-button type=&quot;danger&quot; @click=&quot;batchDel&quot; v-hasPermission=&quot;&#x27;user:delete&#x27;&quot;&gt;批量删除&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">&lt;el-button type=&quot;primary&quot; @click=&quot;view(scope.row.id)&quot; v-hasPermission=&quot;&#x27;user:view&#x27;&quot;&gt;详情&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;success&quot; @click=&quot;edit(scope.row.id)&quot; v-hasPermission=&quot;&#x27;user:edit&#x27;&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;danger&quot; @click=&quot;del(scope.row.id)&quot; v-hasPermission=&quot;&#x27;user:delete&#x27;&quot;&gt;删除&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@PreAuthorize(value = &quot;hasAuthority(&#x27;user:list&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/api/users&quot;)</span></span><br><span class="line">后面的就看代码吧不加了</span><br></pre></td></tr></table></figure>

<h1 id="数据统计"><a href="#数据统计" class="headerlink" title="数据统计"></a>数据统计</h1><p>数据统计是后端系统中常见的功能需求，每天、每月、每季度、每年能统计出系统的相关业务数据，便于及时总结复盘，发现问题，改进提升；</p>
<h2 id="概览统计"><a href="#概览统计" class="headerlink" title="概览统计"></a>概览统计</h2><p>就是顶上的一个数据显示，饿了么里面有个统计组件，可以拷贝代码。效果是点进登录页面，或者点击动力云客系统这个字就会显示统计界面，就需要在dashBoard搞个子路由，在router里，这个就是什么都没有路径的时候就进入这个界面，新建StatisticView.vue，然后复制代码，加个居中样式，改变名称，后面有个&lt;el-icon图标标签去掉，然后就是后台查出这个值赋值，然后新建StatisticController去写后端，对多个dio调用一般写在manager里，到时候就不调用Mapper了直接调用manager，具体方法也在这里面实现，没有合适的查询方法就要自己写个</p>
<p>router</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">//路由路径，子路由路径不能以斜杠开头</span></span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="comment">//路由路径所对应的页面</span></span><br><span class="line">    component : <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/StatisticView.vue&#x27;</span>),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>StatisticView.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!--概览统计--&gt;</span><br><span class="line">  &lt;el-row&gt;</span><br><span class="line">    &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">      &lt;el-statistic :value=&quot;summaryData.effectiveActivityCount&quot;&gt;</span><br><span class="line">        &lt;template #title&gt;</span><br><span class="line">          &lt;div style=&quot;display: inline-flex; align-items: center&quot;&gt;</span><br><span class="line">            市场活动</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">        &lt;!-- 这里在标签外，用差值/&#123;&#123;&#125;&#125;&#125;表示 --&gt;</span><br><span class="line">        &lt;template #suffix&gt;/&#123;&#123;summaryData.totalActivityCount&#125;&#125;&lt;/template&gt;</span><br><span class="line">      &lt;/el-statistic&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">      &lt;el-statistic title=&quot;线索总数&quot; :value=&quot;summaryData.totalClueCount&quot; /&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">      &lt;el-statistic title=&quot;客户总数&quot; :value=&quot;summaryData.totalCustomerCount&quot; /&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">      &lt;el-statistic :value=&quot;summaryData.successTranAmount&quot;&gt;</span><br><span class="line">        &lt;template #title&gt;</span><br><span class="line">          &lt;div style=&quot;display: inline-flex; align-items: center&quot;&gt;</span><br><span class="line">            交易总额</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">        &lt;template #suffix&gt;/&#123;&#123;summaryData.totalTranAmount&#125;&#125;&lt;/template&gt;</span><br><span class="line">      &lt;/el-statistic&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line">  &lt;/el-row&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123;doGet&#125; <span class="keyword">from</span> <span class="string">&quot;../http/httpRequest.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;StatisticView&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">//概览统计数据对象，初始值是空</span></span><br><span class="line">      summaryData : &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadSummary</span>();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods : &#123;</span><br><span class="line">    <span class="comment">//加载概览统计数据</span></span><br><span class="line">    <span class="title function_">loadSummary</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/summary/data&quot;</span>, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">summaryData</span> = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.el-row</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">text-align</span>: center;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>StatisticController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatisticController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StatisticService statisticService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/api/summary/data&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">summaryData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//包装返回对象SummaryData，里面有六个字段</span></span><br><span class="line">        <span class="type">SummaryData</span> <span class="variable">summaryData</span> <span class="operator">=</span> statisticService.loadSummaryData();</span><br><span class="line">        <span class="keyword">return</span> R.OK(summaryData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SummaryData</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SummaryData</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//有效的市场活动总数</span></span><br><span class="line">    <span class="keyword">private</span> Integer effectiveActivityCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//总的市场活动数</span></span><br><span class="line">    <span class="keyword">private</span> Integer totalActivityCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//线索总数</span></span><br><span class="line">    <span class="keyword">private</span> Integer totalClueCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//客户总数</span></span><br><span class="line">    <span class="keyword">private</span> Integer totalCustomerCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//成功的交易额</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal successTranAmount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//总的交易额（包含成功和不成功的）</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal totalTranAmount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StatisticService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SummaryData <span class="title function_">loadSummaryData</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>StatisticServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatisticServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">StatisticService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StatisticManager statisticManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SummaryData <span class="title function_">loadSummaryData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> statisticManager.loadSummaryData();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StatisticManager</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatisticManager</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TActivityMapper tActivityMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TClueMapper tClueMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TCustomerMapper tCustomerMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TTranMapper tTranMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> SummaryData <span class="title function_">loadSummaryData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//去查六个数据</span></span><br><span class="line">        <span class="comment">//有效的市场活动总数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">effectiveActivityCount</span> <span class="operator">=</span> tActivityMapper.selectOngoingActivity().size(); <span class="comment">//偷懒了一下，共用了一个查询方法，返回的是list，本来应该返回count</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//总的市场活动数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">totalActivityCount</span> <span class="operator">=</span> tActivityMapper.selectByCount();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//线索总数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">totalClueCount</span> <span class="operator">=</span> tClueMapper.selectClueByCount();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//客户总数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">totalCustomerCount</span> <span class="operator">=</span> tCustomerMapper.selectByCount();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//成功的交易额</span></span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">successTranAmount</span> <span class="operator">=</span> tTranMapper.selectBySuccessTranAmount();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//总的交易额（包含成功和不成功的）</span></span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">totalTranAmount</span> <span class="operator">=</span> tTranMapper.selectByTotalTranAmount();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> SummaryData.builder()</span><br><span class="line">                .effectiveActivityCount(effectiveActivityCount)</span><br><span class="line">                .totalActivityCount(totalActivityCount)</span><br><span class="line">                .totalClueCount(totalClueCount)</span><br><span class="line">                .totalCustomerCount(totalCustomerCount)</span><br><span class="line">                .successTranAmount(successTranAmount)</span><br><span class="line">                .totalTranAmount(totalTranAmount)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TActivityMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Integer <span class="title function_">selectByCount</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">    count(0)</span><br><span class="line">  from t_activity</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>TClueMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Integer <span class="title function_">selectClueByCount</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectClueByCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">    count(0)</span><br><span class="line">  from t_clue</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>TCustomerMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Integer <span class="title function_">selectByCount</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">      count(0)</span><br><span class="line">  from t_customer</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>TTranMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BigDecimal <span class="title function_">selectBySuccessTranAmount</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">BigDecimal <span class="title function_">selectByTotalTranAmount</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--在t_dic_value里可以看到付款成交的id是42，所以这里写42，总交易就是查所有--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBySuccessTranAmount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.math.BigDecimal&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">    sum(money)</span><br><span class="line">  from t_tran</span><br><span class="line">  where stage = 42</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByTotalTranAmount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.math.BigDecimal&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">    sum(money)</span><br><span class="line">  from t_tran</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="销售漏斗图"><a href="#销售漏斗图" class="headerlink" title="销售漏斗图"></a>销售漏斗图</h2><p>这里要使用到ECharts图表库，<a target="_blank" rel="noopener" href="https://echarts.apache.org/%EF%BC%8C%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8E">https://echarts.apache.org/，一个基于</a> JavaScript 的开源可视化图表库；原来是百度公司开发并且开源；</p>
<p>使用步骤：</p>
<p>1、从 npm 获取安装：</p>
<p>在F:\动力节点全套资料\27-动力云客-适合新手前后端分离\code\dlyk-front这个路径下运行这个代码</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install echarts --save</span><br></pre></td></tr></table></figure>

<p>2、看文档，看参考示例进行开发；<a target="_blank" rel="noopener" href="https://echarts.apache.org/examples/zh/index.html">https://echarts.apache.org/examples/zh/index.html</a></p>
<p>（1）文档: (使用手册、API、配置项手册)</p>
<p>（2）示例 （最主要参考它提供的示例进行开发）</p>
<p>Vue项目上线部署主要采用Nginx服务器；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 销售漏斗图，为 ECharts 准备一个定义了宽高的 DOM，这个dom容器是div或者p标签之类的都可以 --&gt;</span><br><span class="line">&lt;div id=&quot;saleFunnelChart&quot; style=&quot;width: 48%; height:350px; margin:10px; float: left;&quot;&gt; 图渲染在此处 &lt;/div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadSummary</span>();</span><br><span class="line">    <span class="comment">//加载销售漏斗图</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">loadSaleFunnelChart</span>();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">methods : &#123;</span><br><span class="line">     <span class="comment">//加载销售漏斗图</span></span><br><span class="line">    <span class="title function_">loadSaleFunnelChart</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">//先查询出来数据，然后再渲染图，不能先渲染图（没有数据，渲染不出来的），然后再查数据</span></span><br><span class="line">      <span class="title function_">doGet</span>(<span class="string">&quot;/api/saleFunnel/data&quot;</span>, &#123;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="keyword">let</span> saleFunelData = resp.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">//1、拿到页面上渲染图表的dom元素,拿到了div的id</span></span><br><span class="line">          <span class="keyword">var</span> chartDom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;saleFunnelChart&#x27;</span>);</span><br><span class="line">          <span class="comment">//2、使用echarts组件对dom进行初始化，得到一个空白的图表对象</span></span><br><span class="line">          <span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(chartDom);</span><br><span class="line">          <span class="comment">//3、配置可选项（查看文档--&gt;配置项手册）</span></span><br><span class="line">          <span class="keyword">var</span> option = &#123;</span><br><span class="line">            <span class="comment">//标题组件，包含主标题和副标题。</span></span><br><span class="line">            <span class="attr">title</span>: &#123;</span><br><span class="line">              <span class="comment">//主标题文本，支持使用 \n 换行。</span></span><br><span class="line">              <span class="attr">text</span>: <span class="string">&#x27;销售漏斗图&#x27;</span>,</span><br><span class="line">              <span class="comment">//title 组件离容器左侧的距离。</span></span><br><span class="line">              <span class="attr">left</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">              <span class="comment">//title 组件离容器上侧的距离。</span></span><br><span class="line">              <span class="attr">top</span>: <span class="string">&#x27;bottom&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//提示框组件。</span></span><br><span class="line">            <span class="attr">tooltip</span>: &#123;</span><br><span class="line">              <span class="comment">//触发类型。item：数据项图形触发，主要在散点图，饼图等无类目轴的图表中使用。</span></span><br><span class="line">              <span class="attr">trigger</span>: <span class="string">&#x27;item&#x27;</span>,</span><br><span class="line">              <span class="comment">//提示框浮层内容格式器,漏斗图: &#123;a&#125;（系列名称），&#123;b&#125;（数据项名称），&#123;c&#125;（数值）, &#123;d&#125;（百分比）</span></span><br><span class="line">              <span class="attr">formatter</span>: <span class="string">&#x27;&#123;a&#125; &lt;br/&gt;&#123;b&#125; : &#123;c&#125;&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//工具栏</span></span><br><span class="line">            <span class="attr">toolbox</span>: &#123;</span><br><span class="line">              <span class="comment">//各工具配置项</span></span><br><span class="line">              <span class="attr">feature</span>: &#123;</span><br><span class="line">                <span class="comment">//数据视图工具，可以展现当前图表所用的数据，编辑后可以动态更新。</span></span><br><span class="line">                <span class="attr">dataView</span>: &#123;</span><br><span class="line">                  <span class="comment">//是否不可编辑（只读）。</span></span><br><span class="line">                  <span class="attr">readOnly</span>: <span class="literal">false</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">//配置项还原。</span></span><br><span class="line">                <span class="attr">restore</span>: &#123;&#125;,</span><br><span class="line">                <span class="comment">//保存为图片。</span></span><br><span class="line">                <span class="attr">saveAsImage</span>: &#123;&#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//图例组件</span></span><br><span class="line">            <span class="attr">legend</span>: &#123;</span><br><span class="line">              <span class="attr">data</span>: [<span class="string">&#x27;线索&#x27;</span>, <span class="string">&#x27;客户&#x27;</span>, <span class="string">&#x27;交易&#x27;</span>, <span class="string">&#x27;成交&#x27;</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//系列</span></span><br><span class="line">            <span class="attr">series</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="comment">//系列名称</span></span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;销售漏斗数据统计&#x27;</span>,</span><br><span class="line">                <span class="comment">//图表的类型，funnel代表漏斗图</span></span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;funnel&#x27;</span>,</span><br><span class="line">                <span class="comment">//漏斗图组件离容器左侧的距离。</span></span><br><span class="line">                <span class="attr">left</span>: <span class="string">&#x27;10%&#x27;</span>,</span><br><span class="line">                <span class="comment">//漏斗图组件离容器上侧的距离。</span></span><br><span class="line">                <span class="attr">top</span>: <span class="number">60</span>,</span><br><span class="line">                <span class="comment">//漏斗图组件离容器下侧的距离。</span></span><br><span class="line">                <span class="attr">bottom</span>: <span class="number">60</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="string">&#x27;80%&#x27;</span>,</span><br><span class="line">                <span class="attr">min</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="attr">max</span>: <span class="number">100</span>,</span><br><span class="line">                <span class="attr">minSize</span>: <span class="string">&#x27;0%&#x27;</span>,</span><br><span class="line">                <span class="attr">maxSize</span>: <span class="string">&#x27;100%&#x27;</span>,</span><br><span class="line">                <span class="attr">sort</span>: <span class="string">&#x27;descending&#x27;</span>,</span><br><span class="line">                <span class="attr">gap</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">label</span>: &#123;</span><br><span class="line">                  <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">                  <span class="attr">position</span>: <span class="string">&#x27;inside&#x27;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">labelLine</span>: &#123;</span><br><span class="line">                  <span class="attr">length</span>: <span class="number">10</span>,</span><br><span class="line">                  <span class="attr">lineStyle</span>: &#123;</span><br><span class="line">                    <span class="attr">width</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;solid&#x27;</span></span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                  <span class="attr">borderColor</span>: <span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">                  <span class="attr">borderWidth</span>: <span class="number">1</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">emphasis</span>: &#123;</span><br><span class="line">                  <span class="attr">label</span>: &#123;</span><br><span class="line">                    <span class="attr">fontSize</span>: <span class="number">20</span></span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">//数据项（系列中的数据内容数组， 数组项可以为单个数值，也可以是对象值）</span></span><br><span class="line">                <span class="comment">/*data: [</span></span><br><span class="line"><span class="comment">                  &#123; value: 20, name: &#x27;成交&#x27; &#125;,</span></span><br><span class="line"><span class="comment">                  &#123; value: 60, name: &#x27;交易&#x27; &#125;,</span></span><br><span class="line"><span class="comment">                  &#123; value: 80, name: &#x27;客户&#x27; &#125;,</span></span><br><span class="line"><span class="comment">                  &#123; value: 100, name: &#x27;线索&#x27; &#125;</span></span><br><span class="line"><span class="comment">                ]*/</span></span><br><span class="line">      	        <span class="comment">//这里是真正从数据库查出来的数据，赋到这里，上面是静态的</span></span><br><span class="line">                data : saleFunelData</span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;;</span><br><span class="line">          <span class="comment">//4、如果配置了可选项，就把可选项设置到空白的图表对象中</span></span><br><span class="line">          option &amp;&amp; myChart.<span class="title function_">setOption</span>(option);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StatisticController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/api/saleFunnel/data&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">saleFunnelData</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * [</span></span><br><span class="line"><span class="comment">     *    &#123; value: 20, name: &#x27;成交&#x27; &#125;,</span></span><br><span class="line"><span class="comment">     *    &#123; value: 60, name: &#x27;交易&#x27; &#125;,</span></span><br><span class="line"><span class="comment">     *    &#123; value: 80, name: &#x27;客户&#x27; &#125;,</span></span><br><span class="line"><span class="comment">     *    &#123; value: 100, name: &#x27;线索&#x27; &#125;</span></span><br><span class="line"><span class="comment">     * ]</span></span><br><span class="line"><span class="comment">     * 返回的是list对象，弄个NameValue对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    List&lt;NameValue&gt; nameValueList = statisticService.loadSaleFunnelData();</span><br><span class="line">    <span class="keyword">return</span> R.OK(nameValueList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>NameValue</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NameValue</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>StatisticService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;NameValue&gt; <span class="title function_">loadSaleFunnelData</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>StatisticServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;NameValue&gt; <span class="title function_">loadSaleFunnelData</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> statisticManager.loadSaleFunnelData();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StatisticManager</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;NameValue&gt; <span class="title function_">loadSaleFunnelData</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;NameValue&gt; resultList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * [</span></span><br><span class="line"><span class="comment">     *    &#123; value: 20, name: &#x27;成交&#x27; &#125;,</span></span><br><span class="line"><span class="comment">     *    &#123; value: 60, name: &#x27;交易&#x27; &#125;,</span></span><br><span class="line"><span class="comment">     *    &#123; value: 80, name: &#x27;客户&#x27; &#125;,</span></span><br><span class="line"><span class="comment">     *    &#123; value: 100, name: &#x27;线索&#x27; &#125;</span></span><br><span class="line"><span class="comment">     * ]</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">clueCount</span> <span class="operator">=</span> tClueMapper.selectClueByCount();</span><br><span class="line">    <span class="type">int</span> <span class="variable">customerCount</span> <span class="operator">=</span> tCustomerMapper.selectByCount();</span><br><span class="line">    <span class="type">int</span> <span class="variable">tranCount</span> <span class="operator">=</span> tTranMapper.selectByTotalTranCount();</span><br><span class="line">    <span class="type">int</span> <span class="variable">tranSuccessCount</span> <span class="operator">=</span> tTranMapper.selectBySuccessTranCount();</span><br><span class="line"></span><br><span class="line">    <span class="type">NameValue</span> <span class="variable">clue</span> <span class="operator">=</span> NameValue.builder().name(<span class="string">&quot;线索&quot;</span>).value(clueCount).build();</span><br><span class="line">    resultList.add(clue);</span><br><span class="line"></span><br><span class="line">    <span class="type">NameValue</span> <span class="variable">customer</span> <span class="operator">=</span> NameValue.builder().name(<span class="string">&quot;客户&quot;</span>).value(customerCount).build();</span><br><span class="line">    resultList.add(customer);</span><br><span class="line"></span><br><span class="line">    <span class="type">NameValue</span> <span class="variable">tran</span> <span class="operator">=</span> NameValue.builder().name(<span class="string">&quot;交易&quot;</span>).value(tranCount).build();</span><br><span class="line">    resultList.add(tran);</span><br><span class="line"></span><br><span class="line">    <span class="type">NameValue</span> <span class="variable">tranSuccess</span> <span class="operator">=</span> NameValue.builder().name(<span class="string">&quot;成交&quot;</span>).value(tranSuccessCount).build();</span><br><span class="line">    resultList.add(tranSuccess);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resultList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TTranMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">selectByTotalTranCount</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">selectBySuccessTranCount</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByTotalTranCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">  SELECT</span><br><span class="line">    count( 0 )</span><br><span class="line">  FROM</span><br><span class="line">      ( SELECT DISTINCT customer_id FROM t_tran ) t</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBySuccessTranCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">  SELECT</span><br><span class="line">    count( 0 )</span><br><span class="line">  FROM</span><br><span class="line">      ( SELECT DISTINCT customer_id FROM t_tran where stage = 42 ) t</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="线索统计饼图"><a href="#线索统计饼图" class="headerlink" title="线索统计饼图"></a>线索统计饼图</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 线索来源饼图，为 ECharts 准备一个定义了宽高的 DOM --&gt;</span><br><span class="line"> &lt;div id=&quot;sourcePieChart&quot; style=&quot;width: 48%; height:350px; margin:10px; float: left;&quot;&gt; 图渲染在此处 &lt;/div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">mounted</span>(<span class="params"></span>) &#123;~~~</span><br><span class="line">   <span class="comment">//加载线索来源饼图</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">loadSourcePieChart</span>();</span><br><span class="line">methods : &#123;</span><br></pre></td></tr></table></figure>

<p>StatisticController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/api/sourcePie/data&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">sourcePieData</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *   [</span></span><br><span class="line"><span class="comment">     *       &#123; value: 1048, name: &#x27;Search Engine&#x27; &#125;,</span></span><br><span class="line"><span class="comment">     *       &#123; value: 735, name: &#x27;Direct&#x27; &#125;,</span></span><br><span class="line"><span class="comment">     *       &#123; value: 580, name: &#x27;Email&#x27; &#125;,</span></span><br><span class="line"><span class="comment">     *       &#123; value: 484, name: &#x27;Union Ads&#x27; &#125;,</span></span><br><span class="line"><span class="comment">     *       &#123; value: 300, name: &#x27;Video Ads&#x27; &#125;</span></span><br><span class="line"><span class="comment">     *   ]</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;NameValue&gt; nameValueList = statisticService.loadSourcePieData();</span><br><span class="line">    <span class="keyword">return</span> R.OK(nameValueList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StatisticService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;NameValue&gt; <span class="title function_">loadSourcePieData</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>StatisticServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;NameValue&gt; <span class="title function_">loadSourcePieData</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> statisticManager.loadSourcePieData();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StatisticManager</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;NameValue&gt; <span class="title function_">loadSourcePieData</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//根据来源查线索</span></span><br><span class="line">    <span class="keyword">return</span> tClueMapper.selectBySource();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TClueMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;NameValue&gt; <span class="title function_">selectBySource</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBySource&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.bjpowernode.result.NameValue&quot;</span>&gt;</span></span><br><span class="line">  SELECT</span><br><span class="line">    count( tc.id ) value,</span><br><span class="line">    tdv.type_value name</span><br><span class="line">  FROM</span><br><span class="line">    t_clue tc</span><br><span class="line">      LEFT JOIN t_dic_value tdv ON tc.source = tdv.id</span><br><span class="line">  WHERE</span><br><span class="line">    tdv.type_value IS NOT NULL</span><br><span class="line">  GROUP BY</span><br><span class="line">    tc.source</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="Nginx部署Vue项目"><a href="#Nginx部署Vue项目" class="headerlink" title="Nginx部署Vue项目"></a>Nginx部署Vue项目</h1><p>1、Nginx 是一个高性能的web服务器；（服务器）</p>
<p>2、Nginx 是由俄罗斯人 Igor Sysoev 采用C语言开发编写的，第一个公开版本0.1.0发布于2004年10月4日；</p>
<p>3、Nginx 特点是占有内存少，并发处理能力强，以高性能、低系统资源消耗而闻名，在全世界范围内大量的网站使用了Nginx，国内互联网中也大量使用了Nginx，比如：淘宝、新浪、搜狐、网易、美团等；</p>
<p>7、Nginx是免费开源的，同时Nginx也有收费的商业版本，商业版本提供了性能优化、宕机等紧急问题处理等技术支持和服务；</p>
<p>商业版本：<a target="_blank" rel="noopener" href="http://www.nginx.com/">http://www.nginx.com</a></p>
<p>开源版：<a target="_blank" rel="noopener" href="http://nginx.org/">http://nginx.org</a> </p>
<h2 id="下载和安装"><a href="#下载和安装" class="headerlink" title="下载和安装"></a>下载和安装</h2><p>免费开源版的官方网站：<a target="_blank" rel="noopener" href="http://nginx.org/">http://nginx.org</a> ，在右边有个download点击下载，有最新版，稳定版和历史遗留版</p>
<p>Nginx 有 windows 版本和 linux 版本，但推荐在 linux 下使用 Nginx；安装xshell，Ubuntu</p>
<p>Nginx的安装需要Linux安装相关的几个库，否则配置和编译会出现错误；</p>
<p>执行如下命令：-y是自动确认的意思</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc openssl openssl-devel pcre pcre-devel zlib zlib-devel -y</span><br></pre></td></tr></table></figure>

<p>上面的是centos系统，Ubuntu用的是</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 先更新软件源（重要步骤，确保能找到所有包）</span><br><span class="line">sudo apt update</span><br><span class="line"></span><br><span class="line"># 安装所需依赖（移除了无效的lib包名，修正了对应包名）</span><br><span class="line">sudo apt install gcc openssl libssl-dev libpcre3 libpcre3-dev zlib1g zlib1g-dev -y</span><br></pre></td></tr></table></figure>

<p>用xftp上传到linux系统</p>
<p>1、解压下载下来的nginx文件，执行命令：tar -zxvf nginx-1.24.0.tar.gz</p>
<p>2、切换至解压后的nginx主目录，执行命令：cd nginx-1.24.0</p>
<p>3、在nginx主目录nginx-1.24.0下执行命令：.&#x2F;configure –prefix&#x3D;&#x2F;home&#x2F;shelter&#x2F;software&#x2F;nginx<br> （其中–prefix是指定nginx安装路径）&#x2F;software&#x2F;nginx 就是指定的路径文件名字</p>
<p>4、执行命令进行编译：make，如果失败就要安装make包sudo apt install make -y，编译完</p>
<p>5、执行命令进行安装：make install，权限不够就用sudo make install</p>
<p>然后用cd ..回到上级目录，之前的文件和文件夹就没用了，用rm -rf nginx-1.24.0删掉</p>
<h2 id="nginx启动"><a href="#nginx启动" class="headerlink" title="nginx启动"></a>nginx启动</h2><p>1、启动nginx执行命令：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /home/shelter/software/nginx/sbin/nginx -c /home/shelter/software/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>

<p>（其中-c是指定配置文件）</p>
<p>2、检查Nginx是否启动：通过查看进程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep nginx</span><br></pre></td></tr></table></figure>


<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE.assets/image-20250927195724514.png" alt="image-20250927195724514"></p>
<h2 id="nginx重启"><a href="#nginx重启" class="headerlink" title="nginx重启"></a>nginx重启</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /home/shelter/software/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure>

<h2 id="nginx关闭"><a href="#nginx关闭" class="headerlink" title="nginx关闭"></a>nginx关闭</h2><p>Nginx的关闭有多种方式：</p>
<p>1、优雅关闭Nginx：</p>
<p>找出nginx的进程号：ps -ef | grep nginx</p>
<p>执行命令：kill -QUIT 主pid    kill -QUIT 4702</p>
<p>其中pid是主进程号的pid（master process），其他为子进程pid（worker process）</p>
<p>优雅关闭会将已经进来的请求处理完后再关闭；</p>
<p>2、快速关闭Nginx：</p>
<p>找出nginx的进程号：ps -ef | grep nginx</p>
<p>kill -TERM 主pid</p>
<p>快速关闭会直接关闭，已经进来的请求也不会处理；(暴力方式)</p>
<h2 id="nginx配置检查"><a href="#nginx配置检查" class="headerlink" title="nginx配置检查"></a>nginx配置检查</h2><p><strong>conf&#x2F;nginx.conf</strong></p>
<p>当修改Nginx配置文件后，可以使用Nginx命令进行配置文件语法检查，用于检查Nginx配置文件是否正确；</p>
<p>检查Nginx配置文件是否正确：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /home/shelter/software/nginx/sbin/nginx -c /home/shelter/software/nginx/conf/nginx.conf -t</span><br></pre></td></tr></table></figure>

<h2 id="Nginx部署Vue项目-1"><a href="#Nginx部署Vue项目-1" class="headerlink" title="Nginx部署Vue项目"></a>Nginx部署Vue项目</h2><p>1、把vue项目打包；在vue项目找到package.json点击build侧边按钮，就打包成了dist文件夹，里面就是之前vue里的东西转换成了css和html，然后把这个文件夹上传到&#x2F;home&#x2F;shelter&#x2F;software&#x2F;nginx&#x2F;html这个的html文件夹里，修改文件名称为dlyk，如果传输失败可能是权限不足</p>
<p>第一步：先确认目标目录的权限状态</p>
<p>在 Ubuntu 终端中执行命令，查看 <code>nginx/html</code> 目录的所有者和权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 html 目录的权限信息</span></span><br><span class="line"><span class="built_in">ls</span> -ld /home/shelter/software/nginx/html</span><br></pre></td></tr></table></figure>

<ul>
<li>正常输出应显示所有者为当前用户（<code>shelter</code>），类似：<code>drwxr-xr-x 2 shelter shelter 4096 Sep 27 20:00 html</code></li>
<li>若所有者是 <code>root</code> 或其他用户，或权限列（如 <code>drwxr--r--</code>）没有写权限，就会导致传输失败。</li>
</ul>
<p>第二步：修改目录权限（关键解决步骤）</p>
<p>将 <code>nginx</code> 整个安装目录的所有权和权限修改为当前用户（<code>shelter</code>），确保 Xftp 有读写权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 递归修改目录所有者为当前用户（shelter）</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> -R shelter:shelter /home/shelter/software/nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 递归赋予目录读写执行权限（用户可读写，其他用户只读，足够传输使用）</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> -R 755 /home/shelter/software/nginx</span><br></pre></td></tr></table></figure>

<p>2、 </p>
<p>修改Nginx配置文件nginx.conf，可以直接在传输窗口里右击这个文件用记事本打开，往下滑有个http，再找到server，再找到location ，把之前的root加个#注释掉，root的意思就是这个项目的根路径在哪里，在html&#x2F;dlyk，try_files是尝试以下三个路径，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">        location / &#123;</span><br><span class="line">            #root   html;</span><br><span class="line">            root  html/dlyk;</span><br><span class="line">​            try_files $uri $uri/ /index.html;</span><br><span class="line">​            index index.html index.htm;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>红色部分就是重点配置；</p>
<p>弄好红重启服务，用sudo &#x2F;home&#x2F;shelter&#x2F;software&#x2F;nginx&#x2F;sbin&#x2F;nginx -c &#x2F;home&#x2F;shelter&#x2F;software&#x2F;nginx&#x2F;conf&#x2F;nginx.conf -t检查有没有问题</p>
<p>最后还要把后端上线一下，把httpRequest里面的网址改成axios.defaults.baseURL &#x3D; “<a target="_blank" rel="noopener" href="http://192.168.23.128:8089";就行了，然后重新打包上传">http://192.168.23.128:8089&quot;;就行了，然后重新打包上传</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/Shelter67">Shelter</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://localhost:4000/posts/336277b5.html">http://localhost:4000/posts/336277b5.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://localhost:4000" target="_blank">Shelter</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/springboot/">springboot</a><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE/">项目</a><a class="post-meta__tags" href="/tags/java/">java</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.dreamshelter.cn/blog/source/img/cover/20.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/5f7c9bb5.html" title="一小时快速上手Redis"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/33.png" onerror="onerror=null;src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">一小时快速上手Redis</div></div><div class="info-2"><div class="info-item-1">介绍redis是一个开源的基于内存的数据存储系统，用作数据库缓存和消息队列等场景，也是热门noSql数据库之一 传统数据库面对高并发场景，硬盘io是缓慢的，而内存相比就快很多所以有了这个 Redis的优势：  性能极高 数据类型丰富，单键值对最大支持512M大小的数据 简单易用，支持所有主流编程语言 支持数据持久化、主从复制、哨兵模式等高可用特性  下载通过https://github.com/redis-windows/redis-windows 然后点 安装 然后运行install_redis_service.bat，选择需要安装的目录，可以继承默认路径，redis-cli.exe是客户端，启动后输入info可以查看信息，uninstall_redis_service.bat是卸载程序 用命令提示符启动是redis-server.exe，停止方法是ctrl+c，启动客户端是redis-cli 然后用https://redis.io/downloads/#:~:text=Redis-,Insight,-Download%20a%20powerful下载redisinsight ...</div></div></div></a><a class="pagination-related" href="/posts/d6ebbbdf.html" title="Spring Boot 3"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/4.png" onerror="onerror=null;src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Spring Boot 3</div></div><div class="info-2"><div class="info-item-1">第1章 First Spring Boot认识Spring Boot我们来看看官方是如何介绍的： https://docs.spring.io/spring-boot/index.html   Spring Boot倡导约定优于配置，将简化开发发挥到极致。使用Spring Boot框架可以快速构建Spring应用，再也不需要大量的繁琐的的各种配置。Spring Boot框架设计的目标是：程序员关注业务逻辑就行了，环境方面的事儿交给Spring Boot就行。 Spring Boot特性：  快速创建独立的Spring应用程序。（Spring支持的SpringBoot都支持，也就是说SpringBoot全方位支持IoC，AOP等） 嵌入式的Tomcat、Jetty、Undertow容器。（web服务器本身就是几个jar包，Spring Boot框架自动嵌入了。） 需要什么功能时只需要引入对应的starter启动器即可。（启动器可以自动管理这个功能相关的依赖，自动管理依赖版本的控制） 尽最大努力，最大可能的自动配置Spring应用和第三方库。（例如：如果要进行事务的控制，不用做任何事...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/2821e645.html" title="饱了么后端"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/5.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-03</div><div class="info-item-2">饱了么后端</div></div><div class="info-2"><div class="info-item-1">项目效果前端是小程序，后端是商家管理界面，管理界面需要登录才可以使用，右上角可以切换营业状态，其他都是一些增删改查，然后里面是有真正的支付功能，支付后会告诉商家订单信息，可以选择拒单或者接单，用户会有个等待商户接单界面，也可以进行催单，接单成功后就进入到待派送状态，商家点击派送就进入到派送中状态，如果派送到就可以点击完成按钮进入已完成状态 然后也有数据统计，工作台里记录当天的一些数据 开发准备软件开发流程需求分析需要需求规格说明书   产品原型，一般是静态网页展示   设计： ui设计：会讲这个项目做完后最终的效果是什么样子，小到一个按钮，大到整个页面布局 数据库设计：把类型和数据库有什么关系都设计好 接口设计：比如一个登录功能的接口，请求方式什么样子的，参数路径是什么样子的 编码： 项目代码、单元测试 测试： 测试用例、测试报告 上线运维： 软件环境安装、配置 角色分工 项目经理：对整个项目负责，任务分配、把控进度 产品经理：进行需求调研，输出需求调研文档、产品原型等 UI设计师：根据产品原型输出界面效果图 架构师：项目整体架构设计、技术选型等 开发工程师：代码实现 测试工程师...</div></div></div></a><a class="pagination-related no-desc" href="/posts/5764bc58.html" title="饱了么前端"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/19.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-03</div><div class="info-item-2">饱了么前端</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/touxiang.jpg" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Shelter</div><div class="author-info-description">记录自己的成长日志</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Shelter67"><i class="fab fa-github"></i><span>没有什么star的github</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Shelter67" target="_blank" title="GitHub"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1830191738@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://space.bilibili.com/8416212" target="_blank" title="Bilibili"><i class="fab fa-bilibili" style="color: #fb7299;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的小小博客！都是基于hexo框架使用，魔改了一些地方，表现得有些二次元，有个博客希望能在未来工作简历上成为加分项吧，但是弄起来还真的挺好玩的</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%A8%E5%8A%9B%E4%BA%91%E5%AE%A2%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">动力云客项目</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87"><span class="toc-number">2.</span> <span class="toc-text">1.  项目准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.1.</span> <span class="toc-text">项目数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.2.</span> <span class="toc-text">前端项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nodejs%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.</span> <span class="toc-text">Nodejs环境变量配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEnpm%E4%BB%93%E5%BA%93"><span class="toc-number">2.2.2.</span> <span class="toc-text">配置npm仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vite%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.3.</span> <span class="toc-text">Vite安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vue%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7"><span class="toc-number">2.2.4.</span> <span class="toc-text">Vue项目开发工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MAVEN%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.5.</span> <span class="toc-text">MAVEN的配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91"><span class="toc-number">3.</span> <span class="toc-text">登录模块开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAvue%E9%A1%B9%E7%9B%AE%E5%B7%A5%E7%A8%8B"><span class="toc-number">3.1.</span> <span class="toc-text">创建vue项目工程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue%E9%A1%B9%E7%9B%AE%E5%B7%A5%E7%A8%8B%E7%BB%93%E6%9E%84%E8%AF%B4%E6%98%8E"><span class="toc-number">3.2.</span> <span class="toc-text">Vue项目工程结构说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8Vue%E9%A1%B9%E7%9B%AE%E5%B7%A5%E7%A8%8B"><span class="toc-number">3.3.</span> <span class="toc-text">启动Vue项目工程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue%E5%B7%A5%E7%A8%8B%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-number">3.4.</span> <span class="toc-text">Vue工程运行流程分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Element-plus"><span class="toc-number">3.5.</span> <span class="toc-text">Element plus</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2"><span class="toc-number">3.6.</span> <span class="toc-text">编写登录页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95"><span class="toc-number">3.7.</span> <span class="toc-text">登录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85axios%E4%BE%9D%E8%B5%96"><span class="toc-number">3.8.</span> <span class="toc-text">安装axios依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-number">3.9.</span> <span class="toc-text">后端项目搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%88%86%E5%B1%82%EF%BC%88%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%EF%BC%89"><span class="toc-number">3.10.</span> <span class="toc-text">项目分层（后端项目）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Apifox"><span class="toc-number">3.11.</span> <span class="toc-text">Apifox</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">3.12.</span> <span class="toc-text">Please sign in</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1"><span class="toc-number">3.13.</span> <span class="toc-text">添加路由</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A9%BE%E9%A9%B6%E8%88%B1%E9%A1%B5%E9%9D%A2%E6%95%B4%E4%BD%93%E5%B8%83%E5%B1%80"><span class="toc-number">4.</span> <span class="toc-text">驾驶舱页面整体布局</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%B0%B1%E6%98%AF%E5%88%B6%E4%BD%9C%E5%B7%A6%E4%BE%A7%E7%9A%84%E8%8F%9C%E5%8D%95"><span class="toc-number">4.1.</span> <span class="toc-text">然后就是制作左侧的菜单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%B3%E4%BE%A7%E8%8F%9C%E5%8D%95"><span class="toc-number">4.2.</span> <span class="toc-text">右侧菜单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E9%83%A8%E5%88%86"><span class="toc-number">4.2.1.</span> <span class="toc-text">上部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E7%9A%84%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.2.</span> <span class="toc-text">获取用户的后端接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81%E4%BF%9D%E6%8C%81%EF%BC%9A"><span class="toc-number">4.2.2.1.</span> <span class="toc-text">前后端分离登录状态保持：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sessionStorage%E4%B8%8ElocalStorage"><span class="toc-number">4.2.2.2.</span> <span class="toc-text">sessionStorage与localStorage</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81token"><span class="toc-number">4.2.3.</span> <span class="toc-text">验证token</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%99%BB%E5%BD%95token%E7%9A%84%E5%AD%98%E5%82%A8%E4%BD%8D%E7%BD%AE"><span class="toc-number">4.2.3.1.</span> <span class="toc-text">测试登录token的存储位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%8B%A6%E6%88%AA"><span class="toc-number">4.2.3.2.</span> <span class="toc-text">测试拦截</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%8D%E7%99%BB%E5%BD%95%EF%BC%88%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95%EF%BC%89"><span class="toc-number">4.2.4.</span> <span class="toc-text">免登录（自动登录）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95"><span class="toc-number">4.2.5.</span> <span class="toc-text">退出登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95%E5%90%8E%E7%AB%AF"><span class="toc-number">4.2.5.1.</span> <span class="toc-text">退出登录后端</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#token%E7%BB%AD%E6%9C%9F"><span class="toc-number">4.2.6.</span> <span class="toc-text">token续期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E7%99%BB%E9%99%86%E5%BC%B9%E7%AA%97%E4%B8%A4%E6%AC%A1%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">4.2.7.</span> <span class="toc-text">重新登陆弹窗两次的问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B4%A6%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">账户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E9%A1%B5%E9%9D%A2%E5%89%8D%E7%AB%AF"><span class="toc-number">5.1.</span> <span class="toc-text">设计页面前端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81"><span class="toc-number">5.2.</span> <span class="toc-text">后端代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%88%86%E9%A1%B5%E6%9D%A1"><span class="toc-number">5.3.</span> <span class="toc-text">添加分页条</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%99%E5%88%86%E9%A1%B5%E6%9D%A1%E6%B7%BB%E5%8A%A0%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6"><span class="toc-number">5.3.1.</span> <span class="toc-text">给分页条添加点击事件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#route%E4%B8%8E-router"><span class="toc-number">5.4.</span> <span class="toc-text">$route与$router</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%AF%A6%E6%83%85"><span class="toc-number">5.5.</span> <span class="toc-text">用户详情</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%AF%A6%E7%BB%86%E9%A1%B5%E9%9D%A2"><span class="toc-number">5.5.1.</span> <span class="toc-text">用户详细页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.5.2.</span> <span class="toc-text">后端接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2"><span class="toc-number">5.5.3.</span> <span class="toc-text">完善页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E8%B4%A6%E5%8F%B7%E5%8A%9F%E8%83%BD"><span class="toc-number">5.5.4.</span> <span class="toc-text">新增账号功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E5%92%8C%E6%8F%90%E4%BA%A4%E5%8A%9F%E8%83%BD%EF%BC%88%E5%89%8D%E7%AB%AF"><span class="toc-number">5.5.5.</span> <span class="toc-text">验证和提交功能（前端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-1"><span class="toc-number">5.5.6.</span> <span class="toc-text">后端接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E6%95%B4"><span class="toc-number">5.5.6.1.</span> <span class="toc-text">调整</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%88%B7%E6%96%B0"><span class="toc-number">5.5.7.</span> <span class="toc-text">页面刷新</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E7%94%A8%E6%88%B7"><span class="toc-number">5.6.</span> <span class="toc-text">编辑用户</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81-1"><span class="toc-number">5.6.1.</span> <span class="toc-text">后端代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7"><span class="toc-number">5.7.</span> <span class="toc-text">删除用户</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF"><span class="toc-number">5.7.1.</span> <span class="toc-text">前端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF"><span class="toc-number">5.7.2.</span> <span class="toc-text">后端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%97%B6%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">5.7.3.</span> <span class="toc-text">删除时外键约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E5%85%A8%E5%B1%80%E6%8D%95%E8%8E%B7%E5%BC%82%E5%B8%B8"><span class="toc-number">5.8.</span> <span class="toc-text">加入全局捕获异常</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="toc-number">5.9.</span> <span class="toc-text">批量删除</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-1"><span class="toc-number">5.9.1.</span> <span class="toc-text">后端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%9D%83%E9%99%90"><span class="toc-number">5.10.</span> <span class="toc-text">数据权限</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%82%E5%9C%BA%E6%B4%BB%E5%8A%A8"><span class="toc-number">6.</span> <span class="toc-text">市场活动</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%88%B6%E4%BD%9C"><span class="toc-number">6.1.</span> <span class="toc-text">页面制作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-2"><span class="toc-number">6.1.1.</span> <span class="toc-text">后端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.2.</span> <span class="toc-text">搜索查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-3"><span class="toc-number">6.2.1.</span> <span class="toc-text">后端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%82%E5%9C%BA%E6%B4%BB%E5%8A%A8%E6%90%9C%E7%B4%A2%E8%BF%87%E6%BB%A4%E6%9D%A1%E4%BB%B6"><span class="toc-number">6.2.2.</span> <span class="toc-text">市场活动搜索过滤条件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E7%9A%84%E5%9B%BD%E9%99%85%E5%8C%96%EF%BC%88%E4%B8%AD%E6%96%87%EF%BC%89"><span class="toc-number">6.3.</span> <span class="toc-text">日期的国际化（中文）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BD%95%E5%85%A5%E5%B8%82%E5%9C%BA%E6%B4%BB%E5%8A%A8%E9%A1%B5%E9%9D%A2"><span class="toc-number">6.4.</span> <span class="toc-text">录入市场活动页面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99"><span class="toc-number">6.4.1.</span> <span class="toc-text">添加验证规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-4"><span class="toc-number">6.4.2.</span> <span class="toc-text">后端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E5%B8%82%E5%9C%BA%E6%B4%BB%E5%8A%A8"><span class="toc-number">6.5.</span> <span class="toc-text">编辑市场活动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-1"><span class="toc-number">6.5.1.</span> <span class="toc-text">前端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-5"><span class="toc-number">6.5.2.</span> <span class="toc-text">后端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%82%E5%9C%BA%E6%B4%BB%E5%8A%A8%E8%AF%A6%E6%83%85"><span class="toc-number">6.6.</span> <span class="toc-text">市场活动详情</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-2"><span class="toc-number">6.6.1.</span> <span class="toc-text">前端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-6"><span class="toc-number">6.6.2.</span> <span class="toc-text">后端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E6%B3%A8%E5%89%8D%E7%AB%AF"><span class="toc-number">6.6.3.</span> <span class="toc-text">备注前端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E6%B3%A8%E5%90%8E%E7%AB%AF"><span class="toc-number">6.6.4.</span> <span class="toc-text">备注后端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E6%B3%A8%E8%AE%B0%E5%BD%95%E6%9F%A5%E8%AF%A2%E5%89%8D%E7%AB%AF"><span class="toc-number">6.6.5.</span> <span class="toc-text">备注记录查询前端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E6%B3%A8%E8%AE%B0%E5%BD%95%E6%9F%A5%E8%AF%A2%E5%90%8E%E7%AB%AF"><span class="toc-number">6.6.6.</span> <span class="toc-text">备注记录查询后端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E6%B3%A8%E8%AE%B0%E5%BD%95%E7%BC%96%E8%BE%91%E5%8A%9F%E8%83%BD"><span class="toc-number">6.6.7.</span> <span class="toc-text">备注记录编辑功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E6%B3%A8%E8%AE%B0%E5%BD%95%E5%88%A0%E9%99%A4%E5%8A%9F%E8%83%BD"><span class="toc-number">6.6.8.</span> <span class="toc-text">备注记录删除功能</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%BF%E7%B4%A2%E7%AE%A1%E7%90%86"><span class="toc-number">7.</span> <span class="toc-text">线索管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%87%86%E5%A4%87"><span class="toc-number">7.1.</span> <span class="toc-text">页面准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-3"><span class="toc-number">7.1.1.</span> <span class="toc-text">前端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-7"><span class="toc-number">7.1.2.</span> <span class="toc-text">后端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E7%BA%BF%E7%B4%A2excel%E5%8A%9F%E8%83%BD%E5%89%8D%E7%AB%AF"><span class="toc-number">7.1.3.</span> <span class="toc-text">导入线索excel功能前端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E7%BA%BF%E7%B4%A2excel%E5%8A%9F%E8%83%BD%E5%90%8E%E7%AB%AF"><span class="toc-number">7.1.4.</span> <span class="toc-text">导入线索excel功能后端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#EasyExcel"><span class="toc-number">7.1.4.1.</span> <span class="toc-text">EasyExcel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81-2"><span class="toc-number">7.1.4.2.</span> <span class="toc-text">后端代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E5%96%84%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-number">7.1.4.3.</span> <span class="toc-text">完善转换器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">7.1.4.4.</span> <span class="toc-text">导入到数据库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BD%95%E5%85%A5%E7%BA%BF%E7%B4%A2"><span class="toc-number">7.2.</span> <span class="toc-text">录入线索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-4"><span class="toc-number">7.2.1.</span> <span class="toc-text">前端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-8"><span class="toc-number">7.2.2.</span> <span class="toc-text">后端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%95%E5%85%A5%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81"><span class="toc-number">7.2.3.</span> <span class="toc-text">录入表单验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4%E8%A1%A8%E5%8D%95"><span class="toc-number">7.2.4.</span> <span class="toc-text">提交表单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E5%8A%9F%E8%83%BD"><span class="toc-number">7.2.5.</span> <span class="toc-text">编辑功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%A6%E6%83%85%E5%8A%9F%E8%83%BD"><span class="toc-number">7.2.6.</span> <span class="toc-text">详情功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AC%E6%88%90%E5%AE%A2%E6%88%B7"><span class="toc-number">7.2.6.1.</span> <span class="toc-text">转成客户</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">8.</span> <span class="toc-text">客户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E5%B1%95%E5%BC%80%E5%BD%93%E5%89%8D%E8%8F%9C%E5%8D%95"><span class="toc-number">8.1.</span> <span class="toc-text">默认展开当前菜单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#excel%E6%89%B9%E9%87%8F%E5%AF%BC%E5%87%BA"><span class="toc-number">8.2.</span> <span class="toc-text">excel批量导出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%AF%BC%E5%87%BA"><span class="toc-number">8.3.</span> <span class="toc-text">选择导出</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90"><span class="toc-number">9.</span> <span class="toc-text">用户权限</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%8F%9C%E5%8D%95%E6%9D%83%E9%99%90"><span class="toc-number">9.1.</span> <span class="toc-text">用户菜单权限</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">9.1.1.</span> <span class="toc-text">代码实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%8A%9F%E8%83%BD%E6%9D%83%E9%99%90"><span class="toc-number">9.2.</span> <span class="toc-text">用户功能权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E9%92%AE%E6%9D%83%E9%99%90%E9%9A%90%E8%97%8F"><span class="toc-number">9.3.</span> <span class="toc-text">按钮权限隐藏</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1"><span class="toc-number">10.</span> <span class="toc-text">数据统计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%A7%88%E7%BB%9F%E8%AE%A1"><span class="toc-number">10.1.</span> <span class="toc-text">概览统计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%80%E5%94%AE%E6%BC%8F%E6%96%97%E5%9B%BE"><span class="toc-number">10.2.</span> <span class="toc-text">销售漏斗图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%B4%A2%E7%BB%9F%E8%AE%A1%E9%A5%BC%E5%9B%BE"><span class="toc-number">10.3.</span> <span class="toc-text">线索统计饼图</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Nginx%E9%83%A8%E7%BD%B2Vue%E9%A1%B9%E7%9B%AE"><span class="toc-number">11.</span> <span class="toc-text">Nginx部署Vue项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85"><span class="toc-number">11.1.</span> <span class="toc-text">下载和安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx%E5%90%AF%E5%8A%A8"><span class="toc-number">11.2.</span> <span class="toc-text">nginx启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx%E9%87%8D%E5%90%AF"><span class="toc-number">11.3.</span> <span class="toc-text">nginx重启</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx%E5%85%B3%E9%97%AD"><span class="toc-number">11.4.</span> <span class="toc-text">nginx关闭</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx%E9%85%8D%E7%BD%AE%E6%A3%80%E6%9F%A5"><span class="toc-number">11.5.</span> <span class="toc-text">nginx配置检查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E9%83%A8%E7%BD%B2Vue%E9%A1%B9%E7%9B%AE-1"><span class="toc-number">11.6.</span> <span class="toc-text">Nginx部署Vue项目</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/da77c56c.html" title="MVC架构设计模式"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/10.png" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="MVC架构设计模式"/></a><div class="content"><a class="title" href="/posts/da77c56c.html" title="MVC架构设计模式">MVC架构设计模式</a><time datetime="2026-11-14T16:24:00.000Z" title="发表于 2026-11-15 00:24:00">2026-11-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/e25feb6e.html" title="黑马程序员SSM"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/2.jpg" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="黑马程序员SSM"/></a><div class="content"><a class="title" href="/posts/e25feb6e.html" title="黑马程序员SSM">黑马程序员SSM</a><time datetime="2026-02-03T03:14:00.000Z" title="发表于 2026-02-03 11:14:00">2026-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/eedaddf.html" title="博客笔记"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/30.png" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="博客笔记"/></a><div class="content"><a class="title" href="/posts/eedaddf.html" title="博客笔记">博客笔记</a><time datetime="2026-02-03T02:50:00.000Z" title="发表于 2026-02-03 10:50:00">2026-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5764bc58.html" title="饱了么前端"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/19.png" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="饱了么前端"/></a><div class="content"><a class="title" href="/posts/5764bc58.html" title="饱了么前端">饱了么前端</a><time datetime="2026-02-03T02:50:00.000Z" title="发表于 2026-02-03 10:50:00">2026-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2821e645.html" title="饱了么后端"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/5.jpg" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="饱了么后端"/></a><div class="content"><a class="title" href="/posts/2821e645.html" title="饱了么后端">饱了么后端</a><time datetime="2026-02-03T02:50:00.000Z" title="发表于 2026-02-03 10:50:00">2026-02-03</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By Shelter</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><script src="/js/tw_cn.js?v=5.5.4"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://blog.dreamshelter.cn/twikooapi/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://blog.dreamshelter.cn/twikooapi/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script src="https://fastly.jsdelivr.net/npm/live2d-widgets@1.0.0/dist/autoload.js"></script><div class="aplayer no-destroy" data-id="17745883873" data-server="netease" data-type="playlist" data-order="list" data-fixed="true" data-preload="auto" data-autoplay="true" data-mutex="true" ></div><script id="canvas_nest" defer="defer" color="255,192,203" opacity="0" zIndex="-1" count="80" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"]):not([href=".aside-content"]):not([href="#aside-content"]):not([href=".card-clock
# Inject the css and script (aplayer/meting) aplayerInject: enable: true per_page: true
# 通知弹窗 # Snackbar - Toast Notification # https://github.com/polonel/SnackBar # position: top-left / top-center / top-right / bottom-left / bottom-center / bottom-right snackbar: enable: true position: top-right # The background color of Toast Notification in light mode and dark mode bg_light: "])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      false
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><div id="app-refresh" style="position: fixed; top: -2.2rem; left: 0; right: 0; z-index: 99999; padding: 0 1rem; font-size: 15px; height: 2.2rem; transition: all 0.3s ease;"><div class="app-refresh-wrap" style="display: flex; color: #fff; height: 100%; align-items: center; justify-content: center;"><label>🚀 有新内容发布啦！</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color: #fff; text-decoration: underline; cursor: pointer; margin-left: 8px;">点击刷新</span></a></div></div><script>if ('serviceWorker' in navigator) {
  // 如果当前页面受 Service Worker 控制，监听控制权变化
  if (navigator.serviceWorker.controller) {
    navigator.serviceWorker.addEventListener('controllerchange', function() {
      showNotification();
    });
  }

  // 页面加载完成后注册 sw.js
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js').catch(err => {
      console.error('PWA 注册失败:', err);
    });
  });
}

function showNotification() {
  // 优先使用主题自带的 Snackbar 弹窗
  if (window.GLOBAL_CONFIG && GLOBAL_CONFIG.Snackbar) {
    var snackbarBg = document.documentElement.getAttribute('data-theme') === 'light' ?
      GLOBAL_CONFIG.Snackbar.bgLight :
      GLOBAL_CONFIG.Snackbar.bgDark;
    
    var snackbarPos = GLOBAL_CONFIG.Snackbar.position;

    Snackbar.show({
      text: '🚀 有新文章发布啦！',
      backgroundColor: snackbarBg,
      duration: 10000, // 持续 10 秒
      pos: snackbarPos,
      actionText: '点击刷新',
      actionTextColor: '#fff',
      onActionClick: function(e) {
        location.reload();
      },
    });
  } else {
    // 如果没有 Snackbar，则显示顶部的 app-refresh 栏
    var showBg = document.documentElement.getAttribute('data-theme') === 'light' ? '#49b1f5' : '#1f1f1f';
    var appRefresh = document.getElementById('app-refresh');
    if (appRefresh) {
      appRefresh.style.cssText = 'top: 0; background: ' + showBg + ';';
    }
  }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索点什么呢………" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.4"></script></div></div><!-- hexo injector body_end start -->
  <script data-pjax src="/js/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://vercelapi.dreamshelter.cn/api?user=shelter67";
            var git_color =['#ebedf0', '#a2f7af', '#6ce480', '#54ad63', '#469252', '#31753c', '#1f5f2a', '#13531f', '#084111', '#032b09', '#000000'];
            var git_user ="shelter67";
            var parent_div_git = document.getElementsByClassName('layout')[0];
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/gongxianban/'){
                console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar");
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementsByClassName('layout')[0]){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><script data-pjax>
function hexo_butterfly_clock_remake_injector_config(){
  var parent_div_git;
  var item_html = `<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-veeink@1.0.7/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>`;

  // 按类型获取容器
  if ('class' === 'class') {
    parent_div_git = document.getElementsByClassName('aside-content')[0];
  } else if ('class' === 'id') {
    parent_div_git = document.getElementById('aside-content');
  } else {
    parent_div_git = document.getElementById('aside-content');
  }

  if(parent_div_git){
    var reference_el_before = null;
    var reference_el_after = parent_div_git.querySelector('.card-announcement');

    if(reference_el_before){
      parent_div_git.insertBefore(
        (function(){var temp = document.createElement('div'); temp.innerHTML = item_html; return temp;}()),
        reference_el_before
      );
    } else if(reference_el_after){
      reference_el_after.insertAdjacentHTML('afterend', item_html);
    } else {
      parent_div_git.insertAdjacentHTML('afterbegin', item_html);
    }
  }
}

console.log('已挂载 butterfly_clock_anzhiyu-yang 修复版');

// ---------- 全局变量声明 ----------
var cpage = location.pathname;
var epage = 'all';
var qweather_key = '0df3cf714a324957b16f3201e86fe931';
var qweather_api_host = 'https://p65ctvhqy4.re.qweatherapi.com';
var default_city = '';
var gaud_map_key = '296709bdb591a3523a2cf60e8e8f0ba3';

// ---------- 页面过滤 ----------
var elist = 'null'.split(',');
var flag = 0;
for(var i=0;i<elist.length;i++){
  if(cpage.includes(elist[i])) flag++;
}

if((epage === 'all') && (flag == 0)){
  hexo_butterfly_clock_remake_injector_config();
} else if(epage === cpage){
  hexo_butterfly_clock_remake_injector_config();
}
</script><script data-pjax src="/clock/clock-min.js"></script><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementsByClassName('footer-other')[0];
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v8.1.1" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v5.5.4" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://cloud.tencent.com/" style="margin-inline:5px" data-title="本站由腾讯云提供服务器支持" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Server-Tencent%20Cloud-00A4FF?style=flat&amp;logo=qq&amp;logoColor=white" alt=""/></a><a class="github-badge" target="_blank" href="https://edgeone.ai/" style="margin-inline:5px" data-title="本站由腾讯云 EdgeOne 提供安全加速" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-EdgeOne-00A4FF?style=flat&amp;logo=iCloud&amp;logoColor=white" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="https://beian.miit.gov.cn/" style="margin-inline:5px" data-title="工业和信息化部ICP备案管理系统" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/%E9%B2%81ICP%E5%A4%87-2025199346%E5%8F%B7--1-ba9132?style=flat&amp;labelColor=443d38" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://www.fomal.cc/static/js/runtime.js"></script><!-- hexo injector body_end end --></body></html>