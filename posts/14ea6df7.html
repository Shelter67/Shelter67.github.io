<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><link rel=manifest href=/manifest.json><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>数据库 | Shelter</title><meta name="author" content="Shelter"><meta name="copyright" content="Shelter"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="数据库概述什么是数据库 数据库对应的英文单词是DataBase，简称DB java的端口号：8080，mysql的3306  数据库类型 关系型数据库 关系型数据库是依据关系模型来创建的数据库。所谓关系模型就是“一对一、一对多、多对多”等关系模型   非关系型数据库（NoSQL）  数据库管理系统 数据库管理系统（Database Management System，简称DBMS）是为管理数据库而">
<meta property="og:type" content="article">
<meta property="og:title" content="数据库">
<meta property="og:url" content="http://localhost:4000/posts/14ea6df7.html">
<meta property="og:site_name" content="Shelter">
<meta property="og:description" content="数据库概述什么是数据库 数据库对应的英文单词是DataBase，简称DB java的端口号：8080，mysql的3306  数据库类型 关系型数据库 关系型数据库是依据关系模型来创建的数据库。所谓关系模型就是“一对一、一对多、多对多”等关系模型   非关系型数据库（NoSQL）  数据库管理系统 数据库管理系统（Database Management System，简称DBMS）是为管理数据库而">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.dreamshelter.cn/blog/source/img/cover/33.png">
<meta property="article:published_time" content="2025-04-01T08:23:00.000Z">
<meta property="article:modified_time" content="2026-02-09T10:05:53.996Z">
<meta property="article:author" content="Shelter">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="sql">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.dreamshelter.cn/blog/source/img/cover/33.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "数据库",
  "url": "http://localhost:4000/posts/14ea6df7.html",
  "image": "https://cdn.dreamshelter.cn/blog/source/img/cover/33.png",
  "datePublished": "2025-04-01T08:23:00.000Z",
  "dateModified": "2026-02-09T10:05:53.996Z",
  "author": [
    {
      "@type": "Person",
      "name": "Shelter",
      "url": "https://github.com/Shelter67"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.dreamshelter.cn/blog/source/img/favicon.png"><link rel="canonical" href="http://localhost:4000/posts/14ea6df7.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="#49b1f5"/><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/128.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"/><link rel="mask-icon" href="/img/siteicon/128.png" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":3,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '数据库',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><style>#waifu { left: auto !important; right: 20px !important; }</style><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-veeink@1.0.7/lib/clock-min.css" /><link rel="stylesheet" href="https://www.fomal.cc/static/css/runtime.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 8.1.1"></head><body><div class="bg-animation" id="web_bg" style="background-image: url(https://cdn.dreamshelter.cn/blog/source/img/background.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/touxiang.jpg" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/zhuifan.html"><i class="fa-fw fas fa-tv"></i><span> 追番</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/zhuiju.html"><i class="fa-fw fas fa-video"></i><span> 追剧</span></a></div><div class="menus_item"><a class="site-page" href="/gongxianban"><i class="fa-fw fab fa-github-alt"></i><span> 贡献板</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.dreamshelter.cn/blog/source/img/cover/33.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Shelter</span></a><a class="nav-page-title" href="/"><span class="site-name">数据库</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/zhuifan.html"><i class="fa-fw fas fa-tv"></i><span> 追番</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/zhuiju.html"><i class="fa-fw fas fa-video"></i><span> 追剧</span></a></div><div class="menus_item"><a class="site-page" href="/gongxianban"><i class="fa-fw fab fa-github-alt"></i><span> 贡献板</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">数据库</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-01T08:23:00.000Z" title="发表于 2025-04-01 16:23:00">2025-04-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-09T10:05:53.996Z" title="更新于 2026-02-09 18:05:53">2026-02-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">37.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>133分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2026-02-09 18:05:53&quot;}" hidden></div><h1 id="数据库概述"><a href="#数据库概述" class="headerlink" title="数据库概述"></a>数据库概述</h1><h2 id="什么是数据库"><a href="#什么是数据库" class="headerlink" title="什么是数据库"></a>什么是数据库</h2><ul>
<li>数据库对应的英文单词是DataBase，简称DB</li>
<li>java的端口号：8080，mysql的3306</li>
</ul>
<h2 id="数据库类型"><a href="#数据库类型" class="headerlink" title="数据库类型"></a>数据库类型</h2><ul>
<li>关系型数据库<ul>
<li>关系型数据库是依据关系模型来创建的数据库。所谓关系模型就是“一对一、一对多、多对多”等关系模型</li>
</ul>
</li>
<li>非关系型数据库（NoSQL）</li>
</ul>
<h2 id="数据库管理系统"><a href="#数据库管理系统" class="headerlink" title="数据库管理系统"></a>数据库管理系统</h2><ul>
<li>数据库管理系统（Database Management System，简称DBMS）是为管理数据库而设计的电脑软件系统，一般具有存储、截取、安全保障、备份等基础功能。</li>
<li>数据库管理系统是数据库系统的核心组成部分，主要完成对数据库的操作与管理功能，实现数据库对象的创建、数据库存储数据的查询、添加、修改与删除操作和数据库的用户管理、权限管理等。</li>
<li>常见的数据库管理系统有：MySQL、Oracle、DB2、MS SQL Server、SQLite、PostgreSQL、Sybase等。</li>
</ul>
<h2 id="什么是SQL"><a href="#什么是SQL" class="headerlink" title="什么是SQL"></a>什么是SQL</h2><ul>
<li>结构化查询语言（Structured Query Language）简称SQL，是一种特殊目的的编程语言，是一种数据库查询和程序设计语言，用于存取数据以及查询、更新和管理关系数据库系统。</li>
<li>DBMS（软件）-&gt; SQL（语言）-&gt; DB（文件）</li>
<li>SQL的分类<ul>
<li>DQL（最重要 ）<ul>
<li>数据查询语言（Data Query Language, DQL）是SQL语言中，负责进行数据查询而不会对数据本身进行修改的语句，这是最基本的SQL语句。保留字<strong>SELECT</strong>是DQL（也是所有SQL）用得最多的动词，其他DQL常用的保留字有FROM，WHERE，GROUP BY，HAVING和ORDER BY。这些DQL保留字常与其他类型的SQL语句一起使用。</li>
</ul>
</li>
<li>DDL（对表结构进行操作）<ul>
<li>数据定义语言 (Data Definition Language, DDL) 是SQL语言集中，负责数据结构定义与数据库对象定义的语言，由CREATE、ALTER与DROP三个语法所组成，最早是由 Codasyl (Conference on Data Systems Languages) 数据模型开始，现在被纳入 SQL 指令中作为其中一个子集。</li>
</ul>
</li>
<li>DML<ul>
<li>数据操纵语言（Data Manipulation Language, DML）是SQL语言中，负责对数据库对象运行数据访问工作的指令集，以<strong>INSERT、UPDATE、DELETE</strong>三种指令为核心，分别代表插入、更新与删除。</li>
</ul>
</li>
<li>DCL<ul>
<li>数据控制语言 (Data Control Language) 在SQL语言中，是一种可对数据访问权进行控制的指令，它可以控制特定用户账户对数据表、查看表、预存程序、用户自定义函数等数据库对象的控制权。由 GRANT 和 REVOKE 两个指令组成。DCL以控制用户的访问权限为主，GRANT为<strong>授权</strong>语句，对应的REVOKE是<strong>撤销授权</strong>语句。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="登录MySQL"><a href="#登录MySQL" class="headerlink" title="登录MySQL"></a>登录MySQL</h1><p>修改MySQL的root账户密码：ALTER USER ‘root‘@’localhost’ IDENTIFIED WITH mysql_native_password BY ‘新密码’;</p>
<h2 id="本地登录"><a href="#本地登录" class="headerlink" title="本地登录"></a>本地登录</h2><ul>
<li>如果mysql的服务是启动的，打开dos命令窗口，输入：mysql -uroot -p，回车，然后输入root账户的密码</li>
</ul>
<p>![(image-20250315165831211.png)</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250315165940960.png" alt="image-20250315165940960"></p>
<p>解释“mysql -uroot -p”：<br>mysql是一个命令，在bin目录下，对应的命令文件是mysql.exe，如果将bin目录配置到环境<br>变量path中，才可以在以上位置使用该命令。<br>-uroot 表示登录的用户是root，u实际上是user单词的首字母。<br>-p 表示登录时使用密码，p实际上是password单词的首字母。</p>
<ul>
<li>也可以将密码以明文的形式写到-p后面，这样做可能会导致你的密码泄露</li>
</ul>
<h2 id="远程登录"><a href="#远程登录" class="headerlink" title="远程登录"></a>远程登录</h2><p>假设mysql安装在A机器上，现在你要在B机器上连接mysql数据库，此时需要使用远程登录，远程登录时加上远程机器的ip地址即可</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250315170219114.png" alt="image-20250315170219114"></p>
<p>-h中的h实际上是host单词的首字母。在-h后面的是远程计算机的ip地址。<br>127.0.0.1是计算机默认的本机IP地址。<br>127.0.0.1又可以写作：localhost，他们是等效的。<br>注意：mysql默认情况下root账户是不支持远程登录的，其实这是一种安全策略，<br>为了保护root账户的安全。如果希望root账户支持远程登录，这是需要进行设置的。</p>
<ul>
<li><p>mysql8 开放root账户远程登录权限（危险动作）</p>
<p>第一步：现在本地使用root账户登录mysql</p>
<p>第二步：use mysql;</p>
<p>第三步：update user set host &#x3D; ‘%’ where user &#x3D; ‘root’;</p>
<p>第四步：flush privileges;</p>
</li>
</ul>
<h1 id="第03章-初始化数据"><a href="#第03章-初始化数据" class="headerlink" title="第03章 初始化数据"></a>第03章 初始化数据</h1><h2 id="MySQL命令行基本命令"><a href="#MySQL命令行基本命令" class="headerlink" title="MySQL命令行基本命令"></a>MySQL命令行基本命令</h2><ol>
<li>列出当前数据库管理系统中有哪些数据库。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316030921110.png" alt="image-20250316030921110"></p>
<ol start="2">
<li>创建数据库，起名bjpowernode。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database bjpowernode;</span><br></pre></td></tr></table></figure>


<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316030952423.png" alt="image-20250316030952423"></p>
<ol start="3">
<li>使用bjpowernode数据库。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use bjpowernode;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316031003365.png"></p>
<ol start="4">
<li>查看当前用的是哪个数据库。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> database();</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316031023848.png" alt="image-20250316031023848"></p>
<ol start="5">
<li>查看当前数据库中有哪些表。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> tables;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2021/png/21376908/1620402397890-84d73980-1046-4e83-b6cb-bdcc68ba7b57.png#averageHue=%23151210&height=53&id=qqu40&originHeight=53&originWidth=207&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2593&status=done&style=shadow&title=&width=207" alt="image.png"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316031042985.png" alt="image-20250316031042985"></p>
<ol start="6">
<li>删除数据库bjpowernode。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> database bjpowernode;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316031107016.png" alt="image-20250316031107016"></p>
<ol start="7">
<li>退出mysql<ol>
<li>exit</li>
<li>quit</li>
<li>ctrl + c</li>
</ol>
</li>
<li>查看当前mysql版本</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> version();</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316031121447.png" alt="image-20250316031121447"></p>
<p>还可以使用mysql.exe命令来查看版本信息（在没有登录mysql之前使用）：mysql –version</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316031137820.png" alt="image-20250316031137820"></p>
<h2 id="数据库表的概述"><a href="#数据库表的概述" class="headerlink" title="数据库表的概述"></a>数据库表的概述</h2><table>
<thead>
<tr>
<th>name</th>
<th>age</th>
<th>gender</th>
</tr>
</thead>
<tbody><tr>
<td>张三</td>
<td>20</td>
<td>男</td>
</tr>
<tr>
<td>李四</td>
<td>22</td>
<td>女</td>
</tr>
</tbody></table>
<p>行是row，列是column</p>
<ul>
<li>任何一张表都有行和列：<ul>
<li>行：记录（一行就是一条数据）</li>
<li>列：字段（name字段、age字段、gender字段）</li>
</ul>
</li>
<li>每个字段包含以下属性：<ul>
<li>字段名：name、age、gender都是字段的名字</li>
<li>字段的数据类型：每个字段都有数据类型，比如：字符类型、数字类型、日期类型</li>
<li>字段的数据长度：每个字段有可能会有长度的限制</li>
<li>字段的约束：比如某些字段要求该字段下的数据不能重复、不能为空等，用来保证表格中数据合法有效</li>
</ul>
</li>
</ul>
<h2 id="初始化测试数据"><a href="#初始化测试数据" class="headerlink" title="初始化测试数据"></a>初始化测试数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> EMP;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> DEPT;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> SALGRADE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> DEPT(DEPTNO <span class="type">int</span>(<span class="number">2</span>) <span class="keyword">not null</span> ,</span><br><span class="line">	DNAME <span class="type">VARCHAR</span>(<span class="number">14</span>) ,</span><br><span class="line">	LOC <span class="type">VARCHAR</span>(<span class="number">13</span>),</span><br><span class="line">	<span class="keyword">primary key</span> (DEPTNO)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE TABLE</span> EMP(EMPNO <span class="type">int</span>(<span class="number">4</span>)  <span class="keyword">not null</span> ,</span><br><span class="line">	ENAME <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">	JOB <span class="type">VARCHAR</span>(<span class="number">9</span>),</span><br><span class="line">	MGR <span class="type">INT</span>(<span class="number">4</span>),</span><br><span class="line">	HIREDATE <span class="type">DATE</span>  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	SAL <span class="keyword">DOUBLE</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line">	COMM <span class="keyword">DOUBLE</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line">	<span class="keyword">primary key</span> (EMPNO),</span><br><span class="line">	DEPTNO <span class="type">INT</span>(<span class="number">2</span>) </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> SALGRADE( GRADE <span class="type">INT</span>,</span><br><span class="line">	LOSAL <span class="type">INT</span>,</span><br><span class="line">	HISAL <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> DEPT ( DEPTNO, DNAME, LOC ) <span class="keyword">VALUES</span> ( <span class="number">10</span>, <span class="string">&#x27;ACCOUNTING&#x27;</span>, <span class="string">&#x27;NEW YORK&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> DEPT ( DEPTNO, DNAME, LOC ) <span class="keyword">VALUES</span> ( <span class="number">20</span>, <span class="string">&#x27;RESEARCH&#x27;</span>, <span class="string">&#x27;DALLAS&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> DEPT ( DEPTNO, DNAME, LOC ) <span class="keyword">VALUES</span> ( <span class="number">30</span>, <span class="string">&#x27;SALES&#x27;</span>, <span class="string">&#x27;CHICAGO&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> DEPT ( DEPTNO, DNAME, LOC ) <span class="keyword">VALUES</span> ( <span class="number">40</span>, <span class="string">&#x27;OPERATIONS&#x27;</span>, <span class="string">&#x27;BOSTON&#x27;</span>); </span><br><span class="line"> </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7369</span>, <span class="string">&#x27;SMITH&#x27;</span>, <span class="string">&#x27;CLERK&#x27;</span>, <span class="number">7902</span>,  <span class="string">&#x27;1980-12-17&#x27;</span>, <span class="number">800</span>, <span class="keyword">NULL</span>, <span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7499</span>, <span class="string">&#x27;ALLEN&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>, <span class="number">7698</span>,  <span class="string">&#x27;1981-02-20&#x27;</span>, <span class="number">1600</span>, <span class="number">300</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7521</span>, <span class="string">&#x27;WARD&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>, <span class="number">7698</span>,  <span class="string">&#x27;1981-02-22&#x27;</span>, <span class="number">1250</span>, <span class="number">500</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7566</span>, <span class="string">&#x27;JONES&#x27;</span>, <span class="string">&#x27;MANAGER&#x27;</span>, <span class="number">7839</span>,  <span class="string">&#x27;1981-04-02&#x27;</span>, <span class="number">2975</span>, <span class="keyword">NULL</span>, <span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7654</span>, <span class="string">&#x27;MARTIN&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>, <span class="number">7698</span>,  <span class="string">&#x27;1981-09-28&#x27;</span>, <span class="number">1250</span>, <span class="number">1400</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7698</span>, <span class="string">&#x27;BLAKE&#x27;</span>, <span class="string">&#x27;MANAGER&#x27;</span>, <span class="number">7839</span>,  <span class="string">&#x27;1981-05-01&#x27;</span>, <span class="number">2850</span>, <span class="keyword">NULL</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7782</span>, <span class="string">&#x27;CLARK&#x27;</span>, <span class="string">&#x27;MANAGER&#x27;</span>, <span class="number">7839</span>,  <span class="string">&#x27;1981-06-09&#x27;</span>, <span class="number">2450</span>, <span class="keyword">NULL</span>, <span class="number">10</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7788</span>, <span class="string">&#x27;SCOTT&#x27;</span>, <span class="string">&#x27;ANALYST&#x27;</span>, <span class="number">7566</span>,  <span class="string">&#x27;1987-04-19&#x27;</span>, <span class="number">3000</span>, <span class="keyword">NULL</span>, <span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7839</span>, <span class="string">&#x27;KING&#x27;</span>, <span class="string">&#x27;PRESIDENT&#x27;</span>, <span class="keyword">NULL</span>,  <span class="string">&#x27;1981-11-17&#x27;</span>, <span class="number">5000</span>, <span class="keyword">NULL</span>, <span class="number">10</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7844</span>, <span class="string">&#x27;TURNER&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>, <span class="number">7698</span>,  <span class="string">&#x27;1981-09-08&#x27;</span>, <span class="number">1500</span>, <span class="number">0</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7876</span>, <span class="string">&#x27;ADAMS&#x27;</span>, <span class="string">&#x27;CLERK&#x27;</span>, <span class="number">7788</span>,  <span class="string">&#x27;1987-05-23&#x27;</span>, <span class="number">1100</span>, <span class="keyword">NULL</span>, <span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7900</span>, <span class="string">&#x27;JAMES&#x27;</span>, <span class="string">&#x27;CLERK&#x27;</span>, <span class="number">7698</span>,  <span class="string">&#x27;1981-12-03&#x27;</span>, <span class="number">950</span>, <span class="keyword">NULL</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7902</span>, <span class="string">&#x27;FORD&#x27;</span>, <span class="string">&#x27;ANALYST&#x27;</span>, <span class="number">7566</span>,  <span class="string">&#x27;1981-12-03&#x27;</span>, <span class="number">3000</span>, <span class="keyword">NULL</span>, <span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7934</span>, <span class="string">&#x27;MILLER&#x27;</span>, <span class="string">&#x27;CLERK&#x27;</span>, <span class="number">7782</span>,  <span class="string">&#x27;1982-01-23&#x27;</span>, <span class="number">1300</span>, <span class="keyword">NULL</span>, <span class="number">10</span>); </span><br><span class="line"> </span><br><span class="line"><span class="keyword">INSERT INTO</span> SALGRADE ( GRADE, LOSAL, HISAL ) <span class="keyword">VALUES</span> ( <span class="number">1</span>, <span class="number">700</span>, <span class="number">1200</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> SALGRADE ( GRADE, LOSAL, HISAL ) <span class="keyword">VALUES</span> ( <span class="number">2</span>, <span class="number">1201</span>, <span class="number">1400</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> SALGRADE ( GRADE, LOSAL, HISAL ) <span class="keyword">VALUES</span> ( <span class="number">3</span>, <span class="number">1401</span>, <span class="number">2000</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> SALGRADE ( GRADE, LOSAL, HISAL ) <span class="keyword">VALUES</span> ( <span class="number">4</span>, <span class="number">2001</span>, <span class="number">3000</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> SALGRADE ( GRADE, LOSAL, HISAL ) <span class="keyword">VALUES</span> ( <span class="number">5</span>, <span class="number">3001</span>, <span class="number">9999</span>); </span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>什么是sql脚本：文件名是.sql，并且该文件中编写了大量的SQL语句，执行sql脚本程序就相当于批量执行SQL语句。</p>
</li>
<li><p>创建文件：bjpowernode.sql，把以上SQL语句全部复制到sql脚本文件中。</p>
</li>
<li><p>执行SQL脚本文件，初始化数据库</p>
<ul>
<li>第一步：命令窗口登录mysql</li>
<li>第二步：创建数据库bjpowernode（如果之前已经创建就不需要再创建了）：create database bjpowernode;</li>
<li>第三步：使用数据库bjpowernode：use bjpowernode;</li>
<li>第四步：source命令执行sql脚本，注意：source命令后面是sql脚本文件的绝对路径。</li>
<li>第五步：查看是否初始化成功，执行：show tables;</li>
</ul>
</li>
<li><p>使用其他的mysql客户端工具也可以执行sql脚本，比如navicat。使用source命令执行sql脚本的优点：<strong>可支持大文件</strong>。</p>
</li>
</ul>
<h2 id="熟悉测试数据"><a href="#熟悉测试数据" class="headerlink" title="熟悉测试数据"></a>熟悉测试数据</h2><p>查看表结构：desc或describe，语法格式：desc（简写）或describe +表名</p>
<h1 id="第04章-查询DQL专题"><a href="#第04章-查询DQL专题" class="headerlink" title="第04章 查询DQL专题"></a>第04章 查询DQL专题</h1><h2 id="简单查询"><a href="#简单查询" class="headerlink" title="简单查询"></a>简单查询</h2><h3 id="查一个字段"><a href="#查一个字段" class="headerlink" title="查一个字段"></a>查一个字段</h3><p>查询一个字段说的是：一个表有多列，查询其中的一列。<br>语法格式：select 字段名 from 表名;</p>
<ul>
<li>select和from是关键字，不能随便写</li>
<li><strong>一条SQL语句必须以“;”结尾</strong></li>
<li>如果需要关键字做标识符创建，需要加上`关键字&#96;</li>
<li><strong>对于SQL语句来说，大小写都可以</strong></li>
<li>字段名和表名属于标识符（起名字的），按照表的实际情况填写，不知道字段名的，可以使用desc命令查看表结构</li>
</ul>
<p>案例1：查询公司中所有员工编号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno <span class="keyword">from</span> emp; </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316034706352.png" alt="image-20250316034706352"></p>
<p>在mysql命令行客户端中，sql语句没有分号是不会执行的：末尾加上“;”就执行了：</p>
<p>假设一个SQL语句在书写过程中出错了，<strong>怎么终止这条SQL呢？\c</strong></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316034836435.png" alt="image-20250316034836435"></p>
<h3 id="查多个字段"><a href="#查多个字段" class="headerlink" title="查多个字段"></a>查多个字段</h3><p>查询多个字段时，在字段名和字段名之间添加“,”即可。<br>语法格式：select 字段名1,字段名2,字段名3 from 表名;<br>案例1：查询员工编号以及员工姓名。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno, ename <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<h3 id="查所有字段"><a href="#查所有字段" class="headerlink" title="查所有字段"></a>查所有字段</h3><p>查询所有字段的可以将每个字段都列出来查询，也可以采用“*”来代表所有字段<br>案例1：查询员工的所有信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<h4 id="查询时字段可参与数学运算"><a href="#查询时字段可参与数学运算" class="headerlink" title="查询时字段可参与数学运算"></a>查询时字段可参与数学运算</h4><p>在进行查询操作的时候，字段是可以参与数学运算的，例如加减乘除等。<br>案例1：查询每个员工的月薪</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename, sal <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<p>案例2：查询每个员工的年薪（月薪 * 12）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename, sal <span class="operator">*</span> <span class="number">12</span> <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<ul>
<li><input disabled="" type="checkbox"> 任务：查询每个员工月薪加1000之后的年薪</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename, (sal <span class="operator">+</span> <span class="number">1000</span>)<span class="operator">*</span><span class="number">12</span> <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<h3 id="查询时字段可起别名"><a href="#查询时字段可起别名" class="headerlink" title="查询时字段可起别名"></a>查询时字段可起别名</h3><p>as可以省略，但是名字里不能有空格，需要<strong>有空格</strong>的情况就要加单引号</p>
<p>查询<strong>日期</strong>之类的也需要单引号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename, (sal <span class="operator">+</span> <span class="number">1000</span>)<span class="operator">*</span><span class="number">12</span> <span class="keyword">as</span> yearsal <span class="keyword">from</span> emp;<span class="operator">/</span><span class="operator">/</span><span class="keyword">as</span>可以省略，但是名字里不能有空格，需要有空格的情况就要加单引号</span><br><span class="line"><span class="keyword">select</span> empno 员工编号,ename 员工姓名 <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><table>
<thead>
<tr>
<th><strong>条件</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>&#x3D;</td>
<td>等于</td>
</tr>
<tr>
<td>&lt;&gt;或!&#x3D;</td>
<td>不等于</td>
</tr>
<tr>
<td>&gt;&#x3D;</td>
<td>大于等于</td>
</tr>
<tr>
<td>&lt;&#x3D;</td>
<td>小于等于</td>
</tr>
<tr>
<td>&gt;</td>
<td>大于</td>
</tr>
<tr>
<td>&lt;</td>
<td>小于</td>
</tr>
<tr>
<td>between…and…</td>
<td>等同于 &gt;&#x3D; and &lt;&#x3D;</td>
</tr>
<tr>
<td>is null</td>
<td>为空</td>
</tr>
<tr>
<td>is not null</td>
<td>不为空</td>
</tr>
<tr>
<td>&lt;&#x3D;&gt;</td>
<td>安全等于（可读性差，很少使用了）。</td>
</tr>
<tr>
<td>and 或 &amp;&amp;</td>
<td>并且</td>
</tr>
<tr>
<td>or 或 &#124;&#124;</td>
<td>或者</td>
</tr>
<tr>
<td>in</td>
<td>在指定的值当中</td>
</tr>
<tr>
<td>not in</td>
<td>不在指定的值当中</td>
</tr>
<tr>
<td>exists</td>
<td></td>
</tr>
<tr>
<td>not exists</td>
<td></td>
</tr>
<tr>
<td>like</td>
<td>模糊查询</td>
</tr>
</tbody></table>
<h3 id="条件查询语法格式"><a href="#条件查询语法格式" class="headerlink" title="条件查询语法格式"></a>条件查询语法格式</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  过滤条件;</span><br><span class="line">  比如</span><br><span class="line">  <span class="keyword">select</span> job,sal <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="operator">=</span> <span class="string">&#x27;FORD&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>过滤条件放在where子句当中，以上语句的执行顺序是：<br>    第一步：先执行from<br>    第二步：再通过where条件过滤<br>    第三步：最后执行select，查询并将结果展示到控制台;</p>
<h3 id="等于"><a href="#等于" class="headerlink" title="等于 &#x3D;"></a>等于 &#x3D;</h3><p>判断等量关系，支持多种数据类型，比如：数字、字符串、日期等。<br>案例1：查询月薪3000的员工编号及姓名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">  empno,ename</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  sal <span class="operator">=</span> <span class="number">3000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="安全等于（简单了解）"><a href="#安全等于（简单了解）" class="headerlink" title="安全等于（简单了解）"></a>安全等于（简单了解）</h3><p>&lt;&#x3D;&gt;安全等于，用的很少，可读性差</p>
<p>&lt;&#x3D;&gt;安全等于可作为普通运算符&#x3D;</p>
<h3 id="不等于-或"><a href="#不等于-或" class="headerlink" title="不等于 &lt;&gt; 或 !&#x3D;"></a>不等于 &lt;&gt; 或 !&#x3D;</h3><p>案例1：查询工资不是3000的员工编号、姓名、薪资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  empno,ename,sal</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  sal <span class="operator">&lt;&gt;</span> <span class="number">3000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="大于-、大于等于-、小于"><a href="#大于-、大于等于-、小于" class="headerlink" title="大于 &gt;、大于等于 &gt;&#x3D;、小于 &lt;、小于等于 &lt;&#x3D;、and、or"></a>大于 &gt;、大于等于 &gt;&#x3D;、小于 &lt;、小于等于 &lt;&#x3D;、and、or</h3><p>案例：找出薪资大于3000的员工姓名、薪资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">  ename, sal</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  sal <span class="operator">&gt;</span> <span class="number">3000</span>;</span><br></pre></td></tr></table></figure>
<p>and表示并且，还有另一种写法：&amp;&amp;<br>案例：找出薪资大于等于3000并且小于等于5000的员工姓名、薪资。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  ename,sal</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  sal <span class="operator">&gt;=</span> <span class="number">3000</span> <span class="keyword">and</span> sal <span class="operator">&lt;=</span> <span class="number">5000</span>;</span><br></pre></td></tr></table></figure>

<p>or表示或者，还有另一种写法：||<br>案例：找出工作岗位是MANAGER和SALESMAN的员工姓名、工作岗位</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">  ename, job</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span> <span class="keyword">or</span> job <span class="operator">=</span> <span class="string">&#x27;SALESMAN&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="and和or的优先级问题"><a href="#and和or的优先级问题" class="headerlink" title="and和or的优先级问题"></a>and和or的优先级问题</h3><p>and和or同时出现时，and优先级较高，会先执行，如果希望or先执行，这个时候需要给or条件添加小括号。另外，以后遇到不确定的优先级时，可以通过添加小括号的方式来解决。对于优先级问题没必要记忆。<br>案例：找出薪资小于1500，并且部门编号是20或30的员工姓名、薪资、部门编号。<br>先来看一下错误写法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal,deptno <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&lt;</span><span class="number">1500</span> <span class="keyword">and</span> deptno <span class="operator">=</span> <span class="number">20</span> <span class="keyword">or</span> deptno <span class="operator">=</span> <span class="number">30</span>;</span><br></pre></td></tr></table></figure>

<p>这里的意思是找出薪资小于1500并且编号是20的，再或者编号30的，就会输出一些大于1500的人</p>
<p>正确写法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  ename,sal,deptno</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  sal <span class="operator">&lt;</span> <span class="number">1500</span> <span class="keyword">and</span> (deptno <span class="operator">=</span> <span class="number">20</span> <span class="keyword">or</span> deptno <span class="operator">=</span> <span class="number">30</span>);</span><br></pre></td></tr></table></figure>

<h3 id="between…and…"><a href="#between…and…" class="headerlink" title="between…and…"></a>between…and…</h3><p>between…and…等同于 &gt;&#x3D; and &lt;&#x3D;<br>做区间判断的，包含左右两个边界值。<br>它支持数字、日期、字符串等数据类型。<br>between…and…在使用时一定是**左小右大**。左大右小时无法查询到数据。<br>between…and… 和 &gt;&#x3D; and &lt;&#x3D;只是在写法结构上有区别，执行原理和效率方面没有区别。<br>案例：找出薪资在1600到3000的员工姓名、薪资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;=</span> <span class="number">1600</span> <span class="keyword">and</span> sal <span class="operator">&lt;=</span> <span class="number">3000</span>;</span><br><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal bwtween <span class="number">1600</span> <span class="keyword">and</span> <span class="number">3000</span>;<span class="operator">/</span><span class="operator">/</span>使用后</span><br></pre></td></tr></table></figure>

<ul>
<li><input disabled="" type="checkbox"> 任务：查询在1982-01-23到1987-04-19之间入职的员工</li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316234331751.png" alt="image-20250316234331751"></p>
<p>注意：以上SQL语句中日期需要加上单引号。</p>
<h3 id="is-null、is-not-null"><a href="#is-null、is-not-null" class="headerlink" title="is null、is not null"></a>is null、is not null</h3><p>判断某个数据是否为null，不能使用等号，只能使用 is null<br>判断某个数据是否不为null，不能使用不等号，只能使用 is not null<br>在数据库中null不是一个值，不能用等号和不等号衡量，null代表什么也没有，没有数据，没有值</p>
<h4 id="is-null"><a href="#is-null" class="headerlink" title="is null"></a>is null</h4><p>案例1：找出津贴为空的员工姓名、薪资、津贴。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  ename,sal,comm</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  comm <span class="keyword">is</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316235330328.png" alt="image-20250316235330328"></p>
<h4 id="is-not-null"><a href="#is-not-null" class="headerlink" title="is not null"></a>is not null</h4><p>案例2：找出津贴不为空的员工姓名、薪资、津贴</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  ename,sal,comm</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  comm <span class="keyword">is</span> <span class="keyword">not null</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316235403630.png" alt="image-20250316235403630"></p>
<h3 id="in、not-in"><a href="#in、not-in" class="headerlink" title="in、not in"></a>in、not in</h3><h4 id="in"><a href="#in" class="headerlink" title="in"></a>in</h4><p>job in(‘MANAGER’,’SALESMAN’,’CLERK’) 等同于 job &#x3D; ‘MANAGER’ or job &#x3D; ‘SALESMAN’ or job &#x3D; ‘CLERK’<br>sal in(1600, 3000, 5000) 等同于 sal &#x3D; 1600 or sal &#x3D; 3000 or sal &#x3D; 5000<br>in后面有一个小括号，小括号当中有多个值，值和值之间采用逗号隔开<br>sal in(1500, 5000)，需要注意的是：这个并不是说薪资在1500到5000之间，in不代表区间，表示sal是1500的和sal是5000的<br>案例1：找出工作岗位是MANAGER和SALESMAN的员工姓名、薪资、工作岗位<br>第一种：使用or</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  ename,sal,job</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span> <span class="keyword">or</span> job <span class="operator">=</span> <span class="string">&#x27;SALESMAN&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>第二种：使用in</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  ename,sal,job</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  job <span class="keyword">in</span>(<span class="string">&#x27;MANAGER&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>任务：找出部门编号是10和20的员工编号、姓名。（要求使用两种方案）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp <span class="keyword">where</span> deptno<span class="operator">=</span><span class="number">10</span> <span class="keyword">or</span> deptno<span class="operator">=</span><span class="number">20</span>;</span><br><span class="line"><span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp <span class="keyword">where</span> deptno <span class="keyword">in</span>(<span class="number">10</span>,<span class="number">20</span>);</span><br></pre></td></tr></table></figure>

<h4 id="not-in"><a href="#not-in" class="headerlink" title="not in"></a>not in</h4><p>job not in(‘MANAGER’,’SALESMAN’) 等同于 job &lt;&gt; ‘MANAGER’ and job &lt;&gt; ‘SALESMAN’<br>sal not in(1600, 5000) 等同于 sal &lt;&gt; 1600 and sal &lt;&gt; 5000<br>案例：找出工作岗位不是MANAGER和SALESMAN的员工姓名、工作岗位<br>第一种：使用and</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">  ename,job</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  job <span class="operator">&lt;&gt;</span> <span class="string">&#x27;MANAGER&#x27;</span> <span class="keyword">and</span> job <span class="operator">&lt;&gt;</span> <span class="string">&#x27;SALESMAN&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>第二种：使用not in</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">  ename,job</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  job <span class="keyword">not</span> <span class="keyword">in</span>(<span class="string">&#x27;MANAGER&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="in、not-in-与-NULL"><a href="#in、not-in-与-NULL" class="headerlink" title="in、not in 与 NULL"></a>in、not in 与 NULL</h4><p>写这样一条SQL语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> comm <span class="keyword">in</span>(<span class="keyword">NULL</span>, <span class="number">300</span>);</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317001626810.png" alt="image-20250317001626810"></p>
<p>为什么以上执行结果只有一条记录呢？分析一下：</p>
<p>首先你要知道in的执行原理实际上是采用&#x3D;和or的方式，也就是说，以上SQL语句实际上是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> comm <span class="operator">=</span> <span class="keyword">NULL</span> <span class="keyword">or</span> comm <span class="operator">=</span> <span class="number">300</span>;</span><br></pre></td></tr></table></figure>

<p>其中NULL不能用等号&#x3D;进行判断，所以comm &#x3D; NULL结果是false，然而中间使用的是or，所以comm &#x3D; NULL被忽略了。所以查询结果就以上一条数据。<br>通过以上的测试得知：<strong>in是自动忽略NULL的</strong>。</p>
<p>再写这样一条SQL语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> comm <span class="keyword">not</span> <span class="keyword">in</span>(<span class="keyword">NULL</span>, <span class="number">300</span>);</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317145658980.png" alt="image-20250317145658980"></p>
<p>以上的执行结果奇怪了，为什么没有查到任何数据呢？我们分析一下：<br>首先你要知道not in的执行原理实际上是采用&lt;&gt;和and的方式，也就是说，以上SQL语句实际上是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> comm <span class="operator">&lt;&gt;</span> <span class="keyword">NULL</span> <span class="keyword">and</span> comm <span class="operator">&lt;&gt;</span> <span class="number">300</span>;</span><br></pre></td></tr></table></figure>
<p>其中NULL的判断不能使用&lt;&gt;，<strong>所以comm &lt;&gt; NULL结果是false，由于后面是and，and表示并且，comm &lt;&gt; NULL已经是false了，所以and右边的就没必要运算了</strong>，comm &lt;&gt; NULL and comm &lt;&gt; 300的整体运算结果就是false。所以查询不到任何数据。<br>通过以上测试得知，<strong>not in是不会自动忽略NULL的</strong>，所以在使用not in的时候一定要提前过滤掉NULL。</p>
<h3 id="模糊查询like"><a href="#模糊查询like" class="headerlink" title="模糊查询like"></a>模糊查询like</h3><p>模糊查询又被称为模糊匹配，在实际开发中使用较多，比如：查询公司中所有姓张的，查询岗位中带有经理两个字的职位等等，这些都需要使用模糊查询。<br>模糊查询的语法格式如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> .. <span class="keyword">from</span> .. <span class="keyword">where</span> 字段 <span class="keyword">like</span> <span class="string">&#x27;通配符表达式&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>在模糊查询中，通配符主要包括两个：一个是%，一个是下划线_。<br>其中%代表任意多个字符。下划线_代表任意一个字符。</p>
<p>案例1：查询员工名字以’S’开始的员工姓名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;S%&#x27;</span>;s后面有多个字符</span><br></pre></td></tr></table></figure>

<p>案例2：查询员工名字以’T’结尾的员工姓名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;%T&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>案例3：查询员工名字中含有’O’的员工姓名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;%O%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>案例4：查询员工名字中第二个字母是’A’的员工姓名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;_A%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>案例5：查询学员名字中含有下划线的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%_%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317150731785.png" alt="image-20250317150731785"></p>
<p>查询结果不是我们想要的，之所以将所有数据全部显示，因为下划线代表任意单个字符，如果想让这个下划线变成一个普通的下划线字符，就要使用转义字符了，在mysql当中转义字符是“\”，这个和java语言中的转义字符是一样的：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%\_%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317150810743.png" alt="image-20250317150810743"></p>
<h2 id="排序操作"><a href="#排序操作" class="headerlink" title="排序操作"></a>排序操作</h2><p>排序的SQL语法：order by是通过，通过字段排序，asc升序desc降序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> .. <span class="keyword">from</span> .. <span class="keyword">order</span> <span class="keyword">by</span> 字段 <span class="keyword">asc</span><span class="operator">/</span><span class="keyword">desc</span></span><br></pre></td></tr></table></figure>

<h3 id="单一字段升序"><a href="#单一字段升序" class="headerlink" title="单一字段升序"></a>单一字段升序</h3><p>查询员工的编号、姓名、薪资，按照薪资升序排列。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">asc</span>;</span><br></pre></td></tr></table></figure>

<h3 id="单一字段降序"><a href="#单一字段降序" class="headerlink" title="单一字段降序"></a>单一字段降序</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<h3 id="默认采用升序"><a href="#默认采用升序" class="headerlink" title="默认采用升序"></a>默认采用升序</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> sal;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317151546227.png" alt="image-20250317151546227"></p>
<p>查询员工的编号、姓名，按照姓名升序排列。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> ename;</span><br></pre></td></tr></table></figure>

<h3 id="多个字段排序"><a href="#多个字段排序" class="headerlink" title="多个字段排序"></a>多个字段排序</h3><p>查询员工的编号、姓名、薪资，按照薪资升序排列，如果薪资相同的，再按照姓名升序排列。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">asc</span>, ename <span class="keyword">asc</span>;</span><br><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span> <span class="keyword">asc</span>, <span class="number">2</span> <span class="keyword">asc</span>;<span class="operator">/</span><span class="operator">/</span>可读性差，数字表示第几列的意思</span><br></pre></td></tr></table></figure>

<p><strong>逗号靠前的起主导作用，只有相同的才会执行逗号后面的排序语句</strong></p>
<h3 id="where和order-by的位置"><a href="#where和order-by的位置" class="headerlink" title="where和order by的位置"></a>where和order by的位置</h3><p>找出岗位是MANAGER和salesman的员工姓名、工作和年薪，按照薪资降序排列。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,job,sal<span class="operator">*</span><span class="number">12</span> <span class="keyword">as</span> yearsal <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="keyword">in</span>(<span class="string">&#x27;manager&#x27;</span>,<span class="string">&#x27;salesman&#x27;</span>) <span class="keyword">order</span> <span class="keyword">by</span> yearsal <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<p><strong>目前学习过的顺序：先from，再where，再select，再order by</strong></p>
<h2 id="distinct去重"><a href="#distinct去重" class="headerlink" title="distinct去重"></a>distinct去重</h2><p>去除重复记录，只是显示的时候去重，不影响数据库，在字段前添加distinct关键字。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> job <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<p>接下来测试一下，在distinct关键字前添加其它字段是否可以？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename, <span class="keyword">distinct</span> job <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317153208747.png" alt="image-20250317153208747"></p>
<p>报错了，通过测试得知，distinct只能出现在所有字段的最前面。</p>
<p><strong>当distinct出现后，后面多个字段一定是联合去重的</strong>，我们来做两个练习就知道了：</p>
<p>练习1：找出公司中所有的工作岗位</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317153250811.png" alt="image-20250317153250811"></p>
<p>练习2：找出公司中不同部门的不同工作岗位。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317153457101.png" alt="image-20250317153457101"></p>
<h2 id="数据处理函数（单行处理函数）"><a href="#数据处理函数（单行处理函数）" class="headerlink" title="数据处理函数（单行处理函数）"></a>数据处理函数（单行处理函数）</h2><p>关于select语句，我们之前都是这样写：select 字段名 from 表名; 这里的字段名可以看做“变量”，也可以看做常量</p>
<h3 id="字符串相关"><a href="#字符串相关" class="headerlink" title="字符串相关"></a>字符串相关</h3><h4 id="转大写upper和ucase"><a href="#转大写upper和ucase" class="headerlink" title="转大写upper和ucase"></a>转大写upper和ucase</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 查询所有员工名字，以大写形式展现</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">upper</span>(ename) <span class="keyword">as</span> ename <span class="keyword">from</span> emp;</span><br><span class="line"># 查询所有员工姓名，以大写形式展现</span><br><span class="line"><span class="keyword">select</span> ucase(ename) <span class="keyword">as</span> ename <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318010721109.png" alt="image-20250318010721109"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查询员工smith的岗位、薪资（假如你不知道数据库表中的人名是大写、小写还是大小写混合）</span><br><span class="line"><span class="keyword">select</span> ename, job, sal <span class="keyword">from</span> emp <span class="keyword">where</span> <span class="built_in">upper</span>(ename) <span class="operator">=</span> <span class="string">&#x27;SMITH&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318011115152.png" alt="image-20250318011115152"></p>
<h4 id="转小写lower和lcase"><a href="#转小写lower和lcase" class="headerlink" title="转小写lower和lcase"></a>转小写lower和lcase</h4><p><strong>很简单，不再赘述，直接上代码：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 查询员工姓名，以小写形式展现</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">lower</span>(ename) <span class="keyword">as</span> ename <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">select</span> lcase(ename) <span class="keyword">as</span> ename <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<h4 id="截取字符串substr"><a href="#截取字符串substr" class="headerlink" title="截取字符串substr"></a>截取字符串substr</h4><p>语法：substr(‘被截取的字符串’, 起始下标, 截取长度)</p>
<p>有两种写法：<br>第一种：substr(‘被截取的字符串’, 起始下标, 截取长度)<br>第二种：substr(‘被截取的字符串’, 起始下标)，当第三个参数“截取长度”缺失时，截取到字符串末尾<br>注意：起始下标从1开始，不是从0开始。（1表示从左侧开始的第一个位置，-1表示从右侧开始的第一个位置。）</p>
<p>练习：找出员工名字中第二个字母是A的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;_A%&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> substr(ename, <span class="number">2</span>, <span class="number">1</span>) <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318011938360.png" alt="image-20250318011938360"></p>
<h4 id="获取字符串长度length"><a href="#获取字符串长度length" class="headerlink" title="获取字符串长度length"></a>获取字符串长度length</h4><p>统计字节的数量，一个汉字是两个字节</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318012128010.png" alt="image-20250318012128010"></p>
<h4 id="获取字符的个数char-length"><a href="#获取字符的个数char-length" class="headerlink" title="获取字符的个数char_length"></a>获取字符的个数char_length</h4><p>统计字符的数量</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318012205421.png" alt="image-20250318012205421"></p>
<h4 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h4><p>语法：concat(‘字符串1’, ‘字符串2’, ‘字符串3’….)<br>拼接的字符串数量没有限制。</p>
<p>注意：在mysql8之前，双竖线||也是可以完成字符串拼接的。但在mysql8之后，||只作为逻辑运算符，不能再进行字符串拼接了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;abc&#x27;</span> <span class="operator">||</span> <span class="string">&#x27;def&#x27;</span> <span class="operator">||</span> <span class="string">&#x27;xyz&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>mysql8之后，|| 只作为“或者”运算符，例如：找出工资高于3000或者低于900的员工姓名和薪资：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename, sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">3000</span> <span class="operator">||</span> sal <span class="operator">&lt;</span> <span class="number">900</span>;</span><br></pre></td></tr></table></figure>

<h4 id="去除字符串前后空白trim"><a href="#去除字符串前后空白trim" class="headerlink" title="去除字符串前后空白trim"></a>去除字符串前后空白trim</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> concat(<span class="built_in">trim</span>(<span class="string">&#x27;    abc    &#x27;</span>), <span class="string">&#x27;def&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318013135401.png" alt="image-20250318013135401"></p>
<p>默认是去除前后空白，也可以去除指定的前缀后缀，例如：<br>去除前置0</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">trim</span>(<span class="keyword">leading</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">from</span> <span class="string">&#x27;000111000&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318013446513.png" alt="image-20250318013446513"></p>
<p>去除后置0</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">trim</span>(<span class="keyword">trailing</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">from</span> <span class="string">&#x27;000111000&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318013530180.png" alt="image-20250318013530180"></p>
<p>前置0和后置0全部去除</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">trim</span>(<span class="keyword">both</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">from</span> <span class="string">&#x27;000111000&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318013626310.png" alt="image-20250318013626310"></p>
<h3 id="数字相关"><a href="#数字相关" class="headerlink" title="数字相关"></a>数字相关</h3><h4 id="rand-和rand-x"><a href="#rand-和rand-x" class="headerlink" title="rand()和rand(x)"></a>rand()和rand(x)</h4><p>rand()生成0到1的随机浮点数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> rand();</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318013920466.png" alt="image-20250318013920466"></p>
<p>rand(x)生成0到1的随机浮点数，通过指定整数x来确定每次获取到相同的浮点值。<br>也就是给一个固定的值可以永远拿到一个固定随机数</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318014033448.png" alt="image-20250318014033448"></p>
<h4 id="round-x-和round-x-y-四舍五入"><a href="#round-x-和round-x-y-四舍五入" class="headerlink" title="round(x)和round(x,y)四舍五入"></a>round(x)和round(x,y)四舍五入</h4><p>round(x) 四舍五入，保留整数位，舍去所有小数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round(<span class="number">3.54</span>);#返回<span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>round(x,y) 四舍五入，保留y位小数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round(<span class="number">3.55</span>,<span class="number">1</span>);#返回<span class="number">3.6</span></span><br></pre></td></tr></table></figure>

<h4 id="truncate-x-y-舍去"><a href="#truncate-x-y-舍去" class="headerlink" title="truncate(x, y)舍去"></a>truncate(x, y)舍去</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">truncate</span>(<span class="number">9.999</span>,<span class="number">2</span>);#返回<span class="number">9.99</span></span><br></pre></td></tr></table></figure>

<p>以上SQL表示保留两位小数，剩下的全部舍去。</p>
<h4 id="ceil与floor"><a href="#ceil与floor" class="headerlink" title="ceil与floor"></a>ceil与floor</h4><p>数字处理函数除了以上的之外，还有ceil和floor函数：</p>
<ul>
<li>ceil函数：返回大于或等于数值x的最小整数</li>
<li>floor函数：返回小于或等于数值x的最大整数</li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318015708126.png" alt="image-20250318015708126"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318015737077.png" alt="image-20250318015737077"></p>
<h3 id="空处理"><a href="#空处理" class="headerlink" title="空处理"></a>空处理</h3><p>null与任何数进行运算的结果都为null</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318021636300.png" alt="image-20250318021636300"></p>
<p>ifnull(x, y)，空处理函数，当x为NULL时，将x当做y处理。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318021725200.png" alt="image-20250318021725200"></p>
<p>看这样一个需求：查询每个员工的年薪。（年薪 &#x3D; (月薪 + 津贴) * 12个月。注意：有的员工津贴comm是NULL。）</p>
<p>下面这样就可以把null转换成0，就可以正常显示</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal,((sal <span class="operator">+</span> ifnull(comm,<span class="number">0</span>)) <span class="operator">*</span> <span class="number">12</span>) <span class="keyword">as</span> yearsal <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318022223413.png" alt="image-20250318022223413"></p>
<h3 id="日期和时间相关函数"><a href="#日期和时间相关函数" class="headerlink" title="日期和时间相关函数"></a>日期和时间相关函数</h3><h4 id="获取当前日期和时间"><a href="#获取当前日期和时间" class="headerlink" title="获取当前日期和时间"></a>获取当前日期和时间</h4><p>now()和sysdate()的区别：</p>
<ul>
<li>now()：获取的是执行select语句的时刻。（select now()的这个select）</li>
<li>sysdate()：获取的是执行sysdate()函数的时刻。</li>
</ul>
<h4 id="获取当前日期"><a href="#获取当前日期" class="headerlink" title="获取当前日期"></a>获取当前日期</h4><p>获取当前日期有三种写法，掌握任意一种即可：</p>
<ul>
<li>curdate()</li>
<li>current_date()</li>
<li>current_date</li>
</ul>
<h4 id="获取当前时间"><a href="#获取当前时间" class="headerlink" title="获取当前时间"></a>获取当前时间</h4><p>获取档期时间有三种写法，掌握其中一种即可：</p>
<ul>
<li>curtime()</li>
<li>current_time()</li>
<li>current_time</li>
</ul>
<h4 id="获取单独的年、月、日、时、分、秒"><a href="#获取单独的年、月、日、时、分、秒" class="headerlink" title="获取单独的年、月、日、时、分、秒"></a>获取单独的年、月、日、时、分、秒</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">year</span>(now());</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">month</span>(now());</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">day</span>(now());</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">hour</span>(now());</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">minute</span>(now());</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">second</span>(now());</span><br></pre></td></tr></table></figure>

<p>注意：这些函数在使用的时候，需要传递一个日期参数给它，它可以获取到你给定的这个日期相关的年、月、日、时、分、秒的信息。<br>一次性提取一个给定日期的“年月日”部分，可以使用date()函数，例如：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318023616736.png" alt="image-20250318023616736"></p>
<p>一次性提取一个给定日期的“时分秒”部分，可以使用time()函数，例如：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318023628620.png" alt="image-20250318023628620"></p>
<h4 id="date-add函数"><a href="#date-add函数" class="headerlink" title="date_add函数"></a>date_add函数</h4><p>date_add函数的作用：给指定的日期添加间隔的时间，从而得到一个新的日期。<br>date_add函数的语法格式：date_add(日期, interval expr 单位)，例如：</p>
<p>以’2023-01-03’为基准，间隔3天之后的日期：’2023-01-06’</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318024025267.png" alt="image-20250318024025267"></p>
<p>以’2023-01-03’为基准，间隔3个月之后的日期：’2023-04-03’<br>详细解释一下这个函数的相关参数：</p>
<ul>
<li>日期：一个日期类型的数据</li>
<li>interval：关键字，翻译为“间隔”，固定写法</li>
<li>expr：指定具体的间隔量，一般是一个数字。<strong>也可以为负数，如果为负数，效果和date_sub函数相同</strong>。就是减多少天的意思</li>
<li>单位：<ul>
<li>year：年</li>
<li>month：月</li>
<li>day：日</li>
<li>hour：时</li>
<li>minute：分</li>
<li>second：秒</li>
<li>microsecond：微秒（1秒等于1000毫秒，1毫秒等于1000微秒）</li>
<li>week：周</li>
<li>quarter：季度</li>
</ul>
</li>
</ul>
<p>另外，单位也可以采用复合型单位，例如：</p>
<ul>
<li>SECOND_MICROSECOND</li>
<li>MINUTE_MICROSECOND</li>
<li>MINUTE_SECOND：几分几秒之后</li>
<li>HOUR_MICROSECOND</li>
<li>HOUR_SECOND</li>
<li>HOUR_MINUTE：几小时几分之后</li>
<li>DAY_MICROSECOND</li>
<li>DAY_SECOND</li>
<li>DAY_MINUTE</li>
<li>DAY_HOUR：几天几小时之后</li>
<li>YEAR_MONTH：几年几个月之后</li>
</ul>
<p>如果单位采用复合型的话，expr该怎么写呢？假设要表示3年2月之后</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318025104375.png" alt="image-20250318025104375"></p>
<h4 id="date-format日期格式化函数"><a href="#date-format日期格式化函数" class="headerlink" title="date_format日期格式化函数"></a>date_format日期格式化函数</h4><p>将日期转换成具有某种格式的日期字符串，通常用在查询操作当中。（date类型转换成char类型）<br>语法格式：date_format(日期, ‘日期格式’)<br>该函数有两个参数：</p>
<ul>
<li>第一个参数：日期。这个参数就是即将要被格式化的日期。类型是date类型。</li>
<li>第二个参数：指定要格式化的格式字符串。<ul>
<li>%Y：四位年份</li>
<li>%y：两位年份</li>
<li>%m：月份（1..12）</li>
<li>%d：日（1..30）</li>
<li>%H：小时（0..23）</li>
<li>%i：分（0..59）</li>
<li>%s：秒（0..59）</li>
</ul>
</li>
</ul>
<p>例如：获取当前系统时间，让其以这个格式展示：2000-10-11 20:15:30</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318160626788.png" alt="image-20250318160626788"></p>
<p>注意：在mysql当中，默认的日期格式就是：%Y-%m-%d %H:%i:%s，所以当你直接输出日期数据的时候， 底层会自动转换成该格式的字符串：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318160645554.png" alt="image-20250318160645554"></p>
<p>如果是需要展示两位年份，年月日之间用&#x2F;隔开：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal,date_format(hiredate,<span class="string">&#x27;%y/%m/%d&#x27;</span>) <span class="keyword">as</span> hiredate <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318161124364.png" alt="image-20250318161124364"></p>
<h4 id="str-to-date函数"><a href="#str-to-date函数" class="headerlink" title="str_to_date函数"></a>str_to_date函数</h4><p>该函数的作用是将char类型的日期字符串转换成日期类型date，常使用在插入和修改操作当中。（char类型转换成date类型）</p>
<p>我们要给表插入一条数据：姓名zhangsan，生日85年10月1日，执行以下insert语句：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318161819328.png" alt="image-20250318161819328"></p>
<p>错误原因：日期值不正确。意思是：birth字段需要一个日期，你给的这个字符串’10&#x2F;01&#x2F;1985’我识别不了。这种情况下，我们就可以使用str_to_date函数进行类型转换：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318161902772.png" alt="image-20250318161902772"></p>
<p>当然，如果你提供的日期字符串格式能够被mysql解析，str_to_date函数是可以省略的，底层会自动调用该函数进行类型转换：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318161919794.png" alt="image-20250318161919794"></p>
<h4 id="dayofweek、dayofmonth、dayofyear函数"><a href="#dayofweek、dayofmonth、dayofyear函数" class="headerlink" title="dayofweek、dayofmonth、dayofyear函数"></a>dayofweek、dayofmonth、dayofyear函数</h4><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318162215181.png" alt="image-20250318162215181"></p>
<p>意思是现在的周二是一周的第三天（周日是第一天）</p>
<p>dayofweek：一周中的第几天（1<del>7），周日是1，周六是7。<br>dayofmonth：一个月中的第几天（1</del>31）<br>dayofyear：一年中的第几天（1~366）</p>
<h4 id="last-day函数"><a href="#last-day函数" class="headerlink" title="last_day函数"></a>last_day函数</h4><p>获取给定日期所在月的最后一天的日期：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318162509858.png" alt="image-20250318162509858"></p>
<h4 id="datediff函数"><a href="#datediff函数" class="headerlink" title="datediff函数"></a>datediff函数</h4><p>计算两个日期之间所差天数：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318162616711.png" alt="image-20250318162616711"></p>
<h4 id="timediff函数"><a href="#timediff函数" class="headerlink" title="timediff函数"></a>timediff函数</h4><p>计算两个日期所差时间，例如日期1和日期2所差10:20:30，表示差10小时20分钟30秒。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318162654964.png" alt="image-20250318162654964"></p>
<h3 id="if函数"><a href="#if函数" class="headerlink" title="if函数"></a>if函数</h3><p>如果条件为TRUE则返回“YES”，如果条件为FALSE则返回“NO”：类似三目运算符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IF(<span class="number">500</span><span class="operator">&lt;</span><span class="number">1000</span>, &quot;YES&quot;, &quot;NO&quot;);</span><br></pre></td></tr></table></figure>

<p>例如：如果工资高于3000，则输出1，反之则输出0</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal,if(sal<span class="operator">&gt;</span><span class="number">3000</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="keyword">as</span> <span class="keyword">result</span> <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<p>再例如：如果名字是SMITH的，工资上调10%，其他员工工资正常显示。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,if(ename<span class="operator">=</span><span class="string">&#x27;smith&#x27;</span>, sal <span class="operator">*</span> <span class="number">1.1</span>, sal) <span class="keyword">as</span> sal <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<p>再例如：工作岗位是MANAGER的工资上调10%，是SALESMAN的工资上调20%，其他岗位工资正常。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal,job,if(job<span class="operator">=</span><span class="string">&#x27;manager&#x27;</span>, sal<span class="operator">*</span><span class="number">1.1</span>,if(job<span class="operator">=</span><span class="string">&#x27;salesman&#x27;</span>, sal<span class="operator">*</span><span class="number">1.2</span>, sal)) <span class="keyword">as</span> newsal <span class="keyword">from</span> emp;#如果前面的不是manager，后面的if就会执行，去看看是不是salesman，其他的正常</span><br></pre></td></tr></table></figure>

<p>上面这个需求也可以使用：case.. when.. then.. when.. then.. else.. end来完成：类似于Switch</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318171137283.png" alt="image-20250318171137283"></p>
<h3 id="cast函数"><a href="#cast函数" class="headerlink" title="cast函数"></a>cast函数</h3><p>cast函数用于将值从一种数据类型转换为表达式中指定的另一种数据类型<br>语法：cast(值 as 数据类型)<br>例如：cast(‘2020-10-11’ as date)，表示将字符串’2020-10-11’转换成日期date类型。<br>在使用cast函数时，可用的数据类型包括：</p>
<ul>
<li>date：日期类型</li>
<li>time：时间类型</li>
<li>datetime：日期时间类型</li>
<li>signed：有符号的int类型（有符号指的是正数负数）</li>
<li>char：定长字符串类型（varchar是可变长字符串）</li>
<li>decimal：浮点型</li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318184912102.png" alt="image-20250318184912102"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318184918594.png" alt="image-20250318184918594"></p>
<p>保留5位有效数字且有一个小数位，有效数字是不包含0的</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318213501887.png" alt="image-20250318213501887"></p>
<h3 id="加密函数"><a href="#加密函数" class="headerlink" title="加密函数"></a>加密函数</h3><p>md5函数，可以将给定的字符串经过md5算法进行加密处理，字符串经过加密之后会生成一个固定长度32位的字符串，md5加密之后的密文通常是不能解密的：</p>
<h3 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h3><p>具体可以看企业真题</p>
<p>MySQL 8.0及以上版本中支持如下常用的窗口函数：</p>
<ol>
<li><p>ROW_NUMBER()：排名函数，返回当前结果集中每个行的行号；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">asc</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>RANK()：排名函数，计算分组结果中的排名，相同的行排名相同且没有空缺，下一个行排名跳过空缺；</p>
</li>
<li><p>DENSE_RANK()：排名函数，计算分组结果中的排名，相同的行排名相同，排名连续，没有空缺；</p>
</li>
<li><p>NTILE()：将分组结果等分为指定的组数，计算每组的大小；</p>
</li>
<li><p>LAG()：返回分组内前一行的值；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">lag</span>(指定字段) ovar(排序规则)</span><br><span class="line"></span><br><span class="line">例如：<span class="built_in">lag</span>(sal) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">asc</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>LEAD()：返回分组内后一行的值；</p>
<p>语法同上</p>
</li>
<li><p>FIRST_VALUE()：返回分组内第一个值；</p>
</li>
<li><p>LAST_VALUE()：返回分组内最后一个值；</p>
</li>
<li><p>AVG()、SUM()、COUNT()、MIN()、MAX()：聚合函数，可以配合OVER()进行窗口操作。</p>
</li>
</ol>
<p>需要注意的是，MySQL的窗口</p>
<h2 id="分组函数"><a href="#分组函数" class="headerlink" title="分组函数"></a>分组函数</h2><p><strong>分组函数的执行原则：先分组，然后对每一组数据执行分组函数。如果没有分组语句group by的话，整张表的数据自成一组。</strong></p>
<p>前面提到的数据处理函数是单行处理函数，输入一条就输出一条。</p>
<p>分组函数包括五个：（不能用在where后面）</p>
<ul>
<li>max：最大值</li>
<li>min：最小值</li>
<li>avg：平均值</li>
<li>sum：求和</li>
<li>count：计数</li>
</ul>
<h3 id="max"><a href="#max" class="headerlink" title="max"></a>max</h3><p><strong>找出员工的最高薪资</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(sal) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>
<h3 id="min"><a href="#min" class="headerlink" title="min"></a>min</h3><p><strong>找出员工的最低工资</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(sal) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>
<h3 id="avg"><a href="#avg" class="headerlink" title="avg"></a>avg</h3><p><strong>计算员工的平均薪资</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>
<h3 id="sum"><a href="#sum" class="headerlink" title="sum"></a>sum</h3><p><strong>计算员工的工资和</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>
<h4 id="计算员工的津贴之和"><a href="#计算员工的津贴之和" class="headerlink" title="计算员工的津贴之和"></a><strong>计算员工的津贴之和</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(comm) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>
<p>重点：所有的分组函数都是自动忽略NULL的。</p>
<h3 id="count"><a href="#count" class="headerlink" title="count"></a>count</h3><p><strong>统计员工人数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(ename) <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>
<p>count(*)和count(1)的效果一样，统计该组中总记录行数。<br>count(ename)统计的是这个ename字段中不为NULL个数总和。<br>count (*)记录的是所有的数一共有多少行，不会忽略null<br>例如：count(comm) 结果是 4，而不是14</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(comm) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>
<p><strong>统计岗位数量</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> job) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<h3 id="分组函数组合使用"><a href="#分组函数组合使用" class="headerlink" title="分组函数组合使用"></a>分组函数组合使用</h3><p>select count(*),max(sal),min(sal),avg(sal),sum(sal) from emp;</p>
<h3 id="分组函数注意事项"><a href="#分组函数注意事项" class="headerlink" title="分组函数注意事项"></a>分组函数注意事项</h3><p><strong>分组函数不能直接使用在where子句当中</strong></p>
<p>select ename,job from emp where sal &gt; avg(sal); 这个会报错的<br>原因：分组的行为是在where执行之后才开始的。</p>
<h2 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h2><h3 id="group-by"><a href="#group-by" class="headerlink" title="group by"></a>group by</h3><p>按照某个字段分组，或者按照某些字段联合分组。注意：group by的执行是在where之后执行。<br>语法：<br>group by 字段<br>group by 字段1,字段2,字段3….<br><strong>找出每个岗位的平均薪资</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> job, <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> job;</span><br></pre></td></tr></table></figure>

<p><strong>找出每个部门最高工资</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno,<span class="built_in">max</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno;</span><br></pre></td></tr></table></figure>

<p><strong>找出每个部门不同岗位的平均薪资</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno,job,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno,job;</span><br></pre></td></tr></table></figure>

<p><strong>当select语句中有group by的话，select后面只能跟分组函数或参加分组的字段</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,deptno,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno; <span class="operator">/</span><span class="operator">/</span> 这个<span class="keyword">SQL</span>多了个ename，执行后会报错。</span><br></pre></td></tr></table></figure>

<h3 id="having"><a href="#having" class="headerlink" title="having"></a>having</h3><p>having写在group by的后面，如果不合group by一起用会报错，当你对分组之后的数据不满意，可以继续通过<strong>having对分组之后的数据进行过滤</strong>。<br><strong>where的过滤是在分组前进行过滤。</strong><br><strong>使用原则：尽量在where中过滤，实在不行，再使用having。越早过滤效率越高。</strong></p>
<p>*<em>找出除20部分之外，其它部门的平均薪资。</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">where</span> deptno<span class="operator">&lt;&gt;</span><span class="number">20</span> <span class="keyword">group</span> <span class="keyword">by</span> deptno; <span class="operator">/</span><span class="operator">/</span> 建议</span><br><span class="line"><span class="keyword">select</span> deptno,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno <span class="keyword">having</span> deptno <span class="operator">&lt;&gt;</span> <span class="number">20</span>; <span class="operator">/</span><span class="operator">/</span> 不建议</span><br></pre></td></tr></table></figure>

<p><strong>查询每个部门平均薪资，找出平均薪资高于2000的。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno <span class="keyword">having</span> <span class="built_in">avg</span>(sal) <span class="operator">&gt;</span> <span class="number">2000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="组内排序"><a href="#组内排序" class="headerlink" title="组内排序"></a>组内排序</h3><p>案例：找出每个工作岗位的工资排名在前两名的。<br>substring_index函数的使用：也就是截到点出现的第几次</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319030731267.png" alt="image-20250319030731267"></p>
<p>group_concat函数的使用：字符串拼接，分组后对每一组的empno进行拼接</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319031020846.png" alt="image-20250319031020846"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> substring_index(group_concat(empno <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span>), <span class="string">&#x27;,&#x27;</span>, <span class="number">2</span>) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> job;</span><br></pre></td></tr></table></figure>

<h3 id="MySQL行转列"><a href="#MySQL行转列" class="headerlink" title="MySQL行转列"></a>MySQL行转列</h3><p>MySQL行转列又叫做<strong>数据透视</strong>。什么叫做行转列？将原本横向排列的数据透视成纵向排列的数据，进而进行计算、分析、展示等操作。</p>
<p>使用case when+group by完成</p>
<p>例子可以看企业真题</p>
<h2 id="总结单表的DQL语句"><a href="#总结单表的DQL语句" class="headerlink" title="总结单表的DQL语句"></a>总结单表的DQL语句</h2><p>select …5<br>from …1<br>where …2<br>group by …3<br>having …4<br>order by …6<br>重点掌握一个完整的DQL语句执行顺序。</p>
<h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><h3 id="什么是连接查询"><a href="#什么是连接查询" class="headerlink" title="什么是连接查询"></a>什么是连接查询</h3><ol>
<li>从一张表中查询数据称为单表查询。</li>
<li>从两张或更多张表中联合查询数据称为多表查询，又叫做连接查询。</li>
<li>什么时候需要使用连接查询？<ol>
<li>比如这样的需求：员工表中有员工姓名，部门表中有部门名字，要求查询每个员工所在的部门名字，这个时候就需要连接查询。</li>
</ol>
</li>
</ol>
<h3 id="连接查询的分类"><a href="#连接查询的分类" class="headerlink" title="连接查询的分类"></a>连接查询的分类</h3><ol>
<li>根据语法出现的年代进行分类：<ol>
<li>SQL92（这种语法很少用，可以不用学。）</li>
<li>SQL99（我们主要学习这种语法。）</li>
</ol>
</li>
<li>根据连接方式的不同进行分类：<ol>
<li>内连接<ol>
<li>等值连接</li>
<li>非等值连接</li>
<li>自连接</li>
</ol>
</li>
<li>外连接<ol>
<li>左外连接（左连接）</li>
<li>右外连接（右连接）</li>
</ol>
</li>
<li>全连接</li>
</ol>
</li>
</ol>
<h3 id="笛卡尔积现象"><a href="#笛卡尔积现象" class="headerlink" title="笛卡尔积现象"></a>笛卡尔积现象</h3><ol>
<li>当两张表进行连接查询时，如果没有任何条件进行过滤，最终的查询结果条数是两张表条数的乘积。为了避免笛卡尔积现象的发生，需要添加条件进行筛选过滤。</li>
<li>需要注意：添加条件之后，虽然避免了笛卡尔积现象，但是匹配的次数没有减少。</li>
<li>为了SQL语句的可读性，为了执行效率，建议给表起别名。</li>
</ol>
<p>例子：拿员工姓名和部门名称做连接</p>
<p>emp e是给emp表起个别名叫e，然后e的ename</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319160438060.png" alt="image-20250319160438060"></p>
<p>只能拿员工名字与四个部门名挨个匹配，员工14个与部门4个不能直接去连</p>
<h3 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h3><h4 id="什么叫内连接"><a href="#什么叫内连接" class="headerlink" title="什么叫内连接"></a>什么叫内连接</h4><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319164759300.png" alt="image-20250319164759300"></p>
<p>满足条件的记录才会出现在结果集中。</p>
<h4 id="内连接之等值连接"><a href="#内连接之等值连接" class="headerlink" title="内连接之等值连接"></a>内连接之等值连接</h4><p>连接时，条件为等量关系。<br>案例：查询每个员工所在的部门名称，要求显示员工名、部门名。</p>
<p>emp取名e，dept取名d，join是连接，on加条件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">	e.ename,d.dname</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">	emp e</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span></span><br><span class="line">	dept d</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">	e.deptno <span class="operator">=</span> d.deptno;</span><br><span class="line">如果要找工资大于<span class="number">2000</span>的在后面加上<span class="keyword">where</span>就可以</span><br><span class="line"><span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">2000</span>;</span><br></pre></td></tr></table></figure>

<p>注意：inner可以省略。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319170439319.png">‘</p>
<h4 id="内连接之非等值连接"><a href="#内连接之非等值连接" class="headerlink" title="内连接之非等值连接"></a>内连接之非等值连接</h4><p>连接时，条件是非等量关系。<br>案例：查询每个员工的工资等级，要求显示员工名、工资、工资等级。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">	e.ename,e.sal,s.grade</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">	emp e</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">	salgrade s</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">	e.sal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;</span><br><span class="line">#e的工资介于s的最高和最低之间的,注意小的要在前面</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319171435310.png" alt="image-20250319171435310"></p>
<h4 id="内连接之自连接"><a href="#内连接之自连接" class="headerlink" title="内连接之自连接"></a>内连接之自连接</h4><p>连接时，一张表看做两张表，自己和自己进行连接。<br>案例：找出每个员工的直属领导，要求显示员工名、领导名。</p>
<p>必须把等量关系先思考清楚：员工.领导编号 &#x3D; 领导.员工编号，分成两个表，等于就把他们放在一起</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.ename 员工, l.ename 领导 <span class="keyword">from</span> emp e <span class="keyword">join</span> emp l <span class="keyword">on</span> e.mgr <span class="operator">=</span> l.empno;</span><br></pre></td></tr></table></figure>

<h3 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h3><h4 id="什么叫外连接"><a href="#什么叫外连接" class="headerlink" title="什么叫外连接"></a>什么叫外连接</h4><p>内连接是满足条件的记录查询出来。也就是两张表的交集。<br>外连接是除了满足条件的记录查询出来，再将其中一张表的记录全部查询出来，另一张表如果没有与之匹配的记录，自动模拟出NULL与其匹配。<br>左外连接：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319233111561.png" alt="image-20250319233111561"></p>
<p>右外连接：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319233118741.png" alt="image-20250319233118741"></p>
<h4 id="外连接之左外连接（左连接）"><a href="#外连接之左外连接（左连接）" class="headerlink" title="外连接之左外连接（左连接）"></a>外连接之左外连接（左连接）</h4><p>案例：查询所有部门信息，并且找出每个部门下的员工。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.ename,d.dname <span class="keyword">from</span> emp e <span class="keyword">join</span> dept d <span class="keyword">on</span> e.deptno <span class="operator">=</span> d.deptno;</span><br><span class="line">#这是内连接</span><br><span class="line">#把ename和dname改成<span class="operator">*</span>就可以显示所有信息</span><br><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>,d.<span class="operator">*</span> <span class="keyword">from</span> emp e <span class="keyword">join</span> dept d <span class="keyword">on</span> e.deptno <span class="operator">=</span> d.deptno;</span><br></pre></td></tr></table></figure>

<p>如果要把inner join右边的全显示就是右外连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>,d.<span class="operator">*</span> <span class="keyword">from</span> emp e <span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> dept d <span class="keyword">on</span> e.deptno <span class="operator">=</span> d.deptno;</span><br></pre></td></tr></table></figure>

<p>如果把上面的改成左外连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>,d.<span class="operator">*</span> <span class="keyword">from</span> dept d <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> emp e <span class="keyword">on</span> e.deptno <span class="operator">=</span> d.deptno;</span><br></pre></td></tr></table></figure>

<p>注意：outer可以省略。<br>任何一个左连接都可以写作右连接。</p>
<p>案例：找出所有员工的上级领导，要求显示员工名和领导名。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.ename 员工,l.ename 领导 <span class="keyword">from</span> emp e <span class="keyword">left</span> <span class="keyword">join</span> emp l <span class="keyword">on</span> e.mgr<span class="operator">=</span>l.empno;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250320000335238.png" alt="image-20250320000335238"></p>
<h4 id="外连接之右外连接（右连接）"><a href="#外连接之右外连接（右连接）" class="headerlink" title="外连接之右外连接（右连接）"></a>外连接之右外连接（右连接）</h4><p>看上面</p>
<h3 id="全连接"><a href="#全连接" class="headerlink" title="全连接"></a>全连接</h3><p>什么是全连接？<br>MySQL不支持full join。oracle数据库支持。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250320002801394.png" alt="image-20250320002801394"></p>
<h3 id="多张表连接"><a href="#多张表连接" class="headerlink" title="多张表连接"></a>多张表连接</h3><p>三张表甚至更多张表如何进行表连接<br>案例：找出每个员工的部门，并且要求显示每个员工的薪资等级。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line"> e.ename,d.dname,s.grade </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line"> emp e </span><br><span class="line"><span class="keyword">join</span>#上下两张表关联 </span><br><span class="line"> dept d </span><br><span class="line"><span class="keyword">on</span> #关联条件</span><br><span class="line"> e.deptno <span class="operator">=</span> d.deptno </span><br><span class="line"><span class="keyword">join</span> #继续关联</span><br><span class="line"> salgrade s </span><br><span class="line"><span class="keyword">on</span> </span><br><span class="line"> e.sal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;</span><br></pre></td></tr></table></figure>

<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><h3 id="什么是子查询"><a href="#什么是子查询" class="headerlink" title="什么是子查询"></a>什么是子查询</h3><ol>
<li>select语句中嵌套select语句就叫做子查询。</li>
<li>select语句可以嵌套在哪里？<ol>
<li>where后面、from后面、select后面都是可以的。</li>
</ol>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ..(<span class="keyword">select</span>)..</span><br><span class="line"><span class="keyword">from</span> ..(<span class="keyword">select</span>)..</span><br><span class="line"><span class="keyword">where</span> ..(<span class="keyword">select</span>)..</span><br></pre></td></tr></table></figure>

<h3 id="where后面使用子查询"><a href="#where后面使用子查询" class="headerlink" title="where后面使用子查询"></a>where后面使用子查询</h3><p>案例：找出高于平均薪资的员工姓名和薪资。<br>错误的示范：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="built_in">avg</span>(sal);</span><br></pre></td></tr></table></figure>

<p>错误原因：where后面不能直接使用分组函数。<br>可以使用子查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#第一步：找出平均薪资</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp;#返回了<span class="number">2073.214286</span></span><br><span class="line">#第二步：找出高于平均薪资的员工</span><br><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">2073.214286</span>;</span><br><span class="line">#两个结合起来就可以了，后面的平均薪资替换上</span><br><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> (<span class="keyword">select</span> <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp);</span><br></pre></td></tr></table></figure>

<h3 id="from后面使用子查询"><a href="#from后面使用子查询" class="headerlink" title="from后面使用子查询"></a>from后面使用子查询</h3><p>小窍门：from后面的子查询可以看做一张临时表。<br>案例：找出每个部门的平均工资的等级。<br>第一步：先找出每个部门平均工资。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno, <span class="built_in">avg</span>(sal) avgsal <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250320013321290.png" alt="image-20250320013321290"></p>
<p>第二步：将以上查询结果当做临时表t，t表和salgrade表进行连接查询。条件：t.avgsal between s.losal and s.hisal</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> salgrade;#是salgrade表</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> t.<span class="operator">*</span>,s.grade <span class="keyword">from</span> t <span class="keyword">join</span> salgrade s <span class="keyword">on</span> t.avgsal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;#把salgrade当做s表，然后t的avgsal去进行对比，不过这里会报错，因为没有表t，就直接把上面的代码复制进去就行</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> t.<span class="operator">*</span>,s.grade <span class="keyword">from</span> (<span class="keyword">select</span> deptno, <span class="built_in">avg</span>(sal) avgsal <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno) t <span class="keyword">join</span> salgrade s <span class="keyword">on</span> t.avgsal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;</span><br></pre></td></tr></table></figure>

<h3 id="select后面使用子查询"><a href="#select后面使用子查询" class="headerlink" title="select后面使用子查询"></a>select后面使用子查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.ename,(<span class="keyword">select</span> d.dname <span class="keyword">from</span> dept d <span class="keyword">where</span> e.deptno <span class="operator">=</span> d.deptno) <span class="keyword">as</span> dname <span class="keyword">from</span> emp e;</span><br></pre></td></tr></table></figure>

<h3 id="exists、not-exists"><a href="#exists、not-exists" class="headerlink" title="exists、not exists"></a>exists、not exists</h3><p>在 MySQL 数据库中，EXISTS（存在）用于检查子查询的查询结果行数是否大于0。如果子查询的查询结果行数大于0，则 EXISTS 条件为真。（即存在查询结果则是true。）</p>
<p>主要应用场景：</p>
<ul>
<li>EXISTS 可以与 SELECT、UPDATE、DELETE 一起使用，用于检查另一个查询是否返回任何行；</li>
<li>EXISTS 可以用于验证条件子句中的表达式是否存在；</li>
<li>EXISTS 常用于子查询条件过滤，例如查询有订单的用户等。</li>
</ul>
<p>在另一个文档里给出了创建数据库的代码。</p>
<p>现在我们来看一个简单的案例，假设我们要查询先前有过订单的顾客，而订单信息保存在 t_order 表中，顾客信息保存在 t_customer 表中。我们可以使用以下 sql 语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#用<span class="keyword">in</span>去实现</span><br><span class="line"><span class="keyword">select</span> customer_id <span class="keyword">from</span> t_order;#是查询顾客里订单的id</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> custome_id <span class="keyword">from</span> t_order;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> customer_id <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> customer_id <span class="keyword">from</span> t_order);</span><br><span class="line"></span><br><span class="line">#用<span class="keyword">exists</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer c <span class="keyword">where</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_order o <span class="keyword">where</span> o.customer_id<span class="operator">=</span>c.customer_id);</span><br><span class="line"></span><br><span class="line">#用<span class="keyword">not</span> <span class="keyword">exists</span>这里就会返回为<span class="literal">false</span>的，也就是不相等的结果</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer c <span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_order o <span class="keyword">where</span> o.customer_id<span class="operator">=</span>c.customer_id);</span><br></pre></td></tr></table></figure>

<p>exists后面的子查询如果是为true，就可以去查询符合条件的</p>
<h3 id="in和exists区别（可能面试）"><a href="#in和exists区别（可能面试）" class="headerlink" title="in和exists区别（可能面试）"></a>in和exists区别（可能面试）</h3><p>IN 和 EXISTS 都是用于关系型数据库查询的操作符。不同之处在于：</p>
<ol>
<li>IN 操作符是根据指定列表中的值来判断是否满足条件，而 EXISTS 操作符则是根据子查询的结果是否有返回记录集来判断。 </li>
<li>in的前面有字段名，然后会把小括号里的值一个一个进行判断，exists前面没有字段名，根据整个结果的返回值判断</li>
<li>EXISTS 操作符通常比 IN 操作符更快，尤其是在子查询返回记录数很大的情况下。因为 EXISTS 只需要判断是否存在符合条件的记录，而 IN 操作符需要比对整个列表，因此执行效率相对较低。 </li>
<li>IN 操作符可同时匹配多个<strong>值</strong>，而 EXISTS 只能匹配一组<strong>条件</strong>。</li>
</ol>
<h2 id="union-union-all"><a href="#union-union-all" class="headerlink" title="union&amp;union all"></a>union&amp;union all</h2><p>不管是union还是union all都可以将两个查询结果集进行合并。<br>union会对合并之后的查询结果集进行去重操作。<br>union all是直接将查询结果集合并，不进行去重操作。（union all和union都可以完成的话，优先选择union all，union all因为不需要去重，所以效率高一些。）</p>
<p>案例：查询工作岗位是MANAGER和SALESMAN的员工。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> job<span class="operator">=</span><span class="string">&#x27;MANAGER&#x27;</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> job<span class="operator">=</span><span class="string">&#x27;SALESMAN&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>以上案例采用or也可以完成，那or和union all有什么区别？考虑走索引优化之类的选择union all，其它选择or。</strong></p>
<p>两个结果集合并时，列数量要相同：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250320024021757.png" alt="image-20250320024021757"></p>
<h2 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h2><ol>
<li>limit作用：查询第几条到第几条的记录。通常是因为表中数据量太大，需要分页显示。</li>
<li>limit语法格式：<ol>
<li>limit 开始下标, 长度</li>
</ol>
</li>
<li>案例：查询员工表前5条记录</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp limit <span class="number">0</span>, <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>如果下标是从0开始，可以简写为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp limit <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>查询工资排名在前5名的员工（limit是在order by执行之后才会执行的）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span> limit <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>通用的分页sql</li>
</ol>
<p>假设每页显示3条记录：pageSize &#x3D; 3<br>第1页：limit 0, 3<br>第2页：limit 3, 3<br>第3页：limit 6, 3<br>第pageNo页：limit (pageNo - 1)*pageSize, pageSize</p>
<p>pageNo就是当前页，-1获得上一页，然后乘页需要的数量</p>
<h2 id="35个DQL练手题"><a href="#35个DQL练手题" class="headerlink" title="35个DQL练手题"></a>35个DQL练手题</h2><h1 id="第05章-表相关"><a href="#第05章-表相关" class="headerlink" title="第05章 表相关"></a>第05章 表相关</h1><h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> 表名(</span><br><span class="line">  字段名<span class="number">1</span> 数据类型,</span><br><span class="line">  字段名<span class="number">2</span> 数据类型,</span><br><span class="line">  字段名<span class="number">3</span> 数据类型,</span><br><span class="line">  ......</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>例如：创建学生表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_student(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">10</span>),</span><br><span class="line">  gender <span class="type">char</span>(<span class="number">1</span>) <span class="keyword">default</span> <span class="string">&#x27;男&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h2><p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> 表名(字段名<span class="number">1</span>, 字段名<span class="number">2</span>, 字段名<span class="number">3</span>,......) <span class="keyword">values</span> (值<span class="number">1</span>,值<span class="number">2</span>,值<span class="number">3</span>,......);</span><br></pre></td></tr></table></figure>

<p>字段名和值要一一对应。类型要一一对应，数量要一一对应。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> t_user(<span class="keyword">no</span>,name,gender) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;男&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>只要插入成功就会让数据多一行</p>
<p>字段名也可以省略，如果字段名省略就表示把所有字段名都写上去了，并且顺序和建表时的顺序相同。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> t_user <span class="keyword">values</span>(<span class="number">6</span>,<span class="string">&#x27;zhaoliu&#x27;</span>,<span class="string">&#x27;男&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h2><p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> 表名;</span><br></pre></td></tr></table></figure>

<p>判断是否存在这个表，如果存在则删除。避免不存在时的报错。</p>
<h2 id="MySQL数据类型"><a href="#MySQL数据类型" class="headerlink" title="MySQL数据类型"></a>MySQL数据类型</h2><p>MySQL 的数据类型可以分为整数类型、浮点数类型、定点数类型、日期和时间类型、字符串类型、二进制类型等。</p>
<h3 id="整数类型"><a href="#整数类型" class="headerlink" title="整数类型"></a>整数类型</h3><p>tinyint：1个字节（微小整数）<br>smallint：2个字节（小整数）<br>mediumint：3个字节（中等大小的整数）<br><strong>int（integer）：4个字节（普通大小整数）</strong><br><strong>bigint：8个字节（大整数）</strong></p>
<h3 id="浮点数类型"><a href="#浮点数类型" class="headerlink" title="浮点数类型"></a>浮点数类型</h3><p>float：4个字节，单精度（最多5位小数）<br><strong>double：8个字节，双精度（最多16位小数）</strong></p>
<h3 id="定点数类型"><a href="#定点数类型" class="headerlink" title="定点数类型"></a>定点数类型</h3><p>decimal：定点数类型。底层实际上采用字符串的形式存储数字。<br>语法：decimal(m, d)<br>例如：decimal(3, 2) 表示3个有效数字，2个小数。（有效数字最多65个，小数位最多30个）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#比如在创表的时候写上a <span class="type">decimal</span>(<span class="number">3</span>,<span class="number">2</span>)</span><br><span class="line">#然后插入数据</span><br><span class="line"><span class="keyword">insert into</span> xxx(a) <span class="keyword">values</span>(<span class="number">10</span>);#<span class="number">10</span>要是保存就是<span class="number">10.00</span>，会超出<span class="number">3</span>有效数字</span><br><span class="line"><span class="keyword">insert into</span> xxx(a) <span class="keyword">values</span>(<span class="number">1.123456789</span>);#这里的小数会四舍五入<span class="number">1.12</span></span><br></pre></td></tr></table></figure>

<h3 id="日期和时间类型"><a href="#日期和时间类型" class="headerlink" title="日期和时间类型"></a>日期和时间类型</h3><p>year：1个字节，只存储年，格式YYYY<br>time：3个字节，只存储时间，格式HH:MM:SS &#x2F; HHMMSS<br>date：3个字节，只存储年月日，格式：YYYY-MM-DD<br>datetime：8个字节，存储年月日+时分秒，格式：YYYY-MM-DD HH:MM:SS（从公元1000年<del>公元9999年）<br>timestamp：4个字节，存储年月日+时分秒，格式：YYYY-MM-DD HH:MM:SS（从公元1980年</del>公元2040年）或者格式为 YYYYMMDDHHMMSS（采用这种格式不需要使用单引号，当然你使用单引号也可以）</p>
<h3 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h3><h4 id="char"><a href="#char" class="headerlink" title="char"></a>char</h4><p>**char(m)：**m长度是0~255个字符</p>
<p>固定长度字符串，在定义时指定字符串列长。当保存时，在右侧填充空格以达到指定的长度。插入的字符长度大于给定的就会报错</p>
<h4 id="varchar"><a href="#varchar" class="headerlink" title="varchar"></a>varchar</h4><p>**varchar(m)：**m长度是0~16383个字符<br>长度可变的字符串。varchar 的最大实际长度由最长的行的大小和使用的字符集确定，而实际占用的空间为字符串的实际长度加 1。</p>
<p>例如，varchar(50) 定义了一个最大长度为 50 的字符串，如果插入的字符串只有 10 个字符，<strong>则实际存储的字符串为 10 个字符和一个字符串结束字符</strong>。varchar在值保存和检索时尾部的空格仍保留。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250320162314858.png" alt="image-20250320162314858"></p>
<h4 id="text"><a href="#text" class="headerlink" title="text"></a>text</h4><p><strong>text类型：</strong></p>
<ul>
<li>tinytext 表示长度为 255字符的 TEXT 列。</li>
<li>text 表示长度为 65535字符的 TEXT 列。</li>
<li>mediumtext 表示长度为 16777215字符的 TEXT 列。</li>
<li>longtext 表示长度为 4294967295 或 4GB 字符的 TEXT 列。</li>
</ul>
<h4 id="enum"><a href="#enum" class="headerlink" title="enum"></a>enum</h4><p>这个和下面的set都是输入的值只能是规定的那几个</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_data_type08(</span><br><span class="line">season enum(<span class="string">&#x27;spring&#x27;</span>,<span class="string">&#x27;summer&#x27;</span>)#插入时就只能插其中的一个</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>enum类型：</strong></p>
<ul>
<li>语法：&lt;字段名&gt; enum(‘值1’,’值2’,…)</li>
<li>该字段插入值时，只能是指定的枚举值。</li>
</ul>
<h4 id="set"><a href="#set" class="headerlink" title="set"></a>set</h4><p><strong>set类型：</strong></p>
<ul>
<li>语法：&lt;字段名&gt; set(‘值1’,’值2’,’值3’,…)   注意：值不可重复。</li>
<li>该字段插入值时，只能是指定的值。</li>
</ul>
<h3 id="二进制类型"><a href="#二进制类型" class="headerlink" title="二进制类型"></a>二进制类型</h3><p>BLOB类型：二进制大对象，可以存储图片、声音、视频等文件。</p>
<ul>
<li>blob：小的，最大长度65535个字节</li>
<li>mediumblob：中等的，最大长度16777215个字节</li>
<li>longblob：大的，最大长度4GB的字节</li>
</ul>
<h2 id="增删改表结构DDL"><a href="#增删改表结构DDL" class="headerlink" title="增删改表结构DDL"></a>增删改表结构DDL</h2><h3 id="创建一个学生表"><a href="#创建一个学生表" class="headerlink" title="创建一个学生表"></a>创建一个学生表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_student(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">bigint</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  age <span class="type">int</span> comment <span class="string">&#x27;年龄&#x27;</span>#comment是注释的意思</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="查看建表语句"><a href="#查看建表语句" class="headerlink" title="查看建表语句"></a>查看建表语句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create table</span> 表名;</span><br></pre></td></tr></table></figure>

<h3 id="修改表名"><a href="#修改表名" class="headerlink" title="修改表名"></a>修改表名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 rename 新表名;</span><br></pre></td></tr></table></figure>

<h3 id="新增字段"><a href="#新增字段" class="headerlink" title="新增字段"></a>新增字段</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 <span class="keyword">add</span> 字段名 数据类型;</span><br></pre></td></tr></table></figure>

<h3 id="修改字段名"><a href="#修改字段名" class="headerlink" title="修改字段名"></a>修改字段名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 change 旧字段名 新字段名 数据类型;</span><br></pre></td></tr></table></figure>

<h3 id="修改字段数据类型"><a href="#修改字段数据类型" class="headerlink" title="修改字段数据类型"></a>修改字段数据类型</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 modify <span class="keyword">column</span> 字段名 数据类型;</span><br></pre></td></tr></table></figure>

<h3 id="删除字段"><a href="#删除字段" class="headerlink" title="删除字段"></a>删除字段</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 <span class="keyword">drop</span> 字段名;</span><br></pre></td></tr></table></figure>

<h2 id="DML语句"><a href="#DML语句" class="headerlink" title="DML语句"></a>DML语句</h2><p>当我们对表中的数据进行增删改的时候，称它为DML语句。（数据操纵语言），主要包括：insert、delete、update</p>
<h3 id="insert-增"><a href="#insert-增" class="headerlink" title="insert 增"></a>insert 增</h3><p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> 表名(字段名<span class="number">1</span>,字段名<span class="number">2</span>,字段名<span class="number">3</span>,...) <span class="keyword">values</span>(值<span class="number">1</span>,值<span class="number">2</span>,值<span class="number">3</span>,...);</span><br></pre></td></tr></table></figure>

<p>表名后面的小括号当中的字段名如果省略掉，表示自动将所有字段都列出来了，并且字段的顺序和建表时的顺序一致。<br>一般为了可读性强，建议把字段名写上。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> 表名 <span class="keyword">values</span>(值<span class="number">1</span>,值<span class="number">2</span>,值<span class="number">3</span>,...);</span><br></pre></td></tr></table></figure>

<p>一次可以插入多条记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> t_stu(<span class="keyword">no</span>,name,age) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;jack&#x27;</span>,<span class="number">20</span>),(<span class="number">2</span>,<span class="string">&#x27;lucy&#x27;</span>,<span class="number">30</span>);</span><br></pre></td></tr></table></figure>

<h3 id="delete-删"><a href="#delete-删" class="headerlink" title="delete 删"></a>delete 删</h3><p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 将所有记录全部删除</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名;</span><br><span class="line"></span><br><span class="line"># 删除符合条件的记录</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件;</span><br></pre></td></tr></table></figure>

<p>以上的删除属于DML的方式删除，这种删除的数据是可以通过事务回滚的方式重新恢复的，但是删除的效率较低。（这种删除是支持事务的。）<br>另外还有一种删除表中数据的方式，但是这种方式不支持事务，不可以回滚，删了之后数据是永远也找不回来了。这种删除叫做：表被截断。<br>注意：这个语句删除效率非常高，巨大的表，瞬间干掉所有数据。但不可恢复。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#这种删除不属于dml操作</span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></table></figure>

<h3 id="update-改"><a href="#update-改" class="headerlink" title="update 改"></a>update 改</h3><p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> 表名 <span class="keyword">set</span> 字段名<span class="number">1</span><span class="operator">=</span>值<span class="number">1</span>, 字段名<span class="number">2</span><span class="operator">=</span>值<span class="number">2</span>, 字段名<span class="number">3</span><span class="operator">=</span>值<span class="number">3</span> <span class="keyword">where</span> 条件;</span><br></pre></td></tr></table></figure>

<p>如果没有更新条件的话，所有记录全部更新。</p>
<h2 id="约束constraint"><a href="#约束constraint" class="headerlink" title="约束constraint"></a>约束constraint</h2><p>创建表时，可以给表的字段添加约束，可以保证数据的完整性、有效性。比如大家上网注册用户时常见的：用户名不能为空。对不起，用户名已存在。等提示信息。<br>约束通常包括：</p>
<ul>
<li>非空约束：not null</li>
<li>检查约束：check</li>
<li>唯一性约束：unique</li>
<li>主键约束：primary key</li>
<li>外键约束：foreign key</li>
</ul>
<h3 id="非空约束"><a href="#非空约束" class="headerlink" title="非空约束"></a>非空约束</h3><p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_stu(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">not null</span>,</span><br><span class="line">  age <span class="type">int</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>name字段不能为空。插入数据时如果没有给name指定值，则报错。</p>
<h3 id="检查约束"><a href="#检查约束" class="headerlink" title="检查约束"></a>检查约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_stu(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  age <span class="type">int</span>,</span><br><span class="line">  <span class="keyword">check</span>(age <span class="operator">&gt;</span> <span class="number">18</span>)#大于<span class="number">18</span>岁的才可以插入</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="唯一性约束"><a href="#唯一性约束" class="headerlink" title="唯一性约束"></a>唯一性约束</h3><p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_stu(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  email <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">unique</span>#如果里面有重复的就不能插入了</span><br><span class="line">  email <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">unique</span> <span class="keyword">not null</span>#就是不能重复也不能为空</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>email字段设置为唯一性，唯一性的字段值是可以为NULL的。但不能重复。以上在字段后面添加的约束，叫做列级约束。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_stu(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  email <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  <span class="keyword">unique</span>(email)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>使用表级约束可以为多个字段添加联合唯一。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_stu(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  email <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  <span class="keyword">unique</span>(name,email)#如果name和email都一样就不行，任意一个一样可以</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>创建约束时也可以给约束起名字，将来可以通过约束的名字来删除约束：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_stu(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  email <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  <span class="keyword">constraint</span> t_stu_name_email_unique <span class="keyword">unique</span>(name,email)#<span class="keyword">constraint</span>后面的就是约束名字</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>所有的约束都存储在一个系统表当中：table_constraints。这个系统表在这个数据库当中：information_schema</p>
<h3 id="主键约束"><a href="#主键约束" class="headerlink" title="主键约束"></a>主键约束</h3><ol>
<li><p>主键：primary key，简称PK</p>
</li>
<li><p>主键约束的字段不能为NULL，并且不能重复。</p>
</li>
<li><p>任何一张表都应该有主键，没有主键的表可以视为无效表。</p>
</li>
<li><p>主键值是这行记录的身份证号，是唯一标识。在数据库表中即使两条数据一模一样，但由于主键值不同，我们也会认为是两条完全的不同的数据。</p>
</li>
<li><p>主键分类：</p>
<ol>
<li>根据字段数量分类：<ol>
<li>单一主键（1个字段作为主键）&#x3D;&#x3D;&gt;建议的</li>
<li>复合主键（2个或2个以上的字段作为主键）</li>
</ol>
</li>
<li>根据业务分类：<ol>
<li>自然主键（主键和任何业务都无关，只是一个单纯的自然数据）&#x3D;&#x3D;&#x3D;&gt;建议的</li>
<li>业务主键（主键和业务挂钩，例如：银行卡账号作为主键）</li>
</ol>
</li>
</ol>
</li>
<li><p>单一主键（建议使用这种方式）</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_student(</span><br><span class="line">  id <span class="type">bigint</span> <span class="keyword">primary key</span>,</span><br><span class="line">  sno <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">unique</span>,</span><br><span class="line">  sname <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">not null</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>复合主键（很少用，了解）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_user(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  age <span class="type">int</span>,</span><br><span class="line">  <span class="keyword">primary key</span>(<span class="keyword">no</span>,name)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>主键自增：既然主键值是一个自然的数字，mysql为主键值提供了一种自增机制，不需要我们程序员维护，mysql自动维护该字段</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_vip(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h3><ol>
<li>有这样一个需求：要求设计表，能够存储学生以及学校信息。<ol>
<li>第一种方案：一张表</li>
</ol>
</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250320232608142.png" alt="image-20250320232608142"></p>
<p>这种方式会导致数据冗余，浪费空间。</p>
<pre><code>  2. 第二种方案：两张表：一张存储学生，一张存储学校
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2023/png/21376908/1679198814824-520944e2-5b83-49ba-97e7-b8830286127a.png#averageHue=%23c9d481&clientId=uf7a0608d-b7a1-4&from=paste&height=85&id=ud1ad0346&originHeight=85&originWidth=471&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2397&status=done&style=shadow&taskId=u76cd09e9-9753-41f7-81d7-729db7c551a&title=&width=471" alt="image.png"></p>
<p>t_student 表</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250320232823743.png" alt="image-20250320232823743"></p>
<p>如果采用以上两张表存储数据，对于学生表来说，sno这个字段的值是不能随便填的，这个sno是学校编号，必须要求这个字段中的值来自学校表的sno。<br>为了达到要求，此时就必须要给t_student表的sno字段添加外键约束了。</p>
<ol start="2">
<li><p>外键约束：foreign key，简称FK。</p>
</li>
<li><p>添加了外键约束的字段中的数据必须来自其他字段，不能随便填。</p>
</li>
<li><p>假设给a字段添加了外键约束，要求student字段中的数据必须来自b字段，school字段<strong>不一定是主键，但至少要有唯一性</strong>。</p>
</li>
<li><p>外键约束可以给单个字段添加，叫做单一外键。也可以给多个字段联合添加，叫做复合外键。复合外键很少用。</p>
</li>
<li><p>建表是有顺序的，a表如果引用b表中的数据，可以把b表叫做父表(student)，把a表叫做子表。</p>
<ol>
<li>创建表时，先创建父表，再创建子表。</li>
<li>插入数据时，先插入父表，在插入子表。</li>
<li>删除数据时，先删除子表，再删除父表。</li>
<li>删除表时，先删除子表，再删除父表。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#先创建父表</span><br><span class="line"><span class="keyword">create table</span> t_school(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>  sno <span class="type">int</span> <span class="keyword">primary key</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>  sname <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> );</span><br><span class="line">#插入数据</span><br><span class="line"><span class="keyword">insert into</span> t_school <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;北京二中&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_school <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;南开大学附属中学&#x27;</span>);</span><br><span class="line"></span><br><span class="line">#创建子表</span><br><span class="line"><span class="keyword">create table</span> t_student(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>  id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>  age <span class="type">int</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>  school_no <span class="type">int</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>  <span class="keyword">constraint</span> t_student_school_no_fk <span class="keyword">foreign key</span>(school_no) <span class="keyword">references</span> t_school(sno)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> );#<span class="keyword">constraint</span>给约束起名，<span class="keyword">foreign key</span>是指定外键，<span class="keyword">references</span>是引用表里唯一的东西</span><br><span class="line">    </span><br><span class="line">#插入多条数据（略</span><br><span class="line"><span class="keyword">insert into</span> t_student(name,age,school_no) <span class="keyword">values</span>(<span class="string">&#x27;jack&#x27;</span>,<span class="number">20</span>,<span class="number">1</span>);#如果<span class="number">1</span>改成<span class="number">3</span>，就会报错，因为school只有<span class="number">1</span>和<span class="number">2</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如何添加外键：</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_school( </span><br><span class="line">  sno <span class="type">int</span> <span class="keyword">primary key</span>, </span><br><span class="line">  sname <span class="type">varchar</span>(<span class="number">255</span>) </span><br><span class="line">); </span><br><span class="line"><span class="keyword">create table</span> t_student( </span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span> <span class="keyword">primary key</span>, </span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>), </span><br><span class="line">  age <span class="type">int</span>, </span><br><span class="line">  sno <span class="type">int</span>, </span><br><span class="line">  <span class="keyword">constraint</span> t_school_sno_fk <span class="keyword">foreign key</span>(sno) <span class="keyword">references</span> t_school(sno) </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>级联删除</li>
</ol>
<p>创建子表时，外键可以添加：on delete cascade，这样在删除父表数据时，子表会级联删除。谨慎使用。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#继续上面的信息，删掉约束</span><br><span class="line"><span class="keyword">alter table</span> t_student <span class="keyword">drop</span> <span class="keyword">constraint</span> t_student_school_no_fk;</span><br><span class="line">###添加约束，和下面的一样</span><br><span class="line">alert <span class="keyword">table</span> t_student <span class="keyword">add constraint</span> t_student_sno_fk <span class="keyword">foreign key</span>(school_no) <span class="keyword">references</span> t_school(sno) <span class="keyword">on</span> <span class="keyword">delete</span> cascade;</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_student( </span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span> <span class="keyword">primary key</span>, </span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>), </span><br><span class="line">  age <span class="type">int</span>, </span><br><span class="line">  sno <span class="type">int</span>, </span><br><span class="line">  <span class="keyword">constraint</span> t_school_sno_fk <span class="keyword">foreign key</span>(sno) <span class="keyword">references</span> t_school(sno) <span class="keyword">on</span> <span class="keyword">delete</span> cascade </span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">###删除约束</span><br><span class="line">alert <span class="keyword">table</span> t_student <span class="keyword">drop</span> <span class="keyword">foreign key</span> t_student_sno_fk;</span><br><span class="line">###添加约束</span><br><span class="line">alert <span class="keyword">table</span> t_student <span class="keyword">add constraint</span> t_student_sno_fk <span class="keyword">foreign key</span>(sno) <span class="keyword">references</span> t_school(sno) <span class="keyword">on</span> <span class="keyword">delete</span> cascade;</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>级联更新 ：父改了的时候子也会改</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_student( </span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span> <span class="keyword">primary key</span>, </span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>), </span><br><span class="line">  age <span class="type">int</span>, </span><br><span class="line">  sno <span class="type">int</span>, </span><br><span class="line">  <span class="keyword">constraint</span> t_school_sno_fk <span class="keyword">foreign key</span>(sno) <span class="keyword">references</span> t_school(sno) <span class="keyword">on</span> <span class="keyword">update</span> cascade </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#接着最上面的表，然后约束删掉再加上<span class="keyword">on</span> <span class="keyword">update</span> cascade</span><br><span class="line"><span class="keyword">alter table</span> t_student <span class="keyword">add constraint</span> t_student_school_no_fk <span class="keyword">foreign key</span>(school_no) <span class="keyword">references</span> t_school(sno) <span class="keyword">on</span> <span class="keyword">update</span> cascade;</span><br><span class="line">#更新数据</span><br><span class="line"><span class="keyword">update</span> t_school <span class="keyword">set</span> sno<span class="operator">=</span><span class="number">332</span> <span class="keyword">where</span> sname<span class="operator">=</span><span class="string">&#x27;北京二中&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321152205319.png" alt="image-20250321152205319"></p>
<ol start="10">
<li>级联置空</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_student( </span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span> <span class="keyword">primary key</span>, </span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>), </span><br><span class="line">  age <span class="type">int</span>, </span><br><span class="line">  sno <span class="type">int</span>, </span><br><span class="line">  <span class="keyword">constraint</span> t_school_sno_fk <span class="keyword">foreign key</span>(sno) <span class="keyword">references</span> t_school(sno) <span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">set</span> <span class="keyword">null</span> </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>把school删掉，student表的school_no会是null</p>
<h1 id="第06章-三范式"><a href="#第06章-三范式" class="headerlink" title="第06章 三范式"></a>第06章 三范式</h1><h2 id="什么是数据库设计三范式"><a href="#什么是数据库设计三范式" class="headerlink" title="什么是数据库设计三范式"></a>什么是数据库设计三范式</h2><p>数据库表设计的原则。教你怎么设计数据库表有效，并且节省空间。</p>
<p>这些毕竟是理论，在实际开发中为了满足客户需求，有时候会拿空间或者冗余去换取速度</p>
<h2 id="三范式（背）"><a href="#三范式（背）" class="headerlink" title="三范式（背）"></a>三范式（背）</h2><ol>
<li>第一范式：任何一张表都应该有主键，每个字段是原子性的不能再分<ol>
<li>以下表的设计不符合第一范式：无主键，并且联系方式可拆分。</li>
</ol>
</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321160005233.png" alt="image-20250321160005233"></p>
<pre><code>  2. 应该这样设计：
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321160012762.png" alt="image-20250321160012762"></p>
<ol start="2">
<li>第二范式：建立在第一范式基础上的，另外要求所有非主键字段完全依赖主键，不能产生部分依赖<ol>
<li>以下表存储了学生和老师的信息</li>
</ol>
</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321160020806.png" alt="image-20250321160020806"><br>虽然符合第一范式，但是违背了第二范式，学生姓名、老师姓名都产生了部分依赖。导致数据冗余。</p>
<pre><code>  2. 以下这种设计方式就是符合第二范式的：
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321160029954.png" alt="image-20250321160029954"></p>
<ol start="3">
<li>第三范式：建立在第二范式基础上的，非主键字段不能传递依赖于主键字段<ol>
<li>以下设计方式就是违背第三范式的</li>
</ol>
</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321160038070.png" alt="image-20250321160038070"><br>以上因为产生了传递依赖，导致班级名称冗余。</p>
<pre><code>  2. 以下这种方式就是符合第三范式的：
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321160043270.png" alt="image-20250321160043270"></p>
<h2 id="一对多怎么设计"><a href="#一对多怎么设计" class="headerlink" title="一对多怎么设计"></a>一对多怎么设计</h2><p>口诀：一对多两张表，多的表加外键。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321162808995.png" alt="image-20250321162808995"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321162813387.png" alt="image-20250321162813387"></p>
<h2 id="多对多怎么设计"><a href="#多对多怎么设计" class="headerlink" title="多对多怎么设计"></a>多对多怎么设计</h2><p>多对多三张表，关系表添加外键。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321162826769.png" alt="image-20250321162826769"></p>
<h2 id="一对一怎么设计"><a href="#一对一怎么设计" class="headerlink" title="一对一怎么设计"></a>一对一怎么设计</h2><p>两种方案：</p>
<ol>
<li>第一种：主键共享</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321162839731.png" alt="image-20250321162839731"></p>
<ol start="2">
<li>第二种：外键唯一</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321162846618.png" alt="image-20250321162846618"></p>
<h2 id="最终的设计"><a href="#最终的设计" class="headerlink" title="最终的设计"></a>最终的设计</h2><p>最终以满足客户需求为原则，有的时候会拿空间换速度。</p>
<h1 id="第07章-视图"><a href="#第07章-视图" class="headerlink" title="第07章 视图"></a>第07章 视图</h1><p>就是如果多处都需要使用同一条sql语句，可以把这个语句创建成视图，这样不管增删改查，只要对这个视图进行操作，其他的地方就会同步。</p>
<ol>
<li><p>只能将select语句创建为视图。</p>
</li>
<li><p>创建视图</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> myview01 <span class="keyword">as</span> <span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp;#<span class="keyword">as</span>后面的是DQL语句，以视图方式创建</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> myview01 <span class="keyword">as</span> <span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp;#前面的是创建或替换的意思，如果有myview01这个视图了就会替换成新的</span><br></pre></td></tr></table></figure>


</li>
<li><p>视图作用</p>
<ol>
<li><p>如果开发中有一条非常复杂的SQL，而这个SQL在多处使用，会给开发和维护带来成本。使用视图可以降低开发和维护的成本。</p>
</li>
<li><p>视图可以隐藏表的字段名。</p>
</li>
</ol>
</li>
<li><p>修改视图</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> myview01 <span class="keyword">set</span> ename<span class="operator">=</span><span class="string">&#x27;老板&#x27;</span> <span class="keyword">where</span> empno<span class="operator">=</span><span class="number">7839</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321183526829.png" alt="image-20250321183526829"></p>
</li>
<li><p>删除视图</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> myview01 <span class="keyword">where</span> empno<span class="operator">=</span><span class="number">7839</span>;#删除视图里的一个数据</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> myview01;#删除视图</span><br></pre></td></tr></table></figure>
</li>
<li><p>对视图增删改（DML：insert delete update）可以影响到原表数据。</p>
</li>
</ol>
<h1 id="第08章-事务transaction"><a href="#第08章-事务transaction" class="headerlink" title="第08章 事务transaction"></a>第08章 事务transaction</h1><h2 id="事务概述"><a href="#事务概述" class="headerlink" title="事务概述"></a>事务概述</h2><ol>
<li>事务是一个最小的工作单元。在数据库当中，事务表示一件完整的事儿。</li>
<li>一个业务的完成可能需要多条DML语句共同配合才能完成，例如转账业务，需要执行两条DML语句，先更新张三账户的余额，再更新李四账户的余额，为了保证转账业务不出现问题，就必须保证要么同时成功，要么同时失败，怎么保证同时成功或者同时失败呢？就需要使用事务机制。</li>
<li>也就是说用了事务机制之后，在同一个事务当中，多条DML语句会同时成功，或者同时失败，不会出现一部分成功，一部分失败的现象。</li>
<li>事务只针对DML语句有效：因为只有这三个语句是改变表中数据的。<ol>
<li>insert</li>
<li>delete</li>
<li>update</li>
</ol>
</li>
</ol>
<h2 id="事务四大特性：ACID"><a href="#事务四大特性：ACID" class="headerlink" title="事务四大特性：ACID"></a>事务四大特性：ACID</h2><ol>
<li>原子性（Atomicity）：是指事务包含的所有操作要么全部成功，要么同时失败。原子性也是最小的事务，不可再分</li>
<li>一致性（Consistency）：是指事务开始前，和事务完成后，数据应该是一致的。例如张三和李四的钱加起来是5000，中间不管进行过多少次的转账操作(update)，总量5000是不会变的。这就是事务的一致性。</li>
<li>隔离性（Isolation）：隔离性是当多个⽤户并发访问数据库时，⽐如操作同⼀张表时，数据库为每⼀个⽤户开启的事务，不能被其他事务的操作所⼲扰，多个并发事务之间要相互隔离。</li>
<li>持久性（Durability）：持久性是指⼀个事务⼀旦被提交了，那么对数据库中的数据的改变就是永久性的，即便是在数据库系统遇到故障的情况下也不会丢失提交事务的操作。</li>
</ol>
<h2 id="演示MySQL事务"><a href="#演示MySQL事务" class="headerlink" title="演示MySQL事务"></a>演示MySQL事务</h2><p>在sql里，是自动提交事务的，如果需要关闭，在dos命令窗口中开启MySQL事务：start transaction; 或者：begin;开启手动提交<br>回滚事务：rollback;<br>提交事务：commit;<br>只要执行以上的rollback或者commit，事务都会结束。commit是成功事务，硬盘上的文件内容会被彻底改变，rollback是把之前的历史记录全部清空，当做没有发生<br>MySQL默认情况下采用的事务机制是：自动提交。所谓自动提交就是只要执行一条DML语句则提交一次。每次提交完都要再开启一次。</p>
<h2 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322015111236.png" alt="image-20250322015111236"></p>
<p><strong>隔离级别从低到高排序：读未提交 &lt; 读提交 &lt; 可重复读 &lt; 串行化**<br>**不同隔离级别会存在不同的现象，现象按照严重性从高到低排序：脏读 &gt; 不可重复读 &gt; 幻读</strong></p>
<p>读未提交：读到没有提交的数据<br>读提交：同上<br>可重复读：读到了一条数据，读完之后当前的事物只要不结束，这条数据就会永远不变，可以重复读，不被影响<br>串行化：不支持事物并发，事物a和事物b必须排队执行</p>
<h3 id="查看与设置隔离级别"><a href="#查看与设置隔离级别" class="headerlink" title="查看与设置隔离级别"></a>查看与设置隔离级别</h3><p>mysql默认的隔离级别：可重复读（REPEATABLE READ）。oracle默认是读提交</p>
<ul>
<li>查看当前会话（窗口）的隔离级别：select @@transaction_isolation;</li>
<li>查看全局的隔离级别：select @@gobal.transaction_isolation;</li>
</ul>
<p>设置事务隔离级别：</p>
<ul>
<li>会话级：set session transaction isolation level read committed;</li>
<li>全局级：set global transaction isolation level read committed;</li>
</ul>
<h3 id="不同现象"><a href="#不同现象" class="headerlink" title="不同现象"></a>不同现象</h3><h4 id="脏读"><a href="#脏读" class="headerlink" title="脏读"></a>脏读</h4><p><strong>指的是一个事务读取了另一个事务尚未提交的数据</strong>，即读取了另一个事务中的脏数据（Dirty Data）。在此情况下，如果另一个事务回滚了或者修改了这些数据，那么读取这些脏数据的事务所处理的数据就是不准确的。</p>
<h4 id="不可重复读"><a href="#不可重复读" class="headerlink" title="不可重复读"></a>不可重复读</h4><p>指在一个事务内，多次读取同一个数据行，得到的结果可能是不一样的。这是由于其他事务对数据行做出了修改操作，导致数据的不一致性。</p>
<h4 id="幻读"><a href="#幻读" class="headerlink" title="幻读"></a>幻读</h4><p>指在事务执行过程中，前后两次相同的查询条件得到的结果集不一致，可能会变多或变少。<br>比如a在进行查询语句，本来要查3条，结果b执行了一条插入，就变成了查四条</p>
<h3 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h3><h4 id="读未提交（READ-UNCOMMITTED）"><a href="#读未提交（READ-UNCOMMITTED）" class="headerlink" title="读未提交（READ UNCOMMITTED）"></a>读未提交（READ UNCOMMITTED）</h4><p>A事务与B事务，A事务可以读取到B事务未提交的数据。这是最低的隔离级别。几乎两个事务之间没有隔离。这种隔离级别是一种理论层面的，在实际的数据库产品中，没有从这个级别起步的。<br>当事务隔离级别是读未提交时，三种现象都存在：脏读，不可重复读，幻读。<br>我们可以开启两个DOS命令窗口，模拟两个事务，演示一下这种隔离级别。三种现象中最严重的是脏读，我们只需要演示脏读问题即可，因为存在脏读的话，就一定存在不可重复读和幻读问题。</p>
<p>将全局事务隔离级别设置为：READ UNCOMMITTED</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level read uncommitted;</span><br></pre></td></tr></table></figure>

<p>开启两个DOS命令窗口来模拟两个事务：A事务与B事务。</p>
<table>
<thead>
<tr>
<th><strong>A事务</strong></th>
<th><strong>B事务</strong></th>
</tr>
</thead>
<tbody><tr>
<td>mysql&gt; use powernode</td>
<td></td>
</tr>
<tr>
<td></td>
<td>mysql&gt; use powernode</td>
</tr>
<tr>
<td>mysql&gt; start transaction;</td>
<td></td>
</tr>
<tr>
<td></td>
<td>mysql&gt; start transaction;</td>
</tr>
<tr>
<td>mysql&gt; select * from a;</td>
<td></td>
</tr>
<tr>
<td><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322021702025.png" alt="image-20250322021702025"></td>
<td></td>
</tr>
<tr>
<td></td>
<td>mysql&gt; insert into a values(4);</td>
</tr>
<tr>
<td>mysql&gt; select * from a;</td>
<td></td>
</tr>
<tr>
<td><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322021709540.png" alt="image-20250322021709540"></td>
<td></td>
</tr>
</tbody></table>
<p>通过以上测试，可以看到，A事务读取到了B事务还没有提交的数据。这种现象就是脏读。</p>
<h4 id="读提交（READ-COMMITTED）"><a href="#读提交（READ-COMMITTED）" class="headerlink" title="读提交（READ COMMITTED）"></a>读提交（READ COMMITTED）</h4><p>A事务与B事务，A事务可以读取到B事务提交之后的数据。Oracle数据库默认的就是这种隔离级别。</p>
<p>将数据库的全局事务隔离级别设置为读提交：READ COMMITTED</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level read committed;</span><br></pre></td></tr></table></figure>

<p>还是上面图表的内容，但是b表必须要commit提交后a表才可以读到，但a表依旧不可重复读，而且b表插入时a表可以显示</p>
<h4 id="可重复读（REPEATABLE-READ）"><a href="#可重复读（REPEATABLE-READ）" class="headerlink" title="可重复读（REPEATABLE READ）"></a>可重复读（REPEATABLE READ）</h4><p>这个隔离级别是MySQL数据库默认的。<br>A事务和B事务，A事务开启后，读取了某一条记录，然后B事务对这条记录进行修改并提交，A事务读取到的还是修改前的数据。这种隔离级别称为可重复读。</p>
<p>将数据库全局隔离级别修改为可重复读：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level repeatable read;</span><br></pre></td></tr></table></figure>

<p>但是<strong>当事务隔离级别设置为可重复读，MySQL会尽最大努力避免幻读问题，但这种隔离级别无法完全避免幻读问题。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_school;#快照读</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_school <span class="keyword">for</span> <span class="keyword">update</span>;#当前读，会出现幻读问题</span><br></pre></td></tr></table></figure>

<h4 id="串行化（SERIALIZABLE）"><a href="#串行化（SERIALIZABLE）" class="headerlink" title="串行化（SERIALIZABLE）"></a>串行化（SERIALIZABLE）</h4><p>种隔离级别最高，避免了所有的问题，缺点是效率低，因为这种隔离级别会导致事务排队处理，不支持并发。</p>
<p>设置数据库全局隔离级别为串行化：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level serializable;</span><br></pre></td></tr></table></figure>

<h3 id="可重复读的幻读问题"><a href="#可重复读的幻读问题" class="headerlink" title="可重复读的幻读问题"></a>可重复读的幻读问题</h3><p>在上面讲解过程中我提到，MySQL默认的隔离级别可重复读，在很大程度上避免了幻读问题（并不能完全解决），那么它是如何解决幻读问题的呢，解决方案包括两种：</p>
<ul>
<li>针对<strong>快照读</strong>（普通 select 语句），是<strong>通过 MVCC 方式解决了幻读</strong>，因为可重复读隔离级别下，事务执行过程中看到的数据，一直跟这个事务启动时看到的数据是一致的，即使中途有其他事务插入了一条数据，是查询不出来这条数据的，所以就很好的避免了幻读问题。</li>
<li>针对<strong>当前读</strong>（select … for update 等语句，<strong>在delete、insert、update操作时会自动调用一次当前读获取最新的数据</strong>），是<strong>通过 next-key lock（记录锁+间隙锁）方式解决了幻读</strong>，因为当执行 select … for update 语句的时候，会加上 next-key lock，如果有其他事务在 next-key lock 锁范围内插入了一条记录，那么这个插入语句就会被阻塞，无法成功插入，所以就很好的避免了幻读问题。</li>
<li>记录锁：在另一个事务中删数据会删不掉，必须a事务结束才可以</li>
<li>间隙锁：如果选择的范围在2-4之间，而数据只有2和4，b表想插个3就无法被插入，因为会有间隙锁给锁住</li>
</ul>
<h4 id="快照读是如何解决幻读的"><a href="#快照读是如何解决幻读的" class="headerlink" title="快照读是如何解决幻读的"></a>快照读是如何解决幻读的</h4><p>快照类似于缓存，第一次读的时候把数据留在了缓存里，第二次读直接是读缓存里的那个数据而不是最新的，要么两次都是快照读，要么两次都是当前读，如果一次快照一次当前就会出现幻读问题</p>
<ul>
<li>底层由 MVCC（多版本并发控制）实现，实现的方式是开始事务后，在执行第一个查询语句后，会创建一个 Read View，后续的查询语句利用这个 Read View，通过这个 Read View 就可以在 undo log 版本链找到事务开始时的数据，所以事务过程中每次查询的数据都是一样的，即使中途有其他事务插入了新纪录，是查询不出来这条数据的，所以就很好的避免了幻读问题。</li>
<li>多版本并发的多版本是：当前数据库表中的数据的版本是1.0，每执行一次insert&#x2F;delete&#x2F;update这些dml操作，则版本更新一次，insert1.1,delete1.2,update1.3</li>
<li>undo是撤销，redo是重做</li>
</ul>
<h4 id="当前读是如何解决幻读的"><a href="#当前读是如何解决幻读的" class="headerlink" title="当前读是如何解决幻读的"></a>当前读是如何解决幻读的</h4><p>当前读，顾名思义：每一次都读取最新的数据。当前读包括：update、delete、insert、select…for update。这个很好理解，因为增删改的时候都要基于最新的数据进行增删改。<br>而select…for update原理是：对查询范围内的数据进行加锁，不允许其它事务对这个范围内的数据进行增删改。也就是说这个select语句范围内的数据是不允许并发的，只能排队执行，从而避免幻读问题。<br>select…for update加的锁叫做：next-key lock。我们可以称其为：间隙锁 + 记录锁。间隙锁用来保证在锁定的范围内不允许insert操作。记录锁用来保证在锁定的范围内不允许delete和update操作。</p>
<p>假如有这样的数据：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322024846882.png" alt="image-20250322024846882"><br>SQL语句是这样写的：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> a <span class="keyword">where</span> id <span class="keyword">between</span> <span class="number">2</span> <span class="keyword">and</span> <span class="number">4</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure>

<p>那么id在[2-4]区间的所有记录行被锁定，不能插入3是通过间隙锁来搞定的。不能修改或删除2和4是通过记录锁来搞定的。</p>
<h4 id="出现幻读的两种情况"><a href="#出现幻读的两种情况" class="headerlink" title="出现幻读的两种情况"></a>出现幻读的两种情况</h4><p>在同一个事务处理过程中，如果前后两次都采用快照读，或者都采用当前读，则不会出现幻读问题。如果第一次使用快照读，后面使用了当前读，则会出现幻读问题。</p>
<h5 id="第一种产生幻读的场景"><a href="#第一种产生幻读的场景" class="headerlink" title="第一种产生幻读的场景"></a>第一种产生幻读的场景</h5><p>A事务与B事务。在A事务中第一次查询使用快照读，B事务插入数据。然后在A事务中第二次查询使用当前读。则会产生幻读现象。</p>
<h5 id="第二种产生幻读的场景"><a href="#第二种产生幻读的场景" class="headerlink" title="第二种产生幻读的场景"></a>第二种产生幻读的场景</h5><p>事务A与事务B，在事务A中第一次查询使用<strong>快照读</strong>，在事务B中插入一条数据，然后在事务A中<strong>更新</strong>（底层自动当前读）事务B插入的那条记录，最后在事务A中再次使用<strong>快照读</strong>。则会发生幻读现象。</p>
<h4 id="总结可重复读的幻读问题"><a href="#总结可重复读的幻读问题" class="headerlink" title="总结可重复读的幻读问题"></a>总结可重复读的幻读问题</h4><p>MySQL的可重复读隔离级别（默认隔离级），根据不同的查询方式，分别提出了避免幻读的方案：</p>
<ul>
<li>针对快照读（普通 select 语句），是通过 MVCC 方式解决了幻读。</li>
<li>针对当前读（select … for update 等语句），是通过 next-key lock（记录锁+间隙锁）方式解决了幻读。</li>
</ul>
<p>我举例了两个发生幻读场景的例子。</p>
<ul>
<li>第一个例子：对于快照读， MVCC 并不能完全避免幻读现象。因为当事务 A 更新了一条事务 B 插入的记录，那么事务 A 前后两次查询的记录条目就不一样了，所以就发生幻读。</li>
<li>第二个例子：对于当前读，如果事务开启后，并没有执行当前读，而是先快照读，然后这期间如果其他事务插入了一条记录，那么事务后续使用当前读进行查询的时候，就会发现两次查询的记录条目就不一样了，所以就发生幻读。</li>
</ul>
<p>所以，MySQL 可重复读隔离级别并没有彻底解决幻读，只是很大程度上避免了幻读现象的发生。<br>要避免这类特殊场景下发生幻读的现象的话，就是尽量在开启事务之后，马上执行 select … for update 这类当前读的语句，因为它会对记录加 next-key lock，从而避免其他事务插入一条新记录。</p>
<h1 id="第09章-DBA命令"><a href="#第09章-DBA命令" class="headerlink" title="第09章 DBA命令"></a>第09章 DBA命令</h1><p>数据库管理员</p>
<h2 id="新建用户"><a href="#新建用户" class="headerlink" title="新建用户"></a>新建用户</h2><p>使用自带的数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br></pre></td></tr></table></figure>

<p>有个系统表保存着系统用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> tables <span class="keyword">like</span> <span class="string">&#x27;user&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322180559107.png" alt="image-20250322180559107"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322180737605.png" alt="image-20250322180737605"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>,host <span class="keyword">from</span> <span class="keyword">user</span>;#里面的localhost是本地用户</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322180906745.png" alt="image-20250322180906745"></p>
<p>创建一个用户名为java1，密码设置为123的本地用户：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;java1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>创建一个用户名为java2，密码设置为123的外网用户：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;java2&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>采用以上方式新建的用户没有任何权限：系统表也只能看到以下两个<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322182422523.png" alt="image-20250322182422523"><br>使用root用户查看系统中当前用户有哪些？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>,host <span class="keyword">from</span> mysql.user;</span><br></pre></td></tr></table></figure>

<h2 id="给用户授权"><a href="#给用户授权" class="headerlink" title="给用户授权"></a>给用户授权</h2><p>授权语法：grant [权限1，权限2…] on 库名.表名 to ‘用户名‘@’主机名&#x2F;IP地址’;<br>（意思是：给后面的这个用户授前面的权限，但是只能作用在这个单独的表上）<br>给本地用户授权：grant [权限1，权限2…] on 库名.表名 to ‘用户名‘@’localhost’;<br>给外网用户授权：grant [权限1，权限2…] on 库名.表名 to ‘用户名‘@’%’;<br>所有权限：all privileges<br>细粒度权限：select、insert、delete、update、alter、create、drop、index(索引)、usage(登录权限)……<br>库名可以使用 * ，它代表所有数据库<br>表名可以采用 * ，它代表所有表<br>也可以提供具体的数据库和表，例如：powernode.emp （powernode数据库的emp表）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 将所有库所有表的查询权限赋予本地用户java1</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">delete</span>,<span class="keyword">update</span>,<span class="keyword">create</span> <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;java1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">flush privileges;#要记得这步，不然不起作用</span><br><span class="line"></span><br><span class="line"># 将powernode库中所有表的所有权限赋予本地用户java1</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> powernode.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;java1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>授权后必须刷新权限，才能生效：flush privileges<br>查看某个用户拥有哪些权限？<br>show grants for ‘java1‘@’localhost’<br>show grants for ‘java2‘@’%’</p>
<p>with grant option：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">with</span> <span class="keyword">grant</span> option的作用是：java2用户也可以给其他用户授权（自己的权限）了。</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">delete</span>,<span class="keyword">update</span> <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;java2&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">with</span> <span class="keyword">grant</span> option;</span><br></pre></td></tr></table></figure>

<h2 id="撤销用户权限"><a href="#撤销用户权限" class="headerlink" title="撤销用户权限"></a>撤销用户权限</h2><p>revoke 权限 on 数据库名.表名 from ‘用户‘@’IP地址’;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 撤销本地用户java1的<span class="keyword">insert</span>、<span class="keyword">update</span>、<span class="keyword">delete</span>权限</span><br><span class="line"><span class="keyword">revoke</span> <span class="keyword">insert</span>, <span class="keyword">update</span>, <span class="keyword">delete</span> <span class="keyword">on</span> powernode.<span class="operator">*</span> <span class="keyword">from</span> <span class="string">&#x27;java1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line"></span><br><span class="line"># 撤销外网用户java2的<span class="keyword">insert</span>权限</span><br><span class="line"><span class="keyword">revoke</span> <span class="keyword">insert</span> <span class="keyword">on</span> powernode.<span class="operator">*</span> <span class="keyword">from</span> <span class="string">&#x27;java2&#x27;</span>@<span class="string">&#x27;%&#x27;</span></span><br></pre></td></tr></table></figure>

<p>撤销权限后也需要刷新权限：flush privileges</p>
<p>注意：撤销权限时 “数据库名.表名” 不能随便写，要求和授权语句时的 “数据库名.表名” 一致。</p>
<h2 id="修改用户的密码"><a href="#修改用户的密码" class="headerlink" title="修改用户的密码"></a>修改用户的密码</h2><p>具有管理用户权限的用户才能修改密码，例如root账户可以修改其他账户的密码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 本地用户修改密码</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;java1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;456&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 外网用户修改密码</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;java2&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;456&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>修改密码后，也需要刷新权限才能生效：flush privileges<br>以上是MySQL8版本以后修改用户密码的方式。</p>
<h2 id="修改用户名"><a href="#修改用户名" class="headerlink" title="修改用户名"></a>修改用户名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rename <span class="keyword">user</span> <span class="string">&#x27;原始用户名&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">to</span> <span class="string">&#x27;新用户名&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">rename <span class="keyword">user</span> <span class="string">&#x27;原始用户名&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">to</span> <span class="string">&#x27;新用户名&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">rename <span class="keyword">user</span> <span class="string">&#x27;java1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">to</span> <span class="string">&#x27;java11&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">rename <span class="keyword">user</span> <span class="string">&#x27;java11&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">to</span> <span class="string">&#x27;java123&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>flush privileges;</p>
<h2 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;java123&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;java2&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>flush privileges;</p>
<h2 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h2><ul>
<li>导出数据（请在登录mysql数据库之前进行）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 导出powernode这个数据库中所有的表</span><br><span class="line"># 指令 需要导出的表 到 什么路径 用户名 密码 导出时采用的字符编码</span><br><span class="line">mysqldump powernode <span class="operator">&gt;</span> e:<span class="operator">/</span>powernode.sql <span class="operator">-</span>uroot <span class="operator">-</span>p1234 <span class="comment">--default-character-set=utf8</span></span><br><span class="line"></span><br><span class="line"># 导出powernode中emp表的数据</span><br><span class="line">mysqldump powernode emp <span class="operator">&gt;</span> e:<span class="operator">/</span>powernode.sql <span class="operator">-</span>uroot <span class="operator">-</span>p1234 <span class="comment">--default-character-set=utf8</span></span><br></pre></td></tr></table></figure>

<ul>
<li>导入数据第一种方式：（请在登录mysql之前进行）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 现在登录mysql状态下新建一个数据库</span><br><span class="line"><span class="keyword">create</span> database powernode;</span><br><span class="line"># 在登录mysql之前执行以下命令</span><br><span class="line">mysql powernode <span class="operator">&lt;</span> e:<span class="operator">/</span>powernode.sql <span class="operator">-</span>uroot <span class="operator">-</span>p1234 <span class="comment">--default-character-set=utf8</span></span><br></pre></td></tr></table></figure>

<ul>
<li>导入数据第二种方式：（请在登录mysql之后操作）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span>  database powernode;</span><br><span class="line">use powernode;</span><br><span class="line">source d:<span class="operator">/</span>powernode.sql</span><br></pre></td></tr></table></figure>

<h1 id="第10章-MySQL客户端工具"><a href="#第10章-MySQL客户端工具" class="headerlink" title="第10章 MySQL客户端工具"></a>第10章 MySQL客户端工具</h1><p>注释：&#x2F;* *&#x2F;</p>
<p>创建数据库的字符集一般是utf8mb4（不是必须），排序规则utf8mb4_general_ci</p>
<p>放大字体：按住ctrl+滚轮</p>
<h1 id="第11章-企业真题"><a href="#第11章-企业真题" class="headerlink" title="第11章 企业真题"></a>第11章 企业真题</h1><p>看文件</p>
<h1 id="第12章-存储过程"><a href="#第12章-存储过程" class="headerlink" title="第12章 存储过程"></a>第12章 存储过程</h1><h2 id="什么是存储过程？"><a href="#什么是存储过程？" class="headerlink" title="什么是存储过程？"></a>什么是存储过程？</h2><p>存储过程可称为过程化SQL语言，是在普通SQL语句的基础上增加了编程语言的特点，把数据操作语句(DML)和查询语句(DQL)组织在过程化代码中，通过逻辑判断、循环等操作实现复杂计算的程序语言。<br>换句话说，存储过程其实就是数据库内置的一种编程语言，这种编程语言也有自己的变量、if语句、循环语句等。在一个存储过程中可以将多条SQL语句以逻辑代码的方式将其串联起来，执行这个存储过程就是将这些SQL语句按照一定的逻辑去执行，所以一个存储过程也可以看做是一组为了完成特定功能的SQL 语句集。<br>每一个存储过程都是一个数据库对象，就像table和view一样，存储在数据库当中，一次编译永久有效。并且每一个存储过程都有自己的名字。客户端程序通过存储过程的名字来调用存储过程。<br>在数据量特别庞大的情况下利用存储过程能达到倍速的效率提升。 </p>
<h2 id="存储过程的优点和缺点？"><a href="#存储过程的优点和缺点？" class="headerlink" title="存储过程的优点和缺点？"></a>存储过程的优点和缺点？</h2><p>优点：速度快。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">缺点：移植性差。编写难度大。维护性差。</span><br></pre></td></tr></table></figure>

<p>缺点：移植性差。编写难度大。维护性差。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- 每一个数据库都有自己的存储过程的语法规则，这种语法规则不是通用的。一旦使用了存储过程，则数据库产品很难更换，例如：编写了mysql的存储过程，这段代码只能在mysql中运行，无法在oracle数据库中运行。</span><br><span class="line">- 对于数据库存储过程这种语法来说，没有专业的IDE工具（集成开发环境），所以编码速度较低。自然维护的成本也会较高。</span><br></pre></td></tr></table></figure>

<h2 id="第一个存储过程"><a href="#第一个存储过程" class="headerlink" title="第一个存储过程"></a>第一个存储过程</h2><h3 id="存储过程的创建"><a href="#存储过程的创建" class="headerlink" title="存储过程的创建"></a>存储过程的创建</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create procedure p1()</span><br><span class="line">begin</span><br><span class="line">	select empno,ename from emp;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>

<h3 id="存储过程的调用"><a href="#存储过程的调用" class="headerlink" title="存储过程的调用"></a>存储过程的调用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call p1();</span><br></pre></td></tr></table></figure>

<p><strong>如果使用dos可能会出现分号就执行的情况， 这时候delimiter命令可以把执行语句给更改</strong></p>
<h3 id="存储过程的查看"><a href="#存储过程的查看" class="headerlink" title="存储过程的查看"></a>存储过程的查看</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">查看建表过程的语句</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create table</span> emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">查看创建存储过程的语句</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">procedure</span> p1;</span><br></pre></td></tr></table></figure>

<p>通过系统表information_schema.ROUTINES查看存储过程的详细信息：</p>
<p>在mysql当中，只要创建一个存储过程对象，在information_schema.ROUTINES系统表当中就会增加一条记录，这条记录是专门描述该存储过程对象状态的<br>information_schema.ROUTINES 是 MySQL 数据库中一个系统表，存储了所有存储过程、函数、触发器的详细信息，包括名称、返回值类型、参数、创建时间、修改时间等。</p>
<p>information_schema.ROUTINES 表中的一些重要的列包括：</p>
<ul>
<li>SPECIFIC_NAME：存储过程的具体名称，包括该存储过程的名字，参数列表。</li>
<li>ROUTINE_SCHEMA：存储过程所在的数据库名称。</li>
<li>ROUTINE_NAME：存储过程的名称。</li>
<li>ROUTINE_TYPE：PROCEDURE表示是一个存储过程，FUNCTION表示是一个函数。</li>
<li>ROUTINE_DEFINITION：存储过程的定义语句。</li>
<li>CREATED：存储过程的创建时间。</li>
<li>LAST_ALTERED：存储过程的最后修改时间。</li>
<li>DATA_TYPE：存储过程的返回值类型、参数类型等。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#查询表结构</span><br><span class="line"><span class="keyword">desc</span> information_schema.ROUTINES;</span><br><span class="line"></span><br><span class="line">#然后查系统表的结构</span><br><span class="line"><span class="keyword">select</span> SPECIFIC_NAME <span class="keyword">from</span> information_schema.ROUTINES <span class="keyword">where</span> ROUTINE_NAME<span class="operator">=</span><span class="string">&#x27;p1&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="存储过程的删除"><a href="#存储过程的删除" class="headerlink" title="存储过程的删除"></a>存储过程的删除</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop procedure if exists p1;</span><br></pre></td></tr></table></figure>

<h3 id="delimiter命令"><a href="#delimiter命令" class="headerlink" title="delimiter命令"></a>delimiter命令</h3><p>在 MySQL 中，<code>delimiter</code> 命令用于改变 MySQL 解释语句的定界符。MySQL 默认使用分号 <code>;</code> 作为语句的定界符。而使用 <code>delimiter</code> 命令可以将分号 <code>;</code> 更改为其他字符，从而可以在 SQL 语句中使用分号 <code>;</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delimiter <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">这样就可以把;执行改为<span class="operator">/</span><span class="operator">/</span>执行</span><br></pre></td></tr></table></figure>

<h2 id="MySQL的变量"><a href="#MySQL的变量" class="headerlink" title="MySQL的变量"></a>MySQL的变量</h2><p>mysql中的变量包括：系统变量、用户变量、局部变量。</p>
<h3 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h3><p>MySQL 系统变量是指在 MySQL 服务器运行时控制其行为的参数。这些变量可以被设置为特定的值来改变服务器的默认设置，以满足不同的需求。比如想把dml的自动提交给改成手动提交，就可以用系统变量。<br>MySQL 系统变量可以具有全局（global）或会话（session）作用域。</p>
<ul>
<li>全局作用域是指对所有连接和所有数据库都适用；</li>
<li>会话作用域是指只对当前连接和当前数据库适用。</li>
</ul>
<p>查看系统变量：variables是变量的意思</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> [<span class="keyword">global</span><span class="operator">|</span>session] variables;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> [<span class="keyword">global</span><span class="operator">|</span>session] variables <span class="keyword">like</span> <span class="string">&#x27;&#x27;</span>;模糊查找</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> @@[<span class="keyword">global</span><span class="operator">|</span>session.]系统变量名;</span><br></pre></td></tr></table></figure>

<p>注意：没有指定session或global时，默认是session。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">查看所有的系统变量</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">show</span> variables;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> variables;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">隐约知道某个系统变量的名字，但是不知道具体的全名，可以使用like进行模糊查找</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%char%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">当知道具体的系统变量名的时候，也可以使用以下方式来查看系统变量的值</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@global</span>.autocommit;</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@session</span>.autocommit;</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@autocommit</span>;默认是session会话级</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">在这里，当前会话的自动提交机制还没有关闭，是支持自动提交的</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">insert into</span> dept(deptno,dname,loc) <span class="keyword">values</span> (<span class="number">50</span>,<span class="string">&#x27;销售部&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">将当前会话的自动提交机制关闭</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">set</span> session autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">set</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">在这里，当前会话的自动提交机制关闭了</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">insert into</span> dept(deptno,dname,loc) <span class="keyword">values</span>(<span class="number">60</span>,<span class="string">&#x27;研发部&#x27;</span>,<span class="string">&#x27;上海&#x27;</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*修改全局作用域的自动提交机制，将其关闭*/</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>设置系统变量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> [<span class="keyword">global</span> <span class="operator">|</span> session] 系统变量名 <span class="operator">=</span> 值;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> @@[<span class="keyword">global</span> <span class="operator">|</span> session.]系统变量名 <span class="operator">=</span> 值;一般不用这个</span><br></pre></td></tr></table></figure>

<p>注意：无论是全局设置还是会话设置，当mysql服务（就是彻底停止）重启之后，之前配置都会失效。可以通过修改MySQL根目录下的my.ini配置文件达到永久修改的效果。（my.ini是MySQL数据库默认的系统级配置文件，默认是不存在的，需要新建，并参考一些资料进行配置。）<br>windows系统是my.ini<br>linux系统是my.cnf<br>my.ini文件通常放在mysql安装的根目录下，如下图：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250325184842189.png" alt="image-20250325184842189"><br>这个文件通常是不存在的，可以新建，新建后例如提供以下配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">autocommit=0</span><br></pre></td></tr></table></figure>

<p>这种配置就表示永久性关闭自动提交机制。（不建议这样做。）</p>
<h3 id="用户变量"><a href="#用户变量" class="headerlink" title="用户变量"></a>用户变量</h3><p>用户自定义的变量。只在<strong>当前会话</strong>有效。所有的用户变量‘@’开始。</p>
<p>给用户变量赋值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="variable">@name</span> <span class="operator">=</span> <span class="string">&#x27;jackson&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@age</span> :<span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@gender</span> :<span class="operator">=</span> <span class="string">&#x27;男&#x27;</span>, <span class="variable">@addr</span> :<span class="operator">=</span> <span class="string">&#x27;北京大兴区&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@email</span> :<span class="operator">=</span> <span class="string">&#x27;jackson@123.com&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> sal <span class="keyword">into</span> <span class="variable">@sal</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="operator">=</span><span class="string">&#x27;SMITH&#x27;</span>;</span><br><span class="line">#这个就是把查询名字为史密斯的工资赋值给<span class="variable">@sal</span></span><br></pre></td></tr></table></figure>

<p>读取用户变量的值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="variable">@name</span>, <span class="variable">@age</span>, <span class="variable">@gender</span>, <span class="variable">@addr</span>, <span class="variable">@email</span>, <span class="variable">@sal</span>;</span><br></pre></td></tr></table></figure>

<p>注意：mysql中变量不需要声明。直接赋值就行。如果没有声明变量，直接读取该变量，<strong>返回null</strong></p>
<h3 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h3><h2 id="局部变量-1"><a href="#局部变量-1" class="headerlink" title="局部变量"></a>局部变量</h2><p>在存储过程中可以使用局部变量。使用declare声明。在begin和end之间有效。</p>
<p>变量的声明</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> 变量名 数据类型 [<span class="keyword">default</span> ...];#默认值可以不加</span><br></pre></td></tr></table></figure>

<p>变量的数据类型就是表字段的数据类型，例如：int、bigint、char、varchar、date、time、datetime等。<br><strong>注意：declare通常出现在begin end之间的开始部分。</strong></p>
<p>变量的赋值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> 变量名 <span class="operator">=</span> 值;</span><br><span class="line"><span class="keyword">set</span> 变量名 :<span class="operator">=</span> 值;不加冒号也可以</span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">into</span> 变量名 <span class="keyword">from</span> 表名 ...;</span><br></pre></td></tr></table></figure>

<p>例如：以下程序演示局部变量的声明、赋值、读取：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> p3();#如果存在p3则删除</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">PROCEDURE</span> p2()</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">	<span class="comment">/*声明变量*/</span></span><br><span class="line">	<span class="keyword">declare</span> emp_count <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/*声明变量*/</span></span><br><span class="line">	<span class="keyword">declare</span> sal <span class="keyword">double</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">default</span> <span class="number">0.0</span>;</span><br><span class="line">	<span class="comment">/*给变量赋值*/</span></span><br><span class="line">	<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">into</span> emp_count <span class="keyword">from</span> emp;</span><br><span class="line">	<span class="comment">/*给变量赋值*/</span></span><br><span class="line">	<span class="keyword">set</span> sal :<span class="operator">=</span> <span class="number">5000.0</span>;#不加冒号也可以</span><br><span class="line">	<span class="comment">/*读取变量的值*/</span></span><br><span class="line">	<span class="keyword">select</span> emp_count;</span><br><span class="line">	<span class="comment">/*读取变量的值*/</span></span><br><span class="line">	<span class="keyword">select</span> sal;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> p2();</span><br><span class="line"><span class="keyword">select</span> emp_count,sal;#会报错，因为这个变量只是在存储过程里的局部变量，在外面无法访问</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@emp_count</span>,<span class="variable">@sal</span>;#这个可以访问，但访问的是用户变量，没有赋值的为<span class="keyword">null</span></span><br></pre></td></tr></table></figure>

<h2 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a>if语句</h2><p>语法格式：和java比，elseif中间会有个空格</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if 条件 <span class="keyword">then</span></span><br><span class="line">......</span><br><span class="line">elseif 条件 <span class="keyword">then</span></span><br><span class="line">......</span><br><span class="line">elseif 条件 <span class="keyword">then</span></span><br><span class="line">......</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">......</span><br><span class="line"><span class="keyword">end</span> if;</span><br></pre></td></tr></table></figure>

<p>案例：员工月薪sal，超过10000的属于“高收入”，6000到10000的属于“中收入”，少于6000的属于“低收入”。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> p4;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p4()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 声明一个局部变量，用来存储月薪 */</span></span><br><span class="line">	<span class="keyword">declare</span> sal <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 声明一个局部变量，用来存储等级 */</span></span><br><span class="line">	<span class="keyword">declare</span> grade <span class="type">varchar</span>(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 给局部变量sal赋值 */</span></span><br><span class="line">	<span class="keyword">set</span> sal <span class="operator">=</span> <span class="number">7000</span>;</span><br><span class="line">	if sal<span class="operator">&gt;</span><span class="number">10000</span> <span class="keyword">then</span> <span class="keyword">set</span> grade <span class="operator">=</span> <span class="string">&#x27;高收入&#x27;</span>;</span><br><span class="line">	elseif sal <span class="operator">&gt;</span><span class="number">6000</span> <span class="keyword">then</span> <span class="keyword">set</span> grade <span class="operator">=</span><span class="string">&#x27;中收入&#x27;</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">set</span> grade<span class="operator">=</span><span class="string">&#x27;低收入&#x27;</span>;</span><br><span class="line">	<span class="keyword">end</span> if;</span><br><span class="line">	<span class="keyword">select</span> grade;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">/* 调用存储过程 */</span></span><br><span class="line"><span class="keyword">call</span> p4();</span><br></pre></td></tr></table></figure>

<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><p>存储过程的参数包括三种形式：</p>
<ul>
<li>in：入参（未指定时，默认是in），用来接收调用者传过来的数据</li>
<li>out：出参，用来保存整个存储过程的执行结果</li>
<li>inout：既是入参，又是出参</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="comment">//定义方法</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>&#123;<span class="comment">//这个a和b就是入参，被传的参数</span></span><br><span class="line">       <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> a+b ;</span><br><span class="line">       <span class="keyword">return</span> c;<span class="comment">//c就是出参</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>案例：员工月薪sal，超过10000的属于“高收入”，6000到10000的属于“中收入”，少于6000的属于“低收入”。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> p5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p5(<span class="keyword">in</span> sal <span class="type">int</span>,<span class="keyword">out</span> grade <span class="type">varchar</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	if sal<span class="operator">&gt;</span><span class="number">10000</span> <span class="keyword">then</span> <span class="keyword">set</span> grade <span class="operator">=</span> <span class="string">&#x27;高收入&#x27;</span>;</span><br><span class="line">	elseif sal <span class="operator">&gt;</span><span class="number">6000</span> <span class="keyword">then</span> <span class="keyword">set</span> grade <span class="operator">=</span><span class="string">&#x27;中收入&#x27;</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">set</span> grade<span class="operator">=</span><span class="string">&#x27;低收入&#x27;</span>;</span><br><span class="line">	<span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p>在这里怎么获取到这个存储过程的执行结果呢？在存储过程外面只能访问到用户变量，而上面的grade是局部变量，就需要在call里写一个用于接收out出来的变量，怎么起名字都可以</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> p5(<span class="number">7000</span>,<span class="variable">@salgrade</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@salgrade</span>;</span><br></pre></td></tr></table></figure>

<h2 id="case语句"><a href="#case语句" class="headerlink" title="case语句"></a>case语句</h2><p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> 值</span><br><span class="line">	<span class="keyword">when</span> 值<span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">	......</span><br><span class="line">	<span class="keyword">when</span> 值<span class="number">2</span> <span class="keyword">then</span></span><br><span class="line">	......</span><br><span class="line">	<span class="keyword">when</span> 值<span class="number">3</span> <span class="keyword">then</span></span><br><span class="line">	......</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	......</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">case</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span>#不加值的话<span class="keyword">when</span>后边就是个布尔语句</span><br><span class="line">	<span class="keyword">when</span> 条件<span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">	......</span><br><span class="line">	<span class="keyword">when</span> 条件<span class="number">2</span> <span class="keyword">then</span></span><br><span class="line">	......</span><br><span class="line">	<span class="keyword">when</span> 条件<span class="number">3</span> <span class="keyword">then</span></span><br><span class="line">	......</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	......</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">case</span>;</span><br></pre></td></tr></table></figure>

<p>案例：根据不同月份，输出不同的季节。3 4 5月份春季。6 7 8月份夏季。9 10 11月份秋季。12 1 2 冬季。其他非法。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> p8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p8(<span class="keyword">in</span> <span class="keyword">month</span> <span class="type">int</span>, <span class="keyword">out</span> season <span class="type">varchar</span>(<span class="number">100</span>))</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">	<span class="keyword">case</span> <span class="keyword">month</span></span><br><span class="line">		<span class="keyword">when</span> <span class="number">3</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;春季&#x27;</span>;</span><br><span class="line">		<span class="keyword">when</span> <span class="number">4</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;春季&#x27;</span>;</span><br><span class="line">		<span class="keyword">when</span> <span class="number">5</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;春季&#x27;</span>;</span><br><span class="line">		<span class="keyword">when</span> <span class="number">6</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;夏季&#x27;</span>;</span><br><span class="line">		<span class="keyword">when</span> <span class="number">7</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;夏季&#x27;</span>;</span><br><span class="line">		<span class="keyword">when</span> <span class="number">8</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;夏季&#x27;</span>;</span><br><span class="line">		<span class="keyword">when</span> <span class="number">9</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;秋季&#x27;</span>;</span><br><span class="line">		<span class="keyword">when</span> <span class="number">10</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;秋季&#x27;</span>;</span><br><span class="line">		<span class="keyword">when</span> <span class="number">11</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;秋季&#x27;</span>;</span><br><span class="line">		<span class="keyword">when</span> <span class="number">12</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;冬季&#x27;</span>;</span><br><span class="line">		<span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;冬季&#x27;</span>;</span><br><span class="line">		<span class="keyword">when</span> <span class="number">2</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;冬季&#x27;</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;非法月份&#x27;</span>;</span><br><span class="line">	<span class="keyword">end</span> <span class="keyword">case</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* case的第二周语法格式*/</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p8(<span class="keyword">in</span> <span class="keyword">month</span> <span class="type">int</span>, <span class="keyword">out</span> season <span class="type">varchar</span>(<span class="number">100</span>))</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">	<span class="keyword">case</span> </span><br><span class="line">		<span class="keyword">when</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">3</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">4</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">5</span> <span class="keyword">then</span> </span><br><span class="line">			<span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;春季&#x27;</span>;</span><br><span class="line">		<span class="keyword">when</span>  <span class="keyword">month</span> <span class="operator">=</span> <span class="number">6</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">7</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">8</span>  <span class="keyword">then</span> </span><br><span class="line">			<span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;夏季&#x27;</span>;</span><br><span class="line">		<span class="keyword">when</span>  <span class="keyword">month</span> <span class="operator">=</span> <span class="number">9</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">10</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">11</span>  <span class="keyword">then</span> </span><br><span class="line">			<span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;秋季&#x27;</span>;</span><br><span class="line">		<span class="keyword">when</span>  <span class="keyword">month</span> <span class="operator">=</span> <span class="number">12</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">1</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">2</span>  <span class="keyword">then</span> </span><br><span class="line">			<span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;冬季&#x27;</span>;</span><br><span class="line">		<span class="keyword">else</span> </span><br><span class="line">			<span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;非法月份&#x27;</span>;</span><br><span class="line">	<span class="keyword">end</span> <span class="keyword">case</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> p8(<span class="number">9</span>, <span class="variable">@season</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@season</span>;</span><br></pre></td></tr></table></figure>

<h2 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h2><p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">while 条件 do</span><br><span class="line">	循环体;</span><br><span class="line"><span class="keyword">end</span> while;</span><br></pre></td></tr></table></figure>

<p>案例：传入一个数字n，计算1~n中所有偶数的和。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p9(<span class="keyword">in</span> n <span class="type">int</span>,<span class="keyword">out</span> sum <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	ser sum <span class="operator">=</span> <span class="number">0</span>;j </span><br><span class="line">	while n <span class="operator">&gt;</span> <span class="number">0</span> do#确定不为<span class="number">0</span></span><br><span class="line">  		if n <span class="operator">%</span> <span class="number">2</span> <span class="operator">=</span> <span class="number">0</span> <span class="keyword">then</span>#嵌套if语句</span><br><span class="line">    		<span class="keyword">set</span> sum :<span class="operator">=</span> sum <span class="operator">+</span> n;</span><br><span class="line">  		<span class="keyword">end</span> if;</span><br><span class="line">  		<span class="keyword">set</span> n :<span class="operator">=</span> n <span class="operator">-</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">end</span> while;#这里结束循环</span><br><span class="line">	<span class="keyword">select</span> sum;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> mypro(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<h2 id="repeat循环"><a href="#repeat循环" class="headerlink" title="repeat循环"></a>repeat循环</h2><p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">repeat</span><br><span class="line">	循环体;</span><br><span class="line">	until 条件</span><br><span class="line"><span class="keyword">end</span> repeat;</span><br></pre></td></tr></table></figure>

<p>注意：和while的区别是repeat条件成立时结束循环。</p>
<p>案例：传入一个数字n，计算1~n中所有偶数的和。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p10(<span class="keyword">in</span> n <span class="type">int</span>, <span class="keyword">out</span> sum <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">	<span class="keyword">set</span> sum :<span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">	repeat </span><br><span class="line">		if n <span class="operator">%</span> <span class="number">2</span> <span class="operator">=</span> <span class="number">0</span> <span class="keyword">then</span> </span><br><span class="line">		  <span class="keyword">set</span> sum :<span class="operator">=</span> sum <span class="operator">+</span> n;</span><br><span class="line">		<span class="keyword">end</span> if;</span><br><span class="line">		<span class="keyword">set</span> n :<span class="operator">=</span> n <span class="operator">-</span> <span class="number">1</span>;</span><br><span class="line">		until n <span class="operator">&lt;=</span> <span class="number">0</span>    #结束条件</span><br><span class="line">	<span class="keyword">end</span> repeat;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> p10(<span class="number">10</span>, <span class="variable">@sum</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@sum</span>;</span><br></pre></td></tr></table></figure>

<h2 id="loop循环"><a href="#loop循环" class="headerlink" title="loop循环"></a>loop循环</h2><p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> mypro()</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">	<span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">  mylp:loop #开始，mylp是起的名字</span><br><span class="line">		<span class="keyword">set</span> i :<span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">		if i <span class="operator">=</span> <span class="number">5</span> <span class="keyword">then</span> </span><br><span class="line">			leave mylp;#这是结束循环体,相当于break，不加就是死循环</span><br><span class="line">		<span class="keyword">end</span> if;</span><br><span class="line">		<span class="keyword">select</span> i;</span><br><span class="line">	<span class="keyword">end</span> loop; #结束</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> mypro()</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">	<span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">  mylp:loop </span><br><span class="line">		<span class="keyword">set</span> i :<span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">		if i <span class="operator">=</span> <span class="number">5</span> <span class="keyword">then</span> </span><br><span class="line">			iterate mylp;#相当于java的continue，结束本次循环，执行下一次循环</span><br><span class="line">		<span class="keyword">end</span> if;</span><br><span class="line">		if i <span class="operator">=</span> <span class="number">10</span> <span class="keyword">then</span> </span><br><span class="line">		  leave mylp;</span><br><span class="line">		<span class="keyword">end</span> if;</span><br><span class="line">		<span class="keyword">select</span> i;</span><br><span class="line">	<span class="keyword">end</span> loop;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>案例：输出1-5，然后又添加新的需求：输出1234 6789</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> p11;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p11()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	myloop:loop</span><br><span class="line">		<span class="keyword">set</span> i <span class="operator">=</span> i <span class="operator">+</span><span class="number">1</span>;#这里就无限增长</span><br><span class="line">		<span class="comment">/*if i = 6 then leave myloop;是1-5*/</span></span><br><span class="line">		if i <span class="operator">=</span> <span class="number">5</span> <span class="keyword">then</span></span><br><span class="line">		iterate myloop;#i为<span class="number">5</span>就跳过这次循环到下一次</span><br><span class="line">		<span class="keyword">end</span> if;</span><br><span class="line">		</span><br><span class="line">		if i <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">		leave myloop;#为<span class="number">10</span>就停止</span><br><span class="line">		<span class="keyword">end</span> if;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">select</span> i;</span><br><span class="line">	<span class="keyword">end</span> loop;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">call</span> p11;</span><br></pre></td></tr></table></figure>

<h2 id="游标cursor"><a href="#游标cursor" class="headerlink" title="游标cursor"></a>游标cursor</h2><p>游标（cursor）可以理解为一个指向结果集中某条记录的指针，允许程序逐一访问结果集中的每条记录，并对其进行逐行操作和处理。</p>
<p>声明游标的语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> 游标名称 <span class="keyword">cursor</span> <span class="keyword">for</span> 查询语句;</span><br></pre></td></tr></table></figure>

<p>打开游标的语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> 游标名称;</span><br></pre></td></tr></table></figure>

<p>通过游标取数据的语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fetch</span> 游标名称 <span class="keyword">into</span> 变量[,变量,变量......]</span><br></pre></td></tr></table></figure>

<p>关闭游标的语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">close</span> 游标名称;</span><br></pre></td></tr></table></figure>

<p>案例：从dept表查询部门编号和部门名，创建一张新表dept2，将查询结果插入到新表中。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> p12;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p12()</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">	<span class="comment">/*声明变量*/</span></span><br><span class="line">	<span class="keyword">declare</span> dept_no <span class="type">int</span>;</span><br><span class="line">	<span class="keyword">declare</span> dept_name <span class="type">varchar</span>(<span class="number">255</span>);</span><br><span class="line">	<span class="comment">/*声明游标*/</span></span><br><span class="line">	<span class="keyword">declare</span> dept_cursor <span class="keyword">cursor</span> <span class="keyword">for</span> <span class="keyword">select</span> deptno,dname <span class="keyword">from</span> dept;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*创建新表*/</span></span><br><span class="line">	<span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> dept2;</span><br><span class="line">	<span class="keyword">create table</span> dept2(</span><br><span class="line">		deptno <span class="type">int</span>,</span><br><span class="line">		dname <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">	);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*打开游标*/</span></span><br><span class="line">	<span class="keyword">open</span> dept_cursor;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*通过游标取数据*/</span></span><br><span class="line">	<span class="comment">/*fetch dept_cursor into dept_no,dept_name;*/</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*查看以下变量的值*/</span></span><br><span class="line">	<span class="comment">/*select dept_no,dept_name;*/</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*使用循环从游标中取数据*/</span></span><br><span class="line">	while <span class="literal">true</span> do</span><br><span class="line">		<span class="keyword">fetch</span> dept_cursor <span class="keyword">into</span> dept_no,dept_name;</span><br><span class="line">		<span class="comment">/*插入到新表*/</span></span><br><span class="line">		<span class="keyword">insert into</span> dept2(deptno,name) <span class="keyword">values</span>(dept_no,dept_name);</span><br><span class="line">	<span class="keyword">end</span> while;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*关闭游标*/</span></span><br><span class="line">	<span class="keyword">close</span> dept_cursor;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> mypro();</span><br></pre></td></tr></table></figure>

<h2 id="捕捉异常并处理"><a href="#捕捉异常并处理" class="headerlink" title="捕捉异常并处理"></a>捕捉异常并处理</h2><p>语法格式：这里要填三个空，DECLARE (1) HANDLER FOR   (2)(3)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DECLARE handler_name HANDLER FOR condition_value action_statement</span><br></pre></td></tr></table></figure>

<ol>
<li>handler_name 表示异常处理程序的名称，重要取值包括：<ol>
<li>CONTINUE：发生异常后，程序不会终止，会正常执行后续的过程。(捕捉)</li>
<li>EXIT：发生异常后，终止存储过程的执行。（上抛）</li>
</ol>
</li>
<li>condition_value 是指捕获的异常，重要取值包括：<ol>
<li>SQLSTATE sqlstate_value，可以自定义，例如：SQLSTATE ‘02000’</li>
<li>SQLWARNING，代表所有01开头的SQLSTATE</li>
<li>NOT FOUND，代表所有02开头的SQLSTATE</li>
<li>SQLEXCEPTION，代表除了01和02开头的所有SQLSTATE</li>
</ol>
</li>
<li>action_statement 是指异常发生时执行的语句，例如：CLOSE cursor_name</li>
</ol>
<p>给之前的游标添加异常处理机制：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*存储过程中的异常处理机制。异常的捕捉和处理</span></span><br><span class="line"><span class="comment">	实现的功能：以上的p12存储过程中有异常发生了，我们要处理一下，如果发生的异常是notfound，则关闭游标，并且退出存储过程*/</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> p12;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p12()</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">	<span class="keyword">declare</span> dept_no <span class="type">int</span>;</span><br><span class="line">	<span class="keyword">declare</span> dept_name <span class="type">varchar</span>(<span class="number">255</span>);</span><br><span class="line">	<span class="keyword">declare</span> dept_cursor <span class="keyword">cursor</span> <span class="keyword">for</span> <span class="keyword">select</span> deptno,dname <span class="keyword">from</span> dept;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*通常在这个位置进行异常的处理*/</span></span><br><span class="line">	<span class="keyword">declare</span> exit handler <span class="keyword">for</span> <span class="keyword">not</span> found <span class="keyword">close</span> dept_cursor;</span><br><span class="line">	<span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> dept2;</span><br><span class="line">	<span class="keyword">create table</span> dept2(</span><br><span class="line">		deptno <span class="type">int</span>,</span><br><span class="line">		dname <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">	);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">open</span> dept_cursor;</span><br><span class="line"></span><br><span class="line">	while <span class="literal">true</span> do</span><br><span class="line">		<span class="keyword">fetch</span> dept_cursor <span class="keyword">into</span> dept_no,dept_name;</span><br><span class="line">		<span class="keyword">insert into</span> dept2(deptno,name) <span class="keyword">values</span>(dept_no,dept_name);</span><br><span class="line">	<span class="keyword">end</span> while;</span><br><span class="line">	<span class="keyword">close</span> dept_cursor;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> mypro();</span><br></pre></td></tr></table></figure>

<h2 id="存储函数"><a href="#存储函数" class="headerlink" title="存储函数"></a>存储函数</h2><p>存储函数：带返回值的存储过程。参数只允许是in（但不能写显示的写in）。没有out，也没有inout。<br>语法格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION 存储函数名称(参数列表) RETURNS 数据类型 [特征]</span><br><span class="line">BEGIN</span><br><span class="line">	--函数体</span><br><span class="line">	RETURN ...;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<p>“特征”的可取重要值如下：</p>
<ul>
<li>deterministic：用该特征标记该函数为确定性函数（什么是确定性函数？每次调用函数时传同一个参数的时候，返回值都是固定的，比如传100返回120，第二次如果为123就不是确定性的）。这是一种优化策略，这种情况下整个函数体的执行就会省略了，直接返回之前缓存的结果，来提高函数的执行效率。</li>
<li>no sql：用该特征标记该函数执行过程中不会查询数据库，如果确实没有查询语句建议使用。告诉 MySQL 优化器不需要考虑使用查询缓存和优化器缓存来优化这个函数，这样就可以避免不必要的查询消耗产生，从而提高性能。</li>
<li>reads sql data：用该特征标记该函数会进行查询操作，告诉 MySQL 优化器这个函数需要查询数据库的数据，可以使用查询缓存来缓存结果，从而提高查询性能；同时 MySQL 还会针对该函数的查询进行优化器缓存处理。</li>
</ul>
<p>案例：计算1~n的所有偶数之和</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">存储函数</span></span><br><span class="line"><span class="comment">案例：计算1-n的所有偶数之和</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> if <span class="keyword">exists</span> sum_fun;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> sum_fun(n <span class="type">int</span>) <span class="keyword">returns</span> <span class="type">int</span> <span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">	<span class="keyword">declare</span> <span class="keyword">result</span> <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">	while n<span class="operator">&gt;</span><span class="number">0</span> do</span><br><span class="line">		if n<span class="operator">%</span><span class="number">2</span> <span class="operator">=</span> <span class="number">0</span> <span class="keyword">then</span> </span><br><span class="line">			<span class="keyword">set</span> <span class="keyword">result</span> <span class="operator">=</span> <span class="keyword">result</span> <span class="operator">+</span>n;</span><br><span class="line">		<span class="keyword">end</span> if;</span><br><span class="line">		<span class="keyword">set</span> n <span class="operator">=</span> n <span class="operator">-</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">end</span> while;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">result</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*调用存储函数*/</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@result</span> <span class="operator">=</span> sum_fun(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@result</span>;</span><br></pre></td></tr></table></figure>

<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p>MySQL 触发器是一种数据库对象，它是与表相关联的特殊程序。它可以在特定的数据操作（例如插入（INSERT）、更新（UPDATE）或删除（DELETE））触发时自动执行。MySQL 触发器使数据库开发人员能够在数据的不同状态之间维护一致性和完整性，并且可以为特定的数据库表自动执行操作。</p>
<p>触发器的作用主要有以下几个方面：</p>
<ol>
<li>强制实施业务规则：触发器可以帮助确保数据表中的业务规则得到强制执行，例如检查插入或更新的数据是否符合某些规则。 </li>
<li>数据审计：触发器可以声明在执行数据修改时自动记日志或审计数据变化的操作，使数据对数据库管理员和 SQL 审计人员更易于追踪和审计。 </li>
<li>执行特定业务操作：触发器可以自动执行特定的业务操作，例如计算数据行的总数、计算平均值或总和等。</li>
</ol>
<p>MySQL 触发器分为两种类型: BEFORE 和 AFTER。BEFORE 触发器在执行 INSERT、UPDATE、DELETE 语句之前执行，而 AFTER 触发器在执行 INSERT、UPDATE、DELETE 语句之后执行。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg"></p>
<p>创建触发器的语法如下：FOR EACH ROW是解释一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TRIGGER trigger_name</span><br><span class="line">BEFORE/AFTER INSERT/UPDATE/DELETE ON table_name FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">-- 触发器执行的 SQL 语句</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li>trigger_name：触发器的名称</li>
<li>BEFORE&#x2F;AFTER：触发器的类型，可以是 BEFORE 或者 AFTER</li>
<li>INSERT&#x2F;UPDATE&#x2F;DELETE：触发器所监控的 DML 调用类型</li>
<li>table_name：触发器所绑定的表名</li>
<li>FOR EACH ROW：表示触发器在每行受到 DML 的影响之后都会执行</li>
<li>触发器执行的 SQL 语句：该语句会在触发器被触发时执行</li>
</ul>
<p>需要注意的是，触发器是一种高级的数据库功能，只有在必要的情况下才应该使用，例如在需要实施强制性业务规则时。过多的触发器和复杂的触发器逻辑可能会影响查询性能和扩展性。</p>
<p><strong>关于触发器的NEW和OLD关键字：</strong><br>在 MySQL 触发器中，<strong>NEW</strong> 和 <strong>OLD</strong> 是两个特殊的关键字，用于引用在触发器中受到修改的行的新值和旧值。具体而言：</p>
<ul>
<li>NEW：在触发 INSERT 或 UPDATE 操作期间，NEW 用于引用将要插入或更新到表中的新行的值。</li>
<li>OLD：在触发 UPDATE 或 DELETE 操作期间，OLD 用于引用更新或删除之前在表中的旧行的值。</li>
</ul>
<p>通俗的讲，NEW 是指触发器执行的操作所要插入或更新到当前行中的新数据；而 OLD 则是指当前行在触发器执行前原本的数据。</p>
<p>案例：当我们对dept表中的数据进行insert delete update的时候，请将这些操作记录到日志表当中，日志表如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> oper_log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> oper_log(</span><br><span class="line">  id <span class="type">bigint</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">  table_name <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">not null</span> comment <span class="string">&#x27;操作的哪张表&#x27;</span>,</span><br><span class="line">  oper_type <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">not null</span> comment <span class="string">&#x27;操作类型包括insert delete update&#x27;</span>,</span><br><span class="line">  oper_time datetime <span class="keyword">not null</span> comment <span class="string">&#x27;操作时间&#x27;</span>,</span><br><span class="line">  oper_id <span class="type">bigint</span> <span class="keyword">not null</span> comment <span class="string">&#x27;操作的那行记录的id&#x27;</span>,</span><br><span class="line">  oper_desc text comment <span class="string">&#x27;操作描述&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>触发器需求：当向dept表当中insert插入数据之后（after），在oper_log表中记录日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> if <span class="keyword">exists</span> trigger_dept_insert;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trigger_dept_insert</span><br><span class="line"><span class="comment">/* 触发规则 插入一次触发一次*/</span></span><br><span class="line">after <span class="keyword">insert</span> <span class="keyword">on</span> dept <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="comment">/*一但触发之后要执行的sql语句</span></span><br><span class="line"><span class="comment">		id是自增的，后面的concat连接字符串*/</span></span><br><span class="line">	<span class="keyword">insert into</span> oper_log(id, table_name,oper_type,oper_time,oper_id,oper_desc) <span class="keyword">values</span> </span><br><span class="line">	(<span class="keyword">null</span>,<span class="string">&#x27;dept&#x27;</span>,<span class="string">&#x27;insert&#x27;</span>,now(),new.deptno,concat(<span class="string">&#x27;插入数据:deptno=&#x27;</span>,new.deptno,<span class="string">&#x27;dname=&#x27;</span>,new.dname,<span class="string">&#x27;,loc=&#x27;</span>,new.loc));</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>触发器需求：更新dept表之后，在oper_log中记录日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> if <span class="keyword">exists</span> trigger_dept_update;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trigger_dept_update after <span class="keyword">update</span> <span class="keyword">on</span> dept <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">insert into</span> oper_log(id,table_name,oper_type,oper_time,oper_id,oper_desc) <span class="keyword">values</span> </span><br><span class="line">	(<span class="keyword">null</span>,<span class="string">&#x27;dept&#x27;</span>,<span class="string">&#x27;update&#x27;</span>,now(),new.deptno,</span><br><span class="line">	concat(<span class="string">&#x27;更新数据，更新前:deptno=&#x27;</span>,old.deptno,<span class="string">&#x27;,dname=&#x27;</span>,old.dname,<span class="string">&#x27;loc=&#x27;</span>,old.loc,<span class="string">&#x27;,更新后：deptno=&#x27;</span>,new.deptno,<span class="string">&#x27;dname=&#x27;</span>,new.dname,<span class="string">&#x27;,loc=&#x27;</span>,new.loc));</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<h1 id="第13章-存储引擎"><a href="#第13章-存储引擎" class="headerlink" title="第13章 存储引擎"></a>第13章 存储引擎</h1><h2 id="存储引擎概述"><a href="#存储引擎概述" class="headerlink" title="存储引擎概述"></a>存储引擎概述</h2><p>MySQL存储引擎决定了数据在磁盘上的存储方式和访问方式。不同的存储引擎实现了不同的存储和检索算法，因此它们在处理和管理数据的方式上存在差异。</p>
<p>MySQL常见的存储引擎包括InnoDB、MyISAM、Memory、Archive等。每个存储引擎都有自己的特点和适用场景。</p>
<p>例如，</p>
<ul>
<li>InnoDB引擎支持事务和行级锁定，适用于需要高并发读写的应用；</li>
<li>MyISAM引擎不支持事务，但适用于读操作较多的应用；</li>
<li>Memory引擎数据全部存储在内存中，适用于对读写速度要求很高的应用等等。</li>
</ul>
<p>选择适合的存储引擎可以提高MySQL的性能和效率，并且根据应用需求来合理选择存储引擎可以提供更好的数据管理和查询功能。</p>
<h2 id="MySQL支持哪些存储引擎"><a href="#MySQL支持哪些存储引擎" class="headerlink" title="MySQL支持哪些存储引擎"></a>MySQL支持哪些存储引擎</h2><p>使用<code>show engines \G;</code>命令可以查看所有的存储引擎：比如</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">      Engine: MEMORY</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: Hash based, stored <span class="keyword">in</span> memory, useful <span class="keyword">for</span> temporary tables</span><br><span class="line">Transactions: <span class="keyword">NO</span></span><br><span class="line">          XA: <span class="keyword">NO</span></span><br><span class="line">  Savepoints: <span class="keyword">NO</span></span><br></pre></td></tr></table></figure>

<p><code>Support</code>是<code>Yes</code>的表示支持该存储引擎。当前MySQL的版本是<code>8.0.33</code><br>MySQL默认的存储引擎是：<code>InnoDB</code></p>
<h2 id="指定和修改存储引擎"><a href="#指定和修改存储引擎" class="headerlink" title="指定和修改存储引擎"></a>指定和修改存储引擎</h2><h3 id="指定存储引擎"><a href="#指定存储引擎" class="headerlink" title="指定存储引擎"></a>指定存储引擎</h3><p>在MySQL中，你可以在创建表时指定使用的存储引擎。通过在CREATE TABLE语句中使用ENGINE关键字，你可以指定要使用的存储引擎。</p>
<p>以下是指定存储引擎的示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> my_table (column1 <span class="type">INT</span>, column2 <span class="type">VARCHAR</span>(<span class="number">50</span>)) ENGINE <span class="operator">=</span> InnoDB;</span><br></pre></td></tr></table></figure>

<p>如果你不显式指定存储引擎，MySQL将使用默认的存储引擎。默认情况下，MySQL 8的默认存储引擎是InnoDB。</p>
<h3 id="修改存储引擎"><a href="#修改存储引擎" class="headerlink" title="修改存储引擎"></a>修改存储引擎</h3><p>在MySQL中，你可以通过ALTER TABLE语句修改表的存储引擎。下面是修改存储引擎的示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> my_table ENGINE <span class="operator">=</span> MyISAM;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，我们使用ALTER TABLE语句将my_table表的存储引擎修改为MyISAM。</p>
<p>请注意，在修改存储引擎之前，你需要考虑以下几点：</p>
<ol>
<li>修改存储引擎可能需要执行复制表的操作，因此可能会造成数据的丢失或不可用。确保在执行修改之前备份你的数据。 </li>
<li>不是所有的存储引擎都支持相同的功能。要确保你选择的新存储引擎支持你应用程序所需的功能。 </li>
<li>修改表的存储引擎可能会影响到现有的应用程序和查询。确保在修改之前评估和测试所有的影响。 </li>
<li>ALTER TABLE语句可能需要适当的权限才能执行。确保你拥有足够的权限来执行修改存储引擎的操作。</li>
</ol>
<p>总而言之，修改存储引擎需要谨慎进行，且需要考虑到可能的影响和风险。建议在进行修改之前进行适当的测试和备份。</p>
<h2 id="常用的存储引擎及适用场景"><a href="#常用的存储引擎及适用场景" class="headerlink" title="常用的存储引擎及适用场景"></a>常用的存储引擎及适用场景</h2><p>在实际开发中，以下存储引擎是比较常用的：</p>
<ol>
<li>InnoDB：<ol>
<li>MySQL默认的事务型存储引擎</li>
<li>支持ACID事务</li>
<li>具有较好的并发性能和数据完整性</li>
<li>支持行级锁定。</li>
<li>适用于大多数应用场景，尤其是需要事务支持的应用。</li>
</ol>
</li>
<li>MyISAM：<ol>
<li>是MySQL早期版本中常用的存储引擎</li>
<li>支持全文索引和表级锁定</li>
<li>不支持事务</li>
<li>由于其简单性和高性能，在某些特定的应用场景中会得到广泛应用，如<strong>读密集</strong>的应用。</li>
</ol>
</li>
<li>MEMORY：<ol>
<li>称为HEAP，是将表<strong>存储在内存</strong>中的存储引擎</li>
<li>具有非常高的读写性能，但数据会在服务器重启时丢失。</li>
<li>适用于需要快速读写的临时数据集、缓存和临时表等场景。</li>
</ol>
</li>
<li>CSV：<ol>
<li>将数据以<strong>纯文本</strong>格式存储的存储引擎</li>
<li>适用于需要处理和导入&#x2F;导出CSV格式数据的场景。</li>
</ol>
</li>
<li>ARCHIVE：<ol>
<li>将数据高效地进行<strong>压缩</strong>和存储的存储引擎</li>
<li>适用于需要长期存储大量历史数据且不经常查询的场景。</li>
</ol>
</li>
</ol>
<h1 id="第14章-索引"><a href="#第14章-索引" class="headerlink" title="第14章 索引"></a>第14章 索引</h1><h2 id="什么是索引（index）"><a href="#什么是索引（index）" class="headerlink" title="什么是索引（index）"></a>什么是索引（index）</h2><p>索引是一种能够提高检索（查询）效率的提前排好序的数据结构。例如：书的目录就是一种索引机制。索引是解决SQL慢查询的一种方式。</p>
<h2 id="索引的创建和删除"><a href="#索引的创建和删除" class="headerlink" title="索引的创建和删除"></a>索引的创建和删除</h2><h3 id="主键会自动添加索引"><a href="#主键会自动添加索引" class="headerlink" title="主键会自动添加索引"></a>主键会自动添加索引</h3><p>主键字段会自动添加索引，不需要程序员干涉，主键字段上的索引被称为<code>主键索引</code></p>
<h3 id="unique约束的字段自动添加索引"><a href="#unique约束的字段自动添加索引" class="headerlink" title="unique约束的字段自动添加索引"></a>unique约束的字段自动添加索引</h3><p>unique约束的字段也会自动添加索引，不需要程序员干涉，这种字段上添加的索引称为<code>唯一索引</code></p>
<h3 id="给指定的字段添加索引"><a href="#给指定的字段添加索引" class="headerlink" title="给指定的字段添加索引"></a>给指定的字段添加索引</h3><p>建表时添加索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> emp (</span><br><span class="line">    ...</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    ...</span><br><span class="line">    INDEX idx_name (name)</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果表已经创建好了，后期给字段添加索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> emp <span class="keyword">ADD</span> INDEX idx_name (name);</span><br></pre></td></tr></table></figure>

<p>也可以这样添加索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_name <span class="keyword">on</span> emp(name);</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg"></p>
<h3 id="删除指定字段上的索引"><a href="#删除指定字段上的索引" class="headerlink" title="删除指定字段上的索引"></a>删除指定字段上的索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> emp <span class="keyword">DROP</span> INDEX idx_name;</span><br></pre></td></tr></table></figure>

<h3 id="查看某张表上添加了哪些索引"><a href="#查看某张表上添加了哪些索引" class="headerlink" title="查看某张表上添加了哪些索引"></a>查看某张表上添加了哪些索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure>

<h2 id="索引的分类"><a href="#索引的分类" class="headerlink" title="索引的分类"></a>索引的分类</h2><p>不同的<code>存储引擎</code>有不同的索引类型和实现：</p>
<ul>
<li>按照数据结构分类：<ul>
<li>B+树 索引（mysql的InnoDB存储引擎采用的就是这种索引）采用 B+树  的数据结构</li>
<li>Hash 索引（仅 <code>memory</code> 存储引擎支持）：采用  哈希表  的数据结构</li>
</ul>
</li>
<li>按照物理存储分类：<ul>
<li>聚集索引：索引和表中数据在一起，数据存储的时候就是按照索引顺序存储的。一张表只能有一个聚集索引。</li>
<li>非聚集索引：索引和表中数据是分开的，索引是独立于表空间的，一张表可以有多个非聚集索引。</li>
</ul>
</li>
<li>按照字段特性分类：<ul>
<li>主键索引（primary key）</li>
<li>唯一索引（unique）</li>
<li>普通索引（index）</li>
<li>全文索引（fulltext：仅 <code>InnoDB和MyISAM</code> 存储引擎支持）</li>
</ul>
</li>
<li>按照字段个数分类：<ul>
<li>单列索引、联合索引（也叫复合索引、组合索引）</li>
</ul>
</li>
</ul>
<h2 id="MySQL索引采用了B-树数据结构"><a href="#MySQL索引采用了B-树数据结构" class="headerlink" title="MySQL索引采用了B+树数据结构"></a>MySQL索引采用了B+树数据结构</h2><p>常见的树相关的数据结构包括：</p>
<ul>
<li>二叉树</li>
<li>红黑树</li>
<li>B树</li>
<li>B+树</li>
</ul>
<p>区别：树的高度不同。树的高度越低，性能越高。这是因为每一个节点都是一次I&#x2F;O</p>
<h3 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329173213108.png" alt="image-20250329173213108"></p>
<p>如果不给id字段添加索引，默认进行全表扫描，那至少要进行10次磁盘IO。可以给id字段添加索引，假设该索引使用了二叉树这种数据结构，这个二叉树是这样的</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329173357068.png" alt="image-20250329173357068"></p>
<p>如果这个时候要找id&#x3D;10的数据，需要的IO次数是？4次。效率显著提升了。</p>
<p>但是MySQL并没有直接使用这种普通的二叉树，这种普通二叉树在<code>数据极端</code>的情况下，效率较低。比如下面的数据</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329173419549.png" alt="image-20250329173419549"></p>
<p>如果给id字段添加索引，并且该索引底层使用了普通二叉树，这棵树会是这样的：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329173438375.png" alt="image-20250329173438375"></p>
<p>你虽然使用了二叉树，但这更像一个链表。查找效率等同于链表查询O(n)【<strong>查找算法的时间复杂度是线性的</strong>】。查找效率极低。<br>因此对于MySQL来说，它并没有选择这种数据结构作为索引。</p>
<h3 id="红黑树（自平衡二叉树）"><a href="#红黑树（自平衡二叉树）" class="headerlink" title="红黑树（自平衡二叉树）"></a>红黑树（自平衡二叉树）</h3><p>通过自旋平衡规则进行旋转，子节点会自动分叉为2个分支，从而减少树的高度，当数据有序插入时比二叉树数据检索性能更好。</p>
<p>给id字段添加索引，并且该索引使用了<code>红黑树</code>数据结构，那么会是这样：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329173501132.png" alt="image-20250329173501132"></p>
<p>如果查找id&#x3D;10的数据，磁盘IO次数为：5次。效率比普通二叉树要高一些。</p>
<p>但是如果数据量庞大，例如500万条数据，也会导致树的高度很高，磁盘IO次数仍然很多，查询效率也会比较低。</p>
<p>因此MySQL并没有使用红黑树这种数据结构作为索引。</p>
<h3 id="B-Trees（B树）"><a href="#B-Trees（B树）" class="headerlink" title="B Trees（B树）"></a>B Trees（B树）</h3><p>B Trees首先是一个<code>自平衡</code>的。<br>B Trees每个节点下的子节点数量 &gt; 2。<br>B Trees每个节点中也不是存储单个数据，可以存储多个数据。<br>B Trees又称为<code>平衡多路查找树</code>。</p>
<p>B Trees分支的数量不是2，是大于2，具体是多少个分支，由<code>阶</code>决定。例如：</p>
<ul>
<li>3阶的B Trees，一个节点下最多有3个子节点，每个节点中最多有2个数据。</li>
<li>4阶的B Trees，一个节点下最多有4个子节点，每个节点中最多有3个数据。</li>
<li>5阶（5, 4）</li>
<li>6阶（6, 5）</li>
<li>….</li>
<li>16阶（16, 15）【MySQL采用了16阶】</li>
</ul>
<p>采用B Trees，你会发现相同的数据量，<strong>B Tree 树的高度更低</strong>。磁盘IO次数更少。</p>
<p>更加详细的存储是这样的，请看下图</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329174543637.png" alt="image-20250329174543637"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329174546953.png" alt="image-20250329174546953"></p>
<p>在B Trees中，每个节点不仅存储了<code>索引值</code>，还存储该索引值对应的<code>数据行</code>。<br>并且每个节点中的p1 p2 p3是指向下一个节点的指针。</p>
<p>B Trees数据结构存在的缺点是：不适合做区间查找，对于区间查找效率较低。假设要查id在[3~7]之间的，需要查找的是3,4,5,6,7。那么查这每个索引值都需要从头(根）节点开始向下找。<br>因此MySQL使用了B+ Trees解决了这个问题。</p>
<h3 id="B-Trees（B-树）"><a href="#B-Trees（B-树）" class="headerlink" title="B+ Trees（B+ 树）"></a>B+ Trees（B+ 树）</h3><p>B+ Trees 相较于 B Trees改进了哪些？</p>
<ul>
<li>B+树将数据都存储在叶子节点中。并且叶子节点之间使用链表连接，这样很适合范围查询。</li>
<li>B+树的非叶子节点上只有索引值，没有数据，所以非叶子节点可以存储更多的索引值，这样让B+树更矮更胖，提高检索效率。</li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329183545137.png" alt="image-20250329183545137"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329183548087.png" alt="image-20250329183548087"></p>
<p>**经典面试题：**mysql为什么选择B+树作为索引的数据结构，而不是B树？</p>
<ol>
<li>非叶子节点上可以存储更多的键值，阶数可以更大，更矮更胖，磁盘IO次数少，数据查询效率高。</li>
<li>所有数据都是有序存储在叶子节点上，让范围查找，分组查找效率更高。</li>
<li>数据页之间、数据记录之间采用链表链接，让升序降序更加方便操作。</li>
</ol>
<p>**经典面试题：**如果一张表没有主键索引，那还会创建B+树吗？<br>当一张表没有主键索引时，默认会使用一个隐藏的内置的聚集索引（clustered index）。这个聚集索引是基于表的物理存储顺序构建的，通常是使用B+树来实现的。</p>
<p>（老杜说如果没有主键索引之类的，会有一个看不见的row_id列，这个采用的也是b+树</p>
<h2 id="其他索引及相关调优"><a href="#其他索引及相关调优" class="headerlink" title="其他索引及相关调优"></a>其他索引及相关调优</h2><h3 id="Hash索引"><a href="#Hash索引" class="headerlink" title="Hash索引"></a>Hash索引</h3><p>支持Hash索引的存储引擎有：</p>
<ul>
<li>InnoDB（不支持手动创建Hash索引，系统会自动维护一个<code>自适应的Hash索引</code>）<ul>
<li>对于InnoDB来说，即使手动指定了某字段采用Hash索引，最终<code>show index from 表名</code>的时候，还是<code>BTREE</code>。</li>
</ul>
</li>
<li>Memory（支持Hash索引）</li>
</ul>
<p>Hash索引底层的数据结构就是哈希表。一个数组，数组中每个元素是链表。和java中HashMap一样。哈希表中每个元素都是key value结构。key存储<code>索引值</code>，value存储<code>行指针</code>。</p>
<p>原理如下：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330031102099.png" alt="image-20250330031102099"></p>
<p>如果name字段上添加了Hash索引idx_name</p>
<p>Hash索引长这个样子：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330031111481.png" alt="image-20250330031111481"></p>
<p>Hash索引优缺点：</p>
<ul>
<li>优点：只能用在等值比较中，效率很高。例如：name&#x3D;’孙悟空’</li>
<li>缺点：不支持排序，不支持范围查找。</li>
</ul>
<h3 id="聚集索引和非聚集索引"><a href="#聚集索引和非聚集索引" class="headerlink" title="聚集索引和非聚集索引"></a>聚集索引和非聚集索引</h3><p>按照数据的物理存储方式不同，可以将索引分为聚集索引（聚簇索引）和非聚集索引（非聚簇索引）。</p>
<p>存储引擎是InnoDB的，主键上的索引属于聚集索引。<br>存储引擎是MyISAM的，任意字段上的索引都是非聚集索引。</p>
<p>InnoDB的物理存储方式：当创建一张表t_user，并使用InnoDB存储引擎时，会在硬盘上生成这样一个文件：</p>
<ul>
<li>t_user.ibd （InnoDB data表索引 + 数据）</li>
<li>t_user.frm （存储表结构信息）</li>
</ul>
<p>MyISAM的物理存储方式：当创建一张表t_user，并使用MyISAM存储引擎时，会在硬盘上生成这样一个文件：</p>
<ul>
<li>t_user.MYD （表数据）</li>
<li>t_user.MYI （表索引）</li>
<li>t_user.frm （表结构）</li>
</ul>
<p><strong>注意：从MySQL8.0开始，不再生成frm文件了，引入了数据字典，用数据字典来统一存储表结构信息，例如：</strong></p>
<ul>
<li><strong>information_schema.TABLES （表包含了数据库中所有表的信息，例如表名、数据库名、引擎类型等）</strong></li>
<li><strong>information_schema.COLUMNS（表包含了数据库中所有表的列信息，例如列名、数据类型、默认值等）</strong></li>
</ul>
<p>聚集索引的原理图：（B+树，叶子节点上存储了索引值 + 数据）</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330031250867.png" alt="image-20250330031250867"></p>
<p>非聚集索引的原理图：（B+树，叶子节点上存储了索引值 + 行指针）</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330031257831.png" alt="image-20250330031257831"></p>
<p>聚集索引的优点和缺点：</p>
<ol>
<li>优点：聚集索引将数据存储在索引树的叶子节点上。可以减少一次查询，因为查询索引树的同时可以获取数据。</li>
<li>缺点：对数据进行修改或删除时需要更新索引树，会增加系统的开销。</li>
</ol>
<h3 id="二级索引"><a href="#二级索引" class="headerlink" title="二级索引"></a>二级索引</h3><p>二级索引也属于非聚集索引。也有人把二级索引称为辅助索引。<br>有表t_user，id是主键。age是非主键。在age字段上添加的索引称为二级索引。（所有非主键索引都是二级索引）</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330153957615.png" alt="image-20250330153957615"></p>
<p>二级索引的数据结构：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330154004773.png" alt="image-20250330154004773"></p>
<p>二级索引的查询原理：<br>假设查询语句为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> age <span class="operator">=</span> <span class="number">30</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330154020322.png" alt="image-20250330154020322"></p>
<p>为什么会“回表”？因为使用了<code>select *</code>，查到了age&#x3D;30后会得到主键&#x3D;2，然后底层执行查主键&#x3D;2的数据再返回。<br>避免“回表【回到原数据表】”是提高SQL执行效率的手段。例如：select id from t_user where age &#x3D; 30; 这样的SQL语句是不需要回表的。</p>
<h3 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h3><p>覆盖索引（Covering Index），顾名思义，是指某个查询语句可以通过索引的覆盖来完成，而不需要回表查询真实数据。其中的覆盖指的是在执行查询语句时，查询需要的所有列都可以从索引中提取到，而不需要再去查询实际数据行获取查询所需数据。<br>当使用覆盖索引时，MySQL可以直接通过索引，也就是索引上的数据来获取所需的结果，而不必再去查找表中的数据。这样可以显著提高查询性能。</p>
<p>假设有一个用户表（user）包含以下列：id, username, email, age。</p>
<p>常见的查询是根据用户名查询用户的邮箱。如果为了提高这个查询的性能，可以创建一个覆盖索引，包含（username, email）这两列。</p>
<p>创建覆盖索引的SQL语句可以如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_username_email <span class="keyword">ON</span> <span class="keyword">user</span> (username, email);</span><br></pre></td></tr></table></figure>

<p>当执行以下查询时：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> email <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;lucy&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>MySQL可以直接使用覆盖索引（idx_user_username_email）来获取查询结果，而不必再去查找用户表中的数据。这样可以减少磁盘I&#x2F;O并提高查询效率。而如果没有覆盖索引，MySQL会先使用索引（username）来找到匹配的行，然后再回表查询获取邮箱，这个过程会增加更多的磁盘I&#x2F;O和查询时间。</p>
<h3 id="索引下推"><a href="#索引下推" class="headerlink" title="索引下推"></a>索引下推</h3><p>索引下推（Index Condition Pushdown）是一种 MySQL 中的优化方法，它可以将查询中的过滤条件下推到索引层级中处理，从而减少回表次数，优化查询性能。</p>
<p>具体来说，在使用索引下推时，MySQL 会在索引的叶节点层级执行查询的过滤条件，过滤掉无用的索引记录，仅返回符合条件的记录的主键，这样就可以避免查询时回表读取表格的数据行，从而缩短了整个查询过程的时间。</p>
<p>假设有以下表结构：</p>
<p>表名：users</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>age</th>
<th>city</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>John</td>
<td>25</td>
<td>New York</td>
</tr>
<tr>
<td>2</td>
<td>Alice</td>
<td>30</td>
<td>London</td>
</tr>
<tr>
<td>3</td>
<td>Bob</td>
<td>40</td>
<td>Paris</td>
</tr>
<tr>
<td>4</td>
<td>Olivia</td>
<td>35</td>
<td>Berlin</td>
</tr>
<tr>
<td>5</td>
<td>Michael</td>
<td>28</td>
<td>Sydney</td>
</tr>
</tbody></table>
<p>现在我们创建了一个多列索引：（索引下推通常是基于多列索引的。）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE users ADD INDEX idx_name_city_age (name, city, age);</span><br></pre></td></tr></table></figure>

<p>假设我们要查询年龄大于30岁，并且所在城市是”London”的用户，假设只给age字段添加了索引，它就不会使用索引下推。传统的查询优化器会将所有满足年龄大于30岁的记录读入内存，然后再根据城市进行筛选。</p>
<p>使用索引下推优化后，在索引范围扫描的过程中，优化器会判断只有在城市列为”London”的情况下，才会将满足年龄大于30岁的记录加载到内存中。这样就可以避免不必要的IO和数据传输，提高查询性能。</p>
<p>具体的查询语句可以是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE age &gt; 30 AND city = &#x27;London&#x27;;</span><br></pre></td></tr></table></figure>

<p>在执行这个查询时，优化器会使用索引下推技术，先根据索引范围扫描找到所有满足条件的记录，然后再回到原数据表中获取完整的行数据，最终返回结果。</p>
<h3 id="单列索引（单一索引）"><a href="#单列索引（单一索引）" class="headerlink" title="单列索引（单一索引）"></a>单列索引（单一索引）</h3><p>单列索引是指对数据库表中的某一列或属性进行索引创建，对该列进行快速查找和排序操作。单列索引可以加快查询速度，提高数据库的性能。</p>
<p>举个例子，假设我们有一个学生表（student），其中有以下几个列：学生编号（student_id）、姓名（name）、年龄（age）和性别（gender）。</p>
<p>如果我们针对学生表的学生编号（student_id）列创建了单列索引，那么可以快速地根据学生编号进行查询或排序操作。例如，我们可以使用以下SQL语句查询学生编号为123456的学生信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student_id <span class="operator">=</span> <span class="number">123456</span>;</span><br></pre></td></tr></table></figure>

<p>由于我们对学生编号列建立了单列索引，所以数据库可以直接通过索引快速定位到具有学生编号123456的那一行记录，从而加快查询速度。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg"></p>
<h3 id="复合索引（组合索引）"><a href="#复合索引（组合索引）" class="headerlink" title="复合索引（组合索引）"></a>复合索引（组合索引）</h3><p>复合索引（Compound Index）也称为多列索引（Multi-Column Index），是指对数据库表中多个列进行索引创建。</p>
<p>与单列索引不同，复合索引可以包含多个列。这样可以将多个列的值组合起来作为索引的键，以提高多列条件查询的效率。</p>
<p>举个例子，假设我们有一个订单表（Order），其中包含以下几个列：订单编号（OrderID）、客户编号（CustomerID）、订单日期（OrderDate）和订单金额（OrderAmount）。</p>
<p>如果我们为订单表的客户编号和订单日期这两列创建复合索引（CustomerID, OrderDate），那么可以在查询时同时根据客户编号和订单日期来快速定位到匹配的记录。</p>
<p>例如，我们可以使用以下SQL语句查询客户编号为123456且订单日期为2021-01-01的订单信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">Order</span> <span class="keyword">WHERE</span> CustomerID <span class="operator">=</span> <span class="number">123456</span> <span class="keyword">AND</span> OrderDate <span class="operator">=</span> <span class="string">&#x27;2021-01-01&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>由于我们为客户编号和订单日期创建了复合索引，数据库可以使用这个索引来快速定位到符合条件的记录，从而加快查询速度。复合索引的使用能够提高多列条件查询的效率，但需要注意的是，复合索引的创建和维护可能会增加索引的存储空间和对于写操作的影响。</p>
<p><strong>相对于单列索引，复合索引有以下几个优势：</strong></p>
<ol>
<li>减少索引的数量：复合索引可以包含多个列，因此可以减少索引的数量，减少索引的存储空间和维护成本。</li>
<li>提高查询性能：当查询条件中涉及到复合索引的多个列时，数据库可以使用复合索引进行快速定位和过滤，从而提高查询性能。</li>
<li>覆盖查询：如果复合索引包含了所有查询需要的列，那么数据库可以直接使用索引中的数据，而不需要再进行表的读取，从而提高查询性能。</li>
<li>排序和分组：由于复合索引包含多个列，因此可以用于排序和分组操作，从而提高排序和分组的性能。</li>
</ol>
<h2 id="索引的优缺点"><a href="#索引的优缺点" class="headerlink" title="索引的优缺点"></a>索引的优缺点</h2><p>索引是数据库中一种重要的数据结构，用于加速数据的检索和查询操作。它的优点和缺点如下：</p>
<p>优点：</p>
<ol>
<li>提高查询性能：通过创建索引，可以大大减少数据库查询的数据量，从而提升查询的速度。</li>
<li>加速排序：当查询需要按照某个字段进行排序时，索引可以加速排序的过程，提高排序的效率。</li>
<li>减少磁盘IO：索引可以减少磁盘IO的次数，这对于磁盘读写速度较低的场景，尤其重要。</li>
</ol>
<p>缺点：</p>
<ol>
<li>占据额外的存储空间：索引需要占据额外的存储空间，特别是在大型数据库系统中，索引可能占据较大的空间。</li>
<li>增删改操作的性能损耗：每次对数据表进行插入、更新、删除等操作时，需要更新索引，会导致操作的性能降低。</li>
<li>资源消耗较大：索引需要占用内存和CPU资源，特别是在大规模并发访问的情况下，可能对系统的性能产生影响。</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg"></p>
<h2 id="何时用索引"><a href="#何时用索引" class="headerlink" title="何时用索引"></a>何时用索引</h2><p>在以下情况下建议使用索引：</p>
<ol>
<li>频繁执行查询操作的字段：如果这些字段经常被查询，使用索引可以提高查询的性能，减少查询的时间。 </li>
<li>大表：当表的数据量较大时，使用索引可以快速定位到所需的数据，提高查询效率。 </li>
<li>需要排序或者分组的字段：在对字段进行排序或者分组操作时，索引可以减少排序或者分组的时间。 </li>
<li>外键关联的字段：在进行表之间的关联查询时，使用索引可以加快关联查询的速度。</li>
</ol>
<p>在以下情况下不建议使用索引：</p>
<ol>
<li>频繁执行更新操作的表：如果表经常被更新数据，使用索引可能会降低更新操作的性能，因为每次更新都需要维护索引。 </li>
<li>小表：对于数据量较小的表，使用索引可能并不会带来明显的性能提升，反而会占用额外的存储空间。 </li>
<li>对于唯一性很差的字段（重复字段），一般不建议添加索引。当一个字段的唯一性很差时，查询操作基本上需要扫描整个表的大部分数据。如果为这样的字段创建索引，索引的大小可能会比数据本身还大，导致索引的存储空间占用过高，同时也会导致查询操作的性能下降。</li>
</ol>
<p>总之，索引需要根据具体情况进行使用和权衡，需要考虑到表的大小、查询频率、更新频率以及业务需求等因素。</p>
<h1 id="第15章-mysql优化"><a href="#第15章-mysql优化" class="headerlink" title="第15章 mysql优化"></a>第15章 mysql优化</h1><h2 id="MySQL优化手段"><a href="#MySQL优化手段" class="headerlink" title="MySQL优化手段"></a>MySQL优化手段</h2><p>MySQL数据库的优化手段通常包括但不限于：</p>
<ul>
<li>SQL查询优化：这是最低成本的优化手段，通过优化查询语句、适当添加索引等方式进行。并且效果显著。</li>
<li>库表结构优化：通过规范化设计、优化索引和数据类型等方式进行库表结构优化，需要对数据库结构进行调整和改进</li>
<li>系统配置优化：根据硬件和操作系统的特点，调整最大连接数、内存管理、IO调度等参数</li>
<li>硬件优化：升级硬盘、增加内存容量、升级处理器等硬件方面的投入，需要购买和替换硬件设备，成本较高</li>
</ul>
<p>我们主要掌握：SQL查询优化</p>
<h2 id="SQL性能分析工具"><a href="#SQL性能分析工具" class="headerlink" title="SQL性能分析工具"></a>SQL性能分析工具</h2><h3 id="查看数据库整体情况"><a href="#查看数据库整体情况" class="headerlink" title="查看数据库整体情况"></a>查看数据库整体情况</h3><p>通过以下命令可以查看当前数据库在SQL语句执行方面的整体情况：status状态</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;Com_select&#x27;</span>;<span class="operator">/</span><span class="operator">/</span>会显示查询的次数，以此类推</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;Com_insert&#x27;</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;Com_delete&#x27;</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;Com_update&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;Com_______&#x27;</span>;<span class="operator">/</span><span class="operator">/</span><span class="number">7</span>个</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330194023692.png" alt="image-20250330194023692"></p>
<p>这些结果反映了从 MySQL 服务器启动到当前时刻，所有的 SELECT 查询总数。对于 MySQL 性能优化来说，通过查看 <code>Com_select</code> 的值可以了解 SELECT 查询在整个 MySQL 服务期间所占比例的情况：</p>
<ul>
<li>如果 <code>Com_select</code> 次数过高，可能说明查询表中的每条记录都会返回过多的字段。</li>
<li>如果 <code>Com_select</code> 次数很少，同时insert或delete或update的次数很高，可能说明服务器运行的应用程序过于依赖写入操作和少量读取操作。</li>
</ul>
<p>总之，通过查看 <code>Com_select</code> 的值，可以了解 MySQL 服务器的长期执行情况，并在优化查询性能时，帮助我们了解 MySQL 的性能瓶颈。</p>
<h3 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h3><p>慢查询日志文件可以将查询较慢的DQL语句记录下来（比如select超过三秒），便于我们定位需要调优的select语句。<br>通过以下命令查看慢查询日志功能是否开启：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">慢查询日志</span></span><br><span class="line"><span class="comment">1. 默认情况下，慢查询日志功能是关闭的。查看慢查询日志功能是否开启</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> variables <span class="keyword">like</span> <span class="string">&#x27;slow_query_log&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330194423350.png" alt="image-20250330194423350"></p>
<p>慢查询日志功能默认是关闭的。请修改my.ini文件来开启慢查询日志功能，在my.ini的[mysqld]后面添加如下配置：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330194430602.png" alt="image-20250330194430602"></p>
<p>注意：slow_query_log&#x3D;1表示开启慢查询日志功能，long_query_time&#x3D;3表示：只要SELECT语句的执行耗时超过3秒则将其记录到慢查询日志中。<br>重启mysql服务。再次查看是否开启慢查询日志功能：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330194447327.png" alt="image-20250330194447327"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330194450970.png" alt="image-20250330194450970"></p>
<p>尝试执行一条时长超过3秒的select语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sleep(<span class="number">4</span>) <span class="keyword">from</span> emp <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;smith&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>慢查询日志文件默认存储在：C:\dev\mysql-8.0.36-winx64\data 目录下，默认的名字是：计算机名-slow.log<br>通过该文件可以清晰的看到哪些DQL语句属于慢查询：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330194516704.png" alt="image-20250330194516704"></p>
<h3 id="show-profiles"><a href="#show-profiles" class="headerlink" title="show profiles"></a>show profiles</h3><p>通过show profiles可以查看一个SQL语句在执行过程中具体的耗时情况。帮助我们更好的定位问题所在。</p>
<p>查看当前数据库是否支持 profile操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @<span class="variable">@have_profiling</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330213227972.png" alt="image-20250330213227972"></p>
<p>查看 profiling 开关是否打开：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> profiling <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330213239524.png" alt="image-20250330213239524"></p>
<p>可以执行多条DQL语句，然后使用 show profiles; 来查看当前数据库中执行过的每个SELECT语句的耗时情况。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp <span class="keyword">where</span> empno<span class="operator">=</span><span class="number">7369</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">show</span> profiles;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330213249496.png" alt="image-20250330213249496"></p>
<p>查看某个SQL语句语句在执行过程中，每个阶段的耗时情况：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> profile <span class="keyword">for</span> query <span class="number">4</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330213301032.png" alt="image-20250330213301032"></p>
<p>想查看执行过程中cpu的情况，可以执行以下命令：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> profile cpu <span class="keyword">for</span> query <span class="number">4</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330213313870.png" alt="image-20250330213313870"></p>
<h3 id="explain"><a href="#explain" class="headerlink" title="explain"></a>explain</h3><p>explain命令可以查看一个DQL语句的执行计划，根据执行计划可以做出相应的优化措施。提高执行效率。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> empno<span class="operator">=</span><span class="number">7369</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331032419259.png" alt="image-20250331032419259"></p>
<h4 id="id"><a href="#id" class="headerlink" title="id"></a>id</h4><p>id反映出一条select语句执行顺序，id越大优先级越高。id相同则按照自上而下的顺序执行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> e.ename,d.dname <span class="keyword">from</span> emp e <span class="keyword">join</span> dept d <span class="keyword">on</span> e.deptno<span class="operator">=</span>d.deptno <span class="keyword">join</span> salgrade s <span class="keyword">on</span> e.sal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331032443025.png" alt="image-20250331032443025"></p>
<p>由于id相同，反映出三张表在执行顺序上属于平等关系，执行时采用，先d，再e，最后s。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> e.ename,d.dname <span class="keyword">from</span> emp e <span class="keyword">join</span> dept d <span class="keyword">on</span> e.deptno<span class="operator">=</span>d.deptno <span class="keyword">where</span> e.sal<span class="operator">=</span>(<span class="keyword">select</span> sal <span class="keyword">from</span> emp <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;ford&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331032502180.png" alt="image-20250331032502180"></p>
<p>反映出，先执行子查询，然后让e和d做表连接。</p>
<h4 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h4><p>反映了mysql查询语句的类型。常用值包括：</p>
<ul>
<li>SIMPLE：表示查询中不包含子查询或UNION操作。这种查询通常包括一个表或是最多一个联接（JOIN）</li>
<li>PRIMARY：表示当前查询是一个主查询。（主要的查询）</li>
<li>UNION：表示查询中包含UNION操作</li>
<li>SUBQUERY：子查询</li>
<li>DERIVED：派生表（表示查询语句出现在from后面）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">找出每个部门平均工资的工资等级</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">explain <span class="keyword">select</span> s.grade,t.<span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> deptno,<span class="built_in">avg</span>(sal) <span class="keyword">as</span> avgsal <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno) t <span class="keyword">join</span> salgrade s <span class="keyword">on</span> t.avgsal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span><span class="keyword">from</span>后面的这个查询语句就是派生表</span><br></pre></td></tr></table></figure>

<h4 id="table"><a href="#table" class="headerlink" title="table"></a>table</h4><p>反映了这个查询操作的是哪个表。</p>
<h4 id="type"><a href="#type" class="headerlink" title="type"></a>type</h4><p>反映了查询表中数据时的访问类型，常见的值：</p>
<ol>
<li>NULL：效率最高，一般不可能优化到这个级别，只有查询时没有查询表的时候，访问类型是NULL。例如：select 1;</li>
<li>system：通常访问系统表的时候，访问类型是system。一般也很难优化到这个程序。</li>
<li>const：根据主键或者唯一性索引查询，索引值是常量值时。explain select * from emp where empno&#x3D;7369;</li>
<li>eq_ref：根据主键或者唯一性索引查询。索引值不是常量值。</li>
<li>ref：使用了非唯一的索引进行查询。</li>
<li>range：使用了索引，扫描了索引树的一部分。</li>
<li>index：表示用了索引，但是也需要遍历整个索引树。</li>
<li>all：全表扫描</li>
</ol>
<p>效率最高的是NULL，效率最低的是all，从上到下，从高到低。</p>
<p>优化就是从下往上优化</p>
<h4 id="possible-keys"><a href="#possible-keys" class="headerlink" title="possible_keys"></a>possible_keys</h4><p>这个查询可能会用到的索引</p>
<h4 id="key"><a href="#key" class="headerlink" title="key"></a>key</h4><p>实际用到的索引</p>
<h4 id="key-len"><a href="#key-len" class="headerlink" title="key_len"></a>key_len</h4><p>反映索引中在查询中使用的列所占的总字节数。</p>
<h4 id="rows"><a href="#rows" class="headerlink" title="rows"></a>rows</h4><p>查询扫描的预估计行数。</p>
<h4 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h4><p>给出了与查询相关的额外信息和说明。这些额外信息可以帮助我们更好地理解查询执行的过程。</p>
<h2 id="索引优化"><a href="#索引优化" class="headerlink" title="索引优化"></a>索引优化</h2><h3 id="加索引-vs-不加索引"><a href="#加索引-vs-不加索引" class="headerlink" title="加索引 vs 不加索引"></a>加索引 vs 不加索引</h3><p>将这个sql脚本初始化到数据库中（初始化100W条记录）：t_vip.sql<br>根据id查询（id是主键，有索引）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_vip <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">900000</span>;#<span class="number">0</span>s</span><br></pre></td></tr></table></figure>

<p>根据name查询（name上没有索引）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_vip <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;4c6494cb&#x27;</span>;#<span class="number">0.157</span>s</span><br></pre></td></tr></table></figure>

<p>给name字段添加索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_t_user_name <span class="keyword">on</span> t_vip(name);</span><br></pre></td></tr></table></figure>

<p>再次根据name查询（此时name上已经有索引了） ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_vip <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;4c6494cb&#x27;</span>;# <span class="number">0</span>s</span><br></pre></td></tr></table></figure>

<h3 id="最左前缀原则"><a href="#最左前缀原则" class="headerlink" title="最左前缀原则"></a>最左前缀原则</h3><p>假设有这样一张表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_customer(</span><br><span class="line">	id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">	age <span class="type">int</span>,</span><br><span class="line">	gender <span class="type">char</span>(<span class="number">1</span>),</span><br><span class="line">	email <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>添加了这些数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> t_customer <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;zhangsan&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;zhangsan@123.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_customer <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;lisi&#x27;</span>, <span class="number">22</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;lisi@123.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_customer <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;wangwu&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;wangwu@123.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_customer <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;zhaoliu&#x27;</span>, <span class="number">22</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;zhaoliu@123.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_customer <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;jack&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;jack@123.com&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>添加了这样的复合索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_name_age_gender <span class="keyword">on</span> t_customer(name,age,gender);</span><br></pre></td></tr></table></figure>

<p><strong>最左前缀原则：当查询语句条件中包含了这个复合索引最左边的列 name 时，此时索引才会起作用。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> age<span class="operator">=</span><span class="number">20</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span>;<span class="comment">/* 完全使用了索引，索引长度1033个字节 */</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> age<span class="operator">=</span><span class="number">20</span>; <span class="comment">/* 部分使用了索引，索引长度1028 ，说明gender在索引当中占用5个字节的长度 */</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span>; <span class="comment">/* 部分使用了索引，索引长度1023，说明age在索引当中占用5个字节的长度 */</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> age<span class="operator">=</span><span class="number">20</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span> <span class="keyword">and</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span>; <span class="comment">/* 完全使用了索引，索引长度1033个字节，这里顺序不一样也不影响*/</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span> <span class="keyword">and</span> age<span class="operator">=</span><span class="number">20</span>; <span class="comment">/* 因为条件不符合最左前缀原则，没有name条件出现，所以不会使用索引，进行全表扫描 */</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span>; <span class="comment">/* 部分使用了索引，只有name字段使用索引，因为中间断开了，导致gender没有使用索引，就会有性能折损*/</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span> <span class="keyword">and</span> age<span class="operator">=</span><span class="number">20</span>; <span class="comment">/* 完全使用了索引 */</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> age<span class="operator">&gt;</span><span class="number">20</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span>; <span class="comment">/* 当使用范围查找的时候，范围条件右侧的列不会使用索引。 */</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> age<span class="operator">&gt;=</span><span class="number">20</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span>; <span class="comment">/* 建议范围条件中添加等号，这样可以让索引完全生效 */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>范围查询时，在“范围条件”右侧的列索引会失效：</strong></p>
<p>验证：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> age<span class="operator">&gt;</span><span class="number">20</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>验证结果：name和age列索引生效。gender列索引无效。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331170050738.png" alt="image-20250331170050738"></p>
<p>怎么解决？建议范围查找时带上“&#x3D;”</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> age<span class="operator">&gt;=</span><span class="number">20</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331170055665.png" alt="image-20250331170055665"></p>
<h3 id="索引失效情况"><a href="#索引失效情况" class="headerlink" title="索引失效情况"></a>索引失效情况</h3><h4 id="索引列参加了运算，索引失效"><a href="#索引列参加了运算，索引失效" class="headerlink" title="索引列参加了运算，索引失效"></a>索引列参加了运算，索引失效</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">5000</span>;#可以</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> sal<span class="operator">*</span><span class="number">10</span> <span class="operator">&gt;</span> <span class="number">50000</span>;#不行</span><br></pre></td></tr></table></figure>

<h4 id="索引列进行模糊查询时以-开始的，索引失效"><a href="#索引列进行模糊查询时以-开始的，索引失效" class="headerlink" title="索引列进行模糊查询时以 % 开始的，索引失效"></a>索引列进行模糊查询时以 % 开始的，索引失效</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;张%&#x27;</span>;#可以</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%飞&#x27;</span>;#不行</span><br></pre></td></tr></table></figure>

<h4 id="索引列是字符串类型，但查询时省略了单引号，索引失效"><a href="#索引列是字符串类型，但查询时省略了单引号，索引失效" class="headerlink" title="索引列是字符串类型，但查询时省略了单引号，索引失效"></a>索引列是字符串类型，但查询时省略了单引号，索引失效</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> age<span class="operator">=</span><span class="string">&#x27;20&#x27;</span>;#可以</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> age<span class="operator">=</span><span class="number">20</span>;#不行</span><br></pre></td></tr></table></figure>

<h4 id="查询条件中有or，只要有未添加索引的字段，索引失效"><a href="#查询条件中有or，只要有未添加索引的字段，索引失效" class="headerlink" title="查询条件中有or，只要有未添加索引的字段，索引失效"></a>查询条件中有or，只要有未添加索引的字段，索引失效</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;张三&#x27;</span> <span class="keyword">or</span> sal<span class="operator">=</span><span class="number">5000</span>;#可以</span><br></pre></td></tr></table></figure>

<p>将t_emp表sal字段上的索引删除：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> t_emp <span class="keyword">drop</span> index idx_t_emp_sal;</span><br></pre></td></tr></table></figure>

<p>再次验证：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;张三&#x27;</span> <span class="keyword">or</span> sal<span class="operator">=</span><span class="number">5000</span>;</span><br></pre></td></tr></table></figure>

<p>验证结果：索引失效</p>
<h4 id="当查询的符合条件的记录在表中占比较大，索引失效"><a href="#当查询的符合条件的记录在表中占比较大，索引失效" class="headerlink" title="当查询的符合条件的记录在表中占比较大，索引失效"></a>当查询的符合条件的记录在表中占比较大，索引失效</h4><p>就是符合条件的记录占了比如百分之八十，和全表扫描没什么区别了，不用是有可能比全表扫描效率还低，会可能有个回表操作</p>
<p>复制一张新表：emp2</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> emp2 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<p>给sal添加索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> emp2 <span class="keyword">add</span> index idx_emp2_sal(sal);</span><br></pre></td></tr></table></figure>

<p>验证：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp2 <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">800</span>;#不走索引</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp2 <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">1000</span>;#不走索引</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp2 <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">2000</span>;#走索引</span><br></pre></td></tr></table></figure>

<h4 id="关于is-null和is-not-null的索引失效问题"><a href="#关于is-null和is-not-null的索引失效问题" class="headerlink" title="关于is null和is not null的索引失效问题"></a>关于is null和is not null的索引失效问题</h4><p>其实就是null在表里占得比例大就全表扫描，占得比例小就使用索引</p>
<p>给emp2的comm字段添加一个索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_emp2_comm <span class="keyword">on</span> emp2(comm);</span><br></pre></td></tr></table></figure>

<p>将emp2表的comm字段值全部更新为NULL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> emp2 <span class="keyword">set</span> comm<span class="operator">=</span><span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<p>验证此时条件使用is null是否走索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp2 <span class="keyword">where</span> comm <span class="keyword">is</span> <span class="keyword">null</span>;#不走索引</span><br></pre></td></tr></table></figure>

<p>将emp2表的comm字段全部更新为非NULL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> emp2 <span class="keyword">set</span> comm<span class="operator">=</span><span class="number">100</span>;</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp2 <span class="keyword">where</span> comm <span class="keyword">is</span> <span class="keyword">null</span>;#走索引</span><br></pre></td></tr></table></figure>

<h3 id="指定索引"><a href="#指定索引" class="headerlink" title="指定索引"></a>指定索引</h3><p>当一个字段上既有单列索引，又有复合索引时，我们可以通过以下的SQL提示来要求该SQL语句执行时采用哪个索引：</p>
<ul>
<li>use index(索引名称)：建议使用该索引，只是建议，底层mysql会根据实际效率来考虑是否使用你推荐的索引。</li>
<li>ignore index(索引名称)：忽略该索引</li>
<li>force index(索引名称)：强行使用该索引</li>
</ul>
<p>查看 t_customer 表上的索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> t_customer;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331233407477.png" alt="image-20250331233407477"><br>可以看到name age gender三列添加了一个复合索引。<br>现在给name字段添加一个单列索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_name <span class="keyword">on</span> t_customer(name);</span><br></pre></td></tr></table></figure>

<p>看看以下的语句默认使用了哪个索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span>;</span><br></pre></td></tr></table></figure>


<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331233445008.png" alt="image-20250331233445008">通过测试得知，默认使用了联合索引。</p>
<p>如何建议使用单列索引idx_name：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer use index(idx_name) <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/21376908/1709695922746-7c298082-197e-49a9-be41-68a80eb1d8cd.png#averageHue=%23eeedec&clientId=u832e6504-1b74-4&from=paste&height=61&id=uacfb4dc3&originHeight=61&originWidth=1347&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5173&status=done&style=shadow&taskId=uc2f18419-fc69-4dab-9b1e-6fb98a1a3a9&title=&width=1347" alt="image.png"></p>
<p>如何忽略使用符合索引 idx_name_age_gender：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer ignore index(idx_name_age_gender) <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/21376908/1709695945125-1fdb373d-e99d-40ff-ba0c-116f323de32a.png#averageHue=%23f1f0f0&clientId=u832e6504-1b74-4&from=paste&height=77&id=u2059b06f&originHeight=77&originWidth=1346&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5375&status=done&style=shadow&taskId=u66156ea8-68db-4846-82dd-0108c69e814&title=&width=1346" alt="image.png"></p>
<p>如何强行使用单列索引idx_name：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer force index(idx_name) <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331233511064.png" alt="image-20250331233511064"></p>
<h3 id="覆盖索引-1"><a href="#覆盖索引-1" class="headerlink" title="覆盖索引"></a>覆盖索引</h3><p>覆盖索引我们在讲解索引的时候已经提到过了，覆盖索引强调的是：在select后面写字段的时候，这些字段尽可能是索引所覆盖的字段，这样可以避免回表查询。尽可能避免使用 select *，因为select * 很容易导致回表查询。（本质就是：能在索引上检索的，就不要再次回表查询了。）</p>
<p>例如：有一张表 emp3，其中 ename,job添加了联合索引：idx_emp3_ename_job，以下这个select语句就不会回表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> emp3;#删除emp3</span><br><span class="line"><span class="keyword">create table</span> emp3 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;#从emp创建emp3</span><br><span class="line"><span class="keyword">alter table</span> emp3 <span class="keyword">add constraint</span> emp3_pk <span class="keyword">primary key</span>(empno);#为emp3的empno添加主键</span><br><span class="line"><span class="keyword">create</span> index idx_emp3_ename_job <span class="keyword">on</span> emp3(ename,job);#添加联合索引</span><br><span class="line">explain <span class="keyword">select</span> empno,ename,job <span class="keyword">from</span> emp3 <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;KING&#x27;</span>;#符合最左原则，都被索引覆盖，不会回表</span><br><span class="line">explain <span class="keyword">select</span> empno,ename,job,sal <span class="keyword">from</span> emp3 <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;KING&#x27;</span>;#sal不在索引中，会回表</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331234421249.png" alt="image-20250331234421249"></p>
<p><strong>面试题：t_user表字段如下：id,name,password,realname,birth,email。表中数据量500万条，请针对以下SQL语句给出优化方案：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,name,realname <span class="keyword">from</span> t_user <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;鲁智深&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>这里会想到给name添加索引，如果只给name添加索引，realname并不在索引覆盖范围内，底层会进行大量的回表查询，效率较低，建议给name和realname两个字段添加联合索引，这样大大减少回表操作，提高查询效率。</p>
<h3 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a>前缀索引</h3><p>如果一个字段类型是varchar或text字段，字段中存储的是文本或者大文本，直接对这种长文本创建索引，会让索引体积很大，怎么优化呢？可以将字符串的前几个字符截取下来当做索引来创建。这种索引被称为前缀索引，例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> emp4;</span><br><span class="line"><span class="keyword">create table</span> emp4 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">create</span> index idx_emp4_ename_2 <span class="keyword">on</span> emp4(ename(<span class="number">2</span>));#把ename的前两个字符作为索引</span><br></pre></td></tr></table></figure>

<p>**知识储备：**对于索引来说，当索引值越唯一，唯一性就越好，性能越高</p>
<p>使用前缀索引时，需要通过以下公式来确定使用前几个字符作为索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="built_in">substring</span>(ename,<span class="number">1</span>,前几个字符)) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> emp4;#把ename从<span class="number">1</span>开始到几结束，除行数</span><br></pre></td></tr></table></figure>

<p>以上查询结果越接近1，表示索引的效果越好。（原理：做索引值的话，索引值越具有唯一性效率越高），ename，前几个字符和emp4是可以更改的</p>
<h3 id="单列索引和复合索引怎么选择"><a href="#单列索引和复合索引怎么选择" class="headerlink" title="单列索引和复合索引怎么选择"></a>单列索引和复合索引怎么选择</h3><p>当查询语句的条件中有多个条件，建议将这几个列创建为复合索引，因为创建单列索引很容易回表查询。<br>例如分别给emp5表ename，job添加两个单列索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> emp5 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">alter table</span> emp5 <span class="keyword">add constraint</span> emp5_pk <span class="keyword">primary key</span>(empno);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> index idx_emp5_ename <span class="keyword">on</span> emp5(ename);</span><br><span class="line"><span class="keyword">create</span> index idx_emp5_job <span class="keyword">on</span> emp5(job);</span><br></pre></td></tr></table></figure>

<p>执行以下查询语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> empno,ename,job <span class="keyword">from</span> emp5 <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;SMITH&#x27;</span> <span class="keyword">and</span> job<span class="operator">=</span><span class="string">&#x27;CLERK&#x27;</span>;#这里推荐使用两个，但实际只使用了ename索引，如果extra为useing index才是使用索引，<span class="keyword">where</span>是回表</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401003556913.png" alt="image-20250401003556913"></p>
<p>ename和job都出现在查询条件中，可以给emp6表的ename和job创建一个复合索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> emp6 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">alter table</span> emp6 <span class="keyword">add constraint</span> emp6_pk <span class="keyword">primary key</span>(empno);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> index idx_emp6_ename_job <span class="keyword">on</span> emp6(ename,job);</span><br><span class="line">explain <span class="keyword">select</span> empno,ename,job <span class="keyword">from</span> emp6 <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;SMITH&#x27;</span> <span class="keyword">and</span> job<span class="operator">=</span><span class="string">&#x27;CLERK&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>对于以上查询语句，使用复合索引避免了回表，因此这种情况下还是建议使用复合索引。</p>
<p>注意：创建索引时应考虑最左前缀原则，主字段并且具有很强唯一性的字段建议排在第一位</p>
<p>由于ename是主字段，并且ename具有很好的唯一性，建议将ename列放在最左边。因此这两种创建复合索引的方式</p>
<h3 id="索引创建原则"><a href="#索引创建原则" class="headerlink" title="索引创建原则"></a>索引创建原则</h3><ol>
<li>表数据量庞大，通常超过百万条数据。</li>
<li>经常出现在where，order by，group by后面的字段建议添加索引。</li>
<li>创建索引的字段尽量具有很强的唯一性。</li>
<li>如果字段存储文本，内容较大，一定要创建前缀索引。</li>
<li>尽量使用复合索引，使用单列索引容易回表查询。</li>
<li>如果一个字段中的数据不会为NULL，建议建表时添加not null约束，这样优化器就知道使用哪个索引列更加有效。</li>
<li>不要创建太多索引，当对数据进行增删改的时候，索引需要重新重新排序。</li>
<li>如果很少的查询，经常的增删改不建议加索引。</li>
</ol>
<h2 id="SQL优化"><a href="#SQL优化" class="headerlink" title="SQL优化"></a>SQL优化</h2><h3 id="order-by的优化"><a href="#order-by的优化" class="headerlink" title="order by的优化"></a>order by的优化</h3><p>explain查看一个带有order by的语句时，Extra列会显示：using index 或者 using filesort，区别是什么？</p>
<ul>
<li>using index:  表示使用索引，因为索引是提前排好序的。效率很高。</li>
<li>using filesort：表示使用文件排序，这就表示没有走索引，对表中数据进行排序，排序时将硬盘的数据读取到内存当中，在内存当中排好序。这个效率是低的，应避免。</li>
</ul>
<p>准备数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> workers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> workers(</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  age <span class="type">int</span>,</span><br><span class="line">  sal <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert into</span> workers <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;孙悟空&#x27;</span>, <span class="number">500</span>, <span class="number">50000</span>);</span><br><span class="line"><span class="keyword">insert into</span> workers <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;猪八戒&#x27;</span>, <span class="number">300</span>, <span class="number">40000</span>);</span><br><span class="line"><span class="keyword">insert into</span> workers <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;沙和尚&#x27;</span>, <span class="number">600</span>, <span class="number">40000</span>);</span><br><span class="line"><span class="keyword">insert into</span> workers <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;白骨精&#x27;</span>, <span class="number">600</span>, <span class="number">10000</span>);</span><br></pre></td></tr></table></figure>

<p>此时name没有添加索引，如果根据name进行排序的话这种方式效率较低：</p>
<p>给name添加索引再根据name排序：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_workers_name <span class="keyword">on</span> workers(name);</span><br><span class="line">explain <span class="keyword">select</span> id,name <span class="keyword">from</span> workers <span class="keyword">order</span> <span class="keyword">by</span> name;</span><br></pre></td></tr></table></figure>

<p>这样效率则提升了。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401152706372.png" alt="image-20250401152706372"></p>
<p>如果要通过age和sal两个字段进行排序，最好给age和sal两个字段添加复合索引，不添加复合索引时：<br>按照age升序排，如果age相同则按照sal升序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> id,age,sal <span class="keyword">from</span> workers <span class="keyword">order</span> <span class="keyword">by</span> age,sal;</span><br></pre></td></tr></table></figure>

<p>这样效率是低的。<br>给age和sal添加复合索引再按照age升序排，如果age相同则按照sal升序：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_workers_age_sal <span class="keyword">on</span> workers(age, sal);</span><br><span class="line">explain <span class="keyword">select</span> id,age,sal <span class="keyword">from</span> workers <span class="keyword">order</span> <span class="keyword">by</span> age,sal;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401152756420.png" alt="image-20250401152756420"></p>
<p>这样效率提升了</p>
<p>在B+树上叶子结点上的所有数据默认是按照升序排列的，如果按照age降序，如果age相同则按照sal降序，也会走索引，因为B+树叶子结点之间采用的是双向指针。可以从左向右（升序），也可以从右向左（降序），效率一样高</p>
<p>如果一个升序，一个降序会怎样呢？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> id,age,sal <span class="keyword">from</span> workers <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">asc</span>, sal <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401153620490.png" alt="image-20250401153620490"></p>
<p>可见age使用了索引，但是sal没有使用索引。怎么办呢？可以针对这种排序情况创建对应的索引来解决：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_workers_ageasc_saldesc <span class="keyword">on</span> workers(age <span class="keyword">asc</span>, sal <span class="keyword">desc</span>);</span><br></pre></td></tr></table></figure>

<p>创建的索引如下：A表示升序，D表示降序</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401153640816.png" alt="image-20250401153640816"></p>
<p>再次执行：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401153704215.png" alt="image-20250401153704215"></p>
<p>通过测试得知，order by也遵循最左前缀法则。</p>
<p>order by 优化原则总结：</p>
<ol>
<li>排序也要遵循最左前缀法则。</li>
<li>使用覆盖索引。</li>
<li>针对不同的排序规则，创建不同索引。（如果所有字段都是升序，或者所有字段都是降序，则不需要创建新的索引）</li>
<li>如果无法避免filesort，要注意排序缓存的大小，默认缓存大小256KB，可以修改系统变量 sort_buffer_size ：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;sort_buffer_size&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="group-by优化"><a href="#group-by优化" class="headerlink" title="group by优化"></a>group by优化</h3><p>创建empx表，job字段上没有索引，根据job进行分组，查看每个工作岗位有多少人：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> job,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> empx <span class="keyword">group</span> <span class="keyword">by</span> job;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401155159854.png" alt="image-20250401155159854"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401155206753.png" alt="image-20250401155206753"></p>
<p>使用了临时表，效率较低。</p>
<p>给job添加索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_empx_job <span class="keyword">on</span> empx(job);</span><br><span class="line">explain <span class="keyword">select</span> job,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> empx <span class="keyword">group</span> <span class="keyword">by</span> job;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401155226558.png" alt="image-20250401155226558"></p>
<p>效率提升了。group by也同样遵循最左前缀法则。</p>
<p>我们再来测试一下，如果将部门编号deptno（复合索引的最左列）添加到where条件中，效率会不会提升：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> sal, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> empx <span class="keyword">where</span> deptno<span class="operator">=</span><span class="number">10</span> <span class="keyword">group</span> <span class="keyword">by</span> sal;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401155332353.png" alt="image-20250401155332353"></p>
<p>效率有提升的，这说明了，group by确实也遵循最左前缀法则。（where中使用了最左列）</p>
<h3 id="limit优化"><a href="#limit优化" class="headerlink" title="limit优化"></a>limit优化</h3><p>数据量特别庞大时，取数据时，越往后效率越低，怎么提升？mysql官方给出的解决方案是：使用覆盖索引+子查询的形式来提升效率。这是分别从一百万五百万九百万中取两条数据的速度</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401155736208.png" alt="image-20250401155736208"></p>
<p>怎么解决？使用覆盖索引，加子查询<br>使用覆盖索引：速度有所提升</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401155819304.png" alt="image-20250401155819304"></p>
<p>然后把这个表看做表t，通过id和进行表连接，使用子查询形式取其他列的数据</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401155847938.png" alt="image-20250401155847938"></p>
<p>通过测试，这种方式整体效率有所提升。</p>
<h3 id="主键优化"><a href="#主键优化" class="headerlink" title="主键优化"></a>主键优化</h3><p>主键设计原则：</p>
<ol>
<li>主键值不要太长，二级索引叶子结点上存储的是主键值，主键值太长，容易导致索引占用空间较大。</li>
<li>尽量使用auto_increment生成主键。尽量不要使用uuid做主键，因为uuid不是顺序插入。</li>
<li>最好不要使用业务主键，因为业务的变化会导致主键值的频繁修改，主键值不建议修改，因为主键值修改，聚集索引一定会重新排序。</li>
<li>在插入数据时，主键值最好是顺序插入，不要乱序插入，因为乱序插入可能会导致B+树叶子结点频繁的进行页分裂与页合并操作，效率较低。<ol>
<li>主键值对应聚集索引，插入主键值如果是乱序的，B+树叶子结点需要不断的重新排序，重排过程中还会频繁涉及到<strong>页分裂和页合并</strong>（可以看老杜的视频有讲解）的操作，效率较低。</li>
<li>B+树上的每个节点都存储在页（page）中。一个页面中存储一个节点。</li>
<li>MySQL的InnoDB存储引擎一个页可以存储16KB的数据。</li>
<li>如果主键值不是顺序插入的话，会导致频繁的页分裂和页合并。在一个B+树中，页分裂和页合并是树的自动调整机制的一部分。当一个页已经满了，再插入一个新的关键字时就会触发页分裂操作，将页中的关键字分配到两个新的页中，同时调整树的结构。相反，当一个页中的关键字数量下降到一个阈值以下时，就会触发页合并操作，将两个相邻的页合并成一个新的页。如果主键值是随机的、不是顺序插入的，那么页的利用率会降低，页分裂和页合并的次数就会增加。由于页的分裂和合并是比较耗时的操作，频繁的分裂和合并会降低数据库系统的性能。因此，为了优化B+树的性能，可以将主键值设计成顺序插入的，这样可以减少页的分裂和合并的次数，提高B+树的性能。在实际应用中，如果对主键值的顺序性能要求不是特别高，也可以采用一些技术手段来减少页分裂和合并，例如B+树分裂时采用“延迟分裂”技术，或者通过调整页的大小和节点的大小等方式来优化B+树的性能。</li>
</ol>
</li>
</ol>
<h3 id="insert优化"><a href="#insert优化" class="headerlink" title="insert优化"></a>insert优化</h3><p>insert优化原则：</p>
<ul>
<li>批量插入：数据量较大时，不要一条一条插入，可以批量插入，当然，建议一次插入数据不超过1000条</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> t_user(id,name,age) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">&#x27;jack&#x27;</span>,<span class="number">20</span>),(<span class="number">2</span>,<span class="string">&#x27;lucy&#x27;</span>,<span class="number">30</span>),(<span class="number">3</span>,<span class="string">&#x27;timi&#x27;</span>,<span class="number">22</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>mysql默认是自动提交事务，只要执行一条DML语句就自动提交一次，因此，当插入大量数据时，建议手动开启事务和手动提交事务。不建议使用数据库事务自动提交机制。</li>
<li>主键值建议采用顺序插入，顺序插入比乱序插入效率高。</li>
<li>超大数据量插入可以考虑使用mysql提供的load指令，load指令可以将csv文件中的数据批量导入到数据库表当中，并且效率很高，过程如下：<ul>
<li>第一步：登录mysql时指定参数</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="comment">--local-infile -uroot -p1234</span></span><br></pre></td></tr></table></figure>

<ul>
<li>第二步：开启local_infile功能</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> local_infile <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>第三步：执行load指令</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">use powernode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> t_temp(</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary key</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  password <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  birth <span class="type">char</span>(<span class="number">10</span>),</span><br><span class="line">  email <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">load data <span class="keyword">local</span> infile <span class="string">&#x27;E:\\powernode\\05-MySQL高级\\resources\\t_temp-100W.csv&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> t_temp fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> lines terminated <span class="keyword">by</span> <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="count-优化"><a href="#count-优化" class="headerlink" title="count(*)优化"></a>count(*)优化</h3><p>分组函数count的使用方式：</p>
<ul>
<li>count(主键)<ul>
<li>原理：将每个主键值取出，累加</li>
</ul>
</li>
<li>count(常量值)<ul>
<li>原理：获取到每个常量值，累加</li>
</ul>
</li>
<li>count(字段)<ul>
<li>原理：取出字段的每个值，判断是否为NULL，不为NULL则累加。</li>
</ul>
</li>
<li>count(*)<ul>
<li>原理：不用取值，底层mysql做了优化，直接统计总行数，效率最高。</li>
</ul>
</li>
</ul>
<p>结论：如果你要统计一张表中数据的总行数，建议使用 count(*)</p>
<p>注意：</p>
<ul>
<li>对于InnoDB存储引擎来说，count计数的实现原理就是将表中每一条记录取出，然后累加。如果你想真正提高效率，可以自己使用额外的其他程序来实现，例如每向表中插入一条记录时，在redis数据库中维护一个总行数，这样获取总行数的时候，直接从redis中获取即可，这样效率是最高的。</li>
<li>对于MyISAM存储引擎来说，当一个select语句没有where条件时，获取总行数效率是极高的，不需要统计，因为MyISAM存储引擎维护了一个单独的总行数。</li>
</ul>
<h3 id="update优化"><a href="#update优化" class="headerlink" title="update优化"></a>update优化</h3><p>当存储引擎是InnoDB时，表的行级锁是针对索引添加的锁，如果索引失效了，或者不是索引列时，会提升为表级锁。<br>什么是行级锁？就是两个表要修改同一行的数据时，a表没有结束之前b表的事务会被卡主，当a表提交结束后b表才会继续执行。</p>
<p>当然，如果更新的不是同一行数据，事务A和事务B可以并发：</p>
<p>行级锁是对索引列加锁，以上更新语句的where条件是id，id是主键，当然有索引，所以使用了行级锁，如果索引失效，或者字段上没有索引，则会升级为表级锁，表级锁就是更改同一张表的比如下面</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401162345198.png" alt="image-20250401162345198"></p>
<p>因此，为了更新的效率，建议update语句中where条件中的字段是添加索引的。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/Shelter67">Shelter</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://localhost:4000/posts/14ea6df7.html">http://localhost:4000/posts/14ea6df7.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://localhost:4000" target="_blank">Shelter</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/sql/">sql</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.dreamshelter.cn/blog/source/img/cover/33.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/8fe47ff4.html" title="JDBC"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/31.jpg" onerror="onerror=null;src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">JDBC</div></div><div class="info-2"><div class="info-item-1">第01章 JDBC概述什么是JDBCJDBC（Java DataBase Connectivity）就是Java数据库连接，说白了就是用Java语言来操作数据库。原来我们操作数据库是在控制台使用SQL语句来操作数据库，JDBC是用Java语言向数据库发送SQL语句。  JDBC是一套连接数据库的api，什么是APi？就是平时所说的一套类库，通常包括三项：  API字节码（String.class） API源码（String.java） API帮助文档（String类的帮助文档）  但是要注意查阅的版本要一致。 JDBC原理早期SUN公司的天才们想编写一套可以连接天下所有数据库的API，但是当他们刚刚开始时就发现这是不可完成的任务，因为各个厂商的数据库服务器差异太大了。后来SUN开始与数据库厂商们讨论，最终得出的结论是，由SUN提供一套访问数据库的规范（就是一组接口），并提供连接数据库的协议标准，然后各个数据库厂商会遵循SUN的规范提供一套访问自己公司数据库服务器的API。SUN提供的规范命名为JDBC，而各个厂商提供的，遵循了JDBC规范的，可以访问自己数据库的API被称之为驱动...</div></div></div></a><a class="pagination-related" href="/posts/4fe508cd.html" title="sql题目"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/12.jpg" onerror="onerror=null;src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">sql题目</div></div><div class="info-2"><div class="info-item-1">第一题 第一题：用一条sql语句，查询出每门课程都大于80分的学生姓名 建表语句： 12345678910drop table if exists t_student;create table t_student(	name varchar(255),	kecheng varchar(255),	fenshu double(3,1));insert into t_student values(&#x27;张三&#x27;, &#x27;语文&#x27;, 81);insert into t_student values(&#x27;张三&#x27;, &#x27;数学&#x27;, 75);insert into t_student values(&#x27;王五&#x27;, &#x27;英语&#x27;, 90);select * from t_student;  思路：查询出小于80分的所欲学生姓名（去重），然后使用not in，不去重会有多个少于80分的重复名字 12345# 第一步：找小于等于80分的学员姓名select distinct name from t_stu...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/8fe47ff4.html" title="JDBC"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/31.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-13</div><div class="info-item-2">JDBC</div></div><div class="info-2"><div class="info-item-1">第01章 JDBC概述什么是JDBCJDBC（Java DataBase Connectivity）就是Java数据库连接，说白了就是用Java语言来操作数据库。原来我们操作数据库是在控制台使用SQL语句来操作数据库，JDBC是用Java语言向数据库发送SQL语句。  JDBC是一套连接数据库的api，什么是APi？就是平时所说的一套类库，通常包括三项：  API字节码（String.class） API源码（String.java） API帮助文档（String类的帮助文档）  但是要注意查阅的版本要一致。 JDBC原理早期SUN公司的天才们想编写一套可以连接天下所有数据库的API，但是当他们刚刚开始时就发现这是不可完成的任务，因为各个厂商的数据库服务器差异太大了。后来SUN开始与数据库厂商们讨论，最终得出的结论是，由SUN提供一套访问数据库的规范（就是一组接口），并提供连接数据库的协议标准，然后各个数据库厂商会遵循SUN的规范提供一套访问自己公司数据库服务器的API。SUN提供的规范命名为JDBC，而各个厂商提供的，遵循了JDBC规范的，可以访问自己数据库的API被称之为驱动...</div></div></div></a><a class="pagination-related" href="/posts/aa9df247.html" title="idea笔记"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/30.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-26</div><div class="info-item-2">idea笔记</div></div><div class="info-2"><div class="info-item-1">常用快捷键：  内置的模板：   </div></div></div></a><a class="pagination-related" href="/posts/7273cdc.html" title="Maven"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/16.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-13</div><div class="info-item-2">Maven</div></div><div class="info-2"><div class="info-item-1">什么是MavenMaven的概念Maven 是 Apache 软件基金会组织维护的一款自动化构建工具，专注服务于 Java 平台的项目构建和依赖管理。Maven 这个单词的本意是：专家，内行。 它是一个一键式的自动化的构建工具.首先,Maven可以自动的帮助我们下载jar包.其次可以进行多个项目同时的编译运行.还有在开发的过程中需要进行测试运行,Maven提供了自动化的测试插件帮助我们进行项目测试功能的运行.最后项目是需要进行资源文件,配置文件的整合,来进行打包和部署,Maven可以轻松搞定. 为什么要使用Maven我们知道，项目开发不仅仅是写写代码而已，期间会伴随着各种必不可少的事情要做，例如：  我们需要引用各种 jar 包，尤其是比较大的工程，引用的 jar 包往往有几十个乃至上百个，每个都要到不同的官网去下载，而且每次用到的 jar 包，都需要手动引入工程目录，而且经常遇到各种让人抓狂的 jar 包冲突，版本冲突，Maven可以自动下载jar包及依赖包添加到项目中，大大减轻了工作负担。 我们开发的 Java 文件，都是需要将它编译成二进制字节码文件。好在这项工作可以由各种...</div></div></div></a><a class="pagination-related" href="/posts/da77c56c.html" title="MVC架构设计模式"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/25.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-11-15</div><div class="info-item-2">MVC架构设计模式</div></div><div class="info-2"><div class="info-item-1">不使用mvc架构的缺陷在不使用MVC架构模式的前提下，完成银行账户转账。分析这个程序存在哪些问题?  缺点1&gt;代码的复用性太差。(代码的重用性太差) 导致缺点1的原因? 因为没有进行”职能分工”，没有独立组件的概念，所以没有办法进行代码复用。代码和代码之间的耦合度太高，扩展力太差。  缺点2&gt;耦合度高，导致了代码很难护展。  缺点3&gt;操作数据库的代码和业务逻辑混杂在一起，很容易出错。编写代码的时候很容易出错，无法专注业务逻辑的编写。   分析以下AccountTransferServlet他都负责了什么?   负责了数据接收    负责了核心的业务处理    负责了数据库表中数据的CRUD操作 (Create【增】 Retrieve【査】 Update【改】 Delete【删】)    负责了页面的数据展示    公司中一般都有很多员工，每个员工都各司其职，为什么要这样?	保洁阿姨负责打扫卫生	杜老师负责教学大纲的指定	郭老师负责上课	王老师负责学习就业*我们公司只有一个员工。这个员工负责所有的事情。生病了。–&gt;公司倒闭了。 理论基础 javaEE设计模式...</div></div></div></a><a class="pagination-related" href="/posts/d6ebbbdf.html" title="Spring Boot 3"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-04</div><div class="info-item-2">Spring Boot 3</div></div><div class="info-2"><div class="info-item-1">第1章 First Spring Boot认识Spring Boot我们来看看官方是如何介绍的： https://docs.spring.io/spring-boot/index.html   Spring Boot倡导约定优于配置，将简化开发发挥到极致。使用Spring Boot框架可以快速构建Spring应用，再也不需要大量的繁琐的的各种配置。Spring Boot框架设计的目标是：程序员关注业务逻辑就行了，环境方面的事儿交给Spring Boot就行。 Spring Boot特性：  快速创建独立的Spring应用程序。（Spring支持的SpringBoot都支持，也就是说SpringBoot全方位支持IoC，AOP等） 嵌入式的Tomcat、Jetty、Undertow容器。（web服务器本身就是几个jar包，Spring Boot框架自动嵌入了。） 需要什么功能时只需要引入对应的starter启动器即可。（启动器可以自动管理这个功能相关的依赖，自动管理依赖版本的控制） 尽最大努力，最大可能的自动配置Spring应用和第三方库。（例如：如果要进行事务的控制，不用做任何事...</div></div></div></a><a class="pagination-related" href="/posts/9c933fc9.html" title="学习Maven"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/32.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-14</div><div class="info-item-2">学习Maven</div></div><div class="info-2"><div class="info-item-1">maven简介https://www.bilibili.com/video/BV1uApMeWErY?spm_id_from=333.788.videopod.sections&amp;vd_source=b0128143be22d1783a42f5fbf34d9d25 pom.xml 定义了项目的配置、依赖、插件、以及构建的过程 Maven仓库就是存放jiar包的地方，按照作用范围可以分为  本地仓库  就是电脑上的本地目录，默认在  一定要是一个没有中文的路径下。    远程仓库  一般是一个公司或者组织内部搭建的一个仓库，用来给内部的项目提供统一的依赖管理，避免jar包的重复下载 也可以通过中央仓库下载，是Maven官方维护的一个仓库 ，开源jar包都可以在这里找到   私服   maven安装和下载Maven官网：https://maven.apache.org/ Maven下载地址：https://maven.apache.org/download.cgi Nexus下载地址：https://help.sonatype.com/en/download.html 环境变量...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/touxiang.jpg" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Shelter</div><div class="author-info-description">记录自己的成长日志</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Shelter67"><i class="fab fa-github"></i><span>没有什么star的github</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Shelter67" target="_blank" title="GitHub"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1830191738@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://space.bilibili.com/8416212" target="_blank" title="Bilibili"><i class="fab fa-bilibili" style="color: #fb7299;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的小小博客！都是基于hexo框架使用，魔改了一些地方，表现得有些二次元，有个博客希望能在未来工作简历上成为加分项吧，但是弄起来还真的挺好玩的</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">数据库概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.1.</span> <span class="toc-text">什么是数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">数据库类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.3.</span> <span class="toc-text">数据库管理系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFSQL"><span class="toc-number">1.4.</span> <span class="toc-text">什么是SQL</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%99%BB%E5%BD%95MySQL"><span class="toc-number">2.</span> <span class="toc-text">登录MySQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E7%99%BB%E5%BD%95"><span class="toc-number">2.1.</span> <span class="toc-text">本地登录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95"><span class="toc-number">2.2.</span> <span class="toc-text">远程登录</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC03%E7%AB%A0-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE"><span class="toc-number">3.</span> <span class="toc-text">第03章 初始化数据</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">3.1.</span> <span class="toc-text">MySQL命令行基本命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="toc-number">3.2.</span> <span class="toc-text">数据库表的概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE"><span class="toc-number">3.3.</span> <span class="toc-text">初始化测试数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%86%9F%E6%82%89%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE"><span class="toc-number">3.4.</span> <span class="toc-text">熟悉测试数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC04%E7%AB%A0-%E6%9F%A5%E8%AF%A2DQL%E4%B8%93%E9%A2%98"><span class="toc-number">4.</span> <span class="toc-text">第04章 查询DQL专题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.1.</span> <span class="toc-text">简单查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E4%B8%80%E4%B8%AA%E5%AD%97%E6%AE%B5"><span class="toc-number">4.1.1.</span> <span class="toc-text">查一个字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E5%A4%9A%E4%B8%AA%E5%AD%97%E6%AE%B5"><span class="toc-number">4.1.2.</span> <span class="toc-text">查多个字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%80%E6%9C%89%E5%AD%97%E6%AE%B5"><span class="toc-number">4.1.3.</span> <span class="toc-text">查所有字段</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%97%B6%E5%AD%97%E6%AE%B5%E5%8F%AF%E5%8F%82%E4%B8%8E%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97"><span class="toc-number">4.1.3.1.</span> <span class="toc-text">查询时字段可参与数学运算</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%97%B6%E5%AD%97%E6%AE%B5%E5%8F%AF%E8%B5%B7%E5%88%AB%E5%90%8D"><span class="toc-number">4.1.4.</span> <span class="toc-text">查询时字段可起别名</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.2.</span> <span class="toc-text">条件查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F"><span class="toc-number">4.2.1.</span> <span class="toc-text">条件查询语法格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%89%E4%BA%8E"><span class="toc-number">4.2.2.</span> <span class="toc-text">等于 &#x3D;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%AD%89%E4%BA%8E%EF%BC%88%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="toc-number">4.2.3.</span> <span class="toc-text">安全等于（简单了解）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E7%AD%89%E4%BA%8E-%E6%88%96"><span class="toc-number">4.2.4.</span> <span class="toc-text">不等于 &lt;&gt; 或 !&#x3D;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E4%BA%8E-%E3%80%81%E5%A4%A7%E4%BA%8E%E7%AD%89%E4%BA%8E-%E3%80%81%E5%B0%8F%E4%BA%8E"><span class="toc-number">4.2.5.</span> <span class="toc-text">大于 &gt;、大于等于 &gt;&#x3D;、小于 &lt;、小于等于 &lt;&#x3D;、and、or</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#and%E5%92%8Cor%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E9%97%AE%E9%A2%98"><span class="toc-number">4.2.6.</span> <span class="toc-text">and和or的优先级问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#between%E2%80%A6and%E2%80%A6"><span class="toc-number">4.2.7.</span> <span class="toc-text">between…and…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#is-null%E3%80%81is-not-null"><span class="toc-number">4.2.8.</span> <span class="toc-text">is null、is not null</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#is-null"><span class="toc-number">4.2.8.1.</span> <span class="toc-text">is null</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#is-not-null"><span class="toc-number">4.2.8.2.</span> <span class="toc-text">is not null</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#in%E3%80%81not-in"><span class="toc-number">4.2.9.</span> <span class="toc-text">in、not in</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#in"><span class="toc-number">4.2.9.1.</span> <span class="toc-text">in</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#not-in"><span class="toc-number">4.2.9.2.</span> <span class="toc-text">not in</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#in%E3%80%81not-in-%E4%B8%8E-NULL"><span class="toc-number">4.2.9.3.</span> <span class="toc-text">in、not in 与 NULL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2like"><span class="toc-number">4.2.10.</span> <span class="toc-text">模糊查询like</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">4.3.</span> <span class="toc-text">排序操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%B8%80%E5%AD%97%E6%AE%B5%E5%8D%87%E5%BA%8F"><span class="toc-number">4.3.1.</span> <span class="toc-text">单一字段升序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%B8%80%E5%AD%97%E6%AE%B5%E9%99%8D%E5%BA%8F"><span class="toc-number">4.3.2.</span> <span class="toc-text">单一字段降序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E9%87%87%E7%94%A8%E5%8D%87%E5%BA%8F"><span class="toc-number">4.3.3.</span> <span class="toc-text">默认采用升序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E5%AD%97%E6%AE%B5%E6%8E%92%E5%BA%8F"><span class="toc-number">4.3.4.</span> <span class="toc-text">多个字段排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#where%E5%92%8Corder-by%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="toc-number">4.3.5.</span> <span class="toc-text">where和order by的位置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#distinct%E5%8E%BB%E9%87%8D"><span class="toc-number">4.4.</span> <span class="toc-text">distinct去重</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%EF%BC%88%E5%8D%95%E8%A1%8C%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%EF%BC%89"><span class="toc-number">4.5.</span> <span class="toc-text">数据处理函数（单行处理函数）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3"><span class="toc-number">4.5.1.</span> <span class="toc-text">字符串相关</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AC%E5%A4%A7%E5%86%99upper%E5%92%8Cucase"><span class="toc-number">4.5.1.1.</span> <span class="toc-text">转大写upper和ucase</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AC%E5%B0%8F%E5%86%99lower%E5%92%8Clcase"><span class="toc-number">4.5.1.2.</span> <span class="toc-text">转小写lower和lcase</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%88%AA%E5%8F%96%E5%AD%97%E7%AC%A6%E4%B8%B2substr"><span class="toc-number">4.5.1.3.</span> <span class="toc-text">截取字符串substr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%95%BF%E5%BA%A6length"><span class="toc-number">4.5.1.4.</span> <span class="toc-text">获取字符串长度length</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AD%97%E7%AC%A6%E7%9A%84%E4%B8%AA%E6%95%B0char-length"><span class="toc-number">4.5.1.5.</span> <span class="toc-text">获取字符的个数char_length</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5"><span class="toc-number">4.5.1.6.</span> <span class="toc-text">字符串拼接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%BB%E9%99%A4%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%89%8D%E5%90%8E%E7%A9%BA%E7%99%BDtrim"><span class="toc-number">4.5.1.7.</span> <span class="toc-text">去除字符串前后空白trim</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E7%9B%B8%E5%85%B3"><span class="toc-number">4.5.2.</span> <span class="toc-text">数字相关</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rand-%E5%92%8Crand-x"><span class="toc-number">4.5.2.1.</span> <span class="toc-text">rand()和rand(x)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#round-x-%E5%92%8Cround-x-y-%E5%9B%9B%E8%88%8D%E4%BA%94%E5%85%A5"><span class="toc-number">4.5.2.2.</span> <span class="toc-text">round(x)和round(x,y)四舍五入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#truncate-x-y-%E8%88%8D%E5%8E%BB"><span class="toc-number">4.5.2.3.</span> <span class="toc-text">truncate(x, y)舍去</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ceil%E4%B8%8Efloor"><span class="toc-number">4.5.2.4.</span> <span class="toc-text">ceil与floor</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E5%A4%84%E7%90%86"><span class="toc-number">4.5.3.</span> <span class="toc-text">空处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.4.</span> <span class="toc-text">日期和时间相关函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4"><span class="toc-number">4.5.4.1.</span> <span class="toc-text">获取当前日期和时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%97%A5%E6%9C%9F"><span class="toc-number">4.5.4.2.</span> <span class="toc-text">获取当前日期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4"><span class="toc-number">4.5.4.3.</span> <span class="toc-text">获取当前时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%8D%95%E7%8B%AC%E7%9A%84%E5%B9%B4%E3%80%81%E6%9C%88%E3%80%81%E6%97%A5%E3%80%81%E6%97%B6%E3%80%81%E5%88%86%E3%80%81%E7%A7%92"><span class="toc-number">4.5.4.4.</span> <span class="toc-text">获取单独的年、月、日、时、分、秒</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#date-add%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.4.5.</span> <span class="toc-text">date_add函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#date-format%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.4.6.</span> <span class="toc-text">date_format日期格式化函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#str-to-date%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.4.7.</span> <span class="toc-text">str_to_date函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dayofweek%E3%80%81dayofmonth%E3%80%81dayofyear%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.4.8.</span> <span class="toc-text">dayofweek、dayofmonth、dayofyear函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#last-day%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.4.9.</span> <span class="toc-text">last_day函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#datediff%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.4.10.</span> <span class="toc-text">datediff函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#timediff%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.4.11.</span> <span class="toc-text">timediff函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#if%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.5.</span> <span class="toc-text">if函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cast%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.6.</span> <span class="toc-text">cast函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.7.</span> <span class="toc-text">加密函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.8.</span> <span class="toc-text">窗口函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0"><span class="toc-number">4.6.</span> <span class="toc-text">分组函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#max"><span class="toc-number">4.6.1.</span> <span class="toc-text">max</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#min"><span class="toc-number">4.6.2.</span> <span class="toc-text">min</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#avg"><span class="toc-number">4.6.3.</span> <span class="toc-text">avg</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sum"><span class="toc-number">4.6.4.</span> <span class="toc-text">sum</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%91%98%E5%B7%A5%E7%9A%84%E6%B4%A5%E8%B4%B4%E4%B9%8B%E5%92%8C"><span class="toc-number">4.6.4.1.</span> <span class="toc-text">计算员工的津贴之和</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#count"><span class="toc-number">4.6.5.</span> <span class="toc-text">count</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0%E7%BB%84%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">4.6.6.</span> <span class="toc-text">分组函数组合使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">4.6.7.</span> <span class="toc-text">分组函数注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.7.</span> <span class="toc-text">分组查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#group-by"><span class="toc-number">4.7.1.</span> <span class="toc-text">group by</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#having"><span class="toc-number">4.7.2.</span> <span class="toc-text">having</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%86%85%E6%8E%92%E5%BA%8F"><span class="toc-number">4.7.3.</span> <span class="toc-text">组内排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E8%A1%8C%E8%BD%AC%E5%88%97"><span class="toc-number">4.7.4.</span> <span class="toc-text">MySQL行转列</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E5%8D%95%E8%A1%A8%E7%9A%84DQL%E8%AF%AD%E5%8F%A5"><span class="toc-number">4.8.</span> <span class="toc-text">总结单表的DQL语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.9.</span> <span class="toc-text">连接查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.9.1.</span> <span class="toc-text">什么是连接查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">4.9.2.</span> <span class="toc-text">连接查询的分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%E7%8E%B0%E8%B1%A1"><span class="toc-number">4.9.3.</span> <span class="toc-text">笛卡尔积现象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.9.4.</span> <span class="toc-text">内连接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E5%8F%AB%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.9.4.1.</span> <span class="toc-text">什么叫内连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5%E4%B9%8B%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.9.4.2.</span> <span class="toc-text">内连接之等值连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5%E4%B9%8B%E9%9D%9E%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.9.4.3.</span> <span class="toc-text">内连接之非等值连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5%E4%B9%8B%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.9.4.4.</span> <span class="toc-text">内连接之自连接</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.9.5.</span> <span class="toc-text">外连接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E5%8F%AB%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.9.5.1.</span> <span class="toc-text">什么叫外连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5%E4%B9%8B%E5%B7%A6%E5%A4%96%E8%BF%9E%E6%8E%A5%EF%BC%88%E5%B7%A6%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="toc-number">4.9.5.2.</span> <span class="toc-text">外连接之左外连接（左连接）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5%E4%B9%8B%E5%8F%B3%E5%A4%96%E8%BF%9E%E6%8E%A5%EF%BC%88%E5%8F%B3%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="toc-number">4.9.5.3.</span> <span class="toc-text">外连接之右外连接（右连接）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.9.6.</span> <span class="toc-text">全连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E5%BC%A0%E8%A1%A8%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.9.7.</span> <span class="toc-text">多张表连接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.10.</span> <span class="toc-text">子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.10.1.</span> <span class="toc-text">什么是子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#where%E5%90%8E%E9%9D%A2%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.10.2.</span> <span class="toc-text">where后面使用子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#from%E5%90%8E%E9%9D%A2%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.10.3.</span> <span class="toc-text">from后面使用子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select%E5%90%8E%E9%9D%A2%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.10.4.</span> <span class="toc-text">select后面使用子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exists%E3%80%81not-exists"><span class="toc-number">4.10.5.</span> <span class="toc-text">exists、not exists</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#in%E5%92%8Cexists%E5%8C%BA%E5%88%AB%EF%BC%88%E5%8F%AF%E8%83%BD%E9%9D%A2%E8%AF%95%EF%BC%89"><span class="toc-number">4.10.6.</span> <span class="toc-text">in和exists区别（可能面试）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#union-union-all"><span class="toc-number">4.11.</span> <span class="toc-text">union&amp;union all</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#limit"><span class="toc-number">4.12.</span> <span class="toc-text">limit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#35%E4%B8%AADQL%E7%BB%83%E6%89%8B%E9%A2%98"><span class="toc-number">4.13.</span> <span class="toc-text">35个DQL练手题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC05%E7%AB%A0-%E8%A1%A8%E7%9B%B8%E5%85%B3"><span class="toc-number">5.</span> <span class="toc-text">第05章 表相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">5.1.</span> <span class="toc-text">创建表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">5.2.</span> <span class="toc-text">插入数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">5.3.</span> <span class="toc-text">删除表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.4.</span> <span class="toc-text">MySQL数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.4.1.</span> <span class="toc-text">整数类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%AE%E7%82%B9%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.4.2.</span> <span class="toc-text">浮点数类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E7%82%B9%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.4.3.</span> <span class="toc-text">定点数类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.4.4.</span> <span class="toc-text">日期和时间类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.4.5.</span> <span class="toc-text">字符串类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#char"><span class="toc-number">5.4.5.1.</span> <span class="toc-text">char</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#varchar"><span class="toc-number">5.4.5.2.</span> <span class="toc-text">varchar</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#text"><span class="toc-number">5.4.5.3.</span> <span class="toc-text">text</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#enum"><span class="toc-number">5.4.5.4.</span> <span class="toc-text">enum</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#set"><span class="toc-number">5.4.5.5.</span> <span class="toc-text">set</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.4.6.</span> <span class="toc-text">二进制类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A2%9E%E5%88%A0%E6%94%B9%E8%A1%A8%E7%BB%93%E6%9E%84DDL"><span class="toc-number">5.5.</span> <span class="toc-text">增删改表结构DDL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%AD%A6%E7%94%9F%E8%A1%A8"><span class="toc-number">5.5.1.</span> <span class="toc-text">创建一个学生表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5"><span class="toc-number">5.5.2.</span> <span class="toc-text">查看建表语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E5%90%8D"><span class="toc-number">5.5.3.</span> <span class="toc-text">修改表名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%AD%97%E6%AE%B5"><span class="toc-number">5.5.4.</span> <span class="toc-text">新增字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AD%97%E6%AE%B5%E5%90%8D"><span class="toc-number">5.5.5.</span> <span class="toc-text">修改字段名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AD%97%E6%AE%B5%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.5.6.</span> <span class="toc-text">修改字段数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%AD%97%E6%AE%B5"><span class="toc-number">5.5.7.</span> <span class="toc-text">删除字段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DML%E8%AF%AD%E5%8F%A5"><span class="toc-number">5.6.</span> <span class="toc-text">DML语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#insert-%E5%A2%9E"><span class="toc-number">5.6.1.</span> <span class="toc-text">insert 增</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delete-%E5%88%A0"><span class="toc-number">5.6.2.</span> <span class="toc-text">delete 删</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update-%E6%94%B9"><span class="toc-number">5.6.3.</span> <span class="toc-text">update 改</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9Fconstraint"><span class="toc-number">5.7.</span> <span class="toc-text">约束constraint</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">5.7.1.</span> <span class="toc-text">非空约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E7%BA%A6%E6%9D%9F"><span class="toc-number">5.7.2.</span> <span class="toc-text">检查约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E6%80%A7%E7%BA%A6%E6%9D%9F"><span class="toc-number">5.7.3.</span> <span class="toc-text">唯一性约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">5.7.4.</span> <span class="toc-text">主键约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">5.7.5.</span> <span class="toc-text">外键约束</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC06%E7%AB%A0-%E4%B8%89%E8%8C%83%E5%BC%8F"><span class="toc-number">6.</span> <span class="toc-text">第06章 三范式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E4%B8%89%E8%8C%83%E5%BC%8F"><span class="toc-number">6.1.</span> <span class="toc-text">什么是数据库设计三范式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E8%8C%83%E5%BC%8F%EF%BC%88%E8%83%8C%EF%BC%89"><span class="toc-number">6.2.</span> <span class="toc-text">三范式（背）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A%E6%80%8E%E4%B9%88%E8%AE%BE%E8%AE%A1"><span class="toc-number">6.3.</span> <span class="toc-text">一对多怎么设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E5%AF%B9%E5%A4%9A%E6%80%8E%E4%B9%88%E8%AE%BE%E8%AE%A1"><span class="toc-number">6.4.</span> <span class="toc-text">多对多怎么设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E4%B8%80%E6%80%8E%E4%B9%88%E8%AE%BE%E8%AE%A1"><span class="toc-number">6.5.</span> <span class="toc-text">一对一怎么设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">6.6.</span> <span class="toc-text">最终的设计</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC07%E7%AB%A0-%E8%A7%86%E5%9B%BE"><span class="toc-number">7.</span> <span class="toc-text">第07章 视图</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC08%E7%AB%A0-%E4%BA%8B%E5%8A%A1transaction"><span class="toc-number">8.</span> <span class="toc-text">第08章 事务transaction</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E6%A6%82%E8%BF%B0"><span class="toc-number">8.1.</span> <span class="toc-text">事务概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7%EF%BC%9AACID"><span class="toc-number">8.2.</span> <span class="toc-text">事务四大特性：ACID</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%94%E7%A4%BAMySQL%E4%BA%8B%E5%8A%A1"><span class="toc-number">8.3.</span> <span class="toc-text">演示MySQL事务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">8.4.</span> <span class="toc-text">事务隔离级别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E4%B8%8E%E8%AE%BE%E7%BD%AE%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">8.4.1.</span> <span class="toc-text">查看与设置隔离级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E7%8E%B0%E8%B1%A1"><span class="toc-number">8.4.2.</span> <span class="toc-text">不同现象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%84%8F%E8%AF%BB"><span class="toc-number">8.4.2.1.</span> <span class="toc-text">脏读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB"><span class="toc-number">8.4.2.2.</span> <span class="toc-text">不可重复读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%BB%E8%AF%BB"><span class="toc-number">8.4.2.3.</span> <span class="toc-text">幻读</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">8.4.3.</span> <span class="toc-text">隔离级别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E6%9C%AA%E6%8F%90%E4%BA%A4%EF%BC%88READ-UNCOMMITTED%EF%BC%89"><span class="toc-number">8.4.3.1.</span> <span class="toc-text">读未提交（READ UNCOMMITTED）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E6%8F%90%E4%BA%A4%EF%BC%88READ-COMMITTED%EF%BC%89"><span class="toc-number">8.4.3.2.</span> <span class="toc-text">读提交（READ COMMITTED）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%EF%BC%88REPEATABLE-READ%EF%BC%89"><span class="toc-number">8.4.3.3.</span> <span class="toc-text">可重复读（REPEATABLE READ）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%B2%E8%A1%8C%E5%8C%96%EF%BC%88SERIALIZABLE%EF%BC%89"><span class="toc-number">8.4.3.4.</span> <span class="toc-text">串行化（SERIALIZABLE）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E7%9A%84%E5%B9%BB%E8%AF%BB%E9%97%AE%E9%A2%98"><span class="toc-number">8.4.4.</span> <span class="toc-text">可重复读的幻读问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%AB%E7%85%A7%E8%AF%BB%E6%98%AF%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%B9%BB%E8%AF%BB%E7%9A%84"><span class="toc-number">8.4.4.1.</span> <span class="toc-text">快照读是如何解决幻读的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%93%E5%89%8D%E8%AF%BB%E6%98%AF%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%B9%BB%E8%AF%BB%E7%9A%84"><span class="toc-number">8.4.4.2.</span> <span class="toc-text">当前读是如何解决幻读的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BA%E7%8E%B0%E5%B9%BB%E8%AF%BB%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%83%85%E5%86%B5"><span class="toc-number">8.4.4.3.</span> <span class="toc-text">出现幻读的两种情况</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E4%BA%A7%E7%94%9F%E5%B9%BB%E8%AF%BB%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-number">8.4.4.3.1.</span> <span class="toc-text">第一种产生幻读的场景</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E4%BA%A7%E7%94%9F%E5%B9%BB%E8%AF%BB%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-number">8.4.4.3.2.</span> <span class="toc-text">第二种产生幻读的场景</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E7%9A%84%E5%B9%BB%E8%AF%BB%E9%97%AE%E9%A2%98"><span class="toc-number">8.4.4.4.</span> <span class="toc-text">总结可重复读的幻读问题</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC09%E7%AB%A0-DBA%E5%91%BD%E4%BB%A4"><span class="toc-number">9.</span> <span class="toc-text">第09章 DBA命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E7%94%A8%E6%88%B7"><span class="toc-number">9.1.</span> <span class="toc-text">新建用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%99%E7%94%A8%E6%88%B7%E6%8E%88%E6%9D%83"><span class="toc-number">9.2.</span> <span class="toc-text">给用户授权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%92%A4%E9%94%80%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90"><span class="toc-number">9.3.</span> <span class="toc-text">撤销用户权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E7%9A%84%E5%AF%86%E7%A0%81"><span class="toc-number">9.4.</span> <span class="toc-text">修改用户的密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E5%90%8D"><span class="toc-number">9.5.</span> <span class="toc-text">修改用户名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7"><span class="toc-number">9.6.</span> <span class="toc-text">删除用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD"><span class="toc-number">9.7.</span> <span class="toc-text">数据备份</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC10%E7%AB%A0-MySQL%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B7%A5%E5%85%B7"><span class="toc-number">10.</span> <span class="toc-text">第10章 MySQL客户端工具</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98"><span class="toc-number">11.</span> <span class="toc-text">第11章 企业真题</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC12%E7%AB%A0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">12.</span> <span class="toc-text">第12章 存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%EF%BC%9F"><span class="toc-number">12.1.</span> <span class="toc-text">什么是存储过程？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E4%BC%98%E7%82%B9%E5%92%8C%E7%BC%BA%E7%82%B9%EF%BC%9F"><span class="toc-number">12.2.</span> <span class="toc-text">存储过程的优点和缺点？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">12.3.</span> <span class="toc-text">第一个存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">12.3.1.</span> <span class="toc-text">存储过程的创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E8%B0%83%E7%94%A8"><span class="toc-number">12.3.2.</span> <span class="toc-text">存储过程的调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E6%9F%A5%E7%9C%8B"><span class="toc-number">12.3.3.</span> <span class="toc-text">存储过程的查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E5%88%A0%E9%99%A4"><span class="toc-number">12.3.4.</span> <span class="toc-text">存储过程的删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delimiter%E5%91%BD%E4%BB%A4"><span class="toc-number">12.3.5.</span> <span class="toc-text">delimiter命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E7%9A%84%E5%8F%98%E9%87%8F"><span class="toc-number">12.4.</span> <span class="toc-text">MySQL的变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-number">12.4.1.</span> <span class="toc-text">系统变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%8F%98%E9%87%8F"><span class="toc-number">12.4.2.</span> <span class="toc-text">用户变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F"><span class="toc-number">12.4.3.</span> <span class="toc-text">局部变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F-1"><span class="toc-number">12.5.</span> <span class="toc-text">局部变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#if%E8%AF%AD%E5%8F%A5"><span class="toc-number">12.6.</span> <span class="toc-text">if语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0"><span class="toc-number">12.7.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#case%E8%AF%AD%E5%8F%A5"><span class="toc-number">12.8.</span> <span class="toc-text">case语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#while%E5%BE%AA%E7%8E%AF"><span class="toc-number">12.9.</span> <span class="toc-text">while循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#repeat%E5%BE%AA%E7%8E%AF"><span class="toc-number">12.10.</span> <span class="toc-text">repeat循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#loop%E5%BE%AA%E7%8E%AF"><span class="toc-number">12.11.</span> <span class="toc-text">loop循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87cursor"><span class="toc-number">12.12.</span> <span class="toc-text">游标cursor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8D%95%E6%8D%89%E5%BC%82%E5%B8%B8%E5%B9%B6%E5%A4%84%E7%90%86"><span class="toc-number">12.13.</span> <span class="toc-text">捕捉异常并处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">12.14.</span> <span class="toc-text">存储函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">12.15.</span> <span class="toc-text">触发器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC13%E7%AB%A0-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">13.</span> <span class="toc-text">第13章 存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%A6%82%E8%BF%B0"><span class="toc-number">13.1.</span> <span class="toc-text">存储引擎概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E6%94%AF%E6%8C%81%E5%93%AA%E4%BA%9B%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">13.2.</span> <span class="toc-text">MySQL支持哪些存储引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%92%8C%E4%BF%AE%E6%94%B9%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">13.3.</span> <span class="toc-text">指定和修改存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">13.3.1.</span> <span class="toc-text">指定存储引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">13.3.2.</span> <span class="toc-text">修改存储引擎</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E5%8F%8A%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">13.4.</span> <span class="toc-text">常用的存储引擎及适用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC14%E7%AB%A0-%E7%B4%A2%E5%BC%95"><span class="toc-number">14.</span> <span class="toc-text">第14章 索引</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%B4%A2%E5%BC%95%EF%BC%88index%EF%BC%89"><span class="toc-number">14.1.</span> <span class="toc-text">什么是索引（index）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4"><span class="toc-number">14.2.</span> <span class="toc-text">索引的创建和删除</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E4%BC%9A%E8%87%AA%E5%8A%A8%E6%B7%BB%E5%8A%A0%E7%B4%A2%E5%BC%95"><span class="toc-number">14.2.1.</span> <span class="toc-text">主键会自动添加索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#unique%E7%BA%A6%E6%9D%9F%E7%9A%84%E5%AD%97%E6%AE%B5%E8%87%AA%E5%8A%A8%E6%B7%BB%E5%8A%A0%E7%B4%A2%E5%BC%95"><span class="toc-number">14.2.2.</span> <span class="toc-text">unique约束的字段自动添加索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%99%E6%8C%87%E5%AE%9A%E7%9A%84%E5%AD%97%E6%AE%B5%E6%B7%BB%E5%8A%A0%E7%B4%A2%E5%BC%95"><span class="toc-number">14.2.3.</span> <span class="toc-text">给指定的字段添加索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5%E4%B8%8A%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="toc-number">14.2.4.</span> <span class="toc-text">删除指定字段上的索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%9F%90%E5%BC%A0%E8%A1%A8%E4%B8%8A%E6%B7%BB%E5%8A%A0%E4%BA%86%E5%93%AA%E4%BA%9B%E7%B4%A2%E5%BC%95"><span class="toc-number">14.2.5.</span> <span class="toc-text">查看某张表上添加了哪些索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">14.3.</span> <span class="toc-text">索引的分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E7%B4%A2%E5%BC%95%E9%87%87%E7%94%A8%E4%BA%86B-%E6%A0%91%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">14.4.</span> <span class="toc-text">MySQL索引采用了B+树数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E5%8F%89%E6%A0%91"><span class="toc-number">14.4.1.</span> <span class="toc-text">二叉树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%A2%E9%BB%91%E6%A0%91%EF%BC%88%E8%87%AA%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91%EF%BC%89"><span class="toc-number">14.4.2.</span> <span class="toc-text">红黑树（自平衡二叉树）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B-Trees%EF%BC%88B%E6%A0%91%EF%BC%89"><span class="toc-number">14.4.3.</span> <span class="toc-text">B Trees（B树）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B-Trees%EF%BC%88B-%E6%A0%91%EF%BC%89"><span class="toc-number">14.4.4.</span> <span class="toc-text">B+ Trees（B+ 树）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%B4%A2%E5%BC%95%E5%8F%8A%E7%9B%B8%E5%85%B3%E8%B0%83%E4%BC%98"><span class="toc-number">14.5.</span> <span class="toc-text">其他索引及相关调优</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hash%E7%B4%A2%E5%BC%95"><span class="toc-number">14.5.1.</span> <span class="toc-text">Hash索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95%E5%92%8C%E9%9D%9E%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95"><span class="toc-number">14.5.2.</span> <span class="toc-text">聚集索引和非聚集索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95"><span class="toc-number">14.5.3.</span> <span class="toc-text">二级索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95"><span class="toc-number">14.5.4.</span> <span class="toc-text">覆盖索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%B8%8B%E6%8E%A8"><span class="toc-number">14.5.5.</span> <span class="toc-text">索引下推</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E5%88%97%E7%B4%A2%E5%BC%95%EF%BC%88%E5%8D%95%E4%B8%80%E7%B4%A2%E5%BC%95%EF%BC%89"><span class="toc-number">14.5.6.</span> <span class="toc-text">单列索引（单一索引）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E7%B4%A2%E5%BC%95%EF%BC%88%E7%BB%84%E5%90%88%E7%B4%A2%E5%BC%95%EF%BC%89"><span class="toc-number">14.5.7.</span> <span class="toc-text">复合索引（组合索引）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">14.6.</span> <span class="toc-text">索引的优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%95%E6%97%B6%E7%94%A8%E7%B4%A2%E5%BC%95"><span class="toc-number">14.7.</span> <span class="toc-text">何时用索引</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC15%E7%AB%A0-mysql%E4%BC%98%E5%8C%96"><span class="toc-number">15.</span> <span class="toc-text">第15章 mysql优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E4%BC%98%E5%8C%96%E6%89%8B%E6%AE%B5"><span class="toc-number">15.1.</span> <span class="toc-text">MySQL优化手段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="toc-number">15.2.</span> <span class="toc-text">SQL性能分析工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%B4%E4%BD%93%E6%83%85%E5%86%B5"><span class="toc-number">15.2.1.</span> <span class="toc-text">查看数据库整体情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">15.2.2.</span> <span class="toc-text">慢查询日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#show-profiles"><span class="toc-number">15.2.3.</span> <span class="toc-text">show profiles</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#explain"><span class="toc-number">15.2.4.</span> <span class="toc-text">explain</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#id"><span class="toc-number">15.2.4.1.</span> <span class="toc-text">id</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#select-type"><span class="toc-number">15.2.4.2.</span> <span class="toc-text">select_type</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#table"><span class="toc-number">15.2.4.3.</span> <span class="toc-text">table</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#type"><span class="toc-number">15.2.4.4.</span> <span class="toc-text">type</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#possible-keys"><span class="toc-number">15.2.4.5.</span> <span class="toc-text">possible_keys</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#key"><span class="toc-number">15.2.4.6.</span> <span class="toc-text">key</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#key-len"><span class="toc-number">15.2.4.7.</span> <span class="toc-text">key_len</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rows"><span class="toc-number">15.2.4.8.</span> <span class="toc-text">rows</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Extra"><span class="toc-number">15.2.4.9.</span> <span class="toc-text">Extra</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96"><span class="toc-number">15.3.</span> <span class="toc-text">索引优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E7%B4%A2%E5%BC%95-vs-%E4%B8%8D%E5%8A%A0%E7%B4%A2%E5%BC%95"><span class="toc-number">15.3.1.</span> <span class="toc-text">加索引 vs 不加索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80%E5%8E%9F%E5%88%99"><span class="toc-number">15.3.2.</span> <span class="toc-text">最左前缀原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E6%83%85%E5%86%B5"><span class="toc-number">15.3.3.</span> <span class="toc-text">索引失效情况</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%88%97%E5%8F%82%E5%8A%A0%E4%BA%86%E8%BF%90%E7%AE%97%EF%BC%8C%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="toc-number">15.3.3.1.</span> <span class="toc-text">索引列参加了运算，索引失效</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%88%97%E8%BF%9B%E8%A1%8C%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%E6%97%B6%E4%BB%A5-%E5%BC%80%E5%A7%8B%E7%9A%84%EF%BC%8C%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="toc-number">15.3.3.2.</span> <span class="toc-text">索引列进行模糊查询时以 % 开始的，索引失效</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%88%97%E6%98%AF%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B%EF%BC%8C%E4%BD%86%E6%9F%A5%E8%AF%A2%E6%97%B6%E7%9C%81%E7%95%A5%E4%BA%86%E5%8D%95%E5%BC%95%E5%8F%B7%EF%BC%8C%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="toc-number">15.3.3.3.</span> <span class="toc-text">索引列是字符串类型，但查询时省略了单引号，索引失效</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6%E4%B8%AD%E6%9C%89or%EF%BC%8C%E5%8F%AA%E8%A6%81%E6%9C%89%E6%9C%AA%E6%B7%BB%E5%8A%A0%E7%B4%A2%E5%BC%95%E7%9A%84%E5%AD%97%E6%AE%B5%EF%BC%8C%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="toc-number">15.3.3.4.</span> <span class="toc-text">查询条件中有or，只要有未添加索引的字段，索引失效</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%93%E6%9F%A5%E8%AF%A2%E7%9A%84%E7%AC%A6%E5%90%88%E6%9D%A1%E4%BB%B6%E7%9A%84%E8%AE%B0%E5%BD%95%E5%9C%A8%E8%A1%A8%E4%B8%AD%E5%8D%A0%E6%AF%94%E8%BE%83%E5%A4%A7%EF%BC%8C%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="toc-number">15.3.3.5.</span> <span class="toc-text">当查询的符合条件的记录在表中占比较大，索引失效</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Eis-null%E5%92%8Cis-not-null%E7%9A%84%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98"><span class="toc-number">15.3.3.6.</span> <span class="toc-text">关于is null和is not null的索引失效问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E7%B4%A2%E5%BC%95"><span class="toc-number">15.3.4.</span> <span class="toc-text">指定索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95-1"><span class="toc-number">15.3.5.</span> <span class="toc-text">覆盖索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95"><span class="toc-number">15.3.6.</span> <span class="toc-text">前缀索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E5%88%97%E7%B4%A2%E5%BC%95%E5%92%8C%E5%A4%8D%E5%90%88%E7%B4%A2%E5%BC%95%E6%80%8E%E4%B9%88%E9%80%89%E6%8B%A9"><span class="toc-number">15.3.7.</span> <span class="toc-text">单列索引和复合索引怎么选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%88%9B%E5%BB%BA%E5%8E%9F%E5%88%99"><span class="toc-number">15.3.8.</span> <span class="toc-text">索引创建原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E4%BC%98%E5%8C%96"><span class="toc-number">15.4.</span> <span class="toc-text">SQL优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#order-by%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-number">15.4.1.</span> <span class="toc-text">order by的优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#group-by%E4%BC%98%E5%8C%96"><span class="toc-number">15.4.2.</span> <span class="toc-text">group by优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#limit%E4%BC%98%E5%8C%96"><span class="toc-number">15.4.3.</span> <span class="toc-text">limit优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E4%BC%98%E5%8C%96"><span class="toc-number">15.4.4.</span> <span class="toc-text">主键优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#insert%E4%BC%98%E5%8C%96"><span class="toc-number">15.4.5.</span> <span class="toc-text">insert优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#count-%E4%BC%98%E5%8C%96"><span class="toc-number">15.4.6.</span> <span class="toc-text">count(*)优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update%E4%BC%98%E5%8C%96"><span class="toc-number">15.4.7.</span> <span class="toc-text">update优化</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/da77c56c.html" title="MVC架构设计模式"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/25.jpg" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="MVC架构设计模式"/></a><div class="content"><a class="title" href="/posts/da77c56c.html" title="MVC架构设计模式">MVC架构设计模式</a><time datetime="2026-11-14T16:24:00.000Z" title="发表于 2026-11-15 00:24:00">2026-11-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/e25feb6e.html" title="黑马程序员SSM"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/23.jpg" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="黑马程序员SSM"/></a><div class="content"><a class="title" href="/posts/e25feb6e.html" title="黑马程序员SSM">黑马程序员SSM</a><time datetime="2026-02-03T03:14:00.000Z" title="发表于 2026-02-03 11:14:00">2026-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/eedaddf.html" title="博客笔记"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/24.png" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="博客笔记"/></a><div class="content"><a class="title" href="/posts/eedaddf.html" title="博客笔记">博客笔记</a><time datetime="2026-02-03T02:50:00.000Z" title="发表于 2026-02-03 10:50:00">2026-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5764bc58.html" title="饱了么前端"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/33.png" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="饱了么前端"/></a><div class="content"><a class="title" href="/posts/5764bc58.html" title="饱了么前端">饱了么前端</a><time datetime="2026-02-03T02:50:00.000Z" title="发表于 2026-02-03 10:50:00">2026-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2821e645.html" title="饱了么后端"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/30.png" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="饱了么后端"/></a><div class="content"><a class="title" href="/posts/2821e645.html" title="饱了么后端">饱了么后端</a><time datetime="2026-02-03T02:50:00.000Z" title="发表于 2026-02-03 10:50:00">2026-02-03</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By Shelter</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><script src="/js/tw_cn.js?v=5.5.4"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://blog.dreamshelter.cn/twikooapi/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://blog.dreamshelter.cn/twikooapi/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script src="https://fastly.jsdelivr.net/npm/live2d-widgets@1.0.0/dist/autoload.js"></script><div class="aplayer no-destroy" data-id="17745883873" data-server="netease" data-type="playlist" data-order="list" data-fixed="true" data-preload="auto" data-autoplay="true" data-mutex="true" ></div><script id="canvas_nest" defer="defer" color="255,192,203" opacity="0" zIndex="-1" count="80" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"]):not([href=".aside-content"]):not([href="#aside-content"]):not([href=".card-clock
# Inject the css and script (aplayer/meting) aplayerInject: enable: true per_page: true
# 通知弹窗 # Snackbar - Toast Notification # https://github.com/polonel/SnackBar # position: top-left / top-center / top-right / bottom-left / bottom-center / bottom-right snackbar: enable: true position: top-right # The background color of Toast Notification in light mode and dark mode bg_light: "])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      false
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><div id="app-refresh" style="position: fixed; top: -2.2rem; left: 0; right: 0; z-index: 99999; padding: 0 1rem; font-size: 15px; height: 2.2rem; transition: all 0.3s ease;"><div class="app-refresh-wrap" style="display: flex; color: #fff; height: 100%; align-items: center; justify-content: center;"><label>🚀 有新内容发布啦！</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color: #fff; text-decoration: underline; cursor: pointer; margin-left: 8px;">点击刷新</span></a></div></div><script>if ('serviceWorker' in navigator) {
  // 如果当前页面受 Service Worker 控制，监听控制权变化
  if (navigator.serviceWorker.controller) {
    navigator.serviceWorker.addEventListener('controllerchange', function() {
      showNotification();
    });
  }

  // 页面加载完成后注册 sw.js
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js').catch(err => {
      console.error('PWA 注册失败:', err);
    });
  });
}

function showNotification() {
  // 优先使用主题自带的 Snackbar 弹窗
  if (window.GLOBAL_CONFIG && GLOBAL_CONFIG.Snackbar) {
    var snackbarBg = document.documentElement.getAttribute('data-theme') === 'light' ?
      GLOBAL_CONFIG.Snackbar.bgLight :
      GLOBAL_CONFIG.Snackbar.bgDark;
    
    var snackbarPos = GLOBAL_CONFIG.Snackbar.position;

    Snackbar.show({
      text: '🚀 有新文章发布啦！',
      backgroundColor: snackbarBg,
      duration: 10000, // 持续 10 秒
      pos: snackbarPos,
      actionText: '点击刷新',
      actionTextColor: '#fff',
      onActionClick: function(e) {
        location.reload();
      },
    });
  } else {
    // 如果没有 Snackbar，则显示顶部的 app-refresh 栏
    var showBg = document.documentElement.getAttribute('data-theme') === 'light' ? '#49b1f5' : '#1f1f1f';
    var appRefresh = document.getElementById('app-refresh');
    if (appRefresh) {
      appRefresh.style.cssText = 'top: 0; background: ' + showBg + ';';
    }
  }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索点什么呢………" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.4"></script></div></div><!-- hexo injector body_end start -->
  <script data-pjax src="/js/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://vercelapi.dreamshelter.cn/api?user=shelter67";
            var git_color =['#ebedf0', '#a2f7af', '#6ce480', '#54ad63', '#469252', '#31753c', '#1f5f2a', '#13531f', '#084111', '#032b09', '#000000'];
            var git_user ="shelter67";
            var parent_div_git = document.getElementsByClassName('layout')[0];
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/gongxianban/'){
                console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar");
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementsByClassName('layout')[0]){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><script data-pjax>
function hexo_butterfly_clock_remake_injector_config(){
  var parent_div_git;
  var item_html = `<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-veeink@1.0.7/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>`;

  // 按类型获取容器
  if ('class' === 'class') {
    parent_div_git = document.getElementsByClassName('aside-content')[0];
  } else if ('class' === 'id') {
    parent_div_git = document.getElementById('aside-content');
  } else {
    parent_div_git = document.getElementById('aside-content');
  }

  if(parent_div_git){
    var reference_el_before = null;
    var reference_el_after = parent_div_git.querySelector('.card-announcement');

    if(reference_el_before){
      parent_div_git.insertBefore(
        (function(){var temp = document.createElement('div'); temp.innerHTML = item_html; return temp;}()),
        reference_el_before
      );
    } else if(reference_el_after){
      reference_el_after.insertAdjacentHTML('afterend', item_html);
    } else {
      parent_div_git.insertAdjacentHTML('afterbegin', item_html);
    }
  }
}

console.log('已挂载 butterfly_clock_anzhiyu-yang 修复版');

// ---------- 全局变量声明 ----------
var cpage = location.pathname;
var epage = 'all';
var qweather_key = '0df3cf714a324957b16f3201e86fe931';
var qweather_api_host = 'https://p65ctvhqy4.re.qweatherapi.com';
var default_city = '';
var gaud_map_key = '296709bdb591a3523a2cf60e8e8f0ba3';

// ---------- 页面过滤 ----------
var elist = 'null'.split(',');
var flag = 0;
for(var i=0;i<elist.length;i++){
  if(cpage.includes(elist[i])) flag++;
}

if((epage === 'all') && (flag == 0)){
  hexo_butterfly_clock_remake_injector_config();
} else if(epage === cpage){
  hexo_butterfly_clock_remake_injector_config();
}
</script><script data-pjax src="/js/clock-min.js"></script><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementsByClassName('footer-other')[0];
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v8.1.1" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v5.5.4" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://cloud.tencent.com/" style="margin-inline:5px" data-title="本站由腾讯云提供服务器支持" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Server-Tencent%20Cloud-00A4FF?style=flat&amp;logo=qq&amp;logoColor=white" alt=""/></a><a class="github-badge" target="_blank" href="https://edgeone.ai/" style="margin-inline:5px" data-title="本站由腾讯云 EdgeOne 提供安全加速" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-EdgeOne-00A4FF?style=flat&amp;logo=iCloud&amp;logoColor=white" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="https://beian.miit.gov.cn/" style="margin-inline:5px" data-title="工业和信息化部ICP备案管理系统" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/%E9%B2%81ICP%E5%A4%87-2025199346%E5%8F%B7--1-ba9132?style=flat&amp;labelColor=443d38" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://www.fomal.cc/static/js/runtime.js"></script><!-- hexo injector body_end end --></body></html>