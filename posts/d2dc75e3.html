<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><link rel=manifest href=/manifest.json><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>老杜MyBatis | Shelter</title><meta name="author" content="Shelter"><meta name="copyright" content="Shelter"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、MyBatis概述1.1 框架 在文献中看到的framework被翻译为框架 Java常用框架： SSM三大框架：Spring + SpringMVC + MyBatis SpringBoot SpringCloud 等。。   框架其实就是对通用代码的封装，提前写好了一堆接口和类，我们可以在做项目的时候直接引入这些接口和类（引入框架），基于这些现有的接口和类进行开发，可以大大提高开发效率。">
<meta property="og:type" content="article">
<meta property="og:title" content="老杜MyBatis">
<meta property="og:url" content="http://localhost:4000/posts/d2dc75e3.html">
<meta property="og:site_name" content="Shelter">
<meta property="og:description" content="一、MyBatis概述1.1 框架 在文献中看到的framework被翻译为框架 Java常用框架： SSM三大框架：Spring + SpringMVC + MyBatis SpringBoot SpringCloud 等。。   框架其实就是对通用代码的封装，提前写好了一堆接口和类，我们可以在做项目的时候直接引入这些接口和类（引入框架），基于这些现有的接口和类进行开发，可以大大提高开发效率。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.dreamshelter.cn/blog/source/img/cover/18.png">
<meta property="article:published_time" content="2025-12-09T19:12:00.000Z">
<meta property="article:modified_time" content="2026-02-09T10:05:54.007Z">
<meta property="article:author" content="Shelter">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Mybatis">
<meta property="article:tag" content="SSM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.dreamshelter.cn/blog/source/img/cover/18.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "老杜MyBatis",
  "url": "http://localhost:4000/posts/d2dc75e3.html",
  "image": "https://cdn.dreamshelter.cn/blog/source/img/cover/18.png",
  "datePublished": "2025-12-09T19:12:00.000Z",
  "dateModified": "2026-02-09T10:05:54.007Z",
  "author": [
    {
      "@type": "Person",
      "name": "Shelter",
      "url": "https://github.com/Shelter67"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.dreamshelter.cn/blog/source/img/favicon.png"><link rel="canonical" href="http://localhost:4000/posts/d2dc75e3.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="#49b1f5"/><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/128.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"/><link rel="mask-icon" href="/img/siteicon/128.png" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":3,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '老杜MyBatis',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><style>#waifu { left: auto !important; right: 20px !important; }</style><!-- hexo injector head_end start --><link rel="stylesheet" href="https://www.fomal.cc/static/css/runtime.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-veeink@1.0.7/lib/clock-min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 8.1.1"></head><body><div class="bg-animation" id="web_bg" style="background-image: url(https://cdn.dreamshelter.cn/blog/source/img/background.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/touxiang.jpg" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/zhuifan.html"><i class="fa-fw fas fa-tv"></i><span> 追番</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/zhuiju.html"><i class="fa-fw fas fa-video"></i><span> 追剧</span></a></div><div class="menus_item"><a class="site-page" href="/gongxianban"><i class="fa-fw fab fa-github-alt"></i><span> 贡献板</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.dreamshelter.cn/blog/source/img/cover/18.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Shelter</span></a><a class="nav-page-title" href="/"><span class="site-name">老杜MyBatis</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/zhuifan.html"><i class="fa-fw fas fa-tv"></i><span> 追番</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/zhuiju.html"><i class="fa-fw fas fa-video"></i><span> 追剧</span></a></div><div class="menus_item"><a class="site-page" href="/gongxianban"><i class="fa-fw fab fa-github-alt"></i><span> 贡献板</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">老杜MyBatis</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-12-09T19:12:00.000Z" title="发表于 2025-12-10 03:12:00">2025-12-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-09T10:05:54.007Z" title="更新于 2026-02-09 18:05:54">2026-02-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">45.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>210分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2026-02-09 18:05:54&quot;}" hidden></div><h1 id=""><a href="#" class="headerlink" title=""></a><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#averageHue=%23dad8d7&clientId=u6b7aa99c-2be4-4&from=paste&id=wdOV9&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></h1><h1 id="一、MyBatis概述"><a href="#一、MyBatis概述" class="headerlink" title="一、MyBatis概述"></a>一、MyBatis概述</h1><h2 id="1-1-框架"><a href="#1-1-框架" class="headerlink" title="1.1 框架"></a>1.1 框架</h2><ul>
<li>在文献中看到的framework被翻译为框架</li>
<li>Java常用框架：<ul>
<li>SSM三大框架：Spring + SpringMVC + MyBatis</li>
<li>SpringBoot</li>
<li>SpringCloud</li>
<li>等。。</li>
</ul>
</li>
<li>框架其实就是对通用代码的封装，提前写好了一堆接口和类，我们可以在做项目的时候直接引入这些接口和类（引入框架），基于这些现有的接口和类进行开发，可以大大提高开发效率。</li>
<li>框架一般都以jar包的形式存在。(jar包中有class文件以及各种配置文件等。)</li>
<li>SSM三大框架的学习顺序：MyBatis、Spring、SpringMVC（仅仅是建议）</li>
</ul>
<h2 id="1-2-三层架构"><a href="#1-2-三层架构" class="headerlink" title="1.2 三层架构"></a>1.2 三层架构</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659575815289-a76d30d9-f072-483a-bda7-b1fc8afc6f82.png#averageHue=%23d3d9de&clientId=u6b7aa99c-2be4-4&from=paste&height=430&id=u14695784&originHeight=804&originWidth=1448&originalType=binary&ratio=1&rotation=0&showTitle=false&size=95422&status=done&style=shadow&taskId=ufba163d4-60f2-4941-b75a-4c34720010f&title=&width=775" alt="三层架构.png"></p>
<ul>
<li>表现层（UI）：直接跟前端打交互（一是接收前端ajax请求，二是返回json数据给前端）</li>
<li>业务逻辑层（BLL）：一是处理表现层转发过来的前端请求（也就是具体业务），二是将从持久层获取的数据返回到表现层。</li>
<li>数据访问层（DAL）：直接操作数据库完成CRUD，并将获得的数据返回到上一层（也就是业务逻辑层）。</li>
<li>Java持久层框架：<ul>
<li>MyBatis</li>
<li>Hibernate（实现了JPA规范）</li>
<li>jOOQ</li>
<li>Guzz</li>
<li>Spring Data（实现了JPA规范）</li>
<li>ActiveJDBC</li>
<li>……</li>
</ul>
</li>
</ul>
<h2 id="1-3-JDBC不足"><a href="#1-3-JDBC不足" class="headerlink" title="1.3 JDBC不足"></a>1.3 JDBC不足</h2><ul>
<li>示例代码1：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ......</span></span><br><span class="line"><span class="comment">// sql语句写死在java程序中</span></span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_user(id,idCard,username,password,birth,gender,email,city,street,zipcode,phone,grade) values(?,?,?,?,?,?,?,?,?,?,?,?)&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line"><span class="comment">// 繁琐的赋值：思考一下，这种有规律的代码能不能通过反射机制来做自动化。</span></span><br><span class="line">ps.setString(<span class="number">1</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">2</span>, <span class="string">&quot;123456789&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">3</span>, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">4</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">5</span>, <span class="string">&quot;1980-10-11&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">6</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">7</span>, <span class="string">&quot;zhangsan@126.com&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">8</span>, <span class="string">&quot;北京&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">9</span>, <span class="string">&quot;大兴区凉水河二街&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">10</span>, <span class="string">&quot;1000000&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">11</span>, <span class="string">&quot;16398574152&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">12</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line"><span class="comment">// 执行SQL</span></span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> ps.executeUpdate();</span><br><span class="line"><span class="comment">// ......</span></span><br></pre></td></tr></table></figure>

<ul>
<li>示例代码2：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ......</span></span><br><span class="line"><span class="comment">// sql语句写死在java程序中</span></span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select id,idCard,username,password,birth,gender,email,city,street,zipcode,phone,grade from t_user&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> ps.executeQuery();</span><br><span class="line">List&lt;User&gt; userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// 思考以下循环中的所有代码是否可以使用反射进行自动化封装。</span></span><br><span class="line"><span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">    <span class="comment">// 获取数据</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">idCard</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;idCard&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">birth</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;birth&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">gender</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;gender&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">city</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;city&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">street</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;street&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">zipcode</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;zipcode&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;phone&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">grade</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;grade&quot;</span>);</span><br><span class="line">    <span class="comment">// 创建对象</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    <span class="comment">// 给对象属性赋值</span></span><br><span class="line">    user.setId(id);</span><br><span class="line">    user.setIdCard(idCard);</span><br><span class="line">    user.setUsername(username);</span><br><span class="line">    user.setPassword(password);</span><br><span class="line">    user.setBirth(birth);</span><br><span class="line">    user.setGender(gender);</span><br><span class="line">    user.setEmail(email);</span><br><span class="line">    user.setCity(city);</span><br><span class="line">    user.setStreet(street);</span><br><span class="line">    user.setZipcode(zipcode);</span><br><span class="line">    user.setPhone(phone);</span><br><span class="line">    user.setGrade(grade);</span><br><span class="line">    <span class="comment">// 添加到集合</span></span><br><span class="line">    userList.add(user);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ......</span></span><br></pre></td></tr></table></figure>

<ul>
<li>JDBC不足：<ul>
<li>SQL语句写死在Java程序中，不灵活。改SQL的话就要改Java代码。违背开闭原则OCP。</li>
<li>给?传值是繁琐的。能不能自动化？？？</li>
<li>将结果集封装成Java对象是繁琐的。能不能自动化？？？</li>
</ul>
</li>
</ul>
<h2 id="1-4-了解MyBatis"><a href="#1-4-了解MyBatis" class="headerlink" title="1.4 了解MyBatis"></a>1.4 了解MyBatis</h2><ul>
<li>MyBatis本质上就是对JDBC的封装，通过MyBatis完成CRUD。</li>
<li>MyBatis在三层架构中负责持久层的，属于持久层框架。</li>
<li>MyBatis的发展历程：【引用百度百科】<ul>
<li>MyBatis本是apache的一个开源项目iBatis，2010年这个项目由apache software foundation迁移到了google code，并且改名为MyBatis。2013年11月迁移到Github。</li>
<li>iBATIS一词来源于“internet”和“abatis”的组合，是一个基于Java的持久层框架。iBATIS提供的持久层框架包括SQL Maps和Data Access Objects（DAOs）。</li>
</ul>
</li>
<li>打开mybatis代码可以看到它的包结构中包含：ibatis<ul>
<li><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659580495482-02167fb7-a183-4337-bfbe-f9ab50e736d6.png#averageHue=%23e8c273&clientId=u6b7aa99c-2be4-4&from=paste&height=146&id=u383be560&originHeight=146&originWidth=427&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5675&status=done&style=none&taskId=uc32d6afd-346b-4151-8933-728a4a66a30&title=&width=427" alt="42857443-5184-45b5-8AD4-2B281C88A8CC.png"></li>
</ul>
</li>
<li>ORM：对象关系映射<ul>
<li>O（Object）：Java虚拟机中的Java对象</li>
<li>R（Relational）：关系型数据库</li>
<li>M（Mapping）：将Java虚拟机中的Java对象映射到数据库表中一行记录，或是将数据库表中一行记录映射成Java虚拟机中的一个Java对象。</li>
<li>ORM图示<ul>
<li><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659580953095-86e388ac-13b5-4448-b90a-2aacd36688ef.png#averageHue=%23d7d9d2&clientId=u6b7aa99c-2be4-4&from=paste&height=200&id=uebaeb73c&originHeight=200&originWidth=579&originalType=binary&ratio=1&rotation=0&showTitle=false&size=98143&status=done&style=none&taskId=ua834ac11-2f7e-406c-9c58-d7665141cb3&title=&width=579" alt="C48A1A89-244D-40f4-85DB-F1E665A2EA62.png"></li>
<li><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659580965550-87c43dee-f1c4-4bdd-b15e-14f831b3d0da.png#averageHue=%23efa67e&clientId=u6b7aa99c-2be4-4&from=paste&height=333&id=u6c63cd39&originHeight=333&originWidth=465&originalType=binary&ratio=1&rotation=0&showTitle=false&size=92293&status=done&style=none&taskId=u65b49126-aa66-4916-8c8f-7799b39c26c&title=&width=465" alt="A21555BB-55B7-4d7c-8AB0-F49B10E96BD3.png"></li>
</ul>
</li>
<li>MyBatis属于半自动化ORM框架。</li>
<li>Hibernate属于全自动化的ORM框架。</li>
</ul>
</li>
<li>MyBatis框架特点：<ul>
<li>支持定制化 SQL、存储过程、基本映射以及高级映射</li>
<li>避免了几乎所有的 JDBC 代码中手动设置参数以及获取结果集</li>
<li>支持XML开发，也支持注解式开发。【为了保证sql语句的灵活，所以mybatis大部分是采用XML方式开发。】</li>
<li>将接口和 Java 的 POJOs(Plain Ordinary Java Object，简单普通的Java对象)映射成数据库中的记录</li>
<li>体积小好学：两个jar包，两个XML配置文件。</li>
<li>完全做到sql解耦合。</li>
<li>提供了基本映射标签。</li>
<li>提供了高级映射标签。</li>
<li>提供了XML标签，支持动态SQL的编写。</li>
<li>……</li>
</ul>
</li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#averageHue=%23dad8d7&clientId=u6b7aa99c-2be4-4&from=paste&id=ddeIZ&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p>
<h1 id="二、MyBatis入门程序"><a href="#二、MyBatis入门程序" class="headerlink" title="二、MyBatis入门程序"></a>二、MyBatis入门程序</h1><p>只要你会JDBC，MyBatis就可以学。</p>
<h2 id="2-1-版本"><a href="#2-1-版本" class="headerlink" title="2.1 版本"></a>2.1 版本</h2><h3 id="软件版本："><a href="#软件版本：" class="headerlink" title="软件版本："></a>软件版本：</h3><ul>
<li>IntelliJ IDEA：2022.1.4</li>
<li>Navicat for MySQL：16.0.14</li>
<li>MySQL数据库：8.0.30</li>
</ul>
<h3 id="组件版本："><a href="#组件版本：" class="headerlink" title="组件版本："></a>组件版本：</h3><ul>
<li>MySQL驱动：8.0.30</li>
<li>MyBatis：3.5.10</li>
<li>JDK：Java17</li>
<li>JUnit：4.13.2</li>
<li>Logback：1.2.11</li>
</ul>
<h2 id="2-2-MyBatis下载"><a href="#2-2-MyBatis下载" class="headerlink" title="2.2 MyBatis下载"></a>2.2 MyBatis下载</h2><ul>
<li>从github上下载，地址：<a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3">https://github.com/mybatis/mybatis-3</a><ul>
<li><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659582991347-ee21a960-e4ae-45a0-83cf-74b3f1f3825c.png#averageHue=%23f7f5f4&clientId=u6b7aa99c-2be4-4&from=paste&height=583&id=u79fa1b52&originHeight=583&originWidth=895&originalType=binary&ratio=1&rotation=0&showTitle=false&size=52133&status=done&style=none&taskId=u6d588ea3-579a-43ba-a3e5-47f665a9063&title=&width=895" alt="2FFBA369-A41E-4b17-81C5-68A18B8A428F.png"></li>
<li><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659583157781-fd860428-d25b-4c4c-9e68-0219de7d3ba9.png#averageHue=%23fefbfb&clientId=u6b7aa99c-2be4-4&from=paste&height=764&id=u173d560e&originHeight=764&originWidth=909&originalType=binary&ratio=1&rotation=0&showTitle=false&size=61215&status=done&style=none&taskId=u328f6d3e-c76d-41c2-af07-e4cbaef3550&title=&width=909" alt="0D36080D-53BB-42ac-9E19-26260818134E.png"></li>
</ul>
</li>
<li>将框架以及框架的源码都下载下来，下载框架后解压，打开mybatis目录<ul>
<li><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659583275291-4ba5ba90-5420-449e-97f4-2ec759c994ca.png#averageHue=%23fcf3f1&clientId=u6b7aa99c-2be4-4&from=paste&height=121&id=u45bb9d9a&originHeight=121&originWidth=249&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5298&status=done&style=none&taskId=u2c199df7-1df7-48e9-b3f4-6354160cf01&title=&width=249" alt="55C87E1A-E3AA-414f-9281-CE7D5702EA17.png"></li>
<li>通过以上解压可以看到，框架一般都是以jar包的形式存在。我们的mybatis课程使用maven，所以这个jar我们不需要。</li>
<li>官方手册需要。</li>
</ul>
</li>
</ul>
<h2 id="2-3-MyBatis入门程序开发步骤"><a href="#2-3-MyBatis入门程序开发步骤" class="headerlink" title="2.3 MyBatis入门程序开发步骤"></a>2.3 MyBatis入门程序开发步骤</h2><ul>
<li>写代码前准备：<ul>
<li>准备数据库表：汽车表t_car，字段包括：<ul>
<li>id：主键（自增）【bigint】</li>
<li>car_num：汽车编号【varchar】</li>
<li>brand：品牌【varchar】</li>
<li>guide_price：厂家指导价【decimal类型，专门为财务数据准备的类型】</li>
<li>produce_time：生产时间【char，年月日即可，10个长度，’2022-10-11’】</li>
<li>car_type：汽车类型（燃油车、电车、氢能源）【varchar】</li>
</ul>
</li>
<li>使用navicat for mysql工具建表<ul>
<li><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659596348287-5876735d-ba3b-43d2-9e73-1c4bdb29e8b5.png#averageHue=%23f7f6f5&clientId=u6b7aa99c-2be4-4&from=paste&height=288&id=u664bee8c&originHeight=288&originWidth=960&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18316&status=done&style=none&taskId=udecdafbb-71bd-4e05-b034-f1a2f812112&title=&width=960" alt="16B6D507-440F-460f-9D1F-39653A3B6EC2.png"></li>
</ul>
</li>
<li>使用navicat for mysql工具向t_car表中插入两条数据，如下：<ul>
<li><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659596615335-60a93468-5a9e-48b8-acb7-cb4be313b8f1.png#averageHue=%23f5f3f2&clientId=u6b7aa99c-2be4-4&from=paste&height=170&id=u8c4dc450&originHeight=170&originWidth=566&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9743&status=done&style=none&taskId=ua73fd204-98f9-4141-85f1-53e5ef0e674&title=&width=566" alt="7E8510B9-9886-41c9-9495-0AE7888560B9.png"></li>
</ul>
</li>
<li>创建Project：建议创建Empty Project，设置Java版本以及编译版本等。<ul>
<li><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659585665160-94c930e0-611c-46fa-b87d-aa9489ec85c8.png#averageHue=%233d4144&clientId=u6b7aa99c-2be4-4&from=paste&height=604&id=uabae2fee&originHeight=604&originWidth=782&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25720&status=done&style=none&taskId=u0f32e2ca-e7a1-4982-894f-73729a33c21&title=&width=782" alt="52176FB4-6DB5-4264-8940-34A3506C2A0C.png"></li>
<li><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659585756219-b17df6ac-8bb8-4d3e-bd4b-44f5d41c41c0.png#averageHue=%233d4146&clientId=u6b7aa99c-2be4-4&from=paste&height=383&id=u97e3ab74&originHeight=383&originWidth=750&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19995&status=done&style=none&taskId=u2debb595-ca67-40c5-a1f8-c7ad79a72b4&title=&width=750" alt="1C8EB1AF-0465-4e2d-816A-B7FFBA2E42C4.png"></li>
</ul>
</li>
<li>设置IDEA的maven<ul>
<li><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659586287914-4b6d4e74-f5f4-4800-901e-04f017d65ce0.png#averageHue=%233d4246&clientId=u6b7aa99c-2be4-4&from=paste&height=701&id=u3b9af48c&originHeight=701&originWidth=977&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39072&status=done&style=none&taskId=uba85744a-5efc-48cd-8461-f8df0fc000c&title=&width=977" alt="3EA79931-EE2C-46f4-BDB2-6AB99EDFCA87.png"></li>
</ul>
</li>
<li>创建Module：普通的Maven Java模块<ul>
<li><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659586416938-a08b3128-4232-425b-a4a0-958956c52bc8.png#averageHue=%233d4144&clientId=u6b7aa99c-2be4-4&from=paste&height=603&id=ua350e75f&originHeight=603&originWidth=779&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30514&status=done&style=none&taskId=u99122205-9b44-42de-a7c4-ae6d927c61c&title=&width=779" alt="8F6F3B34-B1F7-4fcb-9584-AF629200534F.png"></li>
</ul>
</li>
</ul>
</li>
<li>步骤1：打包方式：jar（不需要war，因为mybatis封装的是jdbc。）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.powernode<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-001-introduction<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--打包方式jar--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>步骤2：引入依赖（mybatis依赖 + mysql驱动依赖）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis核心依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mysql驱动依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>步骤3：编写mybatis核心配置文件， 在resources根目录下新建mybatis-config.xml配置文件（可以参考mybatis手册拷贝），这个文件名称和位置不是固定的，一般情况是放在类的根路径下（resources里的东西都属于类根路径）</p>
<p>另一个核心配置文件是xxxMapper.xml，在这个配置文件当中编写SQL语句（一表一个）。</p>
<ul>
<li>比如t_user表会对应一个UserMapper.xml</li>
</ul>
<p>以下是mybatis-config.xml</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/powernode&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--sql映射文件创建好之后，需要将该文件路径配置到这里，resource是从类根路径开始查找--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;CarMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意1：mybatis核心配置文件的文件名不一定是mybatis-config.xml，可以是其它名字。<br>注意2：mybatis核心配置文件存放的位置也可以随意。这里选择放在resources根下，相当于放到了类的根路径下。</p>
<ul>
<li>步骤4：在resources根目录下新建CarMapper.xml配置文件（可以参考mybatis手册拷贝）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--namespace命名空间先随意写一个--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--insert语句，id是这条SQL语句的唯一标识。这个id就代表了这条SQL语句。--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertCar&quot;</span>&gt;</span></span><br><span class="line">        insert into t_car</span><br><span class="line">            (id,car_num,brand,guide_price,produce_time,car_type) </span><br><span class="line">        values</span><br><span class="line">            (null,&#x27;102&#x27;,&#x27;丰田mirai&#x27;,40.30,&#x27;2014-10-05&#x27;,&#x27;氢能源&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意1：<strong>sql语句最后结尾可以不写“;”</strong><br>注意2：CarMapper.xml文件的名字不是固定的。可以使用其它名字。<br>注意3：CarMapper.xml文件的位置也是随意的。这里选择放在resources根下，相当于放到了类的根路径下。<br>注意4：将CarMapper.xml文件路径配置到mybatis-config.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;CarMapper.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>步骤5：编写MyBatisIntroductionTest代码</p>
<p>在MyBatis当中，负责执行SQL语句的那个对象叫做SqlSession，<br>SqlSession是专门用来执行SQL语句的，是一个Java程序和数据库之间的一次会话。<br>要想获取SqlSession对象，需要先获取SqlSessionFactory对象，通过SqlSessionFactory工厂来生产SqlSession对象。<br>怎么获取SqlSessionFactory对象呢？<br>    需要首先获取SqlSessionFactoryBuilder对象。<br>    通过SqlSessionFactoryBuilder对象的build方法，来获取一个SqlSessionFactory对象。<br>mybatis的核心对象包括：</p>
<ol>
<li>​    SqlSessionFactoryBuilder</li>
<li>​    SqlSessionFactory</li>
<li>​    SqlSession</li>
</ol>
<p>顺序是：SqlSessionFactoryBuilder –&gt; SqlSessionFactory –&gt; SqlSession</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MyBatis入门程序</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisIntroductionTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 创建SqlSessionFactoryBuilder对象</span></span><br><span class="line">        <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line">        <span class="comment">// 2. 创建SqlSessionFactory对象，build里需要传入一个输入流，这个输入流指向mybatis-config.xml</span></span><br><span class="line">        <span class="comment">//Resources是mybatis的工具类，Resources.getResourceAsStream默认就是从类的根路径下开始查找资源。</span></span><br><span class="line">        <span class="comment">//InputStream is = Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;);</span></span><br><span class="line">        <span class="comment">//通过系统类加载器调用getResourceAsStream</span></span><br><span class="line">        <span class="comment">//InputStream is = ClassLoader.getSystemClassLoader().getResourceAsStream(&quot;mybatis-config.xml&quot;);</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader().getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(is);</span><br><span class="line">        <span class="comment">// 3. 创建SqlSession对象，执行openSession返回SqlSession，如果使用的事务管理器是JDBC的话，底层实际上会执行:conn.setAutocommit(false);</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">        <span class="comment">// 4. 执行sql</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> sqlSession.insert(<span class="string">&quot;insertCar&quot;</span>); <span class="comment">// 这个&quot;insertCar&quot;必须是sql的id，返回值是影响数据库表当中的记录条数:</span></span><br><span class="line">        System.out.println(<span class="string">&quot;插入几条数据：&quot;</span> + count);</span><br><span class="line">        <span class="comment">// 5. 提交（mybatis默认采用的事务管理器是JDBC，默认是不提交的，需要手动提交。）</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        <span class="comment">// 6. 关闭资源（只关闭是不会提交的）</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于第一个程序的小细节:</p>
<ul>
<li>mybatis中sql语句的结尾”;”可以省略。</li>
<li>Resources.getResourceAsStream<ul>
<li>小技巧：以后凡是遇到resource这个单词，大部分情况下，这种加载资源的方式就是从类的根路径下开始加载。（开始查找）</li>
<li>优点：采用这种方式，从类路径当中加载资源，项目的移植性很强。项目从windows移植到linux，代码不需要修改，因为这个资源文件一直都在类路径当中。</li>
</ul>
</li>
<li>InputStream is &#x3D; new FileInputStream(“d:\mybatis-config.xml”);采用这种方式也可以。<br>   缺点：可移植性太差，程序不够健壮。可能会移植到其他的操作系统当中。导致以上路径无效，还需要修改java代码中的路径。这样违背了OCP原则。</li>
<li>CarMapper.xml文件的路径都不是固定的。<ul>
<li><mapper resource="CarMapper.xml"/> resource属性：这种方式是从类路径当中加载资源。</li>
<li><mapper url="file:///d:/CarMapper.xml"/> url属性：这种方式是从绝对路径当中加载资源。</li>
</ul>
</li>
</ul>
<p>注意1：默认采用的事务管理器是：JDBC。JDBC事务默认是不提交的，需要手动提交。</p>
<p>关于mybatis的事务管理机制。（深度剖析）：</p>
<ul>
<li><p>在mybatis-config.xml文件中，可以通过以下的配置进行mybatis的事务管理<transactionManager type="JDBC"/></p>
</li>
<li><p>type属性的值包括两个： </p>
<ul>
<li>JDBC(jdbc)：JDBC事务管理器</li>
<li>MANAGED(managed)：MANAGED事务管理器<br>type后面的值，只有以上两个值可选，不区分大小写。</li>
</ul>
</li>
<li><p>JDBC事务管理器：<br>    mybatis框架自己管理事务，自己采用原生的JDBC代码去管理事务：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conn.setAutoCommit(false); 开启事务。</span><br><span class="line">....业务处理...</span><br><span class="line">conn.commit(); 手动提交事务</span><br></pre></td></tr></table></figure>


<p>使用JDBC事务管理器的话，底层创建的事务管理器对象：JdbcTransaction对象。</p>
</li>
</ul>
<p>（看老杜源码剖析）如果你编写的代码是下面的代码就表示没有开启事务。因为这种方式压根不会执行conn.setAutoCommit(false);</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p>在JDBC事务中，如果你没有在JDBC代码中执行：conn.setAutoCommit(false);的话，默认的autoCommit是true。</p>
<p>**重点：**如果autoCommit是true，就表示没有开启事务。只要执行任意一条DML语句就提交一次。只有你的autoCommit是false的时候，就表示开启了事务。</p>
<ul>
<li><p>MANAGED事务管理器：</p>
<p>mybatis不再负责事务的管理了。事务管理交给其它容器来负责。例如：spring。也就是让spring负责事务</p>
<p>对于我们当前的单纯的只有mybatis的情况下，如果配置为：MANAGED</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;MANAGED&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>那么事务这块是没人管的。没有人管理事务表示事务压根没有开启。没有人管理事务就是没有事务。</p>
</li>
<li><p>步骤6：运行程序，查看运行结果，以及数据库表中的数据</p>
<ul>
<li><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659599289005-00bae72a-c64f-41b5-9b87-162f8958efa5.png#averageHue=%23998366&clientId=u6b7aa99c-2be4-4&from=paste&height=171&id=u1f6e97f2&originHeight=171&originWidth=458&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9426&status=done&style=none&taskId=u004b6ae8-ff94-42f0-bf96-9acc738af9d&title=&width=458" alt="211D2E7E-E62B-413a-9710-72AC1EC7D894.png"></li>
<li><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659599334361-3c2733c1-29d5-474c-a217-552ec331b523.png#averageHue=%23f4f3f1&clientId=u6b7aa99c-2be4-4&from=paste&height=189&id=u5cad9434&originHeight=189&originWidth=611&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11487&status=done&style=none&taskId=u065d7ebf-be3a-4f82-8bae-c9c4550558c&title=&width=611" alt="2A4C1E6E-56B8-440e-A368-F10434EACC2D.png"></li>
</ul>
</li>
</ul>
<h2 id="2-5-MyBatis第一个比较完整的代码写法"><a href="#2-5-MyBatis第一个比较完整的代码写法" class="headerlink" title="2.5 MyBatis第一个比较完整的代码写法"></a>2.5 MyBatis第一个比较完整的代码写法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 比较完整的第一个mybatis程序写法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisCompleteCodeTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.创建SqlSessionFactoryBuilder对象</span></span><br><span class="line">            <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line">            <span class="comment">// 2.创建SqlSessionFactory对象</span></span><br><span class="line">            <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">            <span class="comment">// 3.创建SqlSession对象</span></span><br><span class="line">            sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">            <span class="comment">// 4.执行SQL</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> sqlSession.insert(<span class="string">&quot;insertCar&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;更新了几条记录：&quot;</span> + count);</span><br><span class="line">            <span class="comment">// 5.提交</span></span><br><span class="line">            sqlSession.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// 回滚</span></span><br><span class="line">            <span class="keyword">if</span> (sqlSession != <span class="literal">null</span>) &#123;</span><br><span class="line">                sqlSession.rollback();</span><br><span class="line">            &#125;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 6.关闭</span></span><br><span class="line">            <span class="keyword">if</span> (sqlSession != <span class="literal">null</span>) &#123;</span><br><span class="line">                sqlSession.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行后数据库表的变化：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659604100979-edc9b06f-93bb-4c55-880b-38e219d9d9e3.png#averageHue=%23f3f1ef&clientId=u6b7aa99c-2be4-4&from=paste&height=206&id=u4da72fe6&originHeight=206&originWidth=590&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13721&status=done&style=none&taskId=u6651710f-a20b-4007-b39b-0a2f73d81c6&title=&width=590" alt="EC983E7A-7A85-4df7-B5FC-5C4FDC8EA592.png"></p>
<h2 id="2-6-引入JUnit"><a href="#2-6-引入JUnit" class="headerlink" title="2.6 引入JUnit"></a>2.6 引入JUnit</h2><ul>
<li>JUnit是专门做单元测试的组件，在test文件夹执行。<ul>
<li><p>在实际开发中，单元测试一般是由我们Java程序员来完成的。</p>
</li>
<li><p>我们要对我们自己写的每一个业务方法负责任，要保证每个业务方法在进行测试的时候都能通过。</p>
</li>
<li><p>测试的过程中涉及到两个概念：</p>
<ul>
<li>期望值</li>
<li>实际值</li>
</ul>
</li>
<li><pre><code class="language-java"> @Test
 public void testSum(){
     MathService mathService =new MathService();
     // 获取实际值
     int actual = mathService.sum(1, 2);
     // 期望值
     int expected = 3;
     // 加断言进行测试
     Assert.assertEquals(expected, actual);
 }
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br><span class="line">1865</span><br><span class="line">1866</span><br><span class="line">1867</span><br><span class="line">1868</span><br><span class="line">1869</span><br><span class="line">1870</span><br><span class="line">1871</span><br><span class="line">1872</span><br><span class="line">1873</span><br><span class="line">1874</span><br><span class="line">1875</span><br><span class="line">1876</span><br><span class="line">1877</span><br><span class="line">1878</span><br><span class="line">1879</span><br><span class="line">1880</span><br><span class="line">1881</span><br><span class="line">1882</span><br><span class="line">1883</span><br><span class="line">1884</span><br><span class="line">1885</span><br><span class="line">1886</span><br><span class="line">1887</span><br><span class="line">1888</span><br><span class="line">1889</span><br><span class="line">1890</span><br><span class="line">1891</span><br><span class="line">1892</span><br><span class="line">1893</span><br><span class="line">1894</span><br><span class="line">1895</span><br><span class="line">1896</span><br><span class="line">1897</span><br><span class="line">1898</span><br><span class="line">1899</span><br><span class="line">1900</span><br><span class="line">1901</span><br><span class="line">1902</span><br><span class="line">1903</span><br><span class="line">1904</span><br><span class="line">1905</span><br><span class="line">1906</span><br><span class="line">1907</span><br><span class="line">1908</span><br><span class="line">1909</span><br><span class="line">1910</span><br><span class="line">1911</span><br><span class="line">1912</span><br><span class="line">1913</span><br><span class="line">1914</span><br><span class="line">1915</span><br><span class="line">1916</span><br><span class="line">1917</span><br><span class="line">1918</span><br><span class="line">1919</span><br><span class="line">1920</span><br><span class="line">1921</span><br><span class="line">1922</span><br><span class="line">1923</span><br><span class="line">1924</span><br><span class="line">1925</span><br><span class="line">1926</span><br><span class="line">1927</span><br><span class="line">1928</span><br><span class="line">1929</span><br><span class="line">1930</span><br><span class="line">1931</span><br><span class="line">1932</span><br><span class="line">1933</span><br><span class="line">1934</span><br><span class="line">1935</span><br><span class="line">1936</span><br><span class="line">1937</span><br><span class="line">1938</span><br><span class="line">1939</span><br><span class="line">1940</span><br><span class="line">1941</span><br><span class="line">1942</span><br><span class="line">1943</span><br><span class="line">1944</span><br><span class="line">1945</span><br><span class="line">1946</span><br><span class="line">1947</span><br><span class="line">1948</span><br><span class="line">1949</span><br><span class="line">1950</span><br><span class="line">1951</span><br><span class="line">1952</span><br><span class="line">1953</span><br><span class="line">1954</span><br><span class="line">1955</span><br><span class="line">1956</span><br><span class="line">1957</span><br><span class="line">1958</span><br><span class="line">1959</span><br><span class="line">1960</span><br><span class="line">1961</span><br><span class="line">1962</span><br><span class="line">1963</span><br><span class="line">1964</span><br><span class="line">1965</span><br><span class="line">1966</span><br><span class="line">1967</span><br><span class="line">1968</span><br><span class="line">1969</span><br><span class="line">1970</span><br><span class="line">1971</span><br><span class="line">1972</span><br><span class="line">1973</span><br><span class="line">1974</span><br><span class="line">1975</span><br><span class="line">1976</span><br><span class="line">1977</span><br><span class="line">1978</span><br><span class="line">1979</span><br><span class="line">1980</span><br><span class="line">1981</span><br><span class="line">1982</span><br><span class="line">1983</span><br><span class="line">1984</span><br><span class="line">1985</span><br><span class="line">1986</span><br><span class="line">1987</span><br><span class="line">1988</span><br><span class="line">1989</span><br><span class="line">1990</span><br><span class="line">1991</span><br><span class="line">1992</span><br><span class="line">1993</span><br><span class="line">1994</span><br><span class="line">1995</span><br><span class="line">1996</span><br><span class="line">1997</span><br><span class="line">1998</span><br><span class="line">1999</span><br><span class="line">2000</span><br><span class="line">2001</span><br><span class="line">2002</span><br><span class="line">2003</span><br><span class="line">2004</span><br><span class="line">2005</span><br><span class="line">2006</span><br><span class="line">2007</span><br><span class="line">2008</span><br><span class="line">2009</span><br><span class="line">2010</span><br><span class="line">2011</span><br><span class="line">2012</span><br><span class="line">2013</span><br><span class="line">2014</span><br><span class="line">2015</span><br><span class="line">2016</span><br><span class="line">2017</span><br><span class="line">2018</span><br><span class="line">2019</span><br><span class="line">2020</span><br><span class="line">2021</span><br><span class="line">2022</span><br><span class="line">2023</span><br><span class="line">2024</span><br><span class="line">2025</span><br><span class="line">2026</span><br><span class="line">2027</span><br><span class="line">2028</span><br><span class="line">2029</span><br><span class="line">2030</span><br><span class="line">2031</span><br><span class="line">2032</span><br><span class="line">2033</span><br><span class="line">2034</span><br><span class="line">2035</span><br><span class="line">2036</span><br><span class="line">2037</span><br><span class="line">2038</span><br><span class="line">2039</span><br><span class="line">2040</span><br><span class="line">2041</span><br><span class="line">2042</span><br><span class="line">2043</span><br><span class="line">2044</span><br><span class="line">2045</span><br><span class="line">2046</span><br><span class="line">2047</span><br><span class="line">2048</span><br><span class="line">2049</span><br><span class="line">2050</span><br><span class="line">2051</span><br><span class="line">2052</span><br><span class="line">2053</span><br><span class="line">2054</span><br><span class="line">2055</span><br><span class="line">2056</span><br><span class="line">2057</span><br><span class="line">2058</span><br><span class="line">2059</span><br><span class="line">2060</span><br><span class="line">2061</span><br><span class="line">2062</span><br><span class="line">2063</span><br><span class="line">2064</span><br><span class="line">2065</span><br><span class="line">2066</span><br><span class="line">2067</span><br><span class="line">2068</span><br><span class="line">2069</span><br><span class="line">2070</span><br><span class="line">2071</span><br><span class="line">2072</span><br><span class="line">2073</span><br><span class="line">2074</span><br><span class="line">2075</span><br><span class="line">2076</span><br><span class="line">2077</span><br><span class="line">2078</span><br><span class="line">2079</span><br><span class="line">2080</span><br><span class="line">2081</span><br><span class="line">2082</span><br><span class="line">2083</span><br><span class="line">2084</span><br><span class="line">2085</span><br><span class="line">2086</span><br><span class="line">2087</span><br><span class="line">2088</span><br><span class="line">2089</span><br><span class="line">2090</span><br><span class="line">2091</span><br><span class="line">2092</span><br><span class="line">2093</span><br><span class="line">2094</span><br><span class="line">2095</span><br><span class="line">2096</span><br><span class="line">2097</span><br><span class="line">2098</span><br><span class="line">2099</span><br><span class="line">2100</span><br><span class="line">2101</span><br><span class="line">2102</span><br><span class="line">2103</span><br><span class="line">2104</span><br><span class="line">2105</span><br><span class="line">2106</span><br><span class="line">2107</span><br><span class="line">2108</span><br><span class="line">2109</span><br><span class="line">2110</span><br><span class="line">2111</span><br><span class="line">2112</span><br><span class="line">2113</span><br><span class="line">2114</span><br><span class="line">2115</span><br><span class="line">2116</span><br><span class="line">2117</span><br><span class="line">2118</span><br><span class="line">2119</span><br><span class="line">2120</span><br><span class="line">2121</span><br><span class="line">2122</span><br><span class="line">2123</span><br><span class="line">2124</span><br><span class="line">2125</span><br><span class="line">2126</span><br><span class="line">2127</span><br><span class="line">2128</span><br><span class="line">2129</span><br><span class="line">2130</span><br><span class="line">2131</span><br><span class="line">2132</span><br><span class="line">2133</span><br><span class="line">2134</span><br><span class="line">2135</span><br><span class="line">2136</span><br><span class="line">2137</span><br><span class="line">2138</span><br><span class="line">2139</span><br><span class="line">2140</span><br><span class="line">2141</span><br><span class="line">2142</span><br><span class="line">2143</span><br><span class="line">2144</span><br><span class="line">2145</span><br><span class="line">2146</span><br><span class="line">2147</span><br><span class="line">2148</span><br><span class="line">2149</span><br><span class="line">2150</span><br><span class="line">2151</span><br><span class="line">2152</span><br><span class="line">2153</span><br><span class="line">2154</span><br><span class="line">2155</span><br><span class="line">2156</span><br><span class="line">2157</span><br><span class="line">2158</span><br><span class="line">2159</span><br><span class="line">2160</span><br><span class="line">2161</span><br><span class="line">2162</span><br><span class="line">2163</span><br><span class="line">2164</span><br><span class="line">2165</span><br><span class="line">2166</span><br><span class="line">2167</span><br><span class="line">2168</span><br><span class="line">2169</span><br><span class="line">2170</span><br><span class="line">2171</span><br><span class="line">2172</span><br><span class="line">2173</span><br><span class="line">2174</span><br><span class="line">2175</span><br><span class="line">2176</span><br><span class="line">2177</span><br><span class="line">2178</span><br><span class="line">2179</span><br><span class="line">2180</span><br><span class="line">2181</span><br><span class="line">2182</span><br><span class="line">2183</span><br><span class="line">2184</span><br><span class="line">2185</span><br><span class="line">2186</span><br><span class="line">2187</span><br><span class="line">2188</span><br><span class="line">2189</span><br><span class="line">2190</span><br><span class="line">2191</span><br><span class="line">2192</span><br><span class="line">2193</span><br><span class="line">2194</span><br><span class="line">2195</span><br><span class="line">2196</span><br><span class="line">2197</span><br><span class="line">2198</span><br><span class="line">2199</span><br><span class="line">2200</span><br><span class="line">2201</span><br><span class="line">2202</span><br><span class="line">2203</span><br><span class="line">2204</span><br><span class="line">2205</span><br><span class="line">2206</span><br><span class="line">2207</span><br><span class="line">2208</span><br><span class="line">2209</span><br><span class="line">2210</span><br><span class="line">2211</span><br><span class="line">2212</span><br><span class="line">2213</span><br><span class="line">2214</span><br><span class="line">2215</span><br><span class="line">2216</span><br><span class="line">2217</span><br><span class="line">2218</span><br><span class="line">2219</span><br><span class="line">2220</span><br><span class="line">2221</span><br><span class="line">2222</span><br><span class="line">2223</span><br><span class="line">2224</span><br><span class="line">2225</span><br><span class="line">2226</span><br><span class="line">2227</span><br><span class="line">2228</span><br><span class="line">2229</span><br><span class="line">2230</span><br><span class="line">2231</span><br><span class="line">2232</span><br><span class="line">2233</span><br><span class="line">2234</span><br><span class="line">2235</span><br><span class="line">2236</span><br><span class="line">2237</span><br><span class="line">2238</span><br><span class="line">2239</span><br><span class="line">2240</span><br><span class="line">2241</span><br><span class="line">2242</span><br><span class="line">2243</span><br><span class="line">2244</span><br><span class="line">2245</span><br><span class="line">2246</span><br><span class="line">2247</span><br><span class="line">2248</span><br><span class="line">2249</span><br><span class="line">2250</span><br><span class="line">2251</span><br><span class="line">2252</span><br><span class="line">2253</span><br><span class="line">2254</span><br><span class="line">2255</span><br><span class="line">2256</span><br><span class="line">2257</span><br><span class="line">2258</span><br><span class="line">2259</span><br><span class="line">2260</span><br><span class="line">2261</span><br><span class="line">2262</span><br><span class="line">2263</span><br><span class="line">2264</span><br><span class="line">2265</span><br><span class="line">2266</span><br><span class="line">2267</span><br><span class="line">2268</span><br><span class="line">2269</span><br><span class="line">2270</span><br><span class="line">2271</span><br><span class="line">2272</span><br><span class="line">2273</span><br><span class="line">2274</span><br><span class="line">2275</span><br><span class="line">2276</span><br><span class="line">2277</span><br><span class="line">2278</span><br><span class="line">2279</span><br><span class="line">2280</span><br><span class="line">2281</span><br><span class="line">2282</span><br><span class="line">2283</span><br><span class="line">2284</span><br><span class="line">2285</span><br><span class="line">2286</span><br><span class="line">2287</span><br><span class="line">2288</span><br><span class="line">2289</span><br><span class="line">2290</span><br><span class="line">2291</span><br><span class="line">2292</span><br><span class="line">2293</span><br><span class="line">2294</span><br><span class="line">2295</span><br><span class="line">2296</span><br><span class="line">2297</span><br><span class="line">2298</span><br><span class="line">2299</span><br><span class="line">2300</span><br><span class="line">2301</span><br><span class="line">2302</span><br><span class="line">2303</span><br><span class="line">2304</span><br><span class="line">2305</span><br><span class="line">2306</span><br><span class="line">2307</span><br><span class="line">2308</span><br><span class="line">2309</span><br><span class="line">2310</span><br><span class="line">2311</span><br><span class="line">2312</span><br><span class="line">2313</span><br><span class="line">2314</span><br><span class="line">2315</span><br><span class="line">2316</span><br><span class="line">2317</span><br><span class="line">2318</span><br><span class="line">2319</span><br><span class="line">2320</span><br><span class="line">2321</span><br><span class="line">2322</span><br><span class="line">2323</span><br><span class="line">2324</span><br><span class="line">2325</span><br><span class="line">2326</span><br><span class="line">2327</span><br><span class="line">2328</span><br><span class="line">2329</span><br><span class="line">2330</span><br><span class="line">2331</span><br><span class="line">2332</span><br><span class="line">2333</span><br><span class="line">2334</span><br><span class="line">2335</span><br><span class="line">2336</span><br><span class="line">2337</span><br><span class="line">2338</span><br><span class="line">2339</span><br><span class="line">2340</span><br><span class="line">2341</span><br><span class="line">2342</span><br><span class="line">2343</span><br><span class="line">2344</span><br><span class="line">2345</span><br><span class="line">2346</span><br><span class="line">2347</span><br><span class="line">2348</span><br><span class="line">2349</span><br><span class="line">2350</span><br><span class="line">2351</span><br><span class="line">2352</span><br><span class="line">2353</span><br><span class="line">2354</span><br><span class="line">2355</span><br><span class="line">2356</span><br><span class="line">2357</span><br><span class="line">2358</span><br><span class="line">2359</span><br><span class="line">2360</span><br><span class="line">2361</span><br><span class="line">2362</span><br><span class="line">2363</span><br><span class="line">2364</span><br><span class="line">2365</span><br><span class="line">2366</span><br><span class="line">2367</span><br><span class="line">2368</span><br><span class="line">2369</span><br><span class="line">2370</span><br><span class="line">2371</span><br><span class="line">2372</span><br><span class="line">2373</span><br><span class="line">2374</span><br><span class="line">2375</span><br><span class="line">2376</span><br><span class="line">2377</span><br><span class="line">2378</span><br><span class="line">2379</span><br><span class="line">2380</span><br><span class="line">2381</span><br><span class="line">2382</span><br><span class="line">2383</span><br><span class="line">2384</span><br><span class="line">2385</span><br><span class="line">2386</span><br><span class="line">2387</span><br><span class="line">2388</span><br><span class="line">2389</span><br><span class="line">2390</span><br><span class="line">2391</span><br><span class="line">2392</span><br><span class="line">2393</span><br><span class="line">2394</span><br><span class="line">2395</span><br><span class="line">2396</span><br><span class="line">2397</span><br><span class="line">2398</span><br><span class="line">2399</span><br><span class="line">2400</span><br><span class="line">2401</span><br><span class="line">2402</span><br><span class="line">2403</span><br><span class="line">2404</span><br><span class="line">2405</span><br><span class="line">2406</span><br><span class="line">2407</span><br><span class="line">2408</span><br><span class="line">2409</span><br><span class="line">2410</span><br><span class="line">2411</span><br><span class="line">2412</span><br><span class="line">2413</span><br><span class="line">2414</span><br><span class="line">2415</span><br><span class="line">2416</span><br><span class="line">2417</span><br><span class="line">2418</span><br><span class="line">2419</span><br><span class="line">2420</span><br><span class="line">2421</span><br><span class="line">2422</span><br><span class="line">2423</span><br><span class="line">2424</span><br><span class="line">2425</span><br><span class="line">2426</span><br><span class="line">2427</span><br><span class="line">2428</span><br><span class="line">2429</span><br><span class="line">2430</span><br><span class="line">2431</span><br><span class="line">2432</span><br><span class="line">2433</span><br><span class="line">2434</span><br><span class="line">2435</span><br><span class="line">2436</span><br><span class="line">2437</span><br><span class="line">2438</span><br><span class="line">2439</span><br><span class="line">2440</span><br><span class="line">2441</span><br><span class="line">2442</span><br><span class="line">2443</span><br><span class="line">2444</span><br><span class="line">2445</span><br><span class="line">2446</span><br><span class="line">2447</span><br><span class="line">2448</span><br><span class="line">2449</span><br><span class="line">2450</span><br><span class="line">2451</span><br><span class="line">2452</span><br><span class="line">2453</span><br><span class="line">2454</span><br><span class="line">2455</span><br><span class="line">2456</span><br><span class="line">2457</span><br><span class="line">2458</span><br><span class="line">2459</span><br><span class="line">2460</span><br><span class="line">2461</span><br><span class="line">2462</span><br><span class="line">2463</span><br><span class="line">2464</span><br><span class="line">2465</span><br><span class="line">2466</span><br><span class="line">2467</span><br><span class="line">2468</span><br><span class="line">2469</span><br><span class="line">2470</span><br><span class="line">2471</span><br><span class="line">2472</span><br><span class="line">2473</span><br><span class="line">2474</span><br><span class="line">2475</span><br><span class="line">2476</span><br><span class="line">2477</span><br><span class="line">2478</span><br><span class="line">2479</span><br><span class="line">2480</span><br><span class="line">2481</span><br><span class="line">2482</span><br><span class="line">2483</span><br><span class="line">2484</span><br><span class="line">2485</span><br><span class="line">2486</span><br><span class="line">2487</span><br><span class="line">2488</span><br><span class="line">2489</span><br><span class="line">2490</span><br><span class="line">2491</span><br><span class="line">2492</span><br><span class="line">2493</span><br><span class="line">2494</span><br><span class="line">2495</span><br><span class="line">2496</span><br><span class="line">2497</span><br><span class="line">2498</span><br><span class="line">2499</span><br><span class="line">2500</span><br><span class="line">2501</span><br><span class="line">2502</span><br><span class="line">2503</span><br><span class="line">2504</span><br><span class="line">2505</span><br><span class="line">2506</span><br><span class="line">2507</span><br><span class="line">2508</span><br><span class="line">2509</span><br><span class="line">2510</span><br><span class="line">2511</span><br><span class="line">2512</span><br><span class="line">2513</span><br><span class="line">2514</span><br><span class="line">2515</span><br><span class="line">2516</span><br><span class="line">2517</span><br><span class="line">2518</span><br><span class="line">2519</span><br><span class="line">2520</span><br><span class="line">2521</span><br><span class="line">2522</span><br><span class="line">2523</span><br><span class="line">2524</span><br><span class="line">2525</span><br><span class="line">2526</span><br><span class="line">2527</span><br><span class="line">2528</span><br><span class="line">2529</span><br><span class="line">2530</span><br><span class="line">2531</span><br><span class="line">2532</span><br><span class="line">2533</span><br><span class="line">2534</span><br><span class="line">2535</span><br><span class="line">2536</span><br><span class="line">2537</span><br><span class="line">2538</span><br><span class="line">2539</span><br><span class="line">2540</span><br><span class="line">2541</span><br><span class="line">2542</span><br><span class="line">2543</span><br><span class="line">2544</span><br><span class="line">2545</span><br><span class="line">2546</span><br><span class="line">2547</span><br><span class="line">2548</span><br><span class="line">2549</span><br><span class="line">2550</span><br><span class="line">2551</span><br><span class="line">2552</span><br><span class="line">2553</span><br><span class="line">2554</span><br><span class="line">2555</span><br><span class="line">2556</span><br><span class="line">2557</span><br><span class="line">2558</span><br><span class="line">2559</span><br><span class="line">2560</span><br><span class="line">2561</span><br><span class="line">2562</span><br><span class="line">2563</span><br><span class="line">2564</span><br><span class="line">2565</span><br><span class="line">2566</span><br><span class="line">2567</span><br><span class="line">2568</span><br><span class="line">2569</span><br><span class="line">2570</span><br><span class="line">2571</span><br><span class="line">2572</span><br><span class="line">2573</span><br><span class="line">2574</span><br><span class="line">2575</span><br><span class="line">2576</span><br><span class="line">2577</span><br><span class="line">2578</span><br><span class="line">2579</span><br><span class="line">2580</span><br><span class="line">2581</span><br><span class="line">2582</span><br><span class="line">2583</span><br><span class="line">2584</span><br><span class="line">2585</span><br><span class="line">2586</span><br><span class="line">2587</span><br><span class="line">2588</span><br><span class="line">2589</span><br><span class="line">2590</span><br><span class="line">2591</span><br><span class="line">2592</span><br><span class="line">2593</span><br><span class="line">2594</span><br><span class="line">2595</span><br><span class="line">2596</span><br><span class="line">2597</span><br><span class="line">2598</span><br><span class="line">2599</span><br><span class="line">2600</span><br><span class="line">2601</span><br><span class="line">2602</span><br><span class="line">2603</span><br><span class="line">2604</span><br><span class="line">2605</span><br><span class="line">2606</span><br><span class="line">2607</span><br><span class="line">2608</span><br><span class="line">2609</span><br><span class="line">2610</span><br><span class="line">2611</span><br><span class="line">2612</span><br><span class="line">2613</span><br><span class="line">2614</span><br><span class="line">2615</span><br><span class="line">2616</span><br><span class="line">2617</span><br><span class="line">2618</span><br><span class="line">2619</span><br><span class="line">2620</span><br><span class="line">2621</span><br><span class="line">2622</span><br><span class="line">2623</span><br><span class="line">2624</span><br><span class="line">2625</span><br><span class="line">2626</span><br><span class="line">2627</span><br><span class="line">2628</span><br><span class="line">2629</span><br><span class="line">2630</span><br><span class="line">2631</span><br><span class="line">2632</span><br><span class="line">2633</span><br><span class="line">2634</span><br><span class="line">2635</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">   - 期望值和实际值相同表示测试通过，期望值和实际值不同则单元测试执行时会报错。</span><br><span class="line">   </span><br><span class="line">- 这里引入JUnit是为了代替main方法。</span><br><span class="line"></span><br><span class="line">- 使用JUnit步骤：</span><br><span class="line">   - 第一步：引入依赖</span><br><span class="line">```xml</span><br><span class="line">&lt;!-- junit依赖 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.13.2&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">   - 第二步：编写单元测试类【测试用例】，测试用例中每一个测试方法上使用@Test注解进行标注。</span><br><span class="line">      - 测试用例的名字以及每个测试方法的定义都是有规范的：</span><br><span class="line">         - 测试用例的名字：XxxTest</span><br><span class="line">         - 测试方法声明格式：public void test业务方法名()&#123;&#125;</span><br><span class="line">```java</span><br><span class="line">// 测试用例</span><br><span class="line">public class CarMapperTest&#123;</span><br><span class="line">    </span><br><span class="line">    // 测试方法</span><br><span class="line">    @Test</span><br><span class="line">    public void testInsertCar()&#123;&#125;//注意起名规范</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testUpdate()&#123;&#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">   - 第三步：可以在类上执行，也可以在方法上执行</span><br><span class="line">      - 在类上执行时，该类中所有的测试方法都会执行。</span><br><span class="line">      - 在方法上执行时，只执行当前的测试方法。</span><br><span class="line">- 编写一个测试用例，来测试insertCar业务</span><br><span class="line">```java</span><br><span class="line">public class CarMapperTest &#123;</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testInsertCar()&#123;</span><br><span class="line">        SqlSession sqlSession = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            // 1.创建SqlSessionFactoryBuilder对象</span><br><span class="line">            SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">            // 2.创建SqlSessionFactory对象</span><br><span class="line">            SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;));</span><br><span class="line">            // 3.创建SqlSession对象</span><br><span class="line">            sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">            // 4.执行SQL</span><br><span class="line">            int count = sqlSession.insert(&quot;insertCar&quot;);</span><br><span class="line">            System.out.println(&quot;更新了几条记录：&quot; + count);</span><br><span class="line">            // 5.提交</span><br><span class="line">            sqlSession.commit();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            // 回滚</span><br><span class="line">            if (sqlSession != null) &#123;</span><br><span class="line">                sqlSession.rollback();</span><br><span class="line">            &#125;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            // 6.关闭</span><br><span class="line">            if (sqlSession != null) &#123;</span><br><span class="line">                sqlSession.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">执行单元测试，查看数据库表的变化：</span><br><span class="line">![AEE76A27-5761-4162-B9DB-CCE0814EC06C.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659604159905-5853a1c1-b266-4a74-8f25-8b7a326d84d6.png#averageHue=%23f3f1ee&amp;clientId=u6b7aa99c-2be4-4&amp;from=paste&amp;height=224&amp;id=ue1281902&amp;originHeight=224&amp;originWidth=562&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=15023&amp;status=done&amp;style=none&amp;taskId=u8a987f16-e633-4fe7-a462-68ec6db2bb0&amp;title=&amp;width=562)</span><br><span class="line">## 2.7 引入日志框架logback</span><br><span class="line"></span><br><span class="line">- 引入日志框架的目的是为了看清楚mybatis执行的具体sql。</span><br><span class="line">- 启用标准日志组件，只需要在mybatis-config.xml文件中添加以下配置：【可参考mybatis手册】</span><br><span class="line">```xml</span><br><span class="line">&lt;settings&gt;</span><br><span class="line">  &lt;setting name=&quot;logImpl&quot; value=&quot;STDOUT_LOGGING&quot; /&gt;</span><br><span class="line">&lt;/settings&gt;</span><br><span class="line">```</span><br><span class="line">标准日志也可以用，但是配置不够灵活，可以集成其他的日志组件，例如：SLF4J（沙拉风）：沙拉风是一个日志标准，其中有一个框架叫做logback，它实现了沙拉风规范。，log4j，log4j2，logback等。</span><br><span class="line"></span><br><span class="line">- logback是目前日志框架中性能较好的，较流行的，所以我们选它。log4j log4j2 logback都是同一个作者开发的。</span><br><span class="line">- STDOUT_LOGGING是标准日志，mybatis已经实现了这种标准日志。mybatis框架本身已经实现了这种标准。开启方法就是上面的配置，这个标签在编写的时候要注意，它应该出现在environments标签之前。不需要记忆这个顺序，因为有dtd文件进行约束。</span><br><span class="line">- 引入logback的步骤：</span><br><span class="line">   - 第一步：引入logback相关依赖</span><br><span class="line">```xml</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.2.11&lt;/version&gt;</span><br><span class="line">  &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">   - 第二步：引入logback相关配置文件（文件名叫做logback.xml或logback-test.xml，必须放到类路径当中），这个主要配置日志输出相关的级别以及日志具体的格式。里面的输出格式都是可以更改的</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration debug=&quot;false&quot;&gt;</span><br><span class="line">    &lt;!-- 控制台输出 --&gt;</span><br><span class="line">    &lt;appender name=&quot;STDOUT&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">        &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt;</span><br><span class="line">            &lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符--&gt;</span><br><span class="line">            &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&lt;/pattern&gt;</span><br><span class="line">        &lt;/encoder&gt;</span><br><span class="line">    &lt;/appender&gt;</span><br><span class="line">    &lt;!-- 按照每天生成日志文件 --&gt;</span><br><span class="line">    &lt;appender name=&quot;FILE&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;</span><br><span class="line">        &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">            &lt;!--日志文件输出的文件名--&gt;</span><br><span class="line">            &lt;FileNamePattern&gt;$&#123;LOG_HOME&#125;/TestWeb.log.%d&#123;yyyy-MM-dd&#125;.log&lt;/FileNamePattern&gt;</span><br><span class="line">            &lt;!--日志文件保留天数--&gt;</span><br><span class="line">            &lt;MaxHistory&gt;30&lt;/MaxHistory&gt;</span><br><span class="line">        &lt;/rollingPolicy&gt;</span><br><span class="line">        &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt;</span><br><span class="line">            &lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符--&gt;</span><br><span class="line">            &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&lt;/pattern&gt;</span><br><span class="line">        &lt;/encoder&gt;</span><br><span class="line">        &lt;!--日志文件最大的大小--&gt;</span><br><span class="line">        &lt;triggeringPolicy class=&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt;</span><br><span class="line">            &lt;MaxFileSize&gt;100MB&lt;/MaxFileSize&gt;</span><br><span class="line">        &lt;/triggeringPolicy&gt;</span><br><span class="line">    &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--mybatis log configure--&gt;</span><br><span class="line">    &lt;logger name=&quot;com.apache.ibatis&quot; level=&quot;TRACE&quot;/&gt;</span><br><span class="line">    &lt;logger name=&quot;java.sql.Connection&quot; level=&quot;DEBUG&quot;/&gt;</span><br><span class="line">    &lt;logger name=&quot;java.sql.Statement&quot; level=&quot;DEBUG&quot;/&gt;</span><br><span class="line">    &lt;logger name=&quot;java.sql.PreparedStatement&quot; level=&quot;DEBUG&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 日志输出级别,logback日志级别包括五个：TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR --&gt;</span><br><span class="line">    &lt;root level=&quot;DEBUG&quot;&gt;</span><br><span class="line">        &lt;appender-ref ref=&quot;STDOUT&quot;/&gt;</span><br><span class="line">        &lt;appender-ref ref=&quot;FILE&quot;/&gt;</span><br><span class="line">    &lt;/root&gt;</span><br><span class="line"></span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- 再次执行单元测试方法testInsertCar，查看控制台是否有sql语句输出</span><br><span class="line">   - ![E75C0BCA-F8D3-44f8-AABB-282510093C8C.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659610464472-e3b9e8b9-d29b-4f9b-ad34-dab427fe3a45.png#averageHue=%2334312f&amp;clientId=u6b7aa99c-2be4-4&amp;from=paste&amp;height=528&amp;id=uce9a4d58&amp;originHeight=528&amp;originWidth=1644&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=113799&amp;status=done&amp;style=none&amp;taskId=ub0b377eb-9933-4c71-a4e7-2d75cda3771&amp;title=&amp;width=1644)</span><br><span class="line">## 2.8 MyBatis工具类SqlSessionUtil的封装</span><br><span class="line"></span><br><span class="line">- 每一次获取SqlSession对象代码太繁琐，封装一个工具类</span><br><span class="line">```java</span><br><span class="line">/**</span><br><span class="line"> * MyBatis工具类</span><br><span class="line"> *</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class SqlSessionUtil &#123;</span><br><span class="line">    private static SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 类加载时初始化sqlSessionFactory对象</span><br><span class="line">     * SqlsessionUtil工具类在进行第一次加载的时候，解析mybatis-config.xml文件</span><br><span class="line">     */</span><br><span class="line">    static &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">            sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;));</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 每调用一次openSession()可获取一个新的会话，该会话支持自动提交。</span><br><span class="line">     *</span><br><span class="line">     * @return 新的会话对象</span><br><span class="line">     */</span><br><span class="line">    public static SqlSession openSession() &#123;</span><br><span class="line">        return sqlSessionFactory.openSession(true);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- 测试工具类，将testInsertCar()改造</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testInsertCar()&#123;</span><br><span class="line">    SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">    // 执行SQL</span><br><span class="line">    int count = sqlSession.insert(&quot;insertCar&quot;);</span><br><span class="line">    System.out.println(&quot;插入了几条记录:&quot; + count);</span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">![](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#averageHue=%23dad8d7&amp;from=url&amp;id=vyMyT&amp;originHeight=152&amp;originWidth=1180&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=)</span><br><span class="line"># 三、使用MyBatis完成CRUD</span><br><span class="line"></span><br><span class="line">- 准备工作</span><br><span class="line">   - 创建module（Maven的普通Java模块）：mybatis-002-crud</span><br><span class="line">   - pom.xml</span><br><span class="line">      - 打包方式jar</span><br><span class="line">      - 依赖：</span><br><span class="line">         - mybatis依赖</span><br><span class="line">         - mysql驱动依赖</span><br><span class="line">         - junit依赖</span><br><span class="line">         - logback依赖</span><br><span class="line">   - mybatis-config.xml放在类的根路径下</span><br><span class="line">   - CarMapper.xml放在类的根路径下</span><br><span class="line">   - logback.xml放在类的根路径下</span><br><span class="line">   - 提供com.powernode.mybatis.utils.SqlSessionUtil工具类</span><br><span class="line">   - 创建测试用例：com.powernode.mybatis.CarMapperTest</span><br><span class="line">## 3.1 insert（Create）</span><br><span class="line">分析以下SQL映射文件中SQL语句存在的问题</span><br><span class="line">```xml</span><br><span class="line">&lt;!--namespace先随便写--&gt;</span><br><span class="line">&lt;mapper namespace=&quot;car&quot;&gt;</span><br><span class="line">    &lt;insert id=&quot;insertCar&quot;&gt;</span><br><span class="line">        insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(&#x27;103&#x27;, &#x27;奔驰E300L&#x27;, 50.3, &#x27;2022-01-01&#x27;, &#x27;燃油车&#x27;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">存在的问题是：SQL语句中的值不应该写死，值应该是用户提供的。之前的JDBC代码是这样写的：</span><br><span class="line">```java</span><br><span class="line">// JDBC中使用 ? 作为占位符。那么MyBatis中会使用什么作为占位符呢？</span><br><span class="line">String sql = &quot;insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(?,?,?,?,?)&quot;;</span><br><span class="line">// 给 ? 传值。那么MyBatis中应该怎么传值呢？</span><br><span class="line">ps.setString(1,&quot;103&quot;);</span><br><span class="line">ps.setString(2,&quot;奔驰E300L&quot;);</span><br><span class="line">```</span><br><span class="line">在MyBatis中可以这样做：</span><br><span class="line">**在Java程序中，将数据放到Map集合中**</span><br><span class="line">**在sql语句中使用 #&#123;map集合的key&#125; 来完成传值，#&#123;&#125; 等同于JDBC中的 ? ，#&#123;&#125;就是占位符**</span><br><span class="line">Java程序这样写：</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">/**</span><br><span class="line"> * 测试MyBatis的CRUD</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class CarMapperTest &#123;</span><br><span class="line">    @Test</span><br><span class="line">    public void testInsertCar()&#123;</span><br><span class="line">        // 前端传过来数据了。</span><br><span class="line">		//这个对象我们先使用Map集合进行数据的封装</span><br><span class="line">        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">        map.put(&quot;k1&quot;, &quot;103&quot;);</span><br><span class="line">        map.put(&quot;k2&quot;, &quot;奔驰E300L&quot;);</span><br><span class="line">        // 获取SqlSession对象</span><br><span class="line">        SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">        // 执行SQL语句（使用map集合给sql语句传递数据）</span><br><span class="line">        //第一个参数:sqlId，从CarMapper.xml文件中复制:</span><br><span class="line">		//第二个参数:封装数据的对象</span><br><span class="line">        int count = sqlSession.insert(&quot;insertCar&quot;, map);</span><br><span class="line">        System.out.println(&quot;插入了几条记录：&quot; + count);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">		sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">SQL语句这样写：</span><br><span class="line">```xml</span><br><span class="line">&lt;!--namespace先随便写--&gt;</span><br><span class="line">&lt;mapper namespace=&quot;car&quot;&gt;</span><br><span class="line">    &lt;insert id=&quot;insertCar&quot;&gt;</span><br><span class="line">        insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;k1&#125;,#&#123;k2&#125;,#&#123;k3&#125;,#&#123;k4&#125;,#&#123;k5&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">**#&#123;&#125; 的里面必须填写map集合的key，不能随便写。**运行测试程序，查看数据库：</span><br><span class="line">![2DD856C0-9725-4073-98C4-129D86B03B35.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659666309110-2c00ecfe-1777-4c9a-8baa-1bc4e4ab47a0.png#averageHue=%23deb069&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=179&amp;id=u94fe22b6&amp;originHeight=179&amp;originWidth=560&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=11045&amp;status=done&amp;style=none&amp;taskId=ubd9e1519-05eb-4464-9180-0c279df37e0&amp;title=&amp;width=560)</span><br><span class="line">如果#&#123;&#125;里写的是map集合中不存在的key会有什么问题？</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;mapper namespace=&quot;car&quot;&gt;</span><br><span class="line">    &lt;insert id=&quot;insertCar&quot;&gt;</span><br><span class="line">        insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;kk&#125;,#&#123;k2&#125;,#&#123;k3&#125;,#&#123;k4&#125;,#&#123;k5&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">运行程序：</span><br><span class="line">![13079E0B-F436-4100-B4E1-BB5C3A58ADD9.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659666601236-f892944d-8725-4816-b34c-621a9380eda8.png#averageHue=%2332302f&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=344&amp;id=u2059ad06&amp;originHeight=344&amp;originWidth=1560&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=65973&amp;status=done&amp;style=none&amp;taskId=u6bdf7288-ce4c-4b43-8426-e6dca594b05&amp;title=&amp;width=1560)</span><br><span class="line">![0E5B4E84-C76C-4724-87E5-D37C954D2C40.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659666614107-2df4bd58-105b-4b76-881d-e1d19b4d4b98.png#averageHue=%23ddaf67&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=191&amp;id=uc44a11b1&amp;originHeight=191&amp;originWidth=537&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=11172&amp;status=done&amp;style=none&amp;taskId=ua820004b-0e4a-43c7-bc42-fec65f1a4a2&amp;title=&amp;width=537)</span><br><span class="line">通过测试，看到程序并没有报错。正常执行。不过 #&#123;kk&#125; 的写法导致无法获取到map集合中的数据，最终导致数据库表car_num插入了NULL。</span><br><span class="line">在以上sql语句中，可以看到#&#123;k1&#125; #&#123;k2&#125; #&#123;k3&#125; #&#123;k4&#125; #&#123;k5&#125;的可读性太差，为了增强可读性，我们可以将Java程序做如下修改：</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">// 让key的可读性增强</span><br><span class="line">map.put(&quot;carNum&quot;, &quot;103&quot;);</span><br><span class="line">map.put(&quot;brand&quot;, &quot;奔驰E300L&quot;);</span><br><span class="line">map.put(&quot;guidePrice&quot;, 50.3);</span><br><span class="line">map.put(&quot;produceTime&quot;, &quot;2020-10-01&quot;);</span><br><span class="line">map.put(&quot;carType&quot;, &quot;燃油车&quot;);</span><br><span class="line">```</span><br><span class="line">SQL语句做如下修改，这样可以增强程序的可读性：</span><br><span class="line">```xml</span><br><span class="line">&lt;mapper namespace=&quot;car&quot;&gt;</span><br><span class="line">    &lt;insert id=&quot;insertCar&quot;&gt;</span><br><span class="line">        insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">运行程序，查看数据库表：</span><br><span class="line">![B84BC4D9-24C1-4310-A5D1-DFC407BBFA8C.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659667098369-a13a16ec-6f02-44f2-85b7-8834b9ca161b.png#averageHue=%23ddaf6b&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=161&amp;id=u51a730e6&amp;originHeight=161&amp;originWidth=577&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=9427&amp;status=done&amp;style=none&amp;taskId=ud2e4da5f-1985-4267-8282-e2bafa5fff3&amp;title=&amp;width=577)</span><br><span class="line">使用Map集合可以传参，那使用**pojo**（简单普通的java对象）可以完成传参吗？测试一下：</span><br><span class="line"></span><br><span class="line">- 第一步：定义一个pojo类Car，提供相关属性。</span><br><span class="line">```java</span><br><span class="line">package com.powernode.mybatis.pojo;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * POJOs，简单普通的Java对象。封装数据用的。</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class Car &#123;</span><br><span class="line">    //数据库表当中的字段应该和pojo类的属性一一对应:</span><br><span class="line">    //建议使用包装类，这样可以防止null的问题</span><br><span class="line">    private Long id;</span><br><span class="line">    private String carNum;</span><br><span class="line">    private String brand;</span><br><span class="line">    private Double guidePrice;</span><br><span class="line">    private String produceTime;</span><br><span class="line">    private String carType;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Car&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, carNum=&#x27;&quot; + carNum + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, brand=&#x27;&quot; + brand + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, guidePrice=&quot; + guidePrice +</span><br><span class="line">                &quot;, produceTime=&#x27;&quot; + produceTime + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, carType=&#x27;&quot; + carType + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Car() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Car(Long id, String carNum, String brand, Double guidePrice, String produceTime, String carType) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.carNum = carNum;</span><br><span class="line">        this.brand = brand;</span><br><span class="line">        this.guidePrice = guidePrice;</span><br><span class="line">        this.produceTime = produceTime;</span><br><span class="line">        this.carType = carType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(Long id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCarNum() &#123;</span><br><span class="line">        return carNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCarNum(String carNum) &#123;</span><br><span class="line">        this.carNum = carNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBrand() &#123;</span><br><span class="line">        return brand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBrand(String brand) &#123;</span><br><span class="line">        this.brand = brand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Double getGuidePrice() &#123;</span><br><span class="line">        return guidePrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setGuidePrice(Double guidePrice) &#123;</span><br><span class="line">        this.guidePrice = guidePrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getProduceTime() &#123;</span><br><span class="line">        return produceTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setProduceTime(String produceTime) &#123;</span><br><span class="line">        this.produceTime = produceTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCarType() &#123;</span><br><span class="line">        return carType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCarType(String carType) &#123;</span><br><span class="line">        this.carType = carType;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- 第二步：Java程序</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testInsertCarByPOJO()&#123;</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">    // 创建POJO，封装数据</span><br><span class="line">    Car car = new Car(null,&quot;3333&quot;,&quot;奔驰C200&quot;,30.0,&quot;2020-10-11&quot;,&quot;燃油车&quot;);</span><br><span class="line">    // 执行SQL，传数据</span><br><span class="line">    int count = sqlSession.insert(&quot;insertCarByPOJO&quot;, car);</span><br><span class="line">    System.out.println(&quot;插入了几条记录&quot; + count);</span><br><span class="line">    sqlSession.commit();</span><br><span class="line">	sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- 第三步：SQL语句</span><br><span class="line">```xml</span><br><span class="line">&lt;insert id=&quot;insertCarByPOJO&quot;&gt;</span><br><span class="line">  &lt;!--#&#123;&#125; 里写的是POJO的属性名--&gt;</span><br><span class="line">  insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- 运行程序，查看数据库表：</span><br><span class="line"></span><br><span class="line">![9C093F8D-3868-435d-AA67-91B779ADF7BE.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659668224378-2070e0f4-8252-4978-8204-bb247d172152.png#averageHue=%23ddaf69&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=192&amp;id=ue5a6a89a&amp;originHeight=192&amp;originWidth=573&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=12105&amp;status=done&amp;style=none&amp;taskId=udee3b33a-2b0f-445d-9657-6fcf1cbcbe5&amp;title=&amp;width=573)</span><br><span class="line">#&#123;&#125; 里写的是POJO的属性名，如果写成其他的会有问题吗？</span><br><span class="line">```xml</span><br><span class="line">&lt;insert id=&quot;insertCarByPOJO&quot;&gt;</span><br><span class="line">  insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;a&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br><span class="line">```</span><br><span class="line">运行程序，出现了以下异常：</span><br><span class="line">![BDD7D72C-B8AD-46b0-9006-9671AE65B305.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659668583320-e0b198ac-df57-47f9-8520-7bb86f4b56fe.png#averageHue=%23342e2d&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=347&amp;id=u5ee0aa99&amp;originHeight=347&amp;originWidth=1548&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=55921&amp;status=done&amp;style=none&amp;taskId=uf68ed3c1-a281-4fd0-b8d3-cab66b4db7e&amp;title=&amp;width=1548)</span><br><span class="line">错误信息中描述：在Car类中没有找到a属性的getter方法。</span><br><span class="line">修改POJO类Car的代码，**只将getCarNum()方法名修改为getA()，其他代码不变**，如下：</span><br><span class="line">![2BD31517-18A1-40b0-ABB2-066E930366AE.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659668831506-d7700b47-d87a-417b-bd86-46467edd968c.png#averageHue=%23332b2a&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=270&amp;id=u9e1f92be&amp;originHeight=270&amp;originWidth=459&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=14207&amp;status=done&amp;style=none&amp;taskId=u9a87b35c-6f32-4245-bc84-8ea61e49ea8&amp;title=&amp;width=459)</span><br><span class="line">再运行程序，查看数据库表中数据：</span><br><span class="line">![17908172-C596-4d31-B3B8-09B6DDDD5C82.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659668909618-59bddd05-fcfa-41cc-8c87-a7bcd7060c2f.png#averageHue=%23f7f5f3&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=148&amp;id=ud345a029&amp;originHeight=148&amp;originWidth=531&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=9058&amp;status=done&amp;style=none&amp;taskId=u40d048ac-be67-4773-a75d-a81be15ea72&amp;title=&amp;width=531)</span><br><span class="line">**经过测试得出结论：**</span><br><span class="line">**如果采用map集合传参，#&#123;&#125; 里写的是map集合的key，如果key不存在不会报错，数据库表中会插入NULL。**</span><br><span class="line">**如果采用POJO传参，#&#123;&#125; 里写的是get方法的方法名去掉get之后将剩下的单词首字母变小写（例如：getAge()对应的是#&#123;age&#125;，getUserName()对应的是#&#123;userName&#125;)，如果这样的get方法不存在会报错。**</span><br><span class="line"></span><br><span class="line">也就是说mybatis在底层给?传值的时候，先要获取值，怎么获取的？ 调用了pojo对象的get方法。例如：car.getCarNum()，car.getCarType()，car.getBrand()</span><br><span class="line"></span><br><span class="line">注意：其实传参数的时候有一个属性parameterType，这个属性用来指定传参的数据类型，不过这个属性是可以省略的</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;insert id=&quot;insertCar&quot; parameterType=&quot;java.util.Map&quot;&gt;</span><br><span class="line">  insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">&lt;insert id=&quot;insertCarByPOJO&quot; parameterType=&quot;com.powernode.mybatis.pojo.Car&quot;&gt;</span><br><span class="line">  insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br><span class="line">```</span><br><span class="line">## 3.2 delete（Delete）</span><br><span class="line">需求：根据car_num进行删除。</span><br><span class="line">SQL语句这样写：</span><br><span class="line">```xml</span><br><span class="line">&lt;delete id=&quot;deleteByCarNum&quot;&gt;</span><br><span class="line">  delete from t_car where car_num = #&#123;SuiBianXie&#125;</span><br><span class="line">&lt;/delete&gt;</span><br><span class="line">```</span><br><span class="line">Java程序这样写：</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testDeleteByCarNum()&#123;</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">    // 执行SQL语句</span><br><span class="line">    int count = sqlSession.delete(&quot;deleteByCarNum&quot;, &quot;102&quot;);</span><br><span class="line">    System.out.println(&quot;删除了几条记录：&quot; + count);</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">运行结果：</span><br><span class="line">![2ECBA22E-ABC9-4dc1-87AD-F4842083A2CD.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659671944122-784bbd93-06dc-4faf-a18a-6beef6cf15b5.png#averageHue=%23332f2e&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=228&amp;id=u9ba38c62&amp;originHeight=228&amp;originWidth=1287&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=44537&amp;status=done&amp;style=none&amp;taskId=uc25ecbf1-cea2-4719-9fba-2b8954b1650&amp;title=&amp;width=1287)</span><br><span class="line">**注意：当占位符只有一个的时候，$&#123;&#125; 里面的内容可以随便写。但最好见名知意**</span><br><span class="line"></span><br><span class="line">## 3.3 update（Update）</span><br><span class="line">需求：修改id=34的Car信息，car_num为102，brand为比亚迪汉，guide_price为30.23，produce_time为2018-09-10，car_type为电车</span><br><span class="line">修改前：</span><br><span class="line">![25135D96-3CD7-43f9-9E0F-7C90BCEDF28E.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659680723161-c7563b14-b4f7-4467-90b5-4dfca148ca83.png#averageHue=%23d7a964&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=238&amp;id=u63346d62&amp;originHeight=238&amp;originWidth=599&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=15600&amp;status=done&amp;style=none&amp;taskId=ubd0db29a-16d4-4ec2-8990-3c666f90de5&amp;title=&amp;width=599)</span><br><span class="line">SQL语句如下：</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;update id=&quot;updateCarByPOJO&quot;&gt;</span><br><span class="line">  update t_car set </span><br><span class="line">    car_num = #&#123;carNum&#125;, brand = #&#123;brand&#125;, </span><br><span class="line">    guide_price = #&#123;guidePrice&#125;, produce_time = #&#123;produceTime&#125;, </span><br><span class="line">    car_type = #&#123;carType&#125; </span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line">&lt;/update&gt;</span><br><span class="line">```</span><br><span class="line">Java代码如下：</span><br><span class="line">```java</span><br><span class="line">    @Test</span><br><span class="line">    public void testUpdateCarByPOJO()&#123;</span><br><span class="line">        // 准备数据</span><br><span class="line">        Car car = new Car(34L, &quot;102&quot;, &quot;比亚迪汉&quot;, 30.23, &quot;2018-09-10&quot;, &quot;电车&quot;);</span><br><span class="line">        // 获取SqlSession对象</span><br><span class="line">        SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">        // 执行SQL语句</span><br><span class="line">        int count = sqlSession.update(&quot;updateCarByPOJO&quot;, car);</span><br><span class="line">        System.out.println(&quot;更新了几条记录：&quot; + count);</span><br><span class="line">    &#125;</span><br><span class="line">```</span><br><span class="line">运行结果：</span><br><span class="line">![0670B92C-E654-49a7-839C-814850A4D79A.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659681449799-48b44db3-d006-452c-8bd8-d088850c4394.png#averageHue=%23302f2e&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=181&amp;id=ub8471fdb&amp;originHeight=181&amp;originWidth=1638&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=37090&amp;status=done&amp;style=none&amp;taskId=ua2b34e73-5ff6-4e81-b735-8bad85748c1&amp;title=&amp;width=1638)</span><br><span class="line">![7EC1586E-DB9E-47ca-A556-B8822A8F7429.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659681391738-02de5e94-8880-4754-b08a-0e807362ba3c.png#averageHue=%23d7ac67&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=192&amp;id=uc8685bbd&amp;originHeight=192&amp;originWidth=545&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=11408&amp;status=done&amp;style=none&amp;taskId=ud923fb36-c275-4a94-af10-522a44df96f&amp;title=&amp;width=545)</span><br><span class="line">当然了，如果使用**map**传数据也是可以的。</span><br><span class="line">## 3.4 select（Retrieve）</span><br><span class="line">select语句和其它语句不同的是：查询会有一个结果集。来看mybatis是怎么处理结果集的！！！</span><br><span class="line">### 查询一条数据</span><br><span class="line">需求：查询id为1的Car信息</span><br><span class="line">SQL语句如下：</span><br><span class="line">```xml</span><br><span class="line">&lt;select id=&quot;selectCarById&quot;&gt;</span><br><span class="line">  select * from t_car where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">```</span><br><span class="line">Java程序如下：</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testSelectCarById()&#123;</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">    // 执行SQL语句</span><br><span class="line">    Object car = sqlSession.selectOne(&quot;selectCarById&quot;, 1);</span><br><span class="line">    System.out.println(car);</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">运行结果如下：</span><br><span class="line">```java</span><br><span class="line">### Error querying database.  Cause: org.apache.ibatis.executor.ExecutorException: </span><br><span class="line">    A query was run and no Result Maps were found for the Mapped Statement &#x27;car.selectCarById&#x27;.  【翻译】：对于一个查询语句来说，没有找到查询的结果映射。</span><br><span class="line">    It&#x27;s likely that neither a Result Type nor a Result Map was specified.						 【翻译】：很可能既没有指定结果类型，也没有指定结果映射。</span><br><span class="line">```</span><br><span class="line">以上的异常大致的意思是：对于一个查询语句来说，你需要指定它的“结果类型”或者“结果映射”。</span><br><span class="line">所以说，你想让mybatis查询之后返回一个Java对象的话，至少你要告诉mybatis返回一个什么类型的Java对象，可以在&lt;select&gt;标签中添加resultType属性，用来指定查询要转换的类型：</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;select id=&quot;selectCarById&quot; resultType=&quot;com.powernode.mybatis.pojo.Car&quot;&gt;</span><br><span class="line">  select * from t_car where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">```</span><br><span class="line">运行结果：</span><br><span class="line">![5006A305-0033-4c71-91F4-23B7CA955AC2.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659683102262-63ca0c28-9c36-4177-abdd-292a8ab2dcbb.png#averageHue=%2337302f&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=320&amp;id=u95b6894d&amp;originHeight=320&amp;originWidth=1365&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=66879&amp;status=done&amp;style=none&amp;taskId=u1d5dc889-00e8-4163-9ffd-846dd7a1cf1&amp;title=&amp;width=1365)</span><br><span class="line">运行后之前的异常不再出现了，resultType是不能省略的。</span><br><span class="line">但返回的Car对象，只有id和brand两个属性有值，其它属性的值都是null，这是为什么呢？我们来观察一下查询结果列名和Car类的属性名是否能一一对应：</span><br><span class="line">查询结果集的列名：id, car_num, brand, guide_price, produce_time, car_type</span><br><span class="line">Car类的属性名：id, carNum, brand, guidePrice, produceTime, carType</span><br><span class="line">通过观察发现：只有id和brand是一致的，其他字段名和属性名对应不上，这是不是导致null的原因呢？我们尝试在sql语句中使用as关键字来给查询结果列名起别名试试：</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;select id=&quot;selectCarById&quot; resultType=&quot;com.powernode.mybatis.pojo.Car&quot;&gt;</span><br><span class="line">  select </span><br><span class="line">    id, car_num as carNum, brand, guide_price as guidePrice, produce_time as produceTime, car_type as carType </span><br><span class="line">  from </span><br><span class="line">    t_car </span><br><span class="line">  where </span><br><span class="line">    id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">```</span><br><span class="line">运行结果如下：</span><br><span class="line">![C08C9F72-CD0B-4848-AD33-D0DAC7078FDF.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659684140382-c8d05a79-7906-4a8f-8301-3cd8097b3eff.png#averageHue=%2334302f&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=297&amp;id=u58b08b89&amp;originHeight=297&amp;originWidth=1338&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=59806&amp;status=done&amp;style=none&amp;taskId=ud4036506-060b-4e34-9035-bccee48d6c7&amp;title=&amp;width=1338)</span><br><span class="line">通过测试得知，如果当查询结果的字段名和java类的属性名对应不上的话，可以采用as关键字起别名，**当然还有其它解决方案，我们后面再看**。</span><br><span class="line"></span><br><span class="line">### 查询多条数据</span><br><span class="line">需求：查询所有的Car信息。</span><br><span class="line">SQL语句如下：</span><br><span class="line">```xml</span><br><span class="line">&lt;!--虽然结果是List集合，但是resultType属性需要指定的是List集合中元素的类型。--&gt;</span><br><span class="line">&lt;select id=&quot;selectCarAll&quot; resultType=&quot;com.powernode.mybatis.pojo.Car&quot;&gt;</span><br><span class="line">  &lt;!--记得使用as起别名，让查询结果的字段名和java类的属性名对应上。--&gt;</span><br><span class="line">  select</span><br><span class="line">    id, car_num as carNum, brand, guide_price as guidePrice, produce_time as produceTime, car_type as carType</span><br><span class="line">  from</span><br><span class="line">    t_car</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">```</span><br><span class="line">Java代码如下：</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testSelectCarAll()&#123;</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">    // 执行SQL语句</span><br><span class="line">    List&lt;Object&gt; cars = sqlSession.selectList(&quot;selectCarAll&quot;);</span><br><span class="line">    // 输出结果</span><br><span class="line">    cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">运行结果如下：</span><br><span class="line">![E1B82451-6452-4e93-BD75-DC6D8B9ADD14.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659685063045-cbeabc75-de94-400b-8d41-ee797076b1a0.png#averageHue=%2332302f&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=461&amp;id=u38578cd4&amp;originHeight=461&amp;originWidth=1299&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=97376&amp;status=done&amp;style=none&amp;taskId=u26ba86cb-1139-4aec-9ec1-cff6cf008a9&amp;title=&amp;width=1299)</span><br><span class="line">## 3.5 关于SQL Mapper的namespace</span><br><span class="line">在SQL Mapper配置文件中&lt;mapper&gt;标签的namespace属性可以翻译为命名空间，这个命名空间主要是为了防止sqlId冲突的。</span><br><span class="line">创建CarMapper2.xml文件，代码如下：</span><br><span class="line">```xml</span><br><span class="line">&lt;mapper namespace=&quot;car2&quot;&gt;</span><br><span class="line">    &lt;select id=&quot;selectCarAll&quot; resultType=&quot;com.powernode.mybatis.pojo.Car&quot;&gt;</span><br><span class="line">        select</span><br><span class="line">            id, car_num as carNum, brand, guide_price as guidePrice, produce_time as produceTime, car_type as carType</span><br><span class="line">        from</span><br><span class="line">            t_car</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">不难看出，CarMapper.xml和CarMapper2.xml文件中都有 id=&quot;selectCarAll&quot;</span><br><span class="line">将CarMapper2.xml配置到mybatis-config.xml文件中。</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper resource=&quot;CarMapper.xml&quot;/&gt;</span><br><span class="line">  &lt;mapper resource=&quot;CarMapper2.xml&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br><span class="line">```</span><br><span class="line">编写Java代码如下：</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testNamespace()&#123;</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">    // 执行SQL语句</span><br><span class="line">    List&lt;Object&gt; cars = sqlSession.selectList(&quot;selectCarAll&quot;);</span><br><span class="line">    // 输出结果</span><br><span class="line">    cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">运行结果如下：</span><br><span class="line">```</span><br><span class="line">org.apache.ibatis.exceptions.PersistenceException: </span><br><span class="line">### Error querying database.  Cause: java.lang.IllegalArgumentException: </span><br><span class="line">  selectCarAll is ambiguous in Mapped Statements collection (try using the full name including the namespace, or rename one of the entries) </span><br><span class="line">  【翻译】selectCarAll在Mapped Statements集合中不明确（请尝试使用包含名称空间的全名，或重命名其中一个条目）</span><br><span class="line">  【大致意思是】selectCarAll重名了，你要么在selectCarAll前添加一个名称空间，要有你改个其它名字。</span><br><span class="line">```</span><br><span class="line">Java代码修改如下：</span><br><span class="line"></span><br><span class="line">正确完整的写法:namespace+id，以后都要这么写</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testNamespace()&#123;</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">    // 执行SQL语句</span><br><span class="line">    // 正确完整的写法:namespace+id，以后都要这么写</span><br><span class="line">    //List&lt;Object&gt; cars = sqlSession.selectList(&quot;car.selectCarAll&quot;);</span><br><span class="line">    List&lt;Object&gt; cars = sqlSession.selectList(&quot;car2.selectCarAll&quot;);</span><br><span class="line">    // 输出结果</span><br><span class="line">    cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">运行结果如下：</span><br><span class="line">![C1ED1184-132C-4393-918B-54D9645FE4B8.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659686031615-93ca679e-0695-4984-bc4c-af596fe5f2a0.png#averageHue=%2332302f&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=506&amp;id=u181fd117&amp;originHeight=506&amp;originWidth=1305&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=108788&amp;status=done&amp;style=none&amp;taskId=u2657f275-38bc-4394-a41d-c50a458c40c&amp;title=&amp;width=1305)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#averageHue=%23dad8d7&amp;from=url&amp;id=y8MI4&amp;originHeight=152&amp;originWidth=1180&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=)</span><br><span class="line"># 四、MyBatis核心配置文件详解</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration这个单词一般就是xml文件中根标签的名字</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;这个是dtd约束，规范标签&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--创建SqlSessionFactory时默认使用的环境--&gt;</span><br><span class="line">    &lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">        &lt;!--其中的一个环境。连接的数据库是powernode--&gt;</span><br><span class="line">        &lt;!--一般一个环境/数据库会对应一个SqlSessionFactory对象。--&gt;</span><br><span class="line">        &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/powernode&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;CarMapper.xml&quot;/&gt;</span><br><span class="line">        &lt;mapper resource=&quot;CarMapper2.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- configuration：根标签，表示配置信息。</span><br><span class="line"></span><br><span class="line">- environments：环境（多个），以“s”结尾表示复数，也就是说mybatis的环境可以配置多个数据源。</span><br><span class="line">   - default属性：表示默认使用的是哪个环境，default后面填写的是environment的id。**default的值只需要和environment的id值一致即可**。</span><br><span class="line">   </span><br><span class="line">- environment：具体的环境配置（**主要包括：事务管理器的配置 + 数据源的配置**）</span><br><span class="line">   - id：给当前环境一个唯一标识，该标识用在environments的default后面，用来指定默认环境的选择。</span><br><span class="line">   </span><br><span class="line">- transactionManager：配置事务管理器</span><br><span class="line">   - type属性：指定事务管理器具体使用什么方式，可选值包括两个</span><br><span class="line">      - **JDBC**：使用JDBC原生的事务管理机制。**底层原理：事务开启conn.setAutoCommit(false); ...处理业务...事务提交conn.commit();**</span><br><span class="line">      </span><br><span class="line">      - **MANAGED**：交给其它容器来管理事务，比如spring、WebLogic、JBOSS等。如果没有管理事务的容器，则没有事务。**没有事务的含义：只要执行一条DML语句，则提交一次**。</span><br><span class="line">      </span><br><span class="line">      - 在mybatis中提供了一个事务管理器接口:Transaction</span><br><span class="line">        该接口下有两个实现类:</span><br><span class="line">      </span><br><span class="line">        ​	JdbcTransaction</span><br><span class="line">        ​	ManagedTransaction</span><br><span class="line">        如果type=&quot;JDBC&quot;，那么底层会实例化JdbcTransaction对象。</span><br><span class="line">        如果type=&quot;MANAGED&quot;，那么底层会实例化ManagedTransaction</span><br><span class="line">   </span><br><span class="line">- dataSource：指定数据源</span><br><span class="line">   - dataSource的作用是为程序提供Connection对象，但凡是给程序提供Connection对象的都可以叫数据源</span><br><span class="line">   - 数据源实际上是一套JDK提供的规范：javax.sql.DataSource，自己写的数据源只要实现javax.sql.DataSource接口就可以</span><br><span class="line">   - type属性：用来指定具体使用的数据库连接池的策略，可选值包括三个</span><br><span class="line">      - **UNPOOLED**：不使用数据库连接池，采用传统的获取连接的方式，虽然也实现Javax.sql.DataSource接口</span><br><span class="line">         - property可以是：</span><br><span class="line">            - driver 这是 JDBC 驱动的 Java 类全限定名。</span><br><span class="line">            - url 这是数据库的 JDBC URL 地址。</span><br><span class="line">            - username 登录数据库的用户名。</span><br><span class="line">            - password 登录数据库的密码。</span><br><span class="line">            - defaultTransactionIsolationLevel 默认的连接事务隔离级别。</span><br><span class="line">            - defaultNetworkTimeout 等待数据库操作完成的默认网络超时时间（单位：毫秒）</span><br><span class="line">      - **POOLED**：使用mybatis自己实现的数据库连接池，采用传统的javax.sql.DataSource规范，除了下面这些，UNPOOLED的也都可以使用</span><br><span class="line">         - property可以是（除了包含**UNPOOLED**中之外）：</span><br><span class="line">            - poolMaximumActiveConnections 连接池当中最多的正在使用的连接对象的数量上限。最多有多少个连接可以活动。默认值：10</span><br><span class="line">            - poolMaximumIdleCheckoutTime 强行让某个连接空闲，超时时间的设置</span><br><span class="line">            - poolMaximumIdleConnections 任意时间可能存在的空闲连接数。</span><br><span class="line">            - poolTimeToWait每隔多少秒打印日志，并且尝试获取连接对象</span><br><span class="line">            - 其它....</span><br><span class="line">      - **JNDI**：java命名目录接口，集成其他第三方数据库连接池，大部分web容器都实现了JNDI规范比如tomcat，采用服务器提供的JNDI技术实现来获取DataSource对象，不同的服务器所能拿到DataSource是不一样。如果不是web或者maven的war工程，JNDI是不能使用的。</span><br><span class="line">         - property可以是（最多只包含以下两个属性）：</span><br><span class="line">            - initial_context 这个属性用来在 InitialContext 中寻找上下文（即，initialContext.lookup(initial_context)）这是个可选属性，如果忽略，那么将会直接从 InitialContext 中寻找 data_source 属性。</span><br><span class="line">            - data_source 这是引用数据源实例位置的上下文路径。提供了 initial_context 配置时会在其返回的上下文中进行查找，没有提供时则直接在 InitialContext 中查找。</span><br><span class="line">   </span><br><span class="line">- mappers：在mappers标签中可以配置多个sql映射文件的路径。</span><br><span class="line"></span><br><span class="line">- mapper：配置某个sql映射文件的路径</span><br><span class="line">   - resource属性：使用相对于类路径的资源引用方式</span><br><span class="line">   - url属性：使用完全限定资源定位符（URL）方式</span><br><span class="line">## 4.1 environment</span><br><span class="line">mybatis-003-configuration</span><br><span class="line">```xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--默认使用开发环境--&gt;</span><br><span class="line">    &lt;!--&lt;environments default=&quot;dev&quot;&gt;--&gt;</span><br><span class="line">    &lt;!--默认使用生产环境--&gt;</span><br><span class="line">    &lt;environments default=&quot;production&quot;&gt;</span><br><span class="line">        &lt;!--开发环境--&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/powernode&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">        &lt;!--生产环境--&gt;</span><br><span class="line">        &lt;environment id=&quot;production&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot; /&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/mybatis&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;CarMapper.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line">```xml</span><br><span class="line">&lt;mapper namespace=&quot;car&quot;&gt;</span><br><span class="line">    &lt;insert id=&quot;insertCar&quot;&gt;</span><br><span class="line">        insert into t_car(id,car_num,brand,guide_price,produce_time,car_type) values(null,#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">```java</span><br><span class="line">public class ConfigurationTest &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testEnvironment() throws Exception&#123;</span><br><span class="line">        // 准备数据</span><br><span class="line">        Car car = new Car();</span><br><span class="line">        car.setCarNum(&quot;133&quot;);</span><br><span class="line">        car.setBrand(&quot;丰田霸道&quot;);</span><br><span class="line">        car.setGuidePrice(50.3);</span><br><span class="line">        car.setProduceTime(&quot;2020-01-10&quot;);</span><br><span class="line">        car.setCarType(&quot;燃油车&quot;);</span><br><span class="line"></span><br><span class="line">        // 一个数据库对应一个SqlSessionFactory对象</span><br><span class="line">        // 两个数据库对应两个SqlSessionFactory对象，以此类推</span><br><span class="line">        SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line"></span><br><span class="line">        // 使用默认数据库（默认production）</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;));</span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession(true);</span><br><span class="line">        int count = sqlSession.insert(&quot;car.insertCar&quot;, car);</span><br><span class="line">        System.out.println(&quot;插入了几条记录：&quot; + count);</span><br><span class="line"></span><br><span class="line">        // 使用指定数据库,后面的参数是String environment类型，用于指定环境</span><br><span class="line">        SqlSessionFactory sqlSessionFactory1 = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;), &quot;dev&quot;);</span><br><span class="line">        SqlSession sqlSession1 = sqlSessionFactory1.openSession(true);</span><br><span class="line">        int count1 = sqlSession1.insert(&quot;car.insertCar&quot;, car);</span><br><span class="line">        System.out.println(&quot;插入了几条记录：&quot; + count1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">执行结果：</span><br><span class="line">![FF0CD72D-D26C-4ccb-9202-593CDA8C53D8.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660117624656-64973cf7-6700-43da-96fa-5960dfc5045b.png#clientId=uf25371ce-2df6-4&amp;from=paste&amp;height=520&amp;id=ube5d1c7d&amp;originHeight=520&amp;originWidth=1627&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=122019&amp;status=done&amp;style=none&amp;taskId=ub5627b32-0df7-4e4d-9968-dc704671e6c&amp;title=&amp;width=1627)</span><br><span class="line">![B8C1BB12-6CB0-4f08-A96F-560B6268C8F8.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660117692466-ecd6317f-5868-4858-a33c-0c7ec68044ac.png#clientId=uf25371ce-2df6-4&amp;from=paste&amp;height=499&amp;id=ubeb926c4&amp;originHeight=499&amp;originWidth=756&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=32276&amp;status=done&amp;style=none&amp;taskId=u8350f504-6e73-4222-8172-415d1cf2331&amp;title=&amp;width=756)</span><br><span class="line">## 4.2 transactionManager</span><br><span class="line">```xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;MANAGED&quot;/&gt;</span><br><span class="line">```</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testTransactionManager() throws Exception&#123;</span><br><span class="line">    // 准备数据</span><br><span class="line">    Car car = new Car();</span><br><span class="line">    car.setCarNum(&quot;133&quot;);</span><br><span class="line">    car.setBrand(&quot;丰田霸道&quot;);</span><br><span class="line">    car.setGuidePrice(50.3);</span><br><span class="line">    car.setProduceTime(&quot;2020-01-10&quot;);</span><br><span class="line">    car.setCarType(&quot;燃油车&quot;);</span><br><span class="line">    // 获取SqlSessionFactory对象</span><br><span class="line">    SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config2.xml&quot;));</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">    // 执行SQL</span><br><span class="line">    int count = sqlSession.insert(&quot;insertCar&quot;, car);</span><br><span class="line">    System.out.println(&quot;插入了几条记录：&quot; + count);</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">当事务管理器是：JDBC</span><br><span class="line"></span><br><span class="line">- 采用JDBC的原生事务机制：</span><br><span class="line">   - 开启事务：conn.setAutoCommit(false);</span><br><span class="line">   - 处理业务......</span><br><span class="line">   - 提交事务：conn.commit();</span><br><span class="line"></span><br><span class="line">当事务管理器是：MANAGED</span><br><span class="line"></span><br><span class="line">- 交给容器去管理事务，但目前使用的是本地程序，没有容器的支持，**当mybatis找不到容器的支持时：没有事务**。也就是说只要执行一条DML语句，则提交一次。</span><br><span class="line">## 4.3 dataSource</span><br><span class="line">```xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;UNPOOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/powernode&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;CarMapper.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testDataSource() throws Exception&#123;</span><br><span class="line">    // 准备数据</span><br><span class="line">    Car car = new Car();</span><br><span class="line">    car.setCarNum(&quot;133&quot;);</span><br><span class="line">    car.setBrand(&quot;丰田霸道&quot;);</span><br><span class="line">    car.setGuidePrice(50.3);</span><br><span class="line">    car.setProduceTime(&quot;2020-01-10&quot;);</span><br><span class="line">    car.setCarType(&quot;燃油车&quot;);</span><br><span class="line">    // 获取SqlSessionFactory对象</span><br><span class="line">    SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config3.xml&quot;));</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = sqlSessionFactory.openSession(true);</span><br><span class="line">    // 执行SQL</span><br><span class="line">    int count = sqlSession.insert(&quot;insertCar&quot;, car);</span><br><span class="line">    System.out.println(&quot;插入了几条记录：&quot; + count);</span><br><span class="line">    // 关闭会话</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">当type是UNPOOLED，控制台输出：</span><br><span class="line">![D58DF616-529B-41c7-8C0F-8A931A380497.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660125487038-29390827-4e20-431a-8d62-f56a40bf0349.png#averageHue=%2333302f&amp;clientId=uf25371ce-2df6-4&amp;from=paste&amp;height=275&amp;id=u12a918bf&amp;originHeight=275&amp;originWidth=1637&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=50045&amp;status=done&amp;style=none&amp;taskId=ud5ec24dc-2635-4d39-9ac2-ee47e88b08f&amp;title=&amp;width=1637)</span><br><span class="line">修改配置文件mybatis-config3.xml中的配置：</span><br><span class="line">```xml</span><br><span class="line">&lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">```</span><br><span class="line">Java测试程序不需要修改，直接执行，看控制台输出：</span><br><span class="line">![8DFDAF99-AA22-41cd-99C7-227A4667A0EB.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660125701333-b14f63d8-c442-4211-ad77-884f21162357.png#averageHue=%2334302f&amp;clientId=uf25371ce-2df6-4&amp;from=paste&amp;height=435&amp;id=u52280792&amp;originHeight=435&amp;originWidth=1628&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=93482&amp;status=done&amp;style=none&amp;taskId=ub425fbf6-8f9b-4955-8fa5-425a4fd2abb&amp;title=&amp;width=1628)</span><br><span class="line">通过测试得出：UNPOOLED不会使用连接池，每一次都会新建JDBC连接对象。POOLED会使用数据库连接池。【这个连接池是mybatis自己实现的。】</span><br><span class="line">```xml</span><br><span class="line">&lt;dataSource type=&quot;JNDI&quot;&gt;</span><br><span class="line">```</span><br><span class="line">JNDI的方式：表示对接JNDI服务器中的连接池。这种方式给了我们可以使用第三方连接池的接口。如果想使用dbcp、c3p0、druid（德鲁伊）等，需要使用这种方式。</span><br><span class="line">这种再重点说一下type=&quot;POOLED&quot;的时候，它的属性有哪些？</span><br><span class="line">```xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/powernode&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;!--最大连接数--&gt;</span><br><span class="line">                &lt;property name=&quot;poolMaximumActiveConnections&quot; value=&quot;3&quot;/&gt;</span><br><span class="line">                &lt;!--这是一个底层设置，如果获取连接花费了相当长的时间，连接池会打印状态日志并重新尝试获取一个连接（避免在误配置的情况下一直失败且不打印日志），默认值：20000 毫秒（即 20 秒）。--&gt;</span><br><span class="line">                &lt;property name=&quot;poolTimeToWait&quot; value=&quot;20000&quot;/&gt;</span><br><span class="line">                &lt;!--强行回归池的时间--&gt;</span><br><span class="line">                &lt;property name=&quot;poolMaximumCheckoutTime&quot; value=&quot;20000&quot;/&gt;</span><br><span class="line">                &lt;!--最多空闲数量--&gt;</span><br><span class="line">                &lt;property name=&quot;poolMaximumIdleConnections&quot; value=&quot;1&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;CarMapper.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line">poolMaximumActiveConnections：最大的活动的连接数量。默认值10</span><br><span class="line">poolMaximumIdleConnections：最大的空闲连接数量。默认值5</span><br><span class="line">poolMaximumCheckoutTime：强行回归池的时间。默认值20秒。</span><br><span class="line">poolTimeToWait：当无法获取到空闲连接时，每隔20秒打印一次日志，避免因代码配置有误，导致傻等。（时长是可以配置的）</span><br><span class="line">当然，还有其他属性。对于连接池来说，以上几个属性比较重要。</span><br><span class="line">最大的活动的连接数量就是连接池连接数量的上限。默认值10，如果有10个请求正在使用这10个连接，第11个请求只能等待空闲连接。</span><br><span class="line">最大的空闲连接数量。默认值5，如何已经有了5个空闲连接，当第6个连接要空闲下来的时候，连接池会选择关闭该连接对象。来减少数据库的开销。</span><br><span class="line">需要根据系统的并发情况，来合理调整连接池最大连接数以及最多空闲数量。充分发挥数据库连接池的性能。【可以根据实际情况进行测试，然后调整一个合理的数量。】</span><br><span class="line">下图是默认配置：</span><br><span class="line">![9970FDF3-6A6A-4530-84A3-B72FE189124E.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660126871013-88f83ea4-94e9-4088-bdb4-06a4fd73866a.png#averageHue=%233d4042&amp;clientId=uf25371ce-2df6-4&amp;from=paste&amp;height=348&amp;id=u3a10ea73&amp;originHeight=348&amp;originWidth=640&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=22150&amp;status=done&amp;style=none&amp;taskId=u43582ddf-d276-4250-aefb-35db3c377e4&amp;title=&amp;width=640)</span><br><span class="line">在以上配置的基础之上，可以编写java程序测试：</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testPool() throws Exception&#123;</span><br><span class="line">    SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config3.xml&quot;));</span><br><span class="line">    for (int i = 0; i &lt; 4; i++) &#123;</span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        Object selectCarByCarNum = sqlSession.selectOne(&quot;selectCarByCarNum&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">```xml</span><br><span class="line">&lt;select id=&quot;selectCarByCarNum&quot; resultType=&quot;com.powernode.mybatis.pojo.Car&quot;&gt;</span><br><span class="line">  select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car where car_num = &#x27;100&#x27;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">```</span><br><span class="line">![E2C814E9-489D-4f4a-94F6-2ED5F6E56F54.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660128646511-8df1006a-dd85-48d1-9b88-ce7969d9b546.png#averageHue=%2335302f&amp;clientId=uf25371ce-2df6-4&amp;from=paste&amp;height=748&amp;id=u2b331339&amp;originHeight=748&amp;originWidth=1507&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=165804&amp;status=done&amp;style=none&amp;taskId=ud490fe5a-777b-41eb-9b83-a702e843fe3&amp;title=&amp;width=1507)</span><br><span class="line">## 4.4 properties</span><br><span class="line">mybatis提供了更加灵活的配置，连接数据库的信息可以单独写到一个属性资源文件中，假设在类的根路径下创建jdbc.properties文件，配置如下：</span><br><span class="line">```properties</span><br><span class="line">jdbc.driver=com.mysql.cj.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://localhost:3306/powernode</span><br><span class="line">```</span><br><span class="line">在mybatis核心配置文件中引入并使用：</span><br><span class="line">```xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--引入外部属性资源文件--&gt;</span><br><span class="line">    &lt;properties resource=&quot;jdbc.properties&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;jdbc.username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;jdbc.password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;!--$&#123;key&#125;使用--&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;$&#123;jdbc.driver&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;CarMapper.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line">编写Java程序进行测试：</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testProperties() throws Exception&#123;</span><br><span class="line">    SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config4.xml&quot;));</span><br><span class="line">    SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">    Object car = sqlSession.selectOne(&quot;selectCarByCarNum&quot;);</span><br><span class="line">    System.out.println(car);</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">**properties两个属性：**</span><br><span class="line">**resource：这个属性从类的根路径下开始加载。【常用的。】**</span><br><span class="line">**url：从指定的url加载，假设文件放在d:/jdbc.properties，这个url可以写成：file:///d:/jdbc.properties。注意是三个斜杠哦。**</span><br><span class="line">注意：如果不知道mybatis-config.xml文件中标签的编写顺序的话，可以有两种方式知道它的顺序：</span><br><span class="line"></span><br><span class="line">- 第一种方式：查看dtd约束文件。</span><br><span class="line">- 第二种方式：通过idea的报错提示信息。【一般采用这种方式】</span><br><span class="line">## 4.5 mapper</span><br><span class="line">mapper标签用来指定SQL映射文件的路径，包含多种指定方式，这里先主要看其中两种：</span><br><span class="line">第一种：resource，从类的根路径下开始加载【比url常用】</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper resource=&quot;CarMapper.xml&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br><span class="line">```</span><br><span class="line">如果是这样写的话，必须保证类的根下有CarMapper.xml文件。</span><br><span class="line">如果类的根路径下有一个包叫做test，CarMapper.xml如果放在test包下的话，这个配置应该是这样写：</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper resource=&quot;test/CarMapper.xml&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br><span class="line">```</span><br><span class="line">第二种：url，从指定的url位置加载</span><br><span class="line">假设CarMapper.xml文件放在d盘的根下，这个配置就需要这样写：</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper url=&quot;file:///d:/CarMapper.xml&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br><span class="line">```</span><br><span class="line">**mapper还有其他的指定方式，后面再看！！！**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#averageHue=%23dad8d7&amp;from=url&amp;id=hqhDQ&amp;originHeight=152&amp;originWidth=1180&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=)</span><br><span class="line"># 五、手写MyBatis框架（掌握原理）</span><br><span class="line">警示：该部分内容有难度，基础较弱的程序员可能有些部分是听不懂的，如果无法跟下来，可直接跳过，不影响后续知识点的学习。当然，如果你要能够跟下来，必然会让你加深对MyBatis框架的理解。</span><br><span class="line">**我们给自己的框架起个名：GodBatis（起名灵感来源于：my god!!! 我的天呢！）**</span><br><span class="line"></span><br><span class="line">## 5.1 dom4j解析XML文件</span><br><span class="line">该部分内容不再赘述，不会解析XML的，请观看老杜前面讲解的dom4j解析XML文件的视频。</span><br><span class="line">模块名：parse-xml-by-dom4j（普通的Java Maven模块）</span><br><span class="line">第一步：引入dom4j的依赖</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;org.group&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;parse-xml-by-dom4j&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!--dom4j依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.dom4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dom4j&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.1.3&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--jaxen依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;jaxen&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jaxen&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--junit依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.13.2&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br><span class="line">```</span><br><span class="line">第二步：编写配置文件godbatis-config.xml</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/powernode&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">        &lt;mappers&gt;</span><br><span class="line">            &lt;mapper resource=&quot;sqlmapper.xml&quot;/&gt;</span><br><span class="line">        &lt;/mappers&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line">第三步：解析godbatis-config.xml</span><br><span class="line">```java</span><br><span class="line">package com.powernode.dom4j;</span><br><span class="line"></span><br><span class="line">import org.dom4j.Document;</span><br><span class="line">import org.dom4j.Element;</span><br><span class="line">import org.dom4j.Node;</span><br><span class="line">import org.dom4j.io.SAXReader;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 使用dom4j解析XML文件</span><br><span class="line"> */</span><br><span class="line">public class ParseXMLByDom4jTest &#123;</span><br><span class="line">    @Test</span><br><span class="line">    public void testGodBatisConfigXML() throws Exception&#123;</span><br><span class="line"></span><br><span class="line">        // 读取xml，返回document对象</span><br><span class="line">        SAXReader reader = new SAXReader();</span><br><span class="line">        // 括号内的是获取输入流，然后读取xml文件，返回document对象。document对象是文档对象，代表了整个XML文件。</span><br><span class="line">        Document document = reader.read(ClassLoader.getSystemClassLoader().getResourceAsStream(&quot;mybatis-config.xml&quot;));</span><br><span class="line"></span><br><span class="line">        // 获取文档当中的根标签</span><br><span class="line">		Element rootElt = document.getRootElement();</span><br><span class="line">		String rootEltName = rootElt.getName();</span><br><span class="line">		System.out.println(&quot;根节点的名字:&quot;+ rootEltName);</span><br><span class="line">        </span><br><span class="line">        // 获取&lt;environments&gt;标签的default属性的值</span><br><span class="line">        //xpath是做标签路径匹配的。能够让我们快速定位XML文件中的元素，后面的内容代表从根下开始找configuration标签，然后找configuration标签下的子标</span><br><span class="line">        String xpath = &quot;/configuration/environments&quot;;</span><br><span class="line">        Element environments = (Element)document.selectSingleNode(xpath);签environments// Element是Node类的子类，方法更多，使用更便捷，要强转</span><br><span class="line">        // 获取属性的值</span><br><span class="line">        String defaultId = environmentsElt.attributeValue(&quot;default&quot;);</span><br><span class="line">        System.out.println(&quot;默认环境的id&quot; + defaultId);</span><br><span class="line">        //根据默认id获取具体的环境environment</span><br><span class="line">        xpath = &quot;/configuration/environments/environment[@id=&#x27;&quot;+defaultEnvironmentId+&quot;&#x27;]&quot;;</span><br><span class="line">        System.out.println(xpath);</span><br><span class="line"></span><br><span class="line">        // 获取事务管理器类型(transactionManager节点)，Element的element()方法用来获取孩子节点</span><br><span class="line">        Element transactionManager = environment.element(&quot;transactionManager&quot;);</span><br><span class="line">        String transactionManagerType = transactionManager.attributeValue(&quot;type&quot;);</span><br><span class="line">        System.out.println(transactionManagerType);</span><br><span class="line"></span><br><span class="line">        // 获取数据源(dataSource)类型</span><br><span class="line">        Element dataSource = environmentElt.element(&quot;dataSource&quot;);</span><br><span class="line">        String dataSourceType = dataSource.attributeValue(&quot;type&quot;);</span><br><span class="line">        System.out.println(dataSourceType);</span><br><span class="line"></span><br><span class="line">        // 将dataSource信息封装到List集合，然后获取dataSource节点下的所有子节点</span><br><span class="line">        List&lt;Element&gt; propertyElts = dataSource.elements();</span><br><span class="line">		// 遍历</span><br><span class="line">		propertyElts.forEach(propertyElt -&gt;&#123;</span><br><span class="line">			String name = propertyElt.attributeValue(&quot;name&quot;);</span><br><span class="line">			String value = propertyElt.attributeValue(&quot;value&quot;);</span><br><span class="line">			System.out.println(name + &quot;=&quot; + value);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        // 获取所有的mapper标签</span><br><span class="line">		//不想从根下开始获取，你想从任意位置开始，获取所有的某个标签，xpath该这样写</span><br><span class="line">		xpath =&quot;//mapper&quot;;//两个斜杠</span><br><span class="line">		List&lt;Node&gt; mappers = document.selectNodes(xpath);</span><br><span class="line">		// 遍历</span><br><span class="line">		mappers.forEach(mapper -&gt;&#123;</span><br><span class="line">			Element mapperElt =(Element)mapper;</span><br><span class="line">			String resource = mapperElt.attributeValue( s: &quot;resource&quot;);</span><br><span class="line">            System.out.println(resource);</span><br><span class="line">		&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">执行结果：</span><br><span class="line">![D1EE8DEE-5612-4fc7-9C3C-EA1C260B01F4.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660182883453-edbe3196-015a-4c7e-b318-1593089d5496.png#averageHue=%232d2c2c&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=229&amp;id=u7883e666&amp;originHeight=229&amp;originWidth=513&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=12448&amp;status=done&amp;style=none&amp;taskId=u141e0182-ddb8-4910-9090-e352e7914da&amp;title=&amp;width=513)</span><br><span class="line">第四步：编写配置文件CarMapper.xml</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=&quot;car&quot;&gt;</span><br><span class="line">    &lt;insert id=&quot;insertCar&quot;&gt;</span><br><span class="line">        insert into t_car(id,car_num,brand,guide_price,produce_time,car_type) values(null,#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">    &lt;select id=&quot;selectCarByCarNum&quot; resultType=&quot;com.powernode.mybatis.pojo.Car&quot;&gt;</span><br><span class="line">        select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car where car_num = #&#123;carNum&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">第五步：解析CarMapper.xml</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testParseSqlMapperXML() throws Exception&#123;</span><br><span class="line">    // 读取xml，获取document对象</span><br><span class="line">    SAXReader saxReader = new SAXReader();</span><br><span class="line">    Document document = saxReader.read(Thread.currentThread().getContextClassLoader().getResourceAsStream(&quot;CarMapper.xml&quot;));</span><br><span class="line"></span><br><span class="line">    // 获取namespace</span><br><span class="line">    String xpath = &quot;/mapper&quot;;</span><br><span class="line">    Element mapperElt = (Element) document.selectSingleNode(xpath);</span><br><span class="line">    String namespace = mapperElt.attributeValue(&quot;namespace&quot;);</span><br><span class="line">    System.out.println(namespace);</span><br><span class="line"></span><br><span class="line">    // 获取mapper节点下所有的子节点</span><br><span class="line">    List&lt;Element&gt; elements = mapper.elements();</span><br><span class="line">    // 遍历</span><br><span class="line">    elements().forEach(elements -&gt; &#123;</span><br><span class="line">        // 获取sqlId</span><br><span class="line">        String id = elements.attributeValue(&quot;id&quot;);</span><br><span class="line">        System.out.println(id);</span><br><span class="line">        // 如果是select标签，还要获取它的resultType</span><br><span class="line">        String resultType = elements.attributeValue(&quot;resultType&quot;);//没有这个属性的话会自动返回&quot;null“</span><br><span class="line">        System.out.println(&quot;resultType:&quot; + resultType);</span><br><span class="line"></span><br><span class="line">        // sql语句(getTextTrim表示获取标签中的文本内容，而且去除前后空白)</span><br><span class="line">        String sql = statementElt.getTextTrim();</span><br><span class="line">        System.out.println(&quot;sql:&quot; + sql);</span><br><span class="line">        // mybaits封装了jdbc。早晚要执行带有?的sql语句。</span><br><span class="line">		// 转换</span><br><span class="line">		String newSql =sql.replaceAll(&quot;#\\&#123;[0-9A-Za-z_$]*&#125;&quot;,&quot;?&quot;);</span><br><span class="line">		System.out.println(newSql);		</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">执行结果：</span><br><span class="line">![41A93BE0-3374-4283-97DE-152288504BE3.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660183887361-baffabf0-4caa-4e64-86d0-5d5dcfb1edd6.png#averageHue=%232d2c2c&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=232&amp;id=ubad124f6&amp;originHeight=232&amp;originWidth=1487&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=23737&amp;status=done&amp;style=none&amp;taskId=ubf72afc9-79ef-4242-9275-606aa95feec&amp;title=&amp;width=1487)</span><br><span class="line">## 5.2 GodBatis</span><br><span class="line">手写框架之前，如果没有思路，可以先参考一下mybatis的客户端程序，通过客户端程序来逆推需要的类，参考代码：</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testInsert()&#123;</span><br><span class="line">    SqlSession sqlSession = null;</span><br><span class="line">    try &#123;</span><br><span class="line">        // 1.创建SqlSessionFactoryBuilder对象</span><br><span class="line">        SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">        // 2.创建SqlSessionFactory对象</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;));</span><br><span class="line">        // 3.创建SqlSession对象</span><br><span class="line">        sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        // 4.执行SQL</span><br><span class="line">        Car car = new Car(null, &quot;111&quot;, &quot;宝马X7&quot;, &quot;70.3&quot;, &quot;2010-10-11&quot;, &quot;燃油车&quot;);</span><br><span class="line">        int count = sqlSession.insert(&quot;insertCar&quot;,car);</span><br><span class="line">        System.out.println(&quot;更新了几条记录：&quot; + count);</span><br><span class="line">        // 5.提交</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        // 回滚</span><br><span class="line">        if (sqlSession != null) &#123;</span><br><span class="line">            sqlSession.rollback();</span><br><span class="line">        &#125;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        // 6.关闭</span><br><span class="line">        if (sqlSession != null) &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testSelectOne()&#123;</span><br><span class="line">    SqlSession sqlSession = null;</span><br><span class="line">    try &#123;</span><br><span class="line">        // 1.创建SqlSessionFactoryBuilder对象</span><br><span class="line">        SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">        // 2.创建SqlSessionFactory对象</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;));</span><br><span class="line">        // 3.创建SqlSession对象</span><br><span class="line">        sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        // 4.执行SQL</span><br><span class="line">        Car car = (Car)sqlSession.selectOne(&quot;selectCarByCarNum&quot;, &quot;111&quot;);</span><br><span class="line">        System.out.println(car);</span><br><span class="line">        // 5.提交</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        // 回滚</span><br><span class="line">        if (sqlSession != null) &#123;</span><br><span class="line">            sqlSession.rollback();</span><br><span class="line">        &#125;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        // 6.关闭</span><br><span class="line">        if (sqlSession != null) &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">### 第一步：IDEA中创建模块</span><br><span class="line">模块：godbatis（创建普通的Java Maven模块，打包方式jar），引入相关依赖</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;org.god&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;godbatis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0.0&lt;/version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!--dom4j依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.dom4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dom4j&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.1.3&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--jaxen依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;jaxen&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jaxen&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--junit依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.13.2&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br><span class="line">```</span><br><span class="line">### 第二步：资源工具类，方便获取指向配置文件的输入流</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import java.io.InputStream;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 资源工具类</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class Resources &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 从类路径中获取配置文件的输入流</span><br><span class="line">     * @param config</span><br><span class="line">     * @return 输入流，该输入流指向类路径中的配置文件</span><br><span class="line">     */</span><br><span class="line">    public static InputStream getResourcesAsStream(String config)&#123;</span><br><span class="line">        return Thread.currentThread().getContextClassLoader().getResourceAsStream(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">### 第三步：定义SqlSessionFactoryBuilder类</span><br><span class="line">提供一个无参数构造方法，再提供一个build方法，该build方法要返回SqlSessionFactory对象</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import java.io.InputStream;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * SqlSessionFactory对象构建器</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class SqlSessionFactoryBuilder &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 创建构建器对象</span><br><span class="line">     */</span><br><span class="line">    public SqlSessionFactoryBuilder() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取SqlSessionFactory对象</span><br><span class="line">     * 该方法主要功能是：读取godbatis核心配置文件，并构建SqlSessionFactory对象</span><br><span class="line">     * @param inputStream 指向核心配置文件的输入流</span><br><span class="line">     * @return SqlSessionFactory对象</span><br><span class="line">     */</span><br><span class="line">    public SqlSessionFactory build(InputStream inputStream)&#123;</span><br><span class="line">        // 解析配置文件，创建数据源对象</span><br><span class="line">        // 解析配置文件，创建事务管理器对象</span><br><span class="line">        // 解析配置文件，获取所有的SQL映射对象</span><br><span class="line">        // 将以上信息封装到SqlSessionFactory对象中</span><br><span class="line">        // 返回</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">### 第四步：分析SqlSessionFactory类中有哪些属性</span><br><span class="line"></span><br><span class="line">- 事务管理器</span><br><span class="line">   - GodJDBCTransaction</span><br><span class="line">- SQL映射对象集合</span><br><span class="line">   - Map&lt;String, GodMappedStatement&gt;</span><br><span class="line">### 第五步：定义GodJDBCTransaction</span><br><span class="line">事务管理器最好是定义一个接口，然后每一个具体的事务管理器都实现这个接口。</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 事务管理器接口</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public interface TransactionManager &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 提交事务</span><br><span class="line">     */</span><br><span class="line">    void commit();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 回滚事务</span><br><span class="line">     */</span><br><span class="line">    void rollback();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 关闭事务</span><br><span class="line">     */</span><br><span class="line">    void close();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 开启连接</span><br><span class="line">     */</span><br><span class="line">    void openConnection();</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 获取连接对象</span><br><span class="line">     * @return 连接对象</span><br><span class="line">     */</span><br><span class="line">    Connection getConnection();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import javax.sql.DataSource;</span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 事务管理器</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class GodJDBCTransaction implements TransactionManager &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 连接对象，控制事务时需要</span><br><span class="line">     */</span><br><span class="line">    private Connection conn;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 数据源对象</span><br><span class="line">     */</span><br><span class="line">    private DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 自动提交标志：</span><br><span class="line">     * true表示自动提交</span><br><span class="line">     * false表示不自动提交</span><br><span class="line">     */</span><br><span class="line">    private boolean autoCommit;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 构造事务管理器对象</span><br><span class="line">     * @param autoCommit</span><br><span class="line">     */</span><br><span class="line">    public GodJDBCTransaction(DataSource dataSource, boolean autoCommit) &#123;</span><br><span class="line">        this.dataSource = dataSource;</span><br><span class="line">        this.autoCommit = autoCommit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 提交事务</span><br><span class="line">     */</span><br><span class="line">    public void commit()&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            conn.commit();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 回滚事务</span><br><span class="line">     */</span><br><span class="line">    public void rollback()&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            conn.rollback();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void close() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            conn.close();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void openConnection() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            this.conn = dataSource.getConnection();</span><br><span class="line">            this.conn.setAutoCommit(this.autoCommit);</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Connection getConnection() &#123;</span><br><span class="line">        return conn;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">### 第六步：事务管理器中需要数据源，定义GodUNPOOLEDDataSource</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import java.io.PrintWriter;</span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.DriverManager;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.sql.SQLFeatureNotSupportedException;</span><br><span class="line">import java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 数据源实现类，不使用连接池</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class GodUNPOOLEDDataSource implements javax.sql.DataSource&#123;</span><br><span class="line">    private String url;</span><br><span class="line">    private String username;</span><br><span class="line">    private String password;</span><br><span class="line"></span><br><span class="line">    public GodUNPOOLEDDataSource(String driver, String url, String username, String password) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            // 注册驱动</span><br><span class="line">            Class.forName(driver);</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">        this.url = url;</span><br><span class="line">        this.username = username;</span><br><span class="line">        this.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Connection getConnection() throws SQLException &#123;</span><br><span class="line">        return DriverManager.getConnection(url, username, password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Connection getConnection(String username, String password) throws SQLException &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public PrintWriter getLogWriter() throws SQLException &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setLogWriter(PrintWriter out) throws SQLException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setLoginTimeout(int seconds) throws SQLException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int getLoginTimeout() throws SQLException &#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Logger getParentLogger() throws SQLFeatureNotSupportedException &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public &lt;T&gt; T unwrap(Class&lt;T&gt; iface) throws SQLException &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean isWrapperFor(Class&lt;?&gt; iface) throws SQLException &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">### 第七步：定义GodMappedStatement</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * SQL映射实体类</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class GodMappedStatement &#123;</span><br><span class="line">    private String sqlId;</span><br><span class="line">    private String resultType;</span><br><span class="line">    private String sql;</span><br><span class="line">    private String parameterType;</span><br><span class="line"></span><br><span class="line">    private String sqlType;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;GodMappedStatement&#123;&quot; +</span><br><span class="line">                &quot;sqlId=&#x27;&quot; + sqlId + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, resultType=&#x27;&quot; + resultType + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, sql=&#x27;&quot; + sql + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, parameterType=&#x27;&quot; + parameterType + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, sqlType=&#x27;&quot; + sqlType + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSqlId() &#123;</span><br><span class="line">        return sqlId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSqlId(String sqlId) &#123;</span><br><span class="line">        this.sqlId = sqlId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getResultType() &#123;</span><br><span class="line">        return resultType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setResultType(String resultType) &#123;</span><br><span class="line">        this.resultType = resultType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSql() &#123;</span><br><span class="line">        return sql;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSql(String sql) &#123;</span><br><span class="line">        this.sql = sql;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getParameterType() &#123;</span><br><span class="line">        return parameterType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setParameterType(String parameterType) &#123;</span><br><span class="line">        this.parameterType = parameterType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSqlType() &#123;</span><br><span class="line">        return sqlType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSqlType(String sqlType) &#123;</span><br><span class="line">        this.sqlType = sqlType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public GodMappedStatement(String sqlId, String resultType, String sql, String parameterType, String sqlType) &#123;</span><br><span class="line">        this.sqlId = sqlId;</span><br><span class="line">        this.resultType = resultType;</span><br><span class="line">        this.sql = sql;</span><br><span class="line">        this.parameterType = parameterType;</span><br><span class="line">        this.sqlType = sqlType;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">### 第八步：完善SqlSessionFactory类</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import javax.sql.DataSource;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * SqlSession工厂对象，使用SqlSessionFactory可以获取会话对象</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class SqlSessionFactory &#123;</span><br><span class="line">    private TransactionManager transactionManager;</span><br><span class="line">    private Map&lt;String, GodMappedStatement&gt; mappedStatements;</span><br><span class="line"></span><br><span class="line">    public SqlSessionFactory(TransactionManager transactionManager, Map&lt;String, GodMappedStatement&gt; mappedStatements) &#123;</span><br><span class="line">        this.transactionManager = transactionManager;</span><br><span class="line">        this.mappedStatements = mappedStatements;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public TransactionManager getTransactionManager() &#123;</span><br><span class="line">        return transactionManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTransactionManager(TransactionManager transactionManager) &#123;</span><br><span class="line">        this.transactionManager = transactionManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Map&lt;String, GodMappedStatement&gt; getMappedStatements() &#123;</span><br><span class="line">        return mappedStatements;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMappedStatements(Map&lt;String, GodMappedStatement&gt; mappedStatements) &#123;</span><br><span class="line">        this.mappedStatements = mappedStatements;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">### 第九步：完善SqlSessionFactoryBuilder中的build方法</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import org.dom4j.Document;</span><br><span class="line">import org.dom4j.DocumentException;</span><br><span class="line">import org.dom4j.Element;</span><br><span class="line">import org.dom4j.io.SAXReader;</span><br><span class="line"></span><br><span class="line">import javax.sql.DataSource;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * SqlSessionFactory对象构建器</span><br><span class="line"> *</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class SqlSessionFactoryBuilder &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 创建构建器对象</span><br><span class="line">     */</span><br><span class="line">    public SqlSessionFactoryBuilder() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取SqlSessionFactory对象</span><br><span class="line">     * 该方法主要功能是：读取godbatis核心配置文件，并构建SqlSessionFactory对象</span><br><span class="line">     *</span><br><span class="line">     * @param inputStream 指向核心配置文件的输入流</span><br><span class="line">     * @return SqlSessionFactory对象</span><br><span class="line">     */</span><br><span class="line">    public SqlSessionFactory build(InputStream inputStream) throws DocumentException &#123;</span><br><span class="line">        SAXReader saxReader = new SAXReader();</span><br><span class="line">        Document document = saxReader.read(inputStream);</span><br><span class="line">        Element environmentsElt = (Element) document.selectSingleNode(&quot;/configuration/environments&quot;);</span><br><span class="line">        String defaultEnv = environmentsElt.attributeValue(&quot;default&quot;);</span><br><span class="line">        Element environmentElt = (Element) document.selectSingleNode(&quot;/configuration/environments/environment[@id=&#x27;&quot; + defaultEnv + &quot;&#x27;]&quot;);</span><br><span class="line">        // 解析配置文件，创建数据源对象</span><br><span class="line">        Element dataSourceElt = environmentElt.element(&quot;dataSource&quot;);</span><br><span class="line">        DataSource dataSource = getDataSource(dataSourceElt);</span><br><span class="line">        // 解析配置文件，创建事务管理器对象</span><br><span class="line">        Element transactionManagerElt = environmentElt.element(&quot;transactionManager&quot;);</span><br><span class="line">        TransactionManager transactionManager = getTransactionManager(transactionManagerElt, dataSource);</span><br><span class="line">        // 解析配置文件，获取所有的SQL映射对象</span><br><span class="line">        Element mappers = environmentsElt.element(&quot;mappers&quot;);</span><br><span class="line">        Map&lt;String, GodMappedStatement&gt; mappedStatements = getMappedStatements(mappers);</span><br><span class="line">        // 将以上信息封装到SqlSessionFactory对象中</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = new SqlSessionFactory(transactionManager, mappedStatements);</span><br><span class="line">        // 返回</span><br><span class="line">        return sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Map&lt;String, GodMappedStatement&gt; getMappedStatements(Element mappers) &#123;</span><br><span class="line">        Map&lt;String, GodMappedStatement&gt; mappedStatements = new HashMap&lt;&gt;();</span><br><span class="line">        mappers.elements().forEach(mapperElt -&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                String resource = mapperElt.attributeValue(&quot;resource&quot;);</span><br><span class="line">                SAXReader saxReader = new SAXReader();</span><br><span class="line">                Document document = saxReader.read(Resources.getResourcesAsStream(resource));</span><br><span class="line">                Element mapper = (Element) document.selectSingleNode(&quot;/mapper&quot;);</span><br><span class="line">                String namespace = mapper.attributeValue(&quot;namespace&quot;);</span><br><span class="line"></span><br><span class="line">                mapper.elements().forEach(sqlMapper -&gt; &#123;</span><br><span class="line">                    String sqlId = sqlMapper.attributeValue(&quot;id&quot;);</span><br><span class="line">                    String sql = sqlMapper.getTextTrim();</span><br><span class="line">                    String parameterType = sqlMapper.attributeValue(&quot;parameterType&quot;);</span><br><span class="line">                    String resultType = sqlMapper.attributeValue(&quot;resultType&quot;);</span><br><span class="line">                    String sqlType = sqlMapper.getName().toLowerCase();</span><br><span class="line">                    // 封装GodMappedStatement对象</span><br><span class="line">                    GodMappedStatement godMappedStatement = new GodMappedStatement(sqlId, resultType, sql, parameterType, sqlType);</span><br><span class="line">                    mappedStatements.put(namespace + &quot;.&quot; + sqlId, godMappedStatement);</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">            &#125; catch (DocumentException e) &#123;</span><br><span class="line">                throw new RuntimeException(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return mappedStatements;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private TransactionManager getTransactionManager(Element transactionManagerElt, DataSource dataSource) &#123;</span><br><span class="line">        String type = transactionManagerElt.attributeValue(&quot;type&quot;).toUpperCase();</span><br><span class="line">        TransactionManager transactionManager = null;</span><br><span class="line">        if (&quot;JDBC&quot;.equals(type)) &#123;</span><br><span class="line">            // 使用JDBC事务</span><br><span class="line">            transactionManager = new GodJDBCTransaction(dataSource, false);</span><br><span class="line">        &#125; else if (&quot;MANAGED&quot;.equals(type)) &#123;</span><br><span class="line">            // 事务管理器是交给JEE容器的</span><br><span class="line">        &#125;</span><br><span class="line">        return transactionManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private DataSource getDataSource(Element dataSourceElt) &#123;</span><br><span class="line">        // 获取所有数据源的属性配置</span><br><span class="line">        Map&lt;String, String&gt; dataSourceMap = new HashMap&lt;&gt;();</span><br><span class="line">        dataSourceElt.elements().forEach(propertyElt -&gt; &#123;</span><br><span class="line">            dataSourceMap.put(propertyElt.attributeValue(&quot;name&quot;), propertyElt.attributeValue(&quot;value&quot;));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        String dataSourceType = dataSourceElt.attributeValue(&quot;type&quot;).toUpperCase();</span><br><span class="line">        DataSource dataSource = null;</span><br><span class="line">        if (&quot;POOLED&quot;.equals(dataSourceType)) &#123;</span><br><span class="line"></span><br><span class="line">        &#125; else if (&quot;UNPOOLED&quot;.equals(dataSourceType)) &#123;</span><br><span class="line">            dataSource = new GodUNPOOLEDDataSource(dataSourceMap.get(&quot;driver&quot;), dataSourceMap.get(&quot;url&quot;), dataSourceMap.get(&quot;username&quot;), dataSourceMap.get(&quot;password&quot;));</span><br><span class="line">        &#125; else if (&quot;JNDI&quot;.equals(dataSourceType)) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        return dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">### 第十步：在SqlSessionFactory中添加openSession方法</span><br><span class="line">```java</span><br><span class="line">public SqlSession openSession()&#123;</span><br><span class="line">    transactionManager.openConnection();</span><br><span class="line">    SqlSession sqlSession = new SqlSession(transactionManager, mappedStatements);</span><br><span class="line">    return sqlSession;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">### 第十一步：编写SqlSession类中commit rollback close方法</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 数据库会话对象</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class SqlSession &#123;</span><br><span class="line">    private TransactionManager transactionManager;</span><br><span class="line">    private Map&lt;String, GodMappedStatement&gt; mappedStatements;</span><br><span class="line"></span><br><span class="line">    public SqlSession(TransactionManager transactionManager, Map&lt;String, GodMappedStatement&gt; mappedStatements) &#123;</span><br><span class="line">        this.transactionManager = transactionManager;</span><br><span class="line">        this.mappedStatements = mappedStatements;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void commit()&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            transactionManager.getConnection().commit();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void rollback()&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            transactionManager.getConnection().rollback();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void close()&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            transactionManager.getConnection().close();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">### 第十二步：编写SqlSession类中的insert方法</span><br><span class="line">```java</span><br><span class="line">/**</span><br><span class="line"> * 插入数据</span><br><span class="line"> *</span><br><span class="line"> * @param sqlId 要执行的sqlId</span><br><span class="line"> * @param obj   插入的数据</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public int insert(String sqlId, Object obj) &#123;</span><br><span class="line">    GodMappedStatement godMappedStatement = mappedStatements.get(sqlId);</span><br><span class="line">    Connection connection = transactionManager.getConnection();</span><br><span class="line">    // 获取sql语句</span><br><span class="line">    // insert into t_car(id,car_num,brand,guide_price,produce_time,car_type) values(null,#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">    String godbatisSql = godMappedStatement.getSql();</span><br><span class="line">    // insert into t_car(id,car_num,brand,guide_price,produce_time,car_type) values(null,?,?,?,?,?)</span><br><span class="line">    String sql = godbatisSql.replaceAll(&quot;#\\&#123;[a-zA-Z0-9_\\$]*&#125;&quot;, &quot;?&quot;);</span><br><span class="line"></span><br><span class="line">    // 重点一步</span><br><span class="line">    Map&lt;Integer, String&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">    int index = 1;</span><br><span class="line">    while (godbatisSql.indexOf(&quot;#&quot;) &gt;= 0) &#123;</span><br><span class="line">        int beginIndex = godbatisSql.indexOf(&quot;#&quot;) + 2;</span><br><span class="line">        int endIndex = godbatisSql.indexOf(&quot;&#125;&quot;);</span><br><span class="line">        map.put(index++, godbatisSql.substring(beginIndex, endIndex).trim());</span><br><span class="line">        godbatisSql = godbatisSql.substring(endIndex + 1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    final PreparedStatement ps;</span><br><span class="line">    try &#123;</span><br><span class="line">        ps = connection.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">        // 给?赋值</span><br><span class="line">        map.forEach((k, v) -&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                // 获取java实体类的get方法名</span><br><span class="line">                String getMethodName = &quot;get&quot; + v.toUpperCase().charAt(0) + v.substring(1);</span><br><span class="line">                Method getMethod = obj.getClass().getDeclaredMethod(getMethodName);</span><br><span class="line">                ps.setString(k, getMethod.invoke(obj).toString());</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                throw new RuntimeException(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        int count = ps.executeUpdate();</span><br><span class="line">        ps.close();</span><br><span class="line">        return count;</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        throw new RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">### 第十三步：编写SqlSession类中的selectOne方法</span><br><span class="line">```java</span><br><span class="line">/**</span><br><span class="line"> * 查询一个对象</span><br><span class="line"> * @param sqlId</span><br><span class="line"> * @param parameterObj</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public Object selectOne(String sqlId, Object parameterObj)&#123;</span><br><span class="line">    GodMappedStatement godMappedStatement = mappedStatements.get(sqlId);</span><br><span class="line">    Connection connection = transactionManager.getConnection();</span><br><span class="line">    // 获取sql语句</span><br><span class="line">    String godbatisSql = godMappedStatement.getSql();</span><br><span class="line">    String sql = godbatisSql.replaceAll(&quot;#\\&#123;[a-zA-Z0-9_\\$]*&#125;&quot;, &quot;?&quot;);</span><br><span class="line">    // 执行sql</span><br><span class="line">    PreparedStatement ps = null;</span><br><span class="line">    ResultSet rs = null;</span><br><span class="line">    Object obj = null;</span><br><span class="line">    try &#123;</span><br><span class="line">        ps = connection.prepareStatement(sql);</span><br><span class="line">        ps.setString(1, parameterObj.toString());</span><br><span class="line">        rs = ps.executeQuery();</span><br><span class="line">        if (rs.next()) &#123;</span><br><span class="line">            // 将结果集封装对象，通过反射</span><br><span class="line">            String resultType = godMappedStatement.getResultType();</span><br><span class="line">            Class&lt;?&gt; aClass = Class.forName(resultType);</span><br><span class="line">            Constructor&lt;?&gt; con = aClass.getDeclaredConstructor();</span><br><span class="line">            obj = con.newInstance();</span><br><span class="line">            // 给对象obj属性赋值</span><br><span class="line">            ResultSetMetaData rsmd = rs.getMetaData();</span><br><span class="line">            int columnCount = rsmd.getColumnCount();</span><br><span class="line">            for (int i = 1; i &lt;= columnCount; i++) &#123;</span><br><span class="line">                String columnName = rsmd.getColumnName(i);</span><br><span class="line">                String setMethodName = &quot;set&quot; + columnName.toUpperCase().charAt(0) + columnName.substring(1);</span><br><span class="line">                Method setMethod = aClass.getDeclaredMethod(setMethodName, aClass.getDeclaredField(columnName).getType());</span><br><span class="line">                setMethod.invoke(obj, rs.getString(columnName));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        throw new RuntimeException(e);</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        if (rs != null) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                throw new RuntimeException(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        try &#123;</span><br><span class="line">            ps.close();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return obj;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">## 5.3 GodBatis使用Maven打包</span><br><span class="line">![23B91E36-8138-40bd-960F-685051751FBE.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660206374772-d21754cb-0c5f-4a14-921e-d083b4a791c3.png#averageHue=%233b3f43&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=424&amp;id=ud190761b&amp;originHeight=424&amp;originWidth=489&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=11737&amp;status=done&amp;style=none&amp;taskId=u7b711654-0ab3-40b0-9395-9f98639e6dd&amp;title=&amp;width=489)</span><br><span class="line">查看本地仓库中是否已经有jar包：</span><br><span class="line">![089FD2B9-D3F2-4f62-9A64-2EC66CC8B623.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660206446577-20e8dd84-6b05-48c8-a693-cb0dadfb7979.png#averageHue=%23fbf5f5&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=232&amp;id=u0ec7ef39&amp;originHeight=232&amp;originWidth=497&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=8571&amp;status=done&amp;style=none&amp;taskId=ub79cbd13-af08-4c00-a5be-feee1bd1563&amp;title=&amp;width=497)</span><br><span class="line">## 5.4 使用GodBatis</span><br><span class="line">使用GodBatis就和使用MyBatis是一样的。</span><br><span class="line">第一步：准备数据库表t_user</span><br><span class="line">![96BB0AE2-0C47-4e24-AF86-E8B875B5B65A.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660206701289-4ed4661b-7c85-4157-b09c-3a7fe5207399.png#averageHue=%23f7f6f6&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=264&amp;id=uef3387dc&amp;originHeight=264&amp;originWidth=796&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=12816&amp;status=done&amp;style=none&amp;taskId=ufd123940-ed51-40c8-a680-18ad7e51c77&amp;title=&amp;width=796)</span><br><span class="line">第二步：创建模块，普通的Java Maven模块：godbatis-test</span><br><span class="line">第三步：引入依赖</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;groupId&gt;com.powernode&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;godbatis-test&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">  &lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;!--godbatis依赖--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.god&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;godbatis&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--mysql--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;8.0.30&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--junit--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;4.13.2&lt;/version&gt;</span><br><span class="line">      &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">  &lt;/dependencies&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;properties&gt;</span><br><span class="line">    &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;</span><br><span class="line">    &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;</span><br><span class="line">  &lt;/properties&gt;</span><br><span class="line">  </span><br><span class="line">&lt;/project&gt;</span><br><span class="line">```</span><br><span class="line">第四步：编写pojo类</span><br><span class="line">```java</span><br><span class="line">package com.powernode.godbatis.pojo;</span><br><span class="line"></span><br><span class="line">public class User &#123;</span><br><span class="line">    private String id;</span><br><span class="line">    private String name;</span><br><span class="line">    private String email;</span><br><span class="line">    private String address;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;User&#123;&quot; +</span><br><span class="line">                &quot;id=&#x27;&quot; + id + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, name=&#x27;&quot; + name + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, email=&#x27;&quot; + email + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, address=&#x27;&quot; + address + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(String id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getEmail() &#123;</span><br><span class="line">        return email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setEmail(String email) &#123;</span><br><span class="line">        this.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getAddress() &#123;</span><br><span class="line">        return address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAddress(String address) &#123;</span><br><span class="line">        this.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public User() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public User(String id, String name, String email, String address) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.email = email;</span><br><span class="line">        this.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">第五步：编写核心配置文件：godbatis-config.xml</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;UNPOOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/powernode&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">        &lt;mappers&gt;</span><br><span class="line">            &lt;mapper resource=&quot;UserMapper.xml&quot;/&gt;</span><br><span class="line">        &lt;/mappers&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line">第六步：编写sql映射文件：UserMapper.xml</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=&quot;user&quot;&gt;</span><br><span class="line">    &lt;insert id=&quot;insertUser&quot;&gt;</span><br><span class="line">        insert into t_user(id,name,email,address) values(#&#123;id&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;address&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">    &lt;select id=&quot;selectUserById&quot; resultType=&quot;com.powernode.godbatis.pojo.User&quot;&gt;</span><br><span class="line">        select * from t_user where id = #&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">第七步：编写测试类</span><br><span class="line">```java</span><br><span class="line">package com.powernode.godbatis.test;</span><br><span class="line"></span><br><span class="line">import com.powernode.godbatis.pojo.User;</span><br><span class="line">import org.god.core.Resources;</span><br><span class="line">import org.god.core.SqlSession;</span><br><span class="line">import org.god.core.SqlSessionFactory;</span><br><span class="line">import org.god.core.SqlSessionFactoryBuilder;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">public class GodBatisTest &#123;</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testInsertUser() throws Exception&#123;</span><br><span class="line">        User user = new User(&quot;1&quot;, &quot;zhangsan&quot;, &quot;zhangsan@1234.com&quot;, &quot;北京大兴区&quot;);</span><br><span class="line">        SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourcesAsStream(&quot;godbatis-config.xml&quot;));</span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        int count = sqlSession.insert(&quot;user.insertUser&quot;, user);</span><br><span class="line">        System.out.println(&quot;插入了几条记录：&quot; + count);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testSelectUserById() throws Exception&#123;</span><br><span class="line">        SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourcesAsStream(&quot;godbatis-config.xml&quot;));</span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        Object user = sqlSession.selectOne(&quot;user.selectUserById&quot;, &quot;1&quot;);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">第八步：运行结果</span><br><span class="line">![4766EF58-0505-4cdb-8539-D3E487D0B40D.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660209177038-ecf701a2-1211-4f0c-b1f6-e2e16c1617d5.png#averageHue=%23333231&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=135&amp;id=u32d04b9b&amp;originHeight=135&amp;originWidth=447&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=7682&amp;status=done&amp;style=none&amp;taskId=u71f55f3d-42b0-4389-bf0f-179229f7aa2&amp;title=&amp;width=447)</span><br><span class="line">![DE9D2710-1999-4ef1-8F7E-822ACB17BF02.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660209186576-54493410-47b7-4496-8007-471473cc6fc6.png#averageHue=%23f3f1f0&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=134&amp;id=u1f31d223&amp;originHeight=134&amp;originWidth=443&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=6439&amp;status=done&amp;style=none&amp;taskId=udddf5f59-e9ac-437d-873d-d900c3aa5b4&amp;title=&amp;width=443)</span><br><span class="line">![CD0A068F-8A77-4ced-B92F-B0CCA2412B3C.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660209193124-908993c5-90d6-4426-a598-7aeac2a6b791.png#averageHue=%238b7760&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=195&amp;id=uee2c9fb1&amp;originHeight=195&amp;originWidth=819&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=12996&amp;status=done&amp;style=none&amp;taskId=u35b9af92-a008-4883-88b5-605a8697d9b&amp;title=&amp;width=819)</span><br><span class="line">## 5.5 总结MyBatis框架的重要实现原理</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=&quot;user&quot;&gt;</span><br><span class="line">  &lt;insert id=&quot;insertUser&quot;&gt;</span><br><span class="line">    insert into t_user(id,name,email,address) values(#&#123;id&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;address&#125;)</span><br><span class="line">  &lt;/insert&gt;</span><br><span class="line">  &lt;select id=&quot;selectUserById&quot; resultType=&quot;com.powernode.godbatis.pojo.User&quot;&gt;</span><br><span class="line">    select id,name,email,address from t_user where id = #&#123;id&#125;</span><br><span class="line">  &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">思考两个问题：</span><br><span class="line"></span><br><span class="line">- 为什么insert语句中 #&#123;&#125; 里填写的必须是属性名？</span><br><span class="line">- 为什么select语句查询结果列名要属性名一致？</span><br><span class="line"></span><br><span class="line">![](https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#averageHue=%23dad8d7&amp;from=url&amp;id=JHMnK&amp;originHeight=152&amp;originWidth=1180&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=)</span><br><span class="line"># 六、在WEB中应用MyBatis（使用MVC架构模式）</span><br><span class="line">**目标：**</span><br><span class="line"></span><br><span class="line">- 掌握mybatis在web应用中怎么用</span><br><span class="line">- mybatis三大对象的作用域和生命周期</span><br><span class="line">- ThreadLocal原理及使用</span><br><span class="line">- 巩固MVC架构模式</span><br><span class="line">- 为学习MyBatis的接口代理机制做准备</span><br><span class="line"></span><br><span class="line">**实现功能：**</span><br><span class="line"></span><br><span class="line">- 银行账户转账</span><br><span class="line"></span><br><span class="line">**使用技术：**</span><br><span class="line"></span><br><span class="line">- HTML + Servlet + MyBatis</span><br><span class="line"></span><br><span class="line">**WEB应用的名称：**</span><br><span class="line"></span><br><span class="line">- bank</span><br><span class="line">## 6.1 需求描述</span><br><span class="line">![9C2CCE44-E51B-4b1a-AD3D-176294F3B463.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660274775552-da896b17-09dd-455a-899e-eb4f36fc0ced.png#averageHue=%23fafaf8&amp;clientId=u01870008-33ee-4&amp;from=paste&amp;height=213&amp;id=ud5c2edc9&amp;originHeight=213&amp;originWidth=497&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=7952&amp;status=done&amp;style=none&amp;taskId=u2c5645cb-8235-46ee-9ba7-b078802b235&amp;title=&amp;width=497)</span><br><span class="line">## 6.2 数据库表的设计和准备数据</span><br><span class="line">![68216368-5BD6-4e0d-A567-5E725A349D0F.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660275027117-dcf9ec03-01fa-4e93-8edb-7e10456ba51f.png#averageHue=%23f6f6f5&amp;clientId=u01870008-33ee-4&amp;from=paste&amp;height=235&amp;id=u823c564f&amp;originHeight=235&amp;originWidth=920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=13719&amp;status=done&amp;style=none&amp;taskId=ua26ee15c-9771-4acb-bef3-aa72e8aa600&amp;title=&amp;width=920)</span><br><span class="line">![EBB28A3F-32BB-431c-9C2C-03A4EB5C8ADF.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660275097707-2621f88d-9c21-4d4e-aa6c-c90e1c6e4e3b.png#averageHue=%23f6f5f4&amp;clientId=u01870008-33ee-4&amp;from=paste&amp;height=153&amp;id=u58e9f113&amp;originHeight=153&amp;originWidth=506&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=7100&amp;status=done&amp;style=none&amp;taskId=ue7979c28-a5e7-4ae3-a693-32d1bcf8818&amp;title=&amp;width=506)</span><br><span class="line">## 6.3 实现步骤</span><br><span class="line">### 第一步：环境搭建</span><br><span class="line"></span><br><span class="line">- IDEA中创建Maven WEB应用（**mybatis-004-web**）</span><br><span class="line"></span><br><span class="line">![B228544B-4646-41fc-BFA1-39B6E8464405.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660275706327-2116fb91-fe1a-449d-bd62-6f15416dba84.png#averageHue=%233d4043&amp;clientId=u01870008-33ee-4&amp;from=paste&amp;height=872&amp;id=ub0eb7faa&amp;originHeight=872&amp;originWidth=1133&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=39856&amp;status=done&amp;style=none&amp;taskId=u161a6991-d0d4-4def-b73e-0f0a48d6a9f&amp;title=&amp;width=1133)</span><br><span class="line"></span><br><span class="line">- IDEA配置Tomcat，这里Tomcat使用10+版本。并部署应用到tomcat。</span><br><span class="line"></span><br><span class="line">![38908B1E-AC59-4ecf-B972-7651AA58023E.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660296669590-e7e4932f-cdfb-4d82-9711-af0ca18bbe81.png#clientId=ueb159dc3-e063-4&amp;from=paste&amp;height=802&amp;id=ufcc208d1&amp;originHeight=802&amp;originWidth=1042&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=35630&amp;status=done&amp;style=none&amp;taskId=uaf0f65ec-da3c-4e15-a203-6397277702e&amp;title=&amp;width=1042)</span><br><span class="line">![9EA5CF36-E282-41d4-B544-1533AD25BB33.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660296712190-729ead72-375d-417f-852a-ef366c38c1c3.png#clientId=ueb159dc3-e063-4&amp;from=paste&amp;height=807&amp;id=uf0e62e86&amp;originHeight=807&amp;originWidth=1049&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=23858&amp;status=done&amp;style=none&amp;taskId=uf5f95120-d65b-4b10-9dcf-10db2430be9&amp;title=&amp;width=1049)</span><br><span class="line"></span><br><span class="line">- 默认创建的maven web应用没有java和resources目录，包括两种解决方案</span><br><span class="line">   - 第一种：自己手动加上。</span><br><span class="line"></span><br><span class="line">![5A0EC4A7-C5EB-4fcb-B74C-2A9B3A147E5B.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660297753549-b90c4f4c-2f8f-404d-9ff7-c350d8cd21e0.png#clientId=ueb159dc3-e063-4&amp;from=paste&amp;height=448&amp;id=u9499e54b&amp;originHeight=448&amp;originWidth=378&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=13734&amp;status=done&amp;style=none&amp;taskId=uba85100e-6099-41c8-909c-b9b59c5efa9&amp;title=&amp;width=378)</span><br><span class="line"></span><br><span class="line">   - 第二种：修改maven-archetype-webapp-1.4.jar中的配置文件</span><br><span class="line"></span><br><span class="line">![508D0561-6CEF-4af4-A243-0CF29B2D748B.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660297555336-bef8649f-7e24-477c-9e0a-e55ed1b009a6.png#clientId=ueb159dc3-e063-4&amp;from=paste&amp;height=303&amp;id=uc2301bdd&amp;originHeight=303&amp;originWidth=776&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=16245&amp;status=done&amp;style=none&amp;taskId=u6e49a14f-1a0e-4c01-97db-b8750ee5ccf&amp;title=&amp;width=776)</span><br><span class="line">![3A2D1F51-98DE-4416-B196-2535C5D26E55.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660297620748-1062587b-feff-472a-a546-e5489aebdbdc.png#clientId=ueb159dc3-e063-4&amp;from=paste&amp;height=262&amp;id=ucbfa4d97&amp;originHeight=262&amp;originWidth=751&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=19674&amp;status=done&amp;style=none&amp;taskId=udd20f8b4-d71b-417f-810a-ce5e9e75ca7&amp;title=&amp;width=751)</span><br><span class="line">![7F5D0F8B-EA3B-4d79-B156-02C0D11BA2E9.png](https://cdn.nlark.com/yuque/0/2022/png/21376908/1660297684026-b50cdd30-80d2-488d-9632-a0a098a3518e.png#clientId=ueb159dc3-e063-4&amp;from=paste&amp;height=405&amp;id=ua8158036&amp;originHeight=405&amp;originWidth=814&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=14535&amp;status=done&amp;style=none&amp;taskId=u735b56bd-0a3a-44c9-b7b5-80dbdab0d78&amp;title=&amp;width=814)</span><br><span class="line"></span><br><span class="line">- web.xml文件的版本较低，可以从tomcat10的样例文件中复制，然后修改</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns=&quot;https://jakarta.ee/xml/ns/jakartaee&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;https://jakarta.ee/xml/ns/jakartaee</span><br><span class="line">                      https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd&quot;</span><br><span class="line">         version=&quot;5.0&quot;</span><br><span class="line">         metadata-complete=&quot;true&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/web-app&gt;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- 删除index.jsp文件，因为我们这个项目不使用JSP。只使用html。</span><br><span class="line">- 确定pom.xml文件中的打包方式是war包，因为是web项目。</span><br><span class="line">- 引入相关依赖</span><br><span class="line">   - 编译器版本修改为17</span><br><span class="line">   - 引入的依赖包括：mybatis，mysql驱动，junit，logback，servlet。</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.powernode&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-004-web&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;packaging&gt;war&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--在maven中显示的名字--&gt;</span><br><span class="line">    &lt;name&gt;mybatis-004-web&lt;/name&gt;</span><br><span class="line">    &lt;url&gt;http://localhost:8080/bank&lt;/url&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!--mybatis依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.5.10&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--mysql驱动依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;8.0.30&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--junit依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.13.2&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--logback依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.11&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--servlet依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;jakarta.servlet&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jakarta.servlet-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.0.0&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;finalName&gt;mybatis-004-web&lt;/finalName&gt;</span><br><span class="line">        &lt;pluginManagement&gt;</span><br><span class="line">            &lt;plugins&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-clean-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;3.1.0&lt;/version&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;3.0.2&lt;/version&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;3.8.0&lt;/version&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;2.22.1&lt;/version&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;3.2.2&lt;/version&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-install-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;2.5.2&lt;/version&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-deploy-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;2.8.2&lt;/version&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">            &lt;/plugins&gt;</span><br><span class="line">        &lt;/pluginManagement&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">&lt;/project&gt;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- 引入相关配置文件，放到resources目录下（全部放到类的根路径下）</span><br><span class="line">   - mybatis-config.xml</span><br><span class="line">   - AccountMapper.xml</span><br><span class="line">   - logback.xml</span><br><span class="line">   - jdbc.properties</span><br><span class="line">```properties</span><br><span class="line">jdbc.driver=com.mysql.cj.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://localhost:3306/powernode</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=root</span><br><span class="line">```</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties resource=&quot;jdbc.properties&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;$&#123;jdbc.driver&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;!--一定要注意这里的路径哦！！！--&gt;</span><br><span class="line">        &lt;mapper resource=&quot;AccountMapper.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=&quot;account&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">### 第二步：前端页面index.html</span><br><span class="line">```html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;银行账户转账&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!--/bank是应用的根，部署web应用到tomcat的时候一定要注意这个名字--&gt;</span><br><span class="line">&lt;form action=&quot;/bank/transfer&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    转出账户：&lt;input type=&quot;text&quot; name=&quot;fromActno&quot;/&gt;&lt;br&gt;</span><br><span class="line">    转入账户：&lt;input type=&quot;text&quot; name=&quot;toActno&quot;/&gt;&lt;br&gt;</span><br><span class="line">    转账金额：&lt;input type=&quot;text&quot; name=&quot;money&quot;/&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;转账&quot;/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">```</span><br><span class="line">### 第三步：创建pojo包、service包、dao包、web包、utils包</span><br><span class="line"></span><br><span class="line">- com.powernode.bank.pojo</span><br><span class="line">- com.powernode.bank.service</span><br><span class="line">- com.powernode.bank.service.impl</span><br><span class="line">- com.powernode.bank.dao</span><br><span class="line">- com.powernode.bank.dao.impl</span><br><span class="line">- com.powernode.bank.web.controller</span><br><span class="line">- com.powernode.bank.exception</span><br><span class="line">- com.powernode.bank.utils：**将之前编写的SqlSessionUtil工具类拷贝到该包下。**</span><br><span class="line">### 第四步：定义pojo类：Account</span><br><span class="line">```java</span><br><span class="line">package com.powernode.bank.pojo;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 银行账户类</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class Account &#123;</span><br><span class="line">    private Long id;</span><br><span class="line">    private String actno;</span><br><span class="line">    private Double balance;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Account&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, actno=&#x27;&quot; + actno + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, balance=&quot; + balance +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Account() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Account(Long id, String actno, Double balance) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.actno = actno;</span><br><span class="line">        this.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(Long id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getActno() &#123;</span><br><span class="line">        return actno;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setActno(String actno) &#123;</span><br><span class="line">        this.actno = actno;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Double getBalance() &#123;</span><br><span class="line">        return balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBalance(Double balance) &#123;</span><br><span class="line">        this.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">### 第五步：编写AccountDao接口，以及AccountDaoImpl实现类</span><br><span class="line">分析dao中至少要提供几个方法，才能完成转账：</span><br><span class="line"></span><br><span class="line">- 转账前需要查询余额是否充足：selectByActno</span><br><span class="line">- 转账时要更新账户：update</span><br><span class="line">```java</span><br><span class="line">/**</span><br><span class="line"> * 账户数据访问对象</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public interface AccountDao &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据账号获取账户信息</span><br><span class="line">     * @param actno 账号</span><br><span class="line">     * @return 账户信息</span><br><span class="line">     */</span><br><span class="line">    Account selectByActno(String actno);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 更新账户信息</span><br><span class="line">     * @param act 账户信息</span><br><span class="line">     * @return 1表示更新成功，其他值表示失败</span><br><span class="line">     */</span><br><span class="line">    int updateByActno(Account act);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">```java</span><br><span class="line">public class AccountDaoImpl implements AccountDao &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public Account selectByActno(String actno) &#123;</span><br><span class="line">        SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">        Account acconut = (Account)sqlSession.selectOne(&quot;account.selectByActno&quot;, actno);</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        return acconut;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int update(Account act) &#123;</span><br><span class="line">        SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">        int count = sqlSession.update(&quot;account.updateByActno&quot;, act);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        return count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">### 第六步：AccountDaoImpl中编写了mybatis代码，需要编写SQL映射文件了</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=&quot;account&quot;&gt;</span><br><span class="line">    &lt;select id=&quot;selectByActno&quot; resultType=&quot;com.powernode.bank.pojo.Account&quot;&gt;</span><br><span class="line">        select * from t_act where actno = #&#123;actno&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    &lt;update id=&quot;updateByActno&quot;&gt;</span><br><span class="line">        update t_act set balance = #&#123;balance&#125; where actno = #&#123;actno&#125;</span><br><span class="line">    &lt;/update&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">AccountServlet</span><br><span class="line"></span><br><span class="line">~~~java</span><br><span class="line">@WebServlet(&quot;/transfer&quot;)</span><br><span class="line">public class AccountServlet extends HttpServlet &#123;</span><br><span class="line"></span><br><span class="line">    //为了让这个对象在其他方法中也可以用。声明为实例变量。</span><br><span class="line">	private AccountService accountService = new AccountServiceImpl();</span><br><span class="line">    </span><br><span class="line">	@0verride</span><br><span class="line">	protected void doPost(HttpServletRequest request, HttpServletResponse response)</span><br><span class="line">		throws ServletException,I0Exception &#123;</span><br><span class="line">	//获取表单数据</span><br><span class="line">	String fromActno =request.getParameter(&quot;fromActno&quot;);</span><br><span class="line">	String toActno =request.getParameter(&quot;toActno&quot;);</span><br><span class="line">	double money = Double.parseDouble(request.getParameter(&quot;money&quot;));</span><br><span class="line">	try &#123;</span><br><span class="line">		// 调用service的转账方法完成转账。(调业务层)</span><br><span class="line">		accountService.transfer(fromActno,toActno,money);</span><br><span class="line">		//程序能够走到这里，表示转账一定成功了。</span><br><span class="line">		//调用view完成展示结果。</span><br><span class="line">        response.sendRedirect(request.getContextPath() + &quot;/success.html&quot;);</span><br><span class="line">		&#125; catch(MoneyNotEnoughException e) &#123;</span><br><span class="line">        response.sendRedirect(request.getContextPath() + &quot;/error1.html&quot;);</span><br><span class="line">    &#125;catch(TransferException e)&#123;</span><br><span class="line">        response.sendRedirect(request.getContextPath() + &quot;/error2.html&quot;);</span><br><span class="line">    &#125;catch(Exception e)&#123;</span><br><span class="line">        response.sendRedirect(request.getContextPath() + &quot;/error2.html&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<p>在写完代码测试的时候会出现使用注解但无法访问404的情况，这是因为在web.xml里有个metadata-complete，如果等于true就只支持配置文件，改成false就是注解和配置文件都支持</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;https://jakarta.ee/xml/ns/jakartaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;https://jakarta.ee/xml/ns/jakartaee</span></span></span><br><span class="line"><span class="string"><span class="tag">                      https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;5.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">metadata-complete</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="第七步：编写AccountService接口以及AccountServiceImpl"><a href="#第七步：编写AccountService接口以及AccountServiceImpl" class="headerlink" title="第七步：编写AccountService接口以及AccountServiceImpl"></a>第七步：编写AccountService接口以及AccountServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 余额不足异常</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MoneyNotEnoughException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span>&#123;</span><br><span class="line">    <span class="comment">// 无参和有参</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MoneyNotEnoughException</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MoneyNotEnoughException</span><span class="params">(String msg)</span>&#123; <span class="built_in">super</span>(msg); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 应用异常</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AppException</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AppException</span><span class="params">(String msg)</span>&#123; <span class="built_in">super</span>(msg); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 账户业务类。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 银行账户转正</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fromActno 转出账户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> toActno 转入账户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money 转账金额</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> MoneyNotEnoughException 余额不足异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> AppException App发生异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String fromActno, String toActno, <span class="type">double</span> money)</span> <span class="keyword">throws</span> MoneyNotEnoughException, AppException;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String fromActno, String toActno, <span class="type">double</span> money)</span> <span class="keyword">throws</span> MoneyNotEnoughException, AppException &#123;</span><br><span class="line">        <span class="comment">//1.判断转出账户的余额是否充足(select)</span></span><br><span class="line">        <span class="comment">// 查询转出账户的余额</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">fromAct</span> <span class="operator">=</span> accountDao.selectByActno(fromActno);</span><br><span class="line">        <span class="keyword">if</span> (fromAct.getBalance() &lt; money) &#123;</span><br><span class="line">            <span class="comment">//2.如果转出账户余额不足，提示用户</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MoneyNotEnoughException</span>(<span class="string">&quot;对不起，您的余额不足。&quot;</span>);<span class="comment">//这里的异常不能用try catch，不然就是自己抓自己的异常，直接向上抛</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.如果转出账户余额充足，更新转出账户余额(update)</span></span><br><span class="line">        <span class="comment">// 程序如果执行到这里说明余额充足</span></span><br><span class="line">        <span class="comment">// 修改账户余额  </span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">toAct</span> <span class="operator">=</span> accountDao.selectByActno(toActno);<span class="comment">//转入账户    </span></span><br><span class="line">        fromAct.setBalance(fromAct.getBalance() - money);<span class="comment">//扣钱</span></span><br><span class="line">        toAct.setBalance(toAct.getBalance() + money);<span class="comment">//加钱    </span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> accountDao.updateByActno(fromAct);<span class="comment">//更新账户返回次数    </span></span><br><span class="line">     	<span class="comment">//4.更新转入账户余额(update)     </span></span><br><span class="line">        count += accountDao.updateByActno(toAct);</span><br><span class="line">        <span class="keyword">if</span> (count != <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AppException</span>(<span class="string">&quot;转账失败，未知原因！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="第八步：编写AccountController"><a href="#第八步：编写AccountController" class="headerlink" title="第八步：编写AccountController"></a>第八步：编写AccountController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 账户控制器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/transfer&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AccountService</span> <span class="variable">accountService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountServiceImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 获取响应流</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        <span class="comment">// 获取账户信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fromActno</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fromActno&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">toActno</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;toActno&quot;</span>);</span><br><span class="line">        <span class="type">double</span> <span class="variable">money</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;money&quot;</span>));</span><br><span class="line">        <span class="comment">// 调用业务方法完成转账</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            accountService.transfer(fromActno, toActno, money);</span><br><span class="line">            out.print(<span class="string">&quot;&lt;h1&gt;转账成功！！！&lt;/h1&gt;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MoneyNotEnoughException e) &#123;</span><br><span class="line">            out.print(e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AppException e) &#123;</span><br><span class="line">            out.print(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>启动服务器，打开浏览器，输入地址：<a href="http://localhost:8080/bank%EF%BC%8C%E6%B5%8B%E8%AF%95%EF%BC%9A">http://localhost:8080/bank，测试：</a><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660548722867-8ae16c8b-f25c-4fc7-b0bb-8c8f0c5e546a.png#clientId=u51da7e76-efcd-4&from=paste&height=212&id=ud4e2de74&originHeight=212&originWidth=360&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6719&status=done&style=none&taskId=ue5ff4251-1afb-4f75-ba35-fd159a72ca7&title=&width=360" alt="EDF0C904-B6CB-44bf-9F9F-C69C81AE46A2.png"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660551569099-4d81d8cd-35c5-418f-9de1-74ef8641a59f.png#clientId=u51da7e76-efcd-4&from=paste&height=169&id=u7667d225&originHeight=169&originWidth=439&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5479&status=done&style=none&taskId=u2abd5aea-252a-4cbd-b586-788c0c366ec&title=&width=439" alt="A3F83ADE-1028-49ff-9522-8595D857A421.png"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660551655159-a814927f-dba4-4d81-b6a8-93bdc8511e79.png#clientId=u51da7e76-efcd-4&from=paste&height=149&id=u93944e5c&originHeight=149&originWidth=423&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6303&status=done&style=none&taskId=u5029ee77-68b5-4744-9247-d7c04260a8e&title=&width=423" alt="5364CDC3-DF1A-4380-8A11-DBA050A17A77.png"></p>
<h2 id="6-4-MyBatis对象作用域以及事务问题"><a href="#6-4-MyBatis对象作用域以及事务问题" class="headerlink" title="6.4 MyBatis对象作用域以及事务问题"></a>6.4 MyBatis对象作用域以及事务问题</h2><h3 id="MyBatis核心对象的作用域"><a href="#MyBatis核心对象的作用域" class="headerlink" title="MyBatis核心对象的作用域"></a>MyBatis核心对象的作用域</h3><h4 id="SqlSessionFactoryBuilder"><a href="#SqlSessionFactoryBuilder" class="headerlink" title="SqlSessionFactoryBuilder"></a>SqlSessionFactoryBuilder</h4><p>这个类可以被实例化、使用和丢弃，<strong>一旦创建</strong>了 SqlSessionFactory，<strong>就不再需要</strong>它了。 因此 SqlSessionFactoryBuilder 实例的最佳作用域是方法作用域（也就是局部方法变量）。 你可以重用 SqlSessionFactoryBuilder 来创建多个 SqlSessionFactory 实例，但最好还是不要一直保留着它，以保证所有的 XML 解析资源可以被释放给更重要的事情。</p>
<h4 id="SqlSessionFactory"><a href="#SqlSessionFactory" class="headerlink" title="SqlSessionFactory"></a>SqlSessionFactory</h4><p>SqlSessionFactory 一旦被创建就应该在应用的<strong>运行期间一直存在</strong>，没有任何理由丢弃它或重新创建另一个实例。 使用 SqlSessionFactory 的最佳实践是在应用运行期间不要重复创建多次，多次重建 SqlSessionFactory 被视为一种代码“坏习惯”。因此 SqlSessionFactory 的最佳作用域是应用作用域。 有很多方法可以做到，最简单的就是使用单例模式或者静态单例模式。</p>
<h4 id="SqlSession（保证一个线程对应一个SqlSession）"><a href="#SqlSession（保证一个线程对应一个SqlSession）" class="headerlink" title="SqlSession（保证一个线程对应一个SqlSession）"></a>SqlSession（保证一个线程对应一个SqlSession）</h4><p>每个线程都应该有它自己的 SqlSession 实例。SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域。 绝对不能将 SqlSession 实例的引用放在一个类的静态域，甚至一个类的实例变量也不行。 也绝不能将 SqlSession 实例的引用放在任何类型的托管作用域中，比如 Servlet 框架中的 HttpSession。 如果你现在正在使用一种 Web 框架，考虑将 SqlSession 放在一个和 HTTP 请求相似的作用域中。 换句话说，每次收到 HTTP 请求，就可以打开一个 SqlSession，返回一个响应后，就关闭它。 这个关闭操作很重要，为了确保每次都能执行关闭操作，你应该把这个关闭操作放到 finally 块中。 下面的示例就是一个确保 SqlSession 关闭的标准模式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> sqlSessionFactory.openSession()) &#123;</span><br><span class="line">  <span class="comment">// 你的应用逻辑代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="事务问题"><a href="#事务问题" class="headerlink" title="事务问题"></a>事务问题</h3><p>在之前的转账业务中，更新了两个账户，我们需要保证它们的同时成功或同时失败，这个时候就需要使用事务机制，在transfer方法开始执行时开启事务，直到两个更新都成功之后，再提交事务，我们尝试将transfer方法进行如下修改：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String fromActno, String toActno, <span class="type">double</span> money)</span> <span class="keyword">throws</span> MoneyNotEnoughException, AppException &#123;</span><br><span class="line">        <span class="comment">//1.判断转出账户的余额是否充足(select)</span></span><br><span class="line">        <span class="comment">// 查询转出账户的余额</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">fromAct</span> <span class="operator">=</span> accountDao.selectByActno(fromActno);</span><br><span class="line">        <span class="keyword">if</span> (fromAct.getBalance() &lt; money) &#123;</span><br><span class="line">            <span class="comment">//2.如果转出账户余额不足，提示用户</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MoneyNotEnoughException</span>(<span class="string">&quot;对不起，您的余额不足。&quot;</span>);<span class="comment">//这里的异常不能用try catch，不然就是自己抓自己的异常，直接向上抛</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.如果转出账户余额充足，更新转出账户余额(update)</span></span><br><span class="line">        <span class="comment">// 程序如果执行到这里说明余额充足</span></span><br><span class="line">        <span class="comment">// 修改账户余额  </span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">toAct</span> <span class="operator">=</span> accountDao.selectByActno(toActno);<span class="comment">//转入账户    </span></span><br><span class="line">        fromAct.setBalance(fromAct.getBalance() - money);<span class="comment">//扣钱</span></span><br><span class="line">        toAct.setBalance(toAct.getBalance() + money);<span class="comment">//加钱    </span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> accountDao.updateByActno(fromAct);<span class="comment">//更新账户返回次数  </span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//模拟异常</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        s.toString();</span><br><span class="line">        </span><br><span class="line">     	<span class="comment">//4.更新转入账户余额(update)     </span></span><br><span class="line">        count += accountDao.updateByActno(toAct);</span><br><span class="line">        <span class="keyword">if</span> (count != <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AppException</span>(<span class="string">&quot;转账失败，未知原因！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行前注意看数据库表中当前的数据：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660551655159-a814927f-dba4-4d81-b6a8-93bdc8511e79.png#clientId=u51da7e76-efcd-4&from=paste&height=149&id=WtCgO&originHeight=149&originWidth=423&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6303&status=done&style=none&taskId=u5029ee77-68b5-4744-9247-d7c04260a8e&title=&width=423" alt="5364CDC3-DF1A-4380-8A11-DBA050A17A77.png"><br>执行程序：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660552498799-6c617fed-b94e-4e94-a05b-5fe16a97023e.png#clientId=u51da7e76-efcd-4&from=paste&height=148&id=u612a58c2&originHeight=148&originWidth=357&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5021&status=done&style=shadow&taskId=u17e89280-5123-4a79-a555-1f5daab2af6&title=&width=357" alt="44F99896-3045-4700-BF02-33B0E2CEE73E.png"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660552525960-fb4d555f-09a1-4120-b0b3-73c3eeb2201a.png#clientId=u51da7e76-efcd-4&from=paste&height=107&id=u8c48ae34&originHeight=107&originWidth=341&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3407&status=done&style=shadow&taskId=u2c338a05-4515-4c16-a3e1-177ed51333c&title=&width=341" alt="740BDFDF-1EA7-4134-8867-DEA8AD869800.png"><br>再次查看数据库表中的数据：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660552552430-359a34ff-d869-43a9-b1e3-caa335a4a2f4.png#clientId=u51da7e76-efcd-4&from=paste&height=143&id=u3fe0544c&originHeight=143&originWidth=404&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6070&status=done&style=shadow&taskId=u89d990c9-8e4a-4eab-ac0d-41540f5db22&title=&width=404" alt="A737B160-044F-4511-A4E5-24427A4ADABB.png"><br><strong>傻眼了吧！！！事务出问题了，转账失败了，钱仍然是少了1万。这是什么原因呢？主要是因为service和dao中使用的SqlSession对象不是同一个。</strong><br>怎么办？为了保证service和dao中使用的SqlSession对象是同一个，可以将SqlSession对象存放到ThreadLocal当中。修改SqlSessionUtil工具类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MyBatis工具类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlSessionUtil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 类加载时初始化sqlSessionFactory对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line">            sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 全局的，服务器级别的，一个服务器当中定义一个即可。</span></span><br><span class="line">    <span class="comment">//为什么把SqlSession对象放到ThreadLocal当中呢?为了保证一个线醒对应一个SqlSession。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;SqlSession&gt; local = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 每调用一次openSession()可获取一个新的会话，该会话支持自动提交。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 新的会话对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title function_">openSession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> local.get();</span><br><span class="line">        <span class="keyword">if</span> (sqlSession == <span class="literal">null</span>) &#123;</span><br><span class="line">            sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">            <span class="comment">//将sqlSession对象绑定到当前线程上</span></span><br><span class="line">            local.set(sqlSession);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sqlSession;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭SqlSession对象(从当前线程中移除SqlSession对象。)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sqlSession</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(SqlSession sqlSession)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sqlSession != <span class="literal">null</span>) &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//注意移除SqlSession对象和当前线程的绑定关系。</span></span><br><span class="line">		<span class="comment">//因为Tomcat服务器支持线程池。也就是说:用过的线程对象t1，可能下一次还会使用这个t1线程。</span></span><br><span class="line">        local.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改dao中的方法：AccountDaoImpl中所有方法中的提交commit和关闭close代码全部删除。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">selectByActno</span><span class="params">(String actno)</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.openSession();</span><br><span class="line">        <span class="type">Account</span> <span class="variable">act</span> <span class="operator">=</span> (Account)sqlSession.selectOne(<span class="string">&quot;account.selectByActno&quot;</span>, actno);</span><br><span class="line">        <span class="keyword">return</span> act;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Account act)</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.openSession();</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> sqlSession.update(<span class="string">&quot;account.update&quot;</span>, act);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>修改service中的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String fromActno, String toActno, <span class="type">double</span> money)</span> <span class="keyword">throws</span> MoneyNotEnoughException, AppException &#123;</span><br><span class="line">        <span class="comment">//1.判断转出账户的余额是否充足(select)</span></span><br><span class="line">        <span class="comment">// 查询转出账户的余额</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">fromAct</span> <span class="operator">=</span> accountDao.selectByActno(fromActno);</span><br><span class="line">        <span class="keyword">if</span> (fromAct.getBalance() &lt; money) &#123;</span><br><span class="line">            <span class="comment">//2.如果转出账户余额不足，提示用户</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MoneyNotEnoughException</span>(<span class="string">&quot;对不起，您的余额不足。&quot;</span>);<span class="comment">//这里的异常不能用try catch，不然就是自己抓自己的异常，直接向上抛</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.如果转出账户余额充足，更新转出账户余额(update)</span></span><br><span class="line">        <span class="comment">// 程序如果执行到这里说明余额充足</span></span><br><span class="line">        <span class="comment">// 修改账户余额  </span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">toAct</span> <span class="operator">=</span> accountDao.selectByActno(toActno);<span class="comment">//转入账户    </span></span><br><span class="line">        fromAct.setBalance(fromAct.getBalance() - money);<span class="comment">//扣钱</span></span><br><span class="line">        toAct.setBalance(toAct.getBalance() + money);<span class="comment">//加钱    </span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> accountDao.updateByActno(fromAct);<span class="comment">//更新账户返回次数  </span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//模拟异常</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        s.toString();</span><br><span class="line">        </span><br><span class="line">     	<span class="comment">//4.更新转入账户余额(update)     </span></span><br><span class="line">        count += accountDao.updateByActno(toAct);</span><br><span class="line">        <span class="keyword">if</span> (count != <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AppException</span>(<span class="string">&quot;转账失败，未知原因！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        <span class="comment">//关闭事务</span></span><br><span class="line">        sqlSessionUtil.close(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当前数据库表中的数据：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660552552430-359a34ff-d869-43a9-b1e3-caa335a4a2f4.png#clientId=u51da7e76-efcd-4&from=paste&height=143&id=FEyIx&originHeight=143&originWidth=404&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6070&status=done&style=shadow&taskId=u89d990c9-8e4a-4eab-ac0d-41540f5db22&title=&width=404" alt="A737B160-044F-4511-A4E5-24427A4ADABB.png"><br>再次运行程序：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660552498799-6c617fed-b94e-4e94-a05b-5fe16a97023e.png#clientId=u51da7e76-efcd-4&from=paste&height=148&id=Bvmrx&originHeight=148&originWidth=357&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5021&status=done&style=shadow&taskId=u17e89280-5123-4a79-a555-1f5daab2af6&title=&width=357" alt="44F99896-3045-4700-BF02-33B0E2CEE73E.png"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660552525960-fb4d555f-09a1-4120-b0b3-73c3eeb2201a.png#clientId=u51da7e76-efcd-4&from=paste&height=107&id=Wpypf&originHeight=107&originWidth=341&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3407&status=done&style=shadow&taskId=u2c338a05-4515-4c16-a3e1-177ed51333c&title=&width=341" alt="740BDFDF-1EA7-4134-8867-DEA8AD869800.png"><br>查看数据库表：没有问题。<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660552552430-359a34ff-d869-43a9-b1e3-caa335a4a2f4.png#clientId=u51da7e76-efcd-4&from=paste&height=143&id=DSWAj&originHeight=143&originWidth=404&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6070&status=done&style=shadow&taskId=u89d990c9-8e4a-4eab-ac0d-41540f5db22&title=&width=404" alt="A737B160-044F-4511-A4E5-24427A4ADABB.png"><br>再测试转账成功：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660552498799-6c617fed-b94e-4e94-a05b-5fe16a97023e.png#clientId=u51da7e76-efcd-4&from=paste&height=148&id=F0jzt&originHeight=148&originWidth=357&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5021&status=done&style=shadow&taskId=u17e89280-5123-4a79-a555-1f5daab2af6&title=&width=357" alt="44F99896-3045-4700-BF02-33B0E2CEE73E.png"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660551569099-4d81d8cd-35c5-418f-9de1-74ef8641a59f.png#clientId=u51da7e76-efcd-4&from=paste&height=169&id=v50HW&originHeight=169&originWidth=439&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5479&status=done&style=none&taskId=u2abd5aea-252a-4cbd-b586-788c0c366ec&title=&width=439" alt="A3F83ADE-1028-49ff-9522-8595D857A421.png"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660553732975-bdd952c5-c2c8-4cda-b9f7-810120c66485.png#clientId=u51da7e76-efcd-4&from=paste&height=160&id=ud826500e&originHeight=160&originWidth=371&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5711&status=done&style=shadow&taskId=u320e568e-280d-4989-8f39-fbb02ea4d65&title=&width=371" alt="C8F84292-5B90-4014-A348-A800DD401C86.png"><br>如果余额不足呢：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660553844177-0db1b3c9-3663-4a96-abb0-d516f24c36b8.png#clientId=u51da7e76-efcd-4&from=paste&height=146&id=u8ca8e057&originHeight=146&originWidth=344&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4842&status=done&style=shadow&taskId=u1ad0ec6b-745d-413e-90eb-3dd3f09413e&title=&width=344" alt="7E69C82A-F50C-4a8d-B7FF-579C3AD5750C.png"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660553856988-09e342be-fa3c-4467-9541-d785a08276e9.png#clientId=u51da7e76-efcd-4&from=paste&height=121&id=u968d681a&originHeight=121&originWidth=371&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3600&status=done&style=shadow&taskId=ucf12eb6f-6556-40f6-a8ae-d3ad4d510b7&title=&width=371" alt="F5CFB1B3-72F8-4960-B740-1AD2A076C499.png"><br>账户的余额依然正常：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660553732975-bdd952c5-c2c8-4cda-b9f7-810120c66485.png#clientId=u51da7e76-efcd-4&from=paste&height=160&id=gJxbX&originHeight=160&originWidth=371&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5711&status=done&style=shadow&taskId=u320e568e-280d-4989-8f39-fbb02ea4d65&title=&width=371" alt="C8F84292-5B90-4014-A348-A800DD401C86.png"></p>
<h2 id="6-5-分析当前程序存在的问题"><a href="#6-5-分析当前程序存在的问题" class="headerlink" title="6.5 分析当前程序存在的问题"></a>6.5 分析当前程序存在的问题</h2><p>我们来看一下DaoImpl的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.bank.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.powernode.bank.dao.AccountDao;</span><br><span class="line"><span class="keyword">import</span> com.powernode.bank.pojo.Account;</span><br><span class="line"><span class="keyword">import</span> com.powernode.bank.utils.SqlSessionUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">selectByActno</span><span class="params">(String actno)</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.openSession();</span><br><span class="line">        <span class="type">Account</span> <span class="variable">act</span> <span class="operator">=</span> (Account)sqlSession.selectOne(<span class="string">&quot;account.selectByActno&quot;</span>, actno);</span><br><span class="line">        <span class="keyword">return</span> act;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Account act)</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.openSession();</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> sqlSession.update(<span class="string">&quot;account.update&quot;</span>, act);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>我们不难发现，这个dao实现类中的方法代码很固定，基本上就是一行代码，通过SqlSession对象调用insert、delete、update、select等方法，这个类中的方法没有任何业务逻辑，既然是这样，<strong>这个类我们能不能动态的生成</strong>，以后可以不写这个类吗？答案：可以。<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=BQdc2&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p>
<h1 id="七、使用javassist生成类"><a href="#七、使用javassist生成类" class="headerlink" title="七、使用javassist生成类"></a>七、使用javassist生成类</h1><p>来自百度百科：</p>
<blockquote>
<p>Javassist是一个开源的分析、编辑和创建Java字节码的类库。是由东京工业大学的数学和计算机科学系的 Shigeru Chiba （千叶 滋）所创建的。它已加入了开放源代码JBoss 应用服务器项目，通过使用Javassist对字节码操作为JBoss实现动态”AOP”框架。</p>
</blockquote>
<h2 id="7-1-Javassist的使用"><a href="#7-1-Javassist的使用" class="headerlink" title="7.1 Javassist的使用"></a>7.1 Javassist的使用</h2><p>我们要使用javassist，首先要引入它的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.javassist<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.29.1-GA<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>样例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavassistTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGenerateFirstClass</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//获取类池，这个类池就是用来给我生成class的</span></span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="comment">// 创建类</span></span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> pool.makeClass(<span class="string">&quot;com.powernode.bank.dao.impl.AccountDaoImpl&quot;</span>);</span><br><span class="line">        <span class="comment">// 创建方法（这个老师的看不懂）</span></span><br><span class="line">        <span class="comment">// 1.返回值类型 2.方法名 3.形式参数列表 4.所属类</span></span><br><span class="line">        <span class="comment">//CtMethod ctMethod = new CtMethod(CtClass.voidType, &quot;execute&quot;, new CtClass[]&#123;&#125;, ctClass);</span></span><br><span class="line">        <span class="comment">// 设置方法的修饰符列表</span></span><br><span class="line">        <span class="comment">//ctMethod.setModifiers(Modifier.PUBLIC);</span></span><br><span class="line">        <span class="comment">// 设置方法体</span></span><br><span class="line">        <span class="comment">//ctMethod.setBody(&quot;&#123;System.out.println(\&quot;hello world\&quot;);&#125;&quot;);</span></span><br><span class="line">        <span class="comment">// 给类添加方法</span></span><br><span class="line">        <span class="comment">//ctClass.addMethod(ctMethod);</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 制造方法</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">methodCode</span> <span class="operator">=</span> <span class="string">&quot;public void insert()&#123;System.out.println(123);&#125;&quot;</span>;</span><br><span class="line">		<span class="type">CtMethod</span> <span class="variable">ctMethod</span> <span class="operator">=</span> CtMethod.make(methodcode, ctClass);</span><br><span class="line">		<span class="comment">// 将方法添加到类中</span></span><br><span class="line">		ctClass.addMethod(ctMethod);</span><br><span class="line">		<span class="comment">//在内存中生成class</span></span><br><span class="line">		ctClass.toclass();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//类加载到JVM当中，返回AccountDaoImpl类的字节码</span></span><br><span class="line">		Class&lt;?&gt; clazz = class.forName( cassName: <span class="string">&quot;com.powernode.bank.dao.impl.AccountDaoImpl&quot;</span>);</span><br><span class="line">		<span class="comment">//创建对象</span></span><br><span class="line">		0<span class="type">bject</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.newInstanee();</span><br><span class="line">		<span class="comment">//获取AccountDaoImpl中的insert方法</span></span><br><span class="line">		<span class="type">Method</span> <span class="variable">insertMethod</span> <span class="operator">=</span> clazz.getDeclaredMethod(<span class="string">&quot;insert&quot;</span>);</span><br><span class="line">		<span class="comment">//调用方法insert</span></span><br><span class="line">		insertMethod.invoke(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>运行要注意：加两个参数，要不然会有异常。</p>
<ul>
<li>–add-opens java.base&#x2F;java.lang&#x3D;ALL-UNNAMED</li>
<li>–add-opens java.base&#x2F;sun.net.util&#x3D;ALL-UNNAMED</li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660559749329-9288db13-204c-4354-a5ce-1190f78cb044.png#clientId=u51da7e76-efcd-4&from=paste&height=471&id=ud065408f&originHeight=471&originWidth=726&originalType=binary&ratio=1&rotation=0&showTitle=false&size=27122&status=done&style=shadow&taskId=uda515c55-91cf-4b24-9cb4-aa441c6a74d&title=&width=726" alt="DCBBD517-3C79-456f-817F-DB39E85661D3.png"><br>运行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660559790161-90a4cae2-67be-4827-b981-b28910d9684e.png#clientId=u51da7e76-efcd-4&from=paste&height=163&id=udb225980&originHeight=163&originWidth=378&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8301&status=done&style=shadow&taskId=u0905e524-3949-4d26-ba8f-c4729a4f02e&title=&width=378" alt="B602078D-41E9-4d86-8735-36291B78380F.png"></p>
<h2 id="7-2-使用Javassist生成DaoImpl类"><a href="#7-2-使用Javassist生成DaoImpl类" class="headerlink" title="7.2 使用Javassist生成DaoImpl类"></a>7.2 使用Javassist生成DaoImpl类</h2><p>使用Javassist动态生成DaoImpl类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 工具类：可以动态的生成DAO的实现类。（或者说可以动态生成DAO的代理类）</span></span><br><span class="line"><span class="comment"> * 注意注意注意注意注意！！！！！！：</span></span><br><span class="line"><span class="comment"> *      凡是使用GenerateDaoProxy的，SQLMapper.xml映射文件中namespace必须是dao接口的全名，id必须是dao接口中的方法名。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 动力节点</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenerateDaoProxy</span> &#123; <span class="comment">// GenerateDaoProxy是mybatis框架的开发者写的。mapper那个映射文件是java程序员写的</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成dao接口实现类，并且将实现类的对象创建出来并返回。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> daoInterface dao接口</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> dao接口实现类的实例化对象。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">generate</span><span class="params">(SqlSession sqlSession, Class daoInterface)</span>&#123;<span class="comment">//这里的sqlSession用于动态获取sql语句类型</span></span><br><span class="line">        <span class="comment">// 类池</span></span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="comment">// 制造类(com.powernode.bank.dao.AccountDao --&gt; com.powernode.bank.dao.AccountDaoProxy)</span></span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> pool.makeClass(daoInterface.getName() + <span class="string">&quot;Proxy&quot;</span>); <span class="comment">// 实际本质上就是在内存中动态生成一个代理类。</span></span><br><span class="line">        <span class="comment">// 制造接口</span></span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctInterface</span> <span class="operator">=</span> pool.makeInterface(daoInterface.getName());</span><br><span class="line">        <span class="comment">// 实现接口</span></span><br><span class="line">        ctClass.addInterface(ctInterface);</span><br><span class="line">        <span class="comment">// 实现接口中所有的方法</span></span><br><span class="line">        Method[] methods = daoInterface.getDeclaredMethods();</span><br><span class="line">        Arrays.stream(methods).forEach(method -&gt; &#123;</span><br><span class="line">            <span class="comment">// method是接口中的抽象方法</span></span><br><span class="line">            <span class="comment">// 将method这个抽象方法进行实现</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// Account selectByActno(String actno);</span></span><br><span class="line">                <span class="comment">// public Account selectByActno(String actno)&#123; 代码; &#125;</span></span><br><span class="line">                <span class="type">StringBuilder</span> <span class="variable">methodCode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                methodCode.append(<span class="string">&quot;public &quot;</span>);<span class="comment">// 追加修饰符列表</span></span><br><span class="line">                methodCode.append(method.getReturnType().getName());<span class="comment">// 追加返回值类型</span></span><br><span class="line">                methodCode.append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                methodCode.append(method.getName());<span class="comment">//追加方法名</span></span><br><span class="line">                methodCode.append(<span class="string">&quot;(&quot;</span>);</span><br><span class="line">                <span class="comment">// 需要方法的形式参数列表</span></span><br><span class="line">                Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; parameterTypes.length; i++) &#123;</span><br><span class="line">                    Class&lt;?&gt; parameterType = parameterTypes[i];</span><br><span class="line">                    methodCode.append(parameterType.getName());</span><br><span class="line">                    methodCode.append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                    methodCode.append(<span class="string">&quot;arg&quot;</span> + i);</span><br><span class="line">                    <span class="comment">// 如果不是最后一个就用逗号分隔</span></span><br><span class="line">                    <span class="keyword">if</span>(i != parameterTypes.length - <span class="number">1</span>)&#123;</span><br><span class="line">                        methodCode.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                methodCode.append(<span class="string">&quot;)&quot;</span>);</span><br><span class="line">                methodCode.append(<span class="string">&quot;&#123;&quot;</span>);</span><br><span class="line">                <span class="comment">// 需要方法体当中的代码，这一行是固定不变的，直接拼，但要加包名和全限定名，让javassist知道是哪个</span></span><br><span class="line">                methodCode.append(<span class="string">&quot;org.apache.ibatis.session.SqlSession sqlSession = com.powernode.bank.utils.SqlSessionUtil.openSession();&quot;</span>);</span><br><span class="line">                <span class="comment">// 需要知道是什么类型的sql语句</span></span><br><span class="line">                <span class="comment">// sql语句的id是框架使用者提供的，具有多变性。对于我框架的开发人员来说。我不知道。</span></span><br><span class="line">                <span class="comment">// 既然我框架开发者不知道sqlId，怎么办呢？mybatis框架的开发者于是就出台了一个规定：凡是使用GenerateDaoProxy机制的。</span></span><br><span class="line">                <span class="comment">// sqlId都不能随便写。namespace必须是dao接口的全限定名称。id必须是dao接口中方法名。</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">sqlId</span> <span class="operator">=</span> daoInterface.getName() + <span class="string">&quot;.&quot;</span> + method.getName();</span><br><span class="line">                <span class="comment">//获取sqlsession的&lt;Configuration&gt;标签，然后通过sqlid获取sql，然后再获取类型，返回的是个枚举。判断这个枚举类型对应要执行的功能</span></span><br><span class="line">                <span class="type">SqlCommandType</span> <span class="variable">sqlCommandType</span> <span class="operator">=</span> sqlSession.getConfiguration().getMappedStatement(sqlId).getSqlCommandType();</span><br><span class="line">                <span class="keyword">if</span> (sqlCommandType == SqlCommandType.INSERT) &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (sqlCommandType == SqlCommandType.DELETE) &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (sqlCommandType == SqlCommandType.UPDATE) &#123;</span><br><span class="line">                    methodCode.append(<span class="string">&quot;return sqlSession.update(\&quot;&quot;</span>+sqlId+<span class="string">&quot;\&quot;, arg0);&quot;</span>);<span class="comment">//上面循环拼接的方法名叫arg,所以这里也要统一</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (sqlCommandType == SqlCommandType.SELECT) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">returnType</span> <span class="operator">=</span> method.getReturnType().getName();</span><br><span class="line">                    methodCode.append(<span class="string">&quot;return (&quot;</span>+returnType+<span class="string">&quot;)sqlSession.selectOne(\&quot;&quot;</span>+sqlId+<span class="string">&quot;\&quot;, arg0);&quot;</span>);<span class="comment">//没有强转的话默认返回object，所以要动态强转</span></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 动态的添加return语句，在接口里是有返回类型的，所以没有返回语句编译会报错</span></span><br><span class="line">                <span class="comment">//String returnTypeSimpleName = method.getReturnType().getSimpleName();//简单类名</span></span><br><span class="line">                methodCode.append(<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">                <span class="type">CtMethod</span> <span class="variable">ctMethod</span> <span class="operator">=</span> CtMethod.make(methodCode.toString(), ctClass);</span><br><span class="line">                ctClass.addMethod(ctMethod);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; clazz = ctClass.toClass();</span><br><span class="line">            obj = clazz.newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>凡是使用GenerateDaoProxy机制的。namespace必须是dao接口的全限定名称，id必须是dao接口中的方法名，修改AccountMapper.xml文件：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.bank.dao.AccountDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByActno&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.powernode.bank.pojo.Account&quot;</span>&gt;</span></span><br><span class="line">        select * from t_act where actno = #&#123;actno&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">        update t_act set balance = #&#123;balance&#125; where actno = #&#123;actno&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改service类中获取dao对象的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span>&#123;</span><br><span class="line">    <span class="comment">//private AccountDao accountDao = new AccountDaoImpl();不需要再去获取实现类</span></span><br><span class="line">    <span class="comment">//这个是自己封装的</span></span><br><span class="line">    <span class="comment">//private AccountDao accountDao = (AccountDao)GenerateDaoByJavassist.getMapper(SqlSessionUtil.openSession(), AccountDao.class);通过GenerateDaoByJavassist自动生成</span></span><br><span class="line">    <span class="comment">//在mybatis当中，mybatis提供了相关的机制。也可以动态为我们生成dao接口的实现类。(代理类:dao接口的代理)</span></span><br><span class="line">	<span class="comment">// mybatis当中实际上采用了代理模式。在内存中生成dao接口的代理类，然后创建代理类的实例。</span></span><br><span class="line">    <span class="comment">//使用mybatis的这种代理机制的前提:SqlMapper.xml文件中namespace必须是dao接口的全限定名称，id必须是dao接口中的方法名。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(AccountDao.class);</span><br><span class="line">    和上面的一样，都是通过openSession获取selSession然后用一个类获取映射</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660610966694-3e0ab830-8cd1-41ff-aac6-d973e6b5177d.png#clientId=ub45c156e-c1a9-4&from=paste&height=261&id=uc6e4cad5&originHeight=261&originWidth=1392&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25064&status=done&style=shadow&taskId=u190427bf-b0b2-4aff-89ef-347e0abe5c2&title=&width=1392" alt="0A0D47FC-3EA0-4d39-A715-836AF32DBCAB.png"><br>启动服务器：<strong>启动过程中显示，tomcat服务器自动添加了以下的两个运行参数。所以不需要再单独配置。</strong><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660611357131-c6f21e3e-4c8a-4f72-b519-e635d847f1fd.png#clientId=ub45c156e-c1a9-4&from=paste&height=282&id=uaa202405&originHeight=282&originWidth=1240&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25126&status=done&style=shadow&taskId=ub0612de5-cf15-4d87-a057-f9cf0bd5ecd&title=&width=1240" alt="0A086C8D-1CEF-4413-ACB7-060D1B0687F8.png"><br>测试前数据：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660611193608-b788a3d3-7ed2-4673-aff4-b687d5f20e71.png#clientId=ub45c156e-c1a9-4&from=paste&height=154&id=u63fca44f&originHeight=154&originWidth=363&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5621&status=done&style=shadow&taskId=u430c3d6f-0891-4daa-9c67-2faab82426f&title=&width=363" alt="2B1E7468-040C-4cf1-BD41-C6D64BFD3039.png"><br>打开浏览器测试：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660611220579-a56a8f6c-0416-4d7a-a9f5-cf36a6b8fc9a.png#clientId=ub45c156e-c1a9-4&from=paste&height=176&id=ua117b5de&originHeight=176&originWidth=391&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5327&status=done&style=shadow&taskId=u52a403d3-a9c6-4422-bc30-30ed97b55c0&title=&width=391" alt="032AAA55-80B6-40dd-8666-C6C2045BB788.png"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660611246094-32c692fc-597a-452f-91cf-b0233f9ce020.png#clientId=ub45c156e-c1a9-4&from=paste&height=164&id=u1a494197&originHeight=164&originWidth=420&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7036&status=done&style=shadow&taskId=u94cbabce-810c-478b-841d-2489dfe7f3a&title=&width=420" alt="A9E86E57-0344-43ea-B79C-4C2143151637.png"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660611264464-7f47cce8-0581-496a-b04a-e756eec622df.png#clientId=ub45c156e-c1a9-4&from=paste&height=146&id=u2225a1a4&originHeight=146&originWidth=356&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5435&status=done&style=shadow&taskId=ub2b50040-a142-4d29-b55e-9221502b00b&title=&width=356" alt="4AE10366-C84B-4f56-A474-2ECDE3D974DF.png"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=jJ7KS&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p>
<h1 id="八、MyBatis中接口代理机制及使用"><a href="#八、MyBatis中接口代理机制及使用" class="headerlink" title="八、MyBatis中接口代理机制及使用"></a>八、MyBatis中接口代理机制及使用</h1><p>好消息！！！其实以上所讲内容mybatis内部已经实现了。直接调用以下代码即可获取dao接口的代理类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> (AccountDao)sqlSession.getMapper(AccountDao.class);</span><br></pre></td></tr></table></figure>
<p>使用以上代码的前提是：<strong>AccountMapper.xml文件中的namespace必须和dao接口的全限定名称一致，id必须和dao接口中方法名一致。</strong><br>将service中获取dao对象的代码再次修改，如下：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660611871663-27d92f0e-e0f5-4ab5-9a6e-be949a5b5469.png#clientId=ub45c156e-c1a9-4&from=paste&height=258&id=uacbc0f58&originHeight=258&originWidth=1393&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28138&status=done&style=shadow&taskId=u58d37345-9dcf-4ede-bb15-07306478c14&title=&width=1393" alt="C9B4A2C2-99DD-456b-BE6D-A4F4AD84C876.png"><br>测试前数据：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660611965066-a4188327-2a59-4125-bd2d-0aa40fb8bf3a.png#clientId=ub45c156e-c1a9-4&from=paste&height=103&id=ub78a5ba5&originHeight=103&originWidth=313&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4025&status=done&style=shadow&taskId=ub9d75ead-260f-4574-9962-99d36aa5eb7&title=&width=313" alt="2F131001-B06E-4db9-88D0-10D9F8879D56.png"><br>测试后数据：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660612013927-a1434b4e-ac2c-4ccb-8747-8594a902babc.png#clientId=ub45c156e-c1a9-4&from=paste&height=123&id=u749ef528&originHeight=123&originWidth=328&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4531&status=done&style=shadow&taskId=u157892be-6180-4896-b2dc-ef662fef507&title=&width=328" alt="F6242FE9-51E9-47e5-BA47-5B5049DA374C.png"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=ylFna&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p>
<h1 id="九、MyBatis小技巧"><a href="#九、MyBatis小技巧" class="headerlink" title="九、MyBatis小技巧"></a>九、MyBatis小技巧</h1><h2 id="9-1-和"><a href="#9-1-和" class="headerlink" title="9.1 #{}和${}"></a>9.1 #{}和${}</h2><p>#{}和${}的区别：</p>
<p>#{}：先编译sql语句，再给占位符传值，底层是PreparedStatement实现。可以防止sql注入，比较常用。<br>${}：先进行sql语句拼接，然后再编译sql语句，底层是Statement实现。存在sql注入现象。只有在需要进行sql语句关键字拼接的情况下才会用到。<br>需求：根据car_type查询汽车<br>模块名：mybatis-005-antic</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用#{}"></a>使用#{}</h3><p>CarMapper.xml，放在类的根路径下：<strong>注意namespace必须和接口名一致。id必须和接口中方法名一致</strong>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCarType&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">            id,car_num as carNum,brand,guide_price as guidePrice,produce_time as produceTime,car_type as carType</span><br><span class="line">        from</span><br><span class="line">            t_car</span><br><span class="line">        where</span><br><span class="line">            car_type = #&#123;carType&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.mybatis.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.powernode.mybatis.mapper.CarMapper;</span><br><span class="line"><span class="keyword">import</span> com.powernode.mybatis.pojo.Car;</span><br><span class="line"><span class="keyword">import</span> com.powernode.mybatis.utils.SqlSessionUtil;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CarMapper测试类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByCarType</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> (CarMapper) SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">        List&lt;Car&gt; cars = mapper.selectByCarType(<span class="string">&quot;燃油车&quot;</span>);</span><br><span class="line">        cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660617419624-9c151df7-6c1e-469b-8489-2694009e68b6.png#clientId=ub45c156e-c1a9-4&from=paste&height=350&id=u93c899a2&originHeight=350&originWidth=1651&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43346&status=done&style=shadow&taskId=u2520d823-0c81-4691-9dc1-73721cda9c7&title=&width=1651" alt="5EDAF14B-4BC2-4ad1-A204-9AF8CAF39557.png"><br>通过执行可以清楚的看到，sql语句中是带有 ? 的，这个 ? 就是大家在JDBC中所学的占位符，专门用来接收值的。<br>把“燃油车”以String类型的值，传递给 ?<br>这就是 #{}，它会先进行sql语句的预编译，然后再给占位符传值</p>
<h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用${}"></a>使用${}</h3><p>同样的需求，我们使用${}来完成<br>CarMapper.xml文件修改如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCarType&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">            id,car_num as carNum,brand,guide_price as guidePrice,produce_time as produceTime,car_type as carType</span><br><span class="line">        from</span><br><span class="line">            t_car</span><br><span class="line">        where</span><br><span class="line">            <span class="comment">&lt;!--car_type = #&#123;carType&#125;--&gt;</span></span><br><span class="line">            car_type = $&#123;carType&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>再次运行测试程序：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660617746157-bdb389c7-5752-42f7-a023-c0b8792cf604.png#clientId=ub45c156e-c1a9-4&from=paste&height=267&id=uae71a1bc&originHeight=267&originWidth=1159&originalType=binary&ratio=1&rotation=0&showTitle=false&size=41737&status=done&style=shadow&taskId=u24448be4-f1e4-4dc3-b5f5-ff70c61a321&title=&width=1159" alt="F8DB6119-8032-47f2-941F-ECCD4B9B5ABF.png"><br>出现异常了，这是为什么呢？看看生成的sql语句：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660617813209-5e0d9395-452b-42ed-bee2-816d41f17c30.png#clientId=ub45c156e-c1a9-4&from=paste&height=205&id=ub9b192c4&originHeight=205&originWidth=1636&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23089&status=done&style=shadow&taskId=uc78e2b97-b19c-4334-9de1-a12f7ab44cf&title=&width=1636" alt="A978AA37-AED0-4576-8BA9-9F63ED9ECF81.png"></p>
<p>很显然，${} 是先进行sql语句的拼接，然后再编译，出现语法错误是正常的，因为 燃油车 是一个字符串，在sql语句中应该添加单引号<br>这是#{}的sql语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Preparing: select id, car_num as carNum, brand, guide_price as guidePrice, produce_time as produceTime, car_type as carType from t_car where car_type = ?</span><br><span class="line">Parameters:新能源(String)</span><br></pre></td></tr></table></figure>

<p>这是${}的sql语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Preparing:select id, car_num as carNum, brand, guide_price as guidePrice, produce_time as produceTime, car_type as car_Type from t_car where car_type = 新能源</span><br><span class="line">Parameters :</span><br></pre></td></tr></table></figure>

<h3 id="什么情况下必须使用"><a href="#什么情况下必须使用" class="headerlink" title="什么情况下必须使用${}"></a>什么情况下必须使用${}</h3><p>当需要进行sql语句关键字拼接的时候。必须使用${}<br>需求：通过向sql语句中注入asc或desc关键字，来完成数据的升序或降序排列。</p>
<ul>
<li><strong>先使用#{}尝试：</strong></li>
</ul>
<p>CarMapper接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有的Car</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ascOrDesc asc或desc</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectAll</span><span class="params">(String ascOrDesc)</span>;</span><br></pre></td></tr></table></figure>
<p>CarMapper.xml文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">  id,car_num as carNum,brand,guide_price as guidePrice,produce_time as produceTime,car_type as carType</span><br><span class="line">  from</span><br><span class="line">  t_car</span><br><span class="line">  order by carNum #&#123;key&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAll</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> (CarMapper) SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectAll(<span class="string">&quot;desc&quot;</span>);</span><br><span class="line">    cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660619431786-c9ac3a1d-c9f7-494f-bfe3-496ce4beb914.png#clientId=ub45c156e-c1a9-4&from=paste&height=457&id=ucadbc85e&originHeight=457&originWidth=1647&originalType=binary&ratio=1&rotation=0&showTitle=false&size=55571&status=done&style=shadow&taskId=ub8101801-cb14-4323-bf76-530acda8b5c&title=&width=1647" alt="9F39C1BA-BFB5-4482-8859-A665AF9BB4F5.png"><br>报错的原因是sql语句不合法，因为采用这种方式传值，最终sql语句会是这样：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,car_num <span class="keyword">as</span> carNum,brand,guide_price <span class="keyword">as</span> guidePrice,produce_time <span class="keyword">as</span> produceTime,car_type <span class="keyword">as</span> carType <span class="keyword">from</span> t_car <span class="keyword">order</span> <span class="keyword">by</span> carNum <span class="string">&#x27;desc&#x27;</span></span><br></pre></td></tr></table></figure>

<p>desc是一个关键字，不能带单引号的，所以在进行sql语句关键字拼接的时候，必须使用${}</p>
<ul>
<li><strong>使用${} 改造</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">  id,car_num as carNum,brand,guide_price as guidePrice,produce_time as produceTime,car_type as carType</span><br><span class="line">  from</span><br><span class="line">  t_car</span><br><span class="line">  <span class="comment">&lt;!--order by carNum #&#123;key&#125;--&gt;</span></span><br><span class="line">  order by carNum $&#123;key&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>再次执行测试程序：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660619635336-168c3097-fe96-49aa-b855-d111f5f6e66d.png#clientId=ub45c156e-c1a9-4&from=paste&height=388&id=u310de771&originHeight=388&originWidth=1653&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46770&status=done&style=shadow&taskId=ud013f125-0797-4793-820c-605c609efe0&title=&width=1653" alt="BD556528-B6C2-4842-A776-37B26B3B0F43.png"></p>
<h3 id="拼接表名"><a href="#拼接表名" class="headerlink" title="拼接表名"></a>拼接表名</h3><p>业务背景：实际开发中，有的表数据量非常庞大，可能会采用分表方式进行存储，比如每天生成一张表，表的名字与日期挂钩，例如：2022年8月1日生成的表：t_user20220108。2000年1月1日生成的表：t_user20000101。此时前端在进行查询的时候会提交一个具体的日期，比如前端提交的日期为：2000年1月1日，那么后端就会根据这个日期动态拼接表名为：t_user20000101。有了这个表名之后，将表名拼接到sql语句当中，返回查询结果。那么大家思考一下，拼接表名到sql语句当中应该使用#{} 还是 ${} 呢？<br>使用#{}会是这样：select * from ‘t_car’<br>使用${}会是这样：select * from t_car</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllByTableName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">  id,car_num as carNum,brand,guide_price as guidePrice,produce_time as produceTime,car_type as carType</span><br><span class="line">  from</span><br><span class="line">  $&#123;tableName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据表名查询所有的Car</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tableName</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectAllByTableName</span><span class="params">(String tableName)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAllByTableName</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectAllByTableName(<span class="string">&quot;t_car&quot;</span>);</span><br><span class="line">    cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660798482963-16baeed4-cd22-4a0e-a631-6f49ee9f101b.png#clientId=u85e451ff-5650-4&from=paste&height=364&id=u47cf528d&originHeight=364&originWidth=1455&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34247&status=done&style=shadow&taskId=u38eb2b5f-ed66-4859-adab-e6b9419b805&title=&width=1455" alt="28B639CD-FD3B-43bb-AB56-6130419BBAA1.png"></p>
<h3 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h3><p>业务背景：一次删除多条记录。<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660799087155-ec264d4c-cafa-458d-85b9-f18b4c34bafd.png#clientId=u85e451ff-5650-4&from=paste&height=134&id=u6e9cb5be&originHeight=134&originWidth=228&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2335&status=done&style=shadow&taskId=u87c4a40d-2b79-4042-afd3-23d8d331e8c&title=&width=228" alt="BF64FC68-5697-4695-AD2A-8D32297AED66.png"><br>对应的sql语句：</p>
<ul>
<li>delete from t_user where id &#x3D; 1 or id &#x3D; 2 or id &#x3D; 3;这个后面动态sql会讲</li>
<li>delete from t_user where id in(1, 2, 3);</li>
</ul>
<p>假设现在使用in的方式处理，前端传过来的字符串：1, 2, 3<br>如果使用mybatis处理，应该使用#{} 还是 ${}<br>使用#{} ：delete from t_user where id in(‘1,2,3’) <strong>执行错误：1292 - Truncated incorrect DOUBLE value: ‘1,2,3’</strong><br>使用${} ：delete from t_user where id in(1, 2, 3)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id批量删除</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteBatch</span><span class="params">(String ids)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteBatch&quot;</span>&gt;</span></span><br><span class="line">  delete from t_car where id in($&#123;ids&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteBatch</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> mapper.deleteBatch(<span class="string">&quot;1,2,3&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;删除了几条记录：&quot;</span> + count);</span><br><span class="line">    SqlSessionUtil.openSession().commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660803646232-44b4c7ca-119d-45ce-83c1-aefa2e3c6255.png#clientId=u85e451ff-5650-4&from=paste&height=204&id=u01e063bc&originHeight=204&originWidth=903&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25296&status=done&style=shadow&taskId=u9f1f14c4-efca-437a-ab08-6ec4d388eef&title=&width=903" alt="79F7AB85-F3CA-4c27-873C-CCCDA3D75779.png"></p>
<h3 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h3><p>需求：查询奔驰系列的汽车。【只要品牌brand中含有奔驰两个字的都查询出来。实现下面的这种语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_car <span class="keyword">where</span> brand <span class="keyword">like</span> <span class="string">&#x27;%奔驰%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据品牌进行模糊查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likeBrank</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectLikeByBrand</span><span class="params">(String likeBrank)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectLikeByBrand</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectLikeByBrand(<span class="string">&quot;奔驰&quot;</span>);</span><br><span class="line">    cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectLikeByBrand&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">  id,car_num as carNum,brand,guide_price as guidePrice,produce_time as produceTime,car_type as carType</span><br><span class="line">  from</span><br><span class="line">  t_car</span><br><span class="line">  where</span><br><span class="line">  brand like &#x27;%#&#123;brand&#125;%&#x27;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用这个会报错，因为传到jdbc里会变成brand like ‘%?%’，只有单个?才是占位符，如果在单引号里面就不是占位符了</p>
<p>第一种方案:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;%$&#123;brand&#125;%&#x27;</span></span><br></pre></td></tr></table></figure>

<p>第二种方案:concat函数，这个是mysql数据库当中的一个函数，专门进行字符串拼接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">concat(<span class="string">&#x27;%&#x27;</span>,#&#123;brand&#125;,<span class="string">&#x27;%&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>第三种方案:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">concat(<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;$&#123;brand&#125;&#x27;</span>,<span class="string">&#x27;%&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>第四种方案:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;%&quot;#&#123;brand&#125;&quot;%&quot;</span><br></pre></td></tr></table></figure>

<h2 id="9-2-typeAliases（起别名）"><a href="#9-2-typeAliases（起别名）" class="headerlink" title="9.2 typeAliases（起别名）"></a>9.2 typeAliases（起别名）</h2><p>namespace不可以起别名，必须全限定接口名</p>
<p>别名不区分大小写</p>
<p>我们来观察一下CarMapper.xml中的配置信息：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">            id,car_num as carNum,brand,guide_price as guidePrice,produce_time as produceTime,car_type as carType</span><br><span class="line">        from</span><br><span class="line">            t_car</span><br><span class="line">        order by carNum $&#123;key&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>resultType属性用来指定查询结果集的封装类型，这个名字可以起别名<br>在mybatis-config.xml文件中使用typeAliases标签来起别名，包括两种方式：</p>
<h3 id="第一种方式：typeAlias"><a href="#第一种方式：typeAlias" class="headerlink" title="第一种方式：typeAlias"></a>第一种方式：typeAlias</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.powernode.mybatis.pojo.Car&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;Car&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>首先要注意typeAliases标签的放置位置，如果不清楚的话，可以看看错误提示信息。</li>
<li>typeAliases标签中的typeAlias可以写多个。</li>
<li>typeAlias：<ul>
<li>type属性：指定给哪个类起别名</li>
<li>alias属性：指定别名。<ul>
<li>alias属性不是必须的，如果缺省的话，type属性指定的类型名的简类名作为别名。</li>
<li>alias是大小写不敏感的。也就是说假设alias&#x3D;”Car”，再用的时候，可以CAR，也可以car，也可以Car，都行。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="第二种方式：package"><a href="#第二种方式：package" class="headerlink" title="第二种方式：package"></a>第二种方式：package</h3><p>如果一个包下的类太多，每个类都要起别名，会导致typeAlias标签配置较多，所以mybatis用提供package的配置方式，只需要指定包名，该包下的所有类都自动起别名，别名就是简类名。并且别名不区分大小写。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.powernode.mybatis.pojo&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>package也可以配置多个的。</p>
<h2 id="9-3-mappers"><a href="#9-3-mappers" class="headerlink" title="9.3 mappers"></a>9.3 mappers</h2><p>SQL映射文件的配置方式包括以下四种：</p>
<h3 id="resource"><a href="#resource" class="headerlink" title="resource"></a>resource</h3><p>这种方式是从类的根路径下开始査找资源。采用这种方式的话，你的配置文件需要放到类路径当中才行。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;CarMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">要求类的根路径下必须有:CarMapper.xml</span><br></pre></td></tr></table></figure>
<h3 id="url"><a href="#url" class="headerlink" title="url"></a>url</h3><p>这种方式显然使用了绝对路径的方式，这种配置对SQL映射文件存放的位置没有要求，随意，但是可移植性差。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///d:/carMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">要求在d:/下有CarMapper.xml文件</span><br></pre></td></tr></table></figure>
<h3 id="class"><a href="#class" class="headerlink" title="class"></a>class</h3><p>这个位置提供的是mapper接口的全限定接口名，必须带有包名的。</p>
<p>思考:mapper标签的作用是指定SqlMapper.xm文件的路径，指定接口名有什么用呢?</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果你class指定是:com.powernode.mybatis.mapper.CarMapper</p>
<p>那么mybatis框架会自动去com&#x2F;powernode&#x2F;mybatis&#x2F;mapper目录下査找carMapper.xml文件。<br>注意:也就是说:如果你采用这种方式，那么你必须保证CarMapper.xml文件和CarMapper接口必须在同一个目录下。并且名字一致。<br>	CarMapper接口-&gt; CarMapper.xml<br>	LogMapper接口-&gt;LogMapper.xml</p>
<p>如果使用这种方式必须满足以下条件：</p>
<ul>
<li>SQL映射文件和mapper接口放在同一个目录下。</li>
<li>SQL映射文件的名字也必须和mapper接口名一致。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;全限定接口名，带有包名&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>将CarMapper.xml文件移动到和mapper接口同一个目录下：</p>
<ul>
<li><p>在resources目录下新建多重目录的话，必须是这样创建：</p>
<p>com&#x2F;powernode&#x2F;mybatis&#x2F;mapper，不能com.powernode.mybatis.mapper</p>
</li>
<li><p>将CarMapper.xml文件移动到mapper目录下</p>
</li>
<li><p>修改mybatis-config.xml文件</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="package"><a href="#package" class="headerlink" title="package"></a>package</h3><p>如果class较多，可以使用这种package的方式，但前提条件和上一种方式一样。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这种方式在实际开发中是使用的。--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--前提是:XML文件必须和接口放在一起。并且名字一致。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.powernode.mybatis.mapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="9-4-idea配置文件模板"><a href="#9-4-idea配置文件模板" class="headerlink" title="9.4 idea配置文件模板"></a>9.4 idea配置文件模板</h2><p>mybatis-config.xml和SqlMapper.xml文件可以在IDEA中提前创建好模板，以后通过模板创建配置文件。(右击创建时会显示)<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660629382298-df2d0e70-d8ce-4ae6-9f19-e74923adf121.png#averageHue=%233f4446&clientId=ub45c156e-c1a9-4&from=paste&height=714&id=u9b816dcf&originHeight=714&originWidth=978&originalType=binary&ratio=1&rotation=0&showTitle=false&size=71664&status=done&style=shadow&taskId=u4da55a51-2eb8-4e43-aca9-e22026a87cc&title=&width=978" alt="7ABBEF88-D7E3-4a73-8411-61CCA49CC3E3.png"></p>
<h2 id="9-5-插入数据时获取自动生成的主键"><a href="#9-5-插入数据时获取自动生成的主键" class="headerlink" title="9.5 插入数据时获取自动生成的主键"></a>9.5 插入数据时获取自动生成的主键</h2><p>前提是：主键是自动生成的。<br>业务背景：一个用户有多个角色。<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660808179627-69b14158-fbd4-4189-83cf-aa944fe26fa1.png#averageHue=%23f2f2f2&clientId=u85e451ff-5650-4&from=paste&height=419&id=u00f52746&originHeight=419&originWidth=455&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7321&status=done&style=shadow&taskId=u791be7e5-7ee8-4f58-bf42-1357324a865&title=&width=455" alt="E9F189EB-F5E2-465f-828C-127DB34968FE.png"><br>插入一条新的记录之后，自动生成了主键，而这个主键需要在其他表中使用时。<br>插入一个用户数据的同时需要给该用户分配角色：需要将生成的用户的id插入到角色表的user_id字段上。<br>第一种方式：可以先插入用户数据，再写一条查询语句获取id，然后再插入user_id字段。【比较麻烦】<br>第二种方式：mybatis提供了一种方式更加便捷。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取自动生成的主键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> car</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insertUseGeneratedKeys</span><span class="params">(Car car)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">useGeneratedKeys=&quot;true”使用自动生成的主键值。</span></span><br><span class="line"><span class="comment">keyProperty=&quot;id”指定主键值赋值给对象的哪个属性。这个就表示将主键值赋值给Car对象的id属性。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUseGeneratedKeys&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">  insert into t_car(id,car_num,brand,guide_price,produce_time,car_type) values(null,#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#averageHue=%23dad8d7&clientId=u6b7aa99c-2be4-4&from=paste&id=WQJOd&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p>
<h1 id="十、MyBatis参数处理"><a href="#十、MyBatis参数处理" class="headerlink" title="十、MyBatis参数处理"></a>十、MyBatis参数处理</h1><p>模块名：mybatis-006-param<br>表：t_student<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660634643604-17c32925-3d16-4477-84be-296ef44509a0.png#averageHue=%23f7f6f5&clientId=ub45c156e-c1a9-4&from=paste&height=275&id=fR18k&originHeight=275&originWidth=717&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13614&status=done&style=shadow&taskId=u800b2f44-359b-4d0b-a1fc-0f886c4cb3f&title=&width=717" alt="2F36FCDF-464E-45b5-8F7B-09AB6B378457.png"><br>表中现有数据：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660635212357-e422625b-d176-4189-ad30-7b9dad1b5dd9.png#averageHue=%23f5f4f3&clientId=ub45c156e-c1a9-4&from=paste&height=161&id=ud51ffba3&originHeight=161&originWidth=559&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8699&status=done&style=shadow&taskId=u2549c831-34cc-4804-bd8d-50235ffafa3&title=&width=559" alt="9A19F542-3229-4b71-B1B7-E2318489C588.png"><br>pojo类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.mybatis.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 学生类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Double height;</span><br><span class="line">    <span class="keyword">private</span> Character sex;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="comment">// constructor</span></span><br><span class="line">    <span class="comment">// setter and getter</span></span><br><span class="line">    <span class="comment">// toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10-1-单个简单类型参数"><a href="#10-1-单个简单类型参数" class="headerlink" title="10.1 单个简单类型参数"></a>10.1 单个简单类型参数</h2><p>简单类型包括：</p>
<ul>
<li>byte short int long float double char</li>
<li>Byte Short Integer Long Float Double Character</li>
<li>String</li>
<li>java.util.Date</li>
<li>java.sql.Date</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当接口中的方法的参数只有一个(单个参数)，并且参数的数据类型都是简单类型</span></span><br><span class="line"><span class="comment"> * 根据id査询、name査询、birth査询、sex査询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据name查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Student&gt; <span class="title function_">selectByName</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Student <span class="title function_">selectById</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据birth查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> birth</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Student&gt; <span class="title function_">selectByBirth</span><span class="params">(Date birth)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据sex查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Student&gt; <span class="title function_">selectBySex</span><span class="params">(Character sex)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(StudentMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByName</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Student&gt; students = mapper.selectByName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        students.forEach(student -&gt; System.out.println(student));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectById</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> mapper.selectById(<span class="number">2L</span>);</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByBirth</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Date</span> <span class="variable">birth</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>).parse(<span class="string">&quot;2022-08-16&quot;</span>);</span><br><span class="line">            List&lt;Student&gt; students = mapper.selectByBirth(birth);</span><br><span class="line">            students.forEach(student -&gt; System.out.println(student));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectBySex</span><span class="params">()</span>&#123;</span><br><span class="line">    	<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlsessionUtil.openSession();</span><br><span class="line">		<span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">		<span class="comment">//char --&gt; Character传的是char的封装类型Character</span></span><br><span class="line">		<span class="type">Character</span> <span class="variable">sex</span> <span class="operator">=</span> Character.value0f(<span class="string">&#x27;男&#x27;</span>);</span><br><span class="line">		List&lt;Student&gt; students = mapper.selectBySex(sex);</span><br><span class="line">		students.forEach(student -&gt; System.out.println(student));</span><br><span class="line">		sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><input disabled="" type="checkbox"> <pre><code class="language-xml">&lt;mapper namespace=&quot;com.powernode.mybatis.mapper.StudentMapper&quot;&gt;
    &lt;!--parameterType属性的作用:
        告诉mybatis框架，我这个方法的参数类型是什么类型:
        mybatis框架自身带有类型自动推断机制，所以大部分情况下parameterType属性都是可以省略不写的。
        SQL语句最终是这样的:
            select * from t_student where id = ?
        JDBC底层会通过ps.setXxx(第几个问号，传什么值)来传值
--&gt; 
    
    &lt;!--这里直接是student是因为起了别名--&gt;
    &lt;select id=&quot;selectById&quot; resultType=&quot;student&quot; parameterType=&quot;java.lang.Long&quot;&gt;
        select * from t_student where id = #{id}
    &lt;/select&gt;
&lt;/mapper&gt;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 也就是说对于mybatis来说，它是可以自动推断出ps.setXxxx()方法的。ps.setString()还是ps.setInt()。它可以自动推断。</span><br><span class="line"></span><br><span class="line">通过mybatis手册可以看到parameterType也可以简写</span><br><span class="line"></span><br><span class="line">![image-20251206024536756](https://cdn.dreamshelter.cn/NoteImg/mybatis/%E8%80%81%E6%9D%9CMyBatis/image-20251206024536756.png)</span><br><span class="line"></span><br><span class="line">其实SQL映射文件中的配置比较完整的写法是：</span><br><span class="line"></span><br><span class="line">~~~xml</span><br><span class="line">&lt;select id=&quot;selectByName&quot; resultType=&quot;student&quot; parameterType=&quot;java.lang.String&quot;&gt;</span><br><span class="line">  select * from t_student where name = #&#123;name, javaType=String, jdbcType=VARCHAR&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<p>其中sql语句中的javaType是告诉mybatis传过来的值java类型是string，jdbcType是数据库表里的类型是，以及select标签中的parameterType属性，都是用来帮助mybatis进行类型确定的。不过这些配置多数是可以省略的。因为mybatis它有强大的自动类型推断机制。</p>
<ul>
<li>javaType：可以省略</li>
<li>jdbcType：可以省略</li>
<li>parameterType：可以省略</li>
</ul>
<p><strong>如果参数只有一个的话，#{} 里面的内容就随便写了。对于 ${} 来说，注意加单引号。</strong></p>
<h2 id="10-2-Map参数"><a href="#10-2-Map参数" class="headerlink" title="10.2 Map参数"></a>10.2 Map参数</h2><p>需求：根据name和age查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 保存学生信息，通过Map参数。以下是单个参数。但是参数的类型不是简单类型。是Map集合。</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> paramMap</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Student&gt; <span class="title function_">selectByParamMap</span><span class="params">(Map&lt;String,Object&gt; paramMap)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByParamMap</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.openSession();</span><br><span class="line">	<span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">	Map&lt;String,0bject&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">	map.put(<span class="string">&quot;姓名&quot;</span>，<span class="string">&quot;赵六”);</span></span><br><span class="line"><span class="string">	map.put(&quot;</span>年龄”，<span class="number">20</span>);</span><br><span class="line">	map.put(<span class="string">&quot;身高”，1.81);</span></span><br><span class="line"><span class="string">	map.put(&quot;</span>性别”，<span class="string">&#x27;男&#x27;</span>);</span><br><span class="line">	map.put(<span class="string">&quot;生日&quot;</span>，<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">	mapper.insertStudentByMap(map);</span><br><span class="line">	sqlSession.commit();</span><br><span class="line">	sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudentByMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">	insert into t_student(id,name ,age,sex,birth,height) values(null,#&#123;姓补,#&#123;年龄&#125;,#&#123;性别&#125;,#&#123;生日&#125;,#&#123;身高&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试运行正常。<br>**这种方式是手动封装Map集合，将每个条件以key和value的形式存放到集合中。然后在使用的时候通过#{map集合的key}来取值。**里面一定要写key</p>
<h2 id="10-3-实体类参数"><a href="#10-3-实体类参数" class="headerlink" title="10.3 实体类参数"></a>10.3 实体类参数</h2><p>需求：插入一条Student数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存学生数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> student</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insertStudentByPOJO</span><span class="params">(Student student)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">parameterType=&quot;student&quot;省略也可以</span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudentByPOJO&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">  insert into t_student values(null,#&#123;name&#125;,#&#123;age&#125;,#&#123;height&#125;,#&#123;birth&#125;,#&#123;sex&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertStudentByPOJO</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student.setName(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">    student.setAge(<span class="number">30</span>);</span><br><span class="line">    student.setHeight(<span class="number">1.70</span>);</span><br><span class="line">    student.setSex(<span class="string">&#x27;男&#x27;</span>);</span><br><span class="line">    student.setBirth(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> mapper.insert(student);</span><br><span class="line">    SqlSessionUtil.openSession().commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行正常，数据库中成功添加一条数据。<br><strong>这里需要注意的是：#{} 里面写的是属性名字。这个属性名其本质上是：set&#x2F;get方法名去掉set&#x2F;get之后的名字。</strong></p>
<h2 id="10-4-多参数"><a href="#10-4-多参数" class="headerlink" title="10.4 多参数"></a>10.4 多参数</h2><p>需求：通过name和sex查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据name和sex查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sex</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;Student&gt; <span class="title function_">selectByNameAndSex</span><span class="params">(String name, Character sex)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByNameAndSex</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Student&gt; students = mapper.selectByNameAndSex(<span class="string">&quot;张三&quot;</span>, <span class="string">&#x27;女&#x27;</span>);</span><br><span class="line">    students.forEach(student -&gt; System.out.println(student));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByNameAndSex&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">  select * from t_student where name = #&#123;name&#125; and sex = #&#123;sex&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660641021618-ce3ac913-fe10-45f5-9760-3e51ef2dd864.png#clientId=u7e0d60f6-6020-4&from=paste&height=237&id=u010e6c4a&originHeight=237&originWidth=1632&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43805&status=done&style=shadow&taskId=ub6538fa2-2ec6-4a63-b094-3face43e433&title=&width=1632" alt="A386812C-F031-4f63-A6CE-174B7948CA31.png"><br>异常信息描述了：name参数找不到，可用的参数包括[arg1, arg0, param1, param2]<br>修改StudentMapper.xml配置文件：尝试使用[arg1, arg0, param1, param2]去参数</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByNameAndSex&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--select * from t_student where name = #&#123;name&#125; and sex = #&#123;sex&#125;--&gt;</span></span><br><span class="line">  select * from t_student where name = #&#123;arg0&#125; and sex = #&#123;arg1&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>运行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660641284279-64a7312a-d036-448f-aaef-a1bcde8abba2.png#clientId=u7e0d60f6-6020-4&from=paste&height=167&id=u6acb95a5&originHeight=167&originWidth=939&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19111&status=done&style=shadow&taskId=u244175c9-f543-4b21-9060-0e334bd297e&title=&width=939" alt="351B370F-7199-49d2-A54D-E42E668FE96E.png"><br>再次尝试修改StudentMapper.xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByNameAndSex&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--select * from t_student where name = #&#123;name&#125; and sex = #&#123;sex&#125;--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--select * from t_student where name = #&#123;arg0&#125; and sex = #&#123;arg1&#125;--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--select * from t_student where name = #&#123;param1&#125; and sex = #&#123;param2&#125;--&gt;</span></span><br><span class="line">  select * from t_student where name = #&#123;arg0&#125; and sex = #&#123;param2&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过测试可以看到：</p>
<ul>
<li>arg0 是第一个参数</li>
<li>param1是第一个参数</li>
<li>arg1 是第二个参数</li>
<li>param2是第二个参数</li>
</ul>
<p>实现原理：<strong>实际上在mybatis底层会创建一个map集合，以arg0&#x2F;param1为key，以方法上的参数为value</strong>，例如以下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;arg0&quot;</span>, name);</span><br><span class="line">map.put(<span class="string">&quot;arg1&quot;</span>, sex);</span><br><span class="line">map.put(<span class="string">&quot;param1&quot;</span>, name);</span><br><span class="line">map.put(<span class="string">&quot;param2&quot;</span>, sex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 所以可以这样取值：#&#123;arg0&#125; #&#123;arg1&#125; #&#123;param1&#125; #&#123;param2&#125;</span></span><br><span class="line"><span class="comment">// 其本质就是#&#123;map集合的key&#125;</span></span><br></pre></td></tr></table></figure>
<p>注意：<strong>使用mybatis3.4.2之前的版本时：要用#{0}和#{1}这种形式。</strong></p>
<h2 id="10-5-Param注解（命名参数）"><a href="#10-5-Param注解（命名参数）" class="headerlink" title="10.5 @Param注解（命名参数）"></a>10.5 @Param注解（命名参数）</h2><p>可以不用arg0 arg1 param1 param2吗？这个map集合的key我们自定义可以吗？当然可以。使用@Param注解即可。这样可以增强可读性。<br>需求：根据name和age查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据name和age查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> age</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Student&gt; <span class="title function_">selectByNameAndAge</span><span class="params">(<span class="meta">@Param(value=&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;age&quot;)</span> <span class="type">int</span> age)</span>;</span><br><span class="line"><span class="comment">//这里的value也可以省略不写，底层只有一个String value();，写成@Param(&quot;name&quot;)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByNameAndAge</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Student&gt; stus = mapper.selectByNameAndAge(<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    stus.forEach(student -&gt; System.out.println(student));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByNameAndAge&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">  select * from t_student where name = #&#123;name&#125; and age = #&#123;age&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过测试，一切正常。<br>核心：@Param(“<strong>这里填写的其实就是map集合的key</strong>“)</p>
<p>注意：使用了@Param注解之后，arg0和arg1失效，但param1和param2还可以</p>
<h2 id="10-6-Param源码分析"><a href="#10-6-Param源码分析" class="headerlink" title="10.6 @Param源码分析"></a>10.6 @Param源码分析</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660643136419-5851b57a-ae96-4488-bb0c-8864c92771f3.png#clientId=u7e0d60f6-6020-4&from=paste&height=482&id=ue4cbbe91&originHeight=482&originWidth=996&originalType=binary&ratio=1&rotation=0&showTitle=false&size=70211&status=done&style=shadow&taskId=u01c71bab-74f0-4620-bf10-2779e9b2164&title=&width=996" alt="FF11FF8F-42C2-405a-AFA4-708FC564CC46.png"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=Q9lDv&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p>
<h1 id="十一、MyBatis查询语句专题"><a href="#十一、MyBatis查询语句专题" class="headerlink" title="十一、MyBatis查询语句专题"></a>十一、MyBatis查询语句专题</h1><p>模块名：mybatis-007-select<br>打包方式：jar<br>引入依赖：mysql驱动依赖、mybatis依赖、logback依赖、junit依赖。<br>引入配置文件：jdbc.properties、mybatis-config.xml、logback.xml<br>创建pojo类：Car<br>创建Mapper接口：CarMapper<br>创建Mapper接口对应的映射文件：com&#x2F;powernode&#x2F;mybatis&#x2F;mapper&#x2F;CarMapper.xml<br>创建单元测试：CarMapperTest<br>拷贝工具类：SqlSessionUtil</p>
<h2 id="11-1-返回Car"><a href="#11-1-返回Car" class="headerlink" title="11.1 返回Car"></a>11.1 返回Car</h2><p>当查询的结果，有对应的实体类，并且查询结果只有一条时：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.powernode.mybatis.pojo.Car;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Car SQL映射器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id主键查询：结果最多只有一条</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Car <span class="title function_">selectById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">        select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.mybatis.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.powernode.mybatis.mapper.CarMapper;</span><br><span class="line"><span class="keyword">import</span> com.powernode.mybatis.pojo.Car;</span><br><span class="line"><span class="keyword">import</span> com.powernode.mybatis.utils.SqlSessionUtil;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectById</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> mapper.selectById(<span class="number">35L</span>);</span><br><span class="line">        System.out.println(car);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660810312287-ddfb6d00-1e96-425b-b4e6-fd6cdb8a9593.png#clientId=u85e451ff-5650-4&from=paste&height=159&id=u1080fb42&originHeight=159&originWidth=1197&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33909&status=done&style=shadow&taskId=u093b09e4-27b0-4610-a58e-a198c055725&title=&width=1197" alt="1977C3E7-9C65-4d2e-AFC2-8893F747F5E1.png"><br><strong>查询结果是一条的话可以使用List集合接收吗？当然可以</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据id主键查询：结果最多只有一条，可以放到List集合中吗？</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectByIdToList</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIdToList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">  select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByIdToList</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectByIdToList(<span class="number">35L</span>);</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660810652140-a438fba7-c21c-488a-9d18-c0383262f1dc.png#clientId=u85e451ff-5650-4&from=paste&height=184&id=ud2241e3a&originHeight=184&originWidth=1146&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36923&status=done&style=shadow&taskId=uc0b4ecb8-4b5d-46de-93db-3b397c1de2a&title=&width=1146" alt="C2F972FD-9268-4584-A11E-308355F3EF1D.png"></p>
<h2 id="11-2-返回List"><a href="#11-2-返回List" class="headerlink" title="11.2 返回List"></a>11.2 返回List<Car></h2><p>当查询的记录条数是多条的时候，必须使用集合接收。如果使用单个实体类接收会出现异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询所有的Car</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">  select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAll</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectAll();</span><br><span class="line">    cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660816141237-79a6a966-d3ec-4f7b-bc38-b1adb5df8fee.png#clientId=u85e451ff-5650-4&from=paste&height=260&id=ubd3d5916&originHeight=260&originWidth=1248&originalType=binary&ratio=1&rotation=0&showTitle=false&size=61845&status=done&style=shadow&taskId=u36c4e8d9-5007-4148-93bb-204f264dd19&title=&width=1248" alt="4813B87A-15F2-4638-B813-1B35699BD132.png"><br>如果返回多条记录，采用单个实体类接收会怎样？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询多条记录，采用单个实体类接收会怎样？</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Car <span class="title function_">selectAll2</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll2&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">  select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAll2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> mapper.selectAll2();</span><br><span class="line">    System.out.println(car);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660816549528-b600f5a9-81b4-4725-87c7-b933ee60ca39.png#clientId=u85e451ff-5650-4&from=paste&height=320&id=u1669660d&originHeight=320&originWidth=1357&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51856&status=done&style=shadow&taskId=u2164854e-7c28-4d8b-bd6d-8495d4a6566&title=&width=1357" alt="8D921E96-56B6-48a2-A605-0F27EE2D38C6.png"></p>
<h2 id="11-3-返回Map"><a href="#11-3-返回Map" class="headerlink" title="11.3 返回Map"></a>11.3 返回Map</h2><p>当返回的数据，没有合适的实体类对应的话，可以采用Map集合接收。字段名做key，字段值做value。<br>查询如果可以保证只有一条数据，则返回一个Map集合即可。<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660816974662-61782965-88fb-466e-a5ff-5af02ab614df.png#clientId=u85e451ff-5650-4&from=paste&height=247&id=ua0cc183c&originHeight=247&originWidth=257&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4315&status=done&style=shadow&taskId=u86d1b32b-7d18-4306-b22c-cb73b34e0fd&title=&width=257" alt="24B63480-BD38-4039-9958-A2A8BE5291F7.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过id查询一条记录，返回Map集合</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Map&lt;String, Object&gt; <span class="title function_">selectByIdRetMap</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIdRetMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>resultMap&#x3D;”map”，这是因为mybatis内置了很多别名。【参见mybatis开发手册】</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByIdRetMap</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    Map&lt;String,Object&gt; car = mapper.selectByIdRetMap(<span class="number">35L</span>);</span><br><span class="line">    System.out.println(car);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660817561293-68e25ddd-ed72-4121-99f6-35617d2ae0b0.png#clientId=u85e451ff-5650-4&from=paste&height=197&id=u7b2de67d&originHeight=197&originWidth=1264&originalType=binary&ratio=1&rotation=0&showTitle=false&size=38324&status=done&style=shadow&taskId=u66a705d7-4025-438c-a28e-7ecd801f877&title=&width=1264" alt="A661326B-A8BD-43b1-BD01-EB5A4BB9FE30.png"><br>当然，如果返回一个Map集合，可以将Map集合放到List集合中吗？当然可以，这里就不再测试了。<br>反过来，如果返回的不是一条记录，是多条记录的话，只采用单个Map集合接收，这样同样会出现之前的异常：<strong>TooManyResultsException</strong></p>
<h2 id="11-4-返回List"><a href="#11-4-返回List" class="headerlink" title="11.4 返回List"></a>11.4 返回List<Map></h2><p>查询结果条数大于等于1条数据，则可以返回一个存储Map集合的List集合。List<Map>等同于List<Car><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660817896708-0f3d0b44-4a0e-40ed-b609-b4d0e5fce1b6.png#clientId=u85e451ff-5650-4&from=paste&height=801&id=u002d3df7&originHeight=801&originWidth=529&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24621&status=done&style=shadow&taskId=u4a4cb53c-032e-4bcb-964e-95f2c8d1a73&title=&width=529" alt="8B951F18-A8AC-4301-96A7-77B8838C6A8F.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有的Car，返回一个List集合。List集合中存储的是Map集合。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">List&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">selectAllRetListMap</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllRetListMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAllRetListMap</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Map&lt;String,Object&gt;&gt; cars = mapper.selectAllRetListMap();</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span>carType=燃油车<span class="punctuation">,</span> carNum=<span class="number">103</span><span class="punctuation">,</span> guidePrice=<span class="number">50.30</span><span class="punctuation">,</span> produceTime=<span class="number">2020</span><span class="number">-10</span><span class="number">-01</span><span class="punctuation">,</span> id=<span class="number">33</span><span class="punctuation">,</span> brand=奔驰E300L<span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="punctuation">&#123;</span>carType=电车<span class="punctuation">,</span> carNum=<span class="number">102</span><span class="punctuation">,</span> guidePrice=<span class="number">30.23</span><span class="punctuation">,</span> produceTime=<span class="number">2018</span><span class="number">-09</span><span class="number">-10</span><span class="punctuation">,</span> id=<span class="number">34</span><span class="punctuation">,</span> brand=比亚迪汉<span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="punctuation">&#123;</span>carType=燃油车<span class="punctuation">,</span> carNum=<span class="number">103</span><span class="punctuation">,</span> guidePrice=<span class="number">50.30</span><span class="punctuation">,</span> produceTime=<span class="number">2020</span><span class="number">-10</span><span class="number">-01</span><span class="punctuation">,</span> id=<span class="number">35</span><span class="punctuation">,</span> brand=奔驰E300L<span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="punctuation">&#123;</span>carType=燃油车<span class="punctuation">,</span> carNum=<span class="number">103</span><span class="punctuation">,</span> guidePrice=<span class="number">33.23</span><span class="punctuation">,</span> produceTime=<span class="number">2020</span><span class="number">-10</span><span class="number">-11</span><span class="punctuation">,</span> id=<span class="number">36</span><span class="punctuation">,</span> brand=奔驰C200<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  ......</span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<h2 id="11-5-返回Map"><a href="#11-5-返回Map" class="headerlink" title="11.5 返回Map&lt;String,Map&gt;"></a>11.5 返回Map&lt;String,Map&gt;</h2><p><strong>拿Car的id做key，以后取出对应的Map集合时更方便。</strong><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660818043977-d5c56423-c5db-43ca-9c0c-eaa3f22a8f21.png#clientId=u85e451ff-5650-4&from=paste&height=761&id=u78390170&originHeight=761&originWidth=823&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24100&status=done&style=shadow&taskId=u4ec5bb54-42e4-451c-9150-b6dac3f92e9&title=&width=823" alt="79D7BA9E-6228-4c39-950A-D877EFCBADD1.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有的Car，返回一个Map集合。</span></span><br><span class="line"><span class="comment">     * Map集合的key是Car的id。</span></span><br><span class="line"><span class="comment">     * Map集合的value是对应Car。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@MapKey(&quot;id&quot;)</span></span><br><span class="line">Map&lt;Long,Map&lt;String,Object&gt;&gt; <span class="title function_">selectAllRetMap</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllRetMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAllRetMap</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    Map&lt;Long,Map&lt;String,Object&gt;&gt; cars = mapper.selectAllRetMap();</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="number">64</span>=<span class="punctuation">&#123;</span>carType=燃油车<span class="punctuation">,</span> carNum=<span class="number">133</span><span class="punctuation">,</span> guidePrice=<span class="number">50.30</span><span class="punctuation">,</span> produceTime=<span class="number">2020</span><span class="number">-01</span><span class="number">-10</span><span class="punctuation">,</span> id=<span class="number">64</span><span class="punctuation">,</span> brand=丰田霸道<span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line"><span class="number">66</span>=<span class="punctuation">&#123;</span>carType=燃油车<span class="punctuation">,</span> carNum=<span class="number">133</span><span class="punctuation">,</span> guidePrice=<span class="number">50.30</span><span class="punctuation">,</span> produceTime=<span class="number">2020</span><span class="number">-01</span><span class="number">-10</span><span class="punctuation">,</span> id=<span class="number">66</span><span class="punctuation">,</span> brand=丰田霸道<span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line"><span class="number">67</span>=<span class="punctuation">&#123;</span>carType=燃油车<span class="punctuation">,</span> carNum=<span class="number">133</span><span class="punctuation">,</span> guidePrice=<span class="number">50.30</span><span class="punctuation">,</span> produceTime=<span class="number">2020</span><span class="number">-01</span><span class="number">-10</span><span class="punctuation">,</span> id=<span class="number">67</span><span class="punctuation">,</span> brand=丰田霸道<span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line"><span class="number">69</span>=<span class="punctuation">&#123;</span>carType=燃油车<span class="punctuation">,</span> carNum=<span class="number">133</span><span class="punctuation">,</span> guidePrice=<span class="number">50.30</span><span class="punctuation">,</span> produceTime=<span class="number">2020</span><span class="number">-01</span><span class="number">-10</span><span class="punctuation">,</span> id=<span class="number">69</span><span class="punctuation">,</span> brand=丰田霸道<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">......</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="11-6-resultMap结果映射"><a href="#11-6-resultMap结果映射" class="headerlink" title="11.6 resultMap结果映射"></a>11.6 resultMap结果映射</h2><p>查询结果的列名和java对象的属性名对应不上怎么办？</p>
<ul>
<li>第一种方式：as 给列起别名</li>
<li>第二种方式：使用resultMap进行结果映射</li>
<li>第三种方式：是否开启驼峰命名自动映射（配置settings）</li>
</ul>
<h3 id="使用resultMap进行结果映射"><a href="#使用resultMap进行结果映射" class="headerlink" title="使用resultMap进行结果映射"></a>使用resultMap进行结果映射</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有Car，使用resultMap进行结果映射</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectAllByResultMap</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        resultMap:</span></span><br><span class="line"><span class="comment">            id：这个结果映射的标识，作为select标签的resultMap属性的值(在下面)。</span></span><br><span class="line"><span class="comment">            type：结果集要映射的类。可以使用别名。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;carResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--对象的唯一标识，官方解释是：为了提高mybatis的性能。建议写上。--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;carNum&quot;</span> <span class="attr">column</span>=<span class="string">&quot;car_num&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--当属性名和数据库列名一致时，可以省略。但建议都写上。--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--javaType用来指定属性类型。jdbcType用来指定列类型。一般可以省略。--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;brand&quot;</span> <span class="attr">column</span>=<span class="string">&quot;brand&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;guidePrice&quot;</span> <span class="attr">column</span>=<span class="string">&quot;guide_price&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;produceTime&quot;</span> <span class="attr">column</span>=<span class="string">&quot;produce_time&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;carType&quot;</span> <span class="attr">column</span>=<span class="string">&quot;car_type&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--resultMap属性的值必须和resultMap标签中id属性值一致。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllByResultMap&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;carResultMap&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAllByResultMap</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">carMapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = carMapper.selectAllByResultMap();</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果正常。</p>
<h3 id="是否开启驼峰命名自动映射"><a href="#是否开启驼峰命名自动映射" class="headerlink" title="是否开启驼峰命名自动映射"></a>是否开启驼峰命名自动映射</h3><p>使用这种方式的前提是：属性名遵循Java的命名规范，数据库表的列名遵循SQL的命名规范。<br>Java命名规范：首字母小写，后面每个单词首字母大写，遵循驼峰命名方式。<br>SQL命名规范：全部小写，单词之间采用下划线分割。<br>比如以下的对应关系：</p>
<table>
<thead>
<tr>
<th><strong>实体类中的属性名</strong></th>
<th><strong>数据库表的列名</strong></th>
</tr>
</thead>
<tbody><tr>
<td>carNum</td>
<td>car_num</td>
</tr>
<tr>
<td>carType</td>
<td>car_type</td>
</tr>
<tr>
<td>produceTime</td>
<td>produce_time</td>
</tr>
</tbody></table>
<p>如何启用该功能，在mybatis-config.xml文件中进行配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--放在properties标签后面--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询所有Car，启用驼峰命名自动映射</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectAllByMapUnderscoreToCamelCase</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllByMapUnderscoreToCamelCase&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAllByMapUnderscoreToCamelCase</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">carMapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = carMapper.selectAllByMapUnderscoreToCamelCase();</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果正常。</p>
<h2 id="11-7-返回总记录条数"><a href="#11-7-返回总记录条数" class="headerlink" title="11.7 返回总记录条数"></a>11.7 返回总记录条数</h2><p>需求：查询总记录条数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取总记录条数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">Long <span class="title function_">selectTotal</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--long是别名，可参考mybatis开发手册。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectTotal&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;long&quot;</span>&gt;</span></span><br><span class="line">  select count(*) from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectTotal</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">carMapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">total</span> <span class="operator">=</span> carMapper.selectTotal();</span><br><span class="line">    System.out.println(total);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660874705835-bd2767b1-c547-4a72-b7d7-229a3c89d74a.png#clientId=uce76794a-2043-4&from=paste&height=152&id=u8af5ea24&originHeight=152&originWidth=1360&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24422&status=done&style=shadow&taskId=ue53f594d-b265-4670-bf76-cec2a007135&title=&width=1360" alt="58FB9430-3F99-4332-80C3-E3444C00CAE5.png"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=rFQu0&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p>
<h1 id="十二、动态SQL"><a href="#十二、动态SQL" class="headerlink" title="十二、动态SQL"></a>十二、动态SQL</h1><p>有的业务场景，也需要SQL语句进行动态拼接，例如：</p>
<ul>
<li>批量删除</li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660799087155-ec264d4c-cafa-458d-85b9-f18b4c34bafd.png#clientId=u85e451ff-5650-4&from=paste&height=134&id=M0sWt&originHeight=134&originWidth=228&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2335&status=done&style=shadow&taskId=u87c4a40d-2b79-4042-afd3-23d8d331e8c&title=&width=228" alt="BF64FC68-5697-4695-AD2A-8D32297AED66.png"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t_car <span class="keyword">where</span> id <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,......这里的值是动态的，根据用户选择的id不同，值是不同的);</span><br></pre></td></tr></table></figure>

<ul>
<li>多条件查询</li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660876082121-d5ea8e08-e642-4716-b201-79cfe3849624.png#clientId=uce76794a-2043-4&from=paste&height=522&id=u0bdabd59&originHeight=522&originWidth=899&originalType=binary&ratio=1&rotation=0&showTitle=false&size=128213&status=done&style=shadow&taskId=ud1c3d3d8-479f-4792-9da4-bb3457c55fb&title=&width=899" alt="890B6A37-46CD-41ad-953B-B0642DA2C62F.png"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_car <span class="keyword">where</span> brand <span class="keyword">like</span> <span class="string">&#x27;丰田%&#x27;</span> <span class="keyword">and</span> guide_price <span class="operator">&gt;</span> <span class="number">30</span> <span class="keyword">and</span> .....;</span><br></pre></td></tr></table></figure>
<p>创建模块：mybatis-008-dynamic-sql<br>打包方式：jar<br>引入依赖：mysql驱动依赖、mybatis依赖、junit依赖、logback依赖<br>pojo：com.powernode.mybatis.pojo.Car<br>mapper接口：com.powernode.mybatis.mapper.CarMapper<br>引入配置文件：mybatis-config.xml、jdbc.properties、logback.xml<br>mapper配置文件：com&#x2F;powernode&#x2F;mybatis&#x2F;mapper&#x2F;CarMapper.xml<br>编写测试类：com.powernode.mybatis.test.CarMapperTest<br>拷贝工具类：SqlSessionUtil</p>
<h2 id="12-1-if标签"><a href="#12-1-if标签" class="headerlink" title="12.1 if标签"></a>12.1 if标签</h2><p>需求：多条件查询。<br>可能的条件包括：品牌（brand）、指导价格（guide_price）、汽车类型（car_type）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据多条件查询Car</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> guidePrice</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> carType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Car&gt; <span class="title function_">selectByMultiCondition</span><span class="params">(<span class="meta">@Param(&quot;brand&quot;)</span> String brand, <span class="meta">@Param(&quot;guidePrice&quot;)</span> Double guidePrice, <span class="meta">@Param(&quot;carType&quot;)</span> String carType)</span>;</span><br><span class="line">    <span class="comment">//如果这里没加param，mybatis里就要写param1或者arg0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByMultiCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">        select * from t_car where</span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">			在配置文件里开启了驼峰自动映射</span></span><br><span class="line"><span class="comment">			1.if标签中test属性是必须的。</span></span><br><span class="line"><span class="comment">			2.if标签中test属性的值是false或者true。</span></span><br><span class="line"><span class="comment">			3.如果test是true，则if标签中的sql语句就会拼接。反之，则不会拼接。</span></span><br><span class="line"><span class="comment">			4.</span></span><br><span class="line"><span class="comment">			test属性中可以使用的是:</span></span><br><span class="line"><span class="comment">			当使用了@Param注解，那么test中要出现的是@Param注解指定的参数名。@Param(&quot;brand&quot;)，那么这里只能使用brand</span></span><br><span class="line"><span class="comment">			当没有使用@Param注解，那么test中要出现的是:param1 param2 param3 arg0 arg1 arg2....</span></span><br><span class="line"><span class="comment">			当使用了P0J0，那么test中出现的是P0J0类的属性名</span></span><br><span class="line"><span class="comment">			5.在mybatis的动态SQL当中，不能使用&amp;&amp;，只能使用and:</span></span><br><span class="line"><span class="comment">			6.拼接的查询语句前面是数据库的字段名，后面是传过来的值</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand != &#x27;&#x27;&quot;</span>&gt;</span>不为空也不为空字符串</span><br><span class="line">            brand like #&#123;brand&#125;&quot;%&quot;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and guide_price &gt;= #&#123;guidePrice&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and car_type = #&#123;carType&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByMultiCondition</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">        List&lt;Car&gt; cars = mapper.selectByMultiCondition(<span class="string">&quot;丰田&quot;</span>, <span class="number">20.0</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br><span class="line">        System.out.println(cars);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660889544842-34404e94-66f2-48e5-b58a-784d6b91ee27.png#clientId=uce76794a-2043-4&from=paste&height=194&id=u8786f053&originHeight=194&originWidth=1045&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28066&status=done&style=shadow&taskId=u5bd2810b-663d-4d93-9f95-ecf59918ca7&title=&width=1045" alt="BF43A0EF-0324-4fb2-BE63-49E1352A5DB4.png"><br>如果第一个条件为空，剩下两个条件不为空，会是怎样呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Car&gt; cars = mapper.selectByMultiCondition(<span class="string">&quot;&quot;</span>, <span class="number">20.0</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660889738193-d5023b6c-13a9-447f-a128-45b36663c8f1.png#clientId=uce76794a-2043-4&from=paste&height=247&id=u6734899c&originHeight=247&originWidth=939&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22154&status=done&style=shadow&taskId=ucda7784d-bb8c-4418-a842-2e03c9e142f&title=&width=939" alt="3E87EFE6-A4B7-44ba-AC52-F62AC8066B08.png"><br>报错了，SQL语法有问题，where后面出现了and。这该怎么解决呢？</p>
<ul>
<li>可以where后面添加一个恒成立的条件。</li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660889965103-5e519823-a741-4ebf-b930-e10ffc9a4129.png#clientId=uce76794a-2043-4&from=paste&height=385&id=u324b967e&originHeight=385&originWidth=715&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32847&status=done&style=shadow&taskId=uda995560-f5ff-45d4-9f64-23725051ac5&title=&width=715" alt="0FC63B04-CDC3-4c0a-BA1B-BEC7C2D91F3E.png"><br>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660890083737-c8716d78-9e2d-4a22-bf56-12ff94b688f5.png#clientId=uce76794a-2043-4&from=paste&height=169&id=u65bc1f9c&originHeight=169&originWidth=978&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24288&status=done&style=shadow&taskId=u24c788f3-2898-4734-b454-4c9c1e69203&title=&width=978" alt="5A8B9A51-99B6-4730-884A-0B69DC19FCC4.png"><br>如果三个条件都是空，有影响吗？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Car&gt; cars = mapper.selectByMultiCondition(<span class="string">&quot;&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660890238928-6f889bdf-9702-4cd7-a0ef-b875977f42f9.png#clientId=uce76794a-2043-4&from=paste&height=160&id=u2f20b163&originHeight=160&originWidth=637&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15829&status=done&style=shadow&taskId=ub40b6c73-aa72-45f1-b645-522f7bf6055&title=&width=637" alt="CB992BC7-3C95-4c47-96BE-778863905BDD.png"><br>三个条件都不为空呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Car&gt; cars = mapper.selectByMultiCondition(<span class="string">&quot;丰田&quot;</span>, <span class="number">20.0</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660890374052-89bc29a1-3aeb-4941-b33f-fbbbe4fbbd39.png#clientId=uce76794a-2043-4&from=paste&height=138&id=u43c138d5&originHeight=138&originWidth=1029&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25848&status=done&style=shadow&taskId=u24959a15-1a6d-4ca8-a369-dd15fa68cbc&title=&width=1029" alt="3CAAB27C-3D6E-4709-9BA6-EBB3949AA75A.png"></p>
<h2 id="12-2-where标签"><a href="#12-2-where标签" class="headerlink" title="12.2 where标签"></a>12.2 where标签</h2><p>where标签的作用：让where子句更加动态智能。</p>
<ul>
<li>所有条件都为空时，where标签保证不会生成where子句。</li>
<li>自动去除某些条件<strong>前面</strong>多余的and或or。</li>
</ul>
<p>继续使用if标签中的需求。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据多条件查询Car，使用where标签</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> guidePrice</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> carType</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectByMultiConditionWithWhere</span><span class="params">(<span class="meta">@Param(&quot;brand&quot;)</span> String brand, <span class="meta">@Param(&quot;guidePrice&quot;)</span> Double guidePrice, <span class="meta">@Param(&quot;carType&quot;)</span> String carType)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByMultiConditionWithWhere&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      and brand like #&#123;brand&#125;&quot;%&quot;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      and guide_price &gt;= #&#123;guidePrice&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      and car_type = #&#123;carType&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByMultiConditionWithWhere</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectByMultiConditionWithWhere(<span class="string">&quot;丰田&quot;</span>, <span class="number">20.0</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660891031758-ce20585a-6bad-452e-b186-09cf465fecc6.png#clientId=uce76794a-2043-4&from=paste&height=142&id=u3a631133&originHeight=142&originWidth=993&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22412&status=done&style=shadow&taskId=u9125caa1-5fa5-4616-84db-5f07799eb3e&title=&width=993" alt="23A6B829-113A-40e8-9E5A-731C2EFE190E.png"><br>如果所有条件都是空呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Car&gt; cars = mapper.selectByMultiConditionWithWhere(<span class="string">&quot;&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660891127310-9847b1b5-2bf4-42f9-8e73-38b051b398de.png#clientId=uce76794a-2043-4&from=paste&height=112&id=uf1c80e5e&originHeight=112&originWidth=492&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9538&status=done&style=shadow&taskId=uf4508dc7-ccbe-41de-bb5c-1cb4c1abec8&title=&width=492" alt="BCF50EEA-97BF-46a1-95E8-2D91129E4E8B.png"><br>它可以自动去掉前面多余的and，那可以自动去掉前面多余的or吗？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Car&gt; cars = mapper.selectByMultiConditionWithWhere(<span class="string">&quot;丰田&quot;</span>, <span class="number">20.0</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByMultiConditionWithWhere&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      or brand like #&#123;brand&#125;&quot;%&quot;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      and guide_price &gt;= #&#123;guidePrice&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      and car_type = #&#123;carType&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660891540196-f2e055dd-74a7-40f9-a883-c78a5e2d28b7.png#clientId=uce76794a-2043-4&from=paste&height=126&id=ufa8c9cb8&originHeight=126&originWidth=864&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19804&status=done&style=shadow&taskId=ubea2e1e5-d1ce-4efd-9883-e5ead0dedf2&title=&width=864" alt="13CDD5F7-C25D-463f-8B56-7FF28C39ECAE.png"><br>它可以自动去掉前面多余的and，那可以自动去掉后面多余的and吗？</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByMultiConditionWithWhere&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      brand like #&#123;brand&#125;&quot;%&quot; and</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      guide_price &gt;= #&#123;guidePrice&#125; and</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      car_type = #&#123;carType&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 让最后一个条件为空</span><br><span class="line">List<span class="tag">&lt;<span class="name">Car</span>&gt;</span> cars = mapper.selectByMultiConditionWithWhere(&quot;丰田&quot;, 20.0, &quot;&quot;);</span><br></pre></td></tr></table></figure>
<p>运行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660891786608-272a3ab9-96f8-42bc-b5df-4d275cfe9cfe.png#clientId=uce76794a-2043-4&from=paste&height=222&id=u22f88380&originHeight=222&originWidth=946&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22878&status=done&style=shadow&taskId=u861a1cb3-51c4-4397-b857-7ace5c56582&title=&width=946" alt="B3C02137-829D-49ad-B8C7-6816D0D7EC48.png"><br>很显然，后面多余的and是不会被去除的。</p>
<h2 id="12-3-trim标签"><a href="#12-3-trim标签" class="headerlink" title="12.3 trim标签"></a>12.3 trim标签</h2><p>trim标签的属性：</p>
<ul>
<li>prefix：在trim标签中的语句前<strong>添加</strong>内容</li>
<li>suffix：在trim标签中的语句后<strong>添加</strong>内容</li>
<li>prefixOverrides：前缀<strong>覆盖掉（去掉）</strong></li>
<li>suffixOverrides：后缀<strong>覆盖掉（去掉）</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据多条件查询Car，使用trim标签</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> guidePrice</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> carType</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectByMultiConditionWithTrim</span><span class="params">(<span class="meta">@Param(&quot;brand&quot;)</span> String brand, <span class="meta">@Param(&quot;guidePrice&quot;)</span> Double guidePrice, <span class="meta">@Param(&quot;carType&quot;)</span> String carType)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByMultiConditionWithTrim&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line">    <span class="comment">&lt;!--prefix=&quot;where&quot;是在trim标签所有内容的前面添加 where--</span></span><br><span class="line"><span class="comment">	&lt;!--suffix0verrides=&quot;andlor”把trim标签中内容的后缀and或or去掉--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;where&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;and|or&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      brand like #&#123;brand&#125;&quot;%&quot; and</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      guide_price &gt;= #&#123;guidePrice&#125; and</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      car_type = #&#123;carType&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByMultiConditionWithTrim</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectByMultiConditionWithTrim(<span class="string">&quot;丰田&quot;</span>, <span class="number">20.0</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660894051788-34d9dd44-612e-424e-bf0a-143bea4b36bd.png#clientId=uc60038c0-79d0-4&from=paste&height=129&id=u35710fde&originHeight=129&originWidth=935&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17207&status=done&style=shadow&taskId=ucfdf6cff-c0e9-43fe-8356-3fd45082ccf&title=&width=935" alt="478A3426-65FF-4f80-823D-DF5B7CF542F8.png"><br>如果所有条件为空，where会被加上吗？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Car&gt; cars = mapper.selectByMultiConditionWithTrim(<span class="string">&quot;&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>执行结果：不会加<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660894220001-e789ea6b-a219-4f3d-8670-b9612d1d8274.png#clientId=uc60038c0-79d0-4&from=paste&height=118&id=u521fe703&originHeight=118&originWidth=448&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8902&status=done&style=shadow&taskId=u78861c94-d9ef-485f-97b7-37925b7c0ea&title=&width=448" alt="E6EAF998-8725-4c69-B2BC-8BF65B04A85A.png"></p>
<h2 id="12-4-set标签"><a href="#12-4-set标签" class="headerlink" title="12.4 set标签"></a>12.4 set标签</h2><p>主要使用在update语句当中，用来生成set关键字，同时去掉最后多余的“,”<br>比如我们只更新提交的不为空的字段，如果提交的数据是空或者””，那么这个字段我们将不更新。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 更新信息，使用set标签</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> car</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateWithSet</span><span class="params">(Car car)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateWithSet&quot;</span>&gt;</span></span><br><span class="line">  update t_car</span><br><span class="line">  <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carNum != null and carNum != &#x27;&#x27;&quot;</span>&gt;</span>car_num = #&#123;carNum&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand != &#x27;&#x27;&quot;</span>&gt;</span>brand = #&#123;brand&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27;&#x27;&quot;</span>&gt;</span>guide_price = #&#123;guidePrice&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;produceTime != null and produceTime != &#x27;&#x27;&quot;</span>&gt;</span>produce_time = #&#123;produceTime&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27;&#x27;&quot;</span>&gt;</span>car_type = #&#123;carType&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdateWithSet</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="number">38L</span>,<span class="string">&quot;1001&quot;</span>,<span class="string">&quot;丰田霸道2&quot;</span>,<span class="number">10.0</span>,<span class="string">&quot;&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> mapper.updateWithSet(car);</span><br><span class="line">    System.out.println(count);</span><br><span class="line">    SqlSessionUtil.openSession().commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660895330743-edd9f2e6-8cd0-4cbe-9c73-adf009466e38.png#clientId=uc60038c0-79d0-4&from=paste&height=164&id=uc47ae5d4&originHeight=164&originWidth=912&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20386&status=done&style=shadow&taskId=uf4d734e1-bc87-49d4-affe-302de90ce92&title=&width=912" alt="846C97DE-8048-41b8-8C6F-FCA743B53812.png"></p>
<h2 id="12-5-choose-when-otherwise"><a href="#12-5-choose-when-otherwise" class="headerlink" title="12.5 choose when otherwise"></a>12.5 choose when otherwise</h2><p>这三个标签是在一起使用的：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">when</span>&gt;</span><span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">when</span>&gt;</span><span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">when</span>&gt;</span><span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span><span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>等同于：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>()&#123;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>()&#123;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>()&#123;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>()&#123;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>只有一个分支会被选择！！！！<br>需求：先根据品牌查询，如果没有提供品牌，再根据指导价格查询，如果没有提供指导价格，就根据生产日期查询。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 使用choose when otherwise标签查询</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> guidePrice</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> produceTime</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectWithChoose</span><span class="params">(<span class="meta">@Param(&quot;brand&quot;)</span> String brand, <span class="meta">@Param(&quot;guidePrice&quot;)</span> Double guidePrice, <span class="meta">@Param(&quot;produceTime&quot;)</span> String produceTime)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectWithChoose&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        brand like #&#123;brand&#125;&quot;%&quot;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        guide_price &gt;= #&#123;guidePrice&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        produce_time &gt;= #&#123;produceTime&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectWithChoose</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="comment">//List&lt;Car&gt; cars = mapper.selectWithChoose(&quot;丰田霸道&quot;, 20.0, &quot;2000-10-10&quot;);</span></span><br><span class="line">    <span class="comment">//List&lt;Car&gt; cars = mapper.selectWithChoose(&quot;&quot;, 20.0, &quot;2000-10-10&quot;);</span></span><br><span class="line">    <span class="comment">//List&lt;Car&gt; cars = mapper.selectWithChoose(&quot;&quot;, null, &quot;2000-10-10&quot;);</span></span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectWithChoose(<span class="string">&quot;&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660896273467-9ba1d6c0-9cc3-4deb-92e5-0f54b4ade614.png#clientId=uc60038c0-79d0-4&from=paste&height=155&id=ube619424&originHeight=155&originWidth=701&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18529&status=done&style=shadow&taskId=uc0bb4792-ed5c-411f-aa8f-55d85f82af5&title=&width=701" alt="E7884930-EDE9-4743-A1A9-DBDBD76C9E1E.png"></p>
<p>如果所有的条件都不满足，比如都为空，就至少会执行otherwise这个语句，只不过传进sql里的是null</p>
<h2 id="12-6-foreach标签"><a href="#12-6-foreach标签" class="headerlink" title="12.6 foreach标签"></a>12.6 foreach标签</h2><p>循环数组或集合，动态生成sql，比如这样的SQL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t_car <span class="keyword">where</span> id <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t_car <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">or</span> id <span class="operator">=</span> <span class="number">2</span> <span class="keyword">or</span> id <span class="operator">=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> t_car <span class="keyword">values</span></span><br><span class="line">  (<span class="keyword">null</span>,<span class="string">&#x27;1001&#x27;</span>,<span class="string">&#x27;凯美瑞&#x27;</span>,<span class="number">35.0</span>,<span class="string">&#x27;2010-10-11&#x27;</span>,<span class="string">&#x27;燃油车&#x27;</span>),</span><br><span class="line">  (<span class="keyword">null</span>,<span class="string">&#x27;1002&#x27;</span>,<span class="string">&#x27;比亚迪唐&#x27;</span>,<span class="number">31.0</span>,<span class="string">&#x27;2020-11-11&#x27;</span>,<span class="string">&#x27;新能源&#x27;</span>),</span><br><span class="line">  (<span class="keyword">null</span>,<span class="string">&#x27;1003&#x27;</span>,<span class="string">&#x27;比亚迪宋&#x27;</span>,<span class="number">32.0</span>,<span class="string">&#x27;2020-10-11&#x27;</span>,<span class="string">&#x27;新能源&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="批量删除-1"><a href="#批量删除-1" class="headerlink" title="批量删除"></a>批量删除</h3><ul>
<li>用in来删除</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 通过foreach完成批量删除</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteByIds</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span> String[] ids)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	foreach标签的属性：</span></span><br><span class="line"><span class="comment">		collection：集合或数组</span></span><br><span class="line"><span class="comment">		item：集合或数组中的元素</span></span><br><span class="line"><span class="comment">		separator：分隔符</span></span><br><span class="line"><span class="comment">		open：foreach标签中所有内容的开始</span></span><br><span class="line"><span class="comment">		close：foreach标签中所有内容的结束</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		在不使用@Param注解的时候直接填数组名collection=&quot;ids&quot;报错了，错误信息是:[array，arg0]</span></span><br><span class="line"><span class="comment">什么意思?</span></span><br><span class="line"><span class="comment">		map.put(&quot;array&quot;，数组);</span></span><br><span class="line"><span class="comment">		map.put(&quot;arg&quot;，数组);</span></span><br><span class="line"><span class="comment">也就是array和arg作为了map的key，但是这样可读性差，所以用@Param起名</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByIds&quot;</span>&gt;</span></span><br><span class="line">  delete from t_car where id in</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;aaaa&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">    #&#123;aaaa&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">这样也可以</span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByIds&quot;</span>&gt;</span></span><br><span class="line">  delete from t_car where id in(</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;aaaa&quot;</span>&gt;</span></span><br><span class="line">    #&#123;aaaa&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    )</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteBatchByForeach</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> mapper.deleteBatchByForeach(<span class="keyword">new</span> <span class="title class_">Long</span>[]&#123;<span class="number">40L</span>, <span class="number">41L</span>, <span class="number">42L</span>&#125;);</span><br><span class="line">    System.out.println(<span class="string">&quot;删除了几条记录：&quot;</span> + count);</span><br><span class="line">    SqlSessionUtil.openSession().commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660899240200-ab225394-27f1-4ec1-94e0-b2b3d3a9b16e.png#clientId=uc60038c0-79d0-4&from=paste&height=146&id=u4a8e11cf&originHeight=146&originWidth=732&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15443&status=done&style=shadow&taskId=uc7b9e97c-8ff7-44aa-b56d-a281c1731c6&title=&width=732" alt="F8F6B314-E3B0-46bd-8156-F88072A01271.png"></p>
<ul>
<li>用or来删除</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 通过foreach完成批量删除</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteBatchByForeach2</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span> Long[] ids)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--这里分隔符用or是可以的，并且会自动加上空格--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteBatchByForeach2&quot;</span>&gt;</span></span><br><span class="line">  delete from t_car where</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;or&quot;</span>&gt;</span></span><br><span class="line">    id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteBatchByForeach2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> mapper.deleteBatchByForeach2(<span class="keyword">new</span> <span class="title class_">Long</span>[]&#123;<span class="number">40L</span>, <span class="number">41L</span>, <span class="number">42L</span>&#125;);</span><br><span class="line">    System.out.println(<span class="string">&quot;删除了几条记录：&quot;</span> + count);</span><br><span class="line">    SqlSessionUtil.openSession().commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660899667194-f150bf6b-b54f-432a-8455-4c819bac0c58.png#clientId=uc60038c0-79d0-4&from=paste&height=129&id=u2f11d6a0&originHeight=129&originWidth=656&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12169&status=done&style=shadow&taskId=ub7d84acd-e9f9-4c03-b428-615c5eda48e&title=&width=656" alt="01FA0A35-FD1D-43e8-A92D-104E98194D6C.png"></p>
<h3 id="批量添加"><a href="#批量添加" class="headerlink" title="批量添加"></a>批量添加</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 批量添加，使用foreach标签</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> cars</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insertBatch</span><span class="params">(<span class="meta">@Param(&quot;cars&quot;)</span> List&lt;Car&gt; cars)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--这里就不要用open和close了--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatchByForeach&quot;</span>&gt;</span></span><br><span class="line">  insert into t_car values </span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;cars&quot;</span> <span class="attr">item</span>=<span class="string">&quot;car&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">    (null,#&#123;car.carNum&#125;,#&#123;car.brand&#125;,#&#123;car.guidePrice&#125;,#&#123;car.produceTime&#125;,#&#123;car.carType&#125;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertBatchByForeach</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="literal">null</span>, <span class="string">&quot;2001&quot;</span>, <span class="string">&quot;兰博基尼&quot;</span>, <span class="number">100.0</span>, <span class="string">&quot;1998-10-11&quot;</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="literal">null</span>, <span class="string">&quot;2001&quot;</span>, <span class="string">&quot;兰博基尼&quot;</span>, <span class="number">100.0</span>, <span class="string">&quot;1998-10-11&quot;</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="literal">null</span>, <span class="string">&quot;2001&quot;</span>, <span class="string">&quot;兰博基尼&quot;</span>, <span class="number">100.0</span>, <span class="string">&quot;1998-10-11&quot;</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br><span class="line">    List&lt;Car&gt; cars = Arrays.asList(car1, car2, car3);</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> mapper.insertBatchByForeach(cars);</span><br><span class="line">    System.out.println(<span class="string">&quot;插入了几条记录&quot;</span> + count);</span><br><span class="line">    SqlSessionUtil.openSession().commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1660900226070-90533bde-4129-49b5-9fa7-639aa07c3b03.png#clientId=uc60038c0-79d0-4&from=paste&height=166&id=u5ac82100&originHeight=166&originWidth=926&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16492&status=done&style=shadow&taskId=udef78a82-7c78-4c59-87d1-62e98fb5a68&title=&width=926" alt="A1B37462-5261-4b46-97CA-9D703D1452AC.png"></p>
<h2 id="12-7-sql标签与include标签"><a href="#12-7-sql标签与include标签" class="headerlink" title="12.7 sql标签与include标签"></a>12.7 sql标签与include标签</h2><p>sql标签用来声明sql片段<br>include标签用来将声明的sql片段包含到某个sql语句当中<br>作用：代码复用。易维护。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--把重复使用的sql语句放在下面，然后起个名字，在需要的地方使用&lt;include&gt;标签就可以--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;carCols&quot;</span>&gt;</span>id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllRetMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;carCols&quot;</span>/&gt;</span> from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllRetListMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;carCols&quot;</span>/&gt;</span> carType from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIdRetMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;carCols&quot;</span>/&gt;</span> from t_car where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=pkWu9&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p>
<h1 id="十三、MyBatis的高级映射及延迟加载"><a href="#十三、MyBatis的高级映射及延迟加载" class="headerlink" title="十三、MyBatis的高级映射及延迟加载"></a>十三、MyBatis的高级映射及延迟加载</h1><p>模块名：mybatis-009-advanced-mapping<br>打包方式：jar<br>依赖：mybatis依赖、mysql驱动依赖、junit依赖、logback依赖<br>配置文件：mybatis-config.xml、logback.xml、jdbc.properties<br>拷贝工具类：SqlSessionUtil<br>准备数据库表：一个班级对应多个学生。班级表：t_clazz。学生表：t_student<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661132819754-23adfa1c-b325-41bc-8520-0355fe4c41cc.png#clientId=ubeb36f5f-42dd-4&from=paste&height=153&id=u354c9ec4&originHeight=153&originWidth=387&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5638&status=done&style=shadow&taskId=u9398081e-3340-4fb2-b656-caa9d5a3230&title=&width=387" alt="C97C4534-D714-4314-A6B9-1A9D6FB32776.png"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661132610940-7d55793b-df68-48f4-924f-99db58220da9.png#clientId=ubeb36f5f-42dd-4&from=paste&height=204&id=ue5841f5d&originHeight=204&originWidth=365&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7378&status=done&style=shadow&taskId=u5bcb392c-be74-4c13-b5f2-d86c8598330&title=&width=365" alt="F3517247-9413-4e66-A4EE-13C26BD2F5B6.png"><br>创建pojo：Student、Clazz</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.mybatis.pojo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 学生类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer sid;</span><br><span class="line">    <span class="keyword">private</span> String sname;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.mybatis.pojo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 班级类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Clazz</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer cid;</span><br><span class="line">    <span class="keyword">private</span> String cname;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>创建mapper接口：StudentMapper、ClazzMapper<br>创建mapper映射文件：StudentMapper.xml、ClazzMapper.xml</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/mybatis/%E8%80%81%E6%9D%9CMyBatis/image-20251208221439117.png" alt="image-20251208221439117"></p>
<h2 id="13-1-多对一"><a href="#13-1-多对一" class="headerlink" title="13.1 多对一"></a>13.1 多对一</h2><p>多种方式，常见的包括三种：</p>
<ul>
<li>第一种方式：一条SQL语句，级联属性映射。</li>
<li>第二种方式：一条SQL语句，association。</li>
<li>第三种方式：两条SQL语句，分步查询。（这种方式常用：优点一是可复用。优点二是支持懒加载（延迟加载）。）</li>
</ul>
<h3 id="第一种方式：级联属性映射"><a href="#第一种方式：级联属性映射" class="headerlink" title="第一种方式：级联属性映射"></a>第一种方式：级联属性映射</h3><p>多对一的话多是主表，也就是student</p>
<p>pojo类Student中添加一个属性：Clazz clazz; 表示学生关联的班级对象，然后生成set和get、toString方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.mybatis.pojo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据id获取学生信息。同时获取学生关联的班级信息。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 学生的id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 学生对象，但是学生对象当中含有班级对象。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer sid;</span><br><span class="line">    <span class="keyword">private</span> String sname;</span><br><span class="line">    <span class="keyword">private</span> Clazz clazz;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Clazz <span class="title function_">getClazz</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> clazz;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setClazz</span><span class="params">(Clazz clazz)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.clazz = clazz;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;sid=&quot;</span> + sid +</span><br><span class="line">                <span class="string">&quot;, sname=&#x27;&quot;</span> + sname + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, clazz=&quot;</span> + clazz +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(Integer sid, String sname)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sid = sid;</span><br><span class="line">        <span class="built_in">this</span>.sname = sname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getSid</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSid</span><span class="params">(Integer sid)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sid = sid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSname</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSname</span><span class="params">(String sname)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sname = sname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.StudentMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--这里也要考虑是用resultMap还是resultType--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--clazz是个类，用类里的cid被赋值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;clazz.cid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;clazz.cname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBySid&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;studentResultMap&quot;</span>&gt;</span></span><br><span class="line">	select</span><br><span class="line">		s.sid,s.sname,c.cid,c.cname</span><br><span class="line">	from</span><br><span class="line">		t_stu s left join t_clazz c on s.cid = c.cid</span><br><span class="line">	where</span><br><span class="line">		s.sid = #&#123;sid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectBySid</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(StudentMapper.class);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> mapper.selectBySid(<span class="number">1</span>);</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661134833921-9452c17c-3461-4c7f-8807-55aa3e089506.png#clientId=ubeb36f5f-42dd-4&from=paste&height=142&id=ub5b1bbf4&originHeight=142&originWidth=1144&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25983&status=done&style=shadow&taskId=u5dabd444-2088-4b43-a8be-1bc28bea7ad&title=&width=1144" alt="F25380AC-E951-46c6-99AB-38AD7A2C76F2.png"></p>
<h3 id="第二种方式：association"><a href="#第二种方式：association" class="headerlink" title="第二种方式：association"></a>第二种方式：association</h3><p>其他位置都不需要修改，只需要修改resultMap中的配置：association即可。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		association:翻译为关联。一个Student对象关联了一个Clazz对象</span></span><br><span class="line"><span class="comment">			property:提供要映射的P0J0类的属性名。</span></span><br><span class="line"><span class="comment">			javaType:用来指定要映射的java类型，用全限定名，但是也可以起别名，这里就是用了别名</span></span><br><span class="line"><span class="comment">		后面就是类的和数据库的</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;clazz&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Clazz&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>association翻译为：关联。<br>学生对象关联一个班级对象。</p>
<h3 id="第三种方式：分步查询"><a href="#第三种方式：分步查询" class="headerlink" title="第三种方式：分步查询"></a>第三种方式：分步查询</h3><p>其他位置不需要修改，只需要修改以及添加以下三处：<br>第一处：association中select位置填写sqlId。sqlId&#x3D;namespace+id。其中column属性作为这条子sql语句的条件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--两条SQL语句，完成多对一的分步查询。--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这里是第一步:根据学生的id查询学生的所有信息。这些信息当中含有班级id(cid)--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--property里的sid和sname对应着select语句里的sid，sname，去进行赋值，同样的cid查出后要赋给column的cid，将来赋给select指定的id,复制这个路径也可以通过右击接口的方法名然后复制粘贴就有了--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--select里需要指定另外第二部sql语句的ID--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;clazz&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">select</span>=<span class="string">&quot;com.powernode.mybatis.mapper.ClazzMapper.selectByCid&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByStep1&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;studentResultMapByStep&quot;</span>&gt;</span></span><br><span class="line">  select sid,sname,cid from t_stu where sid = #&#123;sid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第二处：studentmapper对应的student的查询语句，clazz差的是另外一张表，所以需要其他的接口，换成clazzmapper，在ClazzMapper接口中添加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分步查询第二步:根据cid获取班级信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ClazzMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据cid获取Clazz信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Clazz <span class="title function_">selectByCid</span><span class="params">(Integer cid)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>第三处：在ClazzMapper.xml文件中进行配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.ClazzMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--分步查询第二步:根据cid获取班级信息。类和数据库名字对应所以可以不用resultMap--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIdstep2&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Clazz&quot;</span>&gt;</span></span><br><span class="line">		select cid,cname fromtclazz where cid = #&#123;cid&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>执行结果，可以很明显看到先后有两条sql语句执行：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661151746372-e3c91810-bb5f-4308-8dd5-e421e11bff50.png#clientId=ubeb36f5f-42dd-4&from=paste&height=183&id=u754eeb0e&originHeight=183&originWidth=760&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22113&status=done&style=shadow&taskId=u6879c49a-2037-4a5f-bb8f-41fa068f854&title=&width=760" alt="64257FF9-0D4C-45ea-AF88-68DC6E19141D.png"><br>分步优点：</p>
<ul>
<li>第一个优点：代码复用性增强。</li>
<li>第二个优点：支持延迟加载\懒加载。【暂时访问不到的数据可以先不查询。提高程序的执行效率。】</li>
</ul>
<h2 id="13-2-多对一延迟加载"><a href="#13-2-多对一延迟加载" class="headerlink" title="13.2 多对一延迟加载"></a>13.2 多对一延迟加载</h2><ul>
<li>什么是延迟加载(懒加载)，有什么用?<ul>
<li>延迟加载的核心原理是:用的时候再执行查询语句。不用的时候不查询</li>
<li>作用:提高性能。尽可能的不查，或者说尽可能的少查。来提高效率。</li>
</ul>
</li>
<li>在mybatis当中怎么开启延迟加载呢?<ul>
<li>association标签中添加fetchType&#x3D;”lazy”</li>
<li>注意:默认情况下是没有开启延迟加载的。需要设置:fetchType&#x3D;”lazy”</li>
<li>这种在association标签中配置fetchType&#x3D;”lazy”，是局部的设置，只对当前的association关联的sqL语句起作用。</li>
</ul>
</li>
</ul>
<p>修改StudentMapper.xml文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;clazz&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">select</span>=<span class="string">&quot;com.powernode.mybatis.mapper.ClazzMapper.selectByCid&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span></span></span><br><span class="line"><span class="tag">               </span></span><br><span class="line"><span class="tag">               <span class="attr">fetchType</span>=<span class="string">&quot;lazy&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们现在只查询学生名字，修改测试程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectBySid</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(StudentMapper.class);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> mapper.selectBySid(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//System.out.println(student);</span></span><br><span class="line">        <span class="comment">// 只获取学生姓名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sname</span> <span class="operator">=</span> student.getSname();</span><br><span class="line">        System.out.println(<span class="string">&quot;学生姓名：&quot;</span> + sname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661151882965-633f8039-c309-4657-8ed1-44f836d5b1e4.png#clientId=ubeb36f5f-42dd-4&from=paste&height=134&id=u116285c4&originHeight=134&originWidth=797&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12499&status=done&style=shadow&taskId=ubc28843b-1715-4227-a9ea-d86c1a5dfb2&title=&width=797" alt="243153C1-F8EC-4792-9CE6-600A819EF080.png"><br>如果后续需要使用到学生所在班级的名称，这个时候才会执行关联的sql语句，修改测试程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectBySid</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(StudentMapper.class);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> mapper.selectBySid(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//System.out.println(student);</span></span><br><span class="line">        <span class="comment">// 只获取学生姓名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sname</span> <span class="operator">=</span> student.getSname();</span><br><span class="line">        System.out.println(<span class="string">&quot;学生姓名：&quot;</span> + sname);</span><br><span class="line">        <span class="comment">// 到这里之后，想获取班级名字了</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cname</span> <span class="operator">=</span> student.getClazz().getCname();</span><br><span class="line">        System.out.println(<span class="string">&quot;学生的班级名称：&quot;</span> + cname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661151926961-a0affa2d-2d89-4b67-8cc0-bf8604ded4fc.png#clientId=ubeb36f5f-42dd-4&from=paste&height=241&id=ub355c610&originHeight=241&originWidth=778&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23158&status=done&style=shadow&taskId=u94275f08-384f-4027-90c2-1bb19f838f0&title=&width=778" alt="D804FEF1-B414-4d5d-AF22-CF2042FACA69.png"><br>通过以上的执行结果可以看到，只有当使用到班级名称之后，才会执行关联的sql语句，这就是延迟加载。<br>在mybatis中如何开启全局的延迟加载呢？需要setting配置，如下：mybatis-config<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661136161612-a7c3cc7f-fe89-4245-a297-1572d8384566.png#clientId=ubeb36f5f-42dd-4&from=paste&height=314&id=ued68a328&originHeight=314&originWidth=1505&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29174&status=done&style=shadow&taskId=u8519649e-773a-49bd-8c51-2ccdd385a85&title=&width=1505" alt="0253ED55-CB5E-4256-BEE2-2C9E97317809.png"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>**然后把fetchType&#x3D;”lazy”去掉。**这样凡是分步的都是延迟加载<br>执行以下程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectBySid</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(StudentMapper.class);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> mapper.selectBySid(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//System.out.println(student);</span></span><br><span class="line">        <span class="comment">// 只获取学生姓名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sname</span> <span class="operator">=</span> student.getSname();</span><br><span class="line">        System.out.println(<span class="string">&quot;学生姓名：&quot;</span> + sname);</span><br><span class="line">        <span class="comment">// 到这里之后，想获取班级名字了</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cname</span> <span class="operator">=</span> student.getClazz().getCname();</span><br><span class="line">        System.out.println(<span class="string">&quot;学生的班级名称：&quot;</span> + cname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661151954051-4b5b94f7-a69d-4d21-b220-1a840862fb85.png#clientId=ubeb36f5f-42dd-4&from=paste&height=241&id=uae4f54af&originHeight=241&originWidth=778&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23158&status=done&style=shadow&taskId=uad4731e1-dec8-4420-b536-732a8bcd09e&title=&width=778" alt="D804FEF1-B414-4d5d-AF22-CF2042FACA69.png"><br>通过以上的测试可以看出，我们已经开启了全局延迟加载策略。<br>开启全局延迟加载之后，所有的sql都会支持延迟加载，如果某个sql你不希望它支持延迟加载怎么办呢？将fetchType设置为eager：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;clazz&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">select</span>=<span class="string">&quot;com.powernode.mybatis.mapper.ClazzMapper.selectByCid&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">fetchType</span>=<span class="string">&quot;eager&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661151998854-a31c19fb-0af9-4d69-894d-e8086d9c0333.png#clientId=ubeb36f5f-42dd-4&from=paste&height=242&id=u793a89fc&originHeight=242&originWidth=767&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25091&status=done&style=shadow&taskId=uc4382415-3db6-40e2-af5b-35f4f31ab10&title=&width=767" alt="16CFD580-56BB-4a69-A1DA-095C8186D398.png"><br>这样的话，针对某个特定的sql，你就关闭了延迟加载机制。<br>后期我们要不要开启延迟加载机制，主要看实际的业务需求是怎样的，一般是开启。</p>
<h2 id="13-3-一对多"><a href="#13-3-一对多" class="headerlink" title="13.3 一对多"></a>13.3 一对多</h2><p>一对多的实现，通常是在一的一方中有List集合属性。比如通过一个班级查到所有的学生<br>在Clazz类中添加List<Student> stus; 属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Clazz</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer cid;</span><br><span class="line">    <span class="keyword">private</span> String cname;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; stus;</span><br><span class="line">    <span class="comment">// set get方法</span></span><br><span class="line">    <span class="comment">// 构造方法</span></span><br><span class="line">    <span class="comment">// toString方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一对多的实现通常包括两种实现方式：</p>
<ul>
<li>第一种方式：collection</li>
<li>第二种方式：分步查询</li>
</ul>
<h3 id="第一种方式：collection"><a href="#第一种方式：collection" class="headerlink" title="第一种方式：collection"></a>第一种方式：collection</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ClazzMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据cid获取Clazz信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Clazz <span class="title function_">selectByCid</span><span class="params">(Integer cid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据班级编号查询班级信息。同时班级中所有的学生信息也要查询。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Clazz <span class="title function_">selectClazzAndStusByCid</span><span class="params">(Integer cid)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;clazzResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Clazz&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对多，这里是collection。collection是集合的意思。stus是clazz里集合的名字--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--ofType 属性用来指定集合当中的元素类型。--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;stus&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectClazzAndStusByCid&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;clazzResultMap&quot;</span>&gt;</span></span><br><span class="line">  select * from t_clazz c join t_student s on c.cid = s.cid where c.cid = #&#123;cid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意是ofType，表示“集合中的类型”。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClazzMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectClazzAndStusByCid</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ClazzMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(ClazzMapper.class);</span><br><span class="line">        <span class="type">Clazz</span> <span class="variable">clazz</span> <span class="operator">=</span> mapper.selectClazzAndStusByCid(<span class="number">1001</span>);</span><br><span class="line">        System.out.println(clazz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661149977323-90515301-4b5b-4e3e-a17f-04d5473766e7.png#clientId=ubeb36f5f-42dd-4&from=paste&height=146&id=uf885a23f&originHeight=146&originWidth=1629&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19600&status=done&style=shadow&taskId=u4ab6987c-460a-4e44-ac4e-f90cc1f5aa5&title=&width=1629" alt="11487318-3686-4868-B14C-D9247AC31764.png"></p>
<h3 id="第二种方式：分步查询"><a href="#第二种方式：分步查询" class="headerlink" title="第二种方式：分步查询"></a>第二种方式：分步查询</h3><p>修改以下三个位置即可：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;clazzResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Clazz&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--主要看这里，集合的stus通过后面的select查询到的结果赋值，下面select标签查到的cid传到这里通过column传进select的sql语句里--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;stus&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">select</span>=<span class="string">&quot;com.powernode.mybatis.mapper.StudentMapper.selectByCid&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--sql语句也变化了--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectClazzAndStusByCid&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;clazzResultMap&quot;</span>&gt;</span></span><br><span class="line">  select * from t_clazz c where c.cid = #&#123;cid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据班级编号获取所有的学生。</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> cid</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Student&gt; <span class="title function_">selectByCidStep2</span><span class="params">(Integer cid)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//分部查询第一步:先根据学生的sid查询学生的信息</span></span><br><span class="line">Student <span class="title function_">selectByIdStep1</span><span class="params">(Integer sid)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCid&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">  select * from t_student where cid = #&#123;cid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661151398803-0c0e196e-6c0a-42fb-b9ee-abd42fea2026.png#clientId=ubeb36f5f-42dd-4&from=paste&height=232&id=u219ee5d5&originHeight=232&originWidth=1639&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30822&status=done&style=shadow&taskId=u4f436b8f-f31d-449b-a297-7663393629d&title=&width=1639" alt="B663AF51-68CE-416f-AC5D-F709FCE0304D.png"></p>
<p>我们这里也是开启了延迟加载，访问整个clazz时是两个查询语句都去查询，其他的需要什么就用什么</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectBystep1</span><span class="params">()</span>&#123;</span><br><span class="line">	SqlSession sqlSession=SqlSessionUtil.openSession();</span><br><span class="line">	<span class="type">ClazzMapper</span> <span class="variable">mapper</span> <span class="operator">=</span>sqlSession.getMapper(clazzMapper.class);</span><br><span class="line">	<span class="type">Clazz</span> <span class="variable">clazz</span> <span class="operator">=</span>mapper.selectByStep1( cid:<span class="number">1000</span>);</span><br><span class="line">	<span class="comment">//System.out.printn(clazz);</span></span><br><span class="line">	<span class="comment">//只访问级名字。	System.out.println(clazz.getCname());</span></span><br><span class="line">	<span class="comment">//只有用到的时候才会去执行第二步SQL</span></span><br><span class="line">    System.out.println(clazz.getStus());</span><br><span class="line">	sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="13-4-一对多延迟加载"><a href="#13-4-一对多延迟加载" class="headerlink" title="13.4 一对多延迟加载"></a>13.4 一对多延迟加载</h2><p>一对多延迟加载机制和多对一是一样的。同样是通过两种方式：</p>
<ul>
<li>第一种：fetchType&#x3D;”lazy”</li>
<li>第二种：修改全局的配置setting，**lazyLoadingEnabled&#x3D;true，**如果开启全局延迟加载，想让某个sql不使用延迟加载：fetchType&#x3D;”eager”</li>
</ul>
<p><strong>多对多应该怎么弄？分解成两个一对多</strong></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=DDo59&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p>
<h1 id="十四、MyBatis的缓存"><a href="#十四、MyBatis的缓存" class="headerlink" title="十四、MyBatis的缓存"></a>十四、MyBatis的缓存</h1><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/mybatis/%E8%80%81%E6%9D%9CMyBatis/image-20251209170749467.png" alt="image-20251209170749467"></p>
<p>缓存：cache<br>缓存的作用：通过减少IO的方式，来提高程序的执行效率。<br>mybatis的缓存：将select语句的查询结果放到缓存（内存）当中，下一次还是这条select语句的话，直接从缓存中取，不再查数据库。一方面是减少了IO。另一方面不再执行繁琐的查找算法。效率大大提升。<br>mybatis缓存包括：</p>
<ul>
<li>一级缓存：将查询到的数据存储到SqlSession（会话）中。</li>
<li>二级缓存：将查询到的数据存储到SqlSessionFactory（环境）中。</li>
<li>或者集成其它第三方的缓存：比如EhCache【Java语言开发的】、Memcache【C语言开发的】等。</li>
</ul>
<p><strong>缓存只针对于DQL语句，也就是说缓存机制只对应select语句。</strong></p>
<h2 id="14-1-一级缓存"><a href="#14-1-一级缓存" class="headerlink" title="14.1 一级缓存"></a>14.1 一级缓存</h2><p>一级缓存默认是开启的。不需要做任何配置。<br>原理：只要使用同一个SqlSession对象执行同一条SQL语句，就会走缓存。<br>模块名：mybatis-010-cache</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id获取Car信息。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Car <span class="title function_">selectById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">    select * from t_car where id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectById</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// 注意：不能使用我们封装的SqlSessionUtil工具类，因为使用的是threadlocal，我们需要不同的session对象</span></span><br><span class="line">        <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> builder.build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession1</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//先测同一个session，这里会走一级缓存</span></span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper1</span> <span class="operator">=</span> sqlSession1.getMapper(CarMapper.class);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car1</span> <span class="operator">=</span> mapper1.selectById(<span class="number">83L</span>);</span><br><span class="line">        System.out.println(car1);</span><br><span class="line"></span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper2</span> <span class="operator">=</span> sqlSession1.getMapper(CarMapper.class);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car2</span> <span class="operator">=</span> mapper2.selectById(<span class="number">83L</span>);</span><br><span class="line">        System.out.println(car2);<span class="comment">//结果是走缓存</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//再创建一个session，看看不同的会不会走缓存</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession2</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper3</span> <span class="operator">=</span> sqlSession1.getMapper(CarMapper.class);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car3</span> <span class="operator">=</span> mapper3.selectById(<span class="number">83L</span>);</span><br><span class="line">        System.out.println(car3);</span><br><span class="line"></span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper4</span> <span class="operator">=</span> sqlSession2.getMapper(CarMapper.class);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car4</span> <span class="operator">=</span> mapper4.selectById(<span class="number">83L</span>);</span><br><span class="line">        System.out.println(car4);</span><br><span class="line"><span class="comment">//结果是不走缓存，因为一级缓存是session，但不同的session对象就没有对应的缓存</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>什么情况下不走缓存？</p>
<ul>
<li>第一种：不同的SqlSession对象。</li>
<li>第二种：查询条件不一样，不走缓存。</li>
</ul>
<p>一级缓存失效情况包括两种：</p>
<ul>
<li>第一种：第一次查询和第二次查询之间，手动清空了一级缓存。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlSession.clearCache();</span><br></pre></td></tr></table></figure>

<ul>
<li>第二种：第一次查询和第二次查询之间，执行了增删改操作。【这个增删改和哪张表没有关系，只要有insert delete update操作，一级缓存就失效。】</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 保存账户信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insertAccount</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertAccount&quot;</span>&gt;</span></span><br><span class="line">  insert into t_act values(3, &#x27;act003&#x27;, 10000)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661155578490-1b1d260d-991a-44ef-8c94-ba68796c7f03.png#clientId=ubeb36f5f-42dd-4&from=paste&height=852&id=ua9306740&originHeight=852&originWidth=1133&originalType=binary&ratio=1&rotation=0&showTitle=false&size=88687&status=done&style=none&taskId=u8e6dacbe-ad3b-49f6-9174-ac1be7a67b7&title=&width=1133" alt="87026BA7-38F7-41c1-86B4-8462801F93BF.png"><br>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661155640234-bdba6b74-80cf-4604-8185-fd504994150d.png#clientId=ubeb36f5f-42dd-4&from=paste&height=356&id=u7ceb82d2&originHeight=356&originWidth=1047&originalType=binary&ratio=1&rotation=0&showTitle=false&size=54381&status=done&style=none&taskId=ubf72548b-7e6e-4e18-8c2a-b7dd2c30589&title=&width=1047" alt="CBCDA9A8-3949-4bd0-8D10-56888A4286C3.png"></p>
<h2 id="14-2-二级缓存"><a href="#14-2-二级缓存" class="headerlink" title="14.2 二级缓存"></a>14.2 二级缓存</h2><p>二级缓存的范围是SqlSessionFactory。<br>使用二级缓存需要具备以下几个条件：</p>
<ol>
<li>&lt;setting name&#x3D;”cacheEnabled” value&#x3D;”true”&gt; 全局性地开启或关闭所有映射器配置文件中已配置的任何缓存。默认就是true，无需设置。</li>
<li>在需要使用二级缓存的SqlMapper.xml文件中添加配置：<cache /></li>
<li>使用二级缓存的实体类对象必须是可序列化的，也就是必须实现java.io.Serializable接口</li>
<li>SqlSession对象关闭或提交之后，一级缓存中的数据才会被写入到二级缓存当中。此时二级缓存才可用。</li>
</ol>
<p>测试二级缓存：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span>/&gt;</span>加上后会在输出的信息里多一个缓存命中率的东西</span><br><span class="line">cache hit ratio xxx 0.0</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"><span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectById2</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession1</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession2</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper1</span> <span class="operator">=</span> sqlSession1.getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper2</span> <span class="operator">=</span> sqlSession2.getMapper(CarMapper.class);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 这行代码执行结束之后，实际上数据是缓存到一级缓存当中了。(sqlSession1是一级缓存。)</span></span><br><span class="line">    <span class="type">Car</span> <span class="variable">car1</span> <span class="operator">=</span> mapper1.selectById(<span class="number">83L</span>);</span><br><span class="line">    System.out.println(car1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//关键一步：如果这里不关闭Sqlsession1对象的话，二级缓存中还是没有数据的:关闭后sqlSession1的一级缓存中的数据会放到二级缓存当中。</span></span><br><span class="line">    sqlSession1.close();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 这行代码执行结束之后，实际上数据会缓存到一级缓存当中。(sqlSession2是一级缓存。)</span></span><br><span class="line">    <span class="type">Car</span> <span class="variable">car2</span> <span class="operator">=</span> mapper2.selectById(<span class="number">83L</span>);</span><br><span class="line">    System.out.println(car2);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 程序执行到这里的时候，会将sqlSession1这个一级缓存中的数据写入到二级缓存当中。</span></span><br><span class="line">	<span class="comment">//sqlSession1.close();</span></span><br><span class="line">	<span class="comment">// 程序执行到这里的时候，会将sqlSession2这个一级缓存中的数据写入到二级缓存当中。</span></span><br><span class="line">	sqlSession2.close();</span><br><span class="line">    </span><br><span class="line">    如果都在最后关闭，不是同一个session对象都不走一级缓存，就要查两次</span><br><span class="line">    如果在中间关闭，session1的会变成二级缓存，为什么session2能读取到缓存，因为虽然两个不是同一个会话，但都是同一个sqlSessionFactory创建的，所以走二级缓存</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661157492039-a04066a4-a824-4125-8533-e323bfd8bfdb.png#clientId=ubeb36f5f-42dd-4&from=paste&height=456&id=uf5c71836&originHeight=456&originWidth=1197&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85747&status=done&style=none&taskId=u001bd45e-7269-4f20-8895-37f7c9f2068&title=&width=1197" alt="4B715968-A13F-4fee-B41B-604504A1D847.png"><br><strong>二级缓存的失效：只要两次查询之间出现了增删改操作。二级缓存就会失效。【一级缓存也会失效】</strong><br><strong>二级缓存的相关配置：</strong><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661158385819-8074adeb-f769-48f5-8519-a79a515e8631.png#clientId=ubeb36f5f-42dd-4&from=paste&height=294&id=u7f47bc31&originHeight=294&originWidth=667&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24147&status=done&style=none&taskId=u7ec00183-f3f3-465e-abf6-c9edfafcc54&title=&width=667" alt="F7BACAAD-5DD9-43e8-A2A5-5AC787BAFFB4.png"></p>
<ol>
<li>eviction：指定从缓存中移除某个对象的淘汰算法。默认采用LRU策略。<ol>
<li>LRU：Least Recently Used。最近最少使用。优先淘汰在间隔时间内使用频率最低的对象，不是不常使用只是最近很少使用。(其实还有一种淘汰算法LFU，淘汰最不常用的对象。)</li>
<li>FIFO：First In First Out。一种先进先出的数据缓存器。先进入二级缓存的对象最先被淘汰，也就是最老的被淘汰。</li>
<li>SOFT：软引用。淘汰软引用指向的对象。具体算法和JVM的垃圾回收算法有关。</li>
<li>WEAK：弱引用。淘汰弱引用指向的对象。具体算法和JVM的垃圾回收算法有关。</li>
</ol>
</li>
<li>flushInterval：<ol>
<li>二级缓存的刷新时间间隔，刷新就会使缓存失效。单位毫秒。如果没有设置。就代表不刷新缓存，只要内存足够大，一直会向二级缓存中缓存数据。除非执行了增删改。</li>
</ol>
</li>
<li>readOnly：<ol>
<li>true：多条相同的sql语句执行之后返回的对象是共享的同一个。性能好。但是多线程并发可能会存在安全问题。</li>
<li>false：多条相同的sql语句执行之后返回的对象是副本，调用了clone方法。性能一般。但安全。</li>
</ol>
</li>
<li>size：<ol>
<li>设置二级缓存中最多可存储的java对象数量。默认值1024。</li>
</ol>
</li>
</ol>
<h2 id="14-3-MyBatis集成EhCache"><a href="#14-3-MyBatis集成EhCache" class="headerlink" title="14.3 MyBatis集成EhCache"></a>14.3 MyBatis集成EhCache</h2><p>集成EhCache是为了代替mybatis自带的二级缓存。一级缓存是无法替代的。<br>mybatis对外提供了接口，也可以集成第三方的缓存组件。比如EhCache、Memcache等。都可以。<br>EhCache是Java写的。Memcache是C语言写的。所以mybatis集成EhCache较为常见，按照以下步骤操作，就可以完成集成：</p>
<p>了解一下就好</p>
<p>第一步：引入mybatis整合ehcache的依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis集成ehcache的组件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.caches<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第二步：在类的根路径下新建echcache.xml文件，并提供以下配置信息。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;http://ehcache.org/ehcache.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">updateCheck</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--磁盘存储:将缓存中暂时不使用的对象,转移到硬盘,类似于Windows系统的虚拟内存--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">&quot;e:/ehcache&quot;</span>/&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!--defaultCache：默认的管理策略--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--eternal：设定缓存的elements是否永远不过期。如果为true，则缓存的数据始终有效，如果为false那么还要根据timeToIdleSeconds，timeToLiveSeconds判断--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--maxElementsInMemory：在内存中缓存的element的最大数目--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--overflowToDisk：如果内存中数据超过内存限制，是否要缓存到磁盘上--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--diskPersistent：是否在磁盘上持久化。指重启jvm后，数据是否有效。默认为false--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--timeToIdleSeconds：对象空闲时间(单位：秒)，指对象在多长时间没有被访问就会失效。只对eternal为false的有效。默认值0，表示一直可以访问--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--timeToLiveSeconds：对象存活时间(单位：秒)，指对象从创建到失效所需要的时间。只对eternal为false的有效。默认值0，表示一直可以访问--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--memoryStoreEvictionPolicy：缓存的3 种清空策略--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--FIFO：first in first out (先进先出)--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--LFU：Less Frequently Used (最少使用).意思是一直以来最少被使用的。缓存的元素有一个hit 属性，hit 值最小的将会被清出缓存--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--LRU：Least Recently Used(最近最少使用). (ehcache 默认值).缓存的元素有一个时间戳，当缓存容量满了，而又需要腾出地方来缓存新的元素的时候，那么现有缓存元素中时间戳离当前时间最远的元素将被清出缓存--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultCache</span> <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span> <span class="attr">maxElementsInMemory</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">overflowToDisk</span>=<span class="string">&quot;false&quot;</span> <span class="attr">diskPersistent</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;0&quot;</span> <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;600&quot;</span> <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第三步：修改SqlMapper.xml文件中的<cache/>标签，添加type属性。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--集成Ehcache组件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>第四步：编写测试程序使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectById2</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession1</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper1</span> <span class="operator">=</span> sqlSession1.getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car1</span> <span class="operator">=</span> mapper1.selectById(<span class="number">83L</span>);</span><br><span class="line">    System.out.println(car1);</span><br><span class="line">    </span><br><span class="line">    sqlSession1.close();</span><br><span class="line">    </span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession2</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper2</span> <span class="operator">=</span> sqlSession2.getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car2</span> <span class="operator">=</span> mapper2.selectById(<span class="number">83L</span>);</span><br><span class="line">    System.out.println(car2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661162595603-3aeecedf-d1f5-4b53-bd76-ee3c52f014fd.png#clientId=ubeb36f5f-42dd-4&from=paste&height=400&id=ua7ee1609&originHeight=400&originWidth=1129&originalType=binary&ratio=1&rotation=0&showTitle=false&size=70384&status=done&style=none&taskId=u14da606c-a1cb-42e2-babd-184e7bab9e4&title=&width=1129" alt="509D28EA-B111-4151-AFC3-E6D3C3BB3F52.png"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=YYR3y&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p>
<h1 id="十五、MyBatis的逆向工程"><a href="#十五、MyBatis的逆向工程" class="headerlink" title="十五、MyBatis的逆向工程"></a>十五、MyBatis的逆向工程</h1><p>所谓的逆向工程是：根据数据库表逆向生成Java的pojo类，SqlMapper.xml文件，以及Mapper接口类等。<br>要完成这个工作，需要借助别人写好的逆向工程插件。<br>思考：使用这个插件的话，需要给这个插件配置哪些信息？</p>
<ul>
<li>pojo类名、包名以及生成位置。</li>
<li>SqlMapper.xml文件名以及生成位置。</li>
<li>Mapper接口名以及生成位置。</li>
<li>连接数据库的信息。</li>
<li>指定哪些表参与逆向工程。</li>
<li>……</li>
</ul>
<h2 id="15-1-逆向工程配置与生成"><a href="#15-1-逆向工程配置与生成" class="headerlink" title="15.1 逆向工程配置与生成"></a>15.1 逆向工程配置与生成</h2><h3 id="第一步：基础环境准备"><a href="#第一步：基础环境准备" class="headerlink" title="第一步：基础环境准备"></a>第一步：基础环境准备</h3><p>新建模块：mybatis-011-generator<br>打包方式：jar</p>
<h3 id="第二步：在pom中添加逆向工程插件"><a href="#第二步：在pom中添加逆向工程插件" class="headerlink" title="第二步：在pom中添加逆向工程插件"></a>第二步：在pom中添加逆向工程插件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--定制构建过程--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--可配置多个插件--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--其中的一个插件：mybatis逆向工程插件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--插件的GAV坐标--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--允许覆盖，不允许的话生成的东西可能是追加的方式添加，会出错--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">overwrite</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overwrite</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--插件的依赖--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql驱动依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="第三步：配置generatorConfig-xml"><a href="#第三步：配置generatorConfig-xml" class="headerlink" title="第三步：配置generatorConfig.xml"></a>第三步：配置generatorConfig.xml</h3><p>该文件名必须叫做：generatorConfig.xml<br>该文件必须放在类的根路径下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        targetRuntime有两个值：</span></span><br><span class="line"><span class="comment">            MyBatis3Simple：生成的是基础版，只有基本的增删改查。</span></span><br><span class="line"><span class="comment">            MyBatis3：生成的是增强版，除了基本的增删改查之外还有复杂的增删改查。</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;DB2Tables&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--防止生成重复代码--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.generator.plugins.UnmergeableXmlMappersPlugin&quot;</span>/&gt;</span></span><br><span class="line">      </span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span>注释信息的生成</span><br><span class="line">            <span class="comment">&lt;!--是否去掉生成日期--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressDate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--是否去除注释--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--连接数据库信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/powernode&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">password</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 生成pojo包名和位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.powernode.mybatis.pojo&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--是否开启子包，没有这一项的话会直接把这个当做一个文件夹的名字生成--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--是否去除字段名的前后空白--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 生成SQL映射文件的包名和位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.powernode.mybatis.mapper&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/resources&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--是否开启子包--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 生成Mapper接口的包名和位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span></span></span><br><span class="line"><span class="tag">                <span class="attr">type</span>=<span class="string">&quot;xmlMapper&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">targetPackage</span>=<span class="string">&quot;com.powernode.mybatis.mapper&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 表名和对应的实体类名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;t_car&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Car&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="第四步：运行插件"><a href="#第四步：运行插件" class="headerlink" title="第四步：运行插件"></a>第四步：运行插件</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661220807303-79730f99-9a3c-4394-a29f-910eccd698cc.png#clientId=u50a30195-6f18-4&from=paste&height=309&id=RBX4s&originHeight=309&originWidth=521&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16729&status=done&style=none&taskId=uc42c264a-2b51-4500-8e42-33afc6d608a&title=&width=521" alt="14F24AF8-789F-4267-9694-0FDF158366C1.png"></p>
<h2 id="15-2-测试逆向工程生成的是否好用"><a href="#15-2-测试逆向工程生成的是否好用" class="headerlink" title="15.2 测试逆向工程生成的是否好用"></a>15.2 测试逆向工程生成的是否好用</h2><h3 id="第一步：环境准备"><a href="#第一步：环境准备" class="headerlink" title="第一步：环境准备"></a>第一步：环境准备</h3><ul>
<li>依赖：mybatis依赖、mysql驱动依赖、junit依赖、logback依赖</li>
<li>jdbc.properties</li>
<li>mybatis-config.xml</li>
<li>logback.xml</li>
</ul>
<h3 id="第二步：编写测试程序"><a href="#第二步：编写测试程序" class="headerlink" title="第二步：编写测试程序"></a>第二步：编写测试程序</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GeneratorTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 生成的CarExample类负责封装查询条件的</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGenerator</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(CarMapper.class);</span><br><span class="line">        <span class="comment">// 增</span></span><br><span class="line">        <span class="comment">/*Car car = new Car();</span></span><br><span class="line"><span class="comment">        car.setCarNum(&quot;1111&quot;);</span></span><br><span class="line"><span class="comment">        car.setBrand(&quot;比亚迪唐&quot;);</span></span><br><span class="line"><span class="comment">        car.setGuidePrice(new BigDecimal(30.0));</span></span><br><span class="line"><span class="comment">        car.setProduceTime(&quot;2010-10-12&quot;);</span></span><br><span class="line"><span class="comment">        car.setCarType(&quot;燃油车&quot;);</span></span><br><span class="line"><span class="comment">        int count = mapper.insert(car);</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;插入了几条记录：&quot; + count);*/</span></span><br><span class="line">        <span class="comment">// 删</span></span><br><span class="line">        <span class="comment">/*int count = mapper.deleteByPrimaryKey(83L);</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;删除了几条记录：&quot; + count);*/</span></span><br><span class="line">        <span class="comment">// 改</span></span><br><span class="line">        <span class="comment">// 根据主键修改</span></span><br><span class="line">        <span class="comment">/*Car car = new Car();</span></span><br><span class="line"><span class="comment">        car.setId(89L);</span></span><br><span class="line"><span class="comment">        car.setGuidePrice(new BigDecimal(20.0));</span></span><br><span class="line"><span class="comment">        car.setCarType(&quot;新能源&quot;);</span></span><br><span class="line"><span class="comment">        int count = mapper.updateByPrimaryKey(car);</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;更新了几条记录：&quot; + count);*/</span></span><br><span class="line">        <span class="comment">// 根据主键选择性修改</span></span><br><span class="line">        <span class="comment">/*car = new Car();</span></span><br><span class="line"><span class="comment">        car.setId(89L);</span></span><br><span class="line"><span class="comment">        car.setCarNum(&quot;3333&quot;);</span></span><br><span class="line"><span class="comment">        car.setBrand(&quot;宝马520Li&quot;);</span></span><br><span class="line"><span class="comment">        car.setProduceTime(&quot;1999-01-10&quot;);</span></span><br><span class="line"><span class="comment">        count = mapper.updateByPrimaryKeySelective(car);</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;更新了几条记录：&quot; + count);*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查一个</span></span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> mapper.selectByPrimaryKey(<span class="number">89L</span>);</span><br><span class="line">        System.out.println(car);</span><br><span class="line">        <span class="comment">// 查询所有(selectByExample，根据条件查询，如果条件是null表示没有条件。)</span></span><br><span class="line">        List&lt;Car&gt; cars = mapper.selectByExample(<span class="literal">null</span>);</span><br><span class="line">        cars.forEach(c -&gt; System.out.println(c));</span><br><span class="line">        <span class="comment">// 多条件查询</span></span><br><span class="line">        <span class="comment">//封装条件，通过CarExample对象来封装查询条件，也就是where后面的那些</span></span><br><span class="line">        <span class="comment">// QBC 风格：Query By Criteria 一种查询方式，比较面向对象，看不到sql语句。</span></span><br><span class="line">        <span class="type">CarExample</span> <span class="variable">carExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CarExample</span>();</span><br><span class="line">        <span class="comment">//调用carExample.createCriteria()方法来创建查询条件，后面的是品牌等于什么什么，相当于where brand = &quot;丰田霸道&quot;</span></span><br><span class="line">        carExample.createCriteria()</span><br><span class="line">                .andBrandEqualTo(<span class="string">&quot;丰田霸道&quot;</span>)</span><br><span class="line">                .andGuidePriceGreaterThan(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">60.0</span>));<span class="comment">//这个是大于60万的意思</span></span><br><span class="line">  <span class="comment">//如果要加or就在上面的语句加个分号，然后.or继续添加</span></span><br><span class="line">        carExample.or().andProduceTimeBetween(<span class="string">&quot;2000-10-11&quot;</span>, <span class="string">&quot;2022-10-11&quot;</span>);</span><br><span class="line"></span><br><span class="line">        mapper.selectByExample(carExample);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=IUD4s&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p>
<h1 id="十六、MyBatis使用PageHelper"><a href="#十六、MyBatis使用PageHelper" class="headerlink" title="十六、MyBatis使用PageHelper"></a>十六、MyBatis使用PageHelper</h1><h2 id="16-1-limit分页"><a href="#16-1-limit分页" class="headerlink" title="16.1 limit分页"></a>16.1 limit分页</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/NoteImg/mybatis/%E8%80%81%E6%9D%9CMyBatis/image-20251210031226614.png" alt="image-20251210031226614"></p>
<p>mysql的limit后面两个数字：</p>
<ul>
<li>第一个数字：startIndex（起始下标。下标从0开始。）</li>
<li>第二个数字：pageSize（每页显示的记录条数）</li>
</ul>
<p>假设已知页码pageNum，还有每页显示的记录条数pageSize，第一个数字可以动态的获取吗？</p>
<ul>
<li>startIndex &#x3D; (pageNum - 1) * pageSize</li>
</ul>
<p>所以，标准通用的mysql分页SQL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">  <span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">  tableName ...... </span><br><span class="line">limit </span><br><span class="line">  (pageNum <span class="operator">-</span> <span class="number">1</span>) <span class="operator">*</span> pageSize, pageSize</span><br></pre></td></tr></table></figure>
<p>使用mybatis应该怎么做？<br>模块名：mybatis-012-page</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 通过分页的方式获取Car列表</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> startIndex 页码</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pageSize 每页显示记录条数</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    List&lt;Car&gt; <span class="title function_">selectAllByPage</span><span class="params">(<span class="meta">@Param(&quot;startIndex&quot;)</span> Integer startIndex, <span class="meta">@Param(&quot;pageSize&quot;)</span> Integer pageSize)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllByPage&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">        select * from t_car limit #&#123;startIndex&#125;,#&#123;pageSize&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarMapperTest</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByPage</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="comment">// 获取每页显示的记录条数</span></span><br><span class="line">		<span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">		<span class="comment">// 显示第几页:页码</span></span><br><span class="line">		<span class="type">int</span> <span class="variable">pageNum</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">		<span class="comment">// 计算开始下标</span></span><br><span class="line">		<span class="type">int</span> startIndex=(pageNum-<span class="number">1</span>)* pageSize;</span><br><span class="line">		SqlSession sqlSession=SqlSessionUtil.openSession();</span><br><span class="line">		CarMapper mapper=sqlSession.getMapper(CarMapper.class);</span><br><span class="line">		List&lt;Car&gt; cars = mapper.selectByPage(startIndex, pageSize);</span><br><span class="line">		cars.forEach(car -&gt;System.out.println&#123;car));</span><br><span class="line">		sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661239750003-ff5657d8-9d9a-4c96-b908-eb5a644525bd.png#clientId=u7b0692f6-7a01-4&from=paste&height=181&id=uee073f3b&originHeight=181&originWidth=1075&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31260&status=done&style=none&taskId=ufee64ea5-a73b-42bd-be29-f28c8af0a07&title=&width=1075" alt="8603C746-8E85-4cfd-9D9D-4305643249E0.png"><br>获取数据不难，难的是获取分页相关的数据比较难。可以借助mybatis的PageHelper插件。</p>
<h2 id="16-3-PageHelper插件"><a href="#16-3-PageHelper插件" class="headerlink" title="16.3 PageHelper插件"></a>16.3 PageHelper插件</h2><p>使用PageHelper插件进行分页，更加的便捷。</p>
<h3 id="第一步：引入依赖"><a href="#第一步：引入依赖" class="headerlink" title="第一步：引入依赖"></a>第一步：引入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="第二步：在mybatis-config-xml文件中配置插件"><a href="#第二步：在mybatis-config-xml文件中配置插件" class="headerlink" title="第二步：在mybatis-config.xml文件中配置插件"></a>第二步：在mybatis-config.xml文件中配置插件</h3><p>typeAliases标签下面进行配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis分页的拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="第三步：编写Java代码"><a href="#第三步：编写Java代码" class="headerlink" title="第三步：编写Java代码"></a>第三步：编写Java代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询所有的Car，通过分页查询插件PageHelper元成。</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line">&lt;/select &gt;</span><br></pre></td></tr></table></figure>
<p>关键点：</p>
<ul>
<li>在查询语句之前开启分页功能。</li>
<li>在查询语句之后封装PageInfo对象。（PageInfo对象将来会存储到request域当中。在页面上展示。）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPageHelper</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.openSession();</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(CarMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一定一定一定要注意:在执行DQL语句之前。开启分页功能:</span></span><br><span class="line">		<span class="type">int</span> <span class="variable">pageNum</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">		<span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">		PageHelper.startPage(pageNum,pagesize);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 开启分页</span></span><br><span class="line">    PageHelper.startPage(pageNum,pagesize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行查询语句</span></span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectAll();</span><br><span class="line">	<span class="comment">//cars.forEach(car -&gt; System.out.println(car));</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 获取分页信息对象</span></span><br><span class="line">    <span class="comment">// PageInfo对象是PageHelper插件提供的，用来封装分页相关的信息的对象</span></span><br><span class="line">    <span class="comment">//把上面查到的集合car传进去，后面是页面下方1页2页3页的那个导航按钮数量</span></span><br><span class="line">    PageInfo&lt;Car&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(cars, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(pageInfo);</span><br><span class="line">    </span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PageInfo&#123;</span><br><span class="line">  pageNum=2, pageSize=2, size=2, startRow=3, endRow=4, total=6, pages=3, </span><br><span class="line">  list=Page&#123;count=true, pageNum=2, pageSize=2, startRow=2, endRow=4, total=6, pages=3, reasonable=false, pageSizeZero=false&#125;</span><br><span class="line">  [Car&#123;id=86, carNum=&#x27;1234&#x27;, brand=&#x27;丰田霸道&#x27;, guidePrice=50.5, produceTime=&#x27;2020-10-11&#x27;, carType=&#x27;燃油车&#x27;&#125;, </span><br><span class="line">  Car&#123;id=87, carNum=&#x27;1234&#x27;, brand=&#x27;丰田霸道&#x27;, guidePrice=50.5, produceTime=&#x27;2020-10-11&#x27;, carType=&#x27;燃油车&#x27;&#125;], </span><br><span class="line">  prePage=1, nextPage=3, isFirstPage=false, isLastPage=false, hasPreviousPage=true, hasNextPage=true, </span><br><span class="line">  navigatePages=5, navigateFirstPage=1, navigateLastPage=3, navigatepageNums=[1, 2, 3]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=GWW3k&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p>
<h1 id="十七、MyBatis的注解式开发"><a href="#十七、MyBatis的注解式开发" class="headerlink" title="十七、MyBatis的注解式开发"></a>十七、MyBatis的注解式开发</h1><p>mybatis中也提供了注解式开发方式，采用注解可以减少Sql映射文件的配置。<br>当然，使用注解式开发的话，sql语句是写在java程序中的，这种方式也会给sql语句的维护带来成本。<br>官方是这么说的：</p>
<blockquote>
<p>使用注解来映射简单语句会使代码显得更加简洁，但对于稍微复杂一点的语句，Java 注解不仅力不从心，还会让你本就复杂的 SQL 语句更加混乱不堪。 因此，如果你需要做一些很复杂的操作，最好用 XML 来映射语句。</p>
</blockquote>
<p>使用注解编写复杂的SQL是这样的：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661243511174-55bc0ee4-9561-448d-ad21-f02591d88798.png#clientId=u7b0692f6-7a01-4&from=paste&height=115&id=u8da4b2f4&originHeight=115&originWidth=572&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6952&status=done&style=none&taskId=ubf0f9985-cab0-442b-a0b7-1119ff8eb90&title=&width=572" alt="7B6EA744-14B7-4f41-94DC-AD005612A026.png"><br>原则：简单sql可以注解。复杂sql使用xml。<br>模块名：mybatis-013-annotation<br>打包方式：jar<br>依赖：mybatis，mysql驱动，junit，logback<br>配置文件：jdbc.properties、mybatis-config.xml、logback.xml<br>pojo：com.powernode.mybatis.pojo.Car<br>mapper接口：com.powernode.mybatis.mapper.CarMapper</p>
<h2 id="17-1-Insert"><a href="#17-1-Insert" class="headerlink" title="17.1 @Insert"></a>17.1 @Insert</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert(value=&quot;insert into t_car values(null,#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(Car car)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(CarMapper.class);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="literal">null</span>, <span class="string">&quot;1112&quot;</span>, <span class="string">&quot;卡罗拉&quot;</span>, <span class="number">30.0</span>, <span class="string">&quot;2000-10-10&quot;</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> mapper.insert(car);</span><br><span class="line">        System.out.println(<span class="string">&quot;插入了几条记录：&quot;</span> + count);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="17-2-Delete"><a href="#17-2-Delete" class="headerlink" title="17.2 @Delete"></a>17.2 @Delete</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Delete(&quot;delete from t_car where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(CarMapper.class);</span><br><span class="line">    mapper.deleteById(<span class="number">89L</span>);</span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="17-3-Update"><a href="#17-3-Update" class="headerlink" title="17.3 @Update"></a>17.3 @Update</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Update(&quot;update t_car set car_num=#&#123;carNum&#125;,brand=#&#123;brand&#125;,guide_price=#&#123;guidePrice&#125;,produce_time=#&#123;produceTime&#125;,car_type=#&#123;carType&#125; where id=#&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span><span class="params">(Car car)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="number">88L</span>,<span class="string">&quot;1001&quot;</span>, <span class="string">&quot;凯美瑞&quot;</span>, <span class="number">30.0</span>,<span class="string">&quot;2000-11-11&quot;</span>, <span class="string">&quot;新能源&quot;</span>);</span><br><span class="line">    mapper.update(car);</span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="17-4-Select"><a href="#17-4-Select" class="headerlink" title="17.4 @Select"></a>17.4 @Select</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from t_car where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;id&quot;, property = &quot;id&quot;, id = true),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;car_num&quot;, property = &quot;carNum&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;brand&quot;, property = &quot;brand&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;guide_price&quot;, property = &quot;guidePrice&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;produce_time&quot;, property = &quot;produceTime&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;car_type&quot;, property = &quot;carType&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line">Car <span class="title function_">selectById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectById</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">carMapper</span> <span class="operator">=</span> sqlSession.getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> carMapper.selectById(<span class="number">88L</span>);</span><br><span class="line">    System.out.println(car);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/21376908/1661245790082-b0ae21de-bdc7-41ba-a937-31bad62d1ade.png#clientId=u7b0692f6-7a01-4&from=paste&height=134&id=u5ce27a82&originHeight=134&originWidth=1045&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14657&status=done&style=none&taskId=u724a0567-f216-46ed-a808-96dc712c484&title=&width=1045" alt="76ADC80A-E5F0-4805-92F2-E98A4D92EBA0.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/Shelter67">Shelter</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://localhost:4000/posts/d2dc75e3.html">http://localhost:4000/posts/d2dc75e3.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://localhost:4000" target="_blank">Shelter</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SSM/">SSM</a><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/Mybatis/">Mybatis</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.dreamshelter.cn/blog/source/img/cover/18.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/4a17b156.html" title="hexo指令"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/20.jpg" onerror="onerror=null;src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">hexo指令</div></div><div class="info-2"><div class="info-item-1">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;  More info: Writing Run server1$ hexo server  More info: Server Generate static files1$ hexo generate  More info: Generating Deploy to remote sites1$ hexo deploy  More info: Deployment </div></div></div></a><a class="pagination-related" href="/posts/4d910bb8.html" title="Servlet-JSP-课堂笔记"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/7.jpg" onerror="onerror=null;src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Servlet-JSP-课堂笔记</div></div><div class="info-2"><div class="info-item-1">关于直播 什么时间直播？ 晚上8:00到10:00   每周直播几天？ 3天（周一、周三、周五） 本周比较特殊：周四周五周六三天直播，从下周开始就是一三五直播。   直播什么内容？ 从JavaWEB开始。（Servlet为核心，从Servlet开始学习。） JSP（JSP使用较少了，但是还有用，所以时间上少一些。快速地学习一下JSP。） AJAX（异步通信技术。） jQuery（JavaScript库。） MyBatis Spring SpringMVC SpringBoot SpringCloud ….    需要提前准备了哪些技术，接下来的课才能听懂？ JavaSE（Java语言的标准版，Java提供的最基本的类库） Java的开发环境搭建 Java的基础语法 Java的面向对象 数组 常用类 异常 集合 多线程 IO流 反射机制 注解Annotation …..   MySQL（数据库） 最基本的要求是：能够编写增删改查等简单的SQL语句即可。   JDBC（Java语言链接数据库） 这是一套Java语言链接数据库的接口。   WEB前端（会一些） HTML（网页） CSS...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/d6ebbbdf.html" title="Spring Boot 3"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/10.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-04</div><div class="info-item-2">Spring Boot 3</div></div><div class="info-2"><div class="info-item-1">第1章 First Spring Boot认识Spring Boot我们来看看官方是如何介绍的： https://docs.spring.io/spring-boot/index.html   Spring Boot倡导约定优于配置，将简化开发发挥到极致。使用Spring Boot框架可以快速构建Spring应用，再也不需要大量的繁琐的的各种配置。Spring Boot框架设计的目标是：程序员关注业务逻辑就行了，环境方面的事儿交给Spring Boot就行。 Spring Boot特性：  快速创建独立的Spring应用程序。（Spring支持的SpringBoot都支持，也就是说SpringBoot全方位支持IoC，AOP等） 嵌入式的Tomcat、Jetty、Undertow容器。（web服务器本身就是几个jar包，Spring Boot框架自动嵌入了。） 需要什么功能时只需要引入对应的starter启动器即可。（启动器可以自动管理这个功能相关的依赖，自动管理依赖版本的控制） 尽最大努力，最大可能的自动配置Spring应用和第三方库。（例如：如果要进行事务的控制，不用做任何事...</div></div></div></a><a class="pagination-related" href="/posts/7d713e54.html" title="Spirng速成"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/9.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-18</div><div class="info-item-2">Spirng速成</div></div><div class="info-2"><div class="info-item-1"> 给分成了三层，后面的mapper就是mybatis的，如果要获取其他对象就需要在这里面创建类，比如BookService2 b &#x3D; new BookService2这样，但只要一改名字，就需要把所有的对象名字都改，这样耦合度太高。就需要用到spring容器来进行统一管理 ioc就是控制反转的意思，把创建对象的权利交给spring容器  会有一个配置文件叫applicationcontext.xml，里面存放了bean这个，id就是名字，class是类型，然后他自动通过反射机制创建对象，然后放到spring容器里，这个容器可以理解成一个筐，苹果放一个筐梨放一个筐，然后再从这个容器里读取到java程序    1234&lt;bean id = &quot;b&quot; class = &#x27;com.msb.pojo.Book&#x27;&gt;	&lt;property name=&quot;id&quot; value=&quot;1&quot;&gt;&lt;/property&gt;    &lt;property name=&quot;name&quot;...</div></div></div></a><a class="pagination-related" href="/posts/e25feb6e.html" title="黑马程序员SSM"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/4.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-03</div><div class="info-item-2">黑马程序员SSM</div></div><div class="info-2"><div class="info-item-1"> spring核心概念   目标:充分解耦 使用IoC容器管理bean(IoC) 在IoC容器内将有依赖关系的bean进行关系绑定(DI)   最终效果 使用对象时不仅可以直接从IoC容器中获取，并且获取到的bean已经绑定了所有的依赖关系    IoC入门案例思路分析 管理什么?(Service与Dao) 如何将被管理的对象告知IoC容器?(配置) 被管理的对象交给IoC容器，如何获取到IoC容器?(接口) IoC容器得到后，如何从容器中获取bean?(接口方法) 使用Spring导入哪些坐标?(pom.xm1)  先导入spring依赖，然后新建 这个就是spring的配置文件，取名applicationContext.xml 123456&lt;!--1.导入spring的坐标spring-context，对应版本是5.2.10.RELEASE--&gt;&lt;!--2.配置bean，id随便写，class对应要管理的对象--&gt;&lt;bean id=&quot;bookDao&quot; class=&quot;com.itheima.dao.impl.BookD...</div></div></div></a><a class="pagination-related" href="/posts/9c933fc9.html" title="学习Maven"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/18.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-14</div><div class="info-item-2">学习Maven</div></div><div class="info-2"><div class="info-item-1">maven简介https://www.bilibili.com/video/BV1uApMeWErY?spm_id_from=333.788.videopod.sections&amp;vd_source=b0128143be22d1783a42f5fbf34d9d25 pom.xml 定义了项目的配置、依赖、插件、以及构建的过程 Maven仓库就是存放jiar包的地方，按照作用范围可以分为  本地仓库  就是电脑上的本地目录，默认在  一定要是一个没有中文的路径下。    远程仓库  一般是一个公司或者组织内部搭建的一个仓库，用来给内部的项目提供统一的依赖管理，避免jar包的重复下载 也可以通过中央仓库下载，是Maven官方维护的一个仓库 ，开源jar包都可以在这里找到   私服   maven安装和下载Maven官网：https://maven.apache.org/ Maven下载地址：https://maven.apache.org/download.cgi Nexus下载地址：https://help.sonatype.com/en/download.html 环境变量...</div></div></div></a><a class="pagination-related" href="/posts/4d910bb8.html" title="Servlet-JSP-课堂笔记"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/7.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-14</div><div class="info-item-2">Servlet-JSP-课堂笔记</div></div><div class="info-2"><div class="info-item-1">关于直播 什么时间直播？ 晚上8:00到10:00   每周直播几天？ 3天（周一、周三、周五） 本周比较特殊：周四周五周六三天直播，从下周开始就是一三五直播。   直播什么内容？ 从JavaWEB开始。（Servlet为核心，从Servlet开始学习。） JSP（JSP使用较少了，但是还有用，所以时间上少一些。快速地学习一下JSP。） AJAX（异步通信技术。） jQuery（JavaScript库。） MyBatis Spring SpringMVC SpringBoot SpringCloud ….    需要提前准备了哪些技术，接下来的课才能听懂？ JavaSE（Java语言的标准版，Java提供的最基本的类库） Java的开发环境搭建 Java的基础语法 Java的面向对象 数组 常用类 异常 集合 多线程 IO流 反射机制 注解Annotation …..   MySQL（数据库） 最基本的要求是：能够编写增删改查等简单的SQL语句即可。   JDBC（Java语言链接数据库） 这是一套Java语言链接数据库的接口。   WEB前端（会一些） HTML（网页） CSS...</div></div></div></a><a class="pagination-related" href="/posts/6c92115f.html" title="Spring"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/4.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-20</div><div class="info-item-2">Spring</div></div><div class="info-2"><div class="info-item-1">十五、面向切面编程AOPIoC使软件组件松耦合。AOP让你能够捕捉系统中经常使用的功能，把它转化成组件。AOP（Aspect Oriented Programming）：面向切面编程，面向方面编程。（AOP是一种编程技术）AOP是对OOP的补充延伸。AOP底层使用的就是动态代理来实现的。Spring的AOP使用的动态代理是：JDK动态代理 + CGLIB动态代理技术。Spring在这两种动态代理中灵活切换，如果是代理接口，会默认使用JDK动态代理，如果要代理某个类，这个类没有实现接口，就会切换使用CGLIB。当然，你也可以强制通过一些配置让Spring只使用CGLIB。 15.1 AOP介绍一般一个系统当中都会有一些系统服务，例如：日志、事务管理、安全等。这些系统服务被称为：交叉业务这些交叉业务几乎是通用的，不管你是做银行账户转账，还是删除用户数据。日志、事务管理、安全，这些都是需要做的。如果在每一个业务处理过程当中，都掺杂这些交叉业务代码进去的话，存在两方面问题：  第一：交叉业务代码在多个业务流程中反复出现，显然这个交叉业务代码没有得到复用。并且修改这些交叉业务代码的话，需要...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/touxiang.jpg" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Shelter</div><div class="author-info-description">记录自己的成长日志</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Shelter67"><i class="fab fa-github"></i><span>没有什么star的github</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Shelter67" target="_blank" title="GitHub"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1830191738@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://space.bilibili.com/8416212" target="_blank" title="Bilibili"><i class="fab fa-bilibili" style="color: #fb7299;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的小小博客！都是基于hexo框架使用，魔改了一些地方，表现得有些二次元，有个博客希望能在未来工作简历上成为加分项吧，但是弄起来还真的挺好玩的</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81MyBatis%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">一、MyBatis概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E6%A1%86%E6%9E%B6"><span class="toc-number">2.1.</span> <span class="toc-text">1.1 框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84"><span class="toc-number">2.2.</span> <span class="toc-text">1.2 三层架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-JDBC%E4%B8%8D%E8%B6%B3"><span class="toc-number">2.3.</span> <span class="toc-text">1.3 JDBC不足</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E4%BA%86%E8%A7%A3MyBatis"><span class="toc-number">2.4.</span> <span class="toc-text">1.4 了解MyBatis</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81MyBatis%E5%85%A5%E9%97%A8%E7%A8%8B%E5%BA%8F"><span class="toc-number">3.</span> <span class="toc-text">二、MyBatis入门程序</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E7%89%88%E6%9C%AC"><span class="toc-number">3.1.</span> <span class="toc-text">2.1 版本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E7%89%88%E6%9C%AC%EF%BC%9A"><span class="toc-number">3.1.1.</span> <span class="toc-text">软件版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E7%89%88%E6%9C%AC%EF%BC%9A"><span class="toc-number">3.1.2.</span> <span class="toc-text">组件版本：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-MyBatis%E4%B8%8B%E8%BD%BD"><span class="toc-number">3.2.</span> <span class="toc-text">2.2 MyBatis下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-MyBatis%E5%85%A5%E9%97%A8%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E6%AD%A5%E9%AA%A4"><span class="toc-number">3.3.</span> <span class="toc-text">2.3 MyBatis入门程序开发步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-MyBatis%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%AF%94%E8%BE%83%E5%AE%8C%E6%95%B4%E7%9A%84%E4%BB%A3%E7%A0%81%E5%86%99%E6%B3%95"><span class="toc-number">3.4.</span> <span class="toc-text">2.5 MyBatis第一个比较完整的代码写法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-%E5%BC%95%E5%85%A5JUnit"><span class="toc-number">3.5.</span> <span class="toc-text">2.6 引入JUnit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E6%AD%A5%EF%BC%9A%E7%BC%96%E5%86%99AccountService%E6%8E%A5%E5%8F%A3%E4%BB%A5%E5%8F%8AAccountServiceImpl"><span class="toc-number">3.5.1.</span> <span class="toc-text">第七步：编写AccountService接口以及AccountServiceImpl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%85%AB%E6%AD%A5%EF%BC%9A%E7%BC%96%E5%86%99AccountController"><span class="toc-number">3.5.2.</span> <span class="toc-text">第八步：编写AccountController</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-MyBatis%E5%AF%B9%E8%B1%A1%E4%BD%9C%E7%94%A8%E5%9F%9F%E4%BB%A5%E5%8F%8A%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98"><span class="toc-number">3.6.</span> <span class="toc-text">6.4 MyBatis对象作用域以及事务问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis%E6%A0%B8%E5%BF%83%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">3.6.1.</span> <span class="toc-text">MyBatis核心对象的作用域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SqlSessionFactoryBuilder"><span class="toc-number">3.6.1.1.</span> <span class="toc-text">SqlSessionFactoryBuilder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SqlSessionFactory"><span class="toc-number">3.6.1.2.</span> <span class="toc-text">SqlSessionFactory</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SqlSession%EF%BC%88%E4%BF%9D%E8%AF%81%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B%E5%AF%B9%E5%BA%94%E4%B8%80%E4%B8%AASqlSession%EF%BC%89"><span class="toc-number">3.6.1.3.</span> <span class="toc-text">SqlSession（保证一个线程对应一个SqlSession）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98"><span class="toc-number">3.6.2.</span> <span class="toc-text">事务问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5-%E5%88%86%E6%9E%90%E5%BD%93%E5%89%8D%E7%A8%8B%E5%BA%8F%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">3.7.</span> <span class="toc-text">6.5 分析当前程序存在的问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E4%BD%BF%E7%94%A8javassist%E7%94%9F%E6%88%90%E7%B1%BB"><span class="toc-number">4.</span> <span class="toc-text">七、使用javassist生成类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-Javassist%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">4.1.</span> <span class="toc-text">7.1 Javassist的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E4%BD%BF%E7%94%A8Javassist%E7%94%9F%E6%88%90DaoImpl%E7%B1%BB"><span class="toc-number">4.2.</span> <span class="toc-text">7.2 使用Javassist生成DaoImpl类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81MyBatis%E4%B8%AD%E6%8E%A5%E5%8F%A3%E4%BB%A3%E7%90%86%E6%9C%BA%E5%88%B6%E5%8F%8A%E4%BD%BF%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">八、MyBatis中接口代理机制及使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%E3%80%81MyBatis%E5%B0%8F%E6%8A%80%E5%B7%A7"><span class="toc-number">6.</span> <span class="toc-text">九、MyBatis小技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-%E5%92%8C"><span class="toc-number">6.1.</span> <span class="toc-text">9.1 #{}和${}</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">6.1.1.</span> <span class="toc-text">使用#{}</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="toc-number">6.1.2.</span> <span class="toc-text">使用${}</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E5%BF%85%E9%A1%BB%E4%BD%BF%E7%94%A8"><span class="toc-number">6.1.3.</span> <span class="toc-text">什么情况下必须使用${}</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%BC%E6%8E%A5%E8%A1%A8%E5%90%8D"><span class="toc-number">6.1.4.</span> <span class="toc-text">拼接表名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="toc-number">6.1.5.</span> <span class="toc-text">批量删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.1.6.</span> <span class="toc-text">模糊查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.1.6.1.</span> <span class="toc-text">实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-typeAliases%EF%BC%88%E8%B5%B7%E5%88%AB%E5%90%8D%EF%BC%89"><span class="toc-number">6.2.</span> <span class="toc-text">9.2 typeAliases（起别名）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%9AtypeAlias"><span class="toc-number">6.2.1.</span> <span class="toc-text">第一种方式：typeAlias</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%9Apackage"><span class="toc-number">6.2.2.</span> <span class="toc-text">第二种方式：package</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-mappers"><span class="toc-number">6.3.</span> <span class="toc-text">9.3 mappers</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#resource"><span class="toc-number">6.3.1.</span> <span class="toc-text">resource</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#url"><span class="toc-number">6.3.2.</span> <span class="toc-text">url</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#class"><span class="toc-number">6.3.3.</span> <span class="toc-text">class</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#package"><span class="toc-number">6.3.4.</span> <span class="toc-text">package</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4-idea%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A8%A1%E6%9D%BF"><span class="toc-number">6.4.</span> <span class="toc-text">9.4 idea配置文件模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-5-%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E6%97%B6%E8%8E%B7%E5%8F%96%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%9A%84%E4%B8%BB%E9%94%AE"><span class="toc-number">6.5.</span> <span class="toc-text">9.5 插入数据时获取自动生成的主键</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E3%80%81MyBatis%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86"><span class="toc-number">7.</span> <span class="toc-text">十、MyBatis参数处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-%E5%8D%95%E4%B8%AA%E7%AE%80%E5%8D%95%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0"><span class="toc-number">7.1.</span> <span class="toc-text">10.1 单个简单类型参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-Map%E5%8F%82%E6%95%B0"><span class="toc-number">7.2.</span> <span class="toc-text">10.2 Map参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-3-%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%8F%82%E6%95%B0"><span class="toc-number">7.3.</span> <span class="toc-text">10.3 实体类参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-4-%E5%A4%9A%E5%8F%82%E6%95%B0"><span class="toc-number">7.4.</span> <span class="toc-text">10.4 多参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-5-Param%E6%B3%A8%E8%A7%A3%EF%BC%88%E5%91%BD%E5%90%8D%E5%8F%82%E6%95%B0%EF%BC%89"><span class="toc-number">7.5.</span> <span class="toc-text">10.5 @Param注解（命名参数）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-6-Param%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">7.6.</span> <span class="toc-text">10.6 @Param源码分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81MyBatis%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E4%B8%93%E9%A2%98"><span class="toc-number">8.</span> <span class="toc-text">十一、MyBatis查询语句专题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-1-%E8%BF%94%E5%9B%9ECar"><span class="toc-number">8.1.</span> <span class="toc-text">11.1 返回Car</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-2-%E8%BF%94%E5%9B%9EList"><span class="toc-number">8.2.</span> <span class="toc-text">11.2 返回List</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-3-%E8%BF%94%E5%9B%9EMap"><span class="toc-number">8.3.</span> <span class="toc-text">11.3 返回Map</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-4-%E8%BF%94%E5%9B%9EList"><span class="toc-number">8.4.</span> <span class="toc-text">11.4 返回List</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-5-%E8%BF%94%E5%9B%9EMap"><span class="toc-number">8.5.</span> <span class="toc-text">11.5 返回Map&lt;String,Map&gt;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-6-resultMap%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84"><span class="toc-number">8.6.</span> <span class="toc-text">11.6 resultMap结果映射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8resultMap%E8%BF%9B%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84"><span class="toc-number">8.6.1.</span> <span class="toc-text">使用resultMap进行结果映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%E9%A9%BC%E5%B3%B0%E5%91%BD%E5%90%8D%E8%87%AA%E5%8A%A8%E6%98%A0%E5%B0%84"><span class="toc-number">8.6.2.</span> <span class="toc-text">是否开启驼峰命名自动映射</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-7-%E8%BF%94%E5%9B%9E%E6%80%BB%E8%AE%B0%E5%BD%95%E6%9D%A1%E6%95%B0"><span class="toc-number">8.7.</span> <span class="toc-text">11.7 返回总记录条数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E5%8A%A8%E6%80%81SQL"><span class="toc-number">9.</span> <span class="toc-text">十二、动态SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#12-1-if%E6%A0%87%E7%AD%BE"><span class="toc-number">9.1.</span> <span class="toc-text">12.1 if标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-2-where%E6%A0%87%E7%AD%BE"><span class="toc-number">9.2.</span> <span class="toc-text">12.2 where标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-3-trim%E6%A0%87%E7%AD%BE"><span class="toc-number">9.3.</span> <span class="toc-text">12.3 trim标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-4-set%E6%A0%87%E7%AD%BE"><span class="toc-number">9.4.</span> <span class="toc-text">12.4 set标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-5-choose-when-otherwise"><span class="toc-number">9.5.</span> <span class="toc-text">12.5 choose when otherwise</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-6-foreach%E6%A0%87%E7%AD%BE"><span class="toc-number">9.6.</span> <span class="toc-text">12.6 foreach标签</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4-1"><span class="toc-number">9.6.1.</span> <span class="toc-text">批量删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0"><span class="toc-number">9.6.2.</span> <span class="toc-text">批量添加</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-7-sql%E6%A0%87%E7%AD%BE%E4%B8%8Einclude%E6%A0%87%E7%AD%BE"><span class="toc-number">9.7.</span> <span class="toc-text">12.7 sql标签与include标签</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81MyBatis%E7%9A%84%E9%AB%98%E7%BA%A7%E6%98%A0%E5%B0%84%E5%8F%8A%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="toc-number">10.</span> <span class="toc-text">十三、MyBatis的高级映射及延迟加载</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#13-1-%E5%A4%9A%E5%AF%B9%E4%B8%80"><span class="toc-number">10.1.</span> <span class="toc-text">13.1 多对一</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%9A%E7%BA%A7%E8%81%94%E5%B1%9E%E6%80%A7%E6%98%A0%E5%B0%84"><span class="toc-number">10.1.1.</span> <span class="toc-text">第一种方式：级联属性映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%9Aassociation"><span class="toc-number">10.1.2.</span> <span class="toc-text">第二种方式：association</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%9A%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">10.1.3.</span> <span class="toc-text">第三种方式：分步查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-2-%E5%A4%9A%E5%AF%B9%E4%B8%80%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="toc-number">10.2.</span> <span class="toc-text">13.2 多对一延迟加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-3-%E4%B8%80%E5%AF%B9%E5%A4%9A"><span class="toc-number">10.3.</span> <span class="toc-text">13.3 一对多</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%9Acollection"><span class="toc-number">10.3.1.</span> <span class="toc-text">第一种方式：collection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%9A%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">10.3.2.</span> <span class="toc-text">第二种方式：分步查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-4-%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="toc-number">10.4.</span> <span class="toc-text">13.4 一对多延迟加载</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81MyBatis%E7%9A%84%E7%BC%93%E5%AD%98"><span class="toc-number">11.</span> <span class="toc-text">十四、MyBatis的缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#14-1-%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-number">11.1.</span> <span class="toc-text">14.1 一级缓存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-2-%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-number">11.2.</span> <span class="toc-text">14.2 二级缓存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-3-MyBatis%E9%9B%86%E6%88%90EhCache"><span class="toc-number">11.3.</span> <span class="toc-text">14.3 MyBatis集成EhCache</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%BA%94%E3%80%81MyBatis%E7%9A%84%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B"><span class="toc-number">12.</span> <span class="toc-text">十五、MyBatis的逆向工程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#15-1-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E9%85%8D%E7%BD%AE%E4%B8%8E%E7%94%9F%E6%88%90"><span class="toc-number">12.1.</span> <span class="toc-text">15.1 逆向工程配置与生成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">12.1.1.</span> <span class="toc-text">第一步：基础环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E5%9C%A8pom%E4%B8%AD%E6%B7%BB%E5%8A%A0%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%8F%92%E4%BB%B6"><span class="toc-number">12.1.2.</span> <span class="toc-text">第二步：在pom中添加逆向工程插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E9%85%8D%E7%BD%AEgeneratorConfig-xml"><span class="toc-number">12.1.3.</span> <span class="toc-text">第三步：配置generatorConfig.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E8%BF%90%E8%A1%8C%E6%8F%92%E4%BB%B6"><span class="toc-number">12.1.4.</span> <span class="toc-text">第四步：运行插件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-2-%E6%B5%8B%E8%AF%95%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E7%94%9F%E6%88%90%E7%9A%84%E6%98%AF%E5%90%A6%E5%A5%BD%E7%94%A8"><span class="toc-number">12.2.</span> <span class="toc-text">15.2 测试逆向工程生成的是否好用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">12.2.1.</span> <span class="toc-text">第一步：环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E7%A8%8B%E5%BA%8F"><span class="toc-number">12.2.2.</span> <span class="toc-text">第二步：编写测试程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E5%85%AD%E3%80%81MyBatis%E4%BD%BF%E7%94%A8PageHelper"><span class="toc-number">13.</span> <span class="toc-text">十六、MyBatis使用PageHelper</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#16-1-limit%E5%88%86%E9%A1%B5"><span class="toc-number">13.1.</span> <span class="toc-text">16.1 limit分页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-3-PageHelper%E6%8F%92%E4%BB%B6"><span class="toc-number">13.2.</span> <span class="toc-text">16.3 PageHelper插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">13.2.1.</span> <span class="toc-text">第一步：引入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E5%9C%A8mybatis-config-xml%E6%96%87%E4%BB%B6%E4%B8%AD%E9%85%8D%E7%BD%AE%E6%8F%92%E4%BB%B6"><span class="toc-number">13.2.2.</span> <span class="toc-text">第二步：在mybatis-config.xml文件中配置插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E7%BC%96%E5%86%99Java%E4%BB%A3%E7%A0%81"><span class="toc-number">13.2.3.</span> <span class="toc-text">第三步：编写Java代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%83%E3%80%81MyBatis%E7%9A%84%E6%B3%A8%E8%A7%A3%E5%BC%8F%E5%BC%80%E5%8F%91"><span class="toc-number">14.</span> <span class="toc-text">十七、MyBatis的注解式开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#17-1-Insert"><span class="toc-number">14.1.</span> <span class="toc-text">17.1 @Insert</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-2-Delete"><span class="toc-number">14.2.</span> <span class="toc-text">17.2 @Delete</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-3-Update"><span class="toc-number">14.3.</span> <span class="toc-text">17.3 @Update</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-4-Select"><span class="toc-number">14.4.</span> <span class="toc-text">17.4 @Select</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/da77c56c.html" title="MVC架构设计模式"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/22.jpg" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="MVC架构设计模式"/></a><div class="content"><a class="title" href="/posts/da77c56c.html" title="MVC架构设计模式">MVC架构设计模式</a><time datetime="2026-11-14T16:24:00.000Z" title="发表于 2026-11-15 00:24:00">2026-11-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/e25feb6e.html" title="黑马程序员SSM"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/4.png" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="黑马程序员SSM"/></a><div class="content"><a class="title" href="/posts/e25feb6e.html" title="黑马程序员SSM">黑马程序员SSM</a><time datetime="2026-02-03T03:14:00.000Z" title="发表于 2026-02-03 11:14:00">2026-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/eedaddf.html" title="博客笔记"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/10.png" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="博客笔记"/></a><div class="content"><a class="title" href="/posts/eedaddf.html" title="博客笔记">博客笔记</a><time datetime="2026-02-03T02:50:00.000Z" title="发表于 2026-02-03 10:50:00">2026-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5764bc58.html" title="饱了么前端"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/16.jpg" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="饱了么前端"/></a><div class="content"><a class="title" href="/posts/5764bc58.html" title="饱了么前端">饱了么前端</a><time datetime="2026-02-03T02:50:00.000Z" title="发表于 2026-02-03 10:50:00">2026-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2821e645.html" title="饱了么后端"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.dreamshelter.cn/blog/source/img/cover/15.jpg" onerror="this.onerror=null;this.src='https://cdn.dreamshelter.cn/blog/source/img/404.jpg'" alt="饱了么后端"/></a><div class="content"><a class="title" href="/posts/2821e645.html" title="饱了么后端">饱了么后端</a><time datetime="2026-02-03T02:50:00.000Z" title="发表于 2026-02-03 10:50:00">2026-02-03</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By Shelter</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><script src="/js/tw_cn.js?v=5.5.4"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://blog.dreamshelter.cn/twikooapi/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://blog.dreamshelter.cn/twikooapi/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script src="https://fastly.jsdelivr.net/npm/live2d-widgets@1.0.0/dist/autoload.js"></script><div class="aplayer no-destroy" data-id="17745883873" data-server="netease" data-type="playlist" data-order="list" data-fixed="true" data-preload="auto" data-autoplay="true" data-mutex="true" ></div><script id="canvas_nest" defer="defer" color="255,192,203" opacity="0" zIndex="-1" count="80" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"]):not([href=".aside-content"]):not([href="#aside-content"]):not([href=".card-clock
# Inject the css and script (aplayer/meting) aplayerInject: enable: true per_page: true
# 通知弹窗 # Snackbar - Toast Notification # https://github.com/polonel/SnackBar # position: top-left / top-center / top-right / bottom-left / bottom-center / bottom-right snackbar: enable: true position: top-right # The background color of Toast Notification in light mode and dark mode bg_light: "])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      false
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><div id="app-refresh" style="position: fixed; top: -2.2rem; left: 0; right: 0; z-index: 99999; padding: 0 1rem; font-size: 15px; height: 2.2rem; transition: all 0.3s ease;"><div class="app-refresh-wrap" style="display: flex; color: #fff; height: 100%; align-items: center; justify-content: center;"><label>🚀 有新内容发布啦！</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color: #fff; text-decoration: underline; cursor: pointer; margin-left: 8px;">点击刷新</span></a></div></div><script>if ('serviceWorker' in navigator) {
  // 如果当前页面受 Service Worker 控制，监听控制权变化
  if (navigator.serviceWorker.controller) {
    navigator.serviceWorker.addEventListener('controllerchange', function() {
      showNotification();
    });
  }

  // 页面加载完成后注册 sw.js
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js').catch(err => {
      console.error('PWA 注册失败:', err);
    });
  });
}

function showNotification() {
  // 优先使用主题自带的 Snackbar 弹窗
  if (window.GLOBAL_CONFIG && GLOBAL_CONFIG.Snackbar) {
    var snackbarBg = document.documentElement.getAttribute('data-theme') === 'light' ?
      GLOBAL_CONFIG.Snackbar.bgLight :
      GLOBAL_CONFIG.Snackbar.bgDark;
    
    var snackbarPos = GLOBAL_CONFIG.Snackbar.position;

    Snackbar.show({
      text: '🚀 有新文章发布啦！',
      backgroundColor: snackbarBg,
      duration: 10000, // 持续 10 秒
      pos: snackbarPos,
      actionText: '点击刷新',
      actionTextColor: '#fff',
      onActionClick: function(e) {
        location.reload();
      },
    });
  } else {
    // 如果没有 Snackbar，则显示顶部的 app-refresh 栏
    var showBg = document.documentElement.getAttribute('data-theme') === 'light' ? '#49b1f5' : '#1f1f1f';
    var appRefresh = document.getElementById('app-refresh');
    if (appRefresh) {
      appRefresh.style.cssText = 'top: 0; background: ' + showBg + ';';
    }
  }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索点什么呢………" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.4"></script></div></div><!-- hexo injector body_end start -->
  <script data-pjax src="/js/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://vercelapi.dreamshelter.cn/api?user=shelter67";
            var git_color =['#ebedf0', '#a2f7af', '#6ce480', '#54ad63', '#469252', '#31753c', '#1f5f2a', '#13531f', '#084111', '#032b09', '#000000'];
            var git_user ="shelter67";
            var parent_div_git = document.getElementsByClassName('layout')[0];
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/gongxianban/'){
                console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar");
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementsByClassName('layout')[0]){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementsByClassName('footer-other')[0];
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v8.1.1" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v5.5.4" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://cloud.tencent.com/" style="margin-inline:5px" data-title="本站由腾讯云提供服务器支持" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Server-Tencent%20Cloud-00A4FF?style=flat&amp;logo=qq&amp;logoColor=white" alt=""/></a><a class="github-badge" target="_blank" href="https://edgeone.ai/" style="margin-inline:5px" data-title="本站由腾讯云 EdgeOne 提供安全加速" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-EdgeOne-00A4FF?style=flat&amp;logo=iCloud&amp;logoColor=white" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="https://beian.miit.gov.cn/" style="margin-inline:5px" data-title="工业和信息化部ICP备案管理系统" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/%E9%B2%81ICP%E5%A4%87-2025199346%E5%8F%B7--1-ba9132?style=flat&amp;labelColor=443d38" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://www.fomal.cc/static/js/runtime.js"></script><script data-pjax>
function hexo_butterfly_clock_remake_injector_config(){
  var parent_div_git;
  var item_html = `<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-veeink@1.0.7/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>`;

  // 按类型获取容器
  if ('class' === 'class') {
    parent_div_git = document.getElementsByClassName('aside-content')[0];
  } else if ('class' === 'id') {
    parent_div_git = document.getElementById('aside-content');
  } else {
    parent_div_git = document.getElementById('aside-content');
  }

  if(parent_div_git){
    var reference_el_before = null;
    var reference_el_after = parent_div_git.querySelector('.card-announcement');

    if(reference_el_before){
      parent_div_git.insertBefore(
        (function(){var temp = document.createElement('div'); temp.innerHTML = item_html; return temp;}()),
        reference_el_before
      );
    } else if(reference_el_after){
      reference_el_after.insertAdjacentHTML('afterend', item_html);
    } else {
      parent_div_git.insertAdjacentHTML('afterbegin', item_html);
    }
  }
}

console.log('已挂载 butterfly_clock_anzhiyu-yang 修复版');

// ---------- 全局变量声明 ----------
var cpage = location.pathname;
var epage = 'all';
var qweather_key = '0df3cf714a324957b16f3201e86fe931';
var qweather_api_host = 'https://p65ctvhqy4.re.qweatherapi.com';
var default_city = '';
var gaud_map_key = '296709bdb591a3523a2cf60e8e8f0ba3';

// ---------- 页面过滤 ----------
var elist = 'null'.split(',');
var flag = 0;
for(var i=0;i<elist.length;i++){
  if(cpage.includes(elist[i])) flag++;
}

if((epage === 'all') && (flag == 0)){
  hexo_butterfly_clock_remake_injector_config();
} else if(epage === cpage){
  hexo_butterfly_clock_remake_injector_config();
}
</script><script data-pjax src="/js/clock-min.js"></script><!-- hexo injector body_end end --></body></html>