<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>MVC架构设计模式</title>
      <link href="/posts/da77c56c.html"/>
      <url>/posts/da77c56c.html</url>
      
        <content type="html"><![CDATA[<h1 id="不使用mvc架构的缺陷"><a href="#不使用mvc架构的缺陷" class="headerlink" title="不使用mvc架构的缺陷"></a>不使用mvc架构的缺陷</h1><p>在不使用MVC架构模式的前提下，完成银行账户转账。<br>分析这个程序存在哪些问题?</p><ol><li><p>缺点1&gt;代码的复用性太差。(代码的重用性太差)</p><p>导致缺点1的原因?</p><p>因为没有进行”职能分工”，没有独立组件的概念，所以没有办法进行代码复用。代码和代码之间的耦合度太高，扩展力太差。</p></li><li><p>缺点2&gt;耦合度高，导致了代码很难护展。</p></li><li><p>缺点3&gt;操作数据库的代码和业务逻辑混杂在一起，很容易出错。编写代码的时候很容易出错，无法专注业务逻辑的编写。</p></li></ol><p>分析以下AccountTransferServlet他都负责了什么?</p><ol><li><blockquote><p>负责了数据接收</p></blockquote></li><li><blockquote><p>负责了核心的业务处理</p></blockquote></li><li><blockquote><p>负责了数据库表中数据的CRUD操作 (Create【增】 Retrieve【査】 Update【改】 Delete【删】)</p></blockquote></li><li><blockquote><p>负责了页面的数据展示</p></blockquote></li></ol><p>公司中一般都有很多员工，每个员工都各司其职，为什么要这样?<br>保洁阿姨负责打扫卫生<br>杜老师负责教学大纲的指定<br>郭老师负责上课<br>王老师负责学习就业<br>*我们公司只有一个员工。这个员工负责所有的事情。生病了。–&gt;公司倒闭了。</p><h1 id="理论基础"><a href="#理论基础" class="headerlink" title="理论基础"></a>理论基础</h1><p><img src="/./images/MVC%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/MVC%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%90%86%E8%A7%A3.png" alt="MVC架构模式的理解"></p><h1 id="javaEE设计模式之DAO模式"><a href="#javaEE设计模式之DAO模式" class="headerlink" title="javaEE设计模式之DAO模式"></a>javaEE设计模式之DAO模式</h1><p>AccountDao是负责Account数据的增删改查的。</p><ol><li>什么是DA0 ?<br> Data Access 0bject(数据访问对象)</li><li>DAO实际上是一种设计模式，属于JavaEE的设计模式之一。(不是23种设计模式。)</li><li>DA0只负责数据库表的CRUD，没有任何业务逻辑在里面。</li><li>没有任何业务逻辑，只负责表中数据增删改查的对象，有一个特殊的称谓:DA0对象。</li><li>为什么叫做AccountDao呢?<br> 这是因为这个DA0是专门处理t_act这张表的。<br> 如果处理t_user表的话，可以叫做:UserDao<br> 如果处理t_student表的话，可以叫做:StudentDao</li><li>一般情况下:一张表会对应一个DA0对象。</li><li>DA0中的方法名很固定了，一般都是:<br> insert<br> deleteByXxx<br> update<br> selectByXxX<br> selectAll</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 账户实体类:封装账户信息的。</span></span><br><span class="line"><span class="comment">* 一般是一张表一个。</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> 老社</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment">* /</span></span><br><span class="line"><span class="comment">public class Account &#123;</span></span><br><span class="line"><span class="comment">//一般这种属性不建议设计为基本数据类型，建议使用包装类。防止null带来的问题</span></span><br><span class="line"><span class="comment">//private long id;</span></span><br><span class="line"><span class="comment">private Long id;</span></span><br><span class="line"><span class="comment">private String actno;</span></span><br><span class="line"><span class="comment">//private double balance;</span></span><br><span class="line"><span class="comment">private Double balance;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure><p>像account这种普通简单的对象被称为pojo对象，有的人也会把这种专门封装数据的对象，称为bean对象。有的人也会把这种专门封装数据的对象，称为领域模型对象，domain对象。这些说的都是同一个东西</p><h1 id="业务层"><a href="#业务层" class="headerlink" title="业务层"></a>业务层</h1><p>service翻译为:业务<br>AccountService:专门处理Account业务的一个类<br>在该类中应该编写纯业务代码。(只专注业务。不写别的。不和其他代码混合在一块。)<br>只希望专注业务，能够将业务完美实现，少量bug.<br>起名要和业务挂钩</p><p>控制层：</p><p>&#x2F;&#x2F; 接收数据<br>&#x2F;&#x2F;调用业务方法处理业务(调度Model处理业务)<br>&#x2F;&#x2F;展示处理结果(调度View做页面展示)</p><p><img src="/./images/MVC%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84.png" alt="三层架构"></p><p><img src="/./images/MVC%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%842.png" alt="三层架构2"></p><h1 id="解决事务问题"><a href="#解决事务问题" class="headerlink" title="解决事务问题"></a>解决事务问题</h1><p>在视频代码里，server层开启事务时创建的connection对象和dao层crud创建的connection对象不是同一个，所以并没有成功开启事务管理，这时候通过创建一个map，key保存的是线程，value保存的是conn对象，这样就可以保证在一个栈里互不影响。比如张三执行这个方法拿到的线程是t1，那么后续执行的方法线程一定是t1，这时候如果有个李四，那他拿到的就会是t2，后面也是一样<img src="/./images/MVC%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/ThreadLocal.png" alt="ThreadLocal"></p><p>静态变量特点:类加载时执行，并且只执行一次。</p><p>目前项目仍然存在缺陷:<br>1&gt;在service层控制了事务，service方法中的事务控制代码看着有点别扭，以后能不能不写????<br>可以使用动态代理机制解决这个问题。这个自己研究就行了。我不讲了。<br>2&gt;日前虽然面向接口编程了，但是并没有完全解决对象和对象之间的依赖关系。怎么办?可以使用spring的IoC容器来解决这个问题。<br>对象的创建我不用管了。<br>对象和对象之间关系的管理我也不想管了。<br>都交给spring容器来负责这件事。</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSM </tag>
            
            <tag> Java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>黑马程序员SSM</title>
      <link href="/posts/e25feb6e.html"/>
      <url>/posts/e25feb6e.html</url>
      
        <content type="html"><![CDATA[<p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251117154216907.png" alt="image-20251117154216907"></p><h1 id="spring"><a href="#spring" class="headerlink" title="spring"></a>spring</h1><h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251117154611993.png" alt="image-20251117154611993"></p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251117155539816.png" alt="image-20251117155539816"></p><ul><li>目标:充分解耦<ul><li>使用IoC容器管理bean(IoC)</li><li>在IoC容器内将有依赖关系的bean进行关系绑定(DI)</li></ul></li><li>最终效果<ul><li>使用对象时不仅可以直接从IoC容器中获取，并且获取到的bean已经绑定了所有的依赖关系</li></ul></li></ul><h2 id="IoC入门案例思路分析"><a href="#IoC入门案例思路分析" class="headerlink" title="IoC入门案例思路分析"></a>IoC入门案例思路分析</h2><ol><li>管理什么?(Service与Dao)</li><li>如何将被管理的对象告知IoC容器?(配置)</li><li>被管理的对象交给IoC容器，如何获取到IoC容器?(接口)</li><li>IoC容器得到后，如何从容器中获取bean?(接口方法)</li><li>使用Spring导入哪些坐标?(pom.xm1)</li></ol><p>先导入spring依赖，然后新建<img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251117160116095.png" alt="image-20251117160116095"></p><p>这个就是spring的配置文件，取名applicationContext.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--1.导入spring的坐标spring-context，对应版本是5.2.10.RELEASE--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--2.配置bean，id随便写，class对应要管理的对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.BookDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.BookServiceImpl&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App2</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(string[]args)</span>&#123;</span><br><span class="line"><span class="comment">//3.获取ToC容器</span></span><br><span class="line"><span class="type">Applicationcontext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">classPathXmlApplicationcontext</span>( configLocation: <span class="string">&quot;applicationcontext.xml&quot;</span>),</span><br><span class="line"><span class="comment">//4.获取bean</span></span><br><span class="line"><span class="type">BqokDao</span> <span class="variable">bookDao</span> <span class="operator">=</span>(BookDao)ctx.getBean( s:<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">bookDao.save();</span><br></pre></td></tr></table></figure><h2 id="DI入门案例思路分析"><a href="#DI入门案例思路分析" class="headerlink" title="DI入门案例思路分析"></a>DI入门案例思路分析</h2><ol><li>基于IoC管理bean</li><li>Service中使用new形式创建的Dao对象是否保留?(否)</li><li>Service中需要的Dao对象如何进入到Service中?(提供方法)</li><li>Service与Dao间的关系如何描述?(配置)</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">Bookservice</span> &#123;</span><br><span class="line">    <span class="comment">//5.删除业务层中使用new的方式创建的dao对象</span></span><br><span class="line"><span class="comment">//private BookDao bookDao = hew BookDaoImpl();</span></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;book service save ...&quot;</span>);</span><br><span class="line">bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.提供对应的set方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBookDao</span><span class="params">(BookDao bookDao)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.bookDao = bookDao;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com,itheima.service.impl.BookServiceImpl&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--7.既置server与dao的关系--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--property标签表小配置当前bean的属性</span></span><br><span class="line"><span class="comment">name届性表小配置哪一个具体的属性</span></span><br><span class="line"><span class="comment">ref属性表小参照哪-个bean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bookDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="bean"><a href="#bean" class="headerlink" title="bean"></a>bean</h2><h3 id="bean基础配置"><a href="#bean基础配置" class="headerlink" title="bean基础配置"></a>bean基础配置</h3><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251117193854510.png" alt="image-20251117193854510"></p><p>以下是新的bean配置文件，可以通过name增加别名，用逗号、分号和空格分隔，但还是推荐id起名</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookservice&quot;</span> <span class="attr">name</span>=<span class="string">&quot;service service2 bookEbi&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.BookseryiceImpl&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bookDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">name</span>=<span class="string">&quot;dao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.BookDaoImpl&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>如果命名出现问题，就会出现NoSuchBeanDefinitionException Create breakpoint : No bean named ‘service4’ available的报错</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251117195050515.png" alt="image-20251117195050515"></p><p>bean作用范围：默认创建出来的是同一个对象</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251117195227957.png" alt="image-20251117195227957"></p><ul><li>为什么bean默认为单例 ?如果不是单例就会执行一次造一次对象，但其实可以用同一个对象（也就是可复用）</li><li>适合交给容器进行管理的bean<ul><li>表现层对象</li><li>业务层对象</li><li>数据层对象</li><li>工具对象</li></ul></li><li>不适合交给容器进行管理的bean<ul><li>封装实体的域对象</li></ul></li></ul><h3 id="bean实例化"><a href="#bean实例化" class="headerlink" title="bean实例化"></a>bean实例化</h3><p>查看异常的方法是从下往上看，越往上越详细</p><p>方式有三种</p><p>一：构造方法（常用）</p><ul><li>提供可访问的构造方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">BookDaoImpl</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.printIn(<span class="string">&quot;book constructor is running...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;book dao save ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>配置</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.BookDaoImpl&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><ul><li>无参构造方法如果不存在，将抛出异常BeancreationException</li></ul><p>二：使用静态工厂实例化bean（以前常用）</p><p>这里class造出来的是工厂对象，但我们需要的不是这个工厂，所以用后面那个配置工厂里面真正用来造对象的方法名</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;orderDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.factory.OrderDaoFactory&quot;</span> <span class="attr">Factory-method</span>=<span class="string">&quot;getOrderDao&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//静态工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderDaoFactory</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> orderDao <span class="title function_">getOrderDao</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderDaoImpl</span>();</span><br></pre></td></tr></table></figure><p>三：使用实例工厂实例化bean（了解）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--先配出工厂，再把工厂id放进下面bean里，实例方法写method--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.factory.UserDaoFactory&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getUserDao&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;userFactory&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppForInstanceUser</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(string[] args)</span>&#123;</span><br><span class="line">        <span class="type">Applicationcontext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">classPathXmlApplicationContext</span>(<span class="string">&quot;applicationcontext.xml&quot;</span>);</span><br><span class="line">        UserDao userDao=(UserDao)ctx.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">userDao.save();</span><br></pre></td></tr></table></figure><p>四:使用FactoryBean实例化bean（重点）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.factory.UserDaoFactoryBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//利用泛型来获取对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;UserDao&gt; &#123;</span><br><span class="line"><span class="comment">//代替原始实例工厂中创建对象的方法，造出来的是UserDao</span></span><br><span class="line"><span class="keyword">public</span> UserDao <span class="title function_">getobject</span><span class="params">()</span><span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line"><span class="keyword">public</span> class&lt;?&gt;getobjectType()&#123;</span><br><span class="line"><span class="keyword">return</span> UserDao.class;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果是true就是单例（默认，输出内存地址一样），false变成非单例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">issingleton</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="bean生命周期"><a href="#bean生命周期" class="headerlink" title="bean生命周期"></a>bean生命周期</h3><ul><li>生命周期:从创建到消亡的完整过程</li><li>bean生命周期:bean从创建到销毁的整体过程</li><li>bean生命周期控制:在bean创建后到销毁前做一些事情</li></ul><p>管理生命周期通过java代码有以下两种，但其实可以交给Tomcat管理，所以是白学</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.imp1.BookDaoImp1&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">dastroy-method</span>=<span class="string">&quot;destory&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppForLifecycle</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(string[]args )</span>&#123;</span><br><span class="line">    <span class="comment">//Applicationcontext没有close这个方法，但子类有，就改成它的子类</span></span><br><span class="line"><span class="comment">//Applicationcontext ctx = new ClassPathXmlApplicationContext( configLocation: &quot;applicationcontext.xm1&quot;)</span></span><br><span class="line">    <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>( configLocation: <span class="string">&quot;applicationcontext.xm1&quot;</span>)</span><br><span class="line">BookDao bookDao=(BookDao)ctx.getBean(s:<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">bookDao.save();</span><br><span class="line">    <span class="comment">//这个方法是直接关闭容器，比较暴力，位置改动会影响结果</span></span><br><span class="line">    ctx.close();</span><br><span class="line">    <span class="comment">//注册关闭钩子，容器在启动之后如果虚拟机要关闭就要先把容器关闭，位置改动不影响结果</span></span><br><span class="line">    ctx.registerShutdownHook();     </span><br></pre></td></tr></table></figure><p>也可以通过实现接口的方式管理</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span>, InitializingBean ,DisposableBean &#123;</span><br><span class="line">    <span class="comment">//然后实现里面的方法就行了</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;destroy&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//这个方法的意思是属性设置之后</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterPropertiesset&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>bean在整个初始化过程中经历的阶段：</p><ul><li>初始化容器</li></ul><ol><li>创建对象(内存分配)</li><li>执行构造方法</li><li>执行属性注入(set操作 )</li><li>执行bean初始化方法</li></ol><ul><li>使用bean</li></ul><ol><li>执行业务操作</li></ol><ul><li>关闭&#x2F;销毁容器</li></ul><ol><li>执行bean销毁方法</li></ol><p>bean销毁时机</p><ul><li><p>容器关闭前触发bean的销毁</p></li><li><p>关闭容器方式</p><ul><li><p>手工关闭容器：</p><p>ConfigurableApplicationcontext接close()操作</p></li><li><p>注册关闭钩子，在虚拟机退出前先关闭容器再退出虚拟机：</p><p>ConfigurableApplicationcontext接registerShutdownHook()操作</p></li></ul></li></ul><h2 id="依赖注入方式"><a href="#依赖注入方式" class="headerlink" title="依赖注入方式"></a>依赖注入方式</h2><ul><li>思考:向一个类中传递数据的方式有几种 ?<ul><li>普通方法(set方法)</li><li>构造方法</li></ul></li><li>思考:依赖注入描述了在容器中建立bean与bean之间依赖关系的过程,如果bean运行需要的是数字或字符串呢 ?<ul><li>引用类型</li><li>简单类型(基本数据类型与string</li></ul></li><li>依赖注入方式<ul><li>setter注入<ul><li>简单类型</li><li>引用类型</li></ul></li><li>构造器注入<ul><li>简单类型</li><li>引用类型</li></ul></li></ul></li></ul><h3 id="setter引用类型"><a href="#setter引用类型" class="headerlink" title="setter引用类型"></a>setter引用类型</h3><p>在bean中定义引用类型属性并提供可访问的set方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span>&#123;</span><br><span class="line"><span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBookDao</span><span class="params">(BookDao bookDao)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.bookDao = bookDao;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>配置中使用property标签ref属性注入引用类型对象</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ref后面的是下面的bean名称，用作引用bean，如果是基本类型用value，name是java里的--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.BookServiceImpl&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bookDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.BookDaoImpl&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="setter简单类型"><a href="#setter简单类型" class="headerlink" title="setter简单类型"></a>setter简单类型</h3><p>在bean中定义引用类型（基本数据类型也可以）属性并提供可访问的set方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> connectionNum;</span><br><span class="line"><span class="keyword">private</span> String databaseName;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConnectionNum</span><span class="params">(<span class="type">int</span> connectionNum)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.connectionNum = connectionNum;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDatabaseName</span><span class="params">(string databaseName)</span></span><br><span class="line"><span class="built_in">this</span>.databaseName =databaseName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置中使用property标签value属性注入简单类型数据</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.BookDaoImpl&quot;</span><span class="attr">.</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;databaseName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;connectionNum&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="构造器注入-简单类型（了解）"><a href="#构造器注入-简单类型（了解）" class="headerlink" title="构造器注入-简单类型（了解）"></a>构造器注入-简单类型（了解）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="keyword">private</span> string databaseName;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> connectionNum;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">BookDaoImpl</span><span class="params">(string database,<span class="type">int</span> connectionNum)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.databaseName =database;</span><br><span class="line"><span class="built_in">this</span>.connectionNum = connectionNum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>这里的property位置换成了constructor-arg，一般了解这个就行</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--标准书写--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.BookDaoImpl”&gt;</span></span></span><br><span class="line"><span class="string"><span class="tag">&lt;constructor-arg name=&quot;</span><span class="attr">connectionNum</span>” <span class="attr">value</span>=<span class="string">”10</span>&quot;/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;databaseName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysqL&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.BookServiceImpl&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bookDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>把构造方法名改成了直接写类型，但是如果有重复类型就会出问题</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--解决形参名称的问题，与形参名不合--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.BookDaoImpl&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;int” value=&quot;</span><span class="attr">10</span>&quot;/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>解决参数类型重复问题，使用下标位置解决参数匹配</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.BookDaoImpl&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>依赖注入方式选择：</p><ol><li>强制依赖（bean运行必须要的东西）使用构造器进行，使用setter注入有概率不进行注入导致null对象出现</li><li>可选依赖使用setter注入进行，灵活性强</li><li>Spring框架倡导使用构造器，第三方框架内部大多数采用构造器注入的形式进行数据初始化，相对严谨</li><li>如果有必要可以两者同时使用,使用构造器注入完成强制依赖的注入，使用setter注入完成可选依赖的注入</li><li>实际开发过程中还要根据实际情况分析，如果受控对象没有提供setter方法就必须使用构造器注入</li><li>自己开发的模块推荐使用setter注入</li></ol><h3 id="自动装配"><a href="#自动装配" class="headerlink" title="自动装配"></a>自动装配</h3><ul><li>IoC容器根据bean所依赖的资源在容器中自动查找并注入到bean中的过程称为自动装配</li><li>自动装配方式<ul><li>按类型(常用)</li><li>按名称</li><li>按构造方法</li><li>不启用自动装配</li></ul></li></ul><p>这里用按类型配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookserviceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span>&#123;</span><br><span class="line"><span class="keyword">private</span> BookDao bookDao;</span><br><span class="line">    <span class="comment">//这个set方法不可以省略</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBookDao</span><span class="params">(BookDao bookDao)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.bookDao = bookDao;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--这里的dao也需要是唯一的，如果有多个就可以使用byName--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.BookDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--autowire里有五种，按需使用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.BookServiceImpl&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>依赖自动装配特征：</p><ul><li>自动装配用于引用类型依赖注入，不能对简单类型进行操作（简单类型比如数字这种，就不需要注入bean了）</li><li>使用按类型装配时(byType)必须保障容器中相同类型的bean唯一，推荐使用</li><li>使用按名称装配时(byName)必须保障容器中具有指定名称的bean，因变量名与配置耦合，不推荐使用</li><li>自动装配优先级低于setter注入与构造器注入，同时出现时自动装配配置失效</li></ul><h3 id="集合注入"><a href="#集合注入" class="headerlink" title="集合注入"></a>集合注入</h3><p>就学个格式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span>[] array;</span><br><span class="line"><span class="keyword">private</span> List&lt;string&gt; list;</span><br><span class="line"><span class="keyword">private</span> Set&lt;string&gt; set;</span><br><span class="line"><span class="keyword">private</span> Map&lt;string,string&gt; map;</span><br><span class="line"><span class="keyword">private</span> Properties properties;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setArray</span><span class="params">(<span class="type">int</span>[]array)</span>&#123;<span class="built_in">this</span>.array = array; &#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.BookDaoImpl&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;array&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;set&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--重复的值会自动过滤--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--重复的值会自动过滤--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x&quot;</span> <span class="attr">value</span>=<span class="string">&quot;x&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;properties&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--重复的值会自动过滤--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;x&quot;</span>&gt;</span>x<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br></pre></td></tr></table></figure><h2 id="案例-数据源对象管理"><a href="#案例-数据源对象管理" class="headerlink" title="案例:数据源对象管理"></a>案例:数据源对象管理</h2><p>管理第三方的bean</p><p>思考用构造方法还是set方法注入，这个的话得看这个类是怎么写的，这里是找到了set相关的方法</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--管理DruidDataSource对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverclassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://1ocalhost:3306/spring_db&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>随便输出一下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(string[l args)</span>&#123;</span><br><span class="line"><span class="type">Applicationcontext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">classPathXmlApplicationcontext</span>( configLocation: <span class="string">&quot;applicationcontext.xml&quot;</span>);</span><br><span class="line"><span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span>(DataSource)ctx.getBean( s:<span class="string">&quot;dataSource&quot;</span>);</span><br><span class="line">System.out.println(dataSource);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="加载properties文件"><a href="#加载properties文件" class="headerlink" title="加载properties文件"></a>加载properties文件</h2><p>第一步开启context命名空间，下面的context就是新加的命名空间</p><p>第二步使用context空问加载properties文件</p><p>第三步使用属性占位待${}读取properties 文件中的属性</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--第一步开启context命名空间，下面的context就是新加的命名空间--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmIns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&#x27;</span></span></span><br><span class="line"><span class="string"><span class="tag">xmlns:xsi=&quot;</span><span class="attr">http:</span>//<span class="attr">www.w3.org</span>/<span class="attr">2001</span>/<span class="attr">XMLSchema-instance</span>&quot;</span></span><br><span class="line"><span class="tag">    <span class="attr">下面这个xmlns:就是开了一个新的namespace</span>，<span class="attr">命名空间叫做context</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans       </span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       &quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--2.使用context空问加载properties文件--&gt;</span></span><br><span class="line">    这个叫属性占位符，location是指定要加载的文件</span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--3.使用属性占位待$&#123;&#125;读取properties 文件中的属性--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSpurce&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverclassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>环境变量问题：</p><p>​有个需要注意的是如果value里的占位符改成username会出问题，这是因为系统中有一个环境变量叫username，会和这里要读取的username冲突，系统的环境变量比这里的优先级高</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.BookDaoImpl&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>解决方法是在上面的context里加个参数就不会加载环境变量了</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;jdbc.properties&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">system-properties-mode</span>=<span class="string">&quot;NEVER&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>如何加载多个配置文件：</p><ul><li>方式一(不理想)：在location的里面用逗号分隔添加多个</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;jdbc.properties,jdbc2.properties&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">system-properties-mode</span>=<span class="string">&quot;NEVER&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><ul><li>方式二（规范格式）：名称用*代替，加载所有配置文件，在前面加上类路径，但是只能读取当前工程里的配置文件</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;calsspath:*.properties&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">system-properties-mode</span>=<span class="string">&quot;NEVER&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><ul><li>方式三（标准）：calsspath后面再加一个星号，这样可以从依赖的jar包读，也可以从自己的工程读</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;calsspath*:*.properties&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">system-properties-mode</span>=<span class="string">&quot;NEVER&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h2 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h2><p>加载配置文件有两种方法：</p><p>1.加载类路径下的配置文件（用这个）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Applicationcontext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">classPathXmlApplicationcortext</span>(<span class="string">&quot;applicationcontext.xml&quot;</span>);</span><br></pre></td></tr></table></figure><p>2.从文件系统下加载配置文件，用的绝对路径</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Applicationcontext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">classPathXmlApplicationcortext</span>(<span class="string">&quot;D:\\xxxx\\xxx.xml&quot;</span>);</span><br></pre></td></tr></table></figure><p>3.加载多个配置文件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Applicationcontext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">classPathXmlApplicationcontext</span>(<span class="string">&quot;bean1.xml&quot;</span>, <span class="string">&quot;bean2.xml&quot;</span>);</span><br></pre></td></tr></table></figure><p>获取bean：</p><p>1.利用bean名称和强制转换</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BookDao bookDao=(BookDao)ctx.getBean( <span class="string">&quot;bookDao&quot;</span>);</span><br></pre></td></tr></table></figure><p>2.前面获取bean的名称后面获取bean的类型，以上两种没有什么区别</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ctx.getBean(<span class="string">&quot;bookDao&quot;</span>,BookDao.class);</span><br></pre></td></tr></table></figure><p>3.按照类型获取bean，但是这种有个问题就是容器中对应的bean只能有一个，如果有多个bean就会不唯一</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ctx.getBean(BookDao.class);</span><br></pre></td></tr></table></figure><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251122183336605.png" alt="image-20251122183336605"></p><p>这个是最早期的容器初始化方案（已过时）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppForBeanFactory</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(string[] args)</span>&#123;</span><br><span class="line">        <span class="comment">//获取资源文件</span></span><br><span class="line"><span class="type">Resource</span> <span class="variable">resources</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">classPathResource</span>(<span class="string">&quot;applicationcontext.xml&quot;</span>),</span><br><span class="line">BeanFactory bf=<span class="keyword">new</span> <span class="title class_">XmlBeanFactory</span>(resources);</span><br><span class="line">BookDao bookDao=bf.getBean(BookDao.class);</span><br><span class="line">bookDao.save();</span><br></pre></td></tr></table></figure><p>BeanFactory和applicationcontext的区别：BeanFactory创建完毕后，所有的bean是延迟加载，applicationcontext是立即加载，如果applicationcontext也想延迟加载可以在配置文件里添加lazy-init</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.BookDaoImpl&quot;</span> <span class="attr">lazy-init</span>=<span class="string">&#x27;true&quot;/&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="容器相关"><a href="#容器相关" class="headerlink" title="容器相关"></a>容器相关</h3><ul><li>BeanFactory是IoC容器的顶层接口，初始化BeanFactory对象时，加载的bean延迟加载</li><li>Applicationcontext接口是Spring容器的核心接口，初始化时bean立即加载</li><li>Applicationcontext接口提供基础的bean操作相关方法，通过其他接口扩展其功能</li><li>Applicationcontext接口常用初始化类<ul><li>ClassPathXmlApplicationContext</li><li>FileSystemXmlApplicationContext（几乎不用）</li></ul></li></ul><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251122205935752.png" alt="image-20251122205935752"></p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251122211918710.png" alt="image-20251122211918710"></p><h2 id="注解开发"><a href="#注解开发" class="headerlink" title="注解开发"></a>注解开发</h2><p>示例：这里的**@Component**是组件的意思，代表的是xml文件中的<bean>，后面就是bean的名字，这个名字可以默认不写，默认的话就是空的。加上这个注解，在xml中的<bean>标签就可以不用写了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;bookDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">publis <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;book dao save ...&quot;</span>);</span><br><span class="line">        </span><br><span class="line">有bean名用BookDao)ctx.getBean(s:<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">无bean名用ctx.getBean(BookService.class);</span><br></pre></td></tr></table></figure><p>但使用了这个注解也需要spring知道这个，就需要在xml里配置，context:component-scan用于扫描，base-package是指定的位置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima.dao.impl&quot;</span>/&gt;</span></span><br><span class="line">com.itheima也可以，这样扫描的就是itheima下所有的</span><br></pre></td></tr></table></figure><h3 id="注解开发bean"><a href="#注解开发bean" class="headerlink" title="注解开发bean"></a>注解开发bean</h3><ul><li>Spring提供@Component注解的三个衍生注解<ul><li>@Controller:用于表现层bean定义</li><li>@service:用于业务层bean定义</li><li>@Repository:用于数据层bean定义</li></ul></li></ul><h3 id="纯注解开发"><a href="#纯注解开发" class="headerlink" title="纯注解开发"></a>纯注解开发</h3><ul><li>Spring3.0升级了纯注解开发模式，使用Java类替代配置文件，开启了Spring快速开发赛道</li></ul><p>也就是不写配置文件了，换个形式，新建一个config包下的SpringConfig类来代替配置文件，只需要用**@Configuration**就可以代表这个是配置类了，代表的是下图这些</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251122215255200.png" alt="image-20251122215255200"></p><p>然后用@ComponentScan代替，但是要带上包的路径</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>替换完是这样的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">springconfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>但用注解的话启动程序就也要跟着改，因为原本是需要配置文件来启动的，新建一个AppForAnnotation，new的接口不一样了，剩下的都一样</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppForAnnotation</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(string[] args)</span>&#123;</span><br><span class="line">        <span class="comment">//换了个接口new，意思是注解配置容器，括号里是配置类</span></span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationcontext</span>(springconfig.class)</span><br><span class="line">     <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao)ctx.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">System.out.println(bookDao);</span><br><span class="line"><span class="type">BookService</span> <span class="variable">bookService</span> <span class="operator">=</span> ctx.getBean(BookService.class);</span><br><span class="line">System.out.println(bookService);   </span><br></pre></td></tr></table></figure><ul><li><p>读取Spring核心配置文件初始化容器对象切换为读取Java配置类初始化容器对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载配置文件初始化容器</span></span><br><span class="line">ApplicationContext ctx= <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationcontext.xml&quot;</span>);</span><br><span class="line"><span class="comment">//加载配置类初始化容器</span></span><br><span class="line">ApplicationContext ctx= <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br></pre></td></tr></table></figure></li><li><p>@Configuration注解用于设定当前类为配置类</p></li><li><p>@Componentscan注解用于设定扫描路径，此注解只能添加一次，多个数据请用数组格式</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Componentscan(&#123;&quot;com.itheima.service&quot;,&quot;com.itheima.dao&quot;&#125;)</span></span><br></pre></td></tr></table></figure><h3 id="bean管理和生命周期"><a href="#bean管理和生命周期" class="headerlink" title="bean管理和生命周期"></a>bean管理和生命周期</h3><p>注解@Scope(“singleton”)就可以让bean变成单例，prototype是非单例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="meta">@scope(&quot;singleton&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;book dao save ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">@PostConstruct</span><span class="comment">//这个意思是构造方法之后运行</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;init ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">@PreDestroy</span><span class="comment">//这个是彻底销毁前运行的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;destroy ...&quot;</span>);</span><br></pre></td></tr></table></figure><p>上面的两个注解弹幕说java8之后就不用了，如果执行后没有销毁，就是需要在运行方法那里使用关闭容器的方式来做，ctx.close();</p><h3 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h3><p>比如说下面这个程序是存在dao没有注入成功的问题，需要@Autowired这个注解来注入，这个是按<strong>类型装配</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookserviceImpl</span> <span class="keyword">implements</span> <span class="title class_">Bookservice</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> BookDao bookDao;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBookDao</span><span class="params">(BookDao bookDao)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.bookDao = bookDao;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;book service save ...&quot;</span>);</span><br><span class="line">bookDao.save();</span><br></pre></td></tr></table></figure><p>然后发现这个@Autowired注解放在哪里都不影响结果，所以这个set方法不要了也没问题，这个是使用反射里边的暴力反射给它直接加值了</p><p>如果是多个dao那就用按名称装配，之前的dao类里的@Repository注解后面加上名字比如(“bookDao”)，这样用@Autowired注入bookDao时就按照上面的名字去寻找了。但这种有多个相同的bean推荐使用@Qualifier来指定名称，想注入谁就写谁，并且@Autowired不能删除。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;bookDao2&quot;)</span><span class="comment">//找dao类里有@Repository(&quot;bookDao2&quot;)这个注解的</span></span><br><span class="line"><span class="keyword">private</span> BookDao bookDao;</span><br></pre></td></tr></table></figure><ul><li><p>使用@Autowired注解开启自动装配模式(按类型)</p></li><li><p>注意：自动装配基于反射设计创建对象并暴力反射对应属性为私有属性初始化数据，因此无需提供setter方法</p></li><li><p>注意：自动装配建议使用无参构造方法创建对象(默认)，如果不提供对应构造方法，请提供唯一的构造方法</p></li><li><p>使用@Qualifier注解开启指定名称装配bean</p></li><li><p>注意：@Qualifier注解无法单独使用，必须配合@Autowired注解使用</p></li></ul><p>简单类型怎么用？@Value</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;bookDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="meta">@Value(&quot;itheima666&quot;)</span></span><br><span class="line"><span class="keyword">private</span> string name;<span class="comment">//这样就把itheima666注入到name里了</span></span><br></pre></td></tr></table></figure><p>如果这个value值是从外部的properties文件获取，应该怎么获取</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name</span>=<span class="string">123</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;jdbc.properties&quot;)</span><span class="comment">//属性源</span></span><br><span class="line"><span class="comment">//多个的写法@PropertySource(&#123;&quot;jdbc.properties&quot;,&quot;jdbc.properties&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">springconfig</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">上面的value后面改成(<span class="string">&quot;$&#123;name&#125;&quot;</span>)就行了</span><br></pre></td></tr></table></figure><p>注意配置文件的名字不支持通配符*</p><h3 id="第三方bean管理"><a href="#第三方bean管理" class="headerlink" title="第三方bean管理"></a>第三方bean管理</h3><ul><li>使用@Bean配置第三方bean</li></ul><p>​这个springconfig里就不放那个扫描注解了，这里不能直接把配置写在人家的源代码里，所以要自己写，但这些三方配置都写这一个文件里就太多了，所以要拆出去</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line"><span class="comment">//1.定义一个方法获得要管理的对象</span></span><br><span class="line"><span class="comment">//2.添加@Bean，表示当前方法的返回值是一个bean</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Datasource <span class="title function_">datasource</span><span class="params">()</span>&#123;</span><br><span class="line">DruidDataSource ds=<span class="keyword">new</span> <span class="title class_">DruidDatasource</span>();</span><br><span class="line">ds.setDriverclassName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">    ds.setUrl(<span class="string">&quot;jdbc:mysq1://localhost:3306/spring_db&quot;</span>);</span><br><span class="line">ds.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">ds.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> ds;</span><br></pre></td></tr></table></figure><p>拆出去一般就是专门的类管理，使用独立的配置类管理第三方bean，比如jdbcConfig，然后把上面的代码拿到jdbcConfig里面，但是这样会导致springconfig识别不到，解决方法有两种</p><ol><li>扫描式（不推荐使用），把这个类也加上@Configuration，然后在SpringConfig里加上扫包注解@ComponentScan，不推荐的原因是下面这个类也写了@Configuration，而且SpringConfig看不出到底加载了哪些配置类</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcConfig</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Datasource <span class="title function_">datasource</span><span class="params">()</span>&#123;</span><br><span class="line">DruidDataSource ds=<span class="keyword">new</span> <span class="title class_">DruidDatasource</span>();</span><br><span class="line">ds.setDriverclassName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">~~~</span><br></pre></td></tr></table></figure><ol start="2"><li>导入式，使用@Import注解手动加入配置类到核心配置，此注解只能添加一次，多个数据请用数组格式</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(JdbcConfig.java)</span>多个就是(&#123;xxx.java,xxx.java&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br></pre></td></tr></table></figure><h3 id="为第三方bean注入资源"><a href="#为第三方bean注入资源" class="headerlink" title="为第三方bean注入资源"></a>为第三方bean注入资源</h3><p>对于简单类型的方式：使用@Value</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jdbcconfig</span>&#123;</span><br><span class="line"><span class="meta">@Value(&quot;com.mysql.jdbc.Driver&quot;)</span></span><br><span class="line"><span class="keyword">private</span> string driver;</span><br><span class="line"><span class="meta">@Value(&quot;jdbc:mysql:/localhost:3306/spring_db&quot;)</span></span><br><span class="line"><span class="keyword">private</span> string url;</span><br></pre></td></tr></table></figure><pre><code>@Beanpublic Datasource dataSource(){DruidDatasource ds=new DruidDatasource();ds.setDriverclassName(driver);ds.setUr1(ur1); <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">对于引用类型：引用类型注入只需要为bean定义方法设置形参即可，容器会根据类型自动装配对象</span><br><span class="line"></span><br><span class="line">假设运行需要dao，dao类写上@Repository（不写会出现NoSuchBeanDefinitionException异常），然后SpringConfig类是下面的这样，JdbcConfig里只加上个形参就可以，这是因为自动装配</span><br><span class="line"></span><br><span class="line">~~~java</span><br><span class="line">public class JdbcConfig&#123;</span><br><span class="line">    @Value(&quot;com.mysql.jdbc.Driver&quot;)</span><br><span class="line">private string driver;</span><br><span class="line">@Value(&quot;jdbc:mysql:/localhost:3306/spring_db&quot;)</span><br><span class="line">private string url;</span><br></pre></td></tr></table></figure>@Beanpublic Datasource dataSource(BookDao bookDao){//这里多了个形参</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima.dao&quot; )</span><span class="comment">//扫描</span></span><br><span class="line"><span class="meta">@Import(JdbcConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br></pre></td></tr></table></figure><h3 id="XML配置与注解配置比较"><a href="#XML配置与注解配置比较" class="headerlink" title="XML配置与注解配置比较"></a>XML配置与注解配置比较</h3><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251124031607539.png" alt="image-20251124031607539"></p><h2 id="Spring整合MyBatis"><a href="#Spring整合MyBatis" class="headerlink" title="Spring整合MyBatis"></a>Spring整合MyBatis</h2><ul><li>MyBatis程序核心对象分析</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(string[]args)</span><span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">//1.创建SqlSessionFactoryBuilder对象</span></span><br><span class="line"><span class="type">SqlSessionfactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">sqlsessionfactoryBuilder</span>(),</span><br><span class="line"><span class="comment">//2.加载SqlMapconfig.xml配置文件</span></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;SqlMapCconfig.xml&quot;</span>);</span><br><span class="line"><span class="comment">//3.创建sqlsessionFactory对象</span></span><br><span class="line"><span class="comment">//获取连接，获取实现</span></span><br><span class="line"><span class="type">SqlSessionfactory</span> <span class="variable">sqlsessionFactory</span> <span class="operator">=</span> sqlsessionfactoryBuilder.build(inputstream);</span><br><span class="line"><span class="comment">// 4.获取sqlSession</span></span><br><span class="line">SqlSession sqlSession=sqlsessionFactory.opensession();</span><br><span class="line"><span class="comment">//5.执行SqlSession对象执行查询，获取结果User</span></span><br><span class="line"><span class="comment">//获取数据层接口</span></span><br><span class="line"><span class="type">AccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span>sqlsession.getMapper(AccountDao.class);</span><br><span class="line"><span class="type">Account</span> <span class="variable">ac</span> <span class="operator">=</span> accountDao.findById(<span class="number">2</span>);</span><br><span class="line">System.out.println(ac);</span><br><span class="line"><span class="comment">// 6 、释放资源</span></span><br><span class="line">sqlsession.close();</span><br></pre></td></tr></table></figure><p>依赖要添加两个新的</p><p>第一个包是spring里操作数据库专用的包</p><p>第二个包时spring整合mybatis用的包，spring提供接口规范，让被整合的按照标准开发</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>创建JdbcConfig（三方bean的管理格式）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Configuration不使用这个注解被扫描是因为可读性差，就需要手动导入</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jdbcconfig</span>&#123;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> string driver;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> string url;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> string userName;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> string password;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Datasource <span class="title function_">datasource</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">DruidDatasource</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDatasource</span>();</span><br><span class="line">ds.setDriverClassName(driver);</span><br><span class="line">ds.setUr1(url);</span><br><span class="line">ds.setUsername(userName);</span><br><span class="line">ds.setPassword(password);</span><br><span class="line"><span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建SpringConfig</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Componentscan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="meta">@ropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="meta">@Import(&#123;JdbcConfig.class,MybatisConfig.class&#125;)</span><span class="comment">//手动导入</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>写个专门做mybatis的配置类，里面写上sqlsessionfactorybean，然后在springconfig里导入。通过创建这个类来获取factory，xml配置文件里的东西都不能少，如果不在配置文件里配置，也可以通过set方法配置，只需要配置最需要的东西</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisConfig</span>&#123;</span><br><span class="line">    <span class="comment">//使用@bean想注入引用类型直接在括号的形参加上对应参数就可以</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SqlsessionFactoryBean <span class="title function_">sqlsessionFactory</span><span class="params">(DataSource dataSource)</span>&#123;</span><br><span class="line"><span class="type">SqlSessionFactoryBean</span> <span class="variable">ssfb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">    <span class="comment">//代替了package name </span></span><br><span class="line">ssfb.setTypeAliasesPackage(<span class="string">&quot;com.itheima.domain&quot;</span>);</span><br><span class="line">    <span class="comment">//environments就不要了</span></span><br><span class="line">    <span class="comment">//代替了datasource。spring容器里有dataSource</span></span><br><span class="line">ssfb.setDataSource(dataSource);</span><br><span class="line">    <span class="comment">//还有个transactionManager事务处理，暂时忽略</span></span><br><span class="line"><span class="keyword">return</span> ssfb;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//还有个mapper标签，用来造dao实现类的</span></span><br><span class="line">    <span class="comment">//这个也属于mybatis整合spring包里的，映射扫描配置器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MapperScannerConfigurer <span class="title function_">mapperScannerConfigurer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MapperScannerConfigurer</span> <span class="variable">msc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MapperScannerConfigurer</span>();</span><br><span class="line">        <span class="comment">//设置映射的包路径</span></span><br><span class="line">        msc.setBasePackage(<span class="string">&quot;com.itheima.dao&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> msc;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>以上的只需要改包路径就可以，之前的springConfig.xml就不要了，但之前的运行方式就不能要了，新建一个app2</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App2</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(string[] args)</span>&#123;</span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="comment">//这里getbean注意不需要拿dao，因为dao已经注入到service里了，所以直接用service的类</span></span><br><span class="line">        <span class="type">AccountService</span> <span class="variable">accountService</span> <span class="operator">=</span> ctx.getBean(AccountService.class);</span><br><span class="line"><span class="type">Account</span> <span class="variable">ac</span> <span class="operator">=</span> accountService.findById(<span class="number">1</span>);</span><br><span class="line">System.out.println(ac);<span class="comment">//查到数据</span></span><br><span class="line">    &#125;    </span><br></pre></td></tr></table></figure><h2 id="spring整合JUnit"><a href="#spring整合JUnit" class="headerlink" title="spring整合JUnit"></a>spring整合JUnit</h2><p>使用spring整合结构的这种方式来运行程序</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.设定类运行器</span></span><br><span class="line"><span class="comment">//2.设置上下文配置，配置类用calsses</span></span><br><span class="line"><span class="comment">//3.要测谁直接注入就行</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = SpringConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceTest</span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AccountService accountService;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindById</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(accountservice.findById(<span class="number">1</span>));</span><br><span class="line">        </span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindA1l</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(accountService.findAll());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ul><li>AOP(Aspect Oriented Programming)面向切面编程，一种编程范式，指导开发者如何组织程序结构<ul><li>00P(0bject Oriented Programming)面向对象编程</li></ul></li><li>作用:在不惊动原始设计的基础上为其进行功能增强</li><li>Spring理念:无入侵式&#x2F;无侵入式</li></ul><p>想让蓝色部分在别的方法也拥有，就把蓝色部分抽取出来做一个单独的方法，然后原始save方法起名叫<strong>连接点</strong>；对追加功能的方法叫做<strong>切入点</strong>，这个切入点就说明了哪些方法要追加功能；让大家都有的方法是一组共性的功能，起名叫<strong>通知</strong>，但怎么就知道要在update和delete上执行这个通知呢，看来在通知和切入点之间还得有个东西把他俩绑定到一块，这样的话一个通知就对应一个切入点，这个东西叫做<strong>切面</strong>，切面描述的是这个通知的共性功能与对应的切入点的关系。然后在java中的方法需要依托<strong>通知类</strong>，不能独立存在</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251216184936360.png" alt="image-20251216184936360"></p><p>了解完后整体的流程就是：首先找到程序中间的共性功能，写一个通知类，在通知类中定义一个方法，这个方法叫通知，这个方法里放的是共性功能 ，把需要执行对应通知的方法找出定义成切入点，把切入点和通知绑定就得到了切面，切面描述的是在哪个切入点执行哪些通知</p><ul><li>连接点(JoinPoint):程序执行过程中的任意位置，粒度为执行方法、抛出异常、设置变量等<ul><li>在SpringAOP中，理解为方法的执行</li></ul></li><li>切入点(Pointcut):匹配连接点的式子<ul><li>在SpringAoP中，一个切入点可以只描述一个具体方法，也可以匹配多个方法<ul><li>一个具体方法:com.itheima.dao包下的BookDao接口中的无形参无返回值的save方法</li><li>匹配多个方法:所有的save方法，所有的get开头的方法，所有以Dao结尾的接口中的任意方法，所有带有一个参数的方法</li></ul></li></ul></li><li>通知(Advice):在切入点处执行的操作，也就是共性功能<ul><li>在springA0P中，功能最终以方法的形式呈现</li></ul></li><li>通知类:定义通知的类</li><li>切面(Aspect):描述通知与切入点的对应关系</li></ul><p>切入点范围小，连接点范围大，切入点一定在连接点中</p><h3 id="AOP入门案例"><a href="#AOP入门案例" class="headerlink" title="AOP入门案例"></a>AOP入门案例</h3><p>设定:在接口执行前输出当前系统时间<br>开发模式:XML or 注解</p><p>思路分析：</p><ol><li>导入坐标(pom.xml)</li><li>制作连接点方法(原始操作，Dao接口与实现类)</li><li>制作共性功能(通知类与通知)</li><li>定义切入点</li><li>绑定切入点与通知关系(切面 )</li></ol><p>导入坐标的话导入spring-context，aop也会被自动导入，再导入一个aspectj</p><p>第二步是制作连接点方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(system.currentTimeMillis());</span><br><span class="line">System.out.println(<span class="string">&quot;book dao save ...</span></span><br><span class="line"><span class="string">public void update()&#123;</span></span><br><span class="line"><span class="string">System.out.println(&quot;</span>book dao update ...<span class="string">&quot;</span></span><br></pre></td></tr></table></figure><p>第三步是把共性功能抽出做新的类，里面写个方法叫method，这就是共性功能</p><p>第四步定义切入点，写个私有方法，加上@Pointcut，里面的execution是执行的意思，括号里是返回值void，类全限定名的update方法有没有参数。说明:切入点定义依托一个不具有实际意义的方法进行，即无参数，无返回值，方法体无实际逻辑</p><p>第五步，让method方法在切入点的什么位置执行呢，如果是前面就用@before，里面是方法名</p><p>第六步加上@Component让它受springbean控制，加上@Aspect让spring知道这里是aop</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line"><span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(System.currentTimeMillis());</span><br></pre></td></tr></table></figure><p>但现在spring不知道是用注解开发的aop，所以要在配置类加个@EnableAspectJAutoProxy告诉spring这里面有用注解开发的aop，也就是启动了@Aspect去识别里面的东西</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Componentscan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">springcinfig</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AOP工作流程"><a href="#AOP工作流程" class="headerlink" title="AOP工作流程"></a>AOP工作流程</h3><ol><li><p>Spring容器启动</p></li><li><p>读取所有切面配置中的切入点（配置在@Before的才会生效）</p></li><li><p>初始化bean，判定bean对应的类中的方法是否匹配到任意切入点</p><p>​    如果匹配失败，就创建对象</p><p>​    匹配成功，创建原始对象(<strong>目标对象)<strong>的</strong>代理</strong>对象，代理就表示可以用代理对象调用对应方法走增强的那些操作</p></li><li><p>获取bean执行方法</p><p>​    获取bean，拿上面匹配失败创建的对象去调用方法并执行，完成操作</p><p>​    获取的bean是代理对象时，根据代理对象的运行模式运行原始方法与增强的内容，完成操作，这个也就是aop用的是代理模式</p></li></ol><p>核心概念：</p><ul><li>目标对象(Target):原始功能去掉共性功能对应的类产生的对象，这种对象是无法直接完成最终工作的</li><li>代理(Proxy):目标对象无法直接完成工作，需要对其进行功能回填，通过原始对象的代理对象实现</li></ul><p>没有开启aop的时候打印对象和class类：</p><p>com.itheima.dao.impl.BookDaoImpl@279fedbd<br>class com.itheima.dao.impl.BookDaoImpl</p><p>开启aop的时候打印对象和class类：</p><p>com.itheima.dao.impl.BookDaoImpl@4e50c791<br>class com.sun.proxy.$Proxy19</p><p>因为aop会对最终的对象的toString方法进行重写，直接打印对象比如System.out.println(bookDao);就会带来一些误导</p><h3 id="AOP切入点表达式"><a href="#AOP切入点表达式" class="headerlink" title="AOP切入点表达式"></a>AOP切入点表达式</h3><ul><li>切入点:要进行增强的方法</li><li>切入点表达式:要进行增强的方法的描述方式</li></ul><p>比如现在有两个方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;book dao update ...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>描述方式一:执行com.itheima.dao包下的BookDao接口中的无参数update方法<ul><li>execution(void com.itheima.dao.BookDao.update())</li></ul></li><li>描述方式二:执行com.itheima.dao.impl包下的BookDaoImpl类中的无参数update方法<ul><li>execution(void com.itheima.dao.impl.BookDaoImpl.update())</li></ul></li></ul><p>上面两种方式都可以，描述接口或者描述实现类</p><p>切入点表达式标准格式：动作关键字(访问修饰符  返回值 包名.类&#x2F;接口名.方法名(参数)异常名 )</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution (<span class="keyword">public</span> User com.itheima.service.UserService.findById (<span class="type">int</span>))</span><br></pre></td></tr></table></figure><ul><li>动作关键字:描述切入点的行为动作，例如execution表示执行到指定切入点，这个词几乎不动</li><li>访问修饰符:public，private等，可以省略</li><li>返回值</li><li>包名</li><li>类&#x2F;接口名</li><li>方法名</li><li>参数</li><li>异常名:方法定义中抛出指定异常，可以省略，忽略就是public</li></ul><p>可以使用通配符描述切入点，快速描述</p><ul><li><p>单个独立的任意符号，可以独立出现，也可以作为前缀或者后缀的匹配符出现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一个*是不限制返回类型，第二个是任意包的意思，第三个是范围匹配，第四个是任意参数</span></span><br><span class="line">execution(<span class="keyword">public</span> * com.itheima.*.UserService.find* (*))</span><br></pre></td></tr></table></figure><p>​    匹配com.itheima包下的任意包中的UserService类或接口中所有find开头的（必须）带有一个参数的方法</p></li><li><p>..：多个连续的任意符号，可以独立出现，常用于简化包名与参数的书写</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(<span class="keyword">public</span> User com..UserService.findById(..))</span><br></pre></td></tr></table></figure><p>意思是匹配com包下的任意包中的UserService类或接口中所有名称为findByld的任意方法</p></li><li><p>+:专用于匹配子类类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* *..*Service+.*(..))</span><br></pre></td></tr></table></figure><p>任意返回值，任意包下面以Service结尾的子类的任意方法任意参数，括号里的是*就必须有参数才行</p></li><li><p>书写技巧：</p><ul><li>所有代码按照标准规范开发，否则以下技巧全部失效</li><li>描述切入点<strong>通常描述接口</strong>，而不描述实现类，因为描述实现类就紧耦合了</li><li>访问控制修饰符针对接口开发均采用public描述(<strong>可省略访问控制修饰符描述</strong></li><li>返回值类型对于增删改类使用<strong>精准</strong>类型加速匹配，对于查询类使用*<strong>通配</strong>快速描述</li><li><strong>包名</strong>书写<strong>尽量不使用..匹配</strong>，效率过低，常用*做单个包描述匹配，或精准匹配</li><li><strong>接口名</strong>&#x2F;类名书写名称与模块相关的<strong>采用*匹配</strong>，例如UserService书写成*Service,绑定业务层接口名</li><li><strong>方法名</strong>书写以<strong>动词</strong>进行<strong>精准匹配</strong>，名词采用*匹配，例如getByld书写成getBy*,selectAl书写成selectAll</li><li>参数规则较为复杂，根据业务方法灵活调整</li><li>通常<strong>不使用异常</strong>作为匹配规则</li></ul></li></ul><h3 id="AOP通知类型"><a href="#AOP通知类型" class="headerlink" title="AOP通知类型"></a>AOP通知类型</h3><ul><li>AOP通知描述了抽取的共性功能，根据共性功能抽取的位置不同，最终运行代码时要将其加入到合理的位置</li><li>AOP通知共分为5种类型<ul><li>前置通知</li><li>后置通知</li><li>环绕通知(重点)</li><li>返回后通知(了解 )</li><li>抛出异常后通知(了解)</li></ul></li></ul><p>演示：准备以下代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">puplic iht <span class="title function_">select</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line"><span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span><span class="comment">//前置通知</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123; system.out.println(<span class="string">&quot;before advice ...&quot;</span>);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@After(&quot;pt()&quot;)</span><span class="comment">//后置通知</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123; system.out.println(<span class="string">&quot;after advice ...&quot;</span>);&#125;</span><br></pre></td></tr></table></figure><p>环绕通知这个直接输出的话会输出<br>around before advice …<br>around after advice …，原方法没有执行，所以必须要加个东西表示对原始操作的调用，方法是在around的括号里加上ProceedingJoinPoint参数，取名pjp，然后用这个调用proceed，这个就是代表对原始操作的调用，这里有红线因为原始操作无法预期是否有异常，</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line"><span class="meta">@Pointcut(&quot;execution(int com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(int com.itheima.dao.BookDao.select())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Around(&quot;pt()&quot;)</span><span class="comment">//环绕通知</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;around before advice ...&quot;</span>);</span><br><span class="line">        <span class="comment">//表示对原始操作的调用</span></span><br><span class="line">        pjp.proceed();</span><br><span class="line">System.out.println(<span class="string">&quot;around after advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>但如果新弄一个select的，运行时会抛出异常AopInvocationException，后面的英文意思是空的返回值从这个advance中出来了，它不匹配原始操作调用的返回值类型，原始操作返回的是int，所以要让最后能有个返回值给抛出去，返回类型用object。原始操作其实调用的是impl方法，里面return的是100，那么这100哪去了？ pjp.proceed();其实有个返回值，这个返回值就是原本的100</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Around(&quot;pt2()&quot;)</span></span><br><span class="line"><span class="comment">//public void aroundSelect(ProceedingJoinPoint pjp) throws Throwable&#123;要有返回值</span></span><br><span class="line">   <span class="keyword">public</span> Object <span class="title function_">aroundSelect</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;around before advice ...&quot;</span>);</span><br><span class="line">       <span class="comment">//表示对原始操作的调用</span></span><br><span class="line">       <span class="comment">//pjp.proceed();</span></span><br><span class="line">       <span class="type">Object</span> <span class="variable">proceed</span> <span class="operator">=</span>  pjp.proceed();</span><br><span class="line">       <span class="comment">//如果返回值要加点什么，就要强转类型，因为object不能做加法</span></span><br><span class="line">       <span class="comment">//Integer ret = (Integer)pjp.proceed;</span></span><br><span class="line">System.out.println(<span class="string">&quot;around after advice ...&quot;</span>);</span><br><span class="line">       <span class="comment">//return 200;</span></span><br><span class="line">       <span class="keyword">return</span> ret;</span><br><span class="line">       <span class="comment">//return ret+666;</span></span><br><span class="line">       以上是标准写法</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>下面代表原始方法执行成功后执行这个动作，了解即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterReturning(&quot;pt2()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>&#123; </span><br><span class="line">       system.out.println(<span class="string">&quot;afterReturning advice ...&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>下面是抛出异常后才运行</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterThorwing(&quot;pt2()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span>&#123;</span><br><span class="line">system.out.println(<span class="string">&quot;afterThrowing advice ...&quot;</span>);&#125;</span><br></pre></td></tr></table></figure><p>@Around注意事项</p><ol><li>环绕通知必须依赖形参ProceedingJoinPoint才能实现对原始方法的调用，进而实现原始方法调用前后同时添加通知</li><li>通知中如果未使用ProceedingjoinPoint对原始方法进行调用将跳过原始方法的执行，会产生一种对原始操作进行隔离的效果，比如做权限校验</li><li>对原始方法的调用可以不接收返回值，通知方法设置成void即可,如果接收返回值，必须设定为Obiect类型</li><li>原始方法的返回值如果是void类型，通知方法的返回值类型可以设置成void，也可以设置成Object</li><li>由于无法预知原始方法运行后是否会抛出异常，因此环绕通知方法必须抛出Throwable对象</li></ol><h3 id="案例：测量业务层接口万次执行效率"><a href="#案例：测量业务层接口万次执行效率" class="headerlink" title="案例：测量业务层接口万次执行效率"></a>案例：测量业务层接口万次执行效率</h3><p>需求:任意业务层接口执行均可显示其执行效率(执行时长)<br>分析：</p><ol><li>业务功能:业务层接口执行前后分别记录时间，求差值得到执行效率</li><li>通知类型选择前后均可以增强的类型——环绕通知</li></ol><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251220160656006.png" alt="image-20251220160656006"></p><p>准备以上数据</p><p>业务层</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Accountservice</span>&#123;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Account account)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Account account)</span>;</span><br><span class="line">List&lt;Account&gt; <span class="title function_">findA11</span><span class="params">()</span>;</span><br><span class="line">Account <span class="title function_">findById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure><p>第一步，先在springConfig里把aop注解开启</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Componentscan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="meta">@Import(&#123;Jdbcconfig.class,MybatisConfig.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span><span class="comment">//开启</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">springconfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>然后创建aop包，新建ProjectAdvice类，我们是对业务层接口做监控所以起名也是这个，返回值不好说是什么，所以用通配，方法是任意方法，参数是什么都行。然后用循环去执行原始方法，最后打印结果，但这个并不能用，因为并不知道执行时间是哪个具体的方法，而ProceedingJoinPoint描述的是原来那个方法的执行对象，通过这个拿到执行的签名信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="comment">//受spring管理</span></span><br><span class="line"><span class="meta">@Aspect</span><span class="comment">//切面类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectAdvice</span>&#123;</span><br><span class="line">    <span class="comment">//匹配业务层所有方法</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.itheima.service.*Service.*(..))&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">servicePt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">        </span><br><span class="line">    <span class="meta">@Around(&quot;ProjectAdvice.servicePt()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">runspeed</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable&#123;</span><br><span class="line">        <span class="comment">//通过这个拿到执行的签名信息</span></span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> pjp.getsignature();</span><br><span class="line">        <span class="comment">//System.out.println(signature.getDeclaringType());//打印类型interface com.itheima.service.AccountService</span></span><br><span class="line"><span class="comment">//System.out.println(signature.getName());//打印方法名findById</span></span><br><span class="line">        <span class="comment">//System.out.println(signature.getDeclaringTypeName());//打印类型名com.itheima.service.AccountService</span></span><br><span class="line">        <span class="comment">//改进</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> signature.getDeclaringTypeName();</span><br><span class="line"><span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> signature.getName();</span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> start=system.currentTimeMillis();</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; <span class="number">10000</span>; i++)&#123;</span><br><span class="line">pjp.proceed();</span><br><span class="line">        &#125;</span><br><span class="line"><span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"><span class="comment">//System.out.println(&quot;业务层接口万次执行时间:[&quot;+(end-start)+&quot;ms&quot;);//注意要加括号，否则是字符串拼接</span></span><br><span class="line">        <span class="comment">//return ret;但是返回哪一遍都不合理，所以直接干掉，方法返回值变成void</span></span><br><span class="line">        <span class="comment">//改进</span></span><br><span class="line">        System.out.println(<span class="string">&quot;万次执行:&quot;</span>+ className +<span class="string">&quot;.&quot;</span>+ methodName +<span class="string">&quot;----&gt;&quot;</span> +(end-start)+ <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>补充说明：当前测试的接口执行效率仅仅是一个理论值，并不是一次完整的执行过程</p><h3 id="AOP通知获取数据"><a href="#AOP通知获取数据" class="headerlink" title="AOP通知获取数据"></a>AOP通知获取数据</h3><ul><li>获取切入点方法的参数<ul><li>JoinPoint:适用于前置、后置、返回后、抛出异常后通知（每个都有）</li><li>ProceedJointPoint:适用于around环绕通知</li></ul></li><li>获取切入点方法返回值<ul><li>返回后通知（afterReturning）</li><li>环绕通知（around）</li></ul></li><li>获取切入点方法运行异常信息<ul><li>抛出异常后通知</li><li>环绕通知</li></ul></li></ul><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251221024909688.png" alt="image-20251221024909688"></p><p>这个参数是pjp的父</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint jp)</span>&#123;</span><br><span class="line">object[] args = jp.getArgs();</span><br><span class="line">System.out.println(Arrays.tostring(args));</span><br><span class="line">System.out.println(<span class="string">&quot;before advice ...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在bookdao添加参数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">findName</span><span class="params">(<span class="type">int</span> id,String password)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="keyword">public</span> string <span class="title function_">findName</span><span class="params">(<span class="type">int</span> id,string password)</span>&#123;</span><br><span class="line">System.out.println(“id:<span class="string">&quot;+id);</span></span><br><span class="line"><span class="string">return &quot;</span>itcast<span class="string">&quot;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>启动程序</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(string[] args)</span>&#123;</span><br><span class="line">ApplicationContext ctx= <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationcontext</span>(Springconfig.class);</span><br><span class="line"><span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ctx.getBean(BookDao.class);</span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> bookDao.findName(id:<span class="number">100</span>,password: <span class="string">&quot;itheima&quot;</span>);</span><br><span class="line">System.out.println(name):</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">然后输出：[<span class="number">100</span>, itheima]</span><br><span class="line">before advice ...</span><br><span class="line">id:<span class="number">100</span></span><br><span class="line">itcast</span><br></pre></td></tr></table></figure><p><strong>参数的调用：</strong></p><p>其他的都一样这样用，对于around，父接口能调用的方法子接口也可以用，所以直接pjp.getArgs调用对应参数</p><p>在调用原始方法时，对于proceed这个操作除了空参外还可以传个object数组，也就是可以把上面的args传进去</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(“pt()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span><span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">object[] args = pjp.getArgs();</span><br><span class="line">System.out.println(Arrays.tostring(args));</span><br><span class="line"><span class="comment">//object ret = pjp.proceed();</span></span><br><span class="line">    <span class="type">object</span> <span class="variable">ret</span> <span class="operator">=</span> pjp.proceed(args);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line">输出[<span class="number">100</span>,itheima]</span><br><span class="line">id:<span class="number">100</span></span><br><span class="line">itcast</span><br></pre></td></tr></table></figure><p>但如果在获取之后调用之前把args的值更改了，比如args[0] &#x3D; 666；最后输出的结果也会被更改，所以如果传过来的参数有问题，我们就可以先处理一下，这里可以保证程序的健壮性，不需要每个程序都写，一个aop就可以搞定</p><p><strong>返回值的调用</strong>：</p><p>一个是around一个是afterReturning，around的返回值就是ret</p><p>而afterReturning要拿返回值，可以先定义一个用来接受返回值的形参，但如果定义了后就要告诉@AfterReturning用ret这个变量准备接受返回值。点进@AfterReturning可以看到提供了很多东西，其中一个是returning和value，returning的值要和形参名对应</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterReturning(value = &quot;pt()&quot;, returning = &quot;ret&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(Object ret)</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;afterReturning advice ...&quot;</span>+ret);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当JoinPoint和Object同时存在，JoinPoint必须在第一个位置，其他的也是一样，如果不是这样就会报IllegalArgumentException异常</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(JoinPoint jp,Object ret)</span>&#123;</span><br></pre></td></tr></table></figure><p><strong>异常对象的调用：</strong></p><p>两种写法，第一种是</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> &#123;</span><br><span class="line">object[] args = pjp.getArgs();</span><br><span class="line">System.out.println(Arrays.tostring(args));</span><br><span class="line">    <span class="type">object</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        ret = pjp.proceed(args);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable throwable)&#123;</span><br><span class="line">        throwable.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第二种</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterThrowing(value = &quot;pt()&quot;,throwing =&quot;t&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(Throwable t)</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;afteiThrowing advice ...&quot;</span>+t)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="案例：百度网盘密码数据兼容处理"><a href="#案例：百度网盘密码数据兼容处理" class="headerlink" title="案例：百度网盘密码数据兼容处理"></a>案例：百度网盘密码数据兼容处理</h3><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251224024522509.png" alt="image-20251224024522509"></p><p>分析：<br>①：在业务方法执行之前对所有的输入参数进行格式处理——trim(0)<br>②：使用处理后的参数调用原始方法–环绕通知中存在对原始方法的调用</p><p>准备代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ResourcesService</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">openURL</span><span class="params">(string url ,string password)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourcesServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ResourcesService</span> &#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ResourcesDao resourcesDao;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">openURL</span><span class="params">(string url, string password)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> resourcesDao.readResources(url,password);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ResourcesDao</span>&#123;</span><br><span class="line"><span class="type">boolean</span> <span class="title function_">readResources</span><span class="params">(String url,String password)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourcesDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">ResourcesDao</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">readResources</span><span class="params">(String url,String password)</span>&#123;</span><br><span class="line"><span class="comment">//模拟校验</span></span><br><span class="line"><span class="keyword">return</span> password.equals(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(string[l args)</span>&#123;</span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationcontext</span>(SpringConfig.class);</span><br><span class="line"><span class="type">ResourcesService</span> <span class="variable">resourcesService</span> <span class="operator">=</span> ctx.getBean(ResourcesService.class):</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> resourcesService.openURL( url: <span class="string">&quot;http://pan.baidu.com/haha&quot;</span>, password: <span class="string">&quot;root&quot;</span>),</span><br><span class="line">System.out.println(flag);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>现在简单运行一下，返回的是true，如果把root后面加个空格就会返回false，我们想要的效果是加上空格也能返回true，也就是帮我把这个空格去掉</p><p>首先开启aop注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Componentscan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">springconfig</span> &#123;</span><br></pre></td></tr></table></figure><p>新建aop处理类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataAdvice</span> &#123;</span><br><span class="line"><span class="meta">@Pointcut(&quot;execution(boolean com.itheima.service.*service.*(*,*))&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">servicePt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@Around(&quot;DataAdvice.servicePt()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> object <span class="title function_">trimstr</span><span class="params">(ProceedingJoinPoint pjp)</span><span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">object[<span class="type">l</span> <span class="variable">args</span> <span class="operator">=</span> pjp.getArgs();</span><br><span class="line">        <span class="comment">//怎么去掉呢，有的人想用循环trim去掉空格，但args是个对象不能用trim</span></span><br><span class="line"><span class="comment">/*for(object obj:args)&#123;</span></span><br><span class="line"><span class="comment">            obj.trim//没有这个调用方法</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        <span class="comment">//这里用for循环不用foreach</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; args.length; i++)&#123;<span class="comment">//通过i拿到索引值</span></span><br><span class="line"><span class="comment">//判断参数是不是字符串</span></span><br><span class="line">            <span class="keyword">if</span>(args[i].getClass().equals(String.class))&#123;</span><br><span class="line">                args[i] = args[i].toString().trim();<span class="comment">//如果是字符串类就一定可以转换成字符串，然后trim，改完再放回去</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//把改完的参数放进原始操作里然后返回       </span></span><br><span class="line"><span class="type">Obiect</span> <span class="variable">ret</span> <span class="operator">=</span> pip.proceed(args),</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>如果想测试做没做对就可以在输出程序app里添加</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(password.length());</span><br></pre></td></tr></table></figure><p>然后把root改成1234空格空格，打印出来的长度为4就是对的</p><h3 id="AOP总结"><a href="#AOP总结" class="headerlink" title="AOP总结"></a>AOP总结</h3><ul><li>概念:AOP(Aspect 0riented Programming)面向切面编程，一种编程范式</li><li>作用:在不惊动原始设计的基础上为方法进行功能<strong>增强</strong></li><li>核心概念<ul><li>代理(Proxy):SpringAoP的核心本质是采用代理模式实现的</li><li>连接点(JoinPoint):在SpringA0P中，理解为任意方法的执行</li><li>切入点(Pointcut):匹配连接点的式子，也是具有共性功能的方法描述</li><li>通知(Advice):若干个方法的共性功能，在切入点处执行，最终体现为一个方法</li><li>切面(Aspect):描述通知与切入点的对应关系</li><li>目标对象(Target):被代理的原始对象成为目标对象</li></ul></li></ul><p>切入点表达式书写技巧</p><ol><li>按<strong>标准规范</strong>开发</li><li>查询操作的返回值建议使用*匹配</li><li>减少使用..的形式描述包</li><li><strong>对接口进行描述</strong>,使用*表示模块名，例如userservice的匹配描述为*Service</li><li>方法名书写保留动词，例如get,使用<em>表示名词，例如getById匹配描述为getBy</em></li><li>参数根据实际情况灵活调整</li></ol><p>环绕通知可以模拟出其他四种通知，比如只在调用原始操作前做事情，这就是前置通知，用try catch写完后在finally写的东西就是后置通知，而返回后通知是在你的try catch finally中try大括号结束之前，原始调用方法之后的那些可以模拟返回后通知，catch模拟抛出异常后通知</p><p>环绕通知(重点 )</p><ul><li>环绕通知依赖形参ProceedingJoinPoint才能实现对原始方法的调用</li><li>环绕通知可以隔离原始方法的调用执行</li><li>环绕通知返回值设置为0bject类型</li><li>环绕通知中可以对原始方法调用过程中出现的异常进行处理</li></ul><h2 id="spring事务简介"><a href="#spring事务简介" class="headerlink" title="spring事务简介"></a>spring事务简介</h2><h3 id="案例：银行账户转账"><a href="#案例：银行账户转账" class="headerlink" title="案例：银行账户转账"></a>案例：银行账户转账</h3><ul><li>事务作用:在数据层保障一系列的数据库操作同成功同失败</li><li>Spring事务作用:在数据层或业务层保障一系列的数据库操作同成功同失败</li></ul><p>spring提供了一个接口，叫做平台事务管理器，大概意思是提交的时候都提交，回滚的时候都回滚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PlatformTransactionManager</span>&#123;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">commit</span><span class="params">(TransactionStatus status)</span><span class="keyword">throws</span> TransactionException;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">(TransactionStatus status)</span><span class="keyword">throws</span> TransactionException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实现类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatasourceTransactionManager</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是这个内部使用的是jdbc的事务，如果用的是jdbc的技术就可以用这个，而mybatis内部就是用的jdbc</p><p>案例：模拟银行账户间转账业务<br>需求：实现任意两个账户间转账操作<br>需求微缩：A账户减钱，B账户加钱</p><p>分析<br>①：数据层提供基础操作，指定账户减钱(outMoney)，指定账户加钱(inMoney)<br>②：业务层提供转账操作(transfer),调用减钱与加钱的操作<br>③：提供2个账号和操作金额执行转账操作<br>④：基于Sprinq整合MyBatis环境搭建上述操作</p><p>转账接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转账操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> out 传出方</span></span><br><span class="line"><span class="comment"> * param in 转入方</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> money 金额</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">    <span class="meta">@Transactional</span><span class="comment">//在需要添加事务的方法上加这个注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String out,String in ,Double money)</span>;</span><br></pre></td></tr></table></figure><p>数据层接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountDao</span></span><br><span class="line"><span class="meta">@Update(&quot;update tbl_account set money = money + #&#123;money&#125; where name = #&#123;name&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">inMoney</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span>String name, <span class="meta">@Param(&quot;money&quot;)</span>Double money)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Update(&quot;update tbl_account set money = money - #&#123;money&#125; where name = #&#123;name&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">outMoney</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span>String name, <span class="meta">@Param(&quot;money&quot;)</span> Double money)</span>;</span><br></pre></td></tr></table></figure><p>业务层实现类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String out,String in ,Double money)</span>&#123;</span><br><span class="line">accountDao.outMoney(out,money);</span><br><span class="line">accountDao.inMoney(in,money);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = SpringConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceTest</span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AccountService accountService;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTransfer</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">accountService.transfer(<span class="string">&quot;Tom&quot;</span>,<span class="string">&quot;Jerry&quot;</span>,<span class="number">100D</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>结果分析<br>①：程序正常执行时，账户金额A减B加，没有问题<br>②：程序出现异常后，转账失败，但是异常之前操作成功,异常之后操作失败，整体业务失败</p><p>第一步：要在接口上添加事务注解</p><p>第二部，到jdbc配置中配一个事务管理器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> PlatformTransactionManager <span class="title function_">transactionManager</span><span class="params">(DataSource dataSource)</span>&#123;</span><br><span class="line"><span class="type">DataSourceTransactionManager</span> <span class="variable">transactionManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>();</span><br><span class="line">transactionManager.setDataSource(dataSource);<span class="comment">//dataSource是bean注入的</span></span><br><span class="line"><span class="keyword">return</span> transactionManager;</span><br></pre></td></tr></table></figure><p>第三步要让spring知道你是用注解形式开启事务管理，到spring的配置文件中配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Componentscan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="meta">@Import(&#123;Jdbcconfig.class,Mybatisconfig.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span><span class="comment">//这个</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">springconfig</span> &#123;</span><br></pre></td></tr></table></figure><p>注意事项：Spring注解式事务通常添加在业务层接口中而不会添加到业务层实现类中，降低耦合<br>注解式事务可以添加到业务方法上表示当前方法开启事务，也可以添加到接口上表示当前接口所有方法开启事务</p><h3 id="spring事务角色"><a href="#spring事务角色" class="headerlink" title="spring事务角色"></a>spring事务角色</h3><p>上一节的案例里业务层方法中使用了这个操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(string out,string in ,Double money)</span>&#123;</span><br><span class="line">accountDao.outMoney(out,money);</span><br><span class="line">accountDao.inMoney(in,money);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>而这两个操作分别对应独立的数据层操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountDao</span> &#123;</span><br><span class="line"><span class="meta">@Update(&quot;update tbl_account set money = money -#&#123;money&#125; where name = #&#123;name&#125;&quot;</span></span><br><span class="line"><span class="meta">void outMoney(@Param(&quot;name&quot;) String name, @Param(&quot;money&quot;) Double money);</span></span><br><span class="line"><span class="meta">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountDao</span> &#123;</span><br><span class="line"><span class="meta">@Update(&quot;update tbl_account set money = money + #&#123;money&#125; where name = #&#123;name&#125;&quot;</span></span><br><span class="line"><span class="meta">void inMoney(@Param(&quot;name&quot;)String name, @Param(&quot;money&quot;)Double money);</span></span><br></pre></td></tr></table></figure><p>上面两个属于增删改操作所以都要开启事务，分别叫t1t2，这两个是不同的事务，假如第二个出现了异常，第一个不会去回滚。当业务层加上开启事务注解后就会有事务T，目前是三个事务，谁也不挨谁，于是spring在这里做了一件事，既然数据层都在业务层的控制范围内，这两个事务都改成和他一样的事务。讲spring开启的这个事务叫做事务管理员，将加入事务管理员的这些成员叫做事务的协调员</p><ul><li>事务角色<ul><li>事务管理员：发起事务方，在Spring中通常指代业务层开启事务的方法</li><li>事务协调员：加入事务方，在Spring中通常指代数据层方法，也可以是业务层方法</li></ul></li></ul><p>还有个需要注意的是在写程序的时候jdbc和mybatis里都注入了一个datasource，正因为使用了同一个datasource，所以才能够进行统一管理</p><h3 id="事务相关配置"><a href="#事务相关配置" class="headerlink" title="事务相关配置"></a>事务相关配置</h3><table><thead><tr><th align="center">属性</th><th align="center">作用</th><th align="center">示例</th></tr></thead><tbody><tr><td align="center">readOnly</td><td align="center">设置是否为只读事务</td><td align="center">readonly&#x3D;true 只读事务</td></tr><tr><td align="center">timeout</td><td align="center">设置事务超时时间</td><td align="center">timeout &#x3D;-1(永不超时)</td></tr><tr><td align="center"><strong>rollbackFor</strong></td><td align="center">设置事务回滚异常(class)</td><td align="center">rollbackFor &#x3D;{NullPointException.class}</td></tr><tr><td align="center">rollbackForClassName</td><td align="center">设置事务回滚异常(string)</td><td align="center">同上格式为字符串</td></tr><tr><td align="center">noRollbackFor</td><td align="center">设置事务不回滚异常(class)</td><td align="center">noRollbackFor<br/>&#x3D;{NullPointException.class}</td></tr><tr><td align="center">noRollbackForClassName</td><td align="center">设置事务不回滚异常(string)</td><td align="center">同上格式为字符串</td></tr><tr><td align="center">propagation</td><td align="center">设置事务传播行为</td><td align="center">…..</td></tr></tbody></table><p>点进事务按ctrl+f12可以查看类的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span>&#123;</span><br><span class="line"><span class="meta">@Transactinnal(readOnly = true,timeout = -1)</span><span class="comment">//代表只读和永不超时</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String out,String in ,Double money)</span><span class="keyword">throws</span> IoException;</span><br></pre></td></tr></table></figure><p>重点是rollbackFor遇到某一类异常回滚事务</p><p>一般遇到这两种会进行回滚，第一种是error系列的错误，比如内存溢出，第二种是运行时异常，而IOException这种属于编译时异常。而你希望在IOException异常发生后进行回滚就可以这样写</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(rollbackFor =&#123;I0Exception.class)</span></span><br></pre></td></tr></table></figure><p>案例：转账业务追加日志<br>需求：实现任意两个账户间转账操作，并对每次转账操作在数据库进行留痕<br>需求微缩：A账户减钱，B账户加钱，数据库记录日志</p><p>分析：</p><ol><li>基于转账操作案例添加日志模块，实现数据库中记录日志</li><li>业务层转账操作(transfer)，调用减钱、加钱与记录日志功能</li></ol><p><strong>实现效果预期</strong>：</p><p>​无论转账操作是否成功，均进行转账操作的日志留痕</p><p> log业务层</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LogService</span> &#123;</span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">log</span><span class="params">(string out, string in, Double money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实现类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogserviceImpl</span> <span class="keyword">implements</span> <span class="title class_">LogService</span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> LogDao logDao;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String out,String in,Double money )</span>&#123;</span><br><span class="line">logDao.log( info:<span class="string">&quot;转账操作由&quot;</span>+out+<span class="string">&quot;到&quot;</span>+in+<span class="string">&quot;,金额:&quot;</span>+money);<span class="comment">//拼接成字符串</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>数据层</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LogDao</span> &#123;</span><br><span class="line"><span class="meta">@Insert(&quot;insert into tbl log(info,createDate)values(#&#123;info&#125;,now())&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String info)</span>;<span class="comment">//把传过来的信息作为info信息传到insert里</span></span><br></pre></td></tr></table></figure><p>实现类，回过头看要求是无论转账操作是否成功，均进行转账操作的日志留痕，怎样保证代码一定会执行，可以用try finally方法，把有可能出问题的代码放上面，finally放一定执行的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">Accountservice</span> &#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> LogService logService;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/*public void transfer(string out,string in ,Double money)&#123;</span></span><br><span class="line"><span class="comment">logservice.log(out,in,money);//这一句话并不一定保证能运行</span></span><br><span class="line"><span class="comment">accountDao.outMoney(out,money);</span></span><br><span class="line"><span class="comment">accountDao.inMoney(in,money);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String out,String in ,Double money)</span>&#123;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">accountDao.outMoney(out,money);</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;<span class="comment">//模拟异常</span></span><br><span class="line">accountDao.inMoney(in,money);</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">logService.log(out,in,money);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>然后在accountService和LogService都开启事务，去数据库查看运行效果，发现没有问题，然后在程序里模拟异常，然后再查看数据库，这时候金额没有发生变化，但日志也没有被记录</p><p><strong>存在的问题</strong>：<br>日志的记录与转账操作隶属同一个事务，同成功同失败</p><p><strong>实现效果预期改进</strong>：<br>无论转账操作是否成功，日志必须保留</p><p>这里学习到一个<strong>事务传播行为</strong>:事务协调员对事务管理员所携带事务的处理态度，协调员是加入呢还是不加入还是搞一个新的。</p><p>这里是搞一个新的事务，点开LogService的事务注解，里面有个方法是propagation，里面有一系列的默认值，用法是如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactinnal(propagation = Propagation.REQUIRES_NEW)</span></span><br></pre></td></tr></table></figure><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251226033800696.png" alt="image-20251226033800696"></p><h1 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h1><h2 id="SpringMVC简介"><a href="#SpringMVC简介" class="headerlink" title="SpringMVC简介"></a>SpringMVC简介</h2><p>SpringMVC概述</p><ul><li>SpringMVc技术与Servlet技术功能等同，均属于web层开发技术</li><li>优点<ul><li>使用简单，开发便捷(相比于Servlet)</li><li>灵活性强</li></ul></li></ul><p>以下是用servlet的保存代码（仅演示，除此之外还有其他三个不同功能的类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Webservlet(&quot;/user/save&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSaveServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpservletRequest reg, HttpservletResponse resp)</span> <span class="keyword">throws</span> ServletException, IoException &#123;</span><br><span class="line"><span class="comment">//1.接收请求参数</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> reg.getParameter( name:<span class="string">&quot;name&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;servlet save name ==&gt;&quot;</span> + name);</span><br><span class="line"><span class="comment">//2.产生响应</span></span><br><span class="line">resp.setcontentType(<span class="string">&quot;text/json;charset=utf-8&quot;</span>);</span><br><span class="line">PrintWriter pw=resp.getWriter();</span><br><span class="line">pw.write( s:<span class="string">&quot;&#123;&#x27;module&#x27;:&#x27;servlet save&#x27;&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpservletRequest reg, HttpservletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"><span class="built_in">this</span>.doGet(reg,resp);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>用mvc做就变成只有一个类，里面集成了四个方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Usercontroller</span>&#123;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(String name)</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;springmvc save name ==&gt;&quot;</span> + name);</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;:&#x27;springmvc save&#x27;&#125;&quot;</span>;</span><br></pre></td></tr></table></figure><h2 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a>入门案例</h2><p>①：使用SpringMVc技术需要先导入SpringMVc坐标与Servlet坐标，也就是导入maven</p><p>②：创建SpringMVC控制器类(等同于servlet功能)，用@Component是定义bean，但在mvc中开发表现层的bean要用@Controller这个注解</p><p>③：初始化SpringMVC环境(同Spring环境)，设定SpringMVC加载对应的bean</p><p>④：初始化Servlet容器，加载SpringMVC环境，并设置SpringMVC技术处理的请求。在mvc中提供了一个专用的开发web容器的配置类，只需要自己定义一个类然后继承就行了</p><p>然后新建项目，在pom.xml配置，导入servlet包说会与tomcat有冲突，之前的web里学的是启动项参数（大概），这里是加了个标签provided，意思是在编译时可用运行时不可用，test相反</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后新建controller包UserController类，返回json就是String类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2.定义controller</span></span><br><span class="line"><span class="comment">//2.1使用@controller定义bean</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"><span class="comment">//2.2设置当前操作的访问路径，对应下面第五步，/save对应save方法</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="comment">//2.3设置当前操作的返回值类型</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;user save...”);</span></span><br><span class="line"><span class="string">return &quot;</span>&#123;<span class="string">&#x27;module&#x27;</span>:<span class="string">&#x27;springmvc&#x27;</span>&#125;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>再新建一个spring配置类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.创建springmvc的配置文件，加载controller对应的bean</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima.controller&quot;)</span><span class="comment">//看下面的第四步</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>再做一个tomcat容器启动的配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4.定义一个servlet容器启动的配置类，在里面加载spring的配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletContainersInitConfig</span> <span class="keyword">extends</span> <span class="title class_">AbstractDispatcherServletInitializer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//加载mvc配置</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> WebApplicationContext <span class="title function_">createServletApplicationContext</span><span class="params">()</span>&#123;<span class="comment">//看下面工作流程的第二步</span></span><br><span class="line"><span class="type">AnnotationConfigWebApplicationcontext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigWebApplicationContext</span>();<span class="comment">//注意这个是应用于web的，是初始化一个空容器</span></span><br><span class="line">        <span class="comment">//注册配置，看下面的第三步</span></span><br><span class="line">ctx.register(SpringMvcConfig.class);</span><br><span class="line"><span class="keyword">return</span> ctx;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//设置哪些发过来的请求归属springMVc处理，对应下面的第六步</span></span><br><span class="line"><span class="keyword">protected</span> String[] getServletMappings()&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">string</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;;<span class="comment">//一个斜杠就是所有请求</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//加载spring容器配置</span></span><br><span class="line"><span class="keyword">protected</span> WebApplicationContext <span class="title function_">createRootApplicationContext</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//把上面mvc的直接复制古来然后把括号里的mvc删掉就是spring的配置了</span></span><br><span class="line">        <span class="type">AnnotationConfigWebApplicationcontext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigWebApplicationContext</span>();</span><br><span class="line">ctx.register(SpringConfig.class);</span><br><span class="line"><span class="keyword">return</span> ctx;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>名称:@Controller</p><ul><li>类型:类注解</li><li>位置:SpringMvc控制器类定义上方</li><li>作用:设定SpringMVc的核心控制器bean</li></ul><p>名称:@RequestMapping</p><ul><li>类型:方法注解</li><li>位置:SpringMVc控制器方法定义上方</li><li>作用:设置当前控制器方法请求访问路径</li><li>相关属性：value：请求访问路径</li></ul><p>名称:@ResponseBody</p><ul><li><p>类型:方法注解</p></li><li><p>位置:SpringMVc控制器方法定义上方</p></li><li><p>作用:设置当前控制器方法响应内容为当前返回值，无需解析</p></li><li><p>AbstractDispatcherServletInitializer类是SpringMVC提供的快速初始化Web3.8容器的抽象类</p></li><li><p>AbstractDispatcherServletInitializer提供三个接口方法供用户实现</p><ul><li>createServletApplicationContext()方法，创建Servlet容器时，加载SpringMVC对应的bean并放入<br>WebApplicationContext对象范围中，而webApplicationContext的作用范围为ServletContext范围，即整个web容器范围</li><li>getservletMappings()方法，设定SpringMVC对应的请求映射路径，设置为&#x2F;表示拦截所有请求，任意请求都将转入到SpringMVc进行处理</li><li>createRootApplicationcontext()方法，如果创建Servlet容器时需要加载非SpringMVC对应的bean，使用当前方法进行，使用方式同createservletApplicationcontext()</li></ul></li></ul><h3 id="入门案例工作流程分析"><a href="#入门案例工作流程分析" class="headerlink" title="入门案例工作流程分析"></a>入门案例工作流程分析</h3><p>启动服务器初始化过程：</p><ol><li><p>服务器启动，执行ServletContainersInitConfig类，初始化web容器</p></li><li><p>执行createServletApplicationContext方法，创建了WebApplicationcontext对象，这个对象就是mvc最终体现的对象，有了这个对象就被加载到了web容器中，但被加载到什么位置呢，就是ServletContext，最大范围的这个</p></li><li><p>加载SpringMvcConfig</p></li><li><p>执行@Componentscan加载对应的bean</p></li><li><p>加载Usercontroller，每个@RequestMapping的名称对应一个具体的方法</p></li><li><p>执行getservletMappings方法，定义所有的请求都通过SpringMVC</p><p><img src="./images/黑马程序员SSM/image-20251226193620265.png"> []getRootconfigclasses(){<br> return new class[]{SpringConfig.class};<br> }<br> protected class&lt;?&gt;[]getServletconfigclasses(){<br> return new Class[]{SpringMvcConfig.class};<br> }<br> protected string[l getservletMappings(){<br> return new string[]{“&#x2F;“};<br> }</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 网页调试与发送网页HTTP请求的插件</span><br><span class="line"></span><br><span class="line">老师教的是postman，但我用的是apifox，所以看个原理就行</span><br><span class="line"></span><br><span class="line">主要作用是模拟浏览器发送请求，比如发送get请求在地址栏写一下就行，但post请求就得写个表单，ajax就得写个js文件，但使用了这个工具，上面的工作就不用做了</span><br><span class="line"></span><br><span class="line">先新建工作空间，这里面的操作可以备份和记录，然后新建请求，选择请求的类型比如get，然后输入地址点击发送就可以</span><br><span class="line"></span><br><span class="line">## 请求与响应</span><br><span class="line"></span><br><span class="line">### 请求的映射路径</span><br><span class="line"></span><br><span class="line">准备数据</span><br><span class="line"></span><br><span class="line">~~~java</span><br><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;/user&quot;)</span><br><span class="line">public class Usercontroller &#123;</span><br><span class="line">    </span><br><span class="line">@RequestMapping(&quot;/save&quot;)</span><br><span class="line">    //@RequestMapping(&quot;/user/save&quot;)</span><br><span class="line">@ResponseBody</span><br><span class="line">public String save()&#123;</span><br><span class="line">System.out.println(&quot;user save..&quot;);</span><br><span class="line">return &quot;&#123;&#x27;module&#x27;:&#x27;user save&#x27;&#125;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">@RequestMapping(&quot;/delete&quot;)</span><br><span class="line">    //@RequestMapping(&quot;/user/delete&quot;)</span><br><span class="line">@ResponseBody</span><br><span class="line">public String delete()&#123;</span><br><span class="line">System.out.println(&quot;user delete...&quot;);</span><br><span class="line">return &quot;&#123;&#x27;module&#x27;:&#x27;user delete&#x27;&#125;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bookcontroller</span> &#123;</span><br><span class="line"><span class="comment">//@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/book/save&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;book save ...&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;:&#x27;book save&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>这里面有两个save，然后启动一下发现报错</p><p>com.itheima.controller.UserController#save()<br>to{&#x2F;save}: There is already “bookController’ bean method</p><p>意思是&#x2F;save已经被bookController的bean方法用过了</p><p>1.团队多人开发，每人设置不同的请求路径，冲突问题如何解决——设置模块名作为请求路径前缀，比如@RequestMapping(“&#x2F;user&#x2F;save”)</p><p>也可以把@RequestMapping(“&#x2F;user”)放在整个类上面定义整个模块的请求路径前缀</p><h3 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h3><p><strong>get方式：</strong></p><p>准备数据ServletContainersInitConfig简单配置，SpringMvcConfig</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Componentscan(&quot;com.itheima.controller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">springMvcconfig</span> &#123;</span><br></pre></td></tr></table></figure><p>控制器类，如果请求的路径是<a href="http://localhost/commonParam?name=itcast%EF%BC%8C%E8%BF%99%E4%B8%AAname%E5%8F%82%E6%95%B0%E6%80%8E%E4%B9%88%E6%8E%A5%E6%94%B6%E5%91%A2%EF%BC%8C%E5%9C%A8%E6%8B%AC%E5%8F%B7%E9%87%8C%E7%9B%B4%E6%8E%A5%E6%B7%BB%E5%8A%A0String%E6%9D%A5%E6%8E%A5%E6%94%B6%E5%B0%B1%E8%A1%8C%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%98%AF%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0%E5%B0%B1%E5%9C%A8%E5%90%8E%E9%9D%A2%E6%8E%A5%E7%9D%80%E6%B7%BB%E5%8A%A0%E5%B0%B1%E8%A1%8C">http://localhost/commonParam?name=itcast，这个name参数怎么接收呢，在括号里直接添加String来接收就行，如果是多个参数就在后面接着添加就行</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"><span class="comment">//普通参数</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/commonParam&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">commonParam</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;普通参数传递 name ==&gt;&quot;</span>+ name);</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;:&#x27;common param&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>Post方式：</strong></p><p>在这里不管是post还是get请求，对于后台代码是没有变化的不区分的，和之前的Servlet是不一样的。请求地址：<a href="http://localhost/commonParam%EF%BC%8C%E7%84%B6%E5%90%8E%E5%9C%A8%E8%80%81%E5%B8%88%E6%BC%94%E7%A4%BA%E7%9A%84%E5%B7%A5%E5%85%B7%E9%87%8C%E4%B8%8D%E8%83%BD%E5%86%8D%E7%82%B9params%E4%BA%86%EF%BC%8C%E5%9B%A0%E4%B8%BApost%E8%AF%B7%E6%B1%82%E7%9A%84%E5%8F%82%E6%95%B0%E5%B1%9E%E4%BA%8E%E8%AF%B7%E6%B1%82%E4%BD%93%E5%86%85%EF%BC%8C%E6%89%80%E4%BB%A5%E8%A6%81%E7%82%B9body%E8%BF%99%E9%A1%B9">http://localhost/commonParam，然后在老师演示的工具里不能再点params了，因为post请求的参数属于请求体内，所以要点body这项</a></p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251228003332321.png" alt="image-20251228003332321"></p><p>如果是发表单数据应该用这个选项，和左边的区别在于这个不仅能发表单还能发文件，代码还是使用上面的，设置以下参数</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251228003851644.png" alt="image-20251228003851644"></p><p>如果把英文值改成中文，就会出现乱码现象，之前的处理方式是在web服务器设置一个过滤器，这里也是一样，只不过要在ServletContainersInitConfig里配置，用override覆盖方法。可以看到这里是要一个Filter数组，那么就可以直接new一个filter数组然后把过滤器对象放进去。但是过滤器在哪，springmvc有现成的字符过滤器，设定好字符集后直接把filter放进去就行</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletContainersInitConfig</span> <span class="keyword">extends</span> <span class="title class_">AbstractAnnotationConfigpispatcherservletInitializer</span>&#123;</span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses()&#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>];&#125;</span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;SpringMvcConfig.class&#125;; &#125;</span><br><span class="line"><span class="keyword">protected</span> String[] getServletMappings()&#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;; &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//乱码处理</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Filter[] getservletFilters()&#123;</span><br><span class="line"><span class="type">CharacterEncodingFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">characterEncodingFilter</span>();</span><br><span class="line">filter.setEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Filter</span>[]&#123;filter);</span><br><span class="line"><span class="comment">//return new Filter[]&#123;filter,filter1,filter2);设置多个过滤器</span></span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><p>这个characterEncodingFilter在哪里？图下坐标包含了这个</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251228154530141.png" alt="image-20251228154530141"></p><h3 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数"></a>请求参数</h3><p>**普通参数：**url地址传参，地址参数名与形参变量名相同，定义形参即可接收参数</p><p>之前提到过一个问题就是get请求里的name与代码里的名字不一样，还能接收吗，答案是不能，解决方式是添加@RequestParam，也就是把请求参数中的name给到username</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/commonParamDifferentName&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> string <span class="title function_">commonParamDifferentName</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span>String userName , <span class="type">int</span> age)</span>&#123;</span><br></pre></td></tr></table></figure><p>**pojo参数：**传参的目的是通过大量的数据组成一个model，下面这个user里面有两个属性name和age，然后发送<a href="http://localhost/pojoParam?name=itcast&age=15%EF%BC%8C%E8%BF%98%E6%98%AF%E8%83%BD%E8%A2%AB%E6%8E%A5%E6%94%B6%E5%88%B0%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E5%89%8D%E9%9D%A2%E7%9A%84%E5%B1%9E%E6%80%A7%E5%90%8D%E5%92%8C%E5%90%8E%E9%9D%A2%E5%AE%9E%E4%BD%93%E7%B1%BB%E7%9A%84%E5%B1%9E%E6%80%A7%E5%90%8D%E4%B8%80%E6%A0%B7%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%8A%A8%E6%8A%8A%E5%B1%9E%E6%80%A7%E5%A1%9E%E8%BF%9B%E5%8E%BB">http://localhost/pojoParam?name=itcast&amp;age=15，还是能被接收到，也就是前面的属性名和后面实体类的属性名一样就可以自动把属性塞进去</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//P0J0参数</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/pojoParam&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">pojoParam</span><span class="params">(User user)</span>&#123;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line"><span class="keyword">private</span> string name;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span> Address address;<span class="comment">//后面加上了get和tostring方法，这里省略</span></span><br></pre></td></tr></table></figure><p>然后还有个实体类里面定义了省市，然后封装成一个对象，然后加到上面</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span>&#123;</span><br><span class="line"><span class="keyword">private</span> String province;</span><br><span class="line"><span class="keyword">private</span> String city;</span><br></pre></td></tr></table></figure><p>然后要给实体类里某个对象传属性值应该怎么做，以下这样做就可以</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251229170705867.png" alt="image-20251229170705867"></p><p>**数组参数：**比如你的个人爱好之类的，是很多个数据，比如复选框，可以用以下接收</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//数组参数</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/arrayParam&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">arrayParam</span><span class="params">(String[] likes)</span>&#123;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251229173509907.png" alt="image-20251229173509907"></p><p>但是java编程一般用集合比较多</p><p><strong>集合参数：</strong></p><p>还是用上面的数据发送看看有什么结果，发现报错了，提示NoSuchMethodException没有这个方法，后面还有java.util.List.<init>()，只要出现<init>代表的就是构造方法，list是个接口本身就不会有构造方法。他现在是在尝试造一个list<Stirng>类型的对象，为什么要造这个对象呢，因为这是引用类型，上面的那些也都是引用类型，所以都是准备造个对象然后setlike属性，但我们要的是作为集合的参数放进去。</p><p>用@RequestParam告诉他吧那些东西作为参数扔进去，只要是集合就不按照造对象的方法来了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//集合参数</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/listParam&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="comment">//public String listParam(List&lt;String&gt; likes)&#123;</span></span><br><span class="line">/<span class="keyword">public</span> String <span class="title function_">listParam</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;String&gt; likes)</span>&#123;</span><br></pre></td></tr></table></figure><ul><li><p>名称:@RequestParam</p></li><li><p>类型:形参注解</p></li><li><p>位置:SpringMVc控制器方法形参定义前面</p></li><li><p>作用:绑定请求参数与处理器方法形参间的关系</p></li><li><p>参数:</p><ul><li>required:是否为必传参数</li><li>defaultValue:参数默认值</li></ul></li></ul><h3 id="json数据"><a href="#json数据" class="headerlink" title="json数据"></a>json数据</h3><p>先在pom导入json，然后发送数据，在body里选择raw然后选择json</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251230024829629.png" alt="image-20251230024829629"></p><p>接收代码，但目前mvc不知道外面过来的json要转化成List，需要开启一个功能键，让它帮忙做这种转化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//集合参数:json格式</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/listParamForJson&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">listParamForJson</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;String&gt; likes)</span></span><br></pre></td></tr></table></figure><p>在mvc配置中添加</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima.controller&quot;)</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span><span class="comment">//开启这个</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">springMvcconfig</span> &#123;</span><br></pre></td></tr></table></figure><p>然后运行还是报错无法造<init>对象，然后这次信息是在请求体里，也就是requestbody中，@RequestParam就不好用了，用@RequestBody就可以了</p><p>如果是传给pojo的，在body里变成这样，然后加上@RequestBody就行</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20251230033804617.png" alt="image-20251230033804617"></p><p>集合也是一样</p><ul><li><p>名称:@EnableWebMvc</p></li><li><p>类型:配置类注解</p></li><li><p>位置:SpringMvc配置类定义上方</p></li><li><p>作用:开启SpringMvc多项辅助功能</p></li><li><p>名称:@RequestBody</p></li><li><p>类型:形参注解</p></li><li><p>位置:SpringMVC控制器方法形参定义前面</p></li><li><p>作用:将请求中请求体所包含的数据传递给请求参数，此注解一个处理器方法只能使用一次</p></li></ul><p><strong>@RequestBody与@RequestParam区别</strong></p><ul><li>区别<ul><li>@RequestParam用于接收url地址传参，表单传参【application&#x2F;x-www-form-urlencoded】</li><li>@RequestBody用于接收json数据【application&#x2F;json】，在postman软件里发送的请求头中找到content-type，这里指定的是application&#x2F;json，老师说以前手写发ajax强求时这项要自己手写，现在自动加上了，如果是post的话这一项就变成了application&#x2F;x-www-form-urlencoded</li></ul></li><li>应用<ul><li>后期开发中，发送json格式数据为主，@RequestBody应用较广</li><li>如果发送非ison格式数据，选用@RequestParam接收请求参数</li></ul></li></ul><h3 id="日期类型参数传递"><a href="#日期类型参数传递" class="headerlink" title="日期类型参数传递"></a>日期类型参数传递</h3><p>如果是标准日期格式比如2012&#x2F;02&#x2F;02是可以直接由字符串转换成日期格式，但如果不是标准格式就需要用@DateTimeFormat后面带上格式就行</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(Ov&quot;/dataParam&quot;</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">public string dataParam(Date date,</span></span><br><span class="line"><span class="meta">                        @DateTimeFormat(pattern=&quot;yyyy-MM-dd&quot;)Date date1,</span></span><br><span class="line"><span class="meta">                        @DateTimeFormat(pattern=&quot;yyyy/MM/dd HH:mm:ss&quot;)Date date2)&#123;</span></span><br></pre></td></tr></table></figure><p>这个注解内部是怎么工作的呢？里面用到了类型转换器converter，它是个接口，打开时注意包的位置在springframework里，这个接口就定义了一个方法T convert(S source);，这个接口的作用是将你传递的参数与我们要收集的参数进行转换，有非常多的实现类来帮助转换</p><h2 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h2><p>相应页面，注意这里没有加@RequsetBody</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"><span class="comment">//响应页面/跳转页面</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/toJumpPage&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toJumpPage</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;跳转页面&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;Hejlo Spring Mvc!&lt;/h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>然后访问路径就可以看到page.jsp的内容被输出了，在mvc中想要响应页面只需要把页面名称写在return里然后返回字符串就可以了</p><p>如果只想返回文本呢，如果没加@ResponseBody会报错No mapping for GET&#x2F;response text，它在找一个叫response text的页面，而response text只是个文本，所以要加上@ResponseBody就行了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//响应文本数据</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/toText&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toText</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;返回纯文本数据&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;response text&quot;</span>;</span><br></pre></td></tr></table></figure><p>然后是响应json数据，如果想响应pojo对象，只需要把方法的返回值设成pojo对象然后再return这个对象就行了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//响应P0J0对象</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/toJsonP0J0&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User to]sonPo]<span class="number">0</span>()&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;返回json对象数据&quot;</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">user.setName(<span class="string">&quot;itcast&quot;</span>);</span><br><span class="line">user.setAge(<span class="number">15</span>);</span><br><span class="line"><span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但这样运行会报错，因为mvc对User返回值的要求默认是要个字符串，会把return user认成字符串”user”，所以还是要加@ResponseBody，而转换的这个操作是pom里导入的jackson帮我们做的，集合的获取也是这样</p><ul><li>名称:@ResponseBody</li><li>类型:方法注解</li><li>位置:SpringMVc控制器方法定义上方</li><li>作用:设置当前控制器方法响应内容为当前返回值，无需解析</li><li>作用:设置当前控制器返回值作为响应体</li></ul><p>实现这个转换的过程是一个叫HttpMessageConverter的接口，专门转换http消息的，打开类型层次图找到MappingJackson2HttpMessageConverter就是最终的实现类了</p><h2 id="REST风格"><a href="#REST风格" class="headerlink" title="REST风格"></a>REST风格</h2><ul><li>REST(Representational state Transfer)，表现形式状态转换，在开发中就是叫做访问网络资源的格式<ul><li>传统风格资源描述形式<br><a href="http://localhost/user/getById?id=1">http://localhost/user/getById?id=1</a><br><a href="http://localhost/user/saveUser">http://localhost/user/saveUser</a></li><li>REST风格描述形式<br><a href="http://localhost/user/1">http://localhost/user/1</a><br><a href="http://localhost/user">http://localhost/user</a></li></ul></li></ul><p>这两个链接和上面的作用完全一样</p><ul><li><p>优点:</p><ul><li>隐藏资源的访问行为，无法通过地址得知对资源是何种操作</li><li>书写简化</li></ul></li><li><p>按照REST风格访问资源时使用行为动作区分对资源进行了何种操作</p><ul><li><a href="http://localhost/users%E6%9F%A5%E8%AF%A2%E5%85%A8%E9%83%A8%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF">http://localhost/users查询全部用户信息</a> GET(查询)</li><li><a href="http://localhost/users/1%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AFGET(%E6%9F%A5%E8%AF%A2)">http://localhost/users/1查询指定用户信息GET(查询)</a></li><li><a href="http://localhost/users%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AFPOST(%E6%96%B0%E5%A2%9E/%E4%BF%9D%E5%AD%98)">http://localhost/users添加用户信息POST(新增/保存)</a></li><li><a href="http://localhost/users%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AFPUT(%E4%BF%AE%E6%94%B9/%E6%9B%B4%E6%96%B0)">http://localhost/users修改用户信息PUT(修改/更新)</a></li><li><a href="http://localhost/users/1%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AFDELETE(%E5%88%A0%E9%99%A4)">http://localhost/users/1删除用户信息DELETE(删除)</a></li></ul></li></ul><p>上述行为是约定方式，约定不是规范，可以打破，所以称REST风格，而不是REST规范<br>描述模块的名称通常使用复数，也就是加s的格式描述，表示此类资源，而非单个资源，例如:users、books、accounts.</p><ul><li>根据REST风格对资源进行访问称为RESTful，开发使用这个风格开发就叫RESTful</li></ul><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><p>根据之前的代码进行更改</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;user save...&quot;</span>+ user);</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;:&#x27;user save&#x27;&#125;&quot;</span>;</span><br></pre></td></tr></table></figure><p>然后更改，先不传参，第一链接那里要写users，第二步指定请求行为，点进RequestMapping可以看到有个叫method的，这个可以设定对应的请求方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"><span class="meta">@RequestMapping(Value =&quot;/users&quot;,method = RequestMethod.POST)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;user save...&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;:&#x27;user save&#x27;&#125;&quot;</span>;</span><br></pre></td></tr></table></figure><p>再改个delete,在请求路径上包含了一个值1，要想让id参数对应请求路径就要用到@PathVariable，也就是路径变量的意思，只有这个注解不够，还要告诉来自路径中的哪里，所以要加&#x2F;{id}进行匹配</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/users/&#123;id&#125;,method = RequestMethod.DELETE)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> string <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">”+ id);</span><br><span class="line">System.out.println(<span class="string">&quot;user delete...</span></span><br><span class="line"><span class="string">return &quot;</span>&#123;<span class="string">&#x27;module&#x27;</span>:<span class="string">&#x27;user delete&#x27;</span>&#125;<span class="string">&quot;;</span></span><br></pre></td></tr></table></figure><p>@RequestBody、@RequestParam、@PathVariable</p><ul><li>区别<ul><li>@RequestParam用于接收url地址传参或表单传参</li><li>@RequestBody用于接收json数据</li><li>@PathVariable用于接收路径参数，使用{参数名称}描述路径参数</li></ul></li><li>应用<ul><li>后期开发中，发送请求参数超过1个时，以json格式为主，@RequestBody应用较广</li><li>如果发送非json格式数据，选用@RequestParam接收请求参数</li><li>采用RESTfu1进行开发，当参数数量较少时，例如1个，可以采用@Pathvariable接收请求路径变量，通常用于传递id值</li></ul></li></ul><h3 id="restful快速开发"><a href="#restful快速开发" class="headerlink" title="restful快速开发"></a>restful快速开发</h3><p>value&#x3D;”&#x2F;books”和@ResponseBody这种重复代码写起来很繁琐能不能简化呢。可以用@ReqstMapping(“&#x2F;books”)代替前面重复的value那些，但是有参数的还是要留着{id}这种。</p><p>然后@ResponseBody可以拿到外面了，而springmvc给合成了一个@RestController，里面包含了这两个注解。</p><p> @RequestMapping(value &#x3D; “&#x2F;{id}”,method &#x3D; RequestMethod.DELETE)这个就简化成了DeleteMapping(“&#x2F;{id}”)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Controller</span></span><br><span class="line"><span class="comment">//@ResponseBody</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@ReqstMapping(&quot;/books”)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line">    <span class="comment">//@RequestMapping(value = &quot;/&#123;id&#125;&quot;,method = RequestMethod.DELETE)</span></span><br><span class="line">    <span class="comment">//DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> string <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;book delete...&quot;</span>+ id);</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;:&#x27;book delete&#x27;&#125;&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="案例-基于RESTful页面数据交互"><a href="#案例-基于RESTful页面数据交互" class="headerlink" title="案例:基于RESTful页面数据交互"></a>案例:基于RESTful页面数据交互</h3><p>能正常展示数据，并且点击新建按钮输入信息后能提交到后台</p><p>先把后台的controller做出来然后再使用postman测通，然后让页面能运行，然后发送ajax提交能访问后台表现层接口</p><p>准备数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Componentscan(&quot;com.itheima.controller&quot;)</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> &#123;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">servletcontainersInitconfig</span> <span class="keyword">extends</span> <span class="title class_">AbstractAnnotationConfigDispatcherservletInitializer</span>&#123;</span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt;[] getRootconfigclasses()&#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">class</span>[<span class="number">0</span>]; &#125;</span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigclasses()&#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">class</span>[]&#123;springMvcConfig.class&#125;; &#125;</span><br><span class="line"><span class="keyword">protected</span> String[] getservletMappings()&#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;; &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//乱码处理</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Filter[] getservletFilters()&#123;</span><br><span class="line"><span class="type">CharacterEncodingFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CharacterEncodingFilter</span>();</span><br><span class="line">filter.setEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Filter</span>[]&#123;filter&#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>domain包下Book类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span>&#123;</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="keyword">private</span> String type;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> String description;</span><br><span class="line">    下面是tostring和setget方法</span><br></pre></td></tr></table></figure><p>创建BookController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Book book)</span>&#123;<span class="comment">//要记得加@RequestBody接收json数据</span></span><br><span class="line">System.out.println(<span class="string">&quot;book save ==&gt;&quot;</span>+ book);</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;:&#x27;book save success&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">   <span class="meta">@GetMapping</span></span><br><span class="line">   <span class="keyword">public</span> List&lt;Book&gt; <span class="title function_">getAll</span><span class="params">()</span>&#123;</span><br><span class="line">List&lt;Book&gt;bookList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Book&gt;();</span><br><span class="line"><span class="type">Book</span> <span class="variable">book1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">book1.setType(<span class="string">&quot;计算机&quot;</span>);</span><br><span class="line">book1.setName(<span class="string">&quot;springMvc入门教程&quot;</span>);</span><br><span class="line">book1.setDescription(<span class="string">&quot;小试牛刀&quot;</span>);</span><br><span class="line">bookList.add(book1);<span class="comment">//添加到集合里</span></span><br><span class="line">       </span><br><span class="line"><span class="type">Book</span> <span class="variable">book2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">book2.setType(<span class="string">&quot;计算机&quot;</span>);</span><br><span class="line">book2.setName(<span class="string">&quot;springMVc实战教程&quot;</span>);</span><br><span class="line">book2.setDescription(<span class="string">&quot;一代宗师&quot;</span>);</span><br><span class="line">bookList.add(book2);</span><br><span class="line"><span class="keyword">return</span> bookList: </span><br></pre></td></tr></table></figure><p>然后postman发送和接收一下测试测试</p><p>然后把html的那些东西复制到webapp文件夹里，运行一下服务器，然后访问html网址，结果404，后台输出提示[WARNING] No mapping for GET &#x2F;pages&#x2F;books.html，是被mvc拦截了，它认为应该有个配置叫books.html，所以应该把这个放行交给tomcat处理，问题出在下面，”&#x2F;“是把所有请求都经过mvc，应该把静态资源不过mvc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">servletcontainersInitconfig</span> <span class="keyword">extends</span> <span class="title class_">AbstractAnnotationConfigDispatcherservletInitializer</span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> String[] getservletMappings()&#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;; &#125;</span><br></pre></td></tr></table></figure><p>方案一：做一个功能类，在config里新建一个SpringmvcSupport</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcSupport</span> <span class="keyword">extends</span> <span class="title class_">WebMvcconfigurationSupport</span> &#123;<span class="comment">//继承这个类</span></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span>&#123;<span class="comment">//查看继承类有什么关于source的方法，找到了这个</span></span><br><span class="line">    <span class="comment">//当访问/pages/**的时候，走/pages目录下的内容</span></span><br><span class="line">registry.addResourceHandler(<span class="string">&quot;/pages/**&quot;</span>).addResourceLocations(<span class="string">&quot;/pages/&quot;</span>);<span class="comment">//这里的意思是如果发送的是/pages/**请求就走/pages/下的内容</span></span><br></pre></td></tr></table></figure><p>写完上面的代码记得必须要有个动作就是让mvc启动时加载这里，加上@Configuration然后在Springmvc配置类里改成</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.itheima.controller&quot;,&quot;com.itheima.config&quot;)</span></span><br></pre></td></tr></table></figure><p>以后要放行什么就在SpringmvcSupport继续添加就行</p><p>这里是vue代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//主页列表查询</span></span><br><span class="line"><span class="title function_">getA11</span>(<span class="params"></span>)&#123;</span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;/books&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">dataList</span> = res,data;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//添加</span></span><br><span class="line"><span class="title function_">saveBook</span>(<span class="params"></span>)&#123;</span><br><span class="line">axios.<span class="title function_">post</span>(<span class="string">&quot;/books&quot;</span>,<span class="variable language_">this</span>.<span class="property">formData</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">&#125;);<span class="comment">//这里是post要提交数据，所以路径后面要加上this.formData</span></span><br></pre></td></tr></table></figure><h2 id="SSM整合"><a href="#SSM整合" class="headerlink" title="SSM整合"></a>SSM整合</h2><h3 id="SSM整合流程"><a href="#SSM整合流程" class="headerlink" title="SSM整合流程"></a>SSM整合流程</h3><ol><li><p>创建工程</p></li><li><p>SSM整合</p><ul><li><p>Spring</p><ul><li>SpringConfig</li></ul></li><li><p>MyBatis</p><ul><li><p>MybatisConfig</p></li><li><p>Jdbcconfig</p></li><li><p>jdbc.properties</p></li></ul></li><li><p>SpringMVC</p><ul><li><p>ServletConfig</p></li><li><p>SpringMvcConfig</p></li></ul></li></ul></li><li><p>功能模块</p><ul><li>表与实体类</li><li>dao(接口+自动代理)</li><li>service(接口+实现类<ul><li>业务层接口测试(整合Junit)</li></ul></li><li>controller<ul><li>表现层接口测试(PostMan)</li></ul></li></ul></li></ol><p>先导入pom，里面有Spring、mybatis、mybatisSpring整合、mysql、junit、Servlet、jackson</p><p>再创建包config、controller、dao、domain、Service、impl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span><span class="comment">//配置类</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.itheima.service&quot;&#125;)</span><span class="comment">//扫描包</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;jdbc.properties&quot;)</span><span class="comment">//加载jdbc配置文件（里面是连接jdbc的信息）</span></span><br><span class="line"><span class="meta">@Import(&#123;JdbcConfig.class,MyBatisConfig.class&#125;)</span><span class="comment">//加载配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">springconfig</span> &#123;</span><br></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/ssm db</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jdbcconfig</span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String driver;,</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String url;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@bean</span></span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">dataSource.setDriverclassName(driver);</span><br><span class="line">datasource.setUrl(url);</span><br><span class="line">dataSource.setUsername(username);</span><br><span class="line">dataSource.setPassword(password);</span><br><span class="line"><span class="keyword">return</span> dataSource;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisconfig</span> &#123;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SqlSessionFactoryBean <span class="title function_">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span>&#123;<span class="comment">//这里的dataSource是Spring容器根据类型自动装配</span></span><br><span class="line"><span class="type">SqlSessionFactoryBean</span> <span class="variable">factoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">factoryBean.setDataSource(dataSource);</span><br><span class="line">factoryBean.setTypeAliasesPackage(<span class="string">&quot;com.itheima.domain&quot;</span>);<span class="comment">//类型别名扫描包</span></span><br><span class="line"><span class="keyword">return</span> factoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//映射扫描（Dao）</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MapperscannerConfigurer <span class="title function_">mapperScannerConfigurer</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">MapperScannerConfigurer</span> <span class="variable">msc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MapperScannerConfigurer</span>();</span><br><span class="line">msc.setBasePackage(<span class="string">&quot;com.itheima.dao&quot;</span>);<span class="comment">//扫描包</span></span><br><span class="line"><span class="keyword">return</span> msc;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">servletcontainersInitconfig</span> <span class="keyword">extends</span> <span class="title class_">AbstractAnnotationConfigDispatcherservletInitializer</span>&#123;</span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt;[] getRootconfigclasses()&#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">class</span>[<span class="number">0</span>]; &#125;</span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigclasses()&#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">class</span>[]&#123;springMvcConfig.class&#125;; &#125;</span><br><span class="line"><span class="keyword">protected</span> String[] getservletMappings()&#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;; &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//乱码处理</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Filter[] getservletFilters()&#123;</span><br><span class="line"><span class="type">CharacterEncodingFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CharacterEncodingFilter</span>();</span><br><span class="line">filter.setEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Filter</span>[]&#123;filter&#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Componentscan(&quot;com.itheima.controller&quot;)</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> &#123;</span><br></pre></td></tr></table></figure><p>这里老师提到mvc容器能访问Spring容器，反过来不行，这里是父子容器概念</p><h3 id="功能模块"><a href="#功能模块" class="headerlink" title="功能模块"></a>功能模块</h3><p>创建pojo对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="keyword">private</span> String type;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> String description;</span><br><span class="line"><span class="comment">//后面是setget tostring</span></span><br></pre></td></tr></table></figure><p>Service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="comment">//用mybatis自动代理创建实现类</span></span><br><span class="line">    <span class="comment">//@Insert(&quot;insert into tbl_book values(null,#&#123;type&#125;,#&#123;name&#125;,#&#123;description&#125;)”)这种写法括号里的字段对应book中的属性</span></span><br><span class="line"><span class="meta">@Insert(&quot;insert into tbl_book (type,name,description)values(#&#123;type&#125;,#&#123;name&#125;,#&#123;description&#125;)&quot;//这种写法前面的type是数据库中的字段，后面的是book中的属性，没有了id的null</span></span><br><span class="line"><span class="meta">public void save(Book book);</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">@Update(&quot;update tbl_book set type = #&#123;type&#125;, name = #&#123;name&#125;, description = #&#123;idescription&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">public void update(Book book);</span></span><br><span class="line"><span class="meta">@Delete(&quot;delete from tbl_book where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">public void delete(Integer id);</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from tbl_book where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">public Book getById(Integer id);//查单个</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from tbl_book&quot;)</span></span><br><span class="line"><span class="meta">public List&lt;Book&gt; getA11();//查所有</span></span><br></pre></td></tr></table></figure><p>这样的接口层一般是不行的，最好是见名知意，返回值用boolean用来判断返回成功或失败</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Bookservice</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存</span></span><br><span class="line"><span class="comment"> <span class="doctag">@param</span> book</span></span><br><span class="line"><span class="comment"> <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">save</span><span class="params">(Book book)</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">update</span><span class="params">(Book book)</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">delete</span><span class="params">(Integer id)</span>;</span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">getById</span><span class="params">(Integer id)</span>;</span><br><span class="line"><span class="keyword">public</span> List&lt;Book&gt; <span class="title function_">getA11</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p>然后实现类，要用到dao接口了，然后注入dao</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@Autowired</span><span class="comment">//注入dao</span></span><br><span class="line"><span class="keyword">private</span> BookDao bookDao;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">save</span><span class="params">(Book book)</span>&#123;</span><br><span class="line">        bookDao.save(book);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//统一写true</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><pre><code>public Book getById(Integer id){return bookDao.getById(id);}</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">但做ssm整合的时候如果要注入这个的东西，在整个系统中不存在，也就是Spring中没有配bookdao的bean，我们用的自动代理，所以没有对应的bean给它自动装配，所以idea在这里把bookDao做个检查然后报错，但这个报错不影响运行，在弹出的下列选项里进入到idea做语法检查的设置，有一个Autowiring for bean class是自动装配的时候对bean的类型做检测，把它勾掉或者更改提示类型为警告</span><br><span class="line"></span><br><span class="line">![image-20260101163637629](./images/黑马程序员SSM/image-20260101163637629.png)</span><br><span class="line"></span><br><span class="line">![image-20260101163817235](./images/黑马程序员SSM/image-20260101163817235.png)</span><br><span class="line"></span><br><span class="line">然后是控制层</span><br><span class="line"></span><br><span class="line">~~~java</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/books&quot;)</span><br><span class="line">public class Bookcontroller&#123;</span><br><span class="line">    @Autowired</span><br><span class="line">private BookService bookService;</span><br><span class="line">    </span><br><span class="line">@PostMapping</span><br><span class="line">public boolean save(@RequestBody Book book)&#123;//从前端提交的json数据获取所以要加RequestBody</span><br><span class="line">return bookService.save(book);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><pre><code>@DeleteMapping(&quot;/{id}&quot;)public boolean delete(@PathVariable Integer id){return bookService.delete(id);}@GetMappingpublic List&lt;Book&gt; getA11(){return bookService.getA11();}</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 接口测试</span><br><span class="line"></span><br><span class="line">~~~java</span><br><span class="line">@RunWith(SpringJUnit4ClassRunner.class)//Spring整合测试类</span><br><span class="line">@ContextConfiguration(classes = SpringConfig.class)//加载配置类</span><br><span class="line">public class BookServiceTest&#123;</span><br><span class="line">    </span><br><span class="line">    @Autowired</span><br><span class="line">private Bookservice bookservice;</span><br><span class="line">    </span><br><span class="line">@Test</span><br><span class="line">public void testGetById()&#123;</span><br><span class="line">Book book = bookService.getById(1);</span><br><span class="line">System.out.println(book);</span><br><span class="line">    &#125;//这里老师说正常测试要做断言测试，不知道是什么</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>然后是开启事务，先在SpringConfig里加上@EnableTransactionManagement，然后写事务管理器，要用到datasource，在jdbcconfig里添加代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> PlatformTransactionManager <span class="title function_">transactionManager</span><span class="params">(DataSource dataSource)</span>&#123;<span class="comment">//平台事务管理器</span></span><br><span class="line">DataSourceTransactionManager ds= <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>();</span><br><span class="line">ds.setDataSource(dataSource):<span class="comment">//这里的datasource一定要从形参里拿</span></span><br><span class="line"><span class="keyword">return</span> ds;</span><br></pre></td></tr></table></figure><p>然后在业务层加上@Transactional</p><h3 id="表现层数据封装"><a href="#表现层数据封装" class="headerlink" title="表现层数据封装"></a>表现层数据封装</h3><p>前端接收数据格式太多，增删改返回true，查单条一个json，查全部一个集合json，所以现在要整合到一个里面</p><ul><li>前端接收数据格式-创建结果模型类，封装数据到data属性中</li></ul><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260101194434877.png" alt="image-20260101194434877"></p><p>但现在分不出返回的true是增还是删，所以再加一个code用来区分功能</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260101195035410.png" alt="image-20260101195035410"></p><p>又有个问题，如果查询不存在的数据，后台会返回data：null，code:20041，但这个代表成功还是失败？所以我们做个规定，结尾是1就是成功，0就是失败。所以就变成了这样，如果是20041就从data取数据</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">20040</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span></span><br></pre></td></tr></table></figure><p>然后又有问题，20040是没取到，应该给用户看什么呢，于是封装特殊消息到message(msg)属性中，变成</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">20040</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span></span><br><span class="line"><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;数据查询失败，请重试！&quot;</span></span><br></pre></td></tr></table></figure><p>设置统一数据返回结果类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span> &#123;</span><br><span class="line"><span class="keyword">private</span> Object data;</span><br><span class="line"><span class="keyword">private</span> Integer code;</span><br><span class="line"><span class="keyword">private</span> String msg;</span><br></pre></td></tr></table></figure><p>注意：Result类中的字段并不是固定的，可以根据需要自行增减<br>提供若干个构造方法，方便操作</p><h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><p>其他数据继承上面的ssm整合，然后因为这是前后端沟通，要展示给前端的所以是表现层用，放到controller包里。因为是前后端沟通的所以不需要写tostring，只需要写setget，然后要提供构造方法不然就是new一个对象然后不停往里面set。构造方法分别是三个都要，data、code和无参</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span> &#123;</span><br><span class="line"><span class="keyword">private</span> Object data;</span><br><span class="line"><span class="keyword">private</span> Integer code;</span><br><span class="line"><span class="keyword">private</span> String msg;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Result</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Result</span><span class="params">(Integer code,Object data)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.data = data;</span><br><span class="line"><span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Result</span><span class="params">(Integer code, Object data, String msg)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.data = data;</span><br><span class="line"><span class="built_in">this</span>.code = code;</span><br><span class="line"><span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>然后再创建一个Code类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">code</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">SAVE_OK</span> <span class="operator">=</span> <span class="number">20011</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">DELETE_OK</span> <span class="operator">=</span> <span class="number">20021</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer <span class="type">UPDATE</span> <span class="variable">OK</span> <span class="operator">=</span> <span class="number">2031</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer <span class="type">GET</span> <span class="variable">OK</span> <span class="operator">=</span> <span class="number">20041</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer <span class="type">SAVE</span> <span class="variable">ERR</span> <span class="operator">=</span> <span class="number">20010</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer <span class="type">DELETE</span> <span class="variable">ERR</span> <span class="operator">=</span> <span class="number">20020</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">UPDATE_ERR</span> <span class="operator">=</span> <span class="number">20030</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer <span class="type">GET</span> <span class="variable">ERR</span> <span class="operator">=</span> <span class="number">20040</span>;</span><br></pre></td></tr></table></figure><p>然后BookController里return的结果就变了，全都返回Result</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Book book)</span>&#123;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> bookservice.save(book);</span><br><span class="line"><span class="keyword">return</span> new.Result(flag ? Code.SAVE_OK:Code.SAVE_ERR,flag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line"><span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookService.getById(id);</span><br><span class="line"><span class="type">Integer</span> <span class="variable">code</span> <span class="operator">=</span> book != <span class="literal">null</span> ? Code.GET_OK : Code.GET_ERR;<span class="comment">//如果book不为空就返回ok，否则err</span></span><br><span class="line"><span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> book != <span class="literal">null</span> ? <span class="string">&quot;&quot;</span>:<span class="string">&quot;数据查询失败，请重试!&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(code,book,msg);</span><br></pre></td></tr></table></figure><h3 id="异常处理器"><a href="#异常处理器" class="headerlink" title="异常处理器"></a>异常处理器</h3><ul><li>出现异常现象的常见位置与常见诱因如下<ul><li>框架内部抛出的异常:因使用不合规导致</li><li>数据层抛出的异常:因外部服务器故障导致(例如:服务器访问超时)</li><li>业务层抛出的异常:因业务逻辑书写错误导致(例如:遍历业务书写操作，导致索引异常等)</li><li>表现层抛出的异常:因数据收集、校验等规则导致(例如:不匹配的数据类型间导致异常)</li><li>工具类抛出的异常:因工具类书写不严谨不够健壮导致(例如:必要释放的连接长期未释放等)</li></ul></li></ul><p>思考：</p><ol><li><p>各个层级均出现异常，异常处理代码书写在哪一层</p><p>-所有的异常均往上抛出到表现层进行处理</p></li><li><p>表现层处理异常，每个方法中单独书写，代码书写量巨大且意义不强，如何解决</p><p>-AOP思想，但不需要自己写，mvc提供了快捷的处理方案</p></li></ol><ul><li>异常处理器，要按规范来写<ul><li>集中的、统一的处理项目中出现的异常</li></ul></li></ul><p>首先在表现层新建一个ProjectExceptionAdvice类，然后加上注解用来声明这个类是做异常处理的，注意要在mvc配置类里加上扫描包路径</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span><span class="comment">//声明这个类是做异常处理的</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectExceptionAdvice</span> &#123;</span><br><span class="line"><span class="meta">@ExceptionHandler(Exception.class)</span><span class="comment">//拦截什么异常</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">doException</span><span class="params">(Exception ex)</span>&#123;<span class="comment">//通过Exception形参接收异常</span></span><br><span class="line">        <span class="comment">//这里面想怎么处理异常都行</span></span><br><span class="line">System.out.println(<span class="string">&quot;嘿嘿，异常你哪里跑!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">666</span>, <span class="literal">null</span>, <span class="string">&quot;嘿嘿，异常你哪里跑!&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li><p>名称:@RestControllerAdvice</p></li><li><p>类型:类注解</p></li><li><p>位置:Rest风格开发的控制器增强类定义上方</p></li><li><p>作用:为Rest风格开发的控制器类做增强</p></li><li><p>说明：</p><ul><li>此注解自带@ResponseBody注解与@component注解，具备对应的功能</li></ul></li><li><p>名称:@ExceptionHandler</p></li><li><p>类型:方法注解</p></li><li><p>位置:专用于异常处理的控制器方法上方</p></li><li><p>作用:设置指定异常的处理方案，功能等同于控制器方法，出现异常后终止原始控制器执行，并转入当前方法执行</p></li><li><p>说明</p><ul><li>此类方法可以根据处理的异常不同，制作多个方法分别处理对应的异常</li></ul></li></ul><h3 id="项目异常处理方案"><a href="#项目异常处理方案" class="headerlink" title="项目异常处理方案"></a>项目异常处理方案</h3><p>项目异常分类</p><ul><li>业务异常(BusinessException)<ul><li>不规范的用户行为操作产生的异常，比如访问路径被更改</li><li>规范的用户行为产生的异常，比如年龄输入嘿嘿</li></ul></li><li>系统异常(SystemException)<ul><li>项目运行过程中可预计且无法避免的异常比如停电</li></ul></li><li>其他异常(Exception)<ul><li>编程人员未预期到的异常，比如系统找不到指定的文件</li></ul></li></ul><p>项目异常处理方案</p><ul><li><p>业务异常(BusinessException)</p><ul><li>发送对应消息传递给用户，提醒规范操作</li></ul></li><li><p>系统异常(SystemException)</p><ul><li>发送固定消息传递给用户，安抚用户</li><li>发送特定消息给运维人员，提醒维护</li><li>记录日志</li></ul></li><li><p>其他异常(Exception)</p><ul><li>发送固定消息传递给用户，安抚用户</li><li>发送特定消息给编程人员，提醒维护(纳入预期范围内)</li><li>记录日志</li></ul></li></ul><p>创建一个exception包，然后创建一个系统异常类，然后加一个code用以区分错误，然后实现构造方法，可以用一个写一个也可以全写上，这里是只用了两个，然后再加上code的getset方法就行</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line"><span class="keyword">private</span> Integer code;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">SystemException</span><span class="params">(Integer code,string message)</span>&#123;</span><br><span class="line"><span class="built_in">super</span>(message);</span><br><span class="line"><span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="title function_">SystemException</span><span class="params">(Integer code, String message, Throwable cause)</span>&#123;</span><br><span class="line"><span class="built_in">super</span>(message,cause);</span><br><span class="line"><span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>然后在可能出现异常的地方去进行一下处理，土办法是try catch，再自己new一个异常</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Book <span class="title function_">getById</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">    <span class="comment">//这也是模拟异常</span></span><br><span class="line">    <span class="keyword">if</span>(id == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(Code.BUSINESS_ERR,<span class="string">&quot;请不要xxxx&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//将可能出现的异常进行包装，转换成自定义异常</span></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line"><span class="comment">//&#125;catch(ArithmeticException e)&#123;这样太麻烦了，直接换成Exception比较方便</span></span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(Code.SYSTEM TIMEOUT_ERR.,<span class="string">&quot;服务器访问超时，请重试!&quot;</span>,e);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">return</span> bookDao.getById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后就是异常处理器，code和消息都可以从ex里获得，其他异常就按照上面的异常处理器里写的就行</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectExceptionAdvice</span> &#123;</span><br><span class="line">    <span class="comment">//系统异常</span></span><br><span class="line"><span class="meta">@ExceptionHandler(SystemException.class)</span><span class="comment">//拦截上面的异常</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">doSystemException</span><span class="params">(SystemException ex)</span>&#123;</span><br><span class="line"><span class="comment">//记录日志</span></span><br><span class="line"><span class="comment">//发送消息给运维</span></span><br><span class="line"><span class="comment">//发送邮件给开发人员，ex对象发送给开发人员</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(ex.getCode(),data:<span class="literal">null</span>,ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//业务异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(BusinessException.class)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">doBusinessException</span><span class="params">(BusinessException ex)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(ex.getCode(),data:<span class="literal">null</span>,ex.getMessage());</span><br></pre></td></tr></table></figure><h3 id="前后端协议联调"><a href="#前后端协议联调" class="headerlink" title="前后端协议联调"></a>前后端协议联调</h3><h4 id="添加功能"><a href="#添加功能" class="headerlink" title="添加功能"></a>添加功能</h4><p>复制前端文件过来，然后现在没有配置的话页面的请求一定会被mvc拦截，所以要建个配置类给他放行，将任意请求都指向到哪个location</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcSupport</span> <span class="keyword">extends</span> <span class="title class_">WebMvcconfigurationsupport</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span>&#123;</span><br><span class="line">registry.addResourceHandler(<span class="string">&quot;/pages/**&quot;</span>).addResourceLocations(<span class="string">&quot;/pages/&quot;</span>);</span><br><span class="line">registry.addResourceHandler(<span class="string">&quot;/css/**&quot;</span>).addResourceLocations(<span class="string">&quot;/css/&quot;</span>);</span><br><span class="line"></span><br><span class="line">registry.addResourceHandler(<span class="string">&quot;/js/**&quot;</span>).addResourceLocations(<span class="string">&quot;/js/&quot;</span>);</span><br><span class="line">registry.addResourceHandler(<span class="string">&quot;/plugins/**&quot;</span>).addResourceLocations(<span class="string">&quot;/plugins/&quot;</span>);</span><br></pre></td></tr></table></figure><p>然后要在mvc中添加下面代码确保能扫描到</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Componentscan(&#123;&quot;com.itheima.controller&quot;,&quot;com.itheima.config&quot;&#125;)</span></span><br></pre></td></tr></table></figure><p>前端代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>:&#123;</span><br><span class="line"><span class="comment">//列表</span></span><br><span class="line"><span class="title function_">getA11</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="comment">//发送ajax请求</span></span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;/books&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">dataList</span> =res.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">&#125;);</span><br><span class="line">        </span><br><span class="line">   <span class="comment">//添加</span></span><br><span class="line"><span class="title function_">handleAdd</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="comment">//发送ajax请求</span></span><br><span class="line">axios.<span class="title function_">post</span>(<span class="string">&quot;/books&quot;</span>,<span class="variable language_">this</span>.<span class="property">formData</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="comment">//如果操作成功，关闭弹层，显示数据</span></span><br><span class="line"><span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20011</span>)&#123;<span class="comment">//添加成功</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">dialogFormVisible</span> = <span class="literal">false</span>,</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;添加成功&quot;</span>);<span class="comment">//这里的返回信息按理应该从后台拿，但是我们后天没写所以先在这里添加</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20010</span>)&#123;<span class="comment">//添加失败</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;添加失败&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;<span class="comment">//其他情况</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getAll</span>();</span><br></pre></td></tr></table></figure><p>然后看代码，要让代码失败就要让code为20010，去bookController看到post的返回代码里如果想返回失败就得让flag值为false，看到BookServiceImpl的代码为以下，我们要让save这个功能必须把结果反馈给我们，所以要改dao</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">save</span><span class="params">(Book book)</span>&#123;</span><br><span class="line"><span class="comment">//bookDao.save(book);</span></span><br><span class="line"><span class="comment">//return true;这里返回true是之前写死的</span></span><br><span class="line">    <span class="keyword">return</span> bookDao.save(book) &gt; <span class="number">0</span>;<span class="comment">//也就是大于0代表成功</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更改返回值为int，这个int就是行计数，用来判断到底是成功或失败</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span>&#123;</span><br><span class="line">    <span class="meta">@Insert(&quot;xxx&quot;)</span></span><br><span class="line">    <span class="comment">//pubilc void save(Book book);</span></span><br><span class="line">    pubilc <span class="type">int</span> <span class="title function_">save</span><span class="params">(Book book)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里就把成功返回写好了，但怎么构建失败，在老师的数据库设计里如果输入的东西超过20个然后提交就会报错，然后提交的时候应该弹个框提示错误的但没有反应，在前端post那里添加代码console.log(res.data);查看打印数据，发现走的是sql异常，被异常拦截器拦截了，code是5999，就直接让它这个异常输出到前端就行。然后this.getAll();这句不管成功还是失败都要输出，一般用finally来写</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//添加</span></span><br><span class="line"><span class="title function_">handleAdd</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="comment">//发送ajax请求</span></span><br><span class="line">axios.<span class="title function_">post</span>(<span class="string">&quot;/books&quot;</span>,<span class="variable language_">this</span>.<span class="property">formData</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>);</span><br><span class="line"><span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20011</span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">dialogFormVisible</span> = <span class="literal">false</span>,</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;添加成功&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20010</span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;添加失败&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">msg</span>);<span class="comment">//直接让它这个异常输出到前端就行</span></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//this.getAll();</span></span><br><span class="line">   &#125;).<span class="title function_">finally</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">       <span class="variable language_">this</span>.<span class="title function_">getAll</span>();</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure><p>然后还有个问题是弹窗输入完信息后再次打开信息没有被清空，要让每次打开弹窗都是空的就加入以下代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//弹出添加窗口</span></span><br><span class="line">handlecreate()&#123;</span><br><span class="line"><span class="built_in">this</span>.dialogFormVisible =<span class="literal">true</span>;</span><br><span class="line"><span class="built_in">this</span>.resetForm();</span><br><span class="line"><span class="comment">//重置表单</span></span><br><span class="line">resetForm()&#123;</span><br><span class="line"><span class="built_in">this</span>.formData =&#123;&#125;;</span><br><span class="line">&#125;。</span><br></pre></td></tr></table></figure><h4 id="修改功能"><a href="#修改功能" class="headerlink" title="修改功能"></a>修改功能</h4><p>修改功能弹出的框里应该是有数据的，所以要先查询数据再展示，打印row看看里面的数据，选择id为查询条件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//弹出编辑窗口</span></span><br><span class="line"><span class="title function_">handleUpdate</span>(<span class="params">row</span>)&#123;</span><br><span class="line"><span class="comment">//console.log(row);//row.id 查询条件</span></span><br><span class="line"><span class="comment">//查询数据，根据id查询</span></span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;/books/&quot;</span>+row.<span class="property">id</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20041</span>)&#123;</span><br><span class="line">            <span class="comment">//console.log(res.data.data);//查看报错问题</span></span><br><span class="line">        <span class="comment">//展示弹层加载数据</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">formData</span> = res.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">dialogFormVisible4Edit</span> = <span class="literal">true</span>;<span class="comment">//显示这个组件</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">msg</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>显示组件的时候发现报错，打印数据看看，发现输出了个null，结果是之前的Serviceimpl里有模拟的异常导致的，注释掉就行了</p><h4 id="编辑功能"><a href="#编辑功能" class="headerlink" title="编辑功能"></a>编辑功能</h4><p>和添加功能一模一样，把里面的代码匹配一下，然后axios.post改为put</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//编辑</span></span><br><span class="line"><span class="title function_">handleEdit</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="comment">//发送ajax请求</span></span><br><span class="line">axios.<span class="title function_">put</span>(<span class="string">&quot;/books&quot;</span>,<span class="variable language_">this</span>.<span class="property">formData</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="comment">//如果操作成功，关闭弹层，显示数据</span></span><br><span class="line"><span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20031</span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">dialogFormVisible4Edit</span> =<span class="literal">false</span>;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20030</span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;修改失败&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">msg</span>);</span><br><span class="line">&#125;).<span class="title function_">finally</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">getA11</span>();</span><br><span class="line">&#125;);</span><br><span class="line">&#125;，</span><br></pre></td></tr></table></figure><h4 id="删除功能"><a href="#删除功能" class="headerlink" title="删除功能"></a>删除功能</h4><p>删除要先提示是否删除，then是确定后干什么，catch是取消后干什么。然后根据id删除，删除完在finally那里记得刷新页面</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleDelete</span>(<span class="params">row</span>)&#123;</span><br><span class="line">    <span class="comment">//1.弹出提示框，第一个参数是内容，第二个是标题，第三个是关于框的一些设定</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$confirm</span>*(<span class="string">&quot;此操作永久删除当前数据，是否继续？&quot;</span>.<span class="string">&quot;提示&quot;</span>,&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="string">&#x27;info&#x27;</span><span class="comment">//会有个提示的图标</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//2.做删除业务</span></span><br><span class="line">        axios.<span class="title function_">delete</span>(<span class="string">&quot;/books/&quot;</span>+row.<span class="property">id</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20021</span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;删除失败&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//3.取消删除</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">info</span>(<span class="string">&quot;取消删除操作&quot;</span>);</span><br><span class="line">   &#125;).<span class="title function_">finally</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">getA11</span>();</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h2><h3 id="拦截器概念"><a href="#拦截器概念" class="headerlink" title="拦截器概念"></a>拦截器概念</h3><p>浏览器发送请求会发送到tomcat服务器，拦截这个请求后会划分成静态和动态资源，静态的一般直接返回，动态的就是经过过滤器，过完过滤器后就会交给处理器工作，也就是mvc，然后先看访问的是什么请求，这个地方就是中央控制器，中央控制器根据你的访问将它分发到具体的控制器方法中，让它执行操作，操作完会返回一个数据，比如json。</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260105033140661.png" alt="image-20260105033140661"></p><p>然后我们想要在每个Controller访问之前做一件事，比如说权限控制，有的人觉得在controller后也需要一些事，所以就这样产生了拦截器</p><ul><li>拦截器(Interceptor)是一种动态拦截方法调用的机制，在SpringMvc中动态拦截控制器方法的执行</li><li>作用<ul><li>在指定的方法调用前后执行预先设定后的的代码</li><li>阻止原始方法的执行</li></ul></li></ul><p>拦截器与过滤器区别：</p><ul><li>归属不同:Filter属于Servlet技术，Interceptor属于SpringMVc技术</li><li>拦截内容不同:Filter对所有访问进行增强，Interceptor仅针对SpringMvVc的访问进行增强</li></ul><p>弹幕：springmvc核心就是一个servlet做请求分发，filter是在进入servlet之前，interceptor是在进入servlet之后</p><h3 id="入门案例-1"><a href="#入门案例-1" class="headerlink" title="入门案例"></a>入门案例</h3><p>准备的类和之前的差不多，过滤器放在表现层里，在controller新建interceptor包，这个单词要记住，然后新建ProjectInterceptor。继承的这个方法后发现不需要实现方法，这是因为接口里面都有默认方法，然后把这三个方法都覆盖掉</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="comment">//受mvc管理</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpservletRequest request, HttpservletResponse response, object handler)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;preHandle...&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//如果改成false就会只执行到preHandle...然后中止往后的所有操作</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">@0verride</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpservletRequest reguest, HttpservletResponse response, obiect handler, ModelAndview modelAndView)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;postHandle...&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line">                           </span><br><span class="line">@0verride</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttoservletReguest reguest, HttoservletResponse response, obiect handler, Exception ex)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;aftercompletion...&quot;</span>);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><p>记得让mvc扫这个包</p><p>然后在config新建一个SpringMvcSupport，这个是过滤访问静态资源的，之前有写过。拦截器和过滤的写法区别差不多，只不过注册的东西不一样。下面括号里的拦截器可以通过自动注入来加入</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcSupport</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationsupport</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProjectInterceptor projectIntereptor;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span>&#123;</span><br><span class="line">registry.addResourceHandler( <span class="string">&quot;/pages/**&quot;</span>).addResourceLocations(<span class="string">&quot;/pages/&quot;</span>);</span><br><span class="line">&#125;<span class="comment">//访问page路径时指定访问到什么目录下的文件</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span>&#123;</span><br><span class="line">registry.addInterceptor(projectIntereptor).addPathPatterns(<span class="string">&quot;/books&quot;</span>,<span class="string">&quot;/books/*&quot;</span>);<span class="comment">//添加指定拦截器，添加被拦截路径，第二个是以books开头的全拦截，想添加其他的可以继续添加</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>记得也要让mvc加载这个包</p><p>然后前端发送请求去调试，返回了以下信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">preHandle...这是在什么什么之前</span><br><span class="line">book save...Book&#123;书名=&#x27;springmvc实战&#x27;，价格=66.8&#125;</span><br><span class="line">postHandle..这是在什么什么之后</span><br><span class="line">afterCompletion...在完成之后</span><br></pre></td></tr></table></figure><p>不过SpringMvcSupport可以简化开发，在mvcConfig里可以继承这个方法，里面可以实现的方法就有之前SpringMvcSupport的两个addResourceHandlers和addInterceptors，开头的protected换成了public</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.itheima.controller&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnablewebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">springMvcconfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ProjectInterceptor projectInterceptor;</span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span>&#123;</span><br><span class="line">registry.addInterceptor(projectInterceptor).addPathPatterns(<span class="string">&quot;/books&quot;</span>,<span class="string">&quot;/books/*&quot;</span>);</span><br></pre></td></tr></table></figure><p>但是这种简化开发的侵入式较强</p><h3 id="拦截参数"><a href="#拦截参数" class="headerlink" title="拦截参数"></a>拦截参数</h3><p>上面的参数都是用来干什么的呢，就是现在的程序执行以后可以通过这些参数取数据。对于HandlerMethod这个类里面封装了现在执行的方法，用的是反射，然后通过强转然后调用getMethod来获取方法之类的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="comment">//受mvc管理</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpservletRequest request, HttpservletResponse response, object handler)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">contentType</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Content-Type&quot;</span>);<span class="comment">//获取数据。会输出application/json</span></span><br><span class="line">        <span class="comment">//System.out.println(handler.getClass());输出了class org.springframework.web.method.HandlerMethod，</span></span><br><span class="line">        <span class="type">HandlerMethod</span> <span class="variable">hm</span> <span class="operator">=</span> (HandlerMethod)handler;</span><br><span class="line">        hm.getMethod().~~~调用想获取的反射</span><br><span class="line">System.out.println(<span class="string">&quot;preHandle...&quot;</span>+ contentType);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>modelAndView封装了mvc进行页面跳转的相关数据。下面那个ex可以拿到原始程序执行过程中的异常，但我们有异常统一处理机制所以也没有这个需求了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@0verride</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpservletRequest reguest, HttpservletResponse response, obiect handler, ModelAndview modelAndView)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;postHandle...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">                          </span><br><span class="line">@0verride</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttoservletReguest reguest, HttoservletResponse response, obiect handler, Exception ex)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;aftercompletion...&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>preHandle</p><ul><li>参数<ul><li>request:请求对象</li><li>response:响应对象</li><li>handler:被调用的处理器对象，本质上是一个方法对象，对反射技术中的Method对象进行了再包装</li></ul></li><li>返回值<ul><li>返回值为false，被拦截的处理器将不执行</li></ul></li></ul><p>postHandle</p><ul><li>modelAndview:如果处理器执行完成具有返回结果，可以读取到对应数据与页面信息，并进行调整</li></ul><p>afterCompletion</p><ul><li>ex:如果处理器执行过程中出现异常对象，可以针对异常情况进行单独处理</li></ul><h3 id="多个拦截器执行顺序"><a href="#多个拦截器执行顺序" class="headerlink" title="多个拦截器执行顺序"></a>多个拦截器执行顺序</h3><ul><li>当配置多个拦截器时，形成拦截器链</li><li>拦截器链的运行顺序参照拦截器添加顺序为准</li><li>当拦截器中出现对原始处理器的拦截，后面的拦截器均终止运行</li><li>当拦截器运行中断，仅运行配置在前面的拦截器的afterCompletion操作</li></ul><p> 全成功就是运行到post1后，再把所有的after执行完，如果3是false，就会中止拦截器运行，直接跳到after2和1运行完，以此类推，如果1就是false，那么后面的都不运行</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260106160327882.png" alt="image-20260106160327882"></p><p>拦截器链的运行顺序<br>preHandle:与配置顺序相同，必定运行<br>postHandle:与配置顺序相反，可能不运行<br>aftercompletion:与配置顺序相反，可能不运行</p><h1 id="Maven进阶"><a href="#Maven进阶" class="headerlink" title="Maven进阶"></a>Maven进阶</h1><h2 id="分模块开发与设计"><a href="#分模块开发与设计" class="headerlink" title="分模块开发与设计"></a>分模块开发与设计</h2><p>白学警告</p><p>将原始模块按照功能拆分成若干个子模块，方便模块间的相互调用，接口共享</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260106161601387.png" alt="image-20260106161601387"></p><p>右击新建个maven模块，取名叫maven_03_pojo，在这个里面有pom.xml，然后再java里建个con.itheima.domain，把maven_02_ssm里的domain里的Book剪切到03的里面，这里就要思考如果我们要在02里调用03的book应该怎么弄</p><p>可以打开02的pom.xml添加以下这行，这行是03的pom.xml里复制过来的，然后在右侧的maven管理里也能看到多了个这个的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--依赖domain运行--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven 03 pojo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>maven想要真正运行最终要执行的是生命周期里的操作，点击compile，发现提示了error:Could not resolve dependencies for project com.itheima:maven 02 ssm:war:1.8-SNAPsHoT: Could not find artifact com.itheima:maven 03_pojo:jar:1.0-SNAPSHOT -&gt;[Help 1]，引用03的时候找不到</p><p>我们去本地仓库找，maven-repository-com-itheima这个路径找不到对应的文件夹，但是其他的仓库是能找到的，也就是本地仓库没有这个资源坐标，要保证可移植性肯定是需要仓库也有的，所以需要打包进去，点击maven指令里的install，将当前的模块安装到本地仓库中，安装的时候注意是选择安装03</p><h2 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理"></a>依赖管理</h2><p>依赖指当前项目运行所需的jar，一个项目可以设置多个依赖</p><p>打开右侧的maven管理，前面有箭头的代表当前的依赖又依赖了别的东西，比如02里面有03和04，而04又依赖了03，那么把02里面的03注释掉，依然可以正常使用，这说明依赖具有传递性</p><ul><li>直接依赖:在当前项目中通过依赖配置建立的依赖关系</li><li>间接依赖:被资源的资源如果依赖其他资源，当前项目间接依赖其他资源</li></ul><p><strong>依赖传递冲突问题</strong></p><ul><li>路径优先:当依赖中出现相同的资源时，层级越深，优先级越低，层级越浅，优先级越高</li><li>声明优先:当资源在相同层级被依赖时，配置顺序靠前的覆盖配置顺序靠后的</li><li>特殊优先:当同级配置了相同资源的不同版本，后配置的覆盖先配置的，以最后配置的为准</li></ul><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260107190516992.png" alt="image-20260107190516992"></p><p>这个按钮显示了依赖的关系和深度</p><h2 id="可选依赖和排除依赖"><a href="#可选依赖和排除依赖" class="headerlink" title="可选依赖和排除依赖"></a>可选依赖和排除依赖</h2><p>可选依赖指对外隐藏当前所依赖的资源–不透明</p><p>如果不想让别人知道我的依赖里用过什么东西，想给隐藏起来，就可以加一个标签</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven 03 pojo&lt;/artifactId)</span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--可选依赖是隐藏当前工程所依赖的资源，隐藏后对应资源将不具有依赖传递性--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span>加这个</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>排除依赖是指在当前引用的坐标中，将它的依赖从你的依赖关系中去除，是主动断开依赖的资源</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven 04 dao<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--排除依赖是隐藏当前资源对应的依赖关系--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="继承与聚合"><a href="#继承与聚合" class="headerlink" title="继承与聚合"></a>继承与聚合</h2><p><strong>聚合</strong>：</p><ul><li>聚合:将多个模块组织成一个整体，同时进行项目构建的过程称为聚合</li><li>聚合工程:通常是一个不具有业务功能的“空”工程(有且仅有一个pom文件)</li><li>作用:使用聚合工程可以将多个工程编组，通过对聚合工程进行构建，实现对所包含的模块进行同步构建<ul><li>当工程中某个模块发生更新(变更)时，必须保障工程中与已更新模块关联的模块同步更新，此时可以使用聚合工程来解决批量模块同步构建的问题</li></ul></li></ul><p>新建一个模块，里面只有一个pom.xml，之前的打包方式都是jar之类的，这里为pom的打包方式</p><p>管理的话用module标签，路径是以pom.xml开始，往上找一级，标签里的顺序不会影响效果，因为他们是按照依赖关系构建，比如a依赖b，就会先构建b，先把没有依赖的构建</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven 01_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--设置管理的模块名称--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">module</span>&gt;</span>../maven_02_ssm<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">module</span>&gt;</span>../maven_03_pojo<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">module</span>&gt;</span>../maven_04_dao<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>继承：</strong></p><ul><li>概念:继承描述的是两个工程间的关系，与java中的继承相似，子工程可以继承父工程中的配置信息，常见于依赖关系的继承</li><li>作用:<ul><li>简化配置</li><li>减少版本冲突</li></ul></li></ul><p>这里我们让1为父工程，其他为子工程，继承关系要在子类中描述，现在在2的pom.xml里加入以下代码，relativePath是用来快速定位父工程路径的</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置当前工程继承自parent工程--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven 0l parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../maven 01 parent/pom.xml<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后把子工程中的坐标都放到父工程里统一管理</p><p>如果2和3都要用到junit，而4不用，那可以在1里定义依赖管理，这里的不会让子工程都会继承，而是提供可选依赖资源</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--定义依赖管理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>子工程就还是写dependency，但是不要加版本，因为它用的是父工程里的版本。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test&lt;/scope)</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>子工程中使用父工程中的可选依赖时，仅需要提供群组id和项目id，无需提供版本，版本由父工程统一提供，避免版本冲突。子工程中还可以定义父工程中没有定义的依赖关系</p><p><strong>聚合与继承的区别</strong></p><ul><li>作用<ul><li>聚合用于快速构建项目</li><li>继承用于快速配置</li></ul></li><li>相同点:<ul><li>聚合与继承的pom.xm1文件打包方式均为pom，可以将两种关系制作到同一个pom文件中</li><li>聚合与继承均属于设计型模块，并无实际的模块内容</li></ul></li><li>不同点:<ul><li>聚合是在当前模块中配置关系，聚合可以感知到参与聚合的块有哪些</li><li>继承是在子模块中配置关系，父模块无法感知哪些子模块继承了自己</li></ul></li></ul><h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><p>前面的管理版本号还是有点麻烦，在java中学过用变量来定义版本号，maven的属性就是干这个的</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencys</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencys</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--定义属性--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><p>既然有了属性，能不能把jdbc.properties里的数据也做统一管理呢，也可以，同样是在下面标签里加上原本的数据库地址，但是只能在这个pom文件里使用，不能在配置文件里使用，如果想扩大范围可以使用build标签配置资源文件，加上路径和开启过滤规则，不过这个方法<strong>并不常用</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jdbc.url</span>&gt;</span>jdbc:mysql://127.0.0.1:3306/ssm db&lt;/jdbc,url&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">directory</span>&gt;</span>../maven 02 ssm/src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如何查看效果，只需要把02这个工程打包成war包，看看里面的配置有没有加载上值就行，找到本地仓库maven_repository_com_itheima把里面的东西清空，然后在maven点install，如果打包提示必须要web.xml，就需要新建一个，因为war包最起码要有一个web.xml。然后查看war文件里webinf里classes找到配置文件，看有没有生效就行</p><p>但是这样不规范，因为这里只配置了02，要是0304都配就要写好多，但这里面只支持写一个directory，所以就要改变代码，${project.basedir}代表了当前项目所在的目录，而后面的020304会继承这个，就不会局限在哪一个工程了</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.basedir&#125;/src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里是刚才的web.xml根本性处理方案，是如果没有这个文件，你不要给我报错。而只有02这个工程有这个插件，所以要在这里的pom.xml写，这下面的plugin是一个插件，里面写maven打war包的那个插件，坐标从maven&gt;repository&gt;org&gt;apachemaven &gt;plugins这个路径里找，org.apache.maven.plugins这个就是。后面要写对应的配置，这个标签的意思是如果遇到了没有web.xml是否报错，写false</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">port</span>&gt;</span>80<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-war-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">failonMissingWebXml</span>&gt;</span>false<span class="tag">&lt;<span class="name">fail0nMissingWebXml</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上面用到的${project.basedir}是maven内置的系统属性</p><ol start="3"><li><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260113184231237.png" alt="image-20260113184231237"></li></ol><h2 id="版本管理"><a href="#版本管理" class="headerlink" title="版本管理"></a>版本管理</h2><ul><li>工程版本:<ul><li>SNAPSHOT(快照版本)<ul><li>项目开发过程中临时输出的版本，称为快照版本</li><li>快照版本会随着开发的进展不断更新</li></ul></li><li>RELEASE(发布版本)<ul><li>项目开发到进入阶段里程碑后，向团队外部发布较为稳定的版本，这种版本所对应的构件文件是稳定的，即便进行功能的后续开发，也不会改变当前发布版本内容，这种版本称为发布版本</li></ul></li></ul></li><li>发布版本<ul><li>alpha版</li><li>beta版</li><li>纯数字版</li></ul></li></ul><h2 id="多环境配置与应用"><a href="#多环境配置与应用" class="headerlink" title="多环境配置与应用"></a>多环境配置与应用</h2><p>maven提供配置多种环境的设定，帮助开发者使用过程中快速切换环境</p><p>在01父工程里配置多环境开发</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置多环境--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开发环境--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>env_depk/id&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jdbc.url</span>&gt;</span>jdbc:mysq1://127.0.0.1:3306/ssm_db<span class="tag">&lt;/<span class="name">jdbc.url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--设定是否为默认启动环境--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--生产环境--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>env_pro/id&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jdbc.url</span>&gt;</span>jdbc:mysq1://127.2.2.1:3306/ssm_db<span class="tag">&lt;/<span class="name">jdbc.url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--测试环境--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>env_depk/id&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jdbc.url</span>&gt;</span>jdbc:mysq1://127.0.0.1:3306/ssm_db<span class="tag">&lt;/<span class="name">jdbc.url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上面设置默认启动环境太麻烦了，也可以换种方式，点击这里，输入执行指令mvn install -P env_test，-p代表指定环境，运行就可以了</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260113190505918.png" alt="image-20260113190505918"></p><h3 id="跳过测试"><a href="#跳过测试" class="headerlink" title="跳过测试"></a>跳过测试</h3><p>点一下这个按钮，test就变成了灰色的</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260113191213505.png" alt="image-20260113191213505"></p><p>但是这个会全部跳过，能不能指定跳过哪些呢。在build里写，而测试是一个插件，所以要在插件标签里写配置，里面是跳过测试。然后比如某个测试用例不参与，其他的都参与，就要把</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--设置资源目录，并设置能够解析$&#125;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.basedir&#125;/src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true&lt;/filtering)</span><br><span class="line"><span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--排除掉不参与测试的内容--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclude</span>&gt;</span>**/BookServiceTest.java<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>用指令就是mvn package -D skip</p><h2 id="私服"><a href="#私服" class="headerlink" title="私服"></a>私服</h2><ul><li>私服是一台独立的服务器，用于解决团队内部的资源共享与资源同步问题</li><li>Nexus<ul><li>Sonatype公司的一款maven私服产品</li><li>下载地址:<a href="https://help.sonatype.com/repomanager3/download">https://help.sonatype.com/repomanager3/download</a></li></ul></li></ul><p>下载完去bin目录运行cmd，然后执行nexus.exe &#x2F;run nexus</p><p>访问地址是localhost:8081，用户名admin，密码在他提供的路径里找到admin.password里</p><ul><li>修改基础配置信息<ul><li>安装路径下etc目录中nexus-default.properties文件保存有nexus基础配置信息，例如默认访问端口</li></ul></li><li>修改服务器运行配置信息<ul><li>安装路径下bin目录中nexus.vmoptions文件保存有nexus服务器启动对应的配置信息，例如默认占用内存空间</li></ul></li></ul><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260114153514985.png" alt="image-20260114153514985"></p><p>现在idea打包到本地仓库，然后本地仓库上传到私服，但这样的话需要本地仓库配置访问权限，也就是访问私服的用户名和密码，还要告诉上传的位置，下载也是同理</p><p>找到maven的conf里的setting.xml，找到servers标签，复制一个server标签然后修改</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置访间字符的权限--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>私服中的服务器id名称<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">password</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在仓库里找到这个选项，点击创建仓库，然后选maven2(hosted)，然后写上名字itheima-snapshot，下面的version policy要选同样的snapshot，其他的不动直接创建</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260114154330189.png" alt="image-20260114154330189"></p><p>然后还缺一个配置，就是当前项目要发布到哪一个私服仓库中，在01pom文件里配置，一个是正式版，一个是快照版</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置当前工程保存在私服中的具体位置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>itheima-release<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/repository/itheima-release/<span class="tag">&lt;/<span class="name">ur1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>itheima-snapshot<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/repository/itheima-snapshot/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后在maven选项中选择deploy，这个是上传到私服，本地的是用install，上传完后查看仓库，发现release里没有东西但snapshot有，这是因为在01pom文件里的版本号叫snapshot，要改成release</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven 01 parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure><p>下面这个地方可以换取阿里的坐标用来下载</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260114155647714.png" alt="image-20260114155647714"></p><h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h1><p>SpringBoot是由Pivotal团队提供的全新框架，其设计目的是用来简化Spring应用的初始搭建以及开发过程</p><h2 id="入门案例-2"><a href="#入门案例-2" class="headerlink" title="入门案例"></a>入门案例</h2><p>创建时选择<img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260114182813129.png" alt="image-20260114182813129">然后选择好jdk版本，按照下图设置，name随便写，描述随便写，包名只要前面的</p><p><img src="./images/黑马程序员SSM/image-20260114190053045.png"> “+id);<br>return “hello , spring boot!”;<br>}</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">点开Application查看代码，意思就是运行这个东西，然后把Application传进来，再加个参数就行了</span><br><span class="line"></span><br><span class="line">~~~java</span><br><span class="line">@springBootApplication</span><br><span class="line">public class Application &#123;</span><br><span class="line">public static void main(string[] args)&#123;</span><br><span class="line">SpringApplication.run(Application.class,args);</span><br></pre></td></tr></table></figure><p>让后点开pom，把里面的name标签和description删掉，往上有个parent标签，这个是boot的核心继承，下面那个是前面点web所产生的东西</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span><span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>基于idea开发SpringBoot程序需要确保联网且能够加载到程序框架结构</p><h2 id="Springboot项目快速启动"><a href="#Springboot项目快速启动" class="headerlink" title="Springboot项目快速启动"></a>Springboot项目快速启动</h2><p>如果前端调试程序需要链接后端，但不在同一台电脑上，后端可以使用maven的package进行打包，这个包在target里，把打好的jar包发给前端就行，运行方式是在这个文件目录启动cmd，然后输入java -jar 包名.jar就行了，而且需要的其他jar包也会一起打包好</p><p>jar支持命令行启动需要依赖maven插件支持，请确认打包时是否具有SpringBoot对应的maven插件</p><h2 id="Springboot概述"><a href="#Springboot概述" class="headerlink" title="Springboot概述"></a>Springboot概述</h2><p>SpringBoot是由Pivota1团队提供的全新框架，其设计目的是用来简化Spring应用的初始搭建以及开发过程</p><p>在上面的parent标签里，点击spring-boot-starter-parent进去可以看到这个又继承了spring-boot-dependencies，这里程序就已经准备好了要用的资源的版本管理，只需要写上需要的依赖不加版本就可以</p><p>下面这个是帮我们一次性写了若干依赖，意思是起步依赖，点进去都可以看到</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>starter<ul><li>SpringBoot中常见项目名称，定义了当前项目使用的所有项目坐标，以达到减少依赖配置的目的</li></ul></li><li>parent<ul><li>所有SpringBoot项目要继承的项目，定义了若干个坐标版本号(依赖管理，而非依赖)，以达到减少依赖冲突的目的</li><li>spring-boot-starter-parent(2.5.0)与 spring-boot-starter-parent(2.4.6)共计57处坐标版本不同</li></ul></li><li>实际开发<ul><li>使用任意坐标时，仅书写GAV中的G和A，V由SpringBoot提供</li><li>如发生坐标错误，再指定version(要小心版本冲突)</li></ul></li></ul><p>上面这些都是辅助功能</p><h2 id="springboot启动方式"><a href="#springboot启动方式" class="headerlink" title="springboot启动方式"></a>springboot启动方式</h2><ul><li><p>启动方式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot010uickstartApplicationf</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(string[] args)</span>&#123;</span><br><span class="line">SpringApplication.run(Springboot01QuickstartApplication.class, args);</span><br></pre></td></tr></table></figure></li><li><p>SpringBoot在创建项目时，采用jar的打包方式</p></li><li><p>SpringBoot的引导类是项目的入口，运行main方法就可以启动项目</p></li></ul><p>这里我们想换成jetty服务器，不用tomcat，在pom里的org.springframework.boot里面是有tomcat的，并且是源码不能随意更改不能用可选依赖，所以我们这里用到之前学过的排除依赖，然后再加上jetty的依赖就行</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Jetty比Tomcat更轻量级，可扩展性更强(相较于Tomcat)，谷歌应用引擎(GAE)已经全面切换为Jetty</p><h2 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h2><p><strong>修改服务器端口</strong></p><ul><li><p>SpringBoot提供了多种属性配置方式<br>在resources里有个application.properties，在里面添加</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">80</span></span><br></pre></td></tr></table></figure></li><li><p>在这个目录下新建一个application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="string">port:81</span></span><br></pre></td></tr></table></figure></li><li><p>新建一个application.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="string">port:82</span></span><br></pre></td></tr></table></figure></li></ul><p>如果三个文件都有的情况下，properties为主启动文件，然后是yml最后是yaml</p><p>SpringBoot核心配置文件名为application<br>SpringBoot内置属性过多，且所有属性集中在一起修改，在使用时，通过提示键+关键字修改属性</p><h2 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h2><ul><li>YAML(YAML Ain’t Markup Language)，一种数据序列化格式</li><li>优点:<ul><li>容易阅读</li><li>容易与脚本语言交互</li><li>以数据为核心，重数据轻格式</li></ul></li><li>YAML文件扩展舎<ul><li>.ym1(主流)</li><li>.yam1</li></ul></li></ul><p><strong>yaml语法规则</strong></p><ul><li>大小写敏感</li><li>属性层级关系使用多行描述，每行结尾使用冒号结束</li><li>使用缩进表示层级关系，同层级左侧对齐，只允许使用空格(不允许使用Tab键)</li><li>属性值前面添加空格(属性名与属性值之间使用冒号+空格作为分隔)</li><li>表示注释</li><li>核心规则:数据前面要加空格与冒号隔开</li></ul><p><strong>yaml数组数据</strong></p><p>数组数据在数据书写位置的下方使用减号作为数据开始符号，每行书写一个数据，减号与数据间空格分隔</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">enterprise:</span></span><br><span class="line"> <span class="string">tel:4006184000</span></span><br><span class="line"> <span class="attr">subject:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Java</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">前端</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">大数据</span></span><br></pre></td></tr></table></figure><h3 id="yaml数据读取"><a href="#yaml数据读取" class="headerlink" title="yaml数据读取"></a>yaml数据读取</h3><p>可以通过下面的方式读取上面yml文件的数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bookcontroller</span> &#123;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;enterprise.tel&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Integer tel;</span><br><span class="line"></span><br><span class="line"><span class="comment">//数组</span></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;enterprise.subject[0]&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Integer subject;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>也可以使用加载环境信息全部获取</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(©v&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bookcontroller</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Environment environment;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">    System.out.println(environment.getProperty(<span class="string">&quot;lesson&quot;</span>));</span><br></pre></td></tr></table></figure><p>第三种方式是比较常用的，先定义一个实体类，内容和yml里的东西一一对应，要想加载这里的信息，得先让Spring控制这里，添加@Component把他加入bean，第二步要告诉从配置中读取属性，@ConfigurationProperties，里面写上前缀</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;enterprise&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Enterprise</span>&#123;</span><br><span class="line"><span class="keyword">private</span> String tel;</span><br><span class="line"><span class="keyword">private</span> String[] subject;</span><br></pre></td></tr></table></figure><p>然后再放到上面的控制类里</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Enterprise enterprise,</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">    System.out.println(enterprise);</span><br></pre></td></tr></table></figure><p><strong>自定义对象封装数据警告解决方案</strong></p><p>把这个加在依赖里就可以</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="多环境开发配置"><a href="#多环境开发配置" class="headerlink" title="多环境开发配置"></a>多环境开发配置</h2><p>分隔环境在yml里用三个横线分隔，区分什么是开发测试的话用</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置启用的环境</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">profiles:</span></span><br><span class="line"><span class="attr">active:</span> <span class="string">test</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#开发</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="string">port:80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#生产</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">profiles:</span> <span class="string">pro</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">81</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">profiles:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">82</span></span><br></pre></td></tr></table></figure><p>现在推荐的写法：用哪个都行</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置启用的环境</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">profiles:</span></span><br><span class="line"><span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#开发</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">config:</span></span><br><span class="line"><span class="attr">activate:</span></span><br><span class="line"><span class="attr">on-profile:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="string">port:80</span></span><br></pre></td></tr></table></figure><p>properties的写法：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置启用的环境</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">dev</span></span><br></pre></td></tr></table></figure><p>dev在哪写呢？新建一个application-dev.properties，里面写上server.port&#x3D;80，这样会读取</p><h2 id="多环境命令行启动参数设置"><a href="#多环境命令行启动参数设置" class="headerlink" title="多环境命令行启动参数设置"></a>多环境命令行启动参数设置</h2><p>前端人员在启动打好的jar包时可以通过命令来更改环境，但是在打包前一定要先执行clean，有中文注释的时候需要打开idea设置，输入encoding，把所有的编码改成utf-8</p><p>启动时先在jar包所在的文件夹里启动cmd，然后输入java -jar springboot.jar –spring.profiles.active&#x3D;test，也可以临时修改参数，比如</p><p>java -jar springboot.jar –spring.profiles.active&#x3D;test –server.port&#x3D;88</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260116001823456.png" alt="image-20260116001823456"></p><h2 id="多环境开发兼容问题"><a href="#多环境开发兼容问题" class="headerlink" title="多环境开发兼容问题"></a>多环境开发兼容问题</h2><p>开发的时候jar最终要在服务器上运行，而maven是用来最终打包，所以要以maven的profile为主，boot为辅</p><p>这里准备了数据，在pom里有设置多环境开发，yml里设置的是，这时候运行打好的jar包，发现最终运行的端口是80，说明yml里的dev在生效，properties里想要生效的也没有告诉yml，怎么让yml知道呢，在pom里把每个环境都设上&lt;properties.active&gt;，把yml里active后面改成${profile.avtive}。</p><p>上面配置的pom属性只能在pom文件里用，不会干预配置文件，想要干预配置文件就要加个下面的插件，配置里的useDefaultDelimiters设置为true，然后再设置一下字符集</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">configuraton</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">useDefaultDelimiters</span>&gt;</span>true<span class="tag">&lt;/<span class="name">useDefaultDelimiters</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuraton</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">useDefaultDelimiters</span>&gt;</span>true<span class="tag">&lt;/<span class="name">useDefaultDelimiters</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--开发环境--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--生产环境--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>pro<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span>pro<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--测试环境--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>test<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span>test<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置启用的环境</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">profiles:</span></span><br><span class="line"><span class="attr">active:</span> <span class="string">$&#123;profile.avtive&#125;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#开发</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="string">profiles:dev</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="string">port:80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#生产</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">profiles:</span> <span class="string">pro</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">81</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">profiles:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">82</span></span><br></pre></td></tr></table></figure><h2 id="配置文件分类"><a href="#配置文件分类" class="headerlink" title="配置文件分类"></a>配置文件分类</h2><p>SpringBoot中4级配置文件<br>1级:file :config&#x2F;application.yml【最高】<br>2级:file :application.yml<br>3级:classpath:config&#x2F;application.yml<br>4级:classpath:application.yml【最低】<br>作用:<br>1级与2级留做系统打包后设置通用属性<br>3级与4级用于系统开发阶段设置通用属性</p><h2 id="整合第三方技术"><a href="#整合第三方技术" class="headerlink" title="整合第三方技术"></a>整合第三方技术</h2><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260116011651976.png" alt="image-20260116011651976"></p><p>上面两个类其实都是统一的名字，如果都一样的话是不是就不用写了，boot给做了整合。随便弄了个Service，然后到测试类去做测试，下面的方法是不重要的可以随意修改，@SpringBootTest里面整合了运行器，在这里没有写需要加载的配置文件，但是有没有加载？加载了，在Springboote7TestApplication这个类（运行的那个）就起到了加载配置类的作用，他会把他所在包及其子包全部扫描一遍</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">springboot07TestApplicationTests</span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> BookService bookService;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//void contextLoads()&#123;//这个是创建时自带的，可以随意修改</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;<span class="comment">//改成了这样</span></span><br><span class="line">bookService.save();</span><br></pre></td></tr></table></figure><p>如果就是换地方了，可以通过指定参数把类名指定上就行了</p><p>@SpringBootTest(class &#x3D; Springboot07TestApplication.class)</p><h2 id="基于SpringBoot整合mybatis"><a href="#基于SpringBoot整合mybatis" class="headerlink" title="基于SpringBoot整合mybatis"></a>基于SpringBoot整合mybatis</h2><p>创建一个新模块，把mybatis framework依赖加上，还有mysql的</p><p>然后准备下面代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span>&#123;<span class="comment">//还有setget方法</span></span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="keyword">private</span> string name;</span><br><span class="line"><span class="keyword">private</span> string type;</span><br><span class="line"><span class="keyword">private</span> string description;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="meta">@Select(&quot;select *from tbl_book where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">getById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure><p>还有个Application.yml，serverTimezone&#x3D;UTC是设置时区，这个是boot2.4.2以前的会报错，后面的就不用加了</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">datasource:</span></span><br><span class="line"><span class="string">driver-class-name:com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="string">url:jdbc:mysql://localhost:3306/ssm_db?serverTimezone=UTC</span></span><br><span class="line"><span class="string">username:root</span></span><br><span class="line"><span class="attr">password:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure><p>然后到测试类，</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">springboote8MybatisApplicationTests</span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGetById</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookDao.getById(<span class="number">1</span>);</span><br><span class="line">System.out.println(book);</span><br></pre></td></tr></table></figure><p>运行时提示错误的创建了一个bean，依赖的bookDao加载失败了，因为这样配BookDao这是一个接口，那我们的对象是什么？是通过自动代理得到的实现类，而Spring怎么知道这个类要做自动代理呢，之前是@MapperScanner然后里面是包名，这里只需要写@Mapper</p><p>如果需要其他的数据库源，就先加载对应的依赖，然后在上的yml最后面加上</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDatasource</span></span><br></pre></td></tr></table></figure><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260116015221587.png" alt="image-20260116015221587"></p><h2 id="案例：基于boot的ssm整合案例"><a href="#案例：基于boot的ssm整合案例" class="headerlink" title="案例：基于boot的ssm整合案例"></a>案例：基于boot的ssm整合案例</h2><p>之前的config包全部删掉，domain不需要变化，dao里需要加一个@Mapper，作用是让boot扫描到这里并且生成自动代理，Service包不需要动，controller也不需要，然后在resources包里把Application.properties后缀改成yml，然后把jdbc.properties里的东西放到yml里，测试类就是上面那些</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260116183738833.png" alt="image-20260116183738833"></p><h1 id="mybatis-plus"><a href="#mybatis-plus" class="headerlink" title="mybatis plus"></a>mybatis plus</h1><h2 id="MyBatisPlus简介"><a href="#MyBatisPlus简介" class="headerlink" title="MyBatisPlus简介"></a>MyBatisPlus简介</h2><p>MyBatisPlus(简称MP)是基于MyBatis框架基础上开发的增强型工具，旨在简化开发、提高效率</p><ul><li>SpringBoot整合MyBatis开发过程(复习)<ul><li>创建SpringBoot工程</li><li>勾选配置使用的技术（mybatis、mysql）</li><li>设置dataSource相关属性(JDBC参数)</li><li>定义数据层接口映射配置</li></ul></li></ul><p>新建一个模块选择mysql，如果没有mybatisplus就手动加，再加一个druid，然后在yml里配置数据库，新建一个UserDao的接口，继承BaseMapper就可以获得所有需要的查询方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br><span class="line"><span class="comment">//以前是这么写，如果用plus就里面什么也不写，然后继承BaseMapper加一个泛型，写实体类名</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt;&#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatispluse1QuickstartApplicationTests</span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">List&lt;User&gt;userList = userDao.selectList(<span class="literal">null</span>);</span><br><span class="line">System.out.println(userList);</span><br></pre></td></tr></table></figure><p>MyBatisPlus特性：</p><ul><li>无侵入:只做增强不做改变，不会对现有工程产生影响</li><li>强大的 CRUD 操作:内置通用 Mapper，少量配置即可实现单表CRUD 操作</li><li>支持 Lambda:编写查询条件无需担心字段写错</li><li>支持主键自动生成</li><li>内置分页插件</li></ul><h2 id="标准数据层开发"><a href="#标准数据层开发" class="headerlink" title="标准数据层开发"></a>标准数据层开发</h2><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260117025540821.png" alt="image-20260117025540821"></p><p>新增，但是id是按照它的规则生成的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testSave</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">user.setName(<span class="string">&quot;黑马程序员&quot;</span>);</span><br><span class="line">user.setPassword(<span class="string">&quot;itheima&quot;</span>),</span><br><span class="line">user.setAge(<span class="number">12</span>);</span><br><span class="line">user.setTel(<span class="string">&quot;4006184080&quot;</span>)</span><br><span class="line">userDao.insert(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>按id删除</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span>&#123;</span><br><span class="line">userDao.deleteById(<span class="number">1401856123725713409L</span>);</span><br></pre></td></tr></table></figure><p>改，这里以前要做个判断，哪些字段为空就不更改，不为空的才更改，现在他直接自动判断</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">user.setId(<span class="number">1L</span>);</span><br><span class="line">user.setName(<span class="string">&quot;Tom666&quot;</span>);</span><br><span class="line">userDao.updateById(user);</span><br></pre></td></tr></table></figure><p>查</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGetById</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.selectById(<span class="number">2L</span>);</span><br><span class="line">System.out.println(user);</span><br></pre></td></tr></table></figure><p>然后pojo对象可以用lombok来快速生成setget方法，也可以用@Data，这个包含以下所有除了两个构造方法的所有方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Tostring</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"><span class="keyword">private</span> Long id;</span><br><span class="line"><span class="keyword">private</span> string name;</span><br><span class="line"><span class="keyword">private</span> string password;</span><br><span class="line"><span class="keyword">private</span> Integer age;</span><br><span class="line"><span class="keyword">private</span> string tel;</span><br></pre></td></tr></table></figure><h3 id="分页功能"><a href="#分页功能" class="headerlink" title="分页功能"></a>分页功能</h3><p>selectPage要的是什么，是一个Ipage对象，那就new一个，怎么设置页码，page后面的1代表第一页，2代表有多少条</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGetByPage</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">IPage</span> <span class="variable">page</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>( <span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">userDao.selectPage(page,queryWrapper: <span class="literal">null</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;当前页码值:&quot;</span>+page.getcurrent());</span><br><span class="line">System.out.println(<span class="string">&quot;每页显示数:&quot;</span>+page.getsize());</span><br><span class="line">System.out.println(<span class="string">&quot;一共多少页:&quot;</span>+page.getPages());</span><br><span class="line">System.out.println(<span class="string">&quot;一共多少条数据:&quot;</span>+page.getTotal());</span><br><span class="line">System.out.println(<span class="string">&quot;数据:&quot;</span>+page.getRecords());</span><br></pre></td></tr></table></figure><p>但执行时发现他显示的是一共0页，一共0条数据，然后把数据全部查询出来，正常的查询语句应该是select *from user ????? limit 1,2.，就是要在后面加上limit进行分页，但这里不是aop，是mybatisplus的拦截器，用于配置分页功能</p><p>新建一个MyConfig</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mpconfig</span> &#123;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mpInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//1.定义Mp拦截器</span></span><br><span class="line"><span class="type">MybatisPlusInterceptor</span> <span class="variable">mpInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line"><span class="comment">//2.添加具体的拦截器</span></span><br><span class="line">mpInterceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line"><span class="keyword">return</span> mpInterceptor;</span><br></pre></td></tr></table></figure><p>然后要被加载，一种是在Application类里写上@Import加载进去，另一种是直接加@Configuration</p><p>想看sql语句可以开启mypluls日志，要在yml配置以下，调程序用的一般不开启</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#开启mp的日志(输出到控制台)</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line"><span class="attr">configuration:</span></span><br><span class="line"><span class="string">log-impl:org.apache,ibatis.logging.stdout.stdoutImpl</span></span><br></pre></td></tr></table></figure><h2 id="DQL编程控制"><a href="#DQL编程控制" class="headerlink" title="DQL编程控制"></a>DQL编程控制</h2><p>MyBatisPlus将书写复杂的SQL查询条件进行了封装，使用编程的形式完成查询条件的组合</p><p>如果要关闭mybatisplus的图标显示可以在yml设置如下</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line"><span class="attr">global-config:</span></span><br><span class="line"><span class="attr">banner:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>关闭springboot的是</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">main:</span></span><br><span class="line"><span class="string">banner-mode:off</span></span><br></pre></td></tr></table></figure><p>条件查询的使用：queryWrapper是专门做查询封装条件的，后面的lt是对应html的&amp;lt，也就是小于号，这样就查询出年龄小于18的，大于号用gt</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGetA11</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//按条件查询</span></span><br><span class="line">QueryWrapper qw= <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>();</span><br><span class="line">qw.lt(<span class="string">&quot;age&quot;</span>,<span class="number">18</span>);</span><br><span class="line">List&lt;User&gt;userList =userDao.selectList(qw);</span><br><span class="line">System.out.println(userList);</span><br></pre></td></tr></table></figure><p>方式二，里面的是user类里的age属性的意思，注意要指定泛型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式二:lambda格式按条件查询</span></span><br><span class="line">QueryWrapper&lt;User&gt; qw= <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;();</span><br><span class="line">qw.lambda().lt(user::getAge, <span class="number">18</span>);</span><br><span class="line">List&lt;User&gt;userList =userDao.selectList(qw);</span><br><span class="line">System.out.println(userList);</span><br></pre></td></tr></table></figure><p>方式三（推荐）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式三:lambda格式按条件查询</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt;lqw=<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line">lqw.lt(User::getAge,val:<span class="number">10</span>);</span><br><span class="line">List&lt;User&gt;userList = userDao.selectList(lqw);</span><br><span class="line">System.out.println(userList);</span><br></pre></td></tr></table></figure><h3 id="null值处理"><a href="#null值处理" class="headerlink" title="null值处理"></a>null值处理</h3><p>在购物的时候会有些没选择的值，这里就成了空值，这应该怎么处理呢</p><p>新建一个query包，新建UserQuery类，这是封装User类的，继承user，然后分析user中有哪些东西可能会有上下限或者范围，比如数值型和日期型。那么这里的age2就用来描述年龄的上限，user里的age就描述年龄的下限</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserQuery</span> <span class="keyword">extends</span> <span class="title class_">User</span> &#123;</span><br><span class="line"><span class="keyword">private</span> Integer age2;</span><br></pre></td></tr></table></figure><p>然后到test中，模拟年龄下限为空时会发生什么，结果是不成功，以前判断空是要加个if(null !&#x3D; uq.getAge())，但这样写要写很多个if，</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模拟页面传递过来的查询数据</span></span><br><span class="line"><span class="type">UserQuery</span> <span class="variable">uq</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserQuery</span>();</span><br><span class="line"><span class="comment">//uq.setAge(10);</span></span><br><span class="line">uq.setAge2(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//nuLL判定</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line">lqw.lt(User: :getAge, uq.getAge2());</span><br><span class="line">lqw.gt(User::getAge, uq.getAge());</span><br><span class="line">List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">System.out.println(userList) ;</span><br></pre></td></tr></table></figure><p>lt的值可以传个boolean</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260117161710215.png" alt="image-20260117161710215"></p><p>可以改造成下面的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line">lqw.lt(User: :getAge, uq.getAge2());</span><br><span class="line"><span class="comment">//先判定第一个参数是否为true，如果为true连按当前条件</span></span><br><span class="line">lqw.lt(<span class="literal">null</span> != uq.getAge2(),User::getAge,uq.getAge2());</span><br><span class="line">lqw.lt(<span class="literal">null</span> != uq.getAge(),User::getAge,uq.getAge());</span><br><span class="line">List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">System.out.println(userList) ;</span><br></pre></td></tr></table></figure><h3 id="查询投影"><a href="#查询投影" class="headerlink" title="查询投影"></a>查询投影</h3><p>就是设置查询结果的样子。下面这个是查全集，然后设置只显示其中某一些字段</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询投影</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt;lqw= <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line"><span class="comment">//select这个专门设置查询的字段名，只适用于lambda格式</span></span><br><span class="line">lqw.select(User::getId,User::getName,User: :getAge);</span><br><span class="line"><span class="comment">//这个是不用lambda格式</span></span><br><span class="line">QueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;();</span><br><span class="line">lqw.select(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;age&quot;</span>);</span><br><span class="line">List&lt;User&gt;userList =userDao.selectList(lqw);</span><br><span class="line">System.out.println(userList);</span><br></pre></td></tr></table></figure><p>现在要求查一下count，就是统计有多少数据。单纯用lqw.select(“count(*)”);的时候最终查询是个null，因为现在包装的是放在user对象里，放不进去，不能用selectList这个方法，用selectMaps，其中String代表key，Object代表value，最后输出的是count(*)&#x3D;6，但是看着很怪，起个别名叫count</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;();</span><br><span class="line">lqw.select(<span class="string">&quot;count(*) as count, tel&quot;</span>);</span><br><span class="line"><span class="comment">//List&lt;User&gt; userList = userDao.selectList(lqw);</span></span><br><span class="line"><span class="comment">//分组查询</span></span><br><span class="line">lqw.groupBy(<span class="string">&quot;tel&quot;</span>);</span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; userList = userDao.selectMaps(lqw);</span><br><span class="line">System.out.println(userList);</span><br></pre></td></tr></table></figure><h3 id="查询条件"><a href="#查询条件" class="headerlink" title="查询条件"></a>查询条件</h3><p>范围匹配（&gt;、&#x3D;、between)模糊匹配（like）<br>空判定（null）包含性匹配（in）分组（group）排序（order）</p><p>先看等匹配：eq就是equals</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//条件查询</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt; 1qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line"><span class="comment">//意思是如果名字为Jerry并且密码是jerry</span></span><br><span class="line">lqw.eq(User::getName,<span class="string">&quot;Jerry&quot;</span>).eq(User::getPassword,<span class="string">&quot;jerry&quot;</span>) ;</span><br><span class="line"><span class="comment">//如果是这种只查询一种，没必要用selectList,用SelectOne就行</span></span><br><span class="line"><span class="type">User</span> <span class="variable">loginUser</span> <span class="operator">=</span> userDao.select0ne(lqw);</span><br><span class="line">System.out.println(loginUser);</span><br></pre></td></tr></table></figure><p>范围查询，lt 是不带等号的，le是带等号的，gt是不带ge是带</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LambdaQueryWrapper&lt;User&gt; 1qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();<span class="comment">//范围查询LtLe gt ge eq between</span></span><br><span class="line"><span class="comment">//between的使用规则是有限制的，必须是从小到大</span></span><br><span class="line">lqw.between(User::getAge,<span class="number">10</span>, <span class="number">30</span>);</span><br><span class="line">List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">System.out.println(userList) ;</span><br></pre></td></tr></table></figure><p>模糊匹配</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LambdaQueryWrapper&lt;User&gt; 1qw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();<span class="comment">//模糊匹配Like</span></span><br><span class="line"><span class="comment">//这里的左和右是指百分号的位置，也就是J%以J开头的名字</span></span><br><span class="line">lqw.likeRight(User::getName,<span class="string">&quot;J&quot;</span>);</span><br><span class="line">List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">System.out.println(userList) ;</span><br></pre></td></tr></table></figure><p>更多查询条件设置参看<a href="https://mybatis.plus/guide/wrapper.html#abstractwrapper">https://mybatis.plus/guide/wrapper.html#abstractwrapper</a></p><h3 id="字段映射与表明映射"><a href="#字段映射与表明映射" class="headerlink" title="字段映射与表明映射"></a>字段映射与表明映射</h3><ul><li><p>名称：@TableField类型：属性注解</p></li><li><p>位置：模型类属性定义上方</p></li><li><p>作用：设置当前属性对应的数据库表中的字段关系，也就是重命名为数据库的字段名</p></li><li><p>范例：</p></li><li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"><span class="meta">@TableField(value=&quot;pwd&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String password;</span><br></pre></td></tr></table></figure></li><li><p>相关属性</p><ul><li>value（默认）：设置数据库表字段名称</li></ul></li></ul><p>问题二:编码中添加了数据库中未定义的属性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个意思是这个字段仅存在这个类里，数据库没有，排除这个</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> Integer online;</span><br></pre></td></tr></table></figure><p>名称：@TableField<br>类型：属性注解<br>位置：模型类属性定义上方<br>作用：设置当前属性对应的数据库表中的字段关系</p><p>相关属性<br>value：设置数据库表字段名称<br>exist：设置属性在数据库表字段中是否存在，默认为true。此属性无法与value合井使用</p><p>问题三：采用默认查询开放了更多的字段查看权限</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"><span class="meta">@TableField(value=&quot;pwd&quot;,select = false)</span></span><br><span class="line"><span class="keyword">private</span> String password;</span><br></pre></td></tr></table></figure><p>select：设置属性是否参与查询，此属性与select（）映射配置不冲突</p><p>问题四：表名与编码开发设计不同步，比如表明叫tb1_user</p><p>名称：@TableName<br>类型：类注解<br>位置：模型类定义上方<br>作用：设置当前类对应与数据库表关系范例:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableName(&quot;tbl_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"><span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure><p>相关属性：value：设置数据库表名称</p><h3 id="id生成策略"><a href="#id生成策略" class="headerlink" title="id生成策略"></a>id生成策略</h3><ul><li><p>不同的表应用不同的id生成策略</p><ul><li>日志：自增（1,2,3,4，.）</li><li>购物订单：特殊规则（FQ23948AK3843）</li><li>外卖单：关联地区日期等信息（1004202003143491）</li><li>关系表：可省略id</li></ul></li><li><p>名称：@TableId</p></li><li><p>类型：属性注解</p></li><li><p>位置：模型类中用于表示主键的属性定义上方</p></li><li><p>作用：设置当前类中主键属性的生成策略</p></li><li><p>范例:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">- <span class="meta">@TableId(type = IdType.AUTo)</span></span><br><span class="line">- <span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure></li><li><p>相关属性</p><ul><li>value：设置数据库主键名称</li><li>type：设置主键属性的生成策略，值参照IdType枚举值，有很多种</li></ul></li></ul><p>设置为AUTO后要去数据库看一下表结构，在表的选项把自动递增的值改小一点，他会自动识别最大值</p><p>设置为INPUT后要去数据库把自增策略取消，现在要求必须传id，而id需要自己指定，比如user.serId(666L)</p><ul><li>AUTO（0）：使用数据库id自增策略控制id生成</li><li>NONE（1）：不设置id生成策略</li><li>INPUT（2）：用户手工输入id</li><li>ASSIGN_ID（3）：雪花算法生成id（可兼容数值型与字符串型）</li><li>ASSIGN_UUID（4）：以UUID生成算法作为id生成策略</li></ul><p>雪花算法是生成一个串，是一个由64位二进制组成的，是一个long值</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260119033209429.png" alt="image-20260119033209429"></p><p>也可以弄个全局设置，在yml里加上</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line"><span class="attr">global-config:</span></span><br><span class="line"><span class="attr">db-config:</span></span><br><span class="line"><span class="string">id-type:assign_id</span></span><br></pre></td></tr></table></figure><h3 id="多记录操作"><a href="#多记录操作" class="headerlink" title="多记录操作"></a>多记录操作</h3><p>用这个方法deleteBatchIds</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//批量删除</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span>&#123;</span><br><span class="line">List&lt;Long&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="number">1402551342481838081L</span>);</span><br><span class="line">    list.add(<span class="number">1402553134049501186L</span>);</span><br><span class="line">    list.add(<span class="number">1402553619611430913L</span>);</span><br><span class="line">    userDao.deleteBatchIds(list);</span><br><span class="line"></span><br><span class="line"><span class="comment">//批量查询</span></span><br><span class="line">List&lt;Long&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(<span class="number">1402551342481838081L</span>) ;</span><br><span class="line">    list.add(<span class="number">1402553134049501186L</span>);</span><br><span class="line">    list.add(<span class="number">1402553619611430913L</span>);</span><br><span class="line">    userDao.selectBatchIds();</span><br></pre></td></tr></table></figure><h3 id="逻辑删除"><a href="#逻辑删除" class="headerlink" title="逻辑删除"></a>逻辑删除</h3><p>删除操作业务问题：业务数据从数据库中丢弃</p><p>逻辑删除：为数据设置是否可用状态字段，删除时设置状态字段为不可用状态，数据保留在数据库中，比如设置1就是删除了，0就是没删，但都还保留着</p><p>先在数据库添加deleted字段，默认值为0，然后到User类加个逻辑删除字段，标记当前记录是否被删除</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//逻辑删除字段，标记当前记录是否被删除，里面的值都是默认值，要与数据库的对应</span></span><br><span class="line"><span class="meta">@TableLogic(value = &quot;0&quot; ,delval = &quot;1&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Integer deleted;</span><br></pre></td></tr></table></figure><p>执行后的sql语句:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> tbl_user <span class="keyword">SET</span> deleted<span class="operator">=</span><span class="number">1</span> <span class="keyword">WHERE</span> id<span class="operator">=</span>? <span class="keyword">AND</span> deleted<span class="operator">=</span><span class="number">0</span> </span><br></pre></td></tr></table></figure><p>这个也有在配置中搞定，第一个是用哪个字段做通用的逻辑，第二个是没有删除的东西标记是几，第三个是被逻辑删除的字段对应的值是几</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260119035440820.png" alt="image-20260119035440820"></p><h3 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h3><p>业务并发现象带来的问题：秒杀</p><p>要现在数据库加个字段用来标记当前谁在操作这条数据，然后在user里加下面字段</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Version</span></span><br><span class="line"><span class="keyword">private</span> Integer version;</span><br></pre></td></tr></table></figure><p>这个锁的原理是比如一个sql语句update set abc&#x3D;1，如果我有锁就where version &#x3D; 1，但如果别人拿到了也是1，那么效果就达不到了，所以修改的时候就变成version&#x3D;version+1，这样不断的累加就会不一样</p><p>在之前的分页里mp是通过拦截器帮我们把sql语句里加上，下面第二个拦截器是之前分页的拦截器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MpConfig</span> &#123;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mpInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//1.定义Mp拦截器</span></span><br><span class="line"><span class="type">MybatisPlusInterceptor</span> <span class="variable">mpInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line"><span class="comment">//2.添加具体的拦截器</span></span><br><span class="line">mpInterceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line">    <span class="comment">//3.添加乐观锁拦截器</span></span><br><span class="line">mpInterceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">OptimisticLockerInnerInterceptor</span>());</span><br><span class="line">    <span class="keyword">return</span> mpInterceptor;</span><br></pre></td></tr></table></figure><p>在使用这个的时候要记得加上version值，不提供就没有锁机制。下面这个是test类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user.setVersion(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>输出的结果是</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">UPDATE</span> tb1_user <span class="keyword">SET</span> name<span class="operator">=</span>?, version<span class="operator">=</span>? <span class="keyword">WHERE</span> id<span class="operator">=</span>? <span class="keyword">AND</span> version<span class="operator">=</span>? <span class="keyword">AND</span> deleted<span class="operator">=</span><span class="number">0</span></span><br><span class="line">Parameters: Jock666(String), <span class="number">2</span>(<span class="type">Integer</span>), <span class="number">3</span>(Long), <span class="number">1</span>(<span class="type">Integer</span>)</span><br></pre></td></tr></table></figure><p>如果不用锁，就是下面代码，这里面是有version的，可以不从前台拿到version但是要保证这里有version</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.先通过要修改的数据id将当前数据查询出来</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.selectById(<span class="number">3L</span>);</span><br><span class="line"><span class="comment">//2.将要修改的属性逐一设置进去</span></span><br><span class="line">user.setName(<span class="string">&quot;Jock888&quot;</span>);</span><br><span class="line"></span><br><span class="line">模拟一下两个用户同时操作</span><br><span class="line"><span class="comment">//1.先通过要修改的数据d将当前数据查询出来</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.selectById(<span class="number">3L</span>);</span><br><span class="line"><span class="comment">//version=3</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> userDao.selectById(<span class="number">3L</span>);</span><br><span class="line"><span class="comment">//version=3</span></span><br><span class="line">user2.setName(<span class="string">&quot;Jock aaa&quot;</span>);</span><br><span class="line">userDao.updateById(user2) ;</span><br><span class="line"><span class="comment">//version=&gt;4</span></span><br><span class="line">user.setName(<span class="string">&quot;Jock bbb&quot;</span>);</span><br><span class="line">userDao.updateById(user);</span><br><span class="line"><span class="comment">//verion=3?条件还成立吗？就不成立了</span></span><br></pre></td></tr></table></figure><p>也就是上面的执行完version已经是4了，下面的就不成立，所以执行失败</p><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260119235730228.png" alt="image-20260119235730228"></p><h2 id="代码生成器"><a href="#代码生成器" class="headerlink" title="代码生成器"></a>代码生成器</h2><p><img src="/./images/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98SSM/image-20260120173126665.png" alt="image-20260120173126665"></p><p>其实有些信息是可以读取数据库获取的</p><p>我们新建一个项目，pom里面新添两个坐标</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--代码生成器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--veLocity模板引擎，模板技术是一个独立的技术--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后新建一个类，先创建代码生成器的对象，然后执行代码生成器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Generator</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(string[]args)</span>&#123;</span><br><span class="line"><span class="type">AutoGenerator</span> <span class="variable">autoGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">    </span><br><span class="line"><span class="comment">//设置数据库配置</span></span><br><span class="line"><span class="type">DataSourceConfig</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">dataSource.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">dataSource.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/mybatisplus_db?serverTimezone=UTc&quot;</span>);</span><br><span class="line">dataSource.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">dataSource.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">autoGenerator.setDataSource(dataSource);</span><br><span class="line">    </span><br><span class="line">autoGenerator.execute();<span class="comment">//执行代码</span></span><br></pre></td></tr></table></figure><p>执行后就生成了一些文件，文件名叫conf，但是生成的路径不太对，就可以配置一些东西</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置全局配置</span></span><br><span class="line"><span class="type">GlobalConfig</span> <span class="variable">globalConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line"><span class="comment">//这个是准备输出到什么位置，点进setoutputDir查看源码，默认是输出到d盘根目录里，所以后面的配置是输出到用户目录的</span></span><br><span class="line">globalconfig.setoutputDir(System.getProperty(<span class="string">&quot;user.dir&quot;</span>)+<span class="string">&quot;/mybatisplus_04_generator/src/main/java&quot;</span>);</span><br><span class="line">globalconfig.setOpen（<span class="literal">false</span>）；<span class="comment">//设置生成完毕后是否打开生成代码所在的目录</span></span><br><span class="line">globalConfig.setAuthor(<span class="string">&quot;黑马程序员&quot;</span>）;<span class="comment">//设置生成的作者</span></span><br><span class="line">                       globalConfig.setFileoverride(<span class="literal">true</span>);<span class="comment">//后生成的要不要覆盖前面生成的文件</span></span><br><span class="line">                       globalConfig.setMapperName(<span class="string">&quot;%sDao&quot;</span>);<span class="comment">//设置数据层接口名，%s为占位符（数据库里的表名），指代模块名称，比如按照我们的设置生成的文件名就叫xxx_xxxDao，如果不设置这个会按照他自己的规则生成xxxMapper</span></span><br><span class="line">globalConfig.setIdType(IdType.ASSIGN_ID); <span class="comment">//设置Id生成策略，会在实体类里自动加上@TableId(value = &quot;id&quot;,type = IdType.ASSIGN_ID)</span></span><br><span class="line">                       autoGenerator.setGlobalConfig(globalConfig);</span><br></pre></td></tr></table></figure><p>然后是包名相关配置，创建出来的实体类不叫domain，叫entity，dao包叫mapper</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置包名相关配置</span></span><br><span class="line"><span class="type">PackageConfig</span> <span class="variable">packageInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">packageInfo.setParent（<span class="string">&quot;com.itheima”）；//设置生成的包名，与代码所在位置不冲突，二者叠加组成完整路径</span></span><br><span class="line"><span class="string">packageInfo.setEntity(&quot;</span>domain<span class="string">&quot;)；//设置实体类包名</span></span><br><span class="line"><span class="string">packageInfo.setMapper(&quot;</span>dao<span class="string">&quot;);//设置数据层包名</span></span><br><span class="line"><span class="string">autoGenerator.setPackageInfo(packageInfo);</span></span><br></pre></td></tr></table></figure><p>然后是策略配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//策略设置</span></span><br><span class="line"><span class="type">StrategyConfig</span> <span class="variable">strategyConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">strategyConfig.setInclude（<span class="string">&quot;tbl_user&quot;</span>）；<span class="comment">//设置当前参与生成的表名，参数为可变参数，就是只生成哪些表</span></span><br><span class="line">strategyConfig.setTablePrefix（<span class="string">&quot;tbl_&quot;</span>）； <span class="comment">//设置数据库表的前缀名称，模块名=数据库表名－前缀名例如：User =tbl_user就变成了user</span></span><br><span class="line">strategyConfig.setRestControllerStyle(<span class="literal">true</span>）；<span class="comment">//设置是否启用Rest风格</span></span><br><span class="line">strategyConfig.setEntityLombokModel（<span class="literal">true</span>）;<span class="comment">//设置是否启用Lombok</span></span><br><span class="line">strategyConfig.setVersionFieldName（<span class="string">&quot;version&quot;</span>）；<span class="comment">//设置乐观锁字段名strategyConfig.setLogicDeleteFieldName（&quot;deleted&quot;）；//设置逻辑删除字段名</span></span><br><span class="line"></span><br><span class="line">autoGenerator.setStrategy(strategyConfig);</span><br><span class="line"><span class="comment">//2.执行生成操作</span></span><br><span class="line">autoGenerator.execute();</span><br></pre></td></tr></table></figure><p>运行后controller里的注解就自动加上@RestController，然后User里加上了@Data，多了个@EquealsAndHashCode(callSuper &#x3D; false)，这个是生成的equals和hashcode是否继承父类的equals和hashcode方法，然后下面的deleted和version都加上了注解</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSM </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>博客笔记</title>
      <link href="/posts/eedaddf.html"/>
      <url>/posts/eedaddf.html</url>
      
        <content type="html"><![CDATA[<h1 id="live2d"><a href="#live2d" class="headerlink" title="live2d"></a>live2d</h1><p>对于live2d，ai告诉我一个比原版更聪明的看板娘，安装方法是：</p><p>方案二：利用 Butterfly 的 <code>inject</code> 功能（最优雅）</p><p>Butterfly 专门提供了一个 <code>inject</code> 配置项，允许你把代码插入到页面的特定位置，而不用去翻找复杂的 HTML 文件。</p><ol><li>打开 <strong><code>_config.butterfly.yml</code></strong>。</li><li>找到 <code>inject:</code> 部分，在 <code>bottom:</code> 下面添加那行脚本：</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="comment"># 可以在这里加 CSS</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><h1 id="看板娘"><a href="#看板娘" class="headerlink" title="看板娘"></a>看板娘</h1><p>看板娘的这个我应该怎么变成右下角固定  </p><p>如果你使用的是这个 <code>autoload.js</code> 脚本，它默认通常会出现在左下角。要将其固定到<strong>右下角</strong>，最直接的方法是通过 <strong>CSS 覆盖</strong>。</p><p>由于这个脚本在运行时会自动往页面注入一个 ID 为 <code>waifu</code>（或者类似的容器）的 HTML 元素，我们可以直接在 Hexo 中添加样式来强制改变它的位置。</p><p>方案一：通过 Butterfly 的 Inject 功能（最推荐）</p><p>不需要改动 JS 脚本，直接在 <code>_config.butterfly.yml</code> 中添加一行 CSS 注入即可：</p><ol><li>打开 <strong><code>_config.butterfly.yml</code></strong>。</li><li>找到 <code>inject</code> -&gt; <code>head</code> 部分。</li><li>添加以下代码：</li></ol><p>YAML</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">inject:</span><br><span class="line">  head:</span><br><span class="line">    - &lt;style&gt;#waifu &#123; left: auto !important; right: 0 !important; &#125;&lt;/style&gt;</span><br><span class="line">  bottom:</span><br><span class="line">    - &lt;script src=&quot;https://fastly.jsdelivr.net/npm/live2d-widgets@1.0.0/dist/autoload.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><strong>代码解释：</strong></p><ul><li><code>left: auto !important;</code>：取消默认的左侧定位。</li><li><code>right: 0 !important;</code>：将其固定到右侧。你可以把 <code>0</code> 改成 <code>20px</code> 让它离边缘有一点距离。</li></ul><hr><p>方案二：如果你使用的是本地文件</p><p>如果你已经把 <code>waifu.css</code> 下载到了本地（例如放在 <code>source/live2d-widget/waifu.css</code>）：</p><ol><li><p>打开该 <strong><code>waifu.css</code></strong> 文件。</p></li><li><p>搜索 <code>#waifu</code>。</p></li><li><p>将其中的 <code>left: 0;</code> 修改为：</p><p>CSS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#waifu &#123;</span><br><span class="line">    right: 20px; /* 距离右边 20 像素 */</span><br><span class="line">    bottom: 0;</span><br><span class="line">    /* 确保没有 left 属性，如果有，请删掉或改为 left: auto; */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><hr><p>方案三：针对不同插件容器名的通用补救</p><p>如果你发现上面的 <code>#waifu</code> 没起作用，说明你这个版本的插件可能用了不同的 ID。你可以按以下步骤查找：</p><ol><li>在浏览器打开你的博客，按 <strong>F12</strong> 打开开发者工具。</li><li>点击左上角的“小箭头”图标，去页面上点击那个看板娘。</li><li>查看右侧面板中该元素的 <code>id</code> 是什么（可能是 <code>landlord</code> 或 <code>live2d-widget</code>）。</li><li>将方案一代码中的 <code>#waifu</code> 替换为那个 ID 即可。</li></ol><hr><p>⚠️ 可能存在的冲突</p><p>由于你在右下角可能还有：</p><ol><li><strong>Butterfly 的“回到顶部”按钮</strong>。</li><li><strong>APlayer 播放器</strong>（如果你也把它设在了右边）。</li></ol><p><strong>建议：</strong> 如果右下角太挤了，你可以微调位置，比如： <code>right: 50px !important; bottom: 20px !important;</code> 这样看板娘会往左边和上方挪一点，避免挡住功能按钮。</p><p><strong>改完后记得执行 <code>hexo clean</code> 和 <code>hexo g</code>。看板娘现在成功“瞬移”到右边了吗？</strong></p><h1 id="pwa"><a href="#pwa" class="headerlink" title="pwa"></a>pwa</h1><p>安装完后右上角会有个安装按钮，可以离线看博客，然后有缓存可以加快访问速度，右上角会有个通知博客更新</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">npm install --global gulp-cli #全局安装gulp命令集</span><br><span class="line">npm install workbox-build gulp --save#安装workbox和gulp扬件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">压缩html插件</span></span><br><span class="line">npm install gulp-htmlclean --save-dev</span><br><span class="line">npm install --save gulp-htmlmin</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">压缩css播件</span></span><br><span class="line">npm install gulp-clean-css --save-dev</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">压缩js播件</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用babel压缩js，与terser二选一</span></span><br><span class="line">npm install --save-dev gulpuglify</span><br><span class="line">npm install --save-dev gulp-babel @babel/core @babel/preset-env</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用terser压缩js，与babel二选一（推荐）</span></span><br><span class="line">npm install gulp-terser --save-dev</span><br><span class="line">npm install --save-dev gulp-babel @babel/core @babel/preset-env</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩图片播件（没啥用）</span></span><br><span class="line">npm install --save-dev gulp-imagcmin</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">压缩字体播件(font-min仅支持压缩ttf格式的字体包)</span></span><br><span class="line">npm install gulp-fontmin --save-dev</span><br></pre></td></tr></table></figure><p>关于font-min的补充说明，在本文中，是通过读取所有编译好的html文件(.&#x2F;public&#x2F;“.html)中的字符，然后匹配原有字体包内.&#x2F;public&#x2F;fonts&#x2F;.ttf字体样式，输出压缩后的字体包到 &#x2F;public&#x2F;fontsdest&#x2F;目录。所以最终引用字体的相对路径应读是&#x2F;fontsdes&#x2F;.ttf。而本地测试时，如果没有运行gulp，自然也就不会输出压缩字体包到public目录，也就看不到字体样式。</p><p>julp-terser只会直接压缩js代码，所以不存在因为语法变动导致的错误。事实上，当我们使用jsdelivr的CDN服务时，只需要在css或者js的后级前添加加.min,例如example.js-&gt;example.min.js,JsDelivr就会自动使用terser帮我们压缩好代码,</p><p>在package.json添加</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;module&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>创建gulpfile.js，在hexo的根目录创建这个文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gulp <span class="keyword">from</span> <span class="string">&#x27;gulp&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> cleanCSS <span class="keyword">from</span> <span class="string">&#x27;gulp-clean-css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> htmlmin <span class="keyword">from</span> <span class="string">&#x27;gulp-htmlmin&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> htmlclean <span class="keyword">from</span> <span class="string">&#x27;gulp-htmlclean&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> imagemin <span class="keyword">from</span> <span class="string">&#x27;gulp-imagemin&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> workbox <span class="keyword">from</span> <span class="string">&#x27;workbox-build&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> fontmin <span class="keyword">from</span> <span class="string">&#x27;gulp-fontmin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//若使用babel压缩js，则取消下方注释，并注释terser的代码</span></span><br><span class="line"><span class="comment">// var uglify = require(&#x27;gulp-uglify&#x27;);</span></span><br><span class="line"><span class="comment">// var babel = require(&#x27;gulp-babel&#x27;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//若使用terser压缩js</span></span><br><span class="line"><span class="keyword">import</span> terser <span class="keyword">from</span> <span class="string">&#x27;gulp-terser&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//pwa</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;generate-service-worker&#x27;</span>, <span class="function">()=&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> workbox.<span class="title function_">injectManifest</span>(&#123;</span><br><span class="line">        <span class="attr">swSrc</span>: <span class="string">&#x27;./sw-template.js&#x27;</span>,</span><br><span class="line">        <span class="attr">swDest</span>: <span class="string">&#x27;./public/sw.js&#x27;</span>,</span><br><span class="line">        <span class="attr">globDirectory</span>: <span class="string">&#x27;./public&#x27;</span>,</span><br><span class="line">        <span class="attr">globPatterns</span>: [</span><br><span class="line">            <span class="comment">// 缓存所有以下类型的文件，极端不推荐</span></span><br><span class="line">            <span class="comment">// &quot;**/*.&#123;html,css,js,json,woff2,xml&#125;&#x27;</span></span><br><span class="line">            <span class="comment">// 推荐只缓存404，主页和主要样式和脚本，</span></span><br><span class="line">            <span class="string">&#x27;404.html&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;js/main.js&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;css/index.css&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">modifyURLPrefix</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;&#x27;</span>: <span class="string">&#x27;./&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//minify js babel</span></span><br><span class="line"><span class="comment">// 若使用babel压缩js，取消下方注释，并注释terser的代码</span></span><br><span class="line"><span class="comment">// gulp.task(&#x27;compress&#x27;,()=&gt;</span></span><br><span class="line"><span class="comment">// gulp.src([&#x27;./public/**/*.js&#x27;,&#x27;!./public/*e*/*.min.js&#x27;j)</span></span><br><span class="line"><span class="comment">// .pipelbabel(&#123;</span></span><br><span class="line"><span class="comment">// 888888963</span></span><br><span class="line"><span class="comment">// presets: [&#x27;@babel/preset-env&#x27;]</span></span><br><span class="line"><span class="comment">// &#125;))</span></span><br><span class="line"><span class="comment">// .pipe(uglify().on(&#x27;error&#x27;, function(e)&#123;</span></span><br><span class="line"><span class="comment">// console.log(e);</span></span><br><span class="line"><span class="comment">// &#125;))</span></span><br><span class="line"><span class="comment">// .pipe(gulp.dest(&#x27;./public&#x27;))</span></span><br><span class="line"><span class="comment">// );</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// minify js - gulp-tester</span></span><br><span class="line"><span class="comment">// 若使用terser压编js</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;compress&#x27;</span>, <span class="function">()=&gt;</span></span><br><span class="line">    gulp</span><br><span class="line">        .<span class="title function_">src</span>([</span><br><span class="line">            <span class="string">&#x27;./public/**/*.js&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;!./public/**/*.min.js&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;!./public/js/custom/galmenu.js&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;!./public/js/custom/gitcalendar.js&#x27;</span>,</span><br><span class="line">        ])</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">terser</span>())</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//css</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-css&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp</span><br><span class="line">        .<span class="title function_">src</span>(<span class="string">&#x27;./public/**/*.css&#x27;</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(</span><br><span class="line">            <span class="title function_">cleanCSS</span>(&#123;</span><br><span class="line">                <span class="attr">compatibility</span>: <span class="string">&#x27;ie11&#x27;</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">        )</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩 public 目录内 html</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-html&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp</span><br><span class="line">        .<span class="title function_">src</span>(<span class="string">&#x27;./public/**/*.html&#x27;</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">htmlclean</span>())</span><br><span class="line">        .<span class="title function_">pipe</span>(</span><br><span class="line">            <span class="title function_">htmlmin</span>(&#123;</span><br><span class="line">                <span class="attr">removeComments</span>:<span class="literal">true</span>,<span class="comment">//清除 HTML 註释</span></span><br><span class="line">                <span class="attr">collapseWhitespace</span>:<span class="literal">true</span>,<span class="comment">//压缩HTML</span></span><br><span class="line">                <span class="attr">collapseBooleanAttributes</span>: <span class="literal">true</span>,<span class="comment">//省略布尔属性的值 &lt;input checked=&quot;true&quot;/&gt; ==&gt; &lt;input /&gt;</span></span><br><span class="line">                <span class="attr">removeEmptyAttributes</span>:<span class="literal">true</span>,<span class="comment">//删除所有空格作属性值&lt;input id=&quot;&quot;/&gt;==&gt; &lt;input /&gt;</span></span><br><span class="line">                <span class="attr">removeScriptTypeAttributes</span>: <span class="literal">true</span>,<span class="comment">//删除 &lt;script&gt;的 type=&quot;text/javascript&quot;</span></span><br><span class="line">                <span class="attr">removeStyleLinkTypeAttributes</span>: <span class="literal">true</span>, <span class="comment">//删除 &lt;style&gt;和&lt;Link&gt; 的 ype=&quot;text/css&quot;</span></span><br><span class="line">                <span class="attr">minifyJS</span>: <span class="literal">true</span>,<span class="comment">//压缩页面 JS</span></span><br><span class="line">                <span class="attr">minifyCss</span>: <span class="literal">true</span>,<span class="comment">//压缩页面CS5</span></span><br><span class="line">                <span class="attr">minifyURLs</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">        )</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩 public/uploads 目录内图片</span></span><br><span class="line"><span class="comment">// gulp.task(&#x27;minify-images&#x27;, async() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     gulp</span></span><br><span class="line"><span class="comment">//         .src(&#x27;./public/img/**/*.*&#x27;)</span></span><br><span class="line"><span class="comment">//         .pipe(</span></span><br><span class="line"><span class="comment">//             imagemin(&#123;</span></span><br><span class="line"><span class="comment">//             optimizationLevel: 5,//类型:Number  预设: 3 取值範围:0-7(优化等级)</span></span><br><span class="line"><span class="comment">//             progressive: true,//类型:Boolean    预设:   false无失真压缩jpg图片</span></span><br><span class="line"><span class="comment">//             interlaced: false,//类型:Boolean 预设:   false 隔行扫描gif进行渲染</span></span><br><span class="line"><span class="comment">//             multipass: false,//类型:Boolean 预设:   false 多次优化svg直到完全优化</span></span><br><span class="line"><span class="comment">//             &#125;)</span></span><br><span class="line"><span class="comment">//         )</span></span><br><span class="line"><span class="comment">//         .pipe(gulp.dest(&#x27;./public/img&#x27;));</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//执行 gulp 命令时执行的任务</span></span><br><span class="line">gulp.<span class="title function_">task</span>(</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>,</span><br><span class="line">    gulp.<span class="title function_">series</span>(</span><br><span class="line">        <span class="string">&#x27;generate-service-worker&#x27;</span>,</span><br><span class="line">        gulp.<span class="title function_">parallel</span>(<span class="string">&#x27;compress&#x27;</span>, <span class="string">&#x27;minify-html&#x27;</span>, <span class="string">&#x27;minify-css&#x27;</span>, <span class="string">&#x27;minify-font&#x27;</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>创建sw-template.js文件，然后输入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> workboxVersion = <span class="string">&#x27;5.1.3&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入 Workbox</span></span><br><span class="line"><span class="title function_">importScripts</span>(<span class="string">`https://storage.googleapis.com/workbox-cdn/releases/<span class="subst">$&#123;workboxVersion&#125;</span>/workbox-sw.js`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置缓存名称前缀</span></span><br><span class="line">workbox.<span class="property">core</span>.<span class="title function_">setCacheNameDetails</span>(&#123;</span><br><span class="line">  <span class="attr">prefix</span>:<span class="string">&#x27;shelter&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 强制等待激活与更新</span></span><br><span class="line">workbox.<span class="property">core</span>.<span class="title function_">skipWaiting</span>();</span><br><span class="line">workbox.<span class="property">core</span>.<span class="title function_">clientsClaim</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册成功后要立即缓存的资源列表</span></span><br><span class="line"><span class="comment">// 具体缓存列表在gulpfile.js中配置，见下文</span></span><br><span class="line">workbox.<span class="property">precaching</span>.<span class="title function_">precacheAndRoute</span>(self.<span class="property">__WB_MANIFEST</span>,&#123;</span><br><span class="line">  <span class="attr">directoryIndex</span>: <span class="literal">null</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清空过期缓存</span></span><br><span class="line">workbox.<span class="property">precaching</span>.<span class="title function_">cleanupOutdatedCaches</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 字体缓存 (修复了你代码中的正则错误)</span></span><br><span class="line">workbox.<span class="property">routing</span>.<span class="title function_">registerRoute</span>(</span><br><span class="line">  <span class="regexp">/\.(?:eot|ttf|woff|woff2)$/</span>,</span><br><span class="line">  <span class="keyword">new</span> workbox.<span class="property">strategies</span>.<span class="title class_">CacheFirst</span>(&#123;</span><br><span class="line">    <span class="attr">cacheName</span>: <span class="string">&#x27;fonts&#x27;</span>,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">      <span class="keyword">new</span> workbox.<span class="property">expiration</span>.<span class="title class_">ExpirationPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">maxEntries</span>: <span class="number">1000</span>,</span><br><span class="line">        <span class="attr">maxAgeSeconds</span>: <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span>, <span class="comment">// 缓存 30 天</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> workbox.<span class="property">cacheableResponse</span>.<span class="title class_">CacheableResponsePlugin</span>(&#123;</span><br><span class="line">        <span class="attr">statuses</span>: [<span class="number">0</span>, <span class="number">200</span>],</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 图片缓存 (安知鱼博客通常包含大量图片)</span></span><br><span class="line">workbox.<span class="property">routing</span>.<span class="title function_">registerRoute</span>(</span><br><span class="line">  <span class="regexp">/\.(?:png|jpg|jpeg|svg|gif|webp)$/</span>,</span><br><span class="line">  <span class="keyword">new</span> workbox.<span class="property">strategies</span>.<span class="title class_">StaleWhileRevalidate</span>(&#123;</span><br><span class="line">    <span class="attr">cacheName</span>: <span class="string">&#x27;images&#x27;</span>,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">      <span class="keyword">new</span> workbox.<span class="property">expiration</span>.<span class="title class_">ExpirationPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">maxEntries</span>: <span class="number">500</span>,</span><br><span class="line">        <span class="attr">maxAgeSeconds</span>: <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 谷歌字体缓存</span></span><br><span class="line">workbox.<span class="property">routing</span>.<span class="title function_">registerRoute</span>(</span><br><span class="line">  <span class="regexp">/^https:\/\/fonts\.googleapis\.com/</span>,</span><br><span class="line">  <span class="keyword">new</span> workbox.<span class="property">strategies</span>.<span class="title class_">StaleWhileRevalidate</span>(&#123;</span><br><span class="line">    <span class="attr">cacheName</span>: <span class="string">&#x27;google-fonts-stylesheets&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 谷歌统计 (如果你使用了 Google Analytics)</span></span><br><span class="line">workbox.<span class="property">googleAnalytics</span>.<span class="title function_">initialize</span>();</span><br></pre></td></tr></table></figure><p>在[Blogroot]\themes\butterfly\layout\includes\third-party\目录下新建pwanotice.pug文件，打开 [Blogroot]\themes\butterfly\layout\includes\third-party\pwanotice.pug ,输入:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">#app-refresh(style=&#x27;position: fixed; top: -2.2rem; left: 0; right: 0; z-index: 99999; padding: 0 1rem; font-size: 15px; height: 2.2rem; transition: all 0.3s ease;&#x27;)</span><br><span class="line">  .app-refresh-wrap(style=&#x27;display: flex; color: #fff; height: 100%; align-items: center; justify-content: center;&#x27;)</span><br><span class="line">    label 🚀 有新内容发布啦！</span><br><span class="line">    a(href=&#x27;javascript:void(0)&#x27; onclick=&#x27;location.reload()&#x27;)</span><br><span class="line">      span(style=&#x27;color: #fff; text-decoration: underline; cursor: pointer; margin-left: 8px;&#x27;) 点击刷新</span><br><span class="line">script.</span><br><span class="line">  if (&#x27;serviceWorker&#x27; in navigator) &#123;</span><br><span class="line">    // 如果当前页面受 Service Worker 控制，监听控制权变化</span><br><span class="line">    if (navigator.serviceWorker.controller) &#123;</span><br><span class="line">      navigator.serviceWorker.addEventListener(&#x27;controllerchange&#x27;, function() &#123;</span><br><span class="line">        showNotification();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 页面加载完成后注册 sw.js</span><br><span class="line">    window.addEventListener(&#x27;load&#x27;, function() &#123;</span><br><span class="line">      navigator.serviceWorker.register(&#x27;/sw.js&#x27;).catch(err =&gt; &#123;</span><br><span class="line">        console.error(&#x27;PWA 注册失败:&#x27;, err);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function showNotification() &#123;</span><br><span class="line">    // 优先使用主题自带的 Snackbar 弹窗</span><br><span class="line">    if (window.GLOBAL_CONFIG &amp;&amp; GLOBAL_CONFIG.Snackbar) &#123;</span><br><span class="line">      var snackbarBg = document.documentElement.getAttribute(&#x27;data-theme&#x27;) === &#x27;light&#x27; ?</span><br><span class="line">        GLOBAL_CONFIG.Snackbar.bgLight :</span><br><span class="line">        GLOBAL_CONFIG.Snackbar.bgDark;</span><br><span class="line">      </span><br><span class="line">      var snackbarPos = GLOBAL_CONFIG.Snackbar.position;</span><br><span class="line"></span><br><span class="line">      Snackbar.show(&#123;</span><br><span class="line">        text: &#x27;🚀 有新文章发布啦！&#x27;,</span><br><span class="line">        backgroundColor: snackbarBg,</span><br><span class="line">        duration: 10000, // 持续 10 秒</span><br><span class="line">        pos: snackbarPos,</span><br><span class="line">        actionText: &#x27;点击刷新&#x27;,</span><br><span class="line">        actionTextColor: &#x27;#fff&#x27;,</span><br><span class="line">        onActionClick: function(e) &#123;</span><br><span class="line">          location.reload();</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // 如果没有 Snackbar，则显示顶部的 app-refresh 栏</span><br><span class="line">      var showBg = document.documentElement.getAttribute(&#x27;data-theme&#x27;) === &#x27;light&#x27; ? &#x27;#49b1f5&#x27; : &#x27;#1f1f1f&#x27;;</span><br><span class="line">      var appRefresh = document.getElementById(&#x27;app-refresh&#x27;);</span><br><span class="line">      if (appRefresh) &#123;</span><br><span class="line">        appRefresh.style.cssText = &#x27;top: 0; background: &#x27; + showBg + &#x27;;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>修改[Blogroot]\themes\butterfly\layout\includes\additional-js.pug<br>,在文件底部添加以下内容，注意缩进。 butterfly_v3.6.0取消了缓存配置，转为完全默认，需要将{cache:theme.fragment_cache} 改为{cache: true}，现在使用的是高版本，使用最后两行就行，注意pug是严格缩进模式，第一行一定是一个空格，第二行两个</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if theme.pjax.enable</span><br><span class="line">!=partial(&#x27;includes/third-party/pjax&#x27;,&#123;&#125;,&#123;cache:theme.fragment_cache&#125;)</span><br><span class="line"><span class="addition">!=partial(&#x27;includes/third-party/baidu_push&#x27;, &#123;&#125;,&#123;cache:theme.fragment_cache&#125;)</span></span><br><span class="line">  if theme.pwa.enable</span><br><span class="line">    != partial(&#x27;includes/third-party/pwanotice&#x27;, &#123;&#125; , &#123;cache: true&#125;)</span><br></pre></td></tr></table></figure><p>将你的图标包移入相应的目录，例如我是(img&#x2F;siteicon&#x2F;，所以放到[Blogroot]&#x2F;source&#x2F;img&#x2F;siteicon&#x2F;目录下。没有的话新建，site icon就是站点图标，可以去阿里的iconfont网站找资源</p><p>新建文件名为 manifest.json 并将其放到 [Blogroot]&#x2F;source 目录下，此时还不能直接用，需要添加一些内容，以下是我的 manifest.json 配置内容，权且作为参考，其中的 theme_color 建议用取色器取设计的图标的主色调，同时务必配置 start_url和 name的配置项，这关系到你之后能否看到浏览器的应用安装按钮。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Shelter的博客&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;short_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Shelter&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;theme_color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#49b1f5&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;background _color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#49b1f5&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;display&quot;</span><span class="punctuation">:</span> <span class="string">&quot;standalone&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scope&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;start_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;icons&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span><span class="string">&quot;/img/siteicon/16.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;16x16&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/img/siteicon/32.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;32x32&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/img/siteicon/64.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;64x64&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span><span class="string">&quot;/img/siteicon/128.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span><span class="string">&quot;128x128&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span><span class="string">&quot;/img/siteicon/144.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span><span class="string">&quot;144x144&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;image/png&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span><span class="string">&quot;/img/siteicon/512.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span><span class="string">&quot;512x512&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;splash_pages&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>打开主题配置文件 [Blogroot]&#x2F;_config.butterfly.yml,找到 PWA 配置项。添加图标路径。这里的 theme_color，建议改成你图标的主色调，包括 manifest.json 中的 theme_color 也是如此。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pwa:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">manifest:</span> <span class="string">/manifest.json</span></span><br><span class="line">  <span class="attr">theme_color:</span> <span class="string">&quot;#49b1f5&quot;</span><span class="string">,</span></span><br><span class="line">  <span class="attr">apple_touch_icon:</span> <span class="string">/img/siteicon/128.png</span></span><br><span class="line">  <span class="attr">favicon_32_32:</span> <span class="string">/img/siteicon/32/png</span></span><br><span class="line">  <span class="attr">favicon_16_16:</span> <span class="string">/img/siteicon/16.png</span></span><br><span class="line">  <span class="attr">mask_icon:</span> <span class="string">/img/siteicon/128.png</span></span><br></pre></td></tr></table></figure><h1 id="一图流"><a href="#一图流" class="headerlink" title="一图流"></a>一图流</h1><p>新建文件[Blogroot]&#x2F;source&#x2F;css&#x2F;custom.css在custom.css中填入以下内容</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* font-face &#123;</span></span><br><span class="line"><span class="comment">  font-family: Candyhome;</span></span><br><span class="line"><span class="comment">  src:url(https://cdn.cbd.int/anzhiyu-blog@latest/fonts/Candyhome.ttf);</span></span><br><span class="line"><span class="comment">  font-display: swap;</span></span><br><span class="line"><span class="comment">  font-weight: lighter;</span></span><br><span class="line"><span class="comment">&#125; */</span></span><br><span class="line"> <span class="comment">/* 谷歌字体 */</span></span><br><span class="line">  <span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: ZhuZiAYuanJWD;</span><br><span class="line">    <span class="attribute">src</span>:<span class="built_in">url</span>(<span class="string">https://cdn.cbd,int/anzhiyu-blog@latest/fonts/ZhuZiAWan.woff2</span>);</span><br><span class="line">    <span class="attribute">font-display</span>: swap;</span><br><span class="line">    <span class="attribute">font-weight</span>: lighter;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">@import</span> url(<span class="attribute">https</span>://fonts.googleapis.com/css2?family=ZC00L+KuaiLe&amp;display=swap);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 这里应该是站点最上面那个字体 */</span></span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-id">#menus</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>:<span class="string">&#x27;ZhuZiAYuanJWD&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">h1</span><span class="selector-id">#site-title</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: ZhuZiAYuanJWD;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">3em</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">a</span><span class="selector-class">.article-title</span>,</span><br><span class="line">  <span class="selector-tag">a</span><span class="selector-class">.blog-slider__title</span>,</span><br><span class="line">  <span class="selector-tag">a</span><span class="selector-class">.categoryBar-list-link</span>,</span><br><span class="line">  <span class="selector-tag">h1</span><span class="selector-class">.post-title</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: ZhuZiAYuanJwD; </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.iconfont</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>:<span class="string">&#x27;iconfont&#x27;</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">3em</span>;</span><br><span class="line">    <span class="comment">/*可以定义图标大小 */</span></span><br><span class="line">    <span class="attribute">font-style</span>: normal;</span><br><span class="line">    -webkit-<span class="attribute">font-smoothing</span>:antialiased;</span><br><span class="line">    -moz-osx-<span class="attribute">font-smoothing</span>:grayscale;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*时间轴生肖icon */</span></span><br><span class="line">  <span class="selector-tag">svg</span><span class="selector-class">.icon</span> &#123;</span><br><span class="line">    <span class="comment">/* 这里定义svg.icon，避免和Butterfly自带的note标签冲突 */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1em</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1em</span>;</span><br><span class="line">    <span class="comment">/* width和height定义图标的默认宽度和高度*/</span></span><br><span class="line">    <span class="attribute">vertical-align</span>:-<span class="number">0.15em</span>;</span><br><span class="line">    <span class="attribute">fill</span>: currentColor;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.icon-zhongbiao</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#f7c768</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* bilibli番剧插件 */</span></span><br><span class="line">  <span class="selector-class">.bangumi-active</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="number">#dbecfe</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">a</span><span class="selector-class">.bangumi-tab</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.bangumi-button</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="number">#dbecfe</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">a</span><span class="selector-class">.bangumi-button</span><span class="selector-class">.bangumi-nextpage</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.bangumi-button</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">a</span><span class="selector-class">.bangumi-tab</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">svg</span><span class="selector-class">.icon</span><span class="selector-class">.faa-tada</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.1em</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 解决artitalk的图标问题 */</span></span><br><span class="line">  <span class="selector-id">#uploadSource</span> &gt; <span class="selector-tag">svg</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1.19em</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1.5em</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*top-img黑色透明玻璃效果移除，不建议加，除非你执着于完全一图流或者背景图对比色明显 */</span></span><br><span class="line">  <span class="selector-id">#page-header</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.not-top-img</span>)<span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 首页文章卡片 */</span></span><br><span class="line">  <span class="selector-id">#recent-posts</span> &gt; <span class="selector-class">.recent-post-item</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0.9</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 首页侧栏卡片 */</span></span><br><span class="line">  <span class="selector-id">#aside-content</span> <span class="selector-class">.card-widget</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0.9</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 文章页面正文背景 **/</span></span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-id">#post</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0.9</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*分页页面 */</span></span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-id">#page</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0.9</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 归档页面 */</span></span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-id">#archive</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>:■<span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0.9</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 标签页面 */</span></span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-id">#tag</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0.9</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*分类页面 */</span></span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-id">#category</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0.9</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*夜间模式伪类遮罩层透明*/</span></span><br><span class="line">  <span class="selector-attr">[data-theme=<span class="string">&#x27;dark&#x27;</span>]</span><span class="selector-id">#recent-posts</span> &gt; <span class="selector-class">.recent-post-item</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#121212</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-attr">[data-theme=<span class="string">&#x27;dark&#x27;</span>]</span> <span class="selector-class">.card-widget</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#121212</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-attr">[data-theme=<span class="string">&#x27;dark&#x27;</span>]</span> <span class="selector-tag">div</span><span class="selector-id">#post</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#121212</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-attr">[data-theme=<span class="string">&#x27;dark&#x27;</span>]</span> <span class="selector-tag">div</span><span class="selector-id">#tag</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#121212</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-attr">[data-theme=<span class="string">&#x27;dark&#x27;</span>]</span> <span class="selector-tag">div</span><span class="selector-id">#archive</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#121212</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-attr">[data-theme=<span class="string">&#x27;dark&#x27;</span>]</span> <span class="selector-tag">div</span><span class="selector-id">#page</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#121212</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-attr">[data-theme=<span class="string">&#x27;dark&#x27;</span>]</span> <span class="selector-tag">div</span><span class="selector-id">#category</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#121212</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-attr">[data-theme=<span class="string">&#x27;dark&#x27;</span>]</span> <span class="selector-tag">div</span><span class="selector-id">#category</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 页脚透明 */</span></span><br><span class="line">  <span class="selector-id">#footer</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 头图透明 */</span></span><br><span class="line">  <span class="selector-id">#page-header</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#rightside</span> &gt; <span class="selector-tag">div</span> &gt; <span class="selector-tag">button</span> &#123;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 滚动条的一些设置 */</span></span><br><span class="line">  ::-webkit-scrollbar &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ::-webkit-scrollbar-thumb &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#49b1f5</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">2em</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ::-webkit-scrollbar-corner &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: transparent;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ::-moz-selection &#123;</span><br><span class="line">    <span class="attribute">color</span>: ■<span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#49b1f5</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 音乐播放器 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* .aplayer .aplayer-lrc &#123;</span></span><br><span class="line"><span class="comment">    display: none !important;</span></span><br><span class="line"><span class="comment">  &#125;*/</span></span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.aplayer</span><span class="selector-class">.aplayer-fixed</span><span class="selector-class">.aplayer-narrow</span> <span class="selector-class">.aplayer-body</span> &#123;</span><br><span class="line">    <span class="attribute">left</span>: -<span class="number">66px</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">0.3s</span>;</span><br><span class="line">    <span class="comment">/* 默认情况下缩进左侧66px，只留一点箭头部分 */</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.aplayer</span><span class="selector-class">.aplayer-fixed</span><span class="selector-class">.aplayer-narrow</span> <span class="selector-class">.aplayer-body</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">0.3s</span>;</span><br><span class="line">    <span class="comment">/* 鼠标悬停是左侧缩进归零，完全显示按钮 */</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.aplayer</span><span class="selector-class">.aplayer-fixed</span> &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">999999</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 评论框</span></span><br><span class="line"><span class="comment">  .vwrap &#123;</span></span><br><span class="line"><span class="comment">    box-shadow:2px2px5px #bbb;</span></span><br><span class="line"><span class="comment">    background:口rgba(255，255，255，0.3);</span></span><br><span class="line"><span class="comment">    border-radius: 8px;</span></span><br><span class="line"><span class="comment">    padding: 30px;</span></span><br><span class="line"><span class="comment">    margin:30px 0px 30px px;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  /* 设置评论框 */</span></span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.vcard</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> <span class="number">5px</span> <span class="number">#bbb</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0.3</span>);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">30px</span> <span class="number">0px</span> <span class="number">0px</span> <span class="number">0px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 鼠标图标 */</span></span><br><span class="line">  <span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">cursor</span>: <span class="built_in">url</span>(<span class="string">&#x27;/img/x1.cur&#x27;</span>), auto;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="selector-tag">a</span>,</span><br><span class="line">    <span class="selector-attr">[type=<span class="string">&#x27;button&#x27;</span>]</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:disabled</span>),</span><br><span class="line">    <span class="selector-attr">[type=<span class="string">&#x27;reset&#x27;</span>]</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:disabled</span>),</span><br><span class="line">    <span class="selector-attr">[type=<span class="string">&#x27;submit&#x27;</span>]</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:disabled</span>),</span><br><span class="line">    <span class="selector-tag">button</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:disabled</span>) &#123;</span><br><span class="line">      <span class="attribute">cursor</span>: <span class="built_in">url</span>(<span class="string">&#x27;/img/x2.cur&#x27;</span>), auto <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* md网站下划线 */</span></span><br><span class="line">    <span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">      <span class="attribute">text-decoration</span>: none <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#article-container</span> <span class="selector-id">#hpp_talk</span> <span class="selector-tag">p</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">      <span class="attribute">display</span>: inline;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 404页面 */</span></span><br><span class="line">  <span class="selector-id">#error-wrap</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">40%</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    <span class="attribute">padding</span>:<span class="number">0</span> <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">1000px</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, -<span class="number">50%</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#error-wrap</span> <span class="selector-class">.error-content</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: row;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">margin</span>:<span class="number">0</span> <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">18rem</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>:<span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--card-bg);</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="built_in">var</span>(--card-box-shadow);</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">0.3s</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-id">#error-wrap</span> <span class="selector-class">.error-content</span> <span class="selector-class">.error-img</span> &#123;</span><br><span class="line">    <span class="attribute">box-flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">border-top-left-radius</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">border-bottom-left-radius</span>:<span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: 口<span class="number">#49b1f5</span>;</span><br><span class="line">    <span class="attribute">background-position</span>:center;</span><br><span class="line">    <span class="attribute">background-size</span>: cover;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#error-wrap</span> <span class="selector-class">.error-content</span> <span class="selector-class">.error-info</span> &#123;</span><br><span class="line">    <span class="attribute">box-flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.5rem</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">font-family</span>: Titillium Web, <span class="string">&#x27;PingFang SC&#x27;</span>, <span class="string">&#x27;Hiragino Sans GB&#x27;</span>, <span class="string">&#x27;Microsoft JhengHei&#x27;</span>, <span class="string">&#x27;Microsoft YaHei&#x27;</span>,</span><br><span class="line">    sans-serif;</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="selector-id">#error-wrap</span> <span class="selector-class">.error-contenr</span> <span class="selector-class">.error-info</span> <span class="selector-class">.error_title</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>:-<span class="number">4rem</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">9em</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-id">#error-wrap</span> <span class="selector-class">.error-content</span> <span class="selector-class">.error-info</span> <span class="selector-class">.error_subtitle</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>:-<span class="number">3.5rem</span>;</span><br><span class="line">    <span class="attribute">word-break</span>: break-word;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.6em</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-id">#error-wrap</span> <span class="selector-class">.error-content</span> <span class="selector-class">.error-info</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">0.5rem</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.3rem</span> <span class="number">1.5rem</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--btn-bg);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--btn-color);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#body-wrap</span><span class="selector-class">.error</span> <span class="selector-class">.aside-list</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: row;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: nowrap;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0px</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: scroll;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-id">#body-wrap</span><span class="selector-class">.error</span> <span class="selector-class">.aside-list</span> <span class="selector-class">.aside-list-group</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: row;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: nowrap;</span><br><span class="line">    <span class="attribute">max-width</span>:<span class="number">1200px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-id">#body-wrap</span><span class="selector-class">.error</span> <span class="selector-class">.aside-list</span> <span class="selector-class">.aside-list-item</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.5rem</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-id">#body-wrap</span><span class="selector-class">.error</span> <span class="selector-class">.aside-list</span> <span class="selector-class">.aside-list-item</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">object-fit</span>: cover;</span><br><span class="line">    <span class="attribute">border-radius</span>:<span class="number">12px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#body-wrap</span><span class="selector-class">.error</span> <span class="selector-class">.aside-list</span> <span class="selector-class">.aside-list-item</span> <span class="selector-class">.thumbnail</span> &#123;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">230px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">143px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--heo-card-bg);</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-id">#body-wrap</span><span class="selector-class">.error</span> <span class="selector-class">.aside-list</span> <span class="selector-class">.aside-list-item</span> <span class="selector-class">.content</span> <span class="selector-class">.title</span> &#123;</span><br><span class="line">    -webkit-<span class="selector-tag">line</span>-clamp:<span class="number">2</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">    -webkit-<span class="attribute">box-orient</span>: vertical;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.5</span>;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: flex-end;</span><br><span class="line">    <span class="attribute">align-content</span>:center;</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="number">0.5rem</span>;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-id">#body-wrap</span><span class="selector-class">.error</span> <span class="selector-class">.aside-list</span> <span class="selector-class">.aside-list-item</span> <span class="selector-class">.content</span> <span class="selector-tag">time</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* 代码框主题 */</span></span><br><span class="line">  <span class="selector-id">#article-container</span> <span class="selector-tag">figure</span><span class="selector-class">.highlight</span> &#123;</span><br><span class="line">    <span class="attribute">border-radius</span>:<span class="number">10px</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>不需要一图流就删除下面代码</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 页脚透明 */</span></span><br><span class="line"><span class="selector-id">#footer</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 头图透明 */</span></span><br><span class="line"><span class="selector-id">#page-header</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在butterfly配置文件里找到inject添加下面代码</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="comment"># - &lt;link rel=&quot;stylesheet&quot; href=&quot;/xxx.css&quot;&gt;</span></span><br><span class="line">    <span class="comment"># 自定义css</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/custom.css&quot;</span> <span class="string">media=&quot;defer&quot;</span> <span class="string">onload=&quot;this.media=&#x27;all&#x27;&quot;&gt;</span></span><br></pre></td></tr></table></figure><p>然后在这个配置文件里找background添加路径</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">background:</span> <span class="string">/img/background.png</span></span><br></pre></td></tr></table></figure><p>如果本地部署没问题但是服务器有问题，就在config里设置url，设置成自己的github.io</p><p><img src="/./images/%E5%8D%9A%E5%AE%A2/image-20260203005249715.png" alt="image-20260203005249715"></p><h1 id="字数统计"><a href="#字数统计" class="headerlink" title="字数统计"></a>字数统计</h1><p>安装插件：在你的博客根目录，打开cmd命令窗口执行<code>npm install hexo-wordcount --save</code></p><p>开启配置：修改主题配置文件<code>_config.butterfly.yml</code>中的<code>wordcount</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wordcount:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">post_wordcount:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">min2read:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_wordcount:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> 博客 </tag>
            
            <tag> 教程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/posts/4a17b156.html"/>
      <url>/posts/4a17b156.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>老杜MyBatis</title>
      <link href="/posts/d2dc75e3.html"/>
      <url>/posts/d2dc75e3.html</url>
      
        <content type="html"><![CDATA[<h1 id=""><a href="#" class="headerlink" title=""></a><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#averageHue=#dad8d7&clientId=u6b7aa99c-2be4-4&from=paste&id=wdOV9&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></h1><h1 id="一、MyBatis概述"><a href="#一、MyBatis概述" class="headerlink" title="一、MyBatis概述"></a>一、MyBatis概述</h1><h2 id="1-1-框架"><a href="#1-1-框架" class="headerlink" title="1.1 框架"></a>1.1 框架</h2><ul><li>在文献中看到的framework被翻译为框架</li><li>Java常用框架：<ul><li>SSM三大框架：Spring + SpringMVC + MyBatis</li><li>SpringBoot</li><li>SpringCloud</li><li>等。。</li></ul></li><li>框架其实就是对通用代码的封装，提前写好了一堆接口和类，我们可以在做项目的时候直接引入这些接口和类（引入框架），基于这些现有的接口和类进行开发，可以大大提高开发效率。</li><li>框架一般都以jar包的形式存在。(jar包中有class文件以及各种配置文件等。)</li><li>SSM三大框架的学习顺序：MyBatis、Spring、SpringMVC（仅仅是建议）</li></ul><h2 id="1-2-三层架构"><a href="#1-2-三层架构" class="headerlink" title="1.2 三层架构"></a>1.2 三层架构</h2><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659575815289-a76d30d9-f072-483a-bda7-b1fc8afc6f82.png#averageHue=#d3d9de&clientId=u6b7aa99c-2be4-4&from=paste&height=430&id=u14695784&originHeight=804&originWidth=1448&originalType=binary&ratio=1&rotation=0&showTitle=false&size=95422&status=done&style=shadow&taskId=ufba163d4-60f2-4941-b75a-4c34720010f&title=&width=775" alt="三层架构.png"></p><ul><li>表现层（UI）：直接跟前端打交互（一是接收前端ajax请求，二是返回json数据给前端）</li><li>业务逻辑层（BLL）：一是处理表现层转发过来的前端请求（也就是具体业务），二是将从持久层获取的数据返回到表现层。</li><li>数据访问层（DAL）：直接操作数据库完成CRUD，并将获得的数据返回到上一层（也就是业务逻辑层）。</li><li>Java持久层框架：<ul><li>MyBatis</li><li>Hibernate（实现了JPA规范）</li><li>jOOQ</li><li>Guzz</li><li>Spring Data（实现了JPA规范）</li><li>ActiveJDBC</li><li>……</li></ul></li></ul><h2 id="1-3-JDBC不足"><a href="#1-3-JDBC不足" class="headerlink" title="1.3 JDBC不足"></a>1.3 JDBC不足</h2><ul><li>示例代码1：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ......</span></span><br><span class="line"><span class="comment">// sql语句写死在java程序中</span></span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_user(id,idCard,username,password,birth,gender,email,city,street,zipcode,phone,grade) values(?,?,?,?,?,?,?,?,?,?,?,?)&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line"><span class="comment">// 繁琐的赋值：思考一下，这种有规律的代码能不能通过反射机制来做自动化。</span></span><br><span class="line">ps.setString(<span class="number">1</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">2</span>, <span class="string">&quot;123456789&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">3</span>, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">4</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">5</span>, <span class="string">&quot;1980-10-11&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">6</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">7</span>, <span class="string">&quot;zhangsan@126.com&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">8</span>, <span class="string">&quot;北京&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">9</span>, <span class="string">&quot;大兴区凉水河二街&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">10</span>, <span class="string">&quot;1000000&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">11</span>, <span class="string">&quot;16398574152&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">12</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line"><span class="comment">// 执行SQL</span></span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> ps.executeUpdate();</span><br><span class="line"><span class="comment">// ......</span></span><br></pre></td></tr></table></figure><ul><li>示例代码2：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ......</span></span><br><span class="line"><span class="comment">// sql语句写死在java程序中</span></span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select id,idCard,username,password,birth,gender,email,city,street,zipcode,phone,grade from t_user&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> ps.executeQuery();</span><br><span class="line">List&lt;User&gt; userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// 思考以下循环中的所有代码是否可以使用反射进行自动化封装。</span></span><br><span class="line"><span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">    <span class="comment">// 获取数据</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">idCard</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;idCard&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">birth</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;birth&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">gender</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;gender&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">city</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;city&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">street</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;street&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">zipcode</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;zipcode&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;phone&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">grade</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;grade&quot;</span>);</span><br><span class="line">    <span class="comment">// 创建对象</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    <span class="comment">// 给对象属性赋值</span></span><br><span class="line">    user.setId(id);</span><br><span class="line">    user.setIdCard(idCard);</span><br><span class="line">    user.setUsername(username);</span><br><span class="line">    user.setPassword(password);</span><br><span class="line">    user.setBirth(birth);</span><br><span class="line">    user.setGender(gender);</span><br><span class="line">    user.setEmail(email);</span><br><span class="line">    user.setCity(city);</span><br><span class="line">    user.setStreet(street);</span><br><span class="line">    user.setZipcode(zipcode);</span><br><span class="line">    user.setPhone(phone);</span><br><span class="line">    user.setGrade(grade);</span><br><span class="line">    <span class="comment">// 添加到集合</span></span><br><span class="line">    userList.add(user);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ......</span></span><br></pre></td></tr></table></figure><ul><li>JDBC不足：<ul><li>SQL语句写死在Java程序中，不灵活。改SQL的话就要改Java代码。违背开闭原则OCP。</li><li>给?传值是繁琐的。能不能自动化？？？</li><li>将结果集封装成Java对象是繁琐的。能不能自动化？？？</li></ul></li></ul><h2 id="1-4-了解MyBatis"><a href="#1-4-了解MyBatis" class="headerlink" title="1.4 了解MyBatis"></a>1.4 了解MyBatis</h2><ul><li>MyBatis本质上就是对JDBC的封装，通过MyBatis完成CRUD。</li><li>MyBatis在三层架构中负责持久层的，属于持久层框架。</li><li>MyBatis的发展历程：【引用百度百科】<ul><li>MyBatis本是apache的一个开源项目iBatis，2010年这个项目由apache software foundation迁移到了google code，并且改名为MyBatis。2013年11月迁移到Github。</li><li>iBATIS一词来源于“internet”和“abatis”的组合，是一个基于Java的持久层框架。iBATIS提供的持久层框架包括SQL Maps和Data Access Objects（DAOs）。</li></ul></li><li>打开mybatis代码可以看到它的包结构中包含：ibatis<ul><li><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659580495482-02167fb7-a183-4337-bfbe-f9ab50e736d6.png#averageHue=#e8c273&clientId=u6b7aa99c-2be4-4&from=paste&height=146&id=u383be560&originHeight=146&originWidth=427&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5675&status=done&style=none&taskId=uc32d6afd-346b-4151-8933-728a4a66a30&title=&width=427" alt="42857443-5184-45b5-8AD4-2B281C88A8CC.png"></li></ul></li><li>ORM：对象关系映射<ul><li>O（Object）：Java虚拟机中的Java对象</li><li>R（Relational）：关系型数据库</li><li>M（Mapping）：将Java虚拟机中的Java对象映射到数据库表中一行记录，或是将数据库表中一行记录映射成Java虚拟机中的一个Java对象。</li><li>ORM图示<ul><li><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659580953095-86e388ac-13b5-4448-b90a-2aacd36688ef.png#averageHue=#d7d9d2&clientId=u6b7aa99c-2be4-4&from=paste&height=200&id=uebaeb73c&originHeight=200&originWidth=579&originalType=binary&ratio=1&rotation=0&showTitle=false&size=98143&status=done&style=none&taskId=ua834ac11-2f7e-406c-9c58-d7665141cb3&title=&width=579" alt="C48A1A89-244D-40f4-85DB-F1E665A2EA62.png"></li><li><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659580965550-87c43dee-f1c4-4bdd-b15e-14f831b3d0da.png#averageHue=#efa67e&clientId=u6b7aa99c-2be4-4&from=paste&height=333&id=u6c63cd39&originHeight=333&originWidth=465&originalType=binary&ratio=1&rotation=0&showTitle=false&size=92293&status=done&style=none&taskId=u65b49126-aa66-4916-8c8f-7799b39c26c&title=&width=465" alt="A21555BB-55B7-4d7c-8AB0-F49B10E96BD3.png"></li></ul></li><li>MyBatis属于半自动化ORM框架。</li><li>Hibernate属于全自动化的ORM框架。</li></ul></li><li>MyBatis框架特点：<ul><li>支持定制化 SQL、存储过程、基本映射以及高级映射</li><li>避免了几乎所有的 JDBC 代码中手动设置参数以及获取结果集</li><li>支持XML开发，也支持注解式开发。【为了保证sql语句的灵活，所以mybatis大部分是采用XML方式开发。】</li><li>将接口和 Java 的 POJOs(Plain Ordinary Java Object，简单普通的Java对象)映射成数据库中的记录</li><li>体积小好学：两个jar包，两个XML配置文件。</li><li>完全做到sql解耦合。</li><li>提供了基本映射标签。</li><li>提供了高级映射标签。</li><li>提供了XML标签，支持动态SQL的编写。</li><li>……</li></ul></li></ul><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#averageHue=#dad8d7&clientId=u6b7aa99c-2be4-4&from=paste&id=ddeIZ&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p><h1 id="二、MyBatis入门程序"><a href="#二、MyBatis入门程序" class="headerlink" title="二、MyBatis入门程序"></a>二、MyBatis入门程序</h1><p>只要你会JDBC，MyBatis就可以学。</p><h2 id="2-1-版本"><a href="#2-1-版本" class="headerlink" title="2.1 版本"></a>2.1 版本</h2><h3 id="软件版本："><a href="#软件版本：" class="headerlink" title="软件版本："></a>软件版本：</h3><ul><li>IntelliJ IDEA：2022.1.4</li><li>Navicat for MySQL：16.0.14</li><li>MySQL数据库：8.0.30</li></ul><h3 id="组件版本："><a href="#组件版本：" class="headerlink" title="组件版本："></a>组件版本：</h3><ul><li>MySQL驱动：8.0.30</li><li>MyBatis：3.5.10</li><li>JDK：Java17</li><li>JUnit：4.13.2</li><li>Logback：1.2.11</li></ul><h2 id="2-2-MyBatis下载"><a href="#2-2-MyBatis下载" class="headerlink" title="2.2 MyBatis下载"></a>2.2 MyBatis下载</h2><ul><li>从github上下载，地址：<a href="https://github.com/mybatis/mybatis-3">https://github.com/mybatis/mybatis-3</a><ul><li><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659582991347-ee21a960-e4ae-45a0-83cf-74b3f1f3825c.png#averageHue=#f7f5f4&clientId=u6b7aa99c-2be4-4&from=paste&height=583&id=u79fa1b52&originHeight=583&originWidth=895&originalType=binary&ratio=1&rotation=0&showTitle=false&size=52133&status=done&style=none&taskId=u6d588ea3-579a-43ba-a3e5-47f665a9063&title=&width=895" alt="2FFBA369-A41E-4b17-81C5-68A18B8A428F.png"></li><li><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659583157781-fd860428-d25b-4c4c-9e68-0219de7d3ba9.png#averageHue=#fefbfb&clientId=u6b7aa99c-2be4-4&from=paste&height=764&id=u173d560e&originHeight=764&originWidth=909&originalType=binary&ratio=1&rotation=0&showTitle=false&size=61215&status=done&style=none&taskId=u328f6d3e-c76d-41c2-af07-e4cbaef3550&title=&width=909" alt="0D36080D-53BB-42ac-9E19-26260818134E.png"></li></ul></li><li>将框架以及框架的源码都下载下来，下载框架后解压，打开mybatis目录<ul><li><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659583275291-4ba5ba90-5420-449e-97f4-2ec759c994ca.png#averageHue=#fcf3f1&clientId=u6b7aa99c-2be4-4&from=paste&height=121&id=u45bb9d9a&originHeight=121&originWidth=249&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5298&status=done&style=none&taskId=u2c199df7-1df7-48e9-b3f4-6354160cf01&title=&width=249" alt="55C87E1A-E3AA-414f-9281-CE7D5702EA17.png"></li><li>通过以上解压可以看到，框架一般都是以jar包的形式存在。我们的mybatis课程使用maven，所以这个jar我们不需要。</li><li>官方手册需要。</li></ul></li></ul><h2 id="2-3-MyBatis入门程序开发步骤"><a href="#2-3-MyBatis入门程序开发步骤" class="headerlink" title="2.3 MyBatis入门程序开发步骤"></a>2.3 MyBatis入门程序开发步骤</h2><ul><li>写代码前准备：<ul><li>准备数据库表：汽车表t_car，字段包括：<ul><li>id：主键（自增）【bigint】</li><li>car_num：汽车编号【varchar】</li><li>brand：品牌【varchar】</li><li>guide_price：厂家指导价【decimal类型，专门为财务数据准备的类型】</li><li>produce_time：生产时间【char，年月日即可，10个长度，’2022-10-11’】</li><li>car_type：汽车类型（燃油车、电车、氢能源）【varchar】</li></ul></li><li>使用navicat for mysql工具建表<ul><li><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659596348287-5876735d-ba3b-43d2-9e73-1c4bdb29e8b5.png#averageHue=#f7f6f5&clientId=u6b7aa99c-2be4-4&from=paste&height=288&id=u664bee8c&originHeight=288&originWidth=960&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18316&status=done&style=none&taskId=udecdafbb-71bd-4e05-b034-f1a2f812112&title=&width=960" alt="16B6D507-440F-460f-9D1F-39653A3B6EC2.png"></li></ul></li><li>使用navicat for mysql工具向t_car表中插入两条数据，如下：<ul><li><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659596615335-60a93468-5a9e-48b8-acb7-cb4be313b8f1.png#averageHue=#f5f3f2&clientId=u6b7aa99c-2be4-4&from=paste&height=170&id=u8c4dc450&originHeight=170&originWidth=566&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9743&status=done&style=none&taskId=ua73fd204-98f9-4141-85f1-53e5ef0e674&title=&width=566" alt="7E8510B9-9886-41c9-9495-0AE7888560B9.png"></li></ul></li><li>创建Project：建议创建Empty Project，设置Java版本以及编译版本等。<ul><li><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659585665160-94c930e0-611c-46fa-b87d-aa9489ec85c8.png#averageHue=#3d4144&clientId=u6b7aa99c-2be4-4&from=paste&height=604&id=uabae2fee&originHeight=604&originWidth=782&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25720&status=done&style=none&taskId=u0f32e2ca-e7a1-4982-894f-73729a33c21&title=&width=782" alt="52176FB4-6DB5-4264-8940-34A3506C2A0C.png"></li><li><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659585756219-b17df6ac-8bb8-4d3e-bd4b-44f5d41c41c0.png#averageHue=#3d4146&clientId=u6b7aa99c-2be4-4&from=paste&height=383&id=u97e3ab74&originHeight=383&originWidth=750&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19995&status=done&style=none&taskId=u2debb595-ca67-40c5-a1f8-c7ad79a72b4&title=&width=750" alt="1C8EB1AF-0465-4e2d-816A-B7FFBA2E42C4.png"></li></ul></li><li>设置IDEA的maven<ul><li><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659586287914-4b6d4e74-f5f4-4800-901e-04f017d65ce0.png#averageHue=#3d4246&clientId=u6b7aa99c-2be4-4&from=paste&height=701&id=u3b9af48c&originHeight=701&originWidth=977&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39072&status=done&style=none&taskId=uba85744a-5efc-48cd-8461-f8df0fc000c&title=&width=977" alt="3EA79931-EE2C-46f4-BDB2-6AB99EDFCA87.png"></li></ul></li><li>创建Module：普通的Maven Java模块<ul><li><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659586416938-a08b3128-4232-425b-a4a0-958956c52bc8.png#averageHue=#3d4144&clientId=u6b7aa99c-2be4-4&from=paste&height=603&id=ua350e75f&originHeight=603&originWidth=779&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30514&status=done&style=none&taskId=u99122205-9b44-42de-a7c4-ae6d927c61c&title=&width=779" alt="8F6F3B34-B1F7-4fcb-9584-AF629200534F.png"></li></ul></li></ul></li><li>步骤1：打包方式：jar（不需要war，因为mybatis封装的是jdbc。）</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.powernode<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-001-introduction<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--打包方式jar--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>步骤2：引入依赖（mybatis依赖 + mysql驱动依赖）</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis核心依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mysql驱动依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>步骤3：编写mybatis核心配置文件， 在resources根目录下新建mybatis-config.xml配置文件（可以参考mybatis手册拷贝），这个文件名称和位置不是固定的，一般情况是放在类的根路径下（resources里的东西都属于类根路径）</p><p>另一个核心配置文件是xxxMapper.xml，在这个配置文件当中编写SQL语句（一表一个）。</p><ul><li>比如t_user表会对应一个UserMapper.xml</li></ul><p>以下是mybatis-config.xml</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/powernode&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--sql映射文件创建好之后，需要将该文件路径配置到这里，resource是从类根路径开始查找--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;CarMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意1：mybatis核心配置文件的文件名不一定是mybatis-config.xml，可以是其它名字。<br>注意2：mybatis核心配置文件存放的位置也可以随意。这里选择放在resources根下，相当于放到了类的根路径下。</p><ul><li>步骤4：在resources根目录下新建CarMapper.xml配置文件（可以参考mybatis手册拷贝）</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--namespace命名空间先随意写一个--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--insert语句，id是这条SQL语句的唯一标识。这个id就代表了这条SQL语句。--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertCar&quot;</span>&gt;</span></span><br><span class="line">        insert into t_car</span><br><span class="line">            (id,car_num,brand,guide_price,produce_time,car_type) </span><br><span class="line">        values</span><br><span class="line">            (null,&#x27;102&#x27;,&#x27;丰田mirai&#x27;,40.30,&#x27;2014-10-05&#x27;,&#x27;氢能源&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意1：<strong>sql语句最后结尾可以不写“;”</strong><br>注意2：CarMapper.xml文件的名字不是固定的。可以使用其它名字。<br>注意3：CarMapper.xml文件的位置也是随意的。这里选择放在resources根下，相当于放到了类的根路径下。<br>注意4：将CarMapper.xml文件路径配置到mybatis-config.xml：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;CarMapper.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>步骤5：编写MyBatisIntroductionTest代码</p><p>在MyBatis当中，负责执行SQL语句的那个对象叫做SqlSession，<br>SqlSession是专门用来执行SQL语句的，是一个Java程序和数据库之间的一次会话。<br>要想获取SqlSession对象，需要先获取SqlSessionFactory对象，通过SqlSessionFactory工厂来生产SqlSession对象。<br>怎么获取SqlSessionFactory对象呢？<br>    需要首先获取SqlSessionFactoryBuilder对象。<br>    通过SqlSessionFactoryBuilder对象的build方法，来获取一个SqlSessionFactory对象。<br>mybatis的核心对象包括：</p><ol><li>​    SqlSessionFactoryBuilder</li><li>​    SqlSessionFactory</li><li>​    SqlSession</li></ol><p>顺序是：SqlSessionFactoryBuilder –&gt; SqlSessionFactory –&gt; SqlSession</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MyBatis入门程序</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisIntroductionTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 创建SqlSessionFactoryBuilder对象</span></span><br><span class="line">        <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line">        <span class="comment">// 2. 创建SqlSessionFactory对象，build里需要传入一个输入流，这个输入流指向mybatis-config.xml</span></span><br><span class="line">        <span class="comment">//Resources是mybatis的工具类，Resources.getResourceAsStream默认就是从类的根路径下开始查找资源。</span></span><br><span class="line">        <span class="comment">//InputStream is = Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;);</span></span><br><span class="line">        <span class="comment">//通过系统类加载器调用getResourceAsStream</span></span><br><span class="line">        <span class="comment">//InputStream is = ClassLoader.getSystemClassLoader().getResourceAsStream(&quot;mybatis-config.xml&quot;);</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader().getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(is);</span><br><span class="line">        <span class="comment">// 3. 创建SqlSession对象，执行openSession返回SqlSession，如果使用的事务管理器是JDBC的话，底层实际上会执行:conn.setAutocommit(false);</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">        <span class="comment">// 4. 执行sql</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> sqlSession.insert(<span class="string">&quot;insertCar&quot;</span>); <span class="comment">// 这个&quot;insertCar&quot;必须是sql的id，返回值是影响数据库表当中的记录条数:</span></span><br><span class="line">        System.out.println(<span class="string">&quot;插入几条数据：&quot;</span> + count);</span><br><span class="line">        <span class="comment">// 5. 提交（mybatis默认采用的事务管理器是JDBC，默认是不提交的，需要手动提交。）</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        <span class="comment">// 6. 关闭资源（只关闭是不会提交的）</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关于第一个程序的小细节:</p><ul><li>mybatis中sql语句的结尾”;”可以省略。</li><li>Resources.getResourceAsStream<ul><li>小技巧：以后凡是遇到resource这个单词，大部分情况下，这种加载资源的方式就是从类的根路径下开始加载。（开始查找）</li><li>优点：采用这种方式，从类路径当中加载资源，项目的移植性很强。项目从windows移植到linux，代码不需要修改，因为这个资源文件一直都在类路径当中。</li></ul></li><li>InputStream is &#x3D; new FileInputStream(“d:\mybatis-config.xml”);采用这种方式也可以。<br>   缺点：可移植性太差，程序不够健壮。可能会移植到其他的操作系统当中。导致以上路径无效，还需要修改java代码中的路径。这样违背了OCP原则。</li><li>CarMapper.xml文件的路径都不是固定的。<ul><li><mapper resource="CarMapper.xml"/> resource属性：这种方式是从类路径当中加载资源。</li><li><mapper url="file:///d:/CarMapper.xml"/> url属性：这种方式是从绝对路径当中加载资源。</li></ul></li></ul><p>注意1：默认采用的事务管理器是：JDBC。JDBC事务默认是不提交的，需要手动提交。</p><p>关于mybatis的事务管理机制。（深度剖析）：</p><ul><li><p>在mybatis-config.xml文件中，可以通过以下的配置进行mybatis的事务管理<transactionManager type="JDBC"/></p></li><li><p>type属性的值包括两个： </p><ul><li>JDBC(jdbc)：JDBC事务管理器</li><li>MANAGED(managed)：MANAGED事务管理器<br>type后面的值，只有以上两个值可选，不区分大小写。</li></ul></li><li><p>JDBC事务管理器：<br>    mybatis框架自己管理事务，自己采用原生的JDBC代码去管理事务：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conn.setAutoCommit(false); 开启事务。</span><br><span class="line">....业务处理...</span><br><span class="line">conn.commit(); 手动提交事务</span><br></pre></td></tr></table></figure><p>使用JDBC事务管理器的话，底层创建的事务管理器对象：JdbcTransaction对象。</p></li></ul><p>（看老杜源码剖析）如果你编写的代码是下面的代码就表示没有开启事务。因为这种方式压根不会执行conn.setAutoCommit(false);</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p>在JDBC事务中，如果你没有在JDBC代码中执行：conn.setAutoCommit(false);的话，默认的autoCommit是true。</p><p>**重点：**如果autoCommit是true，就表示没有开启事务。只要执行任意一条DML语句就提交一次。只有你的autoCommit是false的时候，就表示开启了事务。</p><ul><li><p>MANAGED事务管理器：</p><p>mybatis不再负责事务的管理了。事务管理交给其它容器来负责。例如：spring。也就是让spring负责事务</p><p>对于我们当前的单纯的只有mybatis的情况下，如果配置为：MANAGED</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;MANAGED&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>那么事务这块是没人管的。没有人管理事务表示事务压根没有开启。没有人管理事务就是没有事务。</p></li><li><p>步骤6：运行程序，查看运行结果，以及数据库表中的数据</p><ul><li><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659599289005-00bae72a-c64f-41b5-9b87-162f8958efa5.png#averageHue=#998366&clientId=u6b7aa99c-2be4-4&from=paste&height=171&id=u1f6e97f2&originHeight=171&originWidth=458&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9426&status=done&style=none&taskId=u004b6ae8-ff94-42f0-bf96-9acc738af9d&title=&width=458" alt="211D2E7E-E62B-413a-9710-72AC1EC7D894.png"></li><li><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659599334361-3c2733c1-29d5-474c-a217-552ec331b523.png#averageHue=#f4f3f1&clientId=u6b7aa99c-2be4-4&from=paste&height=189&id=u5cad9434&originHeight=189&originWidth=611&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11487&status=done&style=none&taskId=u065d7ebf-be3a-4f82-8bae-c9c4550558c&title=&width=611" alt="2A4C1E6E-56B8-440e-A368-F10434EACC2D.png"></li></ul></li></ul><h2 id="2-5-MyBatis第一个比较完整的代码写法"><a href="#2-5-MyBatis第一个比较完整的代码写法" class="headerlink" title="2.5 MyBatis第一个比较完整的代码写法"></a>2.5 MyBatis第一个比较完整的代码写法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 比较完整的第一个mybatis程序写法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisCompleteCodeTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.创建SqlSessionFactoryBuilder对象</span></span><br><span class="line">            <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line">            <span class="comment">// 2.创建SqlSessionFactory对象</span></span><br><span class="line">            <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">            <span class="comment">// 3.创建SqlSession对象</span></span><br><span class="line">            sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">            <span class="comment">// 4.执行SQL</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> sqlSession.insert(<span class="string">&quot;insertCar&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;更新了几条记录：&quot;</span> + count);</span><br><span class="line">            <span class="comment">// 5.提交</span></span><br><span class="line">            sqlSession.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// 回滚</span></span><br><span class="line">            <span class="keyword">if</span> (sqlSession != <span class="literal">null</span>) &#123;</span><br><span class="line">                sqlSession.rollback();</span><br><span class="line">            &#125;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 6.关闭</span></span><br><span class="line">            <span class="keyword">if</span> (sqlSession != <span class="literal">null</span>) &#123;</span><br><span class="line">                sqlSession.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行后数据库表的变化：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659604100979-edc9b06f-93bb-4c55-880b-38e219d9d9e3.png#averageHue=#f3f1ef&clientId=u6b7aa99c-2be4-4&from=paste&height=206&id=u4da72fe6&originHeight=206&originWidth=590&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13721&status=done&style=none&taskId=u6651710f-a20b-4007-b39b-0a2f73d81c6&title=&width=590" alt="EC983E7A-7A85-4df7-B5FC-5C4FDC8EA592.png"></p><h2 id="2-6-引入JUnit"><a href="#2-6-引入JUnit" class="headerlink" title="2.6 引入JUnit"></a>2.6 引入JUnit</h2><ul><li>JUnit是专门做单元测试的组件，在test文件夹执行。<ul><li><p>在实际开发中，单元测试一般是由我们Java程序员来完成的。</p></li><li><p>我们要对我们自己写的每一个业务方法负责任，要保证每个业务方法在进行测试的时候都能通过。</p></li><li><p>测试的过程中涉及到两个概念：</p><ul><li>期望值</li><li>实际值</li></ul></li><li><pre><code class="language-java"> @Test public void testSum(){     MathService mathService =new MathService();     // 获取实际值     int actual = mathService.sum(1, 2);     // 期望值     int expected = 3;     // 加断言进行测试     Assert.assertEquals(expected, actual); } <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br><span class="line">1865</span><br><span class="line">1866</span><br><span class="line">1867</span><br><span class="line">1868</span><br><span class="line">1869</span><br><span class="line">1870</span><br><span class="line">1871</span><br><span class="line">1872</span><br><span class="line">1873</span><br><span class="line">1874</span><br><span class="line">1875</span><br><span class="line">1876</span><br><span class="line">1877</span><br><span class="line">1878</span><br><span class="line">1879</span><br><span class="line">1880</span><br><span class="line">1881</span><br><span class="line">1882</span><br><span class="line">1883</span><br><span class="line">1884</span><br><span class="line">1885</span><br><span class="line">1886</span><br><span class="line">1887</span><br><span class="line">1888</span><br><span class="line">1889</span><br><span class="line">1890</span><br><span class="line">1891</span><br><span class="line">1892</span><br><span class="line">1893</span><br><span class="line">1894</span><br><span class="line">1895</span><br><span class="line">1896</span><br><span class="line">1897</span><br><span class="line">1898</span><br><span class="line">1899</span><br><span class="line">1900</span><br><span class="line">1901</span><br><span class="line">1902</span><br><span class="line">1903</span><br><span class="line">1904</span><br><span class="line">1905</span><br><span class="line">1906</span><br><span class="line">1907</span><br><span class="line">1908</span><br><span class="line">1909</span><br><span class="line">1910</span><br><span class="line">1911</span><br><span class="line">1912</span><br><span class="line">1913</span><br><span class="line">1914</span><br><span class="line">1915</span><br><span class="line">1916</span><br><span class="line">1917</span><br><span class="line">1918</span><br><span class="line">1919</span><br><span class="line">1920</span><br><span class="line">1921</span><br><span class="line">1922</span><br><span class="line">1923</span><br><span class="line">1924</span><br><span class="line">1925</span><br><span class="line">1926</span><br><span class="line">1927</span><br><span class="line">1928</span><br><span class="line">1929</span><br><span class="line">1930</span><br><span class="line">1931</span><br><span class="line">1932</span><br><span class="line">1933</span><br><span class="line">1934</span><br><span class="line">1935</span><br><span class="line">1936</span><br><span class="line">1937</span><br><span class="line">1938</span><br><span class="line">1939</span><br><span class="line">1940</span><br><span class="line">1941</span><br><span class="line">1942</span><br><span class="line">1943</span><br><span class="line">1944</span><br><span class="line">1945</span><br><span class="line">1946</span><br><span class="line">1947</span><br><span class="line">1948</span><br><span class="line">1949</span><br><span class="line">1950</span><br><span class="line">1951</span><br><span class="line">1952</span><br><span class="line">1953</span><br><span class="line">1954</span><br><span class="line">1955</span><br><span class="line">1956</span><br><span class="line">1957</span><br><span class="line">1958</span><br><span class="line">1959</span><br><span class="line">1960</span><br><span class="line">1961</span><br><span class="line">1962</span><br><span class="line">1963</span><br><span class="line">1964</span><br><span class="line">1965</span><br><span class="line">1966</span><br><span class="line">1967</span><br><span class="line">1968</span><br><span class="line">1969</span><br><span class="line">1970</span><br><span class="line">1971</span><br><span class="line">1972</span><br><span class="line">1973</span><br><span class="line">1974</span><br><span class="line">1975</span><br><span class="line">1976</span><br><span class="line">1977</span><br><span class="line">1978</span><br><span class="line">1979</span><br><span class="line">1980</span><br><span class="line">1981</span><br><span class="line">1982</span><br><span class="line">1983</span><br><span class="line">1984</span><br><span class="line">1985</span><br><span class="line">1986</span><br><span class="line">1987</span><br><span class="line">1988</span><br><span class="line">1989</span><br><span class="line">1990</span><br><span class="line">1991</span><br><span class="line">1992</span><br><span class="line">1993</span><br><span class="line">1994</span><br><span class="line">1995</span><br><span class="line">1996</span><br><span class="line">1997</span><br><span class="line">1998</span><br><span class="line">1999</span><br><span class="line">2000</span><br><span class="line">2001</span><br><span class="line">2002</span><br><span class="line">2003</span><br><span class="line">2004</span><br><span class="line">2005</span><br><span class="line">2006</span><br><span class="line">2007</span><br><span class="line">2008</span><br><span class="line">2009</span><br><span class="line">2010</span><br><span class="line">2011</span><br><span class="line">2012</span><br><span class="line">2013</span><br><span class="line">2014</span><br><span class="line">2015</span><br><span class="line">2016</span><br><span class="line">2017</span><br><span class="line">2018</span><br><span class="line">2019</span><br><span class="line">2020</span><br><span class="line">2021</span><br><span class="line">2022</span><br><span class="line">2023</span><br><span class="line">2024</span><br><span class="line">2025</span><br><span class="line">2026</span><br><span class="line">2027</span><br><span class="line">2028</span><br><span class="line">2029</span><br><span class="line">2030</span><br><span class="line">2031</span><br><span class="line">2032</span><br><span class="line">2033</span><br><span class="line">2034</span><br><span class="line">2035</span><br><span class="line">2036</span><br><span class="line">2037</span><br><span class="line">2038</span><br><span class="line">2039</span><br><span class="line">2040</span><br><span class="line">2041</span><br><span class="line">2042</span><br><span class="line">2043</span><br><span class="line">2044</span><br><span class="line">2045</span><br><span class="line">2046</span><br><span class="line">2047</span><br><span class="line">2048</span><br><span class="line">2049</span><br><span class="line">2050</span><br><span class="line">2051</span><br><span class="line">2052</span><br><span class="line">2053</span><br><span class="line">2054</span><br><span class="line">2055</span><br><span class="line">2056</span><br><span class="line">2057</span><br><span class="line">2058</span><br><span class="line">2059</span><br><span class="line">2060</span><br><span class="line">2061</span><br><span class="line">2062</span><br><span class="line">2063</span><br><span class="line">2064</span><br><span class="line">2065</span><br><span class="line">2066</span><br><span class="line">2067</span><br><span class="line">2068</span><br><span class="line">2069</span><br><span class="line">2070</span><br><span class="line">2071</span><br><span class="line">2072</span><br><span class="line">2073</span><br><span class="line">2074</span><br><span class="line">2075</span><br><span class="line">2076</span><br><span class="line">2077</span><br><span class="line">2078</span><br><span class="line">2079</span><br><span class="line">2080</span><br><span class="line">2081</span><br><span class="line">2082</span><br><span class="line">2083</span><br><span class="line">2084</span><br><span class="line">2085</span><br><span class="line">2086</span><br><span class="line">2087</span><br><span class="line">2088</span><br><span class="line">2089</span><br><span class="line">2090</span><br><span class="line">2091</span><br><span class="line">2092</span><br><span class="line">2093</span><br><span class="line">2094</span><br><span class="line">2095</span><br><span class="line">2096</span><br><span class="line">2097</span><br><span class="line">2098</span><br><span class="line">2099</span><br><span class="line">2100</span><br><span class="line">2101</span><br><span class="line">2102</span><br><span class="line">2103</span><br><span class="line">2104</span><br><span class="line">2105</span><br><span class="line">2106</span><br><span class="line">2107</span><br><span class="line">2108</span><br><span class="line">2109</span><br><span class="line">2110</span><br><span class="line">2111</span><br><span class="line">2112</span><br><span class="line">2113</span><br><span class="line">2114</span><br><span class="line">2115</span><br><span class="line">2116</span><br><span class="line">2117</span><br><span class="line">2118</span><br><span class="line">2119</span><br><span class="line">2120</span><br><span class="line">2121</span><br><span class="line">2122</span><br><span class="line">2123</span><br><span class="line">2124</span><br><span class="line">2125</span><br><span class="line">2126</span><br><span class="line">2127</span><br><span class="line">2128</span><br><span class="line">2129</span><br><span class="line">2130</span><br><span class="line">2131</span><br><span class="line">2132</span><br><span class="line">2133</span><br><span class="line">2134</span><br><span class="line">2135</span><br><span class="line">2136</span><br><span class="line">2137</span><br><span class="line">2138</span><br><span class="line">2139</span><br><span class="line">2140</span><br><span class="line">2141</span><br><span class="line">2142</span><br><span class="line">2143</span><br><span class="line">2144</span><br><span class="line">2145</span><br><span class="line">2146</span><br><span class="line">2147</span><br><span class="line">2148</span><br><span class="line">2149</span><br><span class="line">2150</span><br><span class="line">2151</span><br><span class="line">2152</span><br><span class="line">2153</span><br><span class="line">2154</span><br><span class="line">2155</span><br><span class="line">2156</span><br><span class="line">2157</span><br><span class="line">2158</span><br><span class="line">2159</span><br><span class="line">2160</span><br><span class="line">2161</span><br><span class="line">2162</span><br><span class="line">2163</span><br><span class="line">2164</span><br><span class="line">2165</span><br><span class="line">2166</span><br><span class="line">2167</span><br><span class="line">2168</span><br><span class="line">2169</span><br><span class="line">2170</span><br><span class="line">2171</span><br><span class="line">2172</span><br><span class="line">2173</span><br><span class="line">2174</span><br><span class="line">2175</span><br><span class="line">2176</span><br><span class="line">2177</span><br><span class="line">2178</span><br><span class="line">2179</span><br><span class="line">2180</span><br><span class="line">2181</span><br><span class="line">2182</span><br><span class="line">2183</span><br><span class="line">2184</span><br><span class="line">2185</span><br><span class="line">2186</span><br><span class="line">2187</span><br><span class="line">2188</span><br><span class="line">2189</span><br><span class="line">2190</span><br><span class="line">2191</span><br><span class="line">2192</span><br><span class="line">2193</span><br><span class="line">2194</span><br><span class="line">2195</span><br><span class="line">2196</span><br><span class="line">2197</span><br><span class="line">2198</span><br><span class="line">2199</span><br><span class="line">2200</span><br><span class="line">2201</span><br><span class="line">2202</span><br><span class="line">2203</span><br><span class="line">2204</span><br><span class="line">2205</span><br><span class="line">2206</span><br><span class="line">2207</span><br><span class="line">2208</span><br><span class="line">2209</span><br><span class="line">2210</span><br><span class="line">2211</span><br><span class="line">2212</span><br><span class="line">2213</span><br><span class="line">2214</span><br><span class="line">2215</span><br><span class="line">2216</span><br><span class="line">2217</span><br><span class="line">2218</span><br><span class="line">2219</span><br><span class="line">2220</span><br><span class="line">2221</span><br><span class="line">2222</span><br><span class="line">2223</span><br><span class="line">2224</span><br><span class="line">2225</span><br><span class="line">2226</span><br><span class="line">2227</span><br><span class="line">2228</span><br><span class="line">2229</span><br><span class="line">2230</span><br><span class="line">2231</span><br><span class="line">2232</span><br><span class="line">2233</span><br><span class="line">2234</span><br><span class="line">2235</span><br><span class="line">2236</span><br><span class="line">2237</span><br><span class="line">2238</span><br><span class="line">2239</span><br><span class="line">2240</span><br><span class="line">2241</span><br><span class="line">2242</span><br><span class="line">2243</span><br><span class="line">2244</span><br><span class="line">2245</span><br><span class="line">2246</span><br><span class="line">2247</span><br><span class="line">2248</span><br><span class="line">2249</span><br><span class="line">2250</span><br><span class="line">2251</span><br><span class="line">2252</span><br><span class="line">2253</span><br><span class="line">2254</span><br><span class="line">2255</span><br><span class="line">2256</span><br><span class="line">2257</span><br><span class="line">2258</span><br><span class="line">2259</span><br><span class="line">2260</span><br><span class="line">2261</span><br><span class="line">2262</span><br><span class="line">2263</span><br><span class="line">2264</span><br><span class="line">2265</span><br><span class="line">2266</span><br><span class="line">2267</span><br><span class="line">2268</span><br><span class="line">2269</span><br><span class="line">2270</span><br><span class="line">2271</span><br><span class="line">2272</span><br><span class="line">2273</span><br><span class="line">2274</span><br><span class="line">2275</span><br><span class="line">2276</span><br><span class="line">2277</span><br><span class="line">2278</span><br><span class="line">2279</span><br><span class="line">2280</span><br><span class="line">2281</span><br><span class="line">2282</span><br><span class="line">2283</span><br><span class="line">2284</span><br><span class="line">2285</span><br><span class="line">2286</span><br><span class="line">2287</span><br><span class="line">2288</span><br><span class="line">2289</span><br><span class="line">2290</span><br><span class="line">2291</span><br><span class="line">2292</span><br><span class="line">2293</span><br><span class="line">2294</span><br><span class="line">2295</span><br><span class="line">2296</span><br><span class="line">2297</span><br><span class="line">2298</span><br><span class="line">2299</span><br><span class="line">2300</span><br><span class="line">2301</span><br><span class="line">2302</span><br><span class="line">2303</span><br><span class="line">2304</span><br><span class="line">2305</span><br><span class="line">2306</span><br><span class="line">2307</span><br><span class="line">2308</span><br><span class="line">2309</span><br><span class="line">2310</span><br><span class="line">2311</span><br><span class="line">2312</span><br><span class="line">2313</span><br><span class="line">2314</span><br><span class="line">2315</span><br><span class="line">2316</span><br><span class="line">2317</span><br><span class="line">2318</span><br><span class="line">2319</span><br><span class="line">2320</span><br><span class="line">2321</span><br><span class="line">2322</span><br><span class="line">2323</span><br><span class="line">2324</span><br><span class="line">2325</span><br><span class="line">2326</span><br><span class="line">2327</span><br><span class="line">2328</span><br><span class="line">2329</span><br><span class="line">2330</span><br><span class="line">2331</span><br><span class="line">2332</span><br><span class="line">2333</span><br><span class="line">2334</span><br><span class="line">2335</span><br><span class="line">2336</span><br><span class="line">2337</span><br><span class="line">2338</span><br><span class="line">2339</span><br><span class="line">2340</span><br><span class="line">2341</span><br><span class="line">2342</span><br><span class="line">2343</span><br><span class="line">2344</span><br><span class="line">2345</span><br><span class="line">2346</span><br><span class="line">2347</span><br><span class="line">2348</span><br><span class="line">2349</span><br><span class="line">2350</span><br><span class="line">2351</span><br><span class="line">2352</span><br><span class="line">2353</span><br><span class="line">2354</span><br><span class="line">2355</span><br><span class="line">2356</span><br><span class="line">2357</span><br><span class="line">2358</span><br><span class="line">2359</span><br><span class="line">2360</span><br><span class="line">2361</span><br><span class="line">2362</span><br><span class="line">2363</span><br><span class="line">2364</span><br><span class="line">2365</span><br><span class="line">2366</span><br><span class="line">2367</span><br><span class="line">2368</span><br><span class="line">2369</span><br><span class="line">2370</span><br><span class="line">2371</span><br><span class="line">2372</span><br><span class="line">2373</span><br><span class="line">2374</span><br><span class="line">2375</span><br><span class="line">2376</span><br><span class="line">2377</span><br><span class="line">2378</span><br><span class="line">2379</span><br><span class="line">2380</span><br><span class="line">2381</span><br><span class="line">2382</span><br><span class="line">2383</span><br><span class="line">2384</span><br><span class="line">2385</span><br><span class="line">2386</span><br><span class="line">2387</span><br><span class="line">2388</span><br><span class="line">2389</span><br><span class="line">2390</span><br><span class="line">2391</span><br><span class="line">2392</span><br><span class="line">2393</span><br><span class="line">2394</span><br><span class="line">2395</span><br><span class="line">2396</span><br><span class="line">2397</span><br><span class="line">2398</span><br><span class="line">2399</span><br><span class="line">2400</span><br><span class="line">2401</span><br><span class="line">2402</span><br><span class="line">2403</span><br><span class="line">2404</span><br><span class="line">2405</span><br><span class="line">2406</span><br><span class="line">2407</span><br><span class="line">2408</span><br><span class="line">2409</span><br><span class="line">2410</span><br><span class="line">2411</span><br><span class="line">2412</span><br><span class="line">2413</span><br><span class="line">2414</span><br><span class="line">2415</span><br><span class="line">2416</span><br><span class="line">2417</span><br><span class="line">2418</span><br><span class="line">2419</span><br><span class="line">2420</span><br><span class="line">2421</span><br><span class="line">2422</span><br><span class="line">2423</span><br><span class="line">2424</span><br><span class="line">2425</span><br><span class="line">2426</span><br><span class="line">2427</span><br><span class="line">2428</span><br><span class="line">2429</span><br><span class="line">2430</span><br><span class="line">2431</span><br><span class="line">2432</span><br><span class="line">2433</span><br><span class="line">2434</span><br><span class="line">2435</span><br><span class="line">2436</span><br><span class="line">2437</span><br><span class="line">2438</span><br><span class="line">2439</span><br><span class="line">2440</span><br><span class="line">2441</span><br><span class="line">2442</span><br><span class="line">2443</span><br><span class="line">2444</span><br><span class="line">2445</span><br><span class="line">2446</span><br><span class="line">2447</span><br><span class="line">2448</span><br><span class="line">2449</span><br><span class="line">2450</span><br><span class="line">2451</span><br><span class="line">2452</span><br><span class="line">2453</span><br><span class="line">2454</span><br><span class="line">2455</span><br><span class="line">2456</span><br><span class="line">2457</span><br><span class="line">2458</span><br><span class="line">2459</span><br><span class="line">2460</span><br><span class="line">2461</span><br><span class="line">2462</span><br><span class="line">2463</span><br><span class="line">2464</span><br><span class="line">2465</span><br><span class="line">2466</span><br><span class="line">2467</span><br><span class="line">2468</span><br><span class="line">2469</span><br><span class="line">2470</span><br><span class="line">2471</span><br><span class="line">2472</span><br><span class="line">2473</span><br><span class="line">2474</span><br><span class="line">2475</span><br><span class="line">2476</span><br><span class="line">2477</span><br><span class="line">2478</span><br><span class="line">2479</span><br><span class="line">2480</span><br><span class="line">2481</span><br><span class="line">2482</span><br><span class="line">2483</span><br><span class="line">2484</span><br><span class="line">2485</span><br><span class="line">2486</span><br><span class="line">2487</span><br><span class="line">2488</span><br><span class="line">2489</span><br><span class="line">2490</span><br><span class="line">2491</span><br><span class="line">2492</span><br><span class="line">2493</span><br><span class="line">2494</span><br><span class="line">2495</span><br><span class="line">2496</span><br><span class="line">2497</span><br><span class="line">2498</span><br><span class="line">2499</span><br><span class="line">2500</span><br><span class="line">2501</span><br><span class="line">2502</span><br><span class="line">2503</span><br><span class="line">2504</span><br><span class="line">2505</span><br><span class="line">2506</span><br><span class="line">2507</span><br><span class="line">2508</span><br><span class="line">2509</span><br><span class="line">2510</span><br><span class="line">2511</span><br><span class="line">2512</span><br><span class="line">2513</span><br><span class="line">2514</span><br><span class="line">2515</span><br><span class="line">2516</span><br><span class="line">2517</span><br><span class="line">2518</span><br><span class="line">2519</span><br><span class="line">2520</span><br><span class="line">2521</span><br><span class="line">2522</span><br><span class="line">2523</span><br><span class="line">2524</span><br><span class="line">2525</span><br><span class="line">2526</span><br><span class="line">2527</span><br><span class="line">2528</span><br><span class="line">2529</span><br><span class="line">2530</span><br><span class="line">2531</span><br><span class="line">2532</span><br><span class="line">2533</span><br><span class="line">2534</span><br><span class="line">2535</span><br><span class="line">2536</span><br><span class="line">2537</span><br><span class="line">2538</span><br><span class="line">2539</span><br><span class="line">2540</span><br><span class="line">2541</span><br><span class="line">2542</span><br><span class="line">2543</span><br><span class="line">2544</span><br><span class="line">2545</span><br><span class="line">2546</span><br><span class="line">2547</span><br><span class="line">2548</span><br><span class="line">2549</span><br><span class="line">2550</span><br><span class="line">2551</span><br><span class="line">2552</span><br><span class="line">2553</span><br><span class="line">2554</span><br><span class="line">2555</span><br><span class="line">2556</span><br><span class="line">2557</span><br><span class="line">2558</span><br><span class="line">2559</span><br><span class="line">2560</span><br><span class="line">2561</span><br><span class="line">2562</span><br><span class="line">2563</span><br><span class="line">2564</span><br><span class="line">2565</span><br><span class="line">2566</span><br><span class="line">2567</span><br><span class="line">2568</span><br><span class="line">2569</span><br><span class="line">2570</span><br><span class="line">2571</span><br><span class="line">2572</span><br><span class="line">2573</span><br><span class="line">2574</span><br><span class="line">2575</span><br><span class="line">2576</span><br><span class="line">2577</span><br><span class="line">2578</span><br><span class="line">2579</span><br><span class="line">2580</span><br><span class="line">2581</span><br><span class="line">2582</span><br><span class="line">2583</span><br><span class="line">2584</span><br><span class="line">2585</span><br><span class="line">2586</span><br><span class="line">2587</span><br><span class="line">2588</span><br><span class="line">2589</span><br><span class="line">2590</span><br><span class="line">2591</span><br><span class="line">2592</span><br><span class="line">2593</span><br><span class="line">2594</span><br><span class="line">2595</span><br><span class="line">2596</span><br><span class="line">2597</span><br><span class="line">2598</span><br><span class="line">2599</span><br><span class="line">2600</span><br><span class="line">2601</span><br><span class="line">2602</span><br><span class="line">2603</span><br><span class="line">2604</span><br><span class="line">2605</span><br><span class="line">2606</span><br><span class="line">2607</span><br><span class="line">2608</span><br><span class="line">2609</span><br><span class="line">2610</span><br><span class="line">2611</span><br><span class="line">2612</span><br><span class="line">2613</span><br><span class="line">2614</span><br><span class="line">2615</span><br><span class="line">2616</span><br><span class="line">2617</span><br><span class="line">2618</span><br><span class="line">2619</span><br><span class="line">2620</span><br><span class="line">2621</span><br><span class="line">2622</span><br><span class="line">2623</span><br><span class="line">2624</span><br><span class="line">2625</span><br><span class="line">2626</span><br><span class="line">2627</span><br><span class="line">2628</span><br><span class="line">2629</span><br><span class="line">2630</span><br><span class="line">2631</span><br><span class="line">2632</span><br><span class="line">2633</span><br><span class="line">2634</span><br><span class="line">2635</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">   - 期望值和实际值相同表示测试通过，期望值和实际值不同则单元测试执行时会报错。</span><br><span class="line">   </span><br><span class="line">- 这里引入JUnit是为了代替main方法。</span><br><span class="line"></span><br><span class="line">- 使用JUnit步骤：</span><br><span class="line">   - 第一步：引入依赖</span><br><span class="line">```xml</span><br><span class="line">&lt;!-- junit依赖 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.13.2&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">   - 第二步：编写单元测试类【测试用例】，测试用例中每一个测试方法上使用@Test注解进行标注。</span><br><span class="line">      - 测试用例的名字以及每个测试方法的定义都是有规范的：</span><br><span class="line">         - 测试用例的名字：XxxTest</span><br><span class="line">         - 测试方法声明格式：public void test业务方法名()&#123;&#125;</span><br><span class="line">```java</span><br><span class="line">// 测试用例</span><br><span class="line">public class CarMapperTest&#123;</span><br><span class="line">    </span><br><span class="line">    // 测试方法</span><br><span class="line">    @Test</span><br><span class="line">    public void testInsertCar()&#123;&#125;//注意起名规范</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testUpdate()&#123;&#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">   - 第三步：可以在类上执行，也可以在方法上执行</span><br><span class="line">      - 在类上执行时，该类中所有的测试方法都会执行。</span><br><span class="line">      - 在方法上执行时，只执行当前的测试方法。</span><br><span class="line">- 编写一个测试用例，来测试insertCar业务</span><br><span class="line">```java</span><br><span class="line">public class CarMapperTest &#123;</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testInsertCar()&#123;</span><br><span class="line">        SqlSession sqlSession = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            // 1.创建SqlSessionFactoryBuilder对象</span><br><span class="line">            SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">            // 2.创建SqlSessionFactory对象</span><br><span class="line">            SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;));</span><br><span class="line">            // 3.创建SqlSession对象</span><br><span class="line">            sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">            // 4.执行SQL</span><br><span class="line">            int count = sqlSession.insert(&quot;insertCar&quot;);</span><br><span class="line">            System.out.println(&quot;更新了几条记录：&quot; + count);</span><br><span class="line">            // 5.提交</span><br><span class="line">            sqlSession.commit();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            // 回滚</span><br><span class="line">            if (sqlSession != null) &#123;</span><br><span class="line">                sqlSession.rollback();</span><br><span class="line">            &#125;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            // 6.关闭</span><br><span class="line">            if (sqlSession != null) &#123;</span><br><span class="line">                sqlSession.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">执行单元测试，查看数据库表的变化：</span><br><span class="line">![AEE76A27-5761-4162-B9DB-CCE0814EC06C.png](./images/老杜MyBatis/1659604159905-5853a1c1-b266-4a74-8f25-8b7a326d84d6.png#averageHue=%23f3f1ee&amp;clientId=u6b7aa99c-2be4-4&amp;from=paste&amp;height=224&amp;id=ue1281902&amp;originHeight=224&amp;originWidth=562&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=15023&amp;status=done&amp;style=none&amp;taskId=u8a987f16-e633-4fe7-a462-68ec6db2bb0&amp;title=&amp;width=562)</span><br><span class="line">## 2.7 引入日志框架logback</span><br><span class="line"></span><br><span class="line">- 引入日志框架的目的是为了看清楚mybatis执行的具体sql。</span><br><span class="line">- 启用标准日志组件，只需要在mybatis-config.xml文件中添加以下配置：【可参考mybatis手册】</span><br><span class="line">```xml</span><br><span class="line">&lt;settings&gt;</span><br><span class="line">  &lt;setting name=&quot;logImpl&quot; value=&quot;STDOUT_LOGGING&quot; /&gt;</span><br><span class="line">&lt;/settings&gt;</span><br><span class="line">```</span><br><span class="line">标准日志也可以用，但是配置不够灵活，可以集成其他的日志组件，例如：SLF4J（沙拉风）：沙拉风是一个日志标准，其中有一个框架叫做logback，它实现了沙拉风规范。，log4j，log4j2，logback等。</span><br><span class="line"></span><br><span class="line">- logback是目前日志框架中性能较好的，较流行的，所以我们选它。log4j log4j2 logback都是同一个作者开发的。</span><br><span class="line">- STDOUT_LOGGING是标准日志，mybatis已经实现了这种标准日志。mybatis框架本身已经实现了这种标准。开启方法就是上面的配置，这个标签在编写的时候要注意，它应该出现在environments标签之前。不需要记忆这个顺序，因为有dtd文件进行约束。</span><br><span class="line">- 引入logback的步骤：</span><br><span class="line">   - 第一步：引入logback相关依赖</span><br><span class="line">```xml</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.2.11&lt;/version&gt;</span><br><span class="line">  &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">   - 第二步：引入logback相关配置文件（文件名叫做logback.xml或logback-test.xml，必须放到类路径当中），这个主要配置日志输出相关的级别以及日志具体的格式。里面的输出格式都是可以更改的</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration debug=&quot;false&quot;&gt;</span><br><span class="line">    &lt;!-- 控制台输出 --&gt;</span><br><span class="line">    &lt;appender name=&quot;STDOUT&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">        &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt;</span><br><span class="line">            &lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符--&gt;</span><br><span class="line">            &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&lt;/pattern&gt;</span><br><span class="line">        &lt;/encoder&gt;</span><br><span class="line">    &lt;/appender&gt;</span><br><span class="line">    &lt;!-- 按照每天生成日志文件 --&gt;</span><br><span class="line">    &lt;appender name=&quot;FILE&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;</span><br><span class="line">        &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">            &lt;!--日志文件输出的文件名--&gt;</span><br><span class="line">            &lt;FileNamePattern&gt;$&#123;LOG_HOME&#125;/TestWeb.log.%d&#123;yyyy-MM-dd&#125;.log&lt;/FileNamePattern&gt;</span><br><span class="line">            &lt;!--日志文件保留天数--&gt;</span><br><span class="line">            &lt;MaxHistory&gt;30&lt;/MaxHistory&gt;</span><br><span class="line">        &lt;/rollingPolicy&gt;</span><br><span class="line">        &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt;</span><br><span class="line">            &lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符--&gt;</span><br><span class="line">            &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&lt;/pattern&gt;</span><br><span class="line">        &lt;/encoder&gt;</span><br><span class="line">        &lt;!--日志文件最大的大小--&gt;</span><br><span class="line">        &lt;triggeringPolicy class=&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt;</span><br><span class="line">            &lt;MaxFileSize&gt;100MB&lt;/MaxFileSize&gt;</span><br><span class="line">        &lt;/triggeringPolicy&gt;</span><br><span class="line">    &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--mybatis log configure--&gt;</span><br><span class="line">    &lt;logger name=&quot;com.apache.ibatis&quot; level=&quot;TRACE&quot;/&gt;</span><br><span class="line">    &lt;logger name=&quot;java.sql.Connection&quot; level=&quot;DEBUG&quot;/&gt;</span><br><span class="line">    &lt;logger name=&quot;java.sql.Statement&quot; level=&quot;DEBUG&quot;/&gt;</span><br><span class="line">    &lt;logger name=&quot;java.sql.PreparedStatement&quot; level=&quot;DEBUG&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 日志输出级别,logback日志级别包括五个：TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR --&gt;</span><br><span class="line">    &lt;root level=&quot;DEBUG&quot;&gt;</span><br><span class="line">        &lt;appender-ref ref=&quot;STDOUT&quot;/&gt;</span><br><span class="line">        &lt;appender-ref ref=&quot;FILE&quot;/&gt;</span><br><span class="line">    &lt;/root&gt;</span><br><span class="line"></span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- 再次执行单元测试方法testInsertCar，查看控制台是否有sql语句输出</span><br><span class="line">   - ![E75C0BCA-F8D3-44f8-AABB-282510093C8C.png](./images/老杜MyBatis/1659610464472-e3b9e8b9-d29b-4f9b-ad34-dab427fe3a45.png#averageHue=%2334312f&amp;clientId=u6b7aa99c-2be4-4&amp;from=paste&amp;height=528&amp;id=uce9a4d58&amp;originHeight=528&amp;originWidth=1644&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=113799&amp;status=done&amp;style=none&amp;taskId=ub0b377eb-9933-4c71-a4e7-2d75cda3771&amp;title=&amp;width=1644)</span><br><span class="line">## 2.8 MyBatis工具类SqlSessionUtil的封装</span><br><span class="line"></span><br><span class="line">- 每一次获取SqlSession对象代码太繁琐，封装一个工具类</span><br><span class="line">```java</span><br><span class="line">/**</span><br><span class="line"> * MyBatis工具类</span><br><span class="line"> *</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class SqlSessionUtil &#123;</span><br><span class="line">    private static SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 类加载时初始化sqlSessionFactory对象</span><br><span class="line">     * SqlsessionUtil工具类在进行第一次加载的时候，解析mybatis-config.xml文件</span><br><span class="line">     */</span><br><span class="line">    static &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">            sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;));</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 每调用一次openSession()可获取一个新的会话，该会话支持自动提交。</span><br><span class="line">     *</span><br><span class="line">     * @return 新的会话对象</span><br><span class="line">     */</span><br><span class="line">    public static SqlSession openSession() &#123;</span><br><span class="line">        return sqlSessionFactory.openSession(true);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- 测试工具类，将testInsertCar()改造</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testInsertCar()&#123;</span><br><span class="line">    SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">    // 执行SQL</span><br><span class="line">    int count = sqlSession.insert(&quot;insertCar&quot;);</span><br><span class="line">    System.out.println(&quot;插入了几条记录:&quot; + count);</span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">![](./images/老杜MyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#averageHue=%23dad8d7&amp;from=url&amp;id=vyMyT&amp;originHeight=152&amp;originWidth=1180&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=)</span><br><span class="line"># 三、使用MyBatis完成CRUD</span><br><span class="line"></span><br><span class="line">- 准备工作</span><br><span class="line">   - 创建module（Maven的普通Java模块）：mybatis-002-crud</span><br><span class="line">   - pom.xml</span><br><span class="line">      - 打包方式jar</span><br><span class="line">      - 依赖：</span><br><span class="line">         - mybatis依赖</span><br><span class="line">         - mysql驱动依赖</span><br><span class="line">         - junit依赖</span><br><span class="line">         - logback依赖</span><br><span class="line">   - mybatis-config.xml放在类的根路径下</span><br><span class="line">   - CarMapper.xml放在类的根路径下</span><br><span class="line">   - logback.xml放在类的根路径下</span><br><span class="line">   - 提供com.powernode.mybatis.utils.SqlSessionUtil工具类</span><br><span class="line">   - 创建测试用例：com.powernode.mybatis.CarMapperTest</span><br><span class="line">## 3.1 insert（Create）</span><br><span class="line">分析以下SQL映射文件中SQL语句存在的问题</span><br><span class="line">```xml</span><br><span class="line">&lt;!--namespace先随便写--&gt;</span><br><span class="line">&lt;mapper namespace=&quot;car&quot;&gt;</span><br><span class="line">    &lt;insert id=&quot;insertCar&quot;&gt;</span><br><span class="line">        insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(&#x27;103&#x27;, &#x27;奔驰E300L&#x27;, 50.3, &#x27;2022-01-01&#x27;, &#x27;燃油车&#x27;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">存在的问题是：SQL语句中的值不应该写死，值应该是用户提供的。之前的JDBC代码是这样写的：</span><br><span class="line">```java</span><br><span class="line">// JDBC中使用 ? 作为占位符。那么MyBatis中会使用什么作为占位符呢？</span><br><span class="line">String sql = &quot;insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(?,?,?,?,?)&quot;;</span><br><span class="line">// 给 ? 传值。那么MyBatis中应该怎么传值呢？</span><br><span class="line">ps.setString(1,&quot;103&quot;);</span><br><span class="line">ps.setString(2,&quot;奔驰E300L&quot;);</span><br><span class="line">```</span><br><span class="line">在MyBatis中可以这样做：</span><br><span class="line">**在Java程序中，将数据放到Map集合中**</span><br><span class="line">**在sql语句中使用 #&#123;map集合的key&#125; 来完成传值，#&#123;&#125; 等同于JDBC中的 ? ，#&#123;&#125;就是占位符**</span><br><span class="line">Java程序这样写：</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">/**</span><br><span class="line"> * 测试MyBatis的CRUD</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class CarMapperTest &#123;</span><br><span class="line">    @Test</span><br><span class="line">    public void testInsertCar()&#123;</span><br><span class="line">        // 前端传过来数据了。</span><br><span class="line">//这个对象我们先使用Map集合进行数据的封装</span><br><span class="line">        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">        map.put(&quot;k1&quot;, &quot;103&quot;);</span><br><span class="line">        map.put(&quot;k2&quot;, &quot;奔驰E300L&quot;);</span><br><span class="line">        // 获取SqlSession对象</span><br><span class="line">        SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">        // 执行SQL语句（使用map集合给sql语句传递数据）</span><br><span class="line">        //第一个参数:sqlId，从CarMapper.xml文件中复制:</span><br><span class="line">//第二个参数:封装数据的对象</span><br><span class="line">        int count = sqlSession.insert(&quot;insertCar&quot;, map);</span><br><span class="line">        System.out.println(&quot;插入了几条记录：&quot; + count);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">SQL语句这样写：</span><br><span class="line">```xml</span><br><span class="line">&lt;!--namespace先随便写--&gt;</span><br><span class="line">&lt;mapper namespace=&quot;car&quot;&gt;</span><br><span class="line">    &lt;insert id=&quot;insertCar&quot;&gt;</span><br><span class="line">        insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;k1&#125;,#&#123;k2&#125;,#&#123;k3&#125;,#&#123;k4&#125;,#&#123;k5&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">**#&#123;&#125; 的里面必须填写map集合的key，不能随便写。**运行测试程序，查看数据库：</span><br><span class="line">![2DD856C0-9725-4073-98C4-129D86B03B35.png](./images/老杜MyBatis/1659666309110-2c00ecfe-1777-4c9a-8baa-1bc4e4ab47a0.png#averageHue=%23deb069&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=179&amp;id=u94fe22b6&amp;originHeight=179&amp;originWidth=560&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=11045&amp;status=done&amp;style=none&amp;taskId=ubd9e1519-05eb-4464-9180-0c279df37e0&amp;title=&amp;width=560)</span><br><span class="line">如果#&#123;&#125;里写的是map集合中不存在的key会有什么问题？</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;mapper namespace=&quot;car&quot;&gt;</span><br><span class="line">    &lt;insert id=&quot;insertCar&quot;&gt;</span><br><span class="line">        insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;kk&#125;,#&#123;k2&#125;,#&#123;k3&#125;,#&#123;k4&#125;,#&#123;k5&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">运行程序：</span><br><span class="line">![13079E0B-F436-4100-B4E1-BB5C3A58ADD9.png](./images/老杜MyBatis/1659666601236-f892944d-8725-4816-b34c-621a9380eda8.png#averageHue=%2332302f&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=344&amp;id=u2059ad06&amp;originHeight=344&amp;originWidth=1560&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=65973&amp;status=done&amp;style=none&amp;taskId=u6bdf7288-ce4c-4b43-8426-e6dca594b05&amp;title=&amp;width=1560)</span><br><span class="line">![0E5B4E84-C76C-4724-87E5-D37C954D2C40.png](./images/老杜MyBatis/1659666614107-2df4bd58-105b-4b76-881d-e1d19b4d4b98.png#averageHue=%23ddaf67&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=191&amp;id=uc44a11b1&amp;originHeight=191&amp;originWidth=537&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=11172&amp;status=done&amp;style=none&amp;taskId=ua820004b-0e4a-43c7-bc42-fec65f1a4a2&amp;title=&amp;width=537)</span><br><span class="line">通过测试，看到程序并没有报错。正常执行。不过 #&#123;kk&#125; 的写法导致无法获取到map集合中的数据，最终导致数据库表car_num插入了NULL。</span><br><span class="line">在以上sql语句中，可以看到#&#123;k1&#125; #&#123;k2&#125; #&#123;k3&#125; #&#123;k4&#125; #&#123;k5&#125;的可读性太差，为了增强可读性，我们可以将Java程序做如下修改：</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">// 让key的可读性增强</span><br><span class="line">map.put(&quot;carNum&quot;, &quot;103&quot;);</span><br><span class="line">map.put(&quot;brand&quot;, &quot;奔驰E300L&quot;);</span><br><span class="line">map.put(&quot;guidePrice&quot;, 50.3);</span><br><span class="line">map.put(&quot;produceTime&quot;, &quot;2020-10-01&quot;);</span><br><span class="line">map.put(&quot;carType&quot;, &quot;燃油车&quot;);</span><br><span class="line">```</span><br><span class="line">SQL语句做如下修改，这样可以增强程序的可读性：</span><br><span class="line">```xml</span><br><span class="line">&lt;mapper namespace=&quot;car&quot;&gt;</span><br><span class="line">    &lt;insert id=&quot;insertCar&quot;&gt;</span><br><span class="line">        insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">运行程序，查看数据库表：</span><br><span class="line">![B84BC4D9-24C1-4310-A5D1-DFC407BBFA8C.png](./images/老杜MyBatis/1659667098369-a13a16ec-6f02-44f2-85b7-8834b9ca161b.png#averageHue=%23ddaf6b&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=161&amp;id=u51a730e6&amp;originHeight=161&amp;originWidth=577&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=9427&amp;status=done&amp;style=none&amp;taskId=ud2e4da5f-1985-4267-8282-e2bafa5fff3&amp;title=&amp;width=577)</span><br><span class="line">使用Map集合可以传参，那使用**pojo**（简单普通的java对象）可以完成传参吗？测试一下：</span><br><span class="line"></span><br><span class="line">- 第一步：定义一个pojo类Car，提供相关属性。</span><br><span class="line">```java</span><br><span class="line">package com.powernode.mybatis.pojo;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * POJOs，简单普通的Java对象。封装数据用的。</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class Car &#123;</span><br><span class="line">    //数据库表当中的字段应该和pojo类的属性一一对应:</span><br><span class="line">    //建议使用包装类，这样可以防止null的问题</span><br><span class="line">    private Long id;</span><br><span class="line">    private String carNum;</span><br><span class="line">    private String brand;</span><br><span class="line">    private Double guidePrice;</span><br><span class="line">    private String produceTime;</span><br><span class="line">    private String carType;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Car&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, carNum=&#x27;&quot; + carNum + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, brand=&#x27;&quot; + brand + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, guidePrice=&quot; + guidePrice +</span><br><span class="line">                &quot;, produceTime=&#x27;&quot; + produceTime + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, carType=&#x27;&quot; + carType + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Car() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Car(Long id, String carNum, String brand, Double guidePrice, String produceTime, String carType) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.carNum = carNum;</span><br><span class="line">        this.brand = brand;</span><br><span class="line">        this.guidePrice = guidePrice;</span><br><span class="line">        this.produceTime = produceTime;</span><br><span class="line">        this.carType = carType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(Long id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCarNum() &#123;</span><br><span class="line">        return carNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCarNum(String carNum) &#123;</span><br><span class="line">        this.carNum = carNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBrand() &#123;</span><br><span class="line">        return brand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBrand(String brand) &#123;</span><br><span class="line">        this.brand = brand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Double getGuidePrice() &#123;</span><br><span class="line">        return guidePrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setGuidePrice(Double guidePrice) &#123;</span><br><span class="line">        this.guidePrice = guidePrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getProduceTime() &#123;</span><br><span class="line">        return produceTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setProduceTime(String produceTime) &#123;</span><br><span class="line">        this.produceTime = produceTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCarType() &#123;</span><br><span class="line">        return carType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCarType(String carType) &#123;</span><br><span class="line">        this.carType = carType;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- 第二步：Java程序</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testInsertCarByPOJO()&#123;</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">    // 创建POJO，封装数据</span><br><span class="line">    Car car = new Car(null,&quot;3333&quot;,&quot;奔驰C200&quot;,30.0,&quot;2020-10-11&quot;,&quot;燃油车&quot;);</span><br><span class="line">    // 执行SQL，传数据</span><br><span class="line">    int count = sqlSession.insert(&quot;insertCarByPOJO&quot;, car);</span><br><span class="line">    System.out.println(&quot;插入了几条记录&quot; + count);</span><br><span class="line">    sqlSession.commit();</span><br><span class="line">sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- 第三步：SQL语句</span><br><span class="line">```xml</span><br><span class="line">&lt;insert id=&quot;insertCarByPOJO&quot;&gt;</span><br><span class="line">  &lt;!--#&#123;&#125; 里写的是POJO的属性名--&gt;</span><br><span class="line">  insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- 运行程序，查看数据库表：</span><br><span class="line"></span><br><span class="line">![9C093F8D-3868-435d-AA67-91B779ADF7BE.png](./images/老杜MyBatis/1659668224378-2070e0f4-8252-4978-8204-bb247d172152.png#averageHue=%23ddaf69&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=192&amp;id=ue5a6a89a&amp;originHeight=192&amp;originWidth=573&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=12105&amp;status=done&amp;style=none&amp;taskId=udee3b33a-2b0f-445d-9657-6fcf1cbcbe5&amp;title=&amp;width=573)</span><br><span class="line">#&#123;&#125; 里写的是POJO的属性名，如果写成其他的会有问题吗？</span><br><span class="line">```xml</span><br><span class="line">&lt;insert id=&quot;insertCarByPOJO&quot;&gt;</span><br><span class="line">  insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;a&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br><span class="line">```</span><br><span class="line">运行程序，出现了以下异常：</span><br><span class="line">![BDD7D72C-B8AD-46b0-9006-9671AE65B305.png](./images/老杜MyBatis/1659668583320-e0b198ac-df57-47f9-8520-7bb86f4b56fe.png#averageHue=%23342e2d&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=347&amp;id=u5ee0aa99&amp;originHeight=347&amp;originWidth=1548&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=55921&amp;status=done&amp;style=none&amp;taskId=uf68ed3c1-a281-4fd0-b8d3-cab66b4db7e&amp;title=&amp;width=1548)</span><br><span class="line">错误信息中描述：在Car类中没有找到a属性的getter方法。</span><br><span class="line">修改POJO类Car的代码，**只将getCarNum()方法名修改为getA()，其他代码不变**，如下：</span><br><span class="line">![2BD31517-18A1-40b0-ABB2-066E930366AE.png](./images/老杜MyBatis/1659668831506-d7700b47-d87a-417b-bd86-46467edd968c.png#averageHue=%23332b2a&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=270&amp;id=u9e1f92be&amp;originHeight=270&amp;originWidth=459&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=14207&amp;status=done&amp;style=none&amp;taskId=u9a87b35c-6f32-4245-bc84-8ea61e49ea8&amp;title=&amp;width=459)</span><br><span class="line">再运行程序，查看数据库表中数据：</span><br><span class="line">![17908172-C596-4d31-B3B8-09B6DDDD5C82.png](./images/老杜MyBatis/1659668909618-59bddd05-fcfa-41cc-8c87-a7bcd7060c2f.png#averageHue=%23f7f5f3&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=148&amp;id=ud345a029&amp;originHeight=148&amp;originWidth=531&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=9058&amp;status=done&amp;style=none&amp;taskId=u40d048ac-be67-4773-a75d-a81be15ea72&amp;title=&amp;width=531)</span><br><span class="line">**经过测试得出结论：**</span><br><span class="line">**如果采用map集合传参，#&#123;&#125; 里写的是map集合的key，如果key不存在不会报错，数据库表中会插入NULL。**</span><br><span class="line">**如果采用POJO传参，#&#123;&#125; 里写的是get方法的方法名去掉get之后将剩下的单词首字母变小写（例如：getAge()对应的是#&#123;age&#125;，getUserName()对应的是#&#123;userName&#125;)，如果这样的get方法不存在会报错。**</span><br><span class="line"></span><br><span class="line">也就是说mybatis在底层给?传值的时候，先要获取值，怎么获取的？ 调用了pojo对象的get方法。例如：car.getCarNum()，car.getCarType()，car.getBrand()</span><br><span class="line"></span><br><span class="line">注意：其实传参数的时候有一个属性parameterType，这个属性用来指定传参的数据类型，不过这个属性是可以省略的</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;insert id=&quot;insertCar&quot; parameterType=&quot;java.util.Map&quot;&gt;</span><br><span class="line">  insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">&lt;insert id=&quot;insertCarByPOJO&quot; parameterType=&quot;com.powernode.mybatis.pojo.Car&quot;&gt;</span><br><span class="line">  insert into t_car(car_num,brand,guide_price,produce_time,car_type) values(#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br><span class="line">```</span><br><span class="line">## 3.2 delete（Delete）</span><br><span class="line">需求：根据car_num进行删除。</span><br><span class="line">SQL语句这样写：</span><br><span class="line">```xml</span><br><span class="line">&lt;delete id=&quot;deleteByCarNum&quot;&gt;</span><br><span class="line">  delete from t_car where car_num = #&#123;SuiBianXie&#125;</span><br><span class="line">&lt;/delete&gt;</span><br><span class="line">```</span><br><span class="line">Java程序这样写：</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testDeleteByCarNum()&#123;</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">    // 执行SQL语句</span><br><span class="line">    int count = sqlSession.delete(&quot;deleteByCarNum&quot;, &quot;102&quot;);</span><br><span class="line">    System.out.println(&quot;删除了几条记录：&quot; + count);</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">运行结果：</span><br><span class="line">![2ECBA22E-ABC9-4dc1-87AD-F4842083A2CD.png](./images/老杜MyBatis/1659671944122-784bbd93-06dc-4faf-a18a-6beef6cf15b5.png#averageHue=%23332f2e&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=228&amp;id=u9ba38c62&amp;originHeight=228&amp;originWidth=1287&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=44537&amp;status=done&amp;style=none&amp;taskId=uc25ecbf1-cea2-4719-9fba-2b8954b1650&amp;title=&amp;width=1287)</span><br><span class="line">**注意：当占位符只有一个的时候，$&#123;&#125; 里面的内容可以随便写。但最好见名知意**</span><br><span class="line"></span><br><span class="line">## 3.3 update（Update）</span><br><span class="line">需求：修改id=34的Car信息，car_num为102，brand为比亚迪汉，guide_price为30.23，produce_time为2018-09-10，car_type为电车</span><br><span class="line">修改前：</span><br><span class="line">![25135D96-3CD7-43f9-9E0F-7C90BCEDF28E.png](./images/老杜MyBatis/1659680723161-c7563b14-b4f7-4467-90b5-4dfca148ca83.png#averageHue=%23d7a964&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=238&amp;id=u63346d62&amp;originHeight=238&amp;originWidth=599&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=15600&amp;status=done&amp;style=none&amp;taskId=ubd0db29a-16d4-4ec2-8990-3c666f90de5&amp;title=&amp;width=599)</span><br><span class="line">SQL语句如下：</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;update id=&quot;updateCarByPOJO&quot;&gt;</span><br><span class="line">  update t_car set </span><br><span class="line">    car_num = #&#123;carNum&#125;, brand = #&#123;brand&#125;, </span><br><span class="line">    guide_price = #&#123;guidePrice&#125;, produce_time = #&#123;produceTime&#125;, </span><br><span class="line">    car_type = #&#123;carType&#125; </span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line">&lt;/update&gt;</span><br><span class="line">```</span><br><span class="line">Java代码如下：</span><br><span class="line">```java</span><br><span class="line">    @Test</span><br><span class="line">    public void testUpdateCarByPOJO()&#123;</span><br><span class="line">        // 准备数据</span><br><span class="line">        Car car = new Car(34L, &quot;102&quot;, &quot;比亚迪汉&quot;, 30.23, &quot;2018-09-10&quot;, &quot;电车&quot;);</span><br><span class="line">        // 获取SqlSession对象</span><br><span class="line">        SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">        // 执行SQL语句</span><br><span class="line">        int count = sqlSession.update(&quot;updateCarByPOJO&quot;, car);</span><br><span class="line">        System.out.println(&quot;更新了几条记录：&quot; + count);</span><br><span class="line">    &#125;</span><br><span class="line">```</span><br><span class="line">运行结果：</span><br><span class="line">![0670B92C-E654-49a7-839C-814850A4D79A.png](./images/老杜MyBatis/1659681449799-48b44db3-d006-452c-8bd8-d088850c4394.png#averageHue=%23302f2e&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=181&amp;id=ub8471fdb&amp;originHeight=181&amp;originWidth=1638&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=37090&amp;status=done&amp;style=none&amp;taskId=ua2b34e73-5ff6-4e81-b735-8bad85748c1&amp;title=&amp;width=1638)</span><br><span class="line">![7EC1586E-DB9E-47ca-A556-B8822A8F7429.png](./images/老杜MyBatis/1659681391738-02de5e94-8880-4754-b08a-0e807362ba3c.png#averageHue=%23d7ac67&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=192&amp;id=uc8685bbd&amp;originHeight=192&amp;originWidth=545&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=11408&amp;status=done&amp;style=none&amp;taskId=ud923fb36-c275-4a94-af10-522a44df96f&amp;title=&amp;width=545)</span><br><span class="line">当然了，如果使用**map**传数据也是可以的。</span><br><span class="line">## 3.4 select（Retrieve）</span><br><span class="line">select语句和其它语句不同的是：查询会有一个结果集。来看mybatis是怎么处理结果集的！！！</span><br><span class="line">### 查询一条数据</span><br><span class="line">需求：查询id为1的Car信息</span><br><span class="line">SQL语句如下：</span><br><span class="line">```xml</span><br><span class="line">&lt;select id=&quot;selectCarById&quot;&gt;</span><br><span class="line">  select * from t_car where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">```</span><br><span class="line">Java程序如下：</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testSelectCarById()&#123;</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">    // 执行SQL语句</span><br><span class="line">    Object car = sqlSession.selectOne(&quot;selectCarById&quot;, 1);</span><br><span class="line">    System.out.println(car);</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">运行结果如下：</span><br><span class="line">```java</span><br><span class="line">### Error querying database.  Cause: org.apache.ibatis.executor.ExecutorException: </span><br><span class="line">    A query was run and no Result Maps were found for the Mapped Statement &#x27;car.selectCarById&#x27;.  【翻译】：对于一个查询语句来说，没有找到查询的结果映射。</span><br><span class="line">    It&#x27;s likely that neither a Result Type nor a Result Map was specified. 【翻译】：很可能既没有指定结果类型，也没有指定结果映射。</span><br><span class="line">```</span><br><span class="line">以上的异常大致的意思是：对于一个查询语句来说，你需要指定它的“结果类型”或者“结果映射”。</span><br><span class="line">所以说，你想让mybatis查询之后返回一个Java对象的话，至少你要告诉mybatis返回一个什么类型的Java对象，可以在&lt;select&gt;标签中添加resultType属性，用来指定查询要转换的类型：</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;select id=&quot;selectCarById&quot; resultType=&quot;com.powernode.mybatis.pojo.Car&quot;&gt;</span><br><span class="line">  select * from t_car where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">```</span><br><span class="line">运行结果：</span><br><span class="line">![5006A305-0033-4c71-91F4-23B7CA955AC2.png](./images/老杜MyBatis/1659683102262-63ca0c28-9c36-4177-abdd-292a8ab2dcbb.png#averageHue=%2337302f&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=320&amp;id=u95b6894d&amp;originHeight=320&amp;originWidth=1365&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=66879&amp;status=done&amp;style=none&amp;taskId=u1d5dc889-00e8-4163-9ffd-846dd7a1cf1&amp;title=&amp;width=1365)</span><br><span class="line">运行后之前的异常不再出现了，resultType是不能省略的。</span><br><span class="line">但返回的Car对象，只有id和brand两个属性有值，其它属性的值都是null，这是为什么呢？我们来观察一下查询结果列名和Car类的属性名是否能一一对应：</span><br><span class="line">查询结果集的列名：id, car_num, brand, guide_price, produce_time, car_type</span><br><span class="line">Car类的属性名：id, carNum, brand, guidePrice, produceTime, carType</span><br><span class="line">通过观察发现：只有id和brand是一致的，其他字段名和属性名对应不上，这是不是导致null的原因呢？我们尝试在sql语句中使用as关键字来给查询结果列名起别名试试：</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;select id=&quot;selectCarById&quot; resultType=&quot;com.powernode.mybatis.pojo.Car&quot;&gt;</span><br><span class="line">  select </span><br><span class="line">    id, car_num as carNum, brand, guide_price as guidePrice, produce_time as produceTime, car_type as carType </span><br><span class="line">  from </span><br><span class="line">    t_car </span><br><span class="line">  where </span><br><span class="line">    id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">```</span><br><span class="line">运行结果如下：</span><br><span class="line">![C08C9F72-CD0B-4848-AD33-D0DAC7078FDF.png](./images/老杜MyBatis/1659684140382-c8d05a79-7906-4a8f-8301-3cd8097b3eff.png#averageHue=%2334302f&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=297&amp;id=u58b08b89&amp;originHeight=297&amp;originWidth=1338&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=59806&amp;status=done&amp;style=none&amp;taskId=ud4036506-060b-4e34-9035-bccee48d6c7&amp;title=&amp;width=1338)</span><br><span class="line">通过测试得知，如果当查询结果的字段名和java类的属性名对应不上的话，可以采用as关键字起别名，**当然还有其它解决方案，我们后面再看**。</span><br><span class="line"></span><br><span class="line">### 查询多条数据</span><br><span class="line">需求：查询所有的Car信息。</span><br><span class="line">SQL语句如下：</span><br><span class="line">```xml</span><br><span class="line">&lt;!--虽然结果是List集合，但是resultType属性需要指定的是List集合中元素的类型。--&gt;</span><br><span class="line">&lt;select id=&quot;selectCarAll&quot; resultType=&quot;com.powernode.mybatis.pojo.Car&quot;&gt;</span><br><span class="line">  &lt;!--记得使用as起别名，让查询结果的字段名和java类的属性名对应上。--&gt;</span><br><span class="line">  select</span><br><span class="line">    id, car_num as carNum, brand, guide_price as guidePrice, produce_time as produceTime, car_type as carType</span><br><span class="line">  from</span><br><span class="line">    t_car</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">```</span><br><span class="line">Java代码如下：</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testSelectCarAll()&#123;</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">    // 执行SQL语句</span><br><span class="line">    List&lt;Object&gt; cars = sqlSession.selectList(&quot;selectCarAll&quot;);</span><br><span class="line">    // 输出结果</span><br><span class="line">    cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">运行结果如下：</span><br><span class="line">![E1B82451-6452-4e93-BD75-DC6D8B9ADD14.png](./images/老杜MyBatis/1659685063045-cbeabc75-de94-400b-8d41-ee797076b1a0.png#averageHue=%2332302f&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=461&amp;id=u38578cd4&amp;originHeight=461&amp;originWidth=1299&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=97376&amp;status=done&amp;style=none&amp;taskId=u26ba86cb-1139-4aec-9ec1-cff6cf008a9&amp;title=&amp;width=1299)</span><br><span class="line">## 3.5 关于SQL Mapper的namespace</span><br><span class="line">在SQL Mapper配置文件中&lt;mapper&gt;标签的namespace属性可以翻译为命名空间，这个命名空间主要是为了防止sqlId冲突的。</span><br><span class="line">创建CarMapper2.xml文件，代码如下：</span><br><span class="line">```xml</span><br><span class="line">&lt;mapper namespace=&quot;car2&quot;&gt;</span><br><span class="line">    &lt;select id=&quot;selectCarAll&quot; resultType=&quot;com.powernode.mybatis.pojo.Car&quot;&gt;</span><br><span class="line">        select</span><br><span class="line">            id, car_num as carNum, brand, guide_price as guidePrice, produce_time as produceTime, car_type as carType</span><br><span class="line">        from</span><br><span class="line">            t_car</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">不难看出，CarMapper.xml和CarMapper2.xml文件中都有 id=&quot;selectCarAll&quot;</span><br><span class="line">将CarMapper2.xml配置到mybatis-config.xml文件中。</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper resource=&quot;CarMapper.xml&quot;/&gt;</span><br><span class="line">  &lt;mapper resource=&quot;CarMapper2.xml&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br><span class="line">```</span><br><span class="line">编写Java代码如下：</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testNamespace()&#123;</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">    // 执行SQL语句</span><br><span class="line">    List&lt;Object&gt; cars = sqlSession.selectList(&quot;selectCarAll&quot;);</span><br><span class="line">    // 输出结果</span><br><span class="line">    cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">运行结果如下：</span><br><span class="line">```</span><br><span class="line">org.apache.ibatis.exceptions.PersistenceException: </span><br><span class="line">### Error querying database.  Cause: java.lang.IllegalArgumentException: </span><br><span class="line">  selectCarAll is ambiguous in Mapped Statements collection (try using the full name including the namespace, or rename one of the entries) </span><br><span class="line">  【翻译】selectCarAll在Mapped Statements集合中不明确（请尝试使用包含名称空间的全名，或重命名其中一个条目）</span><br><span class="line">  【大致意思是】selectCarAll重名了，你要么在selectCarAll前添加一个名称空间，要有你改个其它名字。</span><br><span class="line">```</span><br><span class="line">Java代码修改如下：</span><br><span class="line"></span><br><span class="line">正确完整的写法:namespace+id，以后都要这么写</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testNamespace()&#123;</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">    // 执行SQL语句</span><br><span class="line">    // 正确完整的写法:namespace+id，以后都要这么写</span><br><span class="line">    //List&lt;Object&gt; cars = sqlSession.selectList(&quot;car.selectCarAll&quot;);</span><br><span class="line">    List&lt;Object&gt; cars = sqlSession.selectList(&quot;car2.selectCarAll&quot;);</span><br><span class="line">    // 输出结果</span><br><span class="line">    cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">运行结果如下：</span><br><span class="line">![C1ED1184-132C-4393-918B-54D9645FE4B8.png](./images/老杜MyBatis/1659686031615-93ca679e-0695-4984-bc4c-af596fe5f2a0.png#averageHue=%2332302f&amp;clientId=ua65e35c1-ae14-4&amp;from=paste&amp;height=506&amp;id=u181fd117&amp;originHeight=506&amp;originWidth=1305&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=108788&amp;status=done&amp;style=none&amp;taskId=u2657f275-38bc-4394-a41d-c50a458c40c&amp;title=&amp;width=1305)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![](./images/老杜MyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#averageHue=%23dad8d7&amp;from=url&amp;id=y8MI4&amp;originHeight=152&amp;originWidth=1180&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=)</span><br><span class="line"># 四、MyBatis核心配置文件详解</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration这个单词一般就是xml文件中根标签的名字</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;这个是dtd约束，规范标签&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--创建SqlSessionFactory时默认使用的环境--&gt;</span><br><span class="line">    &lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">        &lt;!--其中的一个环境。连接的数据库是powernode--&gt;</span><br><span class="line">        &lt;!--一般一个环境/数据库会对应一个SqlSessionFactory对象。--&gt;</span><br><span class="line">        &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/powernode&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;CarMapper.xml&quot;/&gt;</span><br><span class="line">        &lt;mapper resource=&quot;CarMapper2.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- configuration：根标签，表示配置信息。</span><br><span class="line"></span><br><span class="line">- environments：环境（多个），以“s”结尾表示复数，也就是说mybatis的环境可以配置多个数据源。</span><br><span class="line">   - default属性：表示默认使用的是哪个环境，default后面填写的是environment的id。**default的值只需要和environment的id值一致即可**。</span><br><span class="line">   </span><br><span class="line">- environment：具体的环境配置（**主要包括：事务管理器的配置 + 数据源的配置**）</span><br><span class="line">   - id：给当前环境一个唯一标识，该标识用在environments的default后面，用来指定默认环境的选择。</span><br><span class="line">   </span><br><span class="line">- transactionManager：配置事务管理器</span><br><span class="line">   - type属性：指定事务管理器具体使用什么方式，可选值包括两个</span><br><span class="line">      - **JDBC**：使用JDBC原生的事务管理机制。**底层原理：事务开启conn.setAutoCommit(false); ...处理业务...事务提交conn.commit();**</span><br><span class="line">      </span><br><span class="line">      - **MANAGED**：交给其它容器来管理事务，比如spring、WebLogic、JBOSS等。如果没有管理事务的容器，则没有事务。**没有事务的含义：只要执行一条DML语句，则提交一次**。</span><br><span class="line">      </span><br><span class="line">      - 在mybatis中提供了一个事务管理器接口:Transaction</span><br><span class="line">        该接口下有两个实现类:</span><br><span class="line">      </span><br><span class="line">        ​JdbcTransaction</span><br><span class="line">        ​ManagedTransaction</span><br><span class="line">        如果type=&quot;JDBC&quot;，那么底层会实例化JdbcTransaction对象。</span><br><span class="line">        如果type=&quot;MANAGED&quot;，那么底层会实例化ManagedTransaction</span><br><span class="line">   </span><br><span class="line">- dataSource：指定数据源</span><br><span class="line">   - dataSource的作用是为程序提供Connection对象，但凡是给程序提供Connection对象的都可以叫数据源</span><br><span class="line">   - 数据源实际上是一套JDK提供的规范：javax.sql.DataSource，自己写的数据源只要实现javax.sql.DataSource接口就可以</span><br><span class="line">   - type属性：用来指定具体使用的数据库连接池的策略，可选值包括三个</span><br><span class="line">      - **UNPOOLED**：不使用数据库连接池，采用传统的获取连接的方式，虽然也实现Javax.sql.DataSource接口</span><br><span class="line">         - property可以是：</span><br><span class="line">            - driver 这是 JDBC 驱动的 Java 类全限定名。</span><br><span class="line">            - url 这是数据库的 JDBC URL 地址。</span><br><span class="line">            - username 登录数据库的用户名。</span><br><span class="line">            - password 登录数据库的密码。</span><br><span class="line">            - defaultTransactionIsolationLevel 默认的连接事务隔离级别。</span><br><span class="line">            - defaultNetworkTimeout 等待数据库操作完成的默认网络超时时间（单位：毫秒）</span><br><span class="line">      - **POOLED**：使用mybatis自己实现的数据库连接池，采用传统的javax.sql.DataSource规范，除了下面这些，UNPOOLED的也都可以使用</span><br><span class="line">         - property可以是（除了包含**UNPOOLED**中之外）：</span><br><span class="line">            - poolMaximumActiveConnections 连接池当中最多的正在使用的连接对象的数量上限。最多有多少个连接可以活动。默认值：10</span><br><span class="line">            - poolMaximumIdleCheckoutTime 强行让某个连接空闲，超时时间的设置</span><br><span class="line">            - poolMaximumIdleConnections 任意时间可能存在的空闲连接数。</span><br><span class="line">            - poolTimeToWait每隔多少秒打印日志，并且尝试获取连接对象</span><br><span class="line">            - 其它....</span><br><span class="line">      - **JNDI**：java命名目录接口，集成其他第三方数据库连接池，大部分web容器都实现了JNDI规范比如tomcat，采用服务器提供的JNDI技术实现来获取DataSource对象，不同的服务器所能拿到DataSource是不一样。如果不是web或者maven的war工程，JNDI是不能使用的。</span><br><span class="line">         - property可以是（最多只包含以下两个属性）：</span><br><span class="line">            - initial_context 这个属性用来在 InitialContext 中寻找上下文（即，initialContext.lookup(initial_context)）这是个可选属性，如果忽略，那么将会直接从 InitialContext 中寻找 data_source 属性。</span><br><span class="line">            - data_source 这是引用数据源实例位置的上下文路径。提供了 initial_context 配置时会在其返回的上下文中进行查找，没有提供时则直接在 InitialContext 中查找。</span><br><span class="line">   </span><br><span class="line">- mappers：在mappers标签中可以配置多个sql映射文件的路径。</span><br><span class="line"></span><br><span class="line">- mapper：配置某个sql映射文件的路径</span><br><span class="line">   - resource属性：使用相对于类路径的资源引用方式</span><br><span class="line">   - url属性：使用完全限定资源定位符（URL）方式</span><br><span class="line">## 4.1 environment</span><br><span class="line">mybatis-003-configuration</span><br><span class="line">```xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--默认使用开发环境--&gt;</span><br><span class="line">    &lt;!--&lt;environments default=&quot;dev&quot;&gt;--&gt;</span><br><span class="line">    &lt;!--默认使用生产环境--&gt;</span><br><span class="line">    &lt;environments default=&quot;production&quot;&gt;</span><br><span class="line">        &lt;!--开发环境--&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/powernode&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">        &lt;!--生产环境--&gt;</span><br><span class="line">        &lt;environment id=&quot;production&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot; /&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/mybatis&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;CarMapper.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line">```xml</span><br><span class="line">&lt;mapper namespace=&quot;car&quot;&gt;</span><br><span class="line">    &lt;insert id=&quot;insertCar&quot;&gt;</span><br><span class="line">        insert into t_car(id,car_num,brand,guide_price,produce_time,car_type) values(null,#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">```java</span><br><span class="line">public class ConfigurationTest &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testEnvironment() throws Exception&#123;</span><br><span class="line">        // 准备数据</span><br><span class="line">        Car car = new Car();</span><br><span class="line">        car.setCarNum(&quot;133&quot;);</span><br><span class="line">        car.setBrand(&quot;丰田霸道&quot;);</span><br><span class="line">        car.setGuidePrice(50.3);</span><br><span class="line">        car.setProduceTime(&quot;2020-01-10&quot;);</span><br><span class="line">        car.setCarType(&quot;燃油车&quot;);</span><br><span class="line"></span><br><span class="line">        // 一个数据库对应一个SqlSessionFactory对象</span><br><span class="line">        // 两个数据库对应两个SqlSessionFactory对象，以此类推</span><br><span class="line">        SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line"></span><br><span class="line">        // 使用默认数据库（默认production）</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;));</span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession(true);</span><br><span class="line">        int count = sqlSession.insert(&quot;car.insertCar&quot;, car);</span><br><span class="line">        System.out.println(&quot;插入了几条记录：&quot; + count);</span><br><span class="line"></span><br><span class="line">        // 使用指定数据库,后面的参数是String environment类型，用于指定环境</span><br><span class="line">        SqlSessionFactory sqlSessionFactory1 = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;), &quot;dev&quot;);</span><br><span class="line">        SqlSession sqlSession1 = sqlSessionFactory1.openSession(true);</span><br><span class="line">        int count1 = sqlSession1.insert(&quot;car.insertCar&quot;, car);</span><br><span class="line">        System.out.println(&quot;插入了几条记录：&quot; + count1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">执行结果：</span><br><span class="line">![FF0CD72D-D26C-4ccb-9202-593CDA8C53D8.png](./images/老杜MyBatis/1660117624656-64973cf7-6700-43da-96fa-5960dfc5045b.png#clientId=uf25371ce-2df6-4&amp;from=paste&amp;height=520&amp;id=ube5d1c7d&amp;originHeight=520&amp;originWidth=1627&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=122019&amp;status=done&amp;style=none&amp;taskId=ub5627b32-0df7-4e4d-9968-dc704671e6c&amp;title=&amp;width=1627)</span><br><span class="line">![B8C1BB12-6CB0-4f08-A96F-560B6268C8F8.png](./images/老杜MyBatis/1660117692466-ecd6317f-5868-4858-a33c-0c7ec68044ac.png#clientId=uf25371ce-2df6-4&amp;from=paste&amp;height=499&amp;id=ubeb926c4&amp;originHeight=499&amp;originWidth=756&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=32276&amp;status=done&amp;style=none&amp;taskId=u8350f504-6e73-4222-8172-415d1cf2331&amp;title=&amp;width=756)</span><br><span class="line">## 4.2 transactionManager</span><br><span class="line">```xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;MANAGED&quot;/&gt;</span><br><span class="line">```</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testTransactionManager() throws Exception&#123;</span><br><span class="line">    // 准备数据</span><br><span class="line">    Car car = new Car();</span><br><span class="line">    car.setCarNum(&quot;133&quot;);</span><br><span class="line">    car.setBrand(&quot;丰田霸道&quot;);</span><br><span class="line">    car.setGuidePrice(50.3);</span><br><span class="line">    car.setProduceTime(&quot;2020-01-10&quot;);</span><br><span class="line">    car.setCarType(&quot;燃油车&quot;);</span><br><span class="line">    // 获取SqlSessionFactory对象</span><br><span class="line">    SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config2.xml&quot;));</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">    // 执行SQL</span><br><span class="line">    int count = sqlSession.insert(&quot;insertCar&quot;, car);</span><br><span class="line">    System.out.println(&quot;插入了几条记录：&quot; + count);</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">当事务管理器是：JDBC</span><br><span class="line"></span><br><span class="line">- 采用JDBC的原生事务机制：</span><br><span class="line">   - 开启事务：conn.setAutoCommit(false);</span><br><span class="line">   - 处理业务......</span><br><span class="line">   - 提交事务：conn.commit();</span><br><span class="line"></span><br><span class="line">当事务管理器是：MANAGED</span><br><span class="line"></span><br><span class="line">- 交给容器去管理事务，但目前使用的是本地程序，没有容器的支持，**当mybatis找不到容器的支持时：没有事务**。也就是说只要执行一条DML语句，则提交一次。</span><br><span class="line">## 4.3 dataSource</span><br><span class="line">```xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;UNPOOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/powernode&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;CarMapper.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testDataSource() throws Exception&#123;</span><br><span class="line">    // 准备数据</span><br><span class="line">    Car car = new Car();</span><br><span class="line">    car.setCarNum(&quot;133&quot;);</span><br><span class="line">    car.setBrand(&quot;丰田霸道&quot;);</span><br><span class="line">    car.setGuidePrice(50.3);</span><br><span class="line">    car.setProduceTime(&quot;2020-01-10&quot;);</span><br><span class="line">    car.setCarType(&quot;燃油车&quot;);</span><br><span class="line">    // 获取SqlSessionFactory对象</span><br><span class="line">    SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config3.xml&quot;));</span><br><span class="line">    // 获取SqlSession对象</span><br><span class="line">    SqlSession sqlSession = sqlSessionFactory.openSession(true);</span><br><span class="line">    // 执行SQL</span><br><span class="line">    int count = sqlSession.insert(&quot;insertCar&quot;, car);</span><br><span class="line">    System.out.println(&quot;插入了几条记录：&quot; + count);</span><br><span class="line">    // 关闭会话</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">当type是UNPOOLED，控制台输出：</span><br><span class="line">![D58DF616-529B-41c7-8C0F-8A931A380497.png](./images/老杜MyBatis/1660125487038-29390827-4e20-431a-8d62-f56a40bf0349.png#averageHue=%2333302f&amp;clientId=uf25371ce-2df6-4&amp;from=paste&amp;height=275&amp;id=u12a918bf&amp;originHeight=275&amp;originWidth=1637&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=50045&amp;status=done&amp;style=none&amp;taskId=ud5ec24dc-2635-4d39-9ac2-ee47e88b08f&amp;title=&amp;width=1637)</span><br><span class="line">修改配置文件mybatis-config3.xml中的配置：</span><br><span class="line">```xml</span><br><span class="line">&lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">```</span><br><span class="line">Java测试程序不需要修改，直接执行，看控制台输出：</span><br><span class="line">![8DFDAF99-AA22-41cd-99C7-227A4667A0EB.png](./images/老杜MyBatis/1660125701333-b14f63d8-c442-4211-ad77-884f21162357.png#averageHue=%2334302f&amp;clientId=uf25371ce-2df6-4&amp;from=paste&amp;height=435&amp;id=u52280792&amp;originHeight=435&amp;originWidth=1628&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=93482&amp;status=done&amp;style=none&amp;taskId=ub425fbf6-8f9b-4955-8fa5-425a4fd2abb&amp;title=&amp;width=1628)</span><br><span class="line">通过测试得出：UNPOOLED不会使用连接池，每一次都会新建JDBC连接对象。POOLED会使用数据库连接池。【这个连接池是mybatis自己实现的。】</span><br><span class="line">```xml</span><br><span class="line">&lt;dataSource type=&quot;JNDI&quot;&gt;</span><br><span class="line">```</span><br><span class="line">JNDI的方式：表示对接JNDI服务器中的连接池。这种方式给了我们可以使用第三方连接池的接口。如果想使用dbcp、c3p0、druid（德鲁伊）等，需要使用这种方式。</span><br><span class="line">这种再重点说一下type=&quot;POOLED&quot;的时候，它的属性有哪些？</span><br><span class="line">```xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/powernode&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;!--最大连接数--&gt;</span><br><span class="line">                &lt;property name=&quot;poolMaximumActiveConnections&quot; value=&quot;3&quot;/&gt;</span><br><span class="line">                &lt;!--这是一个底层设置，如果获取连接花费了相当长的时间，连接池会打印状态日志并重新尝试获取一个连接（避免在误配置的情况下一直失败且不打印日志），默认值：20000 毫秒（即 20 秒）。--&gt;</span><br><span class="line">                &lt;property name=&quot;poolTimeToWait&quot; value=&quot;20000&quot;/&gt;</span><br><span class="line">                &lt;!--强行回归池的时间--&gt;</span><br><span class="line">                &lt;property name=&quot;poolMaximumCheckoutTime&quot; value=&quot;20000&quot;/&gt;</span><br><span class="line">                &lt;!--最多空闲数量--&gt;</span><br><span class="line">                &lt;property name=&quot;poolMaximumIdleConnections&quot; value=&quot;1&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;CarMapper.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line">poolMaximumActiveConnections：最大的活动的连接数量。默认值10</span><br><span class="line">poolMaximumIdleConnections：最大的空闲连接数量。默认值5</span><br><span class="line">poolMaximumCheckoutTime：强行回归池的时间。默认值20秒。</span><br><span class="line">poolTimeToWait：当无法获取到空闲连接时，每隔20秒打印一次日志，避免因代码配置有误，导致傻等。（时长是可以配置的）</span><br><span class="line">当然，还有其他属性。对于连接池来说，以上几个属性比较重要。</span><br><span class="line">最大的活动的连接数量就是连接池连接数量的上限。默认值10，如果有10个请求正在使用这10个连接，第11个请求只能等待空闲连接。</span><br><span class="line">最大的空闲连接数量。默认值5，如何已经有了5个空闲连接，当第6个连接要空闲下来的时候，连接池会选择关闭该连接对象。来减少数据库的开销。</span><br><span class="line">需要根据系统的并发情况，来合理调整连接池最大连接数以及最多空闲数量。充分发挥数据库连接池的性能。【可以根据实际情况进行测试，然后调整一个合理的数量。】</span><br><span class="line">下图是默认配置：</span><br><span class="line">![9970FDF3-6A6A-4530-84A3-B72FE189124E.png](./images/老杜MyBatis/1660126871013-88f83ea4-94e9-4088-bdb4-06a4fd73866a.png#averageHue=%233d4042&amp;clientId=uf25371ce-2df6-4&amp;from=paste&amp;height=348&amp;id=u3a10ea73&amp;originHeight=348&amp;originWidth=640&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=22150&amp;status=done&amp;style=none&amp;taskId=u43582ddf-d276-4250-aefb-35db3c377e4&amp;title=&amp;width=640)</span><br><span class="line">在以上配置的基础之上，可以编写java程序测试：</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testPool() throws Exception&#123;</span><br><span class="line">    SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config3.xml&quot;));</span><br><span class="line">    for (int i = 0; i &lt; 4; i++) &#123;</span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        Object selectCarByCarNum = sqlSession.selectOne(&quot;selectCarByCarNum&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">```xml</span><br><span class="line">&lt;select id=&quot;selectCarByCarNum&quot; resultType=&quot;com.powernode.mybatis.pojo.Car&quot;&gt;</span><br><span class="line">  select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car where car_num = &#x27;100&#x27;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">```</span><br><span class="line">![E2C814E9-489D-4f4a-94F6-2ED5F6E56F54.png](./images/老杜MyBatis/1660128646511-8df1006a-dd85-48d1-9b88-ce7969d9b546.png#averageHue=%2335302f&amp;clientId=uf25371ce-2df6-4&amp;from=paste&amp;height=748&amp;id=u2b331339&amp;originHeight=748&amp;originWidth=1507&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=165804&amp;status=done&amp;style=none&amp;taskId=ud490fe5a-777b-41eb-9b83-a702e843fe3&amp;title=&amp;width=1507)</span><br><span class="line">## 4.4 properties</span><br><span class="line">mybatis提供了更加灵活的配置，连接数据库的信息可以单独写到一个属性资源文件中，假设在类的根路径下创建jdbc.properties文件，配置如下：</span><br><span class="line">```properties</span><br><span class="line">jdbc.driver=com.mysql.cj.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://localhost:3306/powernode</span><br><span class="line">```</span><br><span class="line">在mybatis核心配置文件中引入并使用：</span><br><span class="line">```xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--引入外部属性资源文件--&gt;</span><br><span class="line">    &lt;properties resource=&quot;jdbc.properties&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;jdbc.username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;jdbc.password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;!--$&#123;key&#125;使用--&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;$&#123;jdbc.driver&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;CarMapper.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line">编写Java程序进行测试：</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testProperties() throws Exception&#123;</span><br><span class="line">    SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config4.xml&quot;));</span><br><span class="line">    SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">    Object car = sqlSession.selectOne(&quot;selectCarByCarNum&quot;);</span><br><span class="line">    System.out.println(car);</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">**properties两个属性：**</span><br><span class="line">**resource：这个属性从类的根路径下开始加载。【常用的。】**</span><br><span class="line">**url：从指定的url加载，假设文件放在d:/jdbc.properties，这个url可以写成：file:///d:/jdbc.properties。注意是三个斜杠哦。**</span><br><span class="line">注意：如果不知道mybatis-config.xml文件中标签的编写顺序的话，可以有两种方式知道它的顺序：</span><br><span class="line"></span><br><span class="line">- 第一种方式：查看dtd约束文件。</span><br><span class="line">- 第二种方式：通过idea的报错提示信息。【一般采用这种方式】</span><br><span class="line">## 4.5 mapper</span><br><span class="line">mapper标签用来指定SQL映射文件的路径，包含多种指定方式，这里先主要看其中两种：</span><br><span class="line">第一种：resource，从类的根路径下开始加载【比url常用】</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper resource=&quot;CarMapper.xml&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br><span class="line">```</span><br><span class="line">如果是这样写的话，必须保证类的根下有CarMapper.xml文件。</span><br><span class="line">如果类的根路径下有一个包叫做test，CarMapper.xml如果放在test包下的话，这个配置应该是这样写：</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper resource=&quot;test/CarMapper.xml&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br><span class="line">```</span><br><span class="line">第二种：url，从指定的url位置加载</span><br><span class="line">假设CarMapper.xml文件放在d盘的根下，这个配置就需要这样写：</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper url=&quot;file:///d:/CarMapper.xml&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br><span class="line">```</span><br><span class="line">**mapper还有其他的指定方式，后面再看！！！**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![](./images/老杜MyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#averageHue=%23dad8d7&amp;from=url&amp;id=hqhDQ&amp;originHeight=152&amp;originWidth=1180&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=)</span><br><span class="line"># 五、手写MyBatis框架（掌握原理）</span><br><span class="line">警示：该部分内容有难度，基础较弱的程序员可能有些部分是听不懂的，如果无法跟下来，可直接跳过，不影响后续知识点的学习。当然，如果你要能够跟下来，必然会让你加深对MyBatis框架的理解。</span><br><span class="line">**我们给自己的框架起个名：GodBatis（起名灵感来源于：my god!!! 我的天呢！）**</span><br><span class="line"></span><br><span class="line">## 5.1 dom4j解析XML文件</span><br><span class="line">该部分内容不再赘述，不会解析XML的，请观看老杜前面讲解的dom4j解析XML文件的视频。</span><br><span class="line">模块名：parse-xml-by-dom4j（普通的Java Maven模块）</span><br><span class="line">第一步：引入dom4j的依赖</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;org.group&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;parse-xml-by-dom4j&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!--dom4j依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.dom4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dom4j&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.1.3&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--jaxen依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;jaxen&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jaxen&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--junit依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.13.2&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br><span class="line">```</span><br><span class="line">第二步：编写配置文件godbatis-config.xml</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/powernode&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">        &lt;mappers&gt;</span><br><span class="line">            &lt;mapper resource=&quot;sqlmapper.xml&quot;/&gt;</span><br><span class="line">        &lt;/mappers&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line">第三步：解析godbatis-config.xml</span><br><span class="line">```java</span><br><span class="line">package com.powernode.dom4j;</span><br><span class="line"></span><br><span class="line">import org.dom4j.Document;</span><br><span class="line">import org.dom4j.Element;</span><br><span class="line">import org.dom4j.Node;</span><br><span class="line">import org.dom4j.io.SAXReader;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 使用dom4j解析XML文件</span><br><span class="line"> */</span><br><span class="line">public class ParseXMLByDom4jTest &#123;</span><br><span class="line">    @Test</span><br><span class="line">    public void testGodBatisConfigXML() throws Exception&#123;</span><br><span class="line"></span><br><span class="line">        // 读取xml，返回document对象</span><br><span class="line">        SAXReader reader = new SAXReader();</span><br><span class="line">        // 括号内的是获取输入流，然后读取xml文件，返回document对象。document对象是文档对象，代表了整个XML文件。</span><br><span class="line">        Document document = reader.read(ClassLoader.getSystemClassLoader().getResourceAsStream(&quot;mybatis-config.xml&quot;));</span><br><span class="line"></span><br><span class="line">        // 获取文档当中的根标签</span><br><span class="line">Element rootElt = document.getRootElement();</span><br><span class="line">String rootEltName = rootElt.getName();</span><br><span class="line">System.out.println(&quot;根节点的名字:&quot;+ rootEltName);</span><br><span class="line">        </span><br><span class="line">        // 获取&lt;environments&gt;标签的default属性的值</span><br><span class="line">        //xpath是做标签路径匹配的。能够让我们快速定位XML文件中的元素，后面的内容代表从根下开始找configuration标签，然后找configuration标签下的子标</span><br><span class="line">        String xpath = &quot;/configuration/environments&quot;;</span><br><span class="line">        Element environments = (Element)document.selectSingleNode(xpath);签environments// Element是Node类的子类，方法更多，使用更便捷，要强转</span><br><span class="line">        // 获取属性的值</span><br><span class="line">        String defaultId = environmentsElt.attributeValue(&quot;default&quot;);</span><br><span class="line">        System.out.println(&quot;默认环境的id&quot; + defaultId);</span><br><span class="line">        //根据默认id获取具体的环境environment</span><br><span class="line">        xpath = &quot;/configuration/environments/environment[@id=&#x27;&quot;+defaultEnvironmentId+&quot;&#x27;]&quot;;</span><br><span class="line">        System.out.println(xpath);</span><br><span class="line"></span><br><span class="line">        // 获取事务管理器类型(transactionManager节点)，Element的element()方法用来获取孩子节点</span><br><span class="line">        Element transactionManager = environment.element(&quot;transactionManager&quot;);</span><br><span class="line">        String transactionManagerType = transactionManager.attributeValue(&quot;type&quot;);</span><br><span class="line">        System.out.println(transactionManagerType);</span><br><span class="line"></span><br><span class="line">        // 获取数据源(dataSource)类型</span><br><span class="line">        Element dataSource = environmentElt.element(&quot;dataSource&quot;);</span><br><span class="line">        String dataSourceType = dataSource.attributeValue(&quot;type&quot;);</span><br><span class="line">        System.out.println(dataSourceType);</span><br><span class="line"></span><br><span class="line">        // 将dataSource信息封装到List集合，然后获取dataSource节点下的所有子节点</span><br><span class="line">        List&lt;Element&gt; propertyElts = dataSource.elements();</span><br><span class="line">// 遍历</span><br><span class="line">propertyElts.forEach(propertyElt -&gt;&#123;</span><br><span class="line">String name = propertyElt.attributeValue(&quot;name&quot;);</span><br><span class="line">String value = propertyElt.attributeValue(&quot;value&quot;);</span><br><span class="line">System.out.println(name + &quot;=&quot; + value);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        // 获取所有的mapper标签</span><br><span class="line">//不想从根下开始获取，你想从任意位置开始，获取所有的某个标签，xpath该这样写</span><br><span class="line">xpath =&quot;//mapper&quot;;//两个斜杠</span><br><span class="line">List&lt;Node&gt; mappers = document.selectNodes(xpath);</span><br><span class="line">// 遍历</span><br><span class="line">mappers.forEach(mapper -&gt;&#123;</span><br><span class="line">Element mapperElt =(Element)mapper;</span><br><span class="line">String resource = mapperElt.attributeValue( s: &quot;resource&quot;);</span><br><span class="line">            System.out.println(resource);</span><br><span class="line">&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">执行结果：</span><br><span class="line">![D1EE8DEE-5612-4fc7-9C3C-EA1C260B01F4.png](./images/老杜MyBatis/1660182883453-edbe3196-015a-4c7e-b318-1593089d5496.png#averageHue=%232d2c2c&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=229&amp;id=u7883e666&amp;originHeight=229&amp;originWidth=513&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=12448&amp;status=done&amp;style=none&amp;taskId=u141e0182-ddb8-4910-9090-e352e7914da&amp;title=&amp;width=513)</span><br><span class="line">第四步：编写配置文件CarMapper.xml</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=&quot;car&quot;&gt;</span><br><span class="line">    &lt;insert id=&quot;insertCar&quot;&gt;</span><br><span class="line">        insert into t_car(id,car_num,brand,guide_price,produce_time,car_type) values(null,#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">    &lt;select id=&quot;selectCarByCarNum&quot; resultType=&quot;com.powernode.mybatis.pojo.Car&quot;&gt;</span><br><span class="line">        select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car where car_num = #&#123;carNum&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">第五步：解析CarMapper.xml</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testParseSqlMapperXML() throws Exception&#123;</span><br><span class="line">    // 读取xml，获取document对象</span><br><span class="line">    SAXReader saxReader = new SAXReader();</span><br><span class="line">    Document document = saxReader.read(Thread.currentThread().getContextClassLoader().getResourceAsStream(&quot;CarMapper.xml&quot;));</span><br><span class="line"></span><br><span class="line">    // 获取namespace</span><br><span class="line">    String xpath = &quot;/mapper&quot;;</span><br><span class="line">    Element mapperElt = (Element) document.selectSingleNode(xpath);</span><br><span class="line">    String namespace = mapperElt.attributeValue(&quot;namespace&quot;);</span><br><span class="line">    System.out.println(namespace);</span><br><span class="line"></span><br><span class="line">    // 获取mapper节点下所有的子节点</span><br><span class="line">    List&lt;Element&gt; elements = mapper.elements();</span><br><span class="line">    // 遍历</span><br><span class="line">    elements().forEach(elements -&gt; &#123;</span><br><span class="line">        // 获取sqlId</span><br><span class="line">        String id = elements.attributeValue(&quot;id&quot;);</span><br><span class="line">        System.out.println(id);</span><br><span class="line">        // 如果是select标签，还要获取它的resultType</span><br><span class="line">        String resultType = elements.attributeValue(&quot;resultType&quot;);//没有这个属性的话会自动返回&quot;null“</span><br><span class="line">        System.out.println(&quot;resultType:&quot; + resultType);</span><br><span class="line"></span><br><span class="line">        // sql语句(getTextTrim表示获取标签中的文本内容，而且去除前后空白)</span><br><span class="line">        String sql = statementElt.getTextTrim();</span><br><span class="line">        System.out.println(&quot;sql:&quot; + sql);</span><br><span class="line">        // mybaits封装了jdbc。早晚要执行带有?的sql语句。</span><br><span class="line">// 转换</span><br><span class="line">String newSql =sql.replaceAll(&quot;#\\&#123;[0-9A-Za-z_$]*&#125;&quot;,&quot;?&quot;);</span><br><span class="line">System.out.println(newSql);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">执行结果：</span><br><span class="line">![41A93BE0-3374-4283-97DE-152288504BE3.png](./images/老杜MyBatis/1660183887361-baffabf0-4caa-4e64-86d0-5d5dcfb1edd6.png#averageHue=%232d2c2c&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=232&amp;id=ubad124f6&amp;originHeight=232&amp;originWidth=1487&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=23737&amp;status=done&amp;style=none&amp;taskId=ubf72afc9-79ef-4242-9275-606aa95feec&amp;title=&amp;width=1487)</span><br><span class="line">## 5.2 GodBatis</span><br><span class="line">手写框架之前，如果没有思路，可以先参考一下mybatis的客户端程序，通过客户端程序来逆推需要的类，参考代码：</span><br><span class="line">```java</span><br><span class="line">@Test</span><br><span class="line">public void testInsert()&#123;</span><br><span class="line">    SqlSession sqlSession = null;</span><br><span class="line">    try &#123;</span><br><span class="line">        // 1.创建SqlSessionFactoryBuilder对象</span><br><span class="line">        SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">        // 2.创建SqlSessionFactory对象</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;));</span><br><span class="line">        // 3.创建SqlSession对象</span><br><span class="line">        sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        // 4.执行SQL</span><br><span class="line">        Car car = new Car(null, &quot;111&quot;, &quot;宝马X7&quot;, &quot;70.3&quot;, &quot;2010-10-11&quot;, &quot;燃油车&quot;);</span><br><span class="line">        int count = sqlSession.insert(&quot;insertCar&quot;,car);</span><br><span class="line">        System.out.println(&quot;更新了几条记录：&quot; + count);</span><br><span class="line">        // 5.提交</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        // 回滚</span><br><span class="line">        if (sqlSession != null) &#123;</span><br><span class="line">            sqlSession.rollback();</span><br><span class="line">        &#125;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        // 6.关闭</span><br><span class="line">        if (sqlSession != null) &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testSelectOne()&#123;</span><br><span class="line">    SqlSession sqlSession = null;</span><br><span class="line">    try &#123;</span><br><span class="line">        // 1.创建SqlSessionFactoryBuilder对象</span><br><span class="line">        SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">        // 2.创建SqlSessionFactory对象</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;));</span><br><span class="line">        // 3.创建SqlSession对象</span><br><span class="line">        sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        // 4.执行SQL</span><br><span class="line">        Car car = (Car)sqlSession.selectOne(&quot;selectCarByCarNum&quot;, &quot;111&quot;);</span><br><span class="line">        System.out.println(car);</span><br><span class="line">        // 5.提交</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        // 回滚</span><br><span class="line">        if (sqlSession != null) &#123;</span><br><span class="line">            sqlSession.rollback();</span><br><span class="line">        &#125;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        // 6.关闭</span><br><span class="line">        if (sqlSession != null) &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">### 第一步：IDEA中创建模块</span><br><span class="line">模块：godbatis（创建普通的Java Maven模块，打包方式jar），引入相关依赖</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;org.god&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;godbatis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0.0&lt;/version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!--dom4j依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.dom4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dom4j&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.1.3&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--jaxen依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;jaxen&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jaxen&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--junit依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.13.2&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br><span class="line">```</span><br><span class="line">### 第二步：资源工具类，方便获取指向配置文件的输入流</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import java.io.InputStream;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 资源工具类</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class Resources &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 从类路径中获取配置文件的输入流</span><br><span class="line">     * @param config</span><br><span class="line">     * @return 输入流，该输入流指向类路径中的配置文件</span><br><span class="line">     */</span><br><span class="line">    public static InputStream getResourcesAsStream(String config)&#123;</span><br><span class="line">        return Thread.currentThread().getContextClassLoader().getResourceAsStream(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">### 第三步：定义SqlSessionFactoryBuilder类</span><br><span class="line">提供一个无参数构造方法，再提供一个build方法，该build方法要返回SqlSessionFactory对象</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import java.io.InputStream;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * SqlSessionFactory对象构建器</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class SqlSessionFactoryBuilder &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 创建构建器对象</span><br><span class="line">     */</span><br><span class="line">    public SqlSessionFactoryBuilder() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取SqlSessionFactory对象</span><br><span class="line">     * 该方法主要功能是：读取godbatis核心配置文件，并构建SqlSessionFactory对象</span><br><span class="line">     * @param inputStream 指向核心配置文件的输入流</span><br><span class="line">     * @return SqlSessionFactory对象</span><br><span class="line">     */</span><br><span class="line">    public SqlSessionFactory build(InputStream inputStream)&#123;</span><br><span class="line">        // 解析配置文件，创建数据源对象</span><br><span class="line">        // 解析配置文件，创建事务管理器对象</span><br><span class="line">        // 解析配置文件，获取所有的SQL映射对象</span><br><span class="line">        // 将以上信息封装到SqlSessionFactory对象中</span><br><span class="line">        // 返回</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">### 第四步：分析SqlSessionFactory类中有哪些属性</span><br><span class="line"></span><br><span class="line">- 事务管理器</span><br><span class="line">   - GodJDBCTransaction</span><br><span class="line">- SQL映射对象集合</span><br><span class="line">   - Map&lt;String, GodMappedStatement&gt;</span><br><span class="line">### 第五步：定义GodJDBCTransaction</span><br><span class="line">事务管理器最好是定义一个接口，然后每一个具体的事务管理器都实现这个接口。</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 事务管理器接口</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public interface TransactionManager &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 提交事务</span><br><span class="line">     */</span><br><span class="line">    void commit();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 回滚事务</span><br><span class="line">     */</span><br><span class="line">    void rollback();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 关闭事务</span><br><span class="line">     */</span><br><span class="line">    void close();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 开启连接</span><br><span class="line">     */</span><br><span class="line">    void openConnection();</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 获取连接对象</span><br><span class="line">     * @return 连接对象</span><br><span class="line">     */</span><br><span class="line">    Connection getConnection();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import javax.sql.DataSource;</span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 事务管理器</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class GodJDBCTransaction implements TransactionManager &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 连接对象，控制事务时需要</span><br><span class="line">     */</span><br><span class="line">    private Connection conn;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 数据源对象</span><br><span class="line">     */</span><br><span class="line">    private DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 自动提交标志：</span><br><span class="line">     * true表示自动提交</span><br><span class="line">     * false表示不自动提交</span><br><span class="line">     */</span><br><span class="line">    private boolean autoCommit;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 构造事务管理器对象</span><br><span class="line">     * @param autoCommit</span><br><span class="line">     */</span><br><span class="line">    public GodJDBCTransaction(DataSource dataSource, boolean autoCommit) &#123;</span><br><span class="line">        this.dataSource = dataSource;</span><br><span class="line">        this.autoCommit = autoCommit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 提交事务</span><br><span class="line">     */</span><br><span class="line">    public void commit()&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            conn.commit();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 回滚事务</span><br><span class="line">     */</span><br><span class="line">    public void rollback()&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            conn.rollback();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void close() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            conn.close();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void openConnection() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            this.conn = dataSource.getConnection();</span><br><span class="line">            this.conn.setAutoCommit(this.autoCommit);</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Connection getConnection() &#123;</span><br><span class="line">        return conn;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">### 第六步：事务管理器中需要数据源，定义GodUNPOOLEDDataSource</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import java.io.PrintWriter;</span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.DriverManager;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.sql.SQLFeatureNotSupportedException;</span><br><span class="line">import java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 数据源实现类，不使用连接池</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class GodUNPOOLEDDataSource implements javax.sql.DataSource&#123;</span><br><span class="line">    private String url;</span><br><span class="line">    private String username;</span><br><span class="line">    private String password;</span><br><span class="line"></span><br><span class="line">    public GodUNPOOLEDDataSource(String driver, String url, String username, String password) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            // 注册驱动</span><br><span class="line">            Class.forName(driver);</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">        this.url = url;</span><br><span class="line">        this.username = username;</span><br><span class="line">        this.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Connection getConnection() throws SQLException &#123;</span><br><span class="line">        return DriverManager.getConnection(url, username, password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Connection getConnection(String username, String password) throws SQLException &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public PrintWriter getLogWriter() throws SQLException &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setLogWriter(PrintWriter out) throws SQLException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setLoginTimeout(int seconds) throws SQLException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int getLoginTimeout() throws SQLException &#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Logger getParentLogger() throws SQLFeatureNotSupportedException &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public &lt;T&gt; T unwrap(Class&lt;T&gt; iface) throws SQLException &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean isWrapperFor(Class&lt;?&gt; iface) throws SQLException &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">### 第七步：定义GodMappedStatement</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * SQL映射实体类</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class GodMappedStatement &#123;</span><br><span class="line">    private String sqlId;</span><br><span class="line">    private String resultType;</span><br><span class="line">    private String sql;</span><br><span class="line">    private String parameterType;</span><br><span class="line"></span><br><span class="line">    private String sqlType;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;GodMappedStatement&#123;&quot; +</span><br><span class="line">                &quot;sqlId=&#x27;&quot; + sqlId + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, resultType=&#x27;&quot; + resultType + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, sql=&#x27;&quot; + sql + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, parameterType=&#x27;&quot; + parameterType + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, sqlType=&#x27;&quot; + sqlType + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSqlId() &#123;</span><br><span class="line">        return sqlId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSqlId(String sqlId) &#123;</span><br><span class="line">        this.sqlId = sqlId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getResultType() &#123;</span><br><span class="line">        return resultType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setResultType(String resultType) &#123;</span><br><span class="line">        this.resultType = resultType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSql() &#123;</span><br><span class="line">        return sql;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSql(String sql) &#123;</span><br><span class="line">        this.sql = sql;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getParameterType() &#123;</span><br><span class="line">        return parameterType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setParameterType(String parameterType) &#123;</span><br><span class="line">        this.parameterType = parameterType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSqlType() &#123;</span><br><span class="line">        return sqlType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSqlType(String sqlType) &#123;</span><br><span class="line">        this.sqlType = sqlType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public GodMappedStatement(String sqlId, String resultType, String sql, String parameterType, String sqlType) &#123;</span><br><span class="line">        this.sqlId = sqlId;</span><br><span class="line">        this.resultType = resultType;</span><br><span class="line">        this.sql = sql;</span><br><span class="line">        this.parameterType = parameterType;</span><br><span class="line">        this.sqlType = sqlType;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">### 第八步：完善SqlSessionFactory类</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import javax.sql.DataSource;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * SqlSession工厂对象，使用SqlSessionFactory可以获取会话对象</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class SqlSessionFactory &#123;</span><br><span class="line">    private TransactionManager transactionManager;</span><br><span class="line">    private Map&lt;String, GodMappedStatement&gt; mappedStatements;</span><br><span class="line"></span><br><span class="line">    public SqlSessionFactory(TransactionManager transactionManager, Map&lt;String, GodMappedStatement&gt; mappedStatements) &#123;</span><br><span class="line">        this.transactionManager = transactionManager;</span><br><span class="line">        this.mappedStatements = mappedStatements;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public TransactionManager getTransactionManager() &#123;</span><br><span class="line">        return transactionManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTransactionManager(TransactionManager transactionManager) &#123;</span><br><span class="line">        this.transactionManager = transactionManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Map&lt;String, GodMappedStatement&gt; getMappedStatements() &#123;</span><br><span class="line">        return mappedStatements;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMappedStatements(Map&lt;String, GodMappedStatement&gt; mappedStatements) &#123;</span><br><span class="line">        this.mappedStatements = mappedStatements;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">### 第九步：完善SqlSessionFactoryBuilder中的build方法</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import org.dom4j.Document;</span><br><span class="line">import org.dom4j.DocumentException;</span><br><span class="line">import org.dom4j.Element;</span><br><span class="line">import org.dom4j.io.SAXReader;</span><br><span class="line"></span><br><span class="line">import javax.sql.DataSource;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * SqlSessionFactory对象构建器</span><br><span class="line"> *</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class SqlSessionFactoryBuilder &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 创建构建器对象</span><br><span class="line">     */</span><br><span class="line">    public SqlSessionFactoryBuilder() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取SqlSessionFactory对象</span><br><span class="line">     * 该方法主要功能是：读取godbatis核心配置文件，并构建SqlSessionFactory对象</span><br><span class="line">     *</span><br><span class="line">     * @param inputStream 指向核心配置文件的输入流</span><br><span class="line">     * @return SqlSessionFactory对象</span><br><span class="line">     */</span><br><span class="line">    public SqlSessionFactory build(InputStream inputStream) throws DocumentException &#123;</span><br><span class="line">        SAXReader saxReader = new SAXReader();</span><br><span class="line">        Document document = saxReader.read(inputStream);</span><br><span class="line">        Element environmentsElt = (Element) document.selectSingleNode(&quot;/configuration/environments&quot;);</span><br><span class="line">        String defaultEnv = environmentsElt.attributeValue(&quot;default&quot;);</span><br><span class="line">        Element environmentElt = (Element) document.selectSingleNode(&quot;/configuration/environments/environment[@id=&#x27;&quot; + defaultEnv + &quot;&#x27;]&quot;);</span><br><span class="line">        // 解析配置文件，创建数据源对象</span><br><span class="line">        Element dataSourceElt = environmentElt.element(&quot;dataSource&quot;);</span><br><span class="line">        DataSource dataSource = getDataSource(dataSourceElt);</span><br><span class="line">        // 解析配置文件，创建事务管理器对象</span><br><span class="line">        Element transactionManagerElt = environmentElt.element(&quot;transactionManager&quot;);</span><br><span class="line">        TransactionManager transactionManager = getTransactionManager(transactionManagerElt, dataSource);</span><br><span class="line">        // 解析配置文件，获取所有的SQL映射对象</span><br><span class="line">        Element mappers = environmentsElt.element(&quot;mappers&quot;);</span><br><span class="line">        Map&lt;String, GodMappedStatement&gt; mappedStatements = getMappedStatements(mappers);</span><br><span class="line">        // 将以上信息封装到SqlSessionFactory对象中</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = new SqlSessionFactory(transactionManager, mappedStatements);</span><br><span class="line">        // 返回</span><br><span class="line">        return sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Map&lt;String, GodMappedStatement&gt; getMappedStatements(Element mappers) &#123;</span><br><span class="line">        Map&lt;String, GodMappedStatement&gt; mappedStatements = new HashMap&lt;&gt;();</span><br><span class="line">        mappers.elements().forEach(mapperElt -&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                String resource = mapperElt.attributeValue(&quot;resource&quot;);</span><br><span class="line">                SAXReader saxReader = new SAXReader();</span><br><span class="line">                Document document = saxReader.read(Resources.getResourcesAsStream(resource));</span><br><span class="line">                Element mapper = (Element) document.selectSingleNode(&quot;/mapper&quot;);</span><br><span class="line">                String namespace = mapper.attributeValue(&quot;namespace&quot;);</span><br><span class="line"></span><br><span class="line">                mapper.elements().forEach(sqlMapper -&gt; &#123;</span><br><span class="line">                    String sqlId = sqlMapper.attributeValue(&quot;id&quot;);</span><br><span class="line">                    String sql = sqlMapper.getTextTrim();</span><br><span class="line">                    String parameterType = sqlMapper.attributeValue(&quot;parameterType&quot;);</span><br><span class="line">                    String resultType = sqlMapper.attributeValue(&quot;resultType&quot;);</span><br><span class="line">                    String sqlType = sqlMapper.getName().toLowerCase();</span><br><span class="line">                    // 封装GodMappedStatement对象</span><br><span class="line">                    GodMappedStatement godMappedStatement = new GodMappedStatement(sqlId, resultType, sql, parameterType, sqlType);</span><br><span class="line">                    mappedStatements.put(namespace + &quot;.&quot; + sqlId, godMappedStatement);</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">            &#125; catch (DocumentException e) &#123;</span><br><span class="line">                throw new RuntimeException(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return mappedStatements;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private TransactionManager getTransactionManager(Element transactionManagerElt, DataSource dataSource) &#123;</span><br><span class="line">        String type = transactionManagerElt.attributeValue(&quot;type&quot;).toUpperCase();</span><br><span class="line">        TransactionManager transactionManager = null;</span><br><span class="line">        if (&quot;JDBC&quot;.equals(type)) &#123;</span><br><span class="line">            // 使用JDBC事务</span><br><span class="line">            transactionManager = new GodJDBCTransaction(dataSource, false);</span><br><span class="line">        &#125; else if (&quot;MANAGED&quot;.equals(type)) &#123;</span><br><span class="line">            // 事务管理器是交给JEE容器的</span><br><span class="line">        &#125;</span><br><span class="line">        return transactionManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private DataSource getDataSource(Element dataSourceElt) &#123;</span><br><span class="line">        // 获取所有数据源的属性配置</span><br><span class="line">        Map&lt;String, String&gt; dataSourceMap = new HashMap&lt;&gt;();</span><br><span class="line">        dataSourceElt.elements().forEach(propertyElt -&gt; &#123;</span><br><span class="line">            dataSourceMap.put(propertyElt.attributeValue(&quot;name&quot;), propertyElt.attributeValue(&quot;value&quot;));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        String dataSourceType = dataSourceElt.attributeValue(&quot;type&quot;).toUpperCase();</span><br><span class="line">        DataSource dataSource = null;</span><br><span class="line">        if (&quot;POOLED&quot;.equals(dataSourceType)) &#123;</span><br><span class="line"></span><br><span class="line">        &#125; else if (&quot;UNPOOLED&quot;.equals(dataSourceType)) &#123;</span><br><span class="line">            dataSource = new GodUNPOOLEDDataSource(dataSourceMap.get(&quot;driver&quot;), dataSourceMap.get(&quot;url&quot;), dataSourceMap.get(&quot;username&quot;), dataSourceMap.get(&quot;password&quot;));</span><br><span class="line">        &#125; else if (&quot;JNDI&quot;.equals(dataSourceType)) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        return dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">### 第十步：在SqlSessionFactory中添加openSession方法</span><br><span class="line">```java</span><br><span class="line">public SqlSession openSession()&#123;</span><br><span class="line">    transactionManager.openConnection();</span><br><span class="line">    SqlSession sqlSession = new SqlSession(transactionManager, mappedStatements);</span><br><span class="line">    return sqlSession;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">### 第十一步：编写SqlSession类中commit rollback close方法</span><br><span class="line">```java</span><br><span class="line">package org.god.core;</span><br><span class="line"></span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 数据库会话对象</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class SqlSession &#123;</span><br><span class="line">    private TransactionManager transactionManager;</span><br><span class="line">    private Map&lt;String, GodMappedStatement&gt; mappedStatements;</span><br><span class="line"></span><br><span class="line">    public SqlSession(TransactionManager transactionManager, Map&lt;String, GodMappedStatement&gt; mappedStatements) &#123;</span><br><span class="line">        this.transactionManager = transactionManager;</span><br><span class="line">        this.mappedStatements = mappedStatements;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void commit()&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            transactionManager.getConnection().commit();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void rollback()&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            transactionManager.getConnection().rollback();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void close()&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            transactionManager.getConnection().close();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">### 第十二步：编写SqlSession类中的insert方法</span><br><span class="line">```java</span><br><span class="line">/**</span><br><span class="line"> * 插入数据</span><br><span class="line"> *</span><br><span class="line"> * @param sqlId 要执行的sqlId</span><br><span class="line"> * @param obj   插入的数据</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public int insert(String sqlId, Object obj) &#123;</span><br><span class="line">    GodMappedStatement godMappedStatement = mappedStatements.get(sqlId);</span><br><span class="line">    Connection connection = transactionManager.getConnection();</span><br><span class="line">    // 获取sql语句</span><br><span class="line">    // insert into t_car(id,car_num,brand,guide_price,produce_time,car_type) values(null,#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line">    String godbatisSql = godMappedStatement.getSql();</span><br><span class="line">    // insert into t_car(id,car_num,brand,guide_price,produce_time,car_type) values(null,?,?,?,?,?)</span><br><span class="line">    String sql = godbatisSql.replaceAll(&quot;#\\&#123;[a-zA-Z0-9_\\$]*&#125;&quot;, &quot;?&quot;);</span><br><span class="line"></span><br><span class="line">    // 重点一步</span><br><span class="line">    Map&lt;Integer, String&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">    int index = 1;</span><br><span class="line">    while (godbatisSql.indexOf(&quot;#&quot;) &gt;= 0) &#123;</span><br><span class="line">        int beginIndex = godbatisSql.indexOf(&quot;#&quot;) + 2;</span><br><span class="line">        int endIndex = godbatisSql.indexOf(&quot;&#125;&quot;);</span><br><span class="line">        map.put(index++, godbatisSql.substring(beginIndex, endIndex).trim());</span><br><span class="line">        godbatisSql = godbatisSql.substring(endIndex + 1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    final PreparedStatement ps;</span><br><span class="line">    try &#123;</span><br><span class="line">        ps = connection.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">        // 给?赋值</span><br><span class="line">        map.forEach((k, v) -&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                // 获取java实体类的get方法名</span><br><span class="line">                String getMethodName = &quot;get&quot; + v.toUpperCase().charAt(0) + v.substring(1);</span><br><span class="line">                Method getMethod = obj.getClass().getDeclaredMethod(getMethodName);</span><br><span class="line">                ps.setString(k, getMethod.invoke(obj).toString());</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                throw new RuntimeException(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        int count = ps.executeUpdate();</span><br><span class="line">        ps.close();</span><br><span class="line">        return count;</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        throw new RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">### 第十三步：编写SqlSession类中的selectOne方法</span><br><span class="line">```java</span><br><span class="line">/**</span><br><span class="line"> * 查询一个对象</span><br><span class="line"> * @param sqlId</span><br><span class="line"> * @param parameterObj</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public Object selectOne(String sqlId, Object parameterObj)&#123;</span><br><span class="line">    GodMappedStatement godMappedStatement = mappedStatements.get(sqlId);</span><br><span class="line">    Connection connection = transactionManager.getConnection();</span><br><span class="line">    // 获取sql语句</span><br><span class="line">    String godbatisSql = godMappedStatement.getSql();</span><br><span class="line">    String sql = godbatisSql.replaceAll(&quot;#\\&#123;[a-zA-Z0-9_\\$]*&#125;&quot;, &quot;?&quot;);</span><br><span class="line">    // 执行sql</span><br><span class="line">    PreparedStatement ps = null;</span><br><span class="line">    ResultSet rs = null;</span><br><span class="line">    Object obj = null;</span><br><span class="line">    try &#123;</span><br><span class="line">        ps = connection.prepareStatement(sql);</span><br><span class="line">        ps.setString(1, parameterObj.toString());</span><br><span class="line">        rs = ps.executeQuery();</span><br><span class="line">        if (rs.next()) &#123;</span><br><span class="line">            // 将结果集封装对象，通过反射</span><br><span class="line">            String resultType = godMappedStatement.getResultType();</span><br><span class="line">            Class&lt;?&gt; aClass = Class.forName(resultType);</span><br><span class="line">            Constructor&lt;?&gt; con = aClass.getDeclaredConstructor();</span><br><span class="line">            obj = con.newInstance();</span><br><span class="line">            // 给对象obj属性赋值</span><br><span class="line">            ResultSetMetaData rsmd = rs.getMetaData();</span><br><span class="line">            int columnCount = rsmd.getColumnCount();</span><br><span class="line">            for (int i = 1; i &lt;= columnCount; i++) &#123;</span><br><span class="line">                String columnName = rsmd.getColumnName(i);</span><br><span class="line">                String setMethodName = &quot;set&quot; + columnName.toUpperCase().charAt(0) + columnName.substring(1);</span><br><span class="line">                Method setMethod = aClass.getDeclaredMethod(setMethodName, aClass.getDeclaredField(columnName).getType());</span><br><span class="line">                setMethod.invoke(obj, rs.getString(columnName));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        throw new RuntimeException(e);</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        if (rs != null) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                throw new RuntimeException(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        try &#123;</span><br><span class="line">            ps.close();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return obj;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line">## 5.3 GodBatis使用Maven打包</span><br><span class="line">![23B91E36-8138-40bd-960F-685051751FBE.png](./images/老杜MyBatis/1660206374772-d21754cb-0c5f-4a14-921e-d083b4a791c3.png#averageHue=%233b3f43&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=424&amp;id=ud190761b&amp;originHeight=424&amp;originWidth=489&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=11737&amp;status=done&amp;style=none&amp;taskId=u7b711654-0ab3-40b0-9395-9f98639e6dd&amp;title=&amp;width=489)</span><br><span class="line">查看本地仓库中是否已经有jar包：</span><br><span class="line">![089FD2B9-D3F2-4f62-9A64-2EC66CC8B623.png](./images/老杜MyBatis/1660206446577-20e8dd84-6b05-48c8-a693-cb0dadfb7979.png#averageHue=%23fbf5f5&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=232&amp;id=u0ec7ef39&amp;originHeight=232&amp;originWidth=497&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=8571&amp;status=done&amp;style=none&amp;taskId=ub79cbd13-af08-4c00-a5be-feee1bd1563&amp;title=&amp;width=497)</span><br><span class="line">## 5.4 使用GodBatis</span><br><span class="line">使用GodBatis就和使用MyBatis是一样的。</span><br><span class="line">第一步：准备数据库表t_user</span><br><span class="line">![96BB0AE2-0C47-4e24-AF86-E8B875B5B65A.png](./images/老杜MyBatis/1660206701289-4ed4661b-7c85-4157-b09c-3a7fe5207399.png#averageHue=%23f7f6f6&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=264&amp;id=uef3387dc&amp;originHeight=264&amp;originWidth=796&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=12816&amp;status=done&amp;style=none&amp;taskId=ufd123940-ed51-40c8-a680-18ad7e51c77&amp;title=&amp;width=796)</span><br><span class="line">第二步：创建模块，普通的Java Maven模块：godbatis-test</span><br><span class="line">第三步：引入依赖</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;groupId&gt;com.powernode&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;godbatis-test&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">  &lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;!--godbatis依赖--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.god&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;godbatis&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--mysql--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;8.0.30&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--junit--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;4.13.2&lt;/version&gt;</span><br><span class="line">      &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">  &lt;/dependencies&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;properties&gt;</span><br><span class="line">    &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;</span><br><span class="line">    &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;</span><br><span class="line">  &lt;/properties&gt;</span><br><span class="line">  </span><br><span class="line">&lt;/project&gt;</span><br><span class="line">```</span><br><span class="line">第四步：编写pojo类</span><br><span class="line">```java</span><br><span class="line">package com.powernode.godbatis.pojo;</span><br><span class="line"></span><br><span class="line">public class User &#123;</span><br><span class="line">    private String id;</span><br><span class="line">    private String name;</span><br><span class="line">    private String email;</span><br><span class="line">    private String address;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;User&#123;&quot; +</span><br><span class="line">                &quot;id=&#x27;&quot; + id + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, name=&#x27;&quot; + name + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, email=&#x27;&quot; + email + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, address=&#x27;&quot; + address + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(String id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getEmail() &#123;</span><br><span class="line">        return email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setEmail(String email) &#123;</span><br><span class="line">        this.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getAddress() &#123;</span><br><span class="line">        return address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAddress(String address) &#123;</span><br><span class="line">        this.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public User() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public User(String id, String name, String email, String address) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.email = email;</span><br><span class="line">        this.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">第五步：编写核心配置文件：godbatis-config.xml</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;UNPOOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/powernode&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">        &lt;mappers&gt;</span><br><span class="line">            &lt;mapper resource=&quot;UserMapper.xml&quot;/&gt;</span><br><span class="line">        &lt;/mappers&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line">第六步：编写sql映射文件：UserMapper.xml</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=&quot;user&quot;&gt;</span><br><span class="line">    &lt;insert id=&quot;insertUser&quot;&gt;</span><br><span class="line">        insert into t_user(id,name,email,address) values(#&#123;id&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;address&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">    &lt;select id=&quot;selectUserById&quot; resultType=&quot;com.powernode.godbatis.pojo.User&quot;&gt;</span><br><span class="line">        select * from t_user where id = #&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">第七步：编写测试类</span><br><span class="line">```java</span><br><span class="line">package com.powernode.godbatis.test;</span><br><span class="line"></span><br><span class="line">import com.powernode.godbatis.pojo.User;</span><br><span class="line">import org.god.core.Resources;</span><br><span class="line">import org.god.core.SqlSession;</span><br><span class="line">import org.god.core.SqlSessionFactory;</span><br><span class="line">import org.god.core.SqlSessionFactoryBuilder;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">public class GodBatisTest &#123;</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testInsertUser() throws Exception&#123;</span><br><span class="line">        User user = new User(&quot;1&quot;, &quot;zhangsan&quot;, &quot;zhangsan@1234.com&quot;, &quot;北京大兴区&quot;);</span><br><span class="line">        SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourcesAsStream(&quot;godbatis-config.xml&quot;));</span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        int count = sqlSession.insert(&quot;user.insertUser&quot;, user);</span><br><span class="line">        System.out.println(&quot;插入了几条记录：&quot; + count);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testSelectUserById() throws Exception&#123;</span><br><span class="line">        SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourcesAsStream(&quot;godbatis-config.xml&quot;));</span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        Object user = sqlSession.selectOne(&quot;user.selectUserById&quot;, &quot;1&quot;);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">第八步：运行结果</span><br><span class="line">![4766EF58-0505-4cdb-8539-D3E487D0B40D.png](./images/老杜MyBatis/1660209177038-ecf701a2-1211-4f0c-b1f6-e2e16c1617d5.png#averageHue=%23333231&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=135&amp;id=u32d04b9b&amp;originHeight=135&amp;originWidth=447&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=7682&amp;status=done&amp;style=none&amp;taskId=u71f55f3d-42b0-4389-bf0f-179229f7aa2&amp;title=&amp;width=447)</span><br><span class="line">![DE9D2710-1999-4ef1-8F7E-822ACB17BF02.png](./images/老杜MyBatis/1660209186576-54493410-47b7-4496-8007-471473cc6fc6.png#averageHue=%23f3f1f0&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=134&amp;id=u1f31d223&amp;originHeight=134&amp;originWidth=443&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=6439&amp;status=done&amp;style=none&amp;taskId=udddf5f59-e9ac-437d-873d-d900c3aa5b4&amp;title=&amp;width=443)</span><br><span class="line">![CD0A068F-8A77-4ced-B92F-B0CCA2412B3C.png](./images/老杜MyBatis/1660209193124-908993c5-90d6-4426-a598-7aeac2a6b791.png#averageHue=%238b7760&amp;clientId=u77faa741-d191-4&amp;from=paste&amp;height=195&amp;id=uee2c9fb1&amp;originHeight=195&amp;originWidth=819&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=12996&amp;status=done&amp;style=none&amp;taskId=u35b9af92-a008-4883-88b5-605a8697d9b&amp;title=&amp;width=819)</span><br><span class="line">## 5.5 总结MyBatis框架的重要实现原理</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=&quot;user&quot;&gt;</span><br><span class="line">  &lt;insert id=&quot;insertUser&quot;&gt;</span><br><span class="line">    insert into t_user(id,name,email,address) values(#&#123;id&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;address&#125;)</span><br><span class="line">  &lt;/insert&gt;</span><br><span class="line">  &lt;select id=&quot;selectUserById&quot; resultType=&quot;com.powernode.godbatis.pojo.User&quot;&gt;</span><br><span class="line">    select id,name,email,address from t_user where id = #&#123;id&#125;</span><br><span class="line">  &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">思考两个问题：</span><br><span class="line"></span><br><span class="line">- 为什么insert语句中 #&#123;&#125; 里填写的必须是属性名？</span><br><span class="line">- 为什么select语句查询结果列名要属性名一致？</span><br><span class="line"></span><br><span class="line">![](./images/老杜MyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#averageHue=%23dad8d7&amp;from=url&amp;id=JHMnK&amp;originHeight=152&amp;originWidth=1180&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=)</span><br><span class="line"># 六、在WEB中应用MyBatis（使用MVC架构模式）</span><br><span class="line">**目标：**</span><br><span class="line"></span><br><span class="line">- 掌握mybatis在web应用中怎么用</span><br><span class="line">- mybatis三大对象的作用域和生命周期</span><br><span class="line">- ThreadLocal原理及使用</span><br><span class="line">- 巩固MVC架构模式</span><br><span class="line">- 为学习MyBatis的接口代理机制做准备</span><br><span class="line"></span><br><span class="line">**实现功能：**</span><br><span class="line"></span><br><span class="line">- 银行账户转账</span><br><span class="line"></span><br><span class="line">**使用技术：**</span><br><span class="line"></span><br><span class="line">- HTML + Servlet + MyBatis</span><br><span class="line"></span><br><span class="line">**WEB应用的名称：**</span><br><span class="line"></span><br><span class="line">- bank</span><br><span class="line">## 6.1 需求描述</span><br><span class="line">![9C2CCE44-E51B-4b1a-AD3D-176294F3B463.png](./images/老杜MyBatis/1660274775552-da896b17-09dd-455a-899e-eb4f36fc0ced.png#averageHue=%23fafaf8&amp;clientId=u01870008-33ee-4&amp;from=paste&amp;height=213&amp;id=ud5c2edc9&amp;originHeight=213&amp;originWidth=497&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=7952&amp;status=done&amp;style=none&amp;taskId=u2c5645cb-8235-46ee-9ba7-b078802b235&amp;title=&amp;width=497)</span><br><span class="line">## 6.2 数据库表的设计和准备数据</span><br><span class="line">![68216368-5BD6-4e0d-A567-5E725A349D0F.png](./images/老杜MyBatis/1660275027117-dcf9ec03-01fa-4e93-8edb-7e10456ba51f.png#averageHue=%23f6f6f5&amp;clientId=u01870008-33ee-4&amp;from=paste&amp;height=235&amp;id=u823c564f&amp;originHeight=235&amp;originWidth=920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=13719&amp;status=done&amp;style=none&amp;taskId=ua26ee15c-9771-4acb-bef3-aa72e8aa600&amp;title=&amp;width=920)</span><br><span class="line">![EBB28A3F-32BB-431c-9C2C-03A4EB5C8ADF.png](./images/老杜MyBatis/1660275097707-2621f88d-9c21-4d4e-aa6c-c90e1c6e4e3b.png#averageHue=%23f6f5f4&amp;clientId=u01870008-33ee-4&amp;from=paste&amp;height=153&amp;id=u58e9f113&amp;originHeight=153&amp;originWidth=506&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=7100&amp;status=done&amp;style=none&amp;taskId=ue7979c28-a5e7-4ae3-a693-32d1bcf8818&amp;title=&amp;width=506)</span><br><span class="line">## 6.3 实现步骤</span><br><span class="line">### 第一步：环境搭建</span><br><span class="line"></span><br><span class="line">- IDEA中创建Maven WEB应用（**mybatis-004-web**）</span><br><span class="line"></span><br><span class="line">![B228544B-4646-41fc-BFA1-39B6E8464405.png](./images/老杜MyBatis/1660275706327-2116fb91-fe1a-449d-bd62-6f15416dba84.png#averageHue=%233d4043&amp;clientId=u01870008-33ee-4&amp;from=paste&amp;height=872&amp;id=ub0eb7faa&amp;originHeight=872&amp;originWidth=1133&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=39856&amp;status=done&amp;style=none&amp;taskId=u161a6991-d0d4-4def-b73e-0f0a48d6a9f&amp;title=&amp;width=1133)</span><br><span class="line"></span><br><span class="line">- IDEA配置Tomcat，这里Tomcat使用10+版本。并部署应用到tomcat。</span><br><span class="line"></span><br><span class="line">![38908B1E-AC59-4ecf-B972-7651AA58023E.png](./images/老杜MyBatis/1660296669590-e7e4932f-cdfb-4d82-9711-af0ca18bbe81.png#clientId=ueb159dc3-e063-4&amp;from=paste&amp;height=802&amp;id=ufcc208d1&amp;originHeight=802&amp;originWidth=1042&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=35630&amp;status=done&amp;style=none&amp;taskId=uaf0f65ec-da3c-4e15-a203-6397277702e&amp;title=&amp;width=1042)</span><br><span class="line">![9EA5CF36-E282-41d4-B544-1533AD25BB33.png](./images/老杜MyBatis/1660296712190-729ead72-375d-417f-852a-ef366c38c1c3.png#clientId=ueb159dc3-e063-4&amp;from=paste&amp;height=807&amp;id=uf0e62e86&amp;originHeight=807&amp;originWidth=1049&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=23858&amp;status=done&amp;style=none&amp;taskId=uf5f95120-d65b-4b10-9dcf-10db2430be9&amp;title=&amp;width=1049)</span><br><span class="line"></span><br><span class="line">- 默认创建的maven web应用没有java和resources目录，包括两种解决方案</span><br><span class="line">   - 第一种：自己手动加上。</span><br><span class="line"></span><br><span class="line">![5A0EC4A7-C5EB-4fcb-B74C-2A9B3A147E5B.png](./images/老杜MyBatis/1660297753549-b90c4f4c-2f8f-404d-9ff7-c350d8cd21e0.png#clientId=ueb159dc3-e063-4&amp;from=paste&amp;height=448&amp;id=u9499e54b&amp;originHeight=448&amp;originWidth=378&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=13734&amp;status=done&amp;style=none&amp;taskId=uba85100e-6099-41c8-909c-b9b59c5efa9&amp;title=&amp;width=378)</span><br><span class="line"></span><br><span class="line">   - 第二种：修改maven-archetype-webapp-1.4.jar中的配置文件</span><br><span class="line"></span><br><span class="line">![508D0561-6CEF-4af4-A243-0CF29B2D748B.png](./images/老杜MyBatis/1660297555336-bef8649f-7e24-477c-9e0a-e55ed1b009a6.png#clientId=ueb159dc3-e063-4&amp;from=paste&amp;height=303&amp;id=uc2301bdd&amp;originHeight=303&amp;originWidth=776&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=16245&amp;status=done&amp;style=none&amp;taskId=u6e49a14f-1a0e-4c01-97db-b8750ee5ccf&amp;title=&amp;width=776)</span><br><span class="line">![3A2D1F51-98DE-4416-B196-2535C5D26E55.png](./images/老杜MyBatis/1660297620748-1062587b-feff-472a-a546-e5489aebdbdc.png#clientId=ueb159dc3-e063-4&amp;from=paste&amp;height=262&amp;id=ucbfa4d97&amp;originHeight=262&amp;originWidth=751&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=19674&amp;status=done&amp;style=none&amp;taskId=udd20f8b4-d71b-417f-810a-ce5e9e75ca7&amp;title=&amp;width=751)</span><br><span class="line">![7F5D0F8B-EA3B-4d79-B156-02C0D11BA2E9.png](./images/老杜MyBatis/1660297684026-b50cdd30-80d2-488d-9632-a0a098a3518e.png#clientId=ueb159dc3-e063-4&amp;from=paste&amp;height=405&amp;id=ua8158036&amp;originHeight=405&amp;originWidth=814&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=14535&amp;status=done&amp;style=none&amp;taskId=u735b56bd-0a3a-44c9-b7b5-80dbdab0d78&amp;title=&amp;width=814)</span><br><span class="line"></span><br><span class="line">- web.xml文件的版本较低，可以从tomcat10的样例文件中复制，然后修改</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns=&quot;https://jakarta.ee/xml/ns/jakartaee&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;https://jakarta.ee/xml/ns/jakartaee</span><br><span class="line">                      https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd&quot;</span><br><span class="line">         version=&quot;5.0&quot;</span><br><span class="line">         metadata-complete=&quot;true&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/web-app&gt;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- 删除index.jsp文件，因为我们这个项目不使用JSP。只使用html。</span><br><span class="line">- 确定pom.xml文件中的打包方式是war包，因为是web项目。</span><br><span class="line">- 引入相关依赖</span><br><span class="line">   - 编译器版本修改为17</span><br><span class="line">   - 引入的依赖包括：mybatis，mysql驱动，junit，logback，servlet。</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.powernode&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-004-web&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;packaging&gt;war&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--在maven中显示的名字--&gt;</span><br><span class="line">    &lt;name&gt;mybatis-004-web&lt;/name&gt;</span><br><span class="line">    &lt;url&gt;http://localhost:8080/bank&lt;/url&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!--mybatis依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.5.10&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--mysql驱动依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;8.0.30&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--junit依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.13.2&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--logback依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.11&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--servlet依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;jakarta.servlet&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jakarta.servlet-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.0.0&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;finalName&gt;mybatis-004-web&lt;/finalName&gt;</span><br><span class="line">        &lt;pluginManagement&gt;</span><br><span class="line">            &lt;plugins&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-clean-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;3.1.0&lt;/version&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;3.0.2&lt;/version&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;3.8.0&lt;/version&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;2.22.1&lt;/version&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;3.2.2&lt;/version&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-install-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;2.5.2&lt;/version&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-deploy-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;2.8.2&lt;/version&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">            &lt;/plugins&gt;</span><br><span class="line">        &lt;/pluginManagement&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">&lt;/project&gt;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">- 引入相关配置文件，放到resources目录下（全部放到类的根路径下）</span><br><span class="line">   - mybatis-config.xml</span><br><span class="line">   - AccountMapper.xml</span><br><span class="line">   - logback.xml</span><br><span class="line">   - jdbc.properties</span><br><span class="line">```properties</span><br><span class="line">jdbc.driver=com.mysql.cj.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://localhost:3306/powernode</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=root</span><br><span class="line">```</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties resource=&quot;jdbc.properties&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;$&#123;jdbc.driver&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;!--一定要注意这里的路径哦！！！--&gt;</span><br><span class="line">        &lt;mapper resource=&quot;AccountMapper.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">```</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=&quot;account&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">### 第二步：前端页面index.html</span><br><span class="line">```html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;银行账户转账&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!--/bank是应用的根，部署web应用到tomcat的时候一定要注意这个名字--&gt;</span><br><span class="line">&lt;form action=&quot;/bank/transfer&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    转出账户：&lt;input type=&quot;text&quot; name=&quot;fromActno&quot;/&gt;&lt;br&gt;</span><br><span class="line">    转入账户：&lt;input type=&quot;text&quot; name=&quot;toActno&quot;/&gt;&lt;br&gt;</span><br><span class="line">    转账金额：&lt;input type=&quot;text&quot; name=&quot;money&quot;/&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;转账&quot;/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">```</span><br><span class="line">### 第三步：创建pojo包、service包、dao包、web包、utils包</span><br><span class="line"></span><br><span class="line">- com.powernode.bank.pojo</span><br><span class="line">- com.powernode.bank.service</span><br><span class="line">- com.powernode.bank.service.impl</span><br><span class="line">- com.powernode.bank.dao</span><br><span class="line">- com.powernode.bank.dao.impl</span><br><span class="line">- com.powernode.bank.web.controller</span><br><span class="line">- com.powernode.bank.exception</span><br><span class="line">- com.powernode.bank.utils：**将之前编写的SqlSessionUtil工具类拷贝到该包下。**</span><br><span class="line">### 第四步：定义pojo类：Account</span><br><span class="line">```java</span><br><span class="line">package com.powernode.bank.pojo;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 银行账户类</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class Account &#123;</span><br><span class="line">    private Long id;</span><br><span class="line">    private String actno;</span><br><span class="line">    private Double balance;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Account&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, actno=&#x27;&quot; + actno + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, balance=&quot; + balance +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Account() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Account(Long id, String actno, Double balance) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.actno = actno;</span><br><span class="line">        this.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(Long id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getActno() &#123;</span><br><span class="line">        return actno;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setActno(String actno) &#123;</span><br><span class="line">        this.actno = actno;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Double getBalance() &#123;</span><br><span class="line">        return balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBalance(Double balance) &#123;</span><br><span class="line">        this.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">### 第五步：编写AccountDao接口，以及AccountDaoImpl实现类</span><br><span class="line">分析dao中至少要提供几个方法，才能完成转账：</span><br><span class="line"></span><br><span class="line">- 转账前需要查询余额是否充足：selectByActno</span><br><span class="line">- 转账时要更新账户：update</span><br><span class="line">```java</span><br><span class="line">/**</span><br><span class="line"> * 账户数据访问对象</span><br><span class="line"> * @author 老杜</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public interface AccountDao &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据账号获取账户信息</span><br><span class="line">     * @param actno 账号</span><br><span class="line">     * @return 账户信息</span><br><span class="line">     */</span><br><span class="line">    Account selectByActno(String actno);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 更新账户信息</span><br><span class="line">     * @param act 账户信息</span><br><span class="line">     * @return 1表示更新成功，其他值表示失败</span><br><span class="line">     */</span><br><span class="line">    int updateByActno(Account act);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">```java</span><br><span class="line">public class AccountDaoImpl implements AccountDao &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public Account selectByActno(String actno) &#123;</span><br><span class="line">        SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">        Account acconut = (Account)sqlSession.selectOne(&quot;account.selectByActno&quot;, actno);</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        return acconut;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int update(Account act) &#123;</span><br><span class="line">        SqlSession sqlSession = SqlSessionUtil.openSession();</span><br><span class="line">        int count = sqlSession.update(&quot;account.updateByActno&quot;, act);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        return count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">### 第六步：AccountDaoImpl中编写了mybatis代码，需要编写SQL映射文件了</span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=&quot;account&quot;&gt;</span><br><span class="line">    &lt;select id=&quot;selectByActno&quot; resultType=&quot;com.powernode.bank.pojo.Account&quot;&gt;</span><br><span class="line">        select * from t_act where actno = #&#123;actno&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    &lt;update id=&quot;updateByActno&quot;&gt;</span><br><span class="line">        update t_act set balance = #&#123;balance&#125; where actno = #&#123;actno&#125;</span><br><span class="line">    &lt;/update&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">```</span><br><span class="line">AccountServlet</span><br><span class="line"></span><br><span class="line">~~~java</span><br><span class="line">@WebServlet(&quot;/transfer&quot;)</span><br><span class="line">public class AccountServlet extends HttpServlet &#123;</span><br><span class="line"></span><br><span class="line">    //为了让这个对象在其他方法中也可以用。声明为实例变量。</span><br><span class="line">private AccountService accountService = new AccountServiceImpl();</span><br><span class="line">    </span><br><span class="line">@0verride</span><br><span class="line">protected void doPost(HttpServletRequest request, HttpServletResponse response)</span><br><span class="line">throws ServletException,I0Exception &#123;</span><br><span class="line">//获取表单数据</span><br><span class="line">String fromActno =request.getParameter(&quot;fromActno&quot;);</span><br><span class="line">String toActno =request.getParameter(&quot;toActno&quot;);</span><br><span class="line">double money = Double.parseDouble(request.getParameter(&quot;money&quot;));</span><br><span class="line">try &#123;</span><br><span class="line">// 调用service的转账方法完成转账。(调业务层)</span><br><span class="line">accountService.transfer(fromActno,toActno,money);</span><br><span class="line">//程序能够走到这里，表示转账一定成功了。</span><br><span class="line">//调用view完成展示结果。</span><br><span class="line">        response.sendRedirect(request.getContextPath() + &quot;/success.html&quot;);</span><br><span class="line">&#125; catch(MoneyNotEnoughException e) &#123;</span><br><span class="line">        response.sendRedirect(request.getContextPath() + &quot;/error1.html&quot;);</span><br><span class="line">    &#125;catch(TransferException e)&#123;</span><br><span class="line">        response.sendRedirect(request.getContextPath() + &quot;/error2.html&quot;);</span><br><span class="line">    &#125;catch(Exception e)&#123;</span><br><span class="line">        response.sendRedirect(request.getContextPath() + &quot;/error2.html&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre></li></ul></li></ul><p>在写完代码测试的时候会出现使用注解但无法访问404的情况，这是因为在web.xml里有个metadata-complete，如果等于true就只支持配置文件，改成false就是注解和配置文件都支持</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;https://jakarta.ee/xml/ns/jakartaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;https://jakarta.ee/xml/ns/jakartaee</span></span></span><br><span class="line"><span class="string"><span class="tag">                      https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;5.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">metadata-complete</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="第七步：编写AccountService接口以及AccountServiceImpl"><a href="#第七步：编写AccountService接口以及AccountServiceImpl" class="headerlink" title="第七步：编写AccountService接口以及AccountServiceImpl"></a>第七步：编写AccountService接口以及AccountServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 余额不足异常</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MoneyNotEnoughException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span>&#123;</span><br><span class="line">    <span class="comment">// 无参和有参</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MoneyNotEnoughException</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MoneyNotEnoughException</span><span class="params">(String msg)</span>&#123; <span class="built_in">super</span>(msg); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 应用异常</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AppException</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AppException</span><span class="params">(String msg)</span>&#123; <span class="built_in">super</span>(msg); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 账户业务类。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 银行账户转正</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fromActno 转出账户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> toActno 转入账户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money 转账金额</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> MoneyNotEnoughException 余额不足异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> AppException App发生异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String fromActno, String toActno, <span class="type">double</span> money)</span> <span class="keyword">throws</span> MoneyNotEnoughException, AppException;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String fromActno, String toActno, <span class="type">double</span> money)</span> <span class="keyword">throws</span> MoneyNotEnoughException, AppException &#123;</span><br><span class="line">        <span class="comment">//1.判断转出账户的余额是否充足(select)</span></span><br><span class="line">        <span class="comment">// 查询转出账户的余额</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">fromAct</span> <span class="operator">=</span> accountDao.selectByActno(fromActno);</span><br><span class="line">        <span class="keyword">if</span> (fromAct.getBalance() &lt; money) &#123;</span><br><span class="line">            <span class="comment">//2.如果转出账户余额不足，提示用户</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MoneyNotEnoughException</span>(<span class="string">&quot;对不起，您的余额不足。&quot;</span>);<span class="comment">//这里的异常不能用try catch，不然就是自己抓自己的异常，直接向上抛</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.如果转出账户余额充足，更新转出账户余额(update)</span></span><br><span class="line">        <span class="comment">// 程序如果执行到这里说明余额充足</span></span><br><span class="line">        <span class="comment">// 修改账户余额  </span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">toAct</span> <span class="operator">=</span> accountDao.selectByActno(toActno);<span class="comment">//转入账户    </span></span><br><span class="line">        fromAct.setBalance(fromAct.getBalance() - money);<span class="comment">//扣钱</span></span><br><span class="line">        toAct.setBalance(toAct.getBalance() + money);<span class="comment">//加钱    </span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> accountDao.updateByActno(fromAct);<span class="comment">//更新账户返回次数    </span></span><br><span class="line">     <span class="comment">//4.更新转入账户余额(update)     </span></span><br><span class="line">        count += accountDao.updateByActno(toAct);</span><br><span class="line">        <span class="keyword">if</span> (count != <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AppException</span>(<span class="string">&quot;转账失败，未知原因！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="第八步：编写AccountController"><a href="#第八步：编写AccountController" class="headerlink" title="第八步：编写AccountController"></a>第八步：编写AccountController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 账户控制器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/transfer&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AccountService</span> <span class="variable">accountService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountServiceImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 获取响应流</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        <span class="comment">// 获取账户信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fromActno</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fromActno&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">toActno</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;toActno&quot;</span>);</span><br><span class="line">        <span class="type">double</span> <span class="variable">money</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;money&quot;</span>));</span><br><span class="line">        <span class="comment">// 调用业务方法完成转账</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            accountService.transfer(fromActno, toActno, money);</span><br><span class="line">            out.print(<span class="string">&quot;&lt;h1&gt;转账成功！！！&lt;/h1&gt;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MoneyNotEnoughException e) &#123;</span><br><span class="line">            out.print(e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AppException e) &#123;</span><br><span class="line">            out.print(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>启动服务器，打开浏览器，输入地址：<a href="http://localhost:8080/bank%EF%BC%8C%E6%B5%8B%E8%AF%95%EF%BC%9A">http://localhost:8080/bank，测试：</a><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660548722867-8ae16c8b-f25c-4fc7-b0bb-8c8f0c5e546a.png#clientId=u51da7e76-efcd-4&from=paste&height=212&id=ud4e2de74&originHeight=212&originWidth=360&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6719&status=done&style=none&taskId=ue5ff4251-1afb-4f75-ba35-fd159a72ca7&title=&width=360" alt="EDF0C904-B6CB-44bf-9F9F-C69C81AE46A2.png"><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660551569099-4d81d8cd-35c5-418f-9de1-74ef8641a59f.png#clientId=u51da7e76-efcd-4&from=paste&height=169&id=u7667d225&originHeight=169&originWidth=439&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5479&status=done&style=none&taskId=u2abd5aea-252a-4cbd-b586-788c0c366ec&title=&width=439" alt="A3F83ADE-1028-49ff-9522-8595D857A421.png"><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660551655159-a814927f-dba4-4d81-b6a8-93bdc8511e79.png#clientId=u51da7e76-efcd-4&from=paste&height=149&id=u93944e5c&originHeight=149&originWidth=423&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6303&status=done&style=none&taskId=u5029ee77-68b5-4744-9247-d7c04260a8e&title=&width=423" alt="5364CDC3-DF1A-4380-8A11-DBA050A17A77.png"></p><h2 id="6-4-MyBatis对象作用域以及事务问题"><a href="#6-4-MyBatis对象作用域以及事务问题" class="headerlink" title="6.4 MyBatis对象作用域以及事务问题"></a>6.4 MyBatis对象作用域以及事务问题</h2><h3 id="MyBatis核心对象的作用域"><a href="#MyBatis核心对象的作用域" class="headerlink" title="MyBatis核心对象的作用域"></a>MyBatis核心对象的作用域</h3><h4 id="SqlSessionFactoryBuilder"><a href="#SqlSessionFactoryBuilder" class="headerlink" title="SqlSessionFactoryBuilder"></a>SqlSessionFactoryBuilder</h4><p>这个类可以被实例化、使用和丢弃，<strong>一旦创建</strong>了 SqlSessionFactory，<strong>就不再需要</strong>它了。 因此 SqlSessionFactoryBuilder 实例的最佳作用域是方法作用域（也就是局部方法变量）。 你可以重用 SqlSessionFactoryBuilder 来创建多个 SqlSessionFactory 实例，但最好还是不要一直保留着它，以保证所有的 XML 解析资源可以被释放给更重要的事情。</p><h4 id="SqlSessionFactory"><a href="#SqlSessionFactory" class="headerlink" title="SqlSessionFactory"></a>SqlSessionFactory</h4><p>SqlSessionFactory 一旦被创建就应该在应用的<strong>运行期间一直存在</strong>，没有任何理由丢弃它或重新创建另一个实例。 使用 SqlSessionFactory 的最佳实践是在应用运行期间不要重复创建多次，多次重建 SqlSessionFactory 被视为一种代码“坏习惯”。因此 SqlSessionFactory 的最佳作用域是应用作用域。 有很多方法可以做到，最简单的就是使用单例模式或者静态单例模式。</p><h4 id="SqlSession（保证一个线程对应一个SqlSession）"><a href="#SqlSession（保证一个线程对应一个SqlSession）" class="headerlink" title="SqlSession（保证一个线程对应一个SqlSession）"></a>SqlSession（保证一个线程对应一个SqlSession）</h4><p>每个线程都应该有它自己的 SqlSession 实例。SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域。 绝对不能将 SqlSession 实例的引用放在一个类的静态域，甚至一个类的实例变量也不行。 也绝不能将 SqlSession 实例的引用放在任何类型的托管作用域中，比如 Servlet 框架中的 HttpSession。 如果你现在正在使用一种 Web 框架，考虑将 SqlSession 放在一个和 HTTP 请求相似的作用域中。 换句话说，每次收到 HTTP 请求，就可以打开一个 SqlSession，返回一个响应后，就关闭它。 这个关闭操作很重要，为了确保每次都能执行关闭操作，你应该把这个关闭操作放到 finally 块中。 下面的示例就是一个确保 SqlSession 关闭的标准模式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> sqlSessionFactory.openSession()) &#123;</span><br><span class="line">  <span class="comment">// 你的应用逻辑代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="事务问题"><a href="#事务问题" class="headerlink" title="事务问题"></a>事务问题</h3><p>在之前的转账业务中，更新了两个账户，我们需要保证它们的同时成功或同时失败，这个时候就需要使用事务机制，在transfer方法开始执行时开启事务，直到两个更新都成功之后，再提交事务，我们尝试将transfer方法进行如下修改：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String fromActno, String toActno, <span class="type">double</span> money)</span> <span class="keyword">throws</span> MoneyNotEnoughException, AppException &#123;</span><br><span class="line">        <span class="comment">//1.判断转出账户的余额是否充足(select)</span></span><br><span class="line">        <span class="comment">// 查询转出账户的余额</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">fromAct</span> <span class="operator">=</span> accountDao.selectByActno(fromActno);</span><br><span class="line">        <span class="keyword">if</span> (fromAct.getBalance() &lt; money) &#123;</span><br><span class="line">            <span class="comment">//2.如果转出账户余额不足，提示用户</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MoneyNotEnoughException</span>(<span class="string">&quot;对不起，您的余额不足。&quot;</span>);<span class="comment">//这里的异常不能用try catch，不然就是自己抓自己的异常，直接向上抛</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.如果转出账户余额充足，更新转出账户余额(update)</span></span><br><span class="line">        <span class="comment">// 程序如果执行到这里说明余额充足</span></span><br><span class="line">        <span class="comment">// 修改账户余额  </span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">toAct</span> <span class="operator">=</span> accountDao.selectByActno(toActno);<span class="comment">//转入账户    </span></span><br><span class="line">        fromAct.setBalance(fromAct.getBalance() - money);<span class="comment">//扣钱</span></span><br><span class="line">        toAct.setBalance(toAct.getBalance() + money);<span class="comment">//加钱    </span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> accountDao.updateByActno(fromAct);<span class="comment">//更新账户返回次数  </span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//模拟异常</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        s.toString();</span><br><span class="line">        </span><br><span class="line">     <span class="comment">//4.更新转入账户余额(update)     </span></span><br><span class="line">        count += accountDao.updateByActno(toAct);</span><br><span class="line">        <span class="keyword">if</span> (count != <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AppException</span>(<span class="string">&quot;转账失败，未知原因！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行前注意看数据库表中当前的数据：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660551655159-a814927f-dba4-4d81-b6a8-93bdc8511e79.png#clientId=u51da7e76-efcd-4&from=paste&height=149&id=WtCgO&originHeight=149&originWidth=423&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6303&status=done&style=none&taskId=u5029ee77-68b5-4744-9247-d7c04260a8e&title=&width=423" alt="5364CDC3-DF1A-4380-8A11-DBA050A17A77.png"><br>执行程序：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660552498799-6c617fed-b94e-4e94-a05b-5fe16a97023e.png#clientId=u51da7e76-efcd-4&from=paste&height=148&id=u612a58c2&originHeight=148&originWidth=357&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5021&status=done&style=shadow&taskId=u17e89280-5123-4a79-a555-1f5daab2af6&title=&width=357" alt="44F99896-3045-4700-BF02-33B0E2CEE73E.png"><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660552525960-fb4d555f-09a1-4120-b0b3-73c3eeb2201a.png#clientId=u51da7e76-efcd-4&from=paste&height=107&id=u8c48ae34&originHeight=107&originWidth=341&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3407&status=done&style=shadow&taskId=u2c338a05-4515-4c16-a3e1-177ed51333c&title=&width=341" alt="740BDFDF-1EA7-4134-8867-DEA8AD869800.png"><br>再次查看数据库表中的数据：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660552552430-359a34ff-d869-43a9-b1e3-caa335a4a2f4.png#clientId=u51da7e76-efcd-4&from=paste&height=143&id=u3fe0544c&originHeight=143&originWidth=404&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6070&status=done&style=shadow&taskId=u89d990c9-8e4a-4eab-ac0d-41540f5db22&title=&width=404" alt="A737B160-044F-4511-A4E5-24427A4ADABB.png"><br><strong>傻眼了吧！！！事务出问题了，转账失败了，钱仍然是少了1万。这是什么原因呢？主要是因为service和dao中使用的SqlSession对象不是同一个。</strong><br>怎么办？为了保证service和dao中使用的SqlSession对象是同一个，可以将SqlSession对象存放到ThreadLocal当中。修改SqlSessionUtil工具类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MyBatis工具类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlSessionUtil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 类加载时初始化sqlSessionFactory对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line">            sqlSessionFactory = sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 全局的，服务器级别的，一个服务器当中定义一个即可。</span></span><br><span class="line">    <span class="comment">//为什么把SqlSession对象放到ThreadLocal当中呢?为了保证一个线醒对应一个SqlSession。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;SqlSession&gt; local = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 每调用一次openSession()可获取一个新的会话，该会话支持自动提交。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 新的会话对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title function_">openSession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> local.get();</span><br><span class="line">        <span class="keyword">if</span> (sqlSession == <span class="literal">null</span>) &#123;</span><br><span class="line">            sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">            <span class="comment">//将sqlSession对象绑定到当前线程上</span></span><br><span class="line">            local.set(sqlSession);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sqlSession;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭SqlSession对象(从当前线程中移除SqlSession对象。)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sqlSession</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(SqlSession sqlSession)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sqlSession != <span class="literal">null</span>) &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//注意移除SqlSession对象和当前线程的绑定关系。</span></span><br><span class="line"><span class="comment">//因为Tomcat服务器支持线程池。也就是说:用过的线程对象t1，可能下一次还会使用这个t1线程。</span></span><br><span class="line">        local.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改dao中的方法：AccountDaoImpl中所有方法中的提交commit和关闭close代码全部删除。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">selectByActno</span><span class="params">(String actno)</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.openSession();</span><br><span class="line">        <span class="type">Account</span> <span class="variable">act</span> <span class="operator">=</span> (Account)sqlSession.selectOne(<span class="string">&quot;account.selectByActno&quot;</span>, actno);</span><br><span class="line">        <span class="keyword">return</span> act;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Account act)</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.openSession();</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> sqlSession.update(<span class="string">&quot;account.update&quot;</span>, act);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>修改service中的方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String fromActno, String toActno, <span class="type">double</span> money)</span> <span class="keyword">throws</span> MoneyNotEnoughException, AppException &#123;</span><br><span class="line">        <span class="comment">//1.判断转出账户的余额是否充足(select)</span></span><br><span class="line">        <span class="comment">// 查询转出账户的余额</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">fromAct</span> <span class="operator">=</span> accountDao.selectByActno(fromActno);</span><br><span class="line">        <span class="keyword">if</span> (fromAct.getBalance() &lt; money) &#123;</span><br><span class="line">            <span class="comment">//2.如果转出账户余额不足，提示用户</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MoneyNotEnoughException</span>(<span class="string">&quot;对不起，您的余额不足。&quot;</span>);<span class="comment">//这里的异常不能用try catch，不然就是自己抓自己的异常，直接向上抛</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.如果转出账户余额充足，更新转出账户余额(update)</span></span><br><span class="line">        <span class="comment">// 程序如果执行到这里说明余额充足</span></span><br><span class="line">        <span class="comment">// 修改账户余额  </span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">toAct</span> <span class="operator">=</span> accountDao.selectByActno(toActno);<span class="comment">//转入账户    </span></span><br><span class="line">        fromAct.setBalance(fromAct.getBalance() - money);<span class="comment">//扣钱</span></span><br><span class="line">        toAct.setBalance(toAct.getBalance() + money);<span class="comment">//加钱    </span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> accountDao.updateByActno(fromAct);<span class="comment">//更新账户返回次数  </span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//模拟异常</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        s.toString();</span><br><span class="line">        </span><br><span class="line">     <span class="comment">//4.更新转入账户余额(update)     </span></span><br><span class="line">        count += accountDao.updateByActno(toAct);</span><br><span class="line">        <span class="keyword">if</span> (count != <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AppException</span>(<span class="string">&quot;转账失败，未知原因！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        <span class="comment">//关闭事务</span></span><br><span class="line">        sqlSessionUtil.close(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当前数据库表中的数据：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660552552430-359a34ff-d869-43a9-b1e3-caa335a4a2f4.png#clientId=u51da7e76-efcd-4&from=paste&height=143&id=FEyIx&originHeight=143&originWidth=404&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6070&status=done&style=shadow&taskId=u89d990c9-8e4a-4eab-ac0d-41540f5db22&title=&width=404" alt="A737B160-044F-4511-A4E5-24427A4ADABB.png"><br>再次运行程序：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660552498799-6c617fed-b94e-4e94-a05b-5fe16a97023e.png#clientId=u51da7e76-efcd-4&from=paste&height=148&id=Bvmrx&originHeight=148&originWidth=357&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5021&status=done&style=shadow&taskId=u17e89280-5123-4a79-a555-1f5daab2af6&title=&width=357" alt="44F99896-3045-4700-BF02-33B0E2CEE73E.png"><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660552525960-fb4d555f-09a1-4120-b0b3-73c3eeb2201a.png#clientId=u51da7e76-efcd-4&from=paste&height=107&id=Wpypf&originHeight=107&originWidth=341&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3407&status=done&style=shadow&taskId=u2c338a05-4515-4c16-a3e1-177ed51333c&title=&width=341" alt="740BDFDF-1EA7-4134-8867-DEA8AD869800.png"><br>查看数据库表：没有问题。<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660552552430-359a34ff-d869-43a9-b1e3-caa335a4a2f4.png#clientId=u51da7e76-efcd-4&from=paste&height=143&id=DSWAj&originHeight=143&originWidth=404&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6070&status=done&style=shadow&taskId=u89d990c9-8e4a-4eab-ac0d-41540f5db22&title=&width=404" alt="A737B160-044F-4511-A4E5-24427A4ADABB.png"><br>再测试转账成功：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660552498799-6c617fed-b94e-4e94-a05b-5fe16a97023e.png#clientId=u51da7e76-efcd-4&from=paste&height=148&id=F0jzt&originHeight=148&originWidth=357&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5021&status=done&style=shadow&taskId=u17e89280-5123-4a79-a555-1f5daab2af6&title=&width=357" alt="44F99896-3045-4700-BF02-33B0E2CEE73E.png"><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660551569099-4d81d8cd-35c5-418f-9de1-74ef8641a59f.png#clientId=u51da7e76-efcd-4&from=paste&height=169&id=v50HW&originHeight=169&originWidth=439&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5479&status=done&style=none&taskId=u2abd5aea-252a-4cbd-b586-788c0c366ec&title=&width=439" alt="A3F83ADE-1028-49ff-9522-8595D857A421.png"><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660553732975-bdd952c5-c2c8-4cda-b9f7-810120c66485.png#clientId=u51da7e76-efcd-4&from=paste&height=160&id=ud826500e&originHeight=160&originWidth=371&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5711&status=done&style=shadow&taskId=u320e568e-280d-4989-8f39-fbb02ea4d65&title=&width=371" alt="C8F84292-5B90-4014-A348-A800DD401C86.png"><br>如果余额不足呢：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660553844177-0db1b3c9-3663-4a96-abb0-d516f24c36b8.png#clientId=u51da7e76-efcd-4&from=paste&height=146&id=u8ca8e057&originHeight=146&originWidth=344&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4842&status=done&style=shadow&taskId=u1ad0ec6b-745d-413e-90eb-3dd3f09413e&title=&width=344" alt="7E69C82A-F50C-4a8d-B7FF-579C3AD5750C.png"><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660553856988-09e342be-fa3c-4467-9541-d785a08276e9.png#clientId=u51da7e76-efcd-4&from=paste&height=121&id=u968d681a&originHeight=121&originWidth=371&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3600&status=done&style=shadow&taskId=ucf12eb6f-6556-40f6-a8ae-d3ad4d510b7&title=&width=371" alt="F5CFB1B3-72F8-4960-B740-1AD2A076C499.png"><br>账户的余额依然正常：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660553732975-bdd952c5-c2c8-4cda-b9f7-810120c66485.png#clientId=u51da7e76-efcd-4&from=paste&height=160&id=gJxbX&originHeight=160&originWidth=371&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5711&status=done&style=shadow&taskId=u320e568e-280d-4989-8f39-fbb02ea4d65&title=&width=371" alt="C8F84292-5B90-4014-A348-A800DD401C86.png"></p><h2 id="6-5-分析当前程序存在的问题"><a href="#6-5-分析当前程序存在的问题" class="headerlink" title="6.5 分析当前程序存在的问题"></a>6.5 分析当前程序存在的问题</h2><p>我们来看一下DaoImpl的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.bank.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.powernode.bank.dao.AccountDao;</span><br><span class="line"><span class="keyword">import</span> com.powernode.bank.pojo.Account;</span><br><span class="line"><span class="keyword">import</span> com.powernode.bank.utils.SqlSessionUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">selectByActno</span><span class="params">(String actno)</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.openSession();</span><br><span class="line">        <span class="type">Account</span> <span class="variable">act</span> <span class="operator">=</span> (Account)sqlSession.selectOne(<span class="string">&quot;account.selectByActno&quot;</span>, actno);</span><br><span class="line">        <span class="keyword">return</span> act;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Account act)</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.openSession();</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> sqlSession.update(<span class="string">&quot;account.update&quot;</span>, act);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们不难发现，这个dao实现类中的方法代码很固定，基本上就是一行代码，通过SqlSession对象调用insert、delete、update、select等方法，这个类中的方法没有任何业务逻辑，既然是这样，<strong>这个类我们能不能动态的生成</strong>，以后可以不写这个类吗？答案：可以。<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=BQdc2&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p><h1 id="七、使用javassist生成类"><a href="#七、使用javassist生成类" class="headerlink" title="七、使用javassist生成类"></a>七、使用javassist生成类</h1><p>来自百度百科：</p><blockquote><p>Javassist是一个开源的分析、编辑和创建Java字节码的类库。是由东京工业大学的数学和计算机科学系的 Shigeru Chiba （千叶 滋）所创建的。它已加入了开放源代码JBoss 应用服务器项目，通过使用Javassist对字节码操作为JBoss实现动态”AOP”框架。</p></blockquote><h2 id="7-1-Javassist的使用"><a href="#7-1-Javassist的使用" class="headerlink" title="7.1 Javassist的使用"></a>7.1 Javassist的使用</h2><p>我们要使用javassist，首先要引入它的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.javassist<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.29.1-GA<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>样例代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavassistTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGenerateFirstClass</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//获取类池，这个类池就是用来给我生成class的</span></span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="comment">// 创建类</span></span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> pool.makeClass(<span class="string">&quot;com.powernode.bank.dao.impl.AccountDaoImpl&quot;</span>);</span><br><span class="line">        <span class="comment">// 创建方法（这个老师的看不懂）</span></span><br><span class="line">        <span class="comment">// 1.返回值类型 2.方法名 3.形式参数列表 4.所属类</span></span><br><span class="line">        <span class="comment">//CtMethod ctMethod = new CtMethod(CtClass.voidType, &quot;execute&quot;, new CtClass[]&#123;&#125;, ctClass);</span></span><br><span class="line">        <span class="comment">// 设置方法的修饰符列表</span></span><br><span class="line">        <span class="comment">//ctMethod.setModifiers(Modifier.PUBLIC);</span></span><br><span class="line">        <span class="comment">// 设置方法体</span></span><br><span class="line">        <span class="comment">//ctMethod.setBody(&quot;&#123;System.out.println(\&quot;hello world\&quot;);&#125;&quot;);</span></span><br><span class="line">        <span class="comment">// 给类添加方法</span></span><br><span class="line">        <span class="comment">//ctClass.addMethod(ctMethod);</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 制造方法</span></span><br><span class="line"><span class="type">String</span> <span class="variable">methodCode</span> <span class="operator">=</span> <span class="string">&quot;public void insert()&#123;System.out.println(123);&#125;&quot;</span>;</span><br><span class="line"><span class="type">CtMethod</span> <span class="variable">ctMethod</span> <span class="operator">=</span> CtMethod.make(methodcode, ctClass);</span><br><span class="line"><span class="comment">// 将方法添加到类中</span></span><br><span class="line">ctClass.addMethod(ctMethod);</span><br><span class="line"><span class="comment">//在内存中生成class</span></span><br><span class="line">ctClass.toclass();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//类加载到JVM当中，返回AccountDaoImpl类的字节码</span></span><br><span class="line">Class&lt;?&gt; clazz = class.forName( cassName: <span class="string">&quot;com.powernode.bank.dao.impl.AccountDaoImpl&quot;</span>);</span><br><span class="line"><span class="comment">//创建对象</span></span><br><span class="line">0<span class="type">bject</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.newInstanee();</span><br><span class="line"><span class="comment">//获取AccountDaoImpl中的insert方法</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">insertMethod</span> <span class="operator">=</span> clazz.getDeclaredMethod(<span class="string">&quot;insert&quot;</span>);</span><br><span class="line"><span class="comment">//调用方法insert</span></span><br><span class="line">insertMethod.invoke(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行要注意：加两个参数，要不然会有异常。</p><ul><li>–add-opens java.base&#x2F;java.lang&#x3D;ALL-UNNAMED</li><li>–add-opens java.base&#x2F;sun.net.util&#x3D;ALL-UNNAMED</li></ul><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660559749329-9288db13-204c-4354-a5ce-1190f78cb044.png#clientId=u51da7e76-efcd-4&from=paste&height=471&id=ud065408f&originHeight=471&originWidth=726&originalType=binary&ratio=1&rotation=0&showTitle=false&size=27122&status=done&style=shadow&taskId=uda515c55-91cf-4b24-9cb4-aa441c6a74d&title=&width=726" alt="DCBBD517-3C79-456f-817F-DB39E85661D3.png"><br>运行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660559790161-90a4cae2-67be-4827-b981-b28910d9684e.png#clientId=u51da7e76-efcd-4&from=paste&height=163&id=udb225980&originHeight=163&originWidth=378&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8301&status=done&style=shadow&taskId=u0905e524-3949-4d26-ba8f-c4729a4f02e&title=&width=378" alt="B602078D-41E9-4d86-8735-36291B78380F.png"></p><h2 id="7-2-使用Javassist生成DaoImpl类"><a href="#7-2-使用Javassist生成DaoImpl类" class="headerlink" title="7.2 使用Javassist生成DaoImpl类"></a>7.2 使用Javassist生成DaoImpl类</h2><p>使用Javassist动态生成DaoImpl类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 工具类：可以动态的生成DAO的实现类。（或者说可以动态生成DAO的代理类）</span></span><br><span class="line"><span class="comment"> * 注意注意注意注意注意！！！！！！：</span></span><br><span class="line"><span class="comment"> *      凡是使用GenerateDaoProxy的，SQLMapper.xml映射文件中namespace必须是dao接口的全名，id必须是dao接口中的方法名。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 动力节点</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenerateDaoProxy</span> &#123; <span class="comment">// GenerateDaoProxy是mybatis框架的开发者写的。mapper那个映射文件是java程序员写的</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成dao接口实现类，并且将实现类的对象创建出来并返回。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> daoInterface dao接口</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> dao接口实现类的实例化对象。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">generate</span><span class="params">(SqlSession sqlSession, Class daoInterface)</span>&#123;<span class="comment">//这里的sqlSession用于动态获取sql语句类型</span></span><br><span class="line">        <span class="comment">// 类池</span></span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="comment">// 制造类(com.powernode.bank.dao.AccountDao --&gt; com.powernode.bank.dao.AccountDaoProxy)</span></span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> pool.makeClass(daoInterface.getName() + <span class="string">&quot;Proxy&quot;</span>); <span class="comment">// 实际本质上就是在内存中动态生成一个代理类。</span></span><br><span class="line">        <span class="comment">// 制造接口</span></span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctInterface</span> <span class="operator">=</span> pool.makeInterface(daoInterface.getName());</span><br><span class="line">        <span class="comment">// 实现接口</span></span><br><span class="line">        ctClass.addInterface(ctInterface);</span><br><span class="line">        <span class="comment">// 实现接口中所有的方法</span></span><br><span class="line">        Method[] methods = daoInterface.getDeclaredMethods();</span><br><span class="line">        Arrays.stream(methods).forEach(method -&gt; &#123;</span><br><span class="line">            <span class="comment">// method是接口中的抽象方法</span></span><br><span class="line">            <span class="comment">// 将method这个抽象方法进行实现</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// Account selectByActno(String actno);</span></span><br><span class="line">                <span class="comment">// public Account selectByActno(String actno)&#123; 代码; &#125;</span></span><br><span class="line">                <span class="type">StringBuilder</span> <span class="variable">methodCode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                methodCode.append(<span class="string">&quot;public &quot;</span>);<span class="comment">// 追加修饰符列表</span></span><br><span class="line">                methodCode.append(method.getReturnType().getName());<span class="comment">// 追加返回值类型</span></span><br><span class="line">                methodCode.append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                methodCode.append(method.getName());<span class="comment">//追加方法名</span></span><br><span class="line">                methodCode.append(<span class="string">&quot;(&quot;</span>);</span><br><span class="line">                <span class="comment">// 需要方法的形式参数列表</span></span><br><span class="line">                Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; parameterTypes.length; i++) &#123;</span><br><span class="line">                    Class&lt;?&gt; parameterType = parameterTypes[i];</span><br><span class="line">                    methodCode.append(parameterType.getName());</span><br><span class="line">                    methodCode.append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                    methodCode.append(<span class="string">&quot;arg&quot;</span> + i);</span><br><span class="line">                    <span class="comment">// 如果不是最后一个就用逗号分隔</span></span><br><span class="line">                    <span class="keyword">if</span>(i != parameterTypes.length - <span class="number">1</span>)&#123;</span><br><span class="line">                        methodCode.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                methodCode.append(<span class="string">&quot;)&quot;</span>);</span><br><span class="line">                methodCode.append(<span class="string">&quot;&#123;&quot;</span>);</span><br><span class="line">                <span class="comment">// 需要方法体当中的代码，这一行是固定不变的，直接拼，但要加包名和全限定名，让javassist知道是哪个</span></span><br><span class="line">                methodCode.append(<span class="string">&quot;org.apache.ibatis.session.SqlSession sqlSession = com.powernode.bank.utils.SqlSessionUtil.openSession();&quot;</span>);</span><br><span class="line">                <span class="comment">// 需要知道是什么类型的sql语句</span></span><br><span class="line">                <span class="comment">// sql语句的id是框架使用者提供的，具有多变性。对于我框架的开发人员来说。我不知道。</span></span><br><span class="line">                <span class="comment">// 既然我框架开发者不知道sqlId，怎么办呢？mybatis框架的开发者于是就出台了一个规定：凡是使用GenerateDaoProxy机制的。</span></span><br><span class="line">                <span class="comment">// sqlId都不能随便写。namespace必须是dao接口的全限定名称。id必须是dao接口中方法名。</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">sqlId</span> <span class="operator">=</span> daoInterface.getName() + <span class="string">&quot;.&quot;</span> + method.getName();</span><br><span class="line">                <span class="comment">//获取sqlsession的&lt;Configuration&gt;标签，然后通过sqlid获取sql，然后再获取类型，返回的是个枚举。判断这个枚举类型对应要执行的功能</span></span><br><span class="line">                <span class="type">SqlCommandType</span> <span class="variable">sqlCommandType</span> <span class="operator">=</span> sqlSession.getConfiguration().getMappedStatement(sqlId).getSqlCommandType();</span><br><span class="line">                <span class="keyword">if</span> (sqlCommandType == SqlCommandType.INSERT) &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (sqlCommandType == SqlCommandType.DELETE) &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (sqlCommandType == SqlCommandType.UPDATE) &#123;</span><br><span class="line">                    methodCode.append(<span class="string">&quot;return sqlSession.update(\&quot;&quot;</span>+sqlId+<span class="string">&quot;\&quot;, arg0);&quot;</span>);<span class="comment">//上面循环拼接的方法名叫arg,所以这里也要统一</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (sqlCommandType == SqlCommandType.SELECT) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">returnType</span> <span class="operator">=</span> method.getReturnType().getName();</span><br><span class="line">                    methodCode.append(<span class="string">&quot;return (&quot;</span>+returnType+<span class="string">&quot;)sqlSession.selectOne(\&quot;&quot;</span>+sqlId+<span class="string">&quot;\&quot;, arg0);&quot;</span>);<span class="comment">//没有强转的话默认返回object，所以要动态强转</span></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 动态的添加return语句，在接口里是有返回类型的，所以没有返回语句编译会报错</span></span><br><span class="line">                <span class="comment">//String returnTypeSimpleName = method.getReturnType().getSimpleName();//简单类名</span></span><br><span class="line">                methodCode.append(<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">                <span class="type">CtMethod</span> <span class="variable">ctMethod</span> <span class="operator">=</span> CtMethod.make(methodCode.toString(), ctClass);</span><br><span class="line">                ctClass.addMethod(ctMethod);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; clazz = ctClass.toClass();</span><br><span class="line">            obj = clazz.newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>凡是使用GenerateDaoProxy机制的。namespace必须是dao接口的全限定名称，id必须是dao接口中的方法名，修改AccountMapper.xml文件：</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.bank.dao.AccountDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByActno&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.powernode.bank.pojo.Account&quot;</span>&gt;</span></span><br><span class="line">        select * from t_act where actno = #&#123;actno&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">        update t_act set balance = #&#123;balance&#125; where actno = #&#123;actno&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>修改service类中获取dao对象的代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span>&#123;</span><br><span class="line">    <span class="comment">//private AccountDao accountDao = new AccountDaoImpl();不需要再去获取实现类</span></span><br><span class="line">    <span class="comment">//这个是自己封装的</span></span><br><span class="line">    <span class="comment">//private AccountDao accountDao = (AccountDao)GenerateDaoByJavassist.getMapper(SqlSessionUtil.openSession(), AccountDao.class);通过GenerateDaoByJavassist自动生成</span></span><br><span class="line">    <span class="comment">//在mybatis当中，mybatis提供了相关的机制。也可以动态为我们生成dao接口的实现类。(代理类:dao接口的代理)</span></span><br><span class="line"><span class="comment">// mybatis当中实际上采用了代理模式。在内存中生成dao接口的代理类，然后创建代理类的实例。</span></span><br><span class="line">    <span class="comment">//使用mybatis的这种代理机制的前提:SqlMapper.xml文件中namespace必须是dao接口的全限定名称，id必须是dao接口中的方法名。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(AccountDao.class);</span><br><span class="line">    和上面的一样，都是通过openSession获取selSession然后用一个类获取映射</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660610966694-3e0ab830-8cd1-41ff-aac6-d973e6b5177d.png#clientId=ub45c156e-c1a9-4&from=paste&height=261&id=uc6e4cad5&originHeight=261&originWidth=1392&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25064&status=done&style=shadow&taskId=u190427bf-b0b2-4aff-89ef-347e0abe5c2&title=&width=1392" alt="0A0D47FC-3EA0-4d39-A715-836AF32DBCAB.png"><br>启动服务器：<strong>启动过程中显示，tomcat服务器自动添加了以下的两个运行参数。所以不需要再单独配置。</strong><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660611357131-c6f21e3e-4c8a-4f72-b519-e635d847f1fd.png#clientId=ub45c156e-c1a9-4&from=paste&height=282&id=uaa202405&originHeight=282&originWidth=1240&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25126&status=done&style=shadow&taskId=ub0612de5-cf15-4d87-a057-f9cf0bd5ecd&title=&width=1240" alt="0A086C8D-1CEF-4413-ACB7-060D1B0687F8.png"><br>测试前数据：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660611193608-b788a3d3-7ed2-4673-aff4-b687d5f20e71.png#clientId=ub45c156e-c1a9-4&from=paste&height=154&id=u63fca44f&originHeight=154&originWidth=363&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5621&status=done&style=shadow&taskId=u430c3d6f-0891-4daa-9c67-2faab82426f&title=&width=363" alt="2B1E7468-040C-4cf1-BD41-C6D64BFD3039.png"><br>打开浏览器测试：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660611220579-a56a8f6c-0416-4d7a-a9f5-cf36a6b8fc9a.png#clientId=ub45c156e-c1a9-4&from=paste&height=176&id=ua117b5de&originHeight=176&originWidth=391&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5327&status=done&style=shadow&taskId=u52a403d3-a9c6-4422-bc30-30ed97b55c0&title=&width=391" alt="032AAA55-80B6-40dd-8666-C6C2045BB788.png"><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660611246094-32c692fc-597a-452f-91cf-b0233f9ce020.png#clientId=ub45c156e-c1a9-4&from=paste&height=164&id=u1a494197&originHeight=164&originWidth=420&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7036&status=done&style=shadow&taskId=u94cbabce-810c-478b-841d-2489dfe7f3a&title=&width=420" alt="A9E86E57-0344-43ea-B79C-4C2143151637.png"><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660611264464-7f47cce8-0581-496a-b04a-e756eec622df.png#clientId=ub45c156e-c1a9-4&from=paste&height=146&id=u2225a1a4&originHeight=146&originWidth=356&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5435&status=done&style=shadow&taskId=ub2b50040-a142-4d29-b55e-9221502b00b&title=&width=356" alt="4AE10366-C84B-4f56-A474-2ECDE3D974DF.png"><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=jJ7KS&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p><h1 id="八、MyBatis中接口代理机制及使用"><a href="#八、MyBatis中接口代理机制及使用" class="headerlink" title="八、MyBatis中接口代理机制及使用"></a>八、MyBatis中接口代理机制及使用</h1><p>好消息！！！其实以上所讲内容mybatis内部已经实现了。直接调用以下代码即可获取dao接口的代理类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> (AccountDao)sqlSession.getMapper(AccountDao.class);</span><br></pre></td></tr></table></figure><p>使用以上代码的前提是：<strong>AccountMapper.xml文件中的namespace必须和dao接口的全限定名称一致，id必须和dao接口中方法名一致。</strong><br>将service中获取dao对象的代码再次修改，如下：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660611871663-27d92f0e-e0f5-4ab5-9a6e-be949a5b5469.png#clientId=ub45c156e-c1a9-4&from=paste&height=258&id=uacbc0f58&originHeight=258&originWidth=1393&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28138&status=done&style=shadow&taskId=u58d37345-9dcf-4ede-bb15-07306478c14&title=&width=1393" alt="C9B4A2C2-99DD-456b-BE6D-A4F4AD84C876.png"><br>测试前数据：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660611965066-a4188327-2a59-4125-bd2d-0aa40fb8bf3a.png#clientId=ub45c156e-c1a9-4&from=paste&height=103&id=ub78a5ba5&originHeight=103&originWidth=313&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4025&status=done&style=shadow&taskId=ub9d75ead-260f-4574-9962-99d36aa5eb7&title=&width=313" alt="2F131001-B06E-4db9-88D0-10D9F8879D56.png"><br>测试后数据：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660612013927-a1434b4e-ac2c-4ccb-8747-8594a902babc.png#clientId=ub45c156e-c1a9-4&from=paste&height=123&id=u749ef528&originHeight=123&originWidth=328&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4531&status=done&style=shadow&taskId=u157892be-6180-4896-b2dc-ef662fef507&title=&width=328" alt="F6242FE9-51E9-47e5-BA47-5B5049DA374C.png"><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=ylFna&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p><h1 id="九、MyBatis小技巧"><a href="#九、MyBatis小技巧" class="headerlink" title="九、MyBatis小技巧"></a>九、MyBatis小技巧</h1><h2 id="9-1-和"><a href="#9-1-和" class="headerlink" title="9.1 #{}和${}"></a>9.1 #{}和${}</h2><p>#{}和${}的区别：</p><p>#{}：先编译sql语句，再给占位符传值，底层是PreparedStatement实现。可以防止sql注入，比较常用。<br>${}：先进行sql语句拼接，然后再编译sql语句，底层是Statement实现。存在sql注入现象。只有在需要进行sql语句关键字拼接的情况下才会用到。<br>需求：根据car_type查询汽车<br>模块名：mybatis-005-antic</p><h3 id="使用"><a href="#使用" class="headerlink" title="使用#{}"></a>使用#{}</h3><p>CarMapper.xml，放在类的根路径下：<strong>注意namespace必须和接口名一致。id必须和接口中方法名一致</strong>。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCarType&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">            id,car_num as carNum,brand,guide_price as guidePrice,produce_time as produceTime,car_type as carType</span><br><span class="line">        from</span><br><span class="line">            t_car</span><br><span class="line">        where</span><br><span class="line">            car_type = #&#123;carType&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试程序</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.mybatis.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.powernode.mybatis.mapper.CarMapper;</span><br><span class="line"><span class="keyword">import</span> com.powernode.mybatis.pojo.Car;</span><br><span class="line"><span class="keyword">import</span> com.powernode.mybatis.utils.SqlSessionUtil;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CarMapper测试类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByCarType</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> (CarMapper) SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">        List&lt;Car&gt; cars = mapper.selectByCarType(<span class="string">&quot;燃油车&quot;</span>);</span><br><span class="line">        cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660617419624-9c151df7-6c1e-469b-8489-2694009e68b6.png#clientId=ub45c156e-c1a9-4&from=paste&height=350&id=u93c899a2&originHeight=350&originWidth=1651&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43346&status=done&style=shadow&taskId=u2520d823-0c81-4691-9dc1-73721cda9c7&title=&width=1651" alt="5EDAF14B-4BC2-4ad1-A204-9AF8CAF39557.png"><br>通过执行可以清楚的看到，sql语句中是带有 ? 的，这个 ? 就是大家在JDBC中所学的占位符，专门用来接收值的。<br>把“燃油车”以String类型的值，传递给 ?<br>这就是 #{}，它会先进行sql语句的预编译，然后再给占位符传值</p><h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用${}"></a>使用${}</h3><p>同样的需求，我们使用${}来完成<br>CarMapper.xml文件修改如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCarType&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">            id,car_num as carNum,brand,guide_price as guidePrice,produce_time as produceTime,car_type as carType</span><br><span class="line">        from</span><br><span class="line">            t_car</span><br><span class="line">        where</span><br><span class="line">            <span class="comment">&lt;!--car_type = #&#123;carType&#125;--&gt;</span></span><br><span class="line">            car_type = $&#123;carType&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>再次运行测试程序：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660617746157-bdb389c7-5752-42f7-a023-c0b8792cf604.png#clientId=ub45c156e-c1a9-4&from=paste&height=267&id=uae71a1bc&originHeight=267&originWidth=1159&originalType=binary&ratio=1&rotation=0&showTitle=false&size=41737&status=done&style=shadow&taskId=u24448be4-f1e4-4dc3-b5f5-ff70c61a321&title=&width=1159" alt="F8DB6119-8032-47f2-941F-ECCD4B9B5ABF.png"><br>出现异常了，这是为什么呢？看看生成的sql语句：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660617813209-5e0d9395-452b-42ed-bee2-816d41f17c30.png#clientId=ub45c156e-c1a9-4&from=paste&height=205&id=ub9b192c4&originHeight=205&originWidth=1636&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23089&status=done&style=shadow&taskId=uc78e2b97-b19c-4334-9de1-a12f7ab44cf&title=&width=1636" alt="A978AA37-AED0-4576-8BA9-9F63ED9ECF81.png"></p><p>很显然，${} 是先进行sql语句的拼接，然后再编译，出现语法错误是正常的，因为 燃油车 是一个字符串，在sql语句中应该添加单引号<br>这是#{}的sql语句：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Preparing: select id, car_num as carNum, brand, guide_price as guidePrice, produce_time as produceTime, car_type as carType from t_car where car_type = ?</span><br><span class="line">Parameters:新能源(String)</span><br></pre></td></tr></table></figure><p>这是${}的sql语句</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Preparing:select id, car_num as carNum, brand, guide_price as guidePrice, produce_time as produceTime, car_type as car_Type from t_car where car_type = 新能源</span><br><span class="line">Parameters :</span><br></pre></td></tr></table></figure><h3 id="什么情况下必须使用"><a href="#什么情况下必须使用" class="headerlink" title="什么情况下必须使用${}"></a>什么情况下必须使用${}</h3><p>当需要进行sql语句关键字拼接的时候。必须使用${}<br>需求：通过向sql语句中注入asc或desc关键字，来完成数据的升序或降序排列。</p><ul><li><strong>先使用#{}尝试：</strong></li></ul><p>CarMapper接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有的Car</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ascOrDesc asc或desc</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectAll</span><span class="params">(String ascOrDesc)</span>;</span><br></pre></td></tr></table></figure><p>CarMapper.xml文件：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">  id,car_num as carNum,brand,guide_price as guidePrice,produce_time as produceTime,car_type as carType</span><br><span class="line">  from</span><br><span class="line">  t_car</span><br><span class="line">  order by carNum #&#123;key&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试程序</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAll</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> (CarMapper) SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectAll(<span class="string">&quot;desc&quot;</span>);</span><br><span class="line">    cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660619431786-c9ac3a1d-c9f7-494f-bfe3-496ce4beb914.png#clientId=ub45c156e-c1a9-4&from=paste&height=457&id=ucadbc85e&originHeight=457&originWidth=1647&originalType=binary&ratio=1&rotation=0&showTitle=false&size=55571&status=done&style=shadow&taskId=ub8101801-cb14-4323-bf76-530acda8b5c&title=&width=1647" alt="9F39C1BA-BFB5-4482-8859-A665AF9BB4F5.png"><br>报错的原因是sql语句不合法，因为采用这种方式传值，最终sql语句会是这样：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,car_num <span class="keyword">as</span> carNum,brand,guide_price <span class="keyword">as</span> guidePrice,produce_time <span class="keyword">as</span> produceTime,car_type <span class="keyword">as</span> carType <span class="keyword">from</span> t_car <span class="keyword">order</span> <span class="keyword">by</span> carNum <span class="string">&#x27;desc&#x27;</span></span><br></pre></td></tr></table></figure><p>desc是一个关键字，不能带单引号的，所以在进行sql语句关键字拼接的时候，必须使用${}</p><ul><li><strong>使用${} 改造</strong></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">  id,car_num as carNum,brand,guide_price as guidePrice,produce_time as produceTime,car_type as carType</span><br><span class="line">  from</span><br><span class="line">  t_car</span><br><span class="line">  <span class="comment">&lt;!--order by carNum #&#123;key&#125;--&gt;</span></span><br><span class="line">  order by carNum $&#123;key&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>再次执行测试程序：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660619635336-168c3097-fe96-49aa-b855-d111f5f6e66d.png#clientId=ub45c156e-c1a9-4&from=paste&height=388&id=u310de771&originHeight=388&originWidth=1653&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46770&status=done&style=shadow&taskId=ud013f125-0797-4793-820c-605c609efe0&title=&width=1653" alt="BD556528-B6C2-4842-A776-37B26B3B0F43.png"></p><h3 id="拼接表名"><a href="#拼接表名" class="headerlink" title="拼接表名"></a>拼接表名</h3><p>业务背景：实际开发中，有的表数据量非常庞大，可能会采用分表方式进行存储，比如每天生成一张表，表的名字与日期挂钩，例如：2022年8月1日生成的表：t_user20220108。2000年1月1日生成的表：t_user20000101。此时前端在进行查询的时候会提交一个具体的日期，比如前端提交的日期为：2000年1月1日，那么后端就会根据这个日期动态拼接表名为：t_user20000101。有了这个表名之后，将表名拼接到sql语句当中，返回查询结果。那么大家思考一下，拼接表名到sql语句当中应该使用#{} 还是 ${} 呢？<br>使用#{}会是这样：select * from ‘t_car’<br>使用${}会是这样：select * from t_car</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllByTableName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">  id,car_num as carNum,brand,guide_price as guidePrice,produce_time as produceTime,car_type as carType</span><br><span class="line">  from</span><br><span class="line">  $&#123;tableName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据表名查询所有的Car</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tableName</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectAllByTableName</span><span class="params">(String tableName)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAllByTableName</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectAllByTableName(<span class="string">&quot;t_car&quot;</span>);</span><br><span class="line">    cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660798482963-16baeed4-cd22-4a0e-a631-6f49ee9f101b.png#clientId=u85e451ff-5650-4&from=paste&height=364&id=u47cf528d&originHeight=364&originWidth=1455&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34247&status=done&style=shadow&taskId=u38eb2b5f-ed66-4859-adab-e6b9419b805&title=&width=1455" alt="28B639CD-FD3B-43bb-AB56-6130419BBAA1.png"></p><h3 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h3><p>业务背景：一次删除多条记录。<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660799087155-ec264d4c-cafa-458d-85b9-f18b4c34bafd.png#clientId=u85e451ff-5650-4&from=paste&height=134&id=u6e9cb5be&originHeight=134&originWidth=228&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2335&status=done&style=shadow&taskId=u87c4a40d-2b79-4042-afd3-23d8d331e8c&title=&width=228" alt="BF64FC68-5697-4695-AD2A-8D32297AED66.png"><br>对应的sql语句：</p><ul><li>delete from t_user where id &#x3D; 1 or id &#x3D; 2 or id &#x3D; 3;这个后面动态sql会讲</li><li>delete from t_user where id in(1, 2, 3);</li></ul><p>假设现在使用in的方式处理，前端传过来的字符串：1, 2, 3<br>如果使用mybatis处理，应该使用#{} 还是 ${}<br>使用#{} ：delete from t_user where id in(‘1,2,3’) <strong>执行错误：1292 - Truncated incorrect DOUBLE value: ‘1,2,3’</strong><br>使用${} ：delete from t_user where id in(1, 2, 3)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id批量删除</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteBatch</span><span class="params">(String ids)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteBatch&quot;</span>&gt;</span></span><br><span class="line">  delete from t_car where id in($&#123;ids&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteBatch</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> mapper.deleteBatch(<span class="string">&quot;1,2,3&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;删除了几条记录：&quot;</span> + count);</span><br><span class="line">    SqlSessionUtil.openSession().commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660803646232-44b4c7ca-119d-45ce-83c1-aefa2e3c6255.png#clientId=u85e451ff-5650-4&from=paste&height=204&id=u01e063bc&originHeight=204&originWidth=903&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25296&status=done&style=shadow&taskId=u9f1f14c4-efca-437a-ab08-6ec4d388eef&title=&width=903" alt="79F7AB85-F3CA-4c27-873C-CCCDA3D75779.png"></p><h3 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h3><p>需求：查询奔驰系列的汽车。【只要品牌brand中含有奔驰两个字的都查询出来。实现下面的这种语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_car <span class="keyword">where</span> brand <span class="keyword">like</span> <span class="string">&#x27;%奔驰%&#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据品牌进行模糊查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likeBrank</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectLikeByBrand</span><span class="params">(String likeBrank)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectLikeByBrand</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectLikeByBrand(<span class="string">&quot;奔驰&quot;</span>);</span><br><span class="line">    cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectLikeByBrand&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">  id,car_num as carNum,brand,guide_price as guidePrice,produce_time as produceTime,car_type as carType</span><br><span class="line">  from</span><br><span class="line">  t_car</span><br><span class="line">  where</span><br><span class="line">  brand like &#x27;%#&#123;brand&#125;%&#x27;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用这个会报错，因为传到jdbc里会变成brand like ‘%?%’，只有单个?才是占位符，如果在单引号里面就不是占位符了</p><p>第一种方案:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;%$&#123;brand&#125;%&#x27;</span></span><br></pre></td></tr></table></figure><p>第二种方案:concat函数，这个是mysql数据库当中的一个函数，专门进行字符串拼接</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">concat(<span class="string">&#x27;%&#x27;</span>,#&#123;brand&#125;,<span class="string">&#x27;%&#x27;</span>)</span><br></pre></td></tr></table></figure><p>第三种方案:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">concat(<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;$&#123;brand&#125;&#x27;</span>,<span class="string">&#x27;%&#x27;</span>)</span><br></pre></td></tr></table></figure><p>第四种方案:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;%&quot;#&#123;brand&#125;&quot;%&quot;</span><br></pre></td></tr></table></figure><h2 id="9-2-typeAliases（起别名）"><a href="#9-2-typeAliases（起别名）" class="headerlink" title="9.2 typeAliases（起别名）"></a>9.2 typeAliases（起别名）</h2><p>namespace不可以起别名，必须全限定接口名</p><p>别名不区分大小写</p><p>我们来观察一下CarMapper.xml中的配置信息：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.powernode.mybatis.pojo.Car&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">            id,car_num as carNum,brand,guide_price as guidePrice,produce_time as produceTime,car_type as carType</span><br><span class="line">        from</span><br><span class="line">            t_car</span><br><span class="line">        order by carNum $&#123;key&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>resultType属性用来指定查询结果集的封装类型，这个名字可以起别名<br>在mybatis-config.xml文件中使用typeAliases标签来起别名，包括两种方式：</p><h3 id="第一种方式：typeAlias"><a href="#第一种方式：typeAlias" class="headerlink" title="第一种方式：typeAlias"></a>第一种方式：typeAlias</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.powernode.mybatis.pojo.Car&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;Car&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>首先要注意typeAliases标签的放置位置，如果不清楚的话，可以看看错误提示信息。</li><li>typeAliases标签中的typeAlias可以写多个。</li><li>typeAlias：<ul><li>type属性：指定给哪个类起别名</li><li>alias属性：指定别名。<ul><li>alias属性不是必须的，如果缺省的话，type属性指定的类型名的简类名作为别名。</li><li>alias是大小写不敏感的。也就是说假设alias&#x3D;”Car”，再用的时候，可以CAR，也可以car，也可以Car，都行。</li></ul></li></ul></li></ul><h3 id="第二种方式：package"><a href="#第二种方式：package" class="headerlink" title="第二种方式：package"></a>第二种方式：package</h3><p>如果一个包下的类太多，每个类都要起别名，会导致typeAlias标签配置较多，所以mybatis用提供package的配置方式，只需要指定包名，该包下的所有类都自动起别名，别名就是简类名。并且别名不区分大小写。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.powernode.mybatis.pojo&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>package也可以配置多个的。</p><h2 id="9-3-mappers"><a href="#9-3-mappers" class="headerlink" title="9.3 mappers"></a>9.3 mappers</h2><p>SQL映射文件的配置方式包括以下四种：</p><h3 id="resource"><a href="#resource" class="headerlink" title="resource"></a>resource</h3><p>这种方式是从类的根路径下开始査找资源。采用这种方式的话，你的配置文件需要放到类路径当中才行。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;CarMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">要求类的根路径下必须有:CarMapper.xml</span><br></pre></td></tr></table></figure><h3 id="url"><a href="#url" class="headerlink" title="url"></a>url</h3><p>这种方式显然使用了绝对路径的方式，这种配置对SQL映射文件存放的位置没有要求，随意，但是可移植性差。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///d:/carMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">要求在d:/下有CarMapper.xml文件</span><br></pre></td></tr></table></figure><h3 id="class"><a href="#class" class="headerlink" title="class"></a>class</h3><p>这个位置提供的是mapper接口的全限定接口名，必须带有包名的。</p><p>思考:mapper标签的作用是指定SqlMapper.xm文件的路径，指定接口名有什么用呢?</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>如果你class指定是:com.powernode.mybatis.mapper.CarMapper</p><p>那么mybatis框架会自动去com&#x2F;powernode&#x2F;mybatis&#x2F;mapper目录下査找carMapper.xml文件。<br>注意:也就是说:如果你采用这种方式，那么你必须保证CarMapper.xml文件和CarMapper接口必须在同一个目录下。并且名字一致。<br>CarMapper接口-&gt; CarMapper.xml<br>LogMapper接口-&gt;LogMapper.xml</p><p>如果使用这种方式必须满足以下条件：</p><ul><li>SQL映射文件和mapper接口放在同一个目录下。</li><li>SQL映射文件的名字也必须和mapper接口名一致。</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;全限定接口名，带有包名&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>将CarMapper.xml文件移动到和mapper接口同一个目录下：</p><ul><li><p>在resources目录下新建多重目录的话，必须是这样创建：</p><p>com&#x2F;powernode&#x2F;mybatis&#x2F;mapper，不能com.powernode.mybatis.mapper</p></li><li><p>将CarMapper.xml文件移动到mapper目录下</p></li><li><p>修改mybatis-config.xml文件</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="package"><a href="#package" class="headerlink" title="package"></a>package</h3><p>如果class较多，可以使用这种package的方式，但前提条件和上一种方式一样。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这种方式在实际开发中是使用的。--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--前提是:XML文件必须和接口放在一起。并且名字一致。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.powernode.mybatis.mapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="9-4-idea配置文件模板"><a href="#9-4-idea配置文件模板" class="headerlink" title="9.4 idea配置文件模板"></a>9.4 idea配置文件模板</h2><p>mybatis-config.xml和SqlMapper.xml文件可以在IDEA中提前创建好模板，以后通过模板创建配置文件。(右击创建时会显示)<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660629382298-df2d0e70-d8ce-4ae6-9f19-e74923adf121.png#averageHue=#3f4446&clientId=ub45c156e-c1a9-4&from=paste&height=714&id=u9b816dcf&originHeight=714&originWidth=978&originalType=binary&ratio=1&rotation=0&showTitle=false&size=71664&status=done&style=shadow&taskId=u4da55a51-2eb8-4e43-aca9-e22026a87cc&title=&width=978" alt="7ABBEF88-D7E3-4a73-8411-61CCA49CC3E3.png"></p><h2 id="9-5-插入数据时获取自动生成的主键"><a href="#9-5-插入数据时获取自动生成的主键" class="headerlink" title="9.5 插入数据时获取自动生成的主键"></a>9.5 插入数据时获取自动生成的主键</h2><p>前提是：主键是自动生成的。<br>业务背景：一个用户有多个角色。<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660808179627-69b14158-fbd4-4189-83cf-aa944fe26fa1.png#averageHue=#f2f2f2&clientId=u85e451ff-5650-4&from=paste&height=419&id=u00f52746&originHeight=419&originWidth=455&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7321&status=done&style=shadow&taskId=u791be7e5-7ee8-4f58-bf42-1357324a865&title=&width=455" alt="E9F189EB-F5E2-465f-828C-127DB34968FE.png"><br>插入一条新的记录之后，自动生成了主键，而这个主键需要在其他表中使用时。<br>插入一个用户数据的同时需要给该用户分配角色：需要将生成的用户的id插入到角色表的user_id字段上。<br>第一种方式：可以先插入用户数据，再写一条查询语句获取id，然后再插入user_id字段。【比较麻烦】<br>第二种方式：mybatis提供了一种方式更加便捷。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取自动生成的主键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> car</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insertUseGeneratedKeys</span><span class="params">(Car car)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">useGeneratedKeys=&quot;true”使用自动生成的主键值。</span></span><br><span class="line"><span class="comment">keyProperty=&quot;id”指定主键值赋值给对象的哪个属性。这个就表示将主键值赋值给Car对象的id属性。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUseGeneratedKeys&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">  insert into t_car(id,car_num,brand,guide_price,produce_time,car_type) values(null,#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#averageHue=#dad8d7&clientId=u6b7aa99c-2be4-4&from=paste&id=WQJOd&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p><h1 id="十、MyBatis参数处理"><a href="#十、MyBatis参数处理" class="headerlink" title="十、MyBatis参数处理"></a>十、MyBatis参数处理</h1><p>模块名：mybatis-006-param<br>表：t_student<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660634643604-17c32925-3d16-4477-84be-296ef44509a0.png#averageHue=#f7f6f5&clientId=ub45c156e-c1a9-4&from=paste&height=275&id=fR18k&originHeight=275&originWidth=717&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13614&status=done&style=shadow&taskId=u800b2f44-359b-4d0b-a1fc-0f886c4cb3f&title=&width=717" alt="2F36FCDF-464E-45b5-8F7B-09AB6B378457.png"><br>表中现有数据：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660635212357-e422625b-d176-4189-ad30-7b9dad1b5dd9.png#averageHue=#f5f4f3&clientId=ub45c156e-c1a9-4&from=paste&height=161&id=ud51ffba3&originHeight=161&originWidth=559&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8699&status=done&style=shadow&taskId=u2549c831-34cc-4804-bd8d-50235ffafa3&title=&width=559" alt="9A19F542-3229-4b71-B1B7-E2318489C588.png"><br>pojo类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.mybatis.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 学生类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Double height;</span><br><span class="line">    <span class="keyword">private</span> Character sex;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="comment">// constructor</span></span><br><span class="line">    <span class="comment">// setter and getter</span></span><br><span class="line">    <span class="comment">// toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10-1-单个简单类型参数"><a href="#10-1-单个简单类型参数" class="headerlink" title="10.1 单个简单类型参数"></a>10.1 单个简单类型参数</h2><p>简单类型包括：</p><ul><li>byte short int long float double char</li><li>Byte Short Integer Long Float Double Character</li><li>String</li><li>java.util.Date</li><li>java.sql.Date</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当接口中的方法的参数只有一个(单个参数)，并且参数的数据类型都是简单类型</span></span><br><span class="line"><span class="comment"> * 根据id査询、name査询、birth査询、sex査询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据name查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Student&gt; <span class="title function_">selectByName</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Student <span class="title function_">selectById</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据birth查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> birth</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Student&gt; <span class="title function_">selectByBirth</span><span class="params">(Date birth)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据sex查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Student&gt; <span class="title function_">selectBySex</span><span class="params">(Character sex)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(StudentMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByName</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Student&gt; students = mapper.selectByName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        students.forEach(student -&gt; System.out.println(student));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectById</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> mapper.selectById(<span class="number">2L</span>);</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByBirth</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Date</span> <span class="variable">birth</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>).parse(<span class="string">&quot;2022-08-16&quot;</span>);</span><br><span class="line">            List&lt;Student&gt; students = mapper.selectByBirth(birth);</span><br><span class="line">            students.forEach(student -&gt; System.out.println(student));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectBySex</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlsessionUtil.openSession();</span><br><span class="line"><span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(StudentMapper.class);</span><br><span class="line"><span class="comment">//char --&gt; Character传的是char的封装类型Character</span></span><br><span class="line"><span class="type">Character</span> <span class="variable">sex</span> <span class="operator">=</span> Character.value0f(<span class="string">&#x27;男&#x27;</span>);</span><br><span class="line">List&lt;Student&gt; students = mapper.selectBySex(sex);</span><br><span class="line">students.forEach(student -&gt; System.out.println(student));</span><br><span class="line">sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><input disabled="" type="checkbox"> <pre><code class="language-xml">&lt;mapper namespace=&quot;com.powernode.mybatis.mapper.StudentMapper&quot;&gt;    &lt;!--parameterType属性的作用:        告诉mybatis框架，我这个方法的参数类型是什么类型:        mybatis框架自身带有类型自动推断机制，所以大部分情况下parameterType属性都是可以省略不写的。        SQL语句最终是这样的:            select * from t_student where id = ?        JDBC底层会通过ps.setXxx(第几个问号，传什么值)来传值--&gt;         &lt;!--这里直接是student是因为起了别名--&gt;    &lt;select id=&quot;selectById&quot; resultType=&quot;student&quot; parameterType=&quot;java.lang.Long&quot;&gt;        select * from t_student where id = #{id}    &lt;/select&gt;&lt;/mapper&gt;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 也就是说对于mybatis来说，它是可以自动推断出ps.setXxxx()方法的。ps.setString()还是ps.setInt()。它可以自动推断。</span><br><span class="line"></span><br><span class="line">通过mybatis手册可以看到parameterType也可以简写</span><br><span class="line"></span><br><span class="line">![image-20251206024536756](./images/老杜MyBatis/image-20251206024536756.png)</span><br><span class="line"></span><br><span class="line">其实SQL映射文件中的配置比较完整的写法是：</span><br><span class="line"></span><br><span class="line">~~~xml</span><br><span class="line">&lt;select id=&quot;selectByName&quot; resultType=&quot;student&quot; parameterType=&quot;java.lang.String&quot;&gt;</span><br><span class="line">  select * from t_student where name = #&#123;name, javaType=String, jdbcType=VARCHAR&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure></code></pre></li></ul><p>其中sql语句中的javaType是告诉mybatis传过来的值java类型是string，jdbcType是数据库表里的类型是，以及select标签中的parameterType属性，都是用来帮助mybatis进行类型确定的。不过这些配置多数是可以省略的。因为mybatis它有强大的自动类型推断机制。</p><ul><li>javaType：可以省略</li><li>jdbcType：可以省略</li><li>parameterType：可以省略</li></ul><p><strong>如果参数只有一个的话，#{} 里面的内容就随便写了。对于 ${} 来说，注意加单引号。</strong></p><h2 id="10-2-Map参数"><a href="#10-2-Map参数" class="headerlink" title="10.2 Map参数"></a>10.2 Map参数</h2><p>需求：根据name和age查询</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 保存学生信息，通过Map参数。以下是单个参数。但是参数的类型不是简单类型。是Map集合。</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> paramMap</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Student&gt; <span class="title function_">selectByParamMap</span><span class="params">(Map&lt;String,Object&gt; paramMap)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByParamMap</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.openSession();</span><br><span class="line"><span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">Map&lt;String,0bject&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;姓名&quot;</span>，<span class="string">&quot;赵六”);</span></span><br><span class="line"><span class="string">map.put(&quot;</span>年龄”，<span class="number">20</span>);</span><br><span class="line">map.put(<span class="string">&quot;身高”，1.81);</span></span><br><span class="line"><span class="string">map.put(&quot;</span>性别”，<span class="string">&#x27;男&#x27;</span>);</span><br><span class="line">map.put(<span class="string">&quot;生日&quot;</span>，<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">mapper.insertStudentByMap(map);</span><br><span class="line">sqlSession.commit();</span><br><span class="line">sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudentByMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">insert into t_student(id,name ,age,sex,birth,height) values(null,#&#123;姓补,#&#123;年龄&#125;,#&#123;性别&#125;,#&#123;生日&#125;,#&#123;身高&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试运行正常。<br>**这种方式是手动封装Map集合，将每个条件以key和value的形式存放到集合中。然后在使用的时候通过#{map集合的key}来取值。**里面一定要写key</p><h2 id="10-3-实体类参数"><a href="#10-3-实体类参数" class="headerlink" title="10.3 实体类参数"></a>10.3 实体类参数</h2><p>需求：插入一条Student数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存学生数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> student</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insertStudentByPOJO</span><span class="params">(Student student)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">parameterType=&quot;student&quot;省略也可以</span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudentByPOJO&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">  insert into t_student values(null,#&#123;name&#125;,#&#123;age&#125;,#&#123;height&#125;,#&#123;birth&#125;,#&#123;sex&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertStudentByPOJO</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student.setName(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">    student.setAge(<span class="number">30</span>);</span><br><span class="line">    student.setHeight(<span class="number">1.70</span>);</span><br><span class="line">    student.setSex(<span class="string">&#x27;男&#x27;</span>);</span><br><span class="line">    student.setBirth(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> mapper.insert(student);</span><br><span class="line">    SqlSessionUtil.openSession().commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行正常，数据库中成功添加一条数据。<br><strong>这里需要注意的是：#{} 里面写的是属性名字。这个属性名其本质上是：set&#x2F;get方法名去掉set&#x2F;get之后的名字。</strong></p><h2 id="10-4-多参数"><a href="#10-4-多参数" class="headerlink" title="10.4 多参数"></a>10.4 多参数</h2><p>需求：通过name和sex查询</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据name和sex查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sex</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;Student&gt; <span class="title function_">selectByNameAndSex</span><span class="params">(String name, Character sex)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByNameAndSex</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Student&gt; students = mapper.selectByNameAndSex(<span class="string">&quot;张三&quot;</span>, <span class="string">&#x27;女&#x27;</span>);</span><br><span class="line">    students.forEach(student -&gt; System.out.println(student));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByNameAndSex&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">  select * from t_student where name = #&#123;name&#125; and sex = #&#123;sex&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660641021618-ce3ac913-fe10-45f5-9760-3e51ef2dd864.png#clientId=u7e0d60f6-6020-4&from=paste&height=237&id=u010e6c4a&originHeight=237&originWidth=1632&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43805&status=done&style=shadow&taskId=ub6538fa2-2ec6-4a63-b094-3face43e433&title=&width=1632" alt="A386812C-F031-4f63-A6CE-174B7948CA31.png"><br>异常信息描述了：name参数找不到，可用的参数包括[arg1, arg0, param1, param2]<br>修改StudentMapper.xml配置文件：尝试使用[arg1, arg0, param1, param2]去参数</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByNameAndSex&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--select * from t_student where name = #&#123;name&#125; and sex = #&#123;sex&#125;--&gt;</span></span><br><span class="line">  select * from t_student where name = #&#123;arg0&#125; and sex = #&#123;arg1&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>运行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660641284279-64a7312a-d036-448f-aaef-a1bcde8abba2.png#clientId=u7e0d60f6-6020-4&from=paste&height=167&id=u6acb95a5&originHeight=167&originWidth=939&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19111&status=done&style=shadow&taskId=u244175c9-f543-4b21-9060-0e334bd297e&title=&width=939" alt="351B370F-7199-49d2-A54D-E42E668FE96E.png"><br>再次尝试修改StudentMapper.xml文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByNameAndSex&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--select * from t_student where name = #&#123;name&#125; and sex = #&#123;sex&#125;--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--select * from t_student where name = #&#123;arg0&#125; and sex = #&#123;arg1&#125;--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--select * from t_student where name = #&#123;param1&#125; and sex = #&#123;param2&#125;--&gt;</span></span><br><span class="line">  select * from t_student where name = #&#123;arg0&#125; and sex = #&#123;param2&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>通过测试可以看到：</p><ul><li>arg0 是第一个参数</li><li>param1是第一个参数</li><li>arg1 是第二个参数</li><li>param2是第二个参数</li></ul><p>实现原理：<strong>实际上在mybatis底层会创建一个map集合，以arg0&#x2F;param1为key，以方法上的参数为value</strong>，例如以下代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;arg0&quot;</span>, name);</span><br><span class="line">map.put(<span class="string">&quot;arg1&quot;</span>, sex);</span><br><span class="line">map.put(<span class="string">&quot;param1&quot;</span>, name);</span><br><span class="line">map.put(<span class="string">&quot;param2&quot;</span>, sex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 所以可以这样取值：#&#123;arg0&#125; #&#123;arg1&#125; #&#123;param1&#125; #&#123;param2&#125;</span></span><br><span class="line"><span class="comment">// 其本质就是#&#123;map集合的key&#125;</span></span><br></pre></td></tr></table></figure><p>注意：<strong>使用mybatis3.4.2之前的版本时：要用#{0}和#{1}这种形式。</strong></p><h2 id="10-5-Param注解（命名参数）"><a href="#10-5-Param注解（命名参数）" class="headerlink" title="10.5 @Param注解（命名参数）"></a>10.5 @Param注解（命名参数）</h2><p>可以不用arg0 arg1 param1 param2吗？这个map集合的key我们自定义可以吗？当然可以。使用@Param注解即可。这样可以增强可读性。<br>需求：根据name和age查询</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据name和age查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> age</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Student&gt; <span class="title function_">selectByNameAndAge</span><span class="params">(<span class="meta">@Param(value=&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;age&quot;)</span> <span class="type">int</span> age)</span>;</span><br><span class="line"><span class="comment">//这里的value也可以省略不写，底层只有一个String value();，写成@Param(&quot;name&quot;)</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByNameAndAge</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Student&gt; stus = mapper.selectByNameAndAge(<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    stus.forEach(student -&gt; System.out.println(student));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByNameAndAge&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">  select * from t_student where name = #&#123;name&#125; and age = #&#123;age&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>通过测试，一切正常。<br>核心：@Param(“<strong>这里填写的其实就是map集合的key</strong>“)</p><p>注意：使用了@Param注解之后，arg0和arg1失效，但param1和param2还可以</p><h2 id="10-6-Param源码分析"><a href="#10-6-Param源码分析" class="headerlink" title="10.6 @Param源码分析"></a>10.6 @Param源码分析</h2><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660643136419-5851b57a-ae96-4488-bb0c-8864c92771f3.png#clientId=u7e0d60f6-6020-4&from=paste&height=482&id=ue4cbbe91&originHeight=482&originWidth=996&originalType=binary&ratio=1&rotation=0&showTitle=false&size=70211&status=done&style=shadow&taskId=u01c71bab-74f0-4620-bf10-2779e9b2164&title=&width=996" alt="FF11FF8F-42C2-405a-AFA4-708FC564CC46.png"><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=Q9lDv&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p><h1 id="十一、MyBatis查询语句专题"><a href="#十一、MyBatis查询语句专题" class="headerlink" title="十一、MyBatis查询语句专题"></a>十一、MyBatis查询语句专题</h1><p>模块名：mybatis-007-select<br>打包方式：jar<br>引入依赖：mysql驱动依赖、mybatis依赖、logback依赖、junit依赖。<br>引入配置文件：jdbc.properties、mybatis-config.xml、logback.xml<br>创建pojo类：Car<br>创建Mapper接口：CarMapper<br>创建Mapper接口对应的映射文件：com&#x2F;powernode&#x2F;mybatis&#x2F;mapper&#x2F;CarMapper.xml<br>创建单元测试：CarMapperTest<br>拷贝工具类：SqlSessionUtil</p><h2 id="11-1-返回Car"><a href="#11-1-返回Car" class="headerlink" title="11.1 返回Car"></a>11.1 返回Car</h2><p>当查询的结果，有对应的实体类，并且查询结果只有一条时：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.powernode.mybatis.pojo.Car;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Car SQL映射器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id主键查询：结果最多只有一条</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Car <span class="title function_">selectById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">        select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.mybatis.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.powernode.mybatis.mapper.CarMapper;</span><br><span class="line"><span class="keyword">import</span> com.powernode.mybatis.pojo.Car;</span><br><span class="line"><span class="keyword">import</span> com.powernode.mybatis.utils.SqlSessionUtil;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectById</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> mapper.selectById(<span class="number">35L</span>);</span><br><span class="line">        System.out.println(car);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660810312287-ddfb6d00-1e96-425b-b4e6-fd6cdb8a9593.png#clientId=u85e451ff-5650-4&from=paste&height=159&id=u1080fb42&originHeight=159&originWidth=1197&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33909&status=done&style=shadow&taskId=u093b09e4-27b0-4610-a58e-a198c055725&title=&width=1197" alt="1977C3E7-9C65-4d2e-AFC2-8893F747F5E1.png"><br><strong>查询结果是一条的话可以使用List集合接收吗？当然可以</strong>。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据id主键查询：结果最多只有一条，可以放到List集合中吗？</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectByIdToList</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIdToList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">  select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByIdToList</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectByIdToList(<span class="number">35L</span>);</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660810652140-a438fba7-c21c-488a-9d18-c0383262f1dc.png#clientId=u85e451ff-5650-4&from=paste&height=184&id=ud2241e3a&originHeight=184&originWidth=1146&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36923&status=done&style=shadow&taskId=uc0b4ecb8-4b5d-46de-93db-3b397c1de2a&title=&width=1146" alt="C2F972FD-9268-4584-A11E-308355F3EF1D.png"></p><h2 id="11-2-返回List"><a href="#11-2-返回List" class="headerlink" title="11.2 返回List"></a>11.2 返回List<Car></h2><p>当查询的记录条数是多条的时候，必须使用集合接收。如果使用单个实体类接收会出现异常。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询所有的Car</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">  select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAll</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectAll();</span><br><span class="line">    cars.forEach(car -&gt; System.out.println(car));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660816141237-79a6a966-d3ec-4f7b-bc38-b1adb5df8fee.png#clientId=u85e451ff-5650-4&from=paste&height=260&id=ubd3d5916&originHeight=260&originWidth=1248&originalType=binary&ratio=1&rotation=0&showTitle=false&size=61845&status=done&style=shadow&taskId=u36c4e8d9-5007-4148-93bb-204f264dd19&title=&width=1248" alt="4813B87A-15F2-4638-B813-1B35699BD132.png"><br>如果返回多条记录，采用单个实体类接收会怎样？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询多条记录，采用单个实体类接收会怎样？</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Car <span class="title function_">selectAll2</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll2&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">  select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAll2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> mapper.selectAll2();</span><br><span class="line">    System.out.println(car);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660816549528-b600f5a9-81b4-4725-87c7-b933ee60ca39.png#clientId=u85e451ff-5650-4&from=paste&height=320&id=u1669660d&originHeight=320&originWidth=1357&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51856&status=done&style=shadow&taskId=u2164854e-7c28-4d8b-bd6d-8495d4a6566&title=&width=1357" alt="8D921E96-56B6-48a2-A605-0F27EE2D38C6.png"></p><h2 id="11-3-返回Map"><a href="#11-3-返回Map" class="headerlink" title="11.3 返回Map"></a>11.3 返回Map</h2><p>当返回的数据，没有合适的实体类对应的话，可以采用Map集合接收。字段名做key，字段值做value。<br>查询如果可以保证只有一条数据，则返回一个Map集合即可。<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660816974662-61782965-88fb-466e-a5ff-5af02ab614df.png#clientId=u85e451ff-5650-4&from=paste&height=247&id=ua0cc183c&originHeight=247&originWidth=257&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4315&status=done&style=shadow&taskId=u86d1b32b-7d18-4306-b22c-cb73b34e0fd&title=&width=257" alt="24B63480-BD38-4039-9958-A2A8BE5291F7.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过id查询一条记录，返回Map集合</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Map&lt;String, Object&gt; <span class="title function_">selectByIdRetMap</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIdRetMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>resultMap&#x3D;”map”，这是因为mybatis内置了很多别名。【参见mybatis开发手册】</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByIdRetMap</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    Map&lt;String,Object&gt; car = mapper.selectByIdRetMap(<span class="number">35L</span>);</span><br><span class="line">    System.out.println(car);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660817561293-68e25ddd-ed72-4121-99f6-35617d2ae0b0.png#clientId=u85e451ff-5650-4&from=paste&height=197&id=u7b2de67d&originHeight=197&originWidth=1264&originalType=binary&ratio=1&rotation=0&showTitle=false&size=38324&status=done&style=shadow&taskId=u66a705d7-4025-438c-a28e-7ecd801f877&title=&width=1264" alt="A661326B-A8BD-43b1-BD01-EB5A4BB9FE30.png"><br>当然，如果返回一个Map集合，可以将Map集合放到List集合中吗？当然可以，这里就不再测试了。<br>反过来，如果返回的不是一条记录，是多条记录的话，只采用单个Map集合接收，这样同样会出现之前的异常：<strong>TooManyResultsException</strong></p><h2 id="11-4-返回List"><a href="#11-4-返回List" class="headerlink" title="11.4 返回List"></a>11.4 返回List<Map></h2><p>查询结果条数大于等于1条数据，则可以返回一个存储Map集合的List集合。List<Map>等同于List<Car><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660817896708-0f3d0b44-4a0e-40ed-b609-b4d0e5fce1b6.png#clientId=u85e451ff-5650-4&from=paste&height=801&id=u002d3df7&originHeight=801&originWidth=529&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24621&status=done&style=shadow&taskId=u4a4cb53c-032e-4bcb-964e-95f2c8d1a73&title=&width=529" alt="8B951F18-A8AC-4301-96A7-77B8838C6A8F.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有的Car，返回一个List集合。List集合中存储的是Map集合。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">List&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">selectAllRetListMap</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllRetListMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAllRetListMap</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Map&lt;String,Object&gt;&gt; cars = mapper.selectAllRetListMap();</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span>carType=燃油车<span class="punctuation">,</span> carNum=<span class="number">103</span><span class="punctuation">,</span> guidePrice=<span class="number">50.30</span><span class="punctuation">,</span> produceTime=<span class="number">2020</span><span class="number">-10</span><span class="number">-01</span><span class="punctuation">,</span> id=<span class="number">33</span><span class="punctuation">,</span> brand=奔驰E300L<span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="punctuation">&#123;</span>carType=电车<span class="punctuation">,</span> carNum=<span class="number">102</span><span class="punctuation">,</span> guidePrice=<span class="number">30.23</span><span class="punctuation">,</span> produceTime=<span class="number">2018</span><span class="number">-09</span><span class="number">-10</span><span class="punctuation">,</span> id=<span class="number">34</span><span class="punctuation">,</span> brand=比亚迪汉<span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="punctuation">&#123;</span>carType=燃油车<span class="punctuation">,</span> carNum=<span class="number">103</span><span class="punctuation">,</span> guidePrice=<span class="number">50.30</span><span class="punctuation">,</span> produceTime=<span class="number">2020</span><span class="number">-10</span><span class="number">-01</span><span class="punctuation">,</span> id=<span class="number">35</span><span class="punctuation">,</span> brand=奔驰E300L<span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="punctuation">&#123;</span>carType=燃油车<span class="punctuation">,</span> carNum=<span class="number">103</span><span class="punctuation">,</span> guidePrice=<span class="number">33.23</span><span class="punctuation">,</span> produceTime=<span class="number">2020</span><span class="number">-10</span><span class="number">-11</span><span class="punctuation">,</span> id=<span class="number">36</span><span class="punctuation">,</span> brand=奔驰C200<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  ......</span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><h2 id="11-5-返回Map"><a href="#11-5-返回Map" class="headerlink" title="11.5 返回Map&lt;String,Map&gt;"></a>11.5 返回Map&lt;String,Map&gt;</h2><p><strong>拿Car的id做key，以后取出对应的Map集合时更方便。</strong><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660818043977-d5c56423-c5db-43ca-9c0c-eaa3f22a8f21.png#clientId=u85e451ff-5650-4&from=paste&height=761&id=u78390170&originHeight=761&originWidth=823&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24100&status=done&style=shadow&taskId=u4ec5bb54-42e4-451c-9150-b6dac3f92e9&title=&width=823" alt="79D7BA9E-6228-4c39-950A-D877EFCBADD1.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有的Car，返回一个Map集合。</span></span><br><span class="line"><span class="comment">     * Map集合的key是Car的id。</span></span><br><span class="line"><span class="comment">     * Map集合的value是对应Car。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@MapKey(&quot;id&quot;)</span></span><br><span class="line">Map&lt;Long,Map&lt;String,Object&gt;&gt; <span class="title function_">selectAllRetMap</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllRetMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAllRetMap</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    Map&lt;Long,Map&lt;String,Object&gt;&gt; cars = mapper.selectAllRetMap();</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="number">64</span>=<span class="punctuation">&#123;</span>carType=燃油车<span class="punctuation">,</span> carNum=<span class="number">133</span><span class="punctuation">,</span> guidePrice=<span class="number">50.30</span><span class="punctuation">,</span> produceTime=<span class="number">2020</span><span class="number">-01</span><span class="number">-10</span><span class="punctuation">,</span> id=<span class="number">64</span><span class="punctuation">,</span> brand=丰田霸道<span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line"><span class="number">66</span>=<span class="punctuation">&#123;</span>carType=燃油车<span class="punctuation">,</span> carNum=<span class="number">133</span><span class="punctuation">,</span> guidePrice=<span class="number">50.30</span><span class="punctuation">,</span> produceTime=<span class="number">2020</span><span class="number">-01</span><span class="number">-10</span><span class="punctuation">,</span> id=<span class="number">66</span><span class="punctuation">,</span> brand=丰田霸道<span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line"><span class="number">67</span>=<span class="punctuation">&#123;</span>carType=燃油车<span class="punctuation">,</span> carNum=<span class="number">133</span><span class="punctuation">,</span> guidePrice=<span class="number">50.30</span><span class="punctuation">,</span> produceTime=<span class="number">2020</span><span class="number">-01</span><span class="number">-10</span><span class="punctuation">,</span> id=<span class="number">67</span><span class="punctuation">,</span> brand=丰田霸道<span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line"><span class="number">69</span>=<span class="punctuation">&#123;</span>carType=燃油车<span class="punctuation">,</span> carNum=<span class="number">133</span><span class="punctuation">,</span> guidePrice=<span class="number">50.30</span><span class="punctuation">,</span> produceTime=<span class="number">2020</span><span class="number">-01</span><span class="number">-10</span><span class="punctuation">,</span> id=<span class="number">69</span><span class="punctuation">,</span> brand=丰田霸道<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">......</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="11-6-resultMap结果映射"><a href="#11-6-resultMap结果映射" class="headerlink" title="11.6 resultMap结果映射"></a>11.6 resultMap结果映射</h2><p>查询结果的列名和java对象的属性名对应不上怎么办？</p><ul><li>第一种方式：as 给列起别名</li><li>第二种方式：使用resultMap进行结果映射</li><li>第三种方式：是否开启驼峰命名自动映射（配置settings）</li></ul><h3 id="使用resultMap进行结果映射"><a href="#使用resultMap进行结果映射" class="headerlink" title="使用resultMap进行结果映射"></a>使用resultMap进行结果映射</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有Car，使用resultMap进行结果映射</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectAllByResultMap</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        resultMap:</span></span><br><span class="line"><span class="comment">            id：这个结果映射的标识，作为select标签的resultMap属性的值(在下面)。</span></span><br><span class="line"><span class="comment">            type：结果集要映射的类。可以使用别名。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;carResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--对象的唯一标识，官方解释是：为了提高mybatis的性能。建议写上。--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;carNum&quot;</span> <span class="attr">column</span>=<span class="string">&quot;car_num&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--当属性名和数据库列名一致时，可以省略。但建议都写上。--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--javaType用来指定属性类型。jdbcType用来指定列类型。一般可以省略。--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;brand&quot;</span> <span class="attr">column</span>=<span class="string">&quot;brand&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;guidePrice&quot;</span> <span class="attr">column</span>=<span class="string">&quot;guide_price&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;produceTime&quot;</span> <span class="attr">column</span>=<span class="string">&quot;produce_time&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;carType&quot;</span> <span class="attr">column</span>=<span class="string">&quot;car_type&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--resultMap属性的值必须和resultMap标签中id属性值一致。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllByResultMap&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;carResultMap&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAllByResultMap</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">carMapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = carMapper.selectAllByResultMap();</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果正常。</p><h3 id="是否开启驼峰命名自动映射"><a href="#是否开启驼峰命名自动映射" class="headerlink" title="是否开启驼峰命名自动映射"></a>是否开启驼峰命名自动映射</h3><p>使用这种方式的前提是：属性名遵循Java的命名规范，数据库表的列名遵循SQL的命名规范。<br>Java命名规范：首字母小写，后面每个单词首字母大写，遵循驼峰命名方式。<br>SQL命名规范：全部小写，单词之间采用下划线分割。<br>比如以下的对应关系：</p><table><thead><tr><th><strong>实体类中的属性名</strong></th><th><strong>数据库表的列名</strong></th></tr></thead><tbody><tr><td>carNum</td><td>car_num</td></tr><tr><td>carType</td><td>car_type</td></tr><tr><td>produceTime</td><td>produce_time</td></tr></tbody></table><p>如何启用该功能，在mybatis-config.xml文件中进行配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--放在properties标签后面--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询所有Car，启用驼峰命名自动映射</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectAllByMapUnderscoreToCamelCase</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllByMapUnderscoreToCamelCase&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAllByMapUnderscoreToCamelCase</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">carMapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = carMapper.selectAllByMapUnderscoreToCamelCase();</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果正常。</p><h2 id="11-7-返回总记录条数"><a href="#11-7-返回总记录条数" class="headerlink" title="11.7 返回总记录条数"></a>11.7 返回总记录条数</h2><p>需求：查询总记录条数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取总记录条数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">Long <span class="title function_">selectTotal</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--long是别名，可参考mybatis开发手册。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectTotal&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;long&quot;</span>&gt;</span></span><br><span class="line">  select count(*) from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectTotal</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">carMapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">total</span> <span class="operator">=</span> carMapper.selectTotal();</span><br><span class="line">    System.out.println(total);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660874705835-bd2767b1-c547-4a72-b7d7-229a3c89d74a.png#clientId=uce76794a-2043-4&from=paste&height=152&id=u8af5ea24&originHeight=152&originWidth=1360&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24422&status=done&style=shadow&taskId=ue53f594d-b265-4670-bf76-cec2a007135&title=&width=1360" alt="58FB9430-3F99-4332-80C3-E3444C00CAE5.png"><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=rFQu0&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p><h1 id="十二、动态SQL"><a href="#十二、动态SQL" class="headerlink" title="十二、动态SQL"></a>十二、动态SQL</h1><p>有的业务场景，也需要SQL语句进行动态拼接，例如：</p><ul><li>批量删除</li></ul><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660799087155-ec264d4c-cafa-458d-85b9-f18b4c34bafd.png#clientId=u85e451ff-5650-4&from=paste&height=134&id=M0sWt&originHeight=134&originWidth=228&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2335&status=done&style=shadow&taskId=u87c4a40d-2b79-4042-afd3-23d8d331e8c&title=&width=228" alt="BF64FC68-5697-4695-AD2A-8D32297AED66.png"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t_car <span class="keyword">where</span> id <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,......这里的值是动态的，根据用户选择的id不同，值是不同的);</span><br></pre></td></tr></table></figure><ul><li>多条件查询</li></ul><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660876082121-d5ea8e08-e642-4716-b201-79cfe3849624.png#clientId=uce76794a-2043-4&from=paste&height=522&id=u0bdabd59&originHeight=522&originWidth=899&originalType=binary&ratio=1&rotation=0&showTitle=false&size=128213&status=done&style=shadow&taskId=ud1c3d3d8-479f-4792-9da4-bb3457c55fb&title=&width=899" alt="890B6A37-46CD-41ad-953B-B0642DA2C62F.png"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_car <span class="keyword">where</span> brand <span class="keyword">like</span> <span class="string">&#x27;丰田%&#x27;</span> <span class="keyword">and</span> guide_price <span class="operator">&gt;</span> <span class="number">30</span> <span class="keyword">and</span> .....;</span><br></pre></td></tr></table></figure><p>创建模块：mybatis-008-dynamic-sql<br>打包方式：jar<br>引入依赖：mysql驱动依赖、mybatis依赖、junit依赖、logback依赖<br>pojo：com.powernode.mybatis.pojo.Car<br>mapper接口：com.powernode.mybatis.mapper.CarMapper<br>引入配置文件：mybatis-config.xml、jdbc.properties、logback.xml<br>mapper配置文件：com&#x2F;powernode&#x2F;mybatis&#x2F;mapper&#x2F;CarMapper.xml<br>编写测试类：com.powernode.mybatis.test.CarMapperTest<br>拷贝工具类：SqlSessionUtil</p><h2 id="12-1-if标签"><a href="#12-1-if标签" class="headerlink" title="12.1 if标签"></a>12.1 if标签</h2><p>需求：多条件查询。<br>可能的条件包括：品牌（brand）、指导价格（guide_price）、汽车类型（car_type）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据多条件查询Car</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> guidePrice</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> carType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Car&gt; <span class="title function_">selectByMultiCondition</span><span class="params">(<span class="meta">@Param(&quot;brand&quot;)</span> String brand, <span class="meta">@Param(&quot;guidePrice&quot;)</span> Double guidePrice, <span class="meta">@Param(&quot;carType&quot;)</span> String carType)</span>;</span><br><span class="line">    <span class="comment">//如果这里没加param，mybatis里就要写param1或者arg0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByMultiCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">        select * from t_car where</span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">在配置文件里开启了驼峰自动映射</span></span><br><span class="line"><span class="comment">1.if标签中test属性是必须的。</span></span><br><span class="line"><span class="comment">2.if标签中test属性的值是false或者true。</span></span><br><span class="line"><span class="comment">3.如果test是true，则if标签中的sql语句就会拼接。反之，则不会拼接。</span></span><br><span class="line"><span class="comment">4.</span></span><br><span class="line"><span class="comment">test属性中可以使用的是:</span></span><br><span class="line"><span class="comment">当使用了@Param注解，那么test中要出现的是@Param注解指定的参数名。@Param(&quot;brand&quot;)，那么这里只能使用brand</span></span><br><span class="line"><span class="comment">当没有使用@Param注解，那么test中要出现的是:param1 param2 param3 arg0 arg1 arg2....</span></span><br><span class="line"><span class="comment">当使用了P0J0，那么test中出现的是P0J0类的属性名</span></span><br><span class="line"><span class="comment">5.在mybatis的动态SQL当中，不能使用&amp;&amp;，只能使用and:</span></span><br><span class="line"><span class="comment">6.拼接的查询语句前面是数据库的字段名，后面是传过来的值</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand != &#x27;&#x27;&quot;</span>&gt;</span>不为空也不为空字符串</span><br><span class="line">            brand like #&#123;brand&#125;&quot;%&quot;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and guide_price &gt;= #&#123;guidePrice&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and car_type = #&#123;carType&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByMultiCondition</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">        List&lt;Car&gt; cars = mapper.selectByMultiCondition(<span class="string">&quot;丰田&quot;</span>, <span class="number">20.0</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br><span class="line">        System.out.println(cars);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660889544842-34404e94-66f2-48e5-b58a-784d6b91ee27.png#clientId=uce76794a-2043-4&from=paste&height=194&id=u8786f053&originHeight=194&originWidth=1045&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28066&status=done&style=shadow&taskId=u5bd2810b-663d-4d93-9f95-ecf59918ca7&title=&width=1045" alt="BF43A0EF-0324-4fb2-BE63-49E1352A5DB4.png"><br>如果第一个条件为空，剩下两个条件不为空，会是怎样呢？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Car&gt; cars = mapper.selectByMultiCondition(<span class="string">&quot;&quot;</span>, <span class="number">20.0</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660889738193-d5023b6c-13a9-447f-a128-45b36663c8f1.png#clientId=uce76794a-2043-4&from=paste&height=247&id=u6734899c&originHeight=247&originWidth=939&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22154&status=done&style=shadow&taskId=ucda7784d-bb8c-4418-a842-2e03c9e142f&title=&width=939" alt="3E87EFE6-A4B7-44ba-AC52-F62AC8066B08.png"><br>报错了，SQL语法有问题，where后面出现了and。这该怎么解决呢？</p><ul><li>可以where后面添加一个恒成立的条件。</li></ul><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660889965103-5e519823-a741-4ebf-b930-e10ffc9a4129.png#clientId=uce76794a-2043-4&from=paste&height=385&id=u324b967e&originHeight=385&originWidth=715&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32847&status=done&style=shadow&taskId=uda995560-f5ff-45d4-9f64-23725051ac5&title=&width=715" alt="0FC63B04-CDC3-4c0a-BA1B-BEC7C2D91F3E.png"><br>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660890083737-c8716d78-9e2d-4a22-bf56-12ff94b688f5.png#clientId=uce76794a-2043-4&from=paste&height=169&id=u65bc1f9c&originHeight=169&originWidth=978&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24288&status=done&style=shadow&taskId=u24c788f3-2898-4734-b454-4c9c1e69203&title=&width=978" alt="5A8B9A51-99B6-4730-884A-0B69DC19FCC4.png"><br>如果三个条件都是空，有影响吗？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Car&gt; cars = mapper.selectByMultiCondition(<span class="string">&quot;&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660890238928-6f889bdf-9702-4cd7-a0ef-b875977f42f9.png#clientId=uce76794a-2043-4&from=paste&height=160&id=u2f20b163&originHeight=160&originWidth=637&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15829&status=done&style=shadow&taskId=ub40b6c73-aa72-45f1-b645-522f7bf6055&title=&width=637" alt="CB992BC7-3C95-4c47-96BE-778863905BDD.png"><br>三个条件都不为空呢？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Car&gt; cars = mapper.selectByMultiCondition(<span class="string">&quot;丰田&quot;</span>, <span class="number">20.0</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660890374052-89bc29a1-3aeb-4941-b33f-fbbbe4fbbd39.png#clientId=uce76794a-2043-4&from=paste&height=138&id=u43c138d5&originHeight=138&originWidth=1029&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25848&status=done&style=shadow&taskId=u24959a15-1a6d-4ca8-a369-dd15fa68cbc&title=&width=1029" alt="3CAAB27C-3D6E-4709-9BA6-EBB3949AA75A.png"></p><h2 id="12-2-where标签"><a href="#12-2-where标签" class="headerlink" title="12.2 where标签"></a>12.2 where标签</h2><p>where标签的作用：让where子句更加动态智能。</p><ul><li>所有条件都为空时，where标签保证不会生成where子句。</li><li>自动去除某些条件<strong>前面</strong>多余的and或or。</li></ul><p>继续使用if标签中的需求。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据多条件查询Car，使用where标签</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> guidePrice</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> carType</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectByMultiConditionWithWhere</span><span class="params">(<span class="meta">@Param(&quot;brand&quot;)</span> String brand, <span class="meta">@Param(&quot;guidePrice&quot;)</span> Double guidePrice, <span class="meta">@Param(&quot;carType&quot;)</span> String carType)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByMultiConditionWithWhere&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      and brand like #&#123;brand&#125;&quot;%&quot;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      and guide_price &gt;= #&#123;guidePrice&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      and car_type = #&#123;carType&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByMultiConditionWithWhere</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectByMultiConditionWithWhere(<span class="string">&quot;丰田&quot;</span>, <span class="number">20.0</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660891031758-ce20585a-6bad-452e-b186-09cf465fecc6.png#clientId=uce76794a-2043-4&from=paste&height=142&id=u3a631133&originHeight=142&originWidth=993&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22412&status=done&style=shadow&taskId=u9125caa1-5fa5-4616-84db-5f07799eb3e&title=&width=993" alt="23A6B829-113A-40e8-9E5A-731C2EFE190E.png"><br>如果所有条件都是空呢？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Car&gt; cars = mapper.selectByMultiConditionWithWhere(<span class="string">&quot;&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure><p>运行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660891127310-9847b1b5-2bf4-42f9-8e73-38b051b398de.png#clientId=uce76794a-2043-4&from=paste&height=112&id=uf1c80e5e&originHeight=112&originWidth=492&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9538&status=done&style=shadow&taskId=uf4508dc7-ccbe-41de-bb5c-1cb4c1abec8&title=&width=492" alt="BCF50EEA-97BF-46a1-95E8-2D91129E4E8B.png"><br>它可以自动去掉前面多余的and，那可以自动去掉前面多余的or吗？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Car&gt; cars = mapper.selectByMultiConditionWithWhere(<span class="string">&quot;丰田&quot;</span>, <span class="number">20.0</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByMultiConditionWithWhere&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      or brand like #&#123;brand&#125;&quot;%&quot;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      and guide_price &gt;= #&#123;guidePrice&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      and car_type = #&#123;carType&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660891540196-f2e055dd-74a7-40f9-a883-c78a5e2d28b7.png#clientId=uce76794a-2043-4&from=paste&height=126&id=ufa8c9cb8&originHeight=126&originWidth=864&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19804&status=done&style=shadow&taskId=ubea2e1e5-d1ce-4efd-9883-e5ead0dedf2&title=&width=864" alt="13CDD5F7-C25D-463f-8B56-7FF28C39ECAE.png"><br>它可以自动去掉前面多余的and，那可以自动去掉后面多余的and吗？</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByMultiConditionWithWhere&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      brand like #&#123;brand&#125;&quot;%&quot; and</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      guide_price &gt;= #&#123;guidePrice&#125; and</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      car_type = #&#123;carType&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 让最后一个条件为空</span><br><span class="line">List<span class="tag">&lt;<span class="name">Car</span>&gt;</span> cars = mapper.selectByMultiConditionWithWhere(&quot;丰田&quot;, 20.0, &quot;&quot;);</span><br></pre></td></tr></table></figure><p>运行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660891786608-272a3ab9-96f8-42bc-b5df-4d275cfe9cfe.png#clientId=uce76794a-2043-4&from=paste&height=222&id=u22f88380&originHeight=222&originWidth=946&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22878&status=done&style=shadow&taskId=u861a1cb3-51c4-4397-b857-7ace5c56582&title=&width=946" alt="B3C02137-829D-49ad-B8C7-6816D0D7EC48.png"><br>很显然，后面多余的and是不会被去除的。</p><h2 id="12-3-trim标签"><a href="#12-3-trim标签" class="headerlink" title="12.3 trim标签"></a>12.3 trim标签</h2><p>trim标签的属性：</p><ul><li>prefix：在trim标签中的语句前<strong>添加</strong>内容</li><li>suffix：在trim标签中的语句后<strong>添加</strong>内容</li><li>prefixOverrides：前缀<strong>覆盖掉（去掉）</strong></li><li>suffixOverrides：后缀<strong>覆盖掉（去掉）</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据多条件查询Car，使用trim标签</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> guidePrice</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> carType</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectByMultiConditionWithTrim</span><span class="params">(<span class="meta">@Param(&quot;brand&quot;)</span> String brand, <span class="meta">@Param(&quot;guidePrice&quot;)</span> Double guidePrice, <span class="meta">@Param(&quot;carType&quot;)</span> String carType)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByMultiConditionWithTrim&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line">    <span class="comment">&lt;!--prefix=&quot;where&quot;是在trim标签所有内容的前面添加 where--</span></span><br><span class="line"><span class="comment">&lt;!--suffix0verrides=&quot;andlor”把trim标签中内容的后缀and或or去掉--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;where&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;and|or&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      brand like #&#123;brand&#125;&quot;%&quot; and</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      guide_price &gt;= #&#123;guidePrice&#125; and</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      car_type = #&#123;carType&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByMultiConditionWithTrim</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectByMultiConditionWithTrim(<span class="string">&quot;丰田&quot;</span>, <span class="number">20.0</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660894051788-34d9dd44-612e-424e-bf0a-143bea4b36bd.png#clientId=uc60038c0-79d0-4&from=paste&height=129&id=u35710fde&originHeight=129&originWidth=935&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17207&status=done&style=shadow&taskId=ucfdf6cff-c0e9-43fe-8356-3fd45082ccf&title=&width=935" alt="478A3426-65FF-4f80-823D-DF5B7CF542F8.png"><br>如果所有条件为空，where会被加上吗？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Car&gt; cars = mapper.selectByMultiConditionWithTrim(<span class="string">&quot;&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure><p>执行结果：不会加<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660894220001-e789ea6b-a219-4f3d-8670-b9612d1d8274.png#clientId=uc60038c0-79d0-4&from=paste&height=118&id=u521fe703&originHeight=118&originWidth=448&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8902&status=done&style=shadow&taskId=u78861c94-d9ef-485f-97b7-37925b7c0ea&title=&width=448" alt="E6EAF998-8725-4c69-B2BC-8BF65B04A85A.png"></p><h2 id="12-4-set标签"><a href="#12-4-set标签" class="headerlink" title="12.4 set标签"></a>12.4 set标签</h2><p>主要使用在update语句当中，用来生成set关键字，同时去掉最后多余的“,”<br>比如我们只更新提交的不为空的字段，如果提交的数据是空或者””，那么这个字段我们将不更新。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 更新信息，使用set标签</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> car</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateWithSet</span><span class="params">(Car car)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateWithSet&quot;</span>&gt;</span></span><br><span class="line">  update t_car</span><br><span class="line">  <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carNum != null and carNum != &#x27;&#x27;&quot;</span>&gt;</span>car_num = #&#123;carNum&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand != &#x27;&#x27;&quot;</span>&gt;</span>brand = #&#123;brand&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27;&#x27;&quot;</span>&gt;</span>guide_price = #&#123;guidePrice&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;produceTime != null and produceTime != &#x27;&#x27;&quot;</span>&gt;</span>produce_time = #&#123;produceTime&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27;&#x27;&quot;</span>&gt;</span>car_type = #&#123;carType&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdateWithSet</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="number">38L</span>,<span class="string">&quot;1001&quot;</span>,<span class="string">&quot;丰田霸道2&quot;</span>,<span class="number">10.0</span>,<span class="string">&quot;&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> mapper.updateWithSet(car);</span><br><span class="line">    System.out.println(count);</span><br><span class="line">    SqlSessionUtil.openSession().commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660895330743-edd9f2e6-8cd0-4cbe-9c73-adf009466e38.png#clientId=uc60038c0-79d0-4&from=paste&height=164&id=uc47ae5d4&originHeight=164&originWidth=912&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20386&status=done&style=shadow&taskId=uf4d734e1-bc87-49d4-affe-302de90ce92&title=&width=912" alt="846C97DE-8048-41b8-8C6F-FCA743B53812.png"></p><h2 id="12-5-choose-when-otherwise"><a href="#12-5-choose-when-otherwise" class="headerlink" title="12.5 choose when otherwise"></a>12.5 choose when otherwise</h2><p>这三个标签是在一起使用的：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">when</span>&gt;</span><span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">when</span>&gt;</span><span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">when</span>&gt;</span><span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span><span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br></pre></td></tr></table></figure><p>等同于：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>()&#123;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>()&#123;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>()&#123;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>()&#123;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>只有一个分支会被选择！！！！<br>需求：先根据品牌查询，如果没有提供品牌，再根据指导价格查询，如果没有提供指导价格，就根据生产日期查询。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 使用choose when otherwise标签查询</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> guidePrice</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> produceTime</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectWithChoose</span><span class="params">(<span class="meta">@Param(&quot;brand&quot;)</span> String brand, <span class="meta">@Param(&quot;guidePrice&quot;)</span> Double guidePrice, <span class="meta">@Param(&quot;produceTime&quot;)</span> String produceTime)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectWithChoose&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        brand like #&#123;brand&#125;&quot;%&quot;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        guide_price &gt;= #&#123;guidePrice&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        produce_time &gt;= #&#123;produceTime&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectWithChoose</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="comment">//List&lt;Car&gt; cars = mapper.selectWithChoose(&quot;丰田霸道&quot;, 20.0, &quot;2000-10-10&quot;);</span></span><br><span class="line">    <span class="comment">//List&lt;Car&gt; cars = mapper.selectWithChoose(&quot;&quot;, 20.0, &quot;2000-10-10&quot;);</span></span><br><span class="line">    <span class="comment">//List&lt;Car&gt; cars = mapper.selectWithChoose(&quot;&quot;, null, &quot;2000-10-10&quot;);</span></span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectWithChoose(<span class="string">&quot;&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    System.out.println(cars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660896273467-9ba1d6c0-9cc3-4deb-92e5-0f54b4ade614.png#clientId=uc60038c0-79d0-4&from=paste&height=155&id=ube619424&originHeight=155&originWidth=701&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18529&status=done&style=shadow&taskId=uc0bb4792-ed5c-411f-aa8f-55d85f82af5&title=&width=701" alt="E7884930-EDE9-4743-A1A9-DBDBD76C9E1E.png"></p><p>如果所有的条件都不满足，比如都为空，就至少会执行otherwise这个语句，只不过传进sql里的是null</p><h2 id="12-6-foreach标签"><a href="#12-6-foreach标签" class="headerlink" title="12.6 foreach标签"></a>12.6 foreach标签</h2><p>循环数组或集合，动态生成sql，比如这样的SQL：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t_car <span class="keyword">where</span> id <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t_car <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">or</span> id <span class="operator">=</span> <span class="number">2</span> <span class="keyword">or</span> id <span class="operator">=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> t_car <span class="keyword">values</span></span><br><span class="line">  (<span class="keyword">null</span>,<span class="string">&#x27;1001&#x27;</span>,<span class="string">&#x27;凯美瑞&#x27;</span>,<span class="number">35.0</span>,<span class="string">&#x27;2010-10-11&#x27;</span>,<span class="string">&#x27;燃油车&#x27;</span>),</span><br><span class="line">  (<span class="keyword">null</span>,<span class="string">&#x27;1002&#x27;</span>,<span class="string">&#x27;比亚迪唐&#x27;</span>,<span class="number">31.0</span>,<span class="string">&#x27;2020-11-11&#x27;</span>,<span class="string">&#x27;新能源&#x27;</span>),</span><br><span class="line">  (<span class="keyword">null</span>,<span class="string">&#x27;1003&#x27;</span>,<span class="string">&#x27;比亚迪宋&#x27;</span>,<span class="number">32.0</span>,<span class="string">&#x27;2020-10-11&#x27;</span>,<span class="string">&#x27;新能源&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="批量删除-1"><a href="#批量删除-1" class="headerlink" title="批量删除"></a>批量删除</h3><ul><li>用in来删除</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 通过foreach完成批量删除</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteByIds</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span> String[] ids)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">foreach标签的属性：</span></span><br><span class="line"><span class="comment">collection：集合或数组</span></span><br><span class="line"><span class="comment">item：集合或数组中的元素</span></span><br><span class="line"><span class="comment">separator：分隔符</span></span><br><span class="line"><span class="comment">open：foreach标签中所有内容的开始</span></span><br><span class="line"><span class="comment">close：foreach标签中所有内容的结束</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">在不使用@Param注解的时候直接填数组名collection=&quot;ids&quot;报错了，错误信息是:[array，arg0]</span></span><br><span class="line"><span class="comment">什么意思?</span></span><br><span class="line"><span class="comment">map.put(&quot;array&quot;，数组);</span></span><br><span class="line"><span class="comment">map.put(&quot;arg&quot;，数组);</span></span><br><span class="line"><span class="comment">也就是array和arg作为了map的key，但是这样可读性差，所以用@Param起名</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByIds&quot;</span>&gt;</span></span><br><span class="line">  delete from t_car where id in</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;aaaa&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">    #&#123;aaaa&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">这样也可以</span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByIds&quot;</span>&gt;</span></span><br><span class="line">  delete from t_car where id in(</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;aaaa&quot;</span>&gt;</span></span><br><span class="line">    #&#123;aaaa&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    )</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteBatchByForeach</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> mapper.deleteBatchByForeach(<span class="keyword">new</span> <span class="title class_">Long</span>[]&#123;<span class="number">40L</span>, <span class="number">41L</span>, <span class="number">42L</span>&#125;);</span><br><span class="line">    System.out.println(<span class="string">&quot;删除了几条记录：&quot;</span> + count);</span><br><span class="line">    SqlSessionUtil.openSession().commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660899240200-ab225394-27f1-4ec1-94e0-b2b3d3a9b16e.png#clientId=uc60038c0-79d0-4&from=paste&height=146&id=u4a8e11cf&originHeight=146&originWidth=732&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15443&status=done&style=shadow&taskId=uc7b9e97c-8ff7-44aa-b56d-a281c1731c6&title=&width=732" alt="F8F6B314-E3B0-46bd-8156-F88072A01271.png"></p><ul><li>用or来删除</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 通过foreach完成批量删除</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteBatchByForeach2</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span> Long[] ids)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--这里分隔符用or是可以的，并且会自动加上空格--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteBatchByForeach2&quot;</span>&gt;</span></span><br><span class="line">  delete from t_car where</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;or&quot;</span>&gt;</span></span><br><span class="line">    id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteBatchByForeach2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> mapper.deleteBatchByForeach2(<span class="keyword">new</span> <span class="title class_">Long</span>[]&#123;<span class="number">40L</span>, <span class="number">41L</span>, <span class="number">42L</span>&#125;);</span><br><span class="line">    System.out.println(<span class="string">&quot;删除了几条记录：&quot;</span> + count);</span><br><span class="line">    SqlSessionUtil.openSession().commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660899667194-f150bf6b-b54f-432a-8455-4c819bac0c58.png#clientId=uc60038c0-79d0-4&from=paste&height=129&id=u2f11d6a0&originHeight=129&originWidth=656&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12169&status=done&style=shadow&taskId=ub7d84acd-e9f9-4c03-b428-615c5eda48e&title=&width=656" alt="01FA0A35-FD1D-43e8-A92D-104E98194D6C.png"></p><h3 id="批量添加"><a href="#批量添加" class="headerlink" title="批量添加"></a>批量添加</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 批量添加，使用foreach标签</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> cars</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insertBatch</span><span class="params">(<span class="meta">@Param(&quot;cars&quot;)</span> List&lt;Car&gt; cars)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--这里就不要用open和close了--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatchByForeach&quot;</span>&gt;</span></span><br><span class="line">  insert into t_car values </span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;cars&quot;</span> <span class="attr">item</span>=<span class="string">&quot;car&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">    (null,#&#123;car.carNum&#125;,#&#123;car.brand&#125;,#&#123;car.guidePrice&#125;,#&#123;car.produceTime&#125;,#&#123;car.carType&#125;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertBatchByForeach</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="literal">null</span>, <span class="string">&quot;2001&quot;</span>, <span class="string">&quot;兰博基尼&quot;</span>, <span class="number">100.0</span>, <span class="string">&quot;1998-10-11&quot;</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="literal">null</span>, <span class="string">&quot;2001&quot;</span>, <span class="string">&quot;兰博基尼&quot;</span>, <span class="number">100.0</span>, <span class="string">&quot;1998-10-11&quot;</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="literal">null</span>, <span class="string">&quot;2001&quot;</span>, <span class="string">&quot;兰博基尼&quot;</span>, <span class="number">100.0</span>, <span class="string">&quot;1998-10-11&quot;</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br><span class="line">    List&lt;Car&gt; cars = Arrays.asList(car1, car2, car3);</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> mapper.insertBatchByForeach(cars);</span><br><span class="line">    System.out.println(<span class="string">&quot;插入了几条记录&quot;</span> + count);</span><br><span class="line">    SqlSessionUtil.openSession().commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1660900226070-90533bde-4129-49b5-9fa7-639aa07c3b03.png#clientId=uc60038c0-79d0-4&from=paste&height=166&id=u5ac82100&originHeight=166&originWidth=926&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16492&status=done&style=shadow&taskId=udef78a82-7c78-4c59-87d1-62e98fb5a68&title=&width=926" alt="A1B37462-5261-4b46-97CA-9D703D1452AC.png"></p><h2 id="12-7-sql标签与include标签"><a href="#12-7-sql标签与include标签" class="headerlink" title="12.7 sql标签与include标签"></a>12.7 sql标签与include标签</h2><p>sql标签用来声明sql片段<br>include标签用来将声明的sql片段包含到某个sql语句当中<br>作用：代码复用。易维护。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--把重复使用的sql语句放在下面，然后起个名字，在需要的地方使用&lt;include&gt;标签就可以--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;carCols&quot;</span>&gt;</span>id,car_num carNum,brand,guide_price guidePrice,produce_time produceTime,car_type carType<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllRetMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;carCols&quot;</span>/&gt;</span> from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllRetListMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;carCols&quot;</span>/&gt;</span> carType from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIdRetMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;carCols&quot;</span>/&gt;</span> from t_car where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=pkWu9&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p><h1 id="十三、MyBatis的高级映射及延迟加载"><a href="#十三、MyBatis的高级映射及延迟加载" class="headerlink" title="十三、MyBatis的高级映射及延迟加载"></a>十三、MyBatis的高级映射及延迟加载</h1><p>模块名：mybatis-009-advanced-mapping<br>打包方式：jar<br>依赖：mybatis依赖、mysql驱动依赖、junit依赖、logback依赖<br>配置文件：mybatis-config.xml、logback.xml、jdbc.properties<br>拷贝工具类：SqlSessionUtil<br>准备数据库表：一个班级对应多个学生。班级表：t_clazz。学生表：t_student<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661132819754-23adfa1c-b325-41bc-8520-0355fe4c41cc.png#clientId=ubeb36f5f-42dd-4&from=paste&height=153&id=u354c9ec4&originHeight=153&originWidth=387&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5638&status=done&style=shadow&taskId=u9398081e-3340-4fb2-b656-caa9d5a3230&title=&width=387" alt="C97C4534-D714-4314-A6B9-1A9D6FB32776.png"><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661132610940-7d55793b-df68-48f4-924f-99db58220da9.png#clientId=ubeb36f5f-42dd-4&from=paste&height=204&id=ue5841f5d&originHeight=204&originWidth=365&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7378&status=done&style=shadow&taskId=u5bcb392c-be74-4c13-b5f2-d86c8598330&title=&width=365" alt="F3517247-9413-4e66-A4EE-13C26BD2F5B6.png"><br>创建pojo：Student、Clazz</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.mybatis.pojo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 学生类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer sid;</span><br><span class="line">    <span class="keyword">private</span> String sname;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.mybatis.pojo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 班级类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Clazz</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer cid;</span><br><span class="line">    <span class="keyword">private</span> String cname;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>创建mapper接口：StudentMapper、ClazzMapper<br>创建mapper映射文件：StudentMapper.xml、ClazzMapper.xml</p><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/image-20251208221439117.png" alt="image-20251208221439117"></p><h2 id="13-1-多对一"><a href="#13-1-多对一" class="headerlink" title="13.1 多对一"></a>13.1 多对一</h2><p>多种方式，常见的包括三种：</p><ul><li>第一种方式：一条SQL语句，级联属性映射。</li><li>第二种方式：一条SQL语句，association。</li><li>第三种方式：两条SQL语句，分步查询。（这种方式常用：优点一是可复用。优点二是支持懒加载（延迟加载）。）</li></ul><h3 id="第一种方式：级联属性映射"><a href="#第一种方式：级联属性映射" class="headerlink" title="第一种方式：级联属性映射"></a>第一种方式：级联属性映射</h3><p>多对一的话多是主表，也就是student</p><p>pojo类Student中添加一个属性：Clazz clazz; 表示学生关联的班级对象，然后生成set和get、toString方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.mybatis.pojo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据id获取学生信息。同时获取学生关联的班级信息。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 学生的id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 学生对象，但是学生对象当中含有班级对象。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer sid;</span><br><span class="line">    <span class="keyword">private</span> String sname;</span><br><span class="line">    <span class="keyword">private</span> Clazz clazz;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Clazz <span class="title function_">getClazz</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> clazz;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setClazz</span><span class="params">(Clazz clazz)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.clazz = clazz;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;sid=&quot;</span> + sid +</span><br><span class="line">                <span class="string">&quot;, sname=&#x27;&quot;</span> + sname + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, clazz=&quot;</span> + clazz +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(Integer sid, String sname)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sid = sid;</span><br><span class="line">        <span class="built_in">this</span>.sname = sname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getSid</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSid</span><span class="params">(Integer sid)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sid = sid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSname</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSname</span><span class="params">(String sname)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sname = sname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.StudentMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--这里也要考虑是用resultMap还是resultType--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--clazz是个类，用类里的cid被赋值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;clazz.cid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;clazz.cname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBySid&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;studentResultMap&quot;</span>&gt;</span></span><br><span class="line">select</span><br><span class="line">s.sid,s.sname,c.cid,c.cname</span><br><span class="line">from</span><br><span class="line">t_stu s left join t_clazz c on s.cid = c.cid</span><br><span class="line">where</span><br><span class="line">s.sid = #&#123;sid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectBySid</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(StudentMapper.class);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> mapper.selectBySid(<span class="number">1</span>);</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661134833921-9452c17c-3461-4c7f-8807-55aa3e089506.png#clientId=ubeb36f5f-42dd-4&from=paste&height=142&id=ub5b1bbf4&originHeight=142&originWidth=1144&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25983&status=done&style=shadow&taskId=u5dabd444-2088-4b43-a8be-1bc28bea7ad&title=&width=1144" alt="F25380AC-E951-46c6-99AB-38AD7A2C76F2.png"></p><h3 id="第二种方式：association"><a href="#第二种方式：association" class="headerlink" title="第二种方式：association"></a>第二种方式：association</h3><p>其他位置都不需要修改，只需要修改resultMap中的配置：association即可。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">association:翻译为关联。一个Student对象关联了一个Clazz对象</span></span><br><span class="line"><span class="comment">property:提供要映射的P0J0类的属性名。</span></span><br><span class="line"><span class="comment">javaType:用来指定要映射的java类型，用全限定名，但是也可以起别名，这里就是用了别名</span></span><br><span class="line"><span class="comment">后面就是类的和数据库的</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;clazz&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Clazz&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>association翻译为：关联。<br>学生对象关联一个班级对象。</p><h3 id="第三种方式：分步查询"><a href="#第三种方式：分步查询" class="headerlink" title="第三种方式：分步查询"></a>第三种方式：分步查询</h3><p>其他位置不需要修改，只需要修改以及添加以下三处：<br>第一处：association中select位置填写sqlId。sqlId&#x3D;namespace+id。其中column属性作为这条子sql语句的条件。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--两条SQL语句，完成多对一的分步查询。--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这里是第一步:根据学生的id查询学生的所有信息。这些信息当中含有班级id(cid)--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--property里的sid和sname对应着select语句里的sid，sname，去进行赋值，同样的cid查出后要赋给column的cid，将来赋给select指定的id,复制这个路径也可以通过右击接口的方法名然后复制粘贴就有了--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--select里需要指定另外第二部sql语句的ID--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;clazz&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">select</span>=<span class="string">&quot;com.powernode.mybatis.mapper.ClazzMapper.selectByCid&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByStep1&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;studentResultMapByStep&quot;</span>&gt;</span></span><br><span class="line">  select sid,sname,cid from t_stu where sid = #&#123;sid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第二处：studentmapper对应的student的查询语句，clazz差的是另外一张表，所以需要其他的接口，换成clazzmapper，在ClazzMapper接口中添加方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分步查询第二步:根据cid获取班级信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老杜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ClazzMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据cid获取Clazz信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Clazz <span class="title function_">selectByCid</span><span class="params">(Integer cid)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>第三处：在ClazzMapper.xml文件中进行配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.ClazzMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--分步查询第二步:根据cid获取班级信息。类和数据库名字对应所以可以不用resultMap--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIdstep2&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Clazz&quot;</span>&gt;</span></span><br><span class="line">select cid,cname fromtclazz where cid = #&#123;cid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>执行结果，可以很明显看到先后有两条sql语句执行：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661151746372-e3c91810-bb5f-4308-8dd5-e421e11bff50.png#clientId=ubeb36f5f-42dd-4&from=paste&height=183&id=u754eeb0e&originHeight=183&originWidth=760&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22113&status=done&style=shadow&taskId=u6879c49a-2037-4a5f-bb8f-41fa068f854&title=&width=760" alt="64257FF9-0D4C-45ea-AF88-68DC6E19141D.png"><br>分步优点：</p><ul><li>第一个优点：代码复用性增强。</li><li>第二个优点：支持延迟加载\懒加载。【暂时访问不到的数据可以先不查询。提高程序的执行效率。】</li></ul><h2 id="13-2-多对一延迟加载"><a href="#13-2-多对一延迟加载" class="headerlink" title="13.2 多对一延迟加载"></a>13.2 多对一延迟加载</h2><ul><li>什么是延迟加载(懒加载)，有什么用?<ul><li>延迟加载的核心原理是:用的时候再执行查询语句。不用的时候不查询</li><li>作用:提高性能。尽可能的不查，或者说尽可能的少查。来提高效率。</li></ul></li><li>在mybatis当中怎么开启延迟加载呢?<ul><li>association标签中添加fetchType&#x3D;”lazy”</li><li>注意:默认情况下是没有开启延迟加载的。需要设置:fetchType&#x3D;”lazy”</li><li>这种在association标签中配置fetchType&#x3D;”lazy”，是局部的设置，只对当前的association关联的sqL语句起作用。</li></ul></li></ul><p>修改StudentMapper.xml文件：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;clazz&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">select</span>=<span class="string">&quot;com.powernode.mybatis.mapper.ClazzMapper.selectByCid&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span></span></span><br><span class="line"><span class="tag">               </span></span><br><span class="line"><span class="tag">               <span class="attr">fetchType</span>=<span class="string">&quot;lazy&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>我们现在只查询学生名字，修改测试程序：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectBySid</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(StudentMapper.class);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> mapper.selectBySid(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//System.out.println(student);</span></span><br><span class="line">        <span class="comment">// 只获取学生姓名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sname</span> <span class="operator">=</span> student.getSname();</span><br><span class="line">        System.out.println(<span class="string">&quot;学生姓名：&quot;</span> + sname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661151882965-633f8039-c309-4657-8ed1-44f836d5b1e4.png#clientId=ubeb36f5f-42dd-4&from=paste&height=134&id=u116285c4&originHeight=134&originWidth=797&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12499&status=done&style=shadow&taskId=ubc28843b-1715-4227-a9ea-d86c1a5dfb2&title=&width=797" alt="243153C1-F8EC-4792-9CE6-600A819EF080.png"><br>如果后续需要使用到学生所在班级的名称，这个时候才会执行关联的sql语句，修改测试程序：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectBySid</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(StudentMapper.class);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> mapper.selectBySid(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//System.out.println(student);</span></span><br><span class="line">        <span class="comment">// 只获取学生姓名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sname</span> <span class="operator">=</span> student.getSname();</span><br><span class="line">        System.out.println(<span class="string">&quot;学生姓名：&quot;</span> + sname);</span><br><span class="line">        <span class="comment">// 到这里之后，想获取班级名字了</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cname</span> <span class="operator">=</span> student.getClazz().getCname();</span><br><span class="line">        System.out.println(<span class="string">&quot;学生的班级名称：&quot;</span> + cname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661151926961-a0affa2d-2d89-4b67-8cc0-bf8604ded4fc.png#clientId=ubeb36f5f-42dd-4&from=paste&height=241&id=ub355c610&originHeight=241&originWidth=778&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23158&status=done&style=shadow&taskId=u94275f08-384f-4027-90c2-1bb19f838f0&title=&width=778" alt="D804FEF1-B414-4d5d-AF22-CF2042FACA69.png"><br>通过以上的执行结果可以看到，只有当使用到班级名称之后，才会执行关联的sql语句，这就是延迟加载。<br>在mybatis中如何开启全局的延迟加载呢？需要setting配置，如下：mybatis-config<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661136161612-a7c3cc7f-fe89-4245-a297-1572d8384566.png#clientId=ubeb36f5f-42dd-4&from=paste&height=314&id=ued68a328&originHeight=314&originWidth=1505&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29174&status=done&style=shadow&taskId=u8519649e-773a-49bd-8c51-2ccdd385a85&title=&width=1505" alt="0253ED55-CB5E-4256-BEE2-2C9E97317809.png"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><p>**然后把fetchType&#x3D;”lazy”去掉。**这样凡是分步的都是延迟加载<br>执行以下程序：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectBySid</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(StudentMapper.class);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> mapper.selectBySid(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//System.out.println(student);</span></span><br><span class="line">        <span class="comment">// 只获取学生姓名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sname</span> <span class="operator">=</span> student.getSname();</span><br><span class="line">        System.out.println(<span class="string">&quot;学生姓名：&quot;</span> + sname);</span><br><span class="line">        <span class="comment">// 到这里之后，想获取班级名字了</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cname</span> <span class="operator">=</span> student.getClazz().getCname();</span><br><span class="line">        System.out.println(<span class="string">&quot;学生的班级名称：&quot;</span> + cname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661151954051-4b5b94f7-a69d-4d21-b220-1a840862fb85.png#clientId=ubeb36f5f-42dd-4&from=paste&height=241&id=uae4f54af&originHeight=241&originWidth=778&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23158&status=done&style=shadow&taskId=uad4731e1-dec8-4420-b536-732a8bcd09e&title=&width=778" alt="D804FEF1-B414-4d5d-AF22-CF2042FACA69.png"><br>通过以上的测试可以看出，我们已经开启了全局延迟加载策略。<br>开启全局延迟加载之后，所有的sql都会支持延迟加载，如果某个sql你不希望它支持延迟加载怎么办呢？将fetchType设置为eager：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;clazz&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">select</span>=<span class="string">&quot;com.powernode.mybatis.mapper.ClazzMapper.selectByCid&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">fetchType</span>=<span class="string">&quot;eager&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661151998854-a31c19fb-0af9-4d69-894d-e8086d9c0333.png#clientId=ubeb36f5f-42dd-4&from=paste&height=242&id=u793a89fc&originHeight=242&originWidth=767&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25091&status=done&style=shadow&taskId=uc4382415-3db6-40e2-af5b-35f4f31ab10&title=&width=767" alt="16CFD580-56BB-4a69-A1DA-095C8186D398.png"><br>这样的话，针对某个特定的sql，你就关闭了延迟加载机制。<br>后期我们要不要开启延迟加载机制，主要看实际的业务需求是怎样的，一般是开启。</p><h2 id="13-3-一对多"><a href="#13-3-一对多" class="headerlink" title="13.3 一对多"></a>13.3 一对多</h2><p>一对多的实现，通常是在一的一方中有List集合属性。比如通过一个班级查到所有的学生<br>在Clazz类中添加List<Student> stus; 属性。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Clazz</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer cid;</span><br><span class="line">    <span class="keyword">private</span> String cname;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; stus;</span><br><span class="line">    <span class="comment">// set get方法</span></span><br><span class="line">    <span class="comment">// 构造方法</span></span><br><span class="line">    <span class="comment">// toString方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一对多的实现通常包括两种实现方式：</p><ul><li>第一种方式：collection</li><li>第二种方式：分步查询</li></ul><h3 id="第一种方式：collection"><a href="#第一种方式：collection" class="headerlink" title="第一种方式：collection"></a>第一种方式：collection</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ClazzMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据cid获取Clazz信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Clazz <span class="title function_">selectByCid</span><span class="params">(Integer cid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据班级编号查询班级信息。同时班级中所有的学生信息也要查询。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Clazz <span class="title function_">selectClazzAndStusByCid</span><span class="params">(Integer cid)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;clazzResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Clazz&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对多，这里是collection。collection是集合的意思。stus是clazz里集合的名字--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--ofType 属性用来指定集合当中的元素类型。--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;stus&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectClazzAndStusByCid&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;clazzResultMap&quot;</span>&gt;</span></span><br><span class="line">  select * from t_clazz c join t_student s on c.cid = s.cid where c.cid = #&#123;cid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意是ofType，表示“集合中的类型”。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClazzMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectClazzAndStusByCid</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ClazzMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> SqlSessionUtil.openSession().getMapper(ClazzMapper.class);</span><br><span class="line">        <span class="type">Clazz</span> <span class="variable">clazz</span> <span class="operator">=</span> mapper.selectClazzAndStusByCid(<span class="number">1001</span>);</span><br><span class="line">        System.out.println(clazz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661149977323-90515301-4b5b-4e3e-a17f-04d5473766e7.png#clientId=ubeb36f5f-42dd-4&from=paste&height=146&id=uf885a23f&originHeight=146&originWidth=1629&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19600&status=done&style=shadow&taskId=u4ab6987c-460a-4e44-ac4e-f90cc1f5aa5&title=&width=1629" alt="11487318-3686-4868-B14C-D9247AC31764.png"></p><h3 id="第二种方式：分步查询"><a href="#第二种方式：分步查询" class="headerlink" title="第二种方式：分步查询"></a>第二种方式：分步查询</h3><p>修改以下三个位置即可：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;clazzResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Clazz&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--主要看这里，集合的stus通过后面的select查询到的结果赋值，下面select标签查到的cid传到这里通过column传进select的sql语句里--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;stus&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">select</span>=<span class="string">&quot;com.powernode.mybatis.mapper.StudentMapper.selectByCid&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--sql语句也变化了--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectClazzAndStusByCid&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;clazzResultMap&quot;</span>&gt;</span></span><br><span class="line">  select * from t_clazz c where c.cid = #&#123;cid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据班级编号获取所有的学生。</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> cid</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Student&gt; <span class="title function_">selectByCidStep2</span><span class="params">(Integer cid)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//分部查询第一步:先根据学生的sid查询学生的信息</span></span><br><span class="line">Student <span class="title function_">selectByIdStep1</span><span class="params">(Integer sid)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCid&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">  select * from t_student where cid = #&#123;cid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661151398803-0c0e196e-6c0a-42fb-b9ee-abd42fea2026.png#clientId=ubeb36f5f-42dd-4&from=paste&height=232&id=u219ee5d5&originHeight=232&originWidth=1639&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30822&status=done&style=shadow&taskId=u4f436b8f-f31d-449b-a297-7663393629d&title=&width=1639" alt="B663AF51-68CE-416f-AC5D-F709FCE0304D.png"></p><p>我们这里也是开启了延迟加载，访问整个clazz时是两个查询语句都去查询，其他的需要什么就用什么</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectBystep1</span><span class="params">()</span>&#123;</span><br><span class="line">SqlSession sqlSession=SqlSessionUtil.openSession();</span><br><span class="line"><span class="type">ClazzMapper</span> <span class="variable">mapper</span> <span class="operator">=</span>sqlSession.getMapper(clazzMapper.class);</span><br><span class="line"><span class="type">Clazz</span> <span class="variable">clazz</span> <span class="operator">=</span>mapper.selectByStep1( cid:<span class="number">1000</span>);</span><br><span class="line"><span class="comment">//System.out.printn(clazz);</span></span><br><span class="line"><span class="comment">//只访问级名字。System.out.println(clazz.getCname());</span></span><br><span class="line"><span class="comment">//只有用到的时候才会去执行第二步SQL</span></span><br><span class="line">    System.out.println(clazz.getStus());</span><br><span class="line">sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="13-4-一对多延迟加载"><a href="#13-4-一对多延迟加载" class="headerlink" title="13.4 一对多延迟加载"></a>13.4 一对多延迟加载</h2><p>一对多延迟加载机制和多对一是一样的。同样是通过两种方式：</p><ul><li>第一种：fetchType&#x3D;”lazy”</li><li>第二种：修改全局的配置setting，**lazyLoadingEnabled&#x3D;true，**如果开启全局延迟加载，想让某个sql不使用延迟加载：fetchType&#x3D;”eager”</li></ul><p><strong>多对多应该怎么弄？分解成两个一对多</strong></p><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=DDo59&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p><h1 id="十四、MyBatis的缓存"><a href="#十四、MyBatis的缓存" class="headerlink" title="十四、MyBatis的缓存"></a>十四、MyBatis的缓存</h1><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/image-20251209170749467.png" alt="image-20251209170749467"></p><p>缓存：cache<br>缓存的作用：通过减少IO的方式，来提高程序的执行效率。<br>mybatis的缓存：将select语句的查询结果放到缓存（内存）当中，下一次还是这条select语句的话，直接从缓存中取，不再查数据库。一方面是减少了IO。另一方面不再执行繁琐的查找算法。效率大大提升。<br>mybatis缓存包括：</p><ul><li>一级缓存：将查询到的数据存储到SqlSession（会话）中。</li><li>二级缓存：将查询到的数据存储到SqlSessionFactory（环境）中。</li><li>或者集成其它第三方的缓存：比如EhCache【Java语言开发的】、Memcache【C语言开发的】等。</li></ul><p><strong>缓存只针对于DQL语句，也就是说缓存机制只对应select语句。</strong></p><h2 id="14-1-一级缓存"><a href="#14-1-一级缓存" class="headerlink" title="14.1 一级缓存"></a>14.1 一级缓存</h2><p>一级缓存默认是开启的。不需要做任何配置。<br>原理：只要使用同一个SqlSession对象执行同一条SQL语句，就会走缓存。<br>模块名：mybatis-010-cache</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id获取Car信息。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Car <span class="title function_">selectById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">    select * from t_car where id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectById</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// 注意：不能使用我们封装的SqlSessionUtil工具类，因为使用的是threadlocal，我们需要不同的session对象</span></span><br><span class="line">        <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> builder.build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession1</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//先测同一个session，这里会走一级缓存</span></span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper1</span> <span class="operator">=</span> sqlSession1.getMapper(CarMapper.class);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car1</span> <span class="operator">=</span> mapper1.selectById(<span class="number">83L</span>);</span><br><span class="line">        System.out.println(car1);</span><br><span class="line"></span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper2</span> <span class="operator">=</span> sqlSession1.getMapper(CarMapper.class);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car2</span> <span class="operator">=</span> mapper2.selectById(<span class="number">83L</span>);</span><br><span class="line">        System.out.println(car2);<span class="comment">//结果是走缓存</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//再创建一个session，看看不同的会不会走缓存</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession2</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper3</span> <span class="operator">=</span> sqlSession1.getMapper(CarMapper.class);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car3</span> <span class="operator">=</span> mapper3.selectById(<span class="number">83L</span>);</span><br><span class="line">        System.out.println(car3);</span><br><span class="line"></span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper4</span> <span class="operator">=</span> sqlSession2.getMapper(CarMapper.class);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car4</span> <span class="operator">=</span> mapper4.selectById(<span class="number">83L</span>);</span><br><span class="line">        System.out.println(car4);</span><br><span class="line"><span class="comment">//结果是不走缓存，因为一级缓存是session，但不同的session对象就没有对应的缓存</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>什么情况下不走缓存？</p><ul><li>第一种：不同的SqlSession对象。</li><li>第二种：查询条件不一样，不走缓存。</li></ul><p>一级缓存失效情况包括两种：</p><ul><li>第一种：第一次查询和第二次查询之间，手动清空了一级缓存。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlSession.clearCache();</span><br></pre></td></tr></table></figure><ul><li>第二种：第一次查询和第二次查询之间，执行了增删改操作。【这个增删改和哪张表没有关系，只要有insert delete update操作，一级缓存就失效。】</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 保存账户信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insertAccount</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertAccount&quot;</span>&gt;</span></span><br><span class="line">  insert into t_act values(3, &#x27;act003&#x27;, 10000)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661155578490-1b1d260d-991a-44ef-8c94-ba68796c7f03.png#clientId=ubeb36f5f-42dd-4&from=paste&height=852&id=ua9306740&originHeight=852&originWidth=1133&originalType=binary&ratio=1&rotation=0&showTitle=false&size=88687&status=done&style=none&taskId=u8e6dacbe-ad3b-49f6-9174-ac1be7a67b7&title=&width=1133" alt="87026BA7-38F7-41c1-86B4-8462801F93BF.png"><br>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661155640234-bdba6b74-80cf-4604-8185-fd504994150d.png#clientId=ubeb36f5f-42dd-4&from=paste&height=356&id=u7ceb82d2&originHeight=356&originWidth=1047&originalType=binary&ratio=1&rotation=0&showTitle=false&size=54381&status=done&style=none&taskId=ubf72548b-7e6e-4e18-8c2a-b7dd2c30589&title=&width=1047" alt="CBCDA9A8-3949-4bd0-8D10-56888A4286C3.png"></p><h2 id="14-2-二级缓存"><a href="#14-2-二级缓存" class="headerlink" title="14.2 二级缓存"></a>14.2 二级缓存</h2><p>二级缓存的范围是SqlSessionFactory。<br>使用二级缓存需要具备以下几个条件：</p><ol><li>&lt;setting name&#x3D;”cacheEnabled” value&#x3D;”true”&gt; 全局性地开启或关闭所有映射器配置文件中已配置的任何缓存。默认就是true，无需设置。</li><li>在需要使用二级缓存的SqlMapper.xml文件中添加配置：<cache /></li><li>使用二级缓存的实体类对象必须是可序列化的，也就是必须实现java.io.Serializable接口</li><li>SqlSession对象关闭或提交之后，一级缓存中的数据才会被写入到二级缓存当中。此时二级缓存才可用。</li></ol><p>测试二级缓存：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span>/&gt;</span>加上后会在输出的信息里多一个缓存命中率的东西</span><br><span class="line">cache hit ratio xxx 0.0</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"><span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectById2</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession1</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession2</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper1</span> <span class="operator">=</span> sqlSession1.getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper2</span> <span class="operator">=</span> sqlSession2.getMapper(CarMapper.class);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 这行代码执行结束之后，实际上数据是缓存到一级缓存当中了。(sqlSession1是一级缓存。)</span></span><br><span class="line">    <span class="type">Car</span> <span class="variable">car1</span> <span class="operator">=</span> mapper1.selectById(<span class="number">83L</span>);</span><br><span class="line">    System.out.println(car1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//关键一步：如果这里不关闭Sqlsession1对象的话，二级缓存中还是没有数据的:关闭后sqlSession1的一级缓存中的数据会放到二级缓存当中。</span></span><br><span class="line">    sqlSession1.close();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这行代码执行结束之后，实际上数据会缓存到一级缓存当中。(sqlSession2是一级缓存。)</span></span><br><span class="line">    <span class="type">Car</span> <span class="variable">car2</span> <span class="operator">=</span> mapper2.selectById(<span class="number">83L</span>);</span><br><span class="line">    System.out.println(car2);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 程序执行到这里的时候，会将sqlSession1这个一级缓存中的数据写入到二级缓存当中。</span></span><br><span class="line"><span class="comment">//sqlSession1.close();</span></span><br><span class="line"><span class="comment">// 程序执行到这里的时候，会将sqlSession2这个一级缓存中的数据写入到二级缓存当中。</span></span><br><span class="line">sqlSession2.close();</span><br><span class="line">    </span><br><span class="line">    如果都在最后关闭，不是同一个session对象都不走一级缓存，就要查两次</span><br><span class="line">    如果在中间关闭，session1的会变成二级缓存，为什么session2能读取到缓存，因为虽然两个不是同一个会话，但都是同一个sqlSessionFactory创建的，所以走二级缓存</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661157492039-a04066a4-a824-4125-8533-e323bfd8bfdb.png#clientId=ubeb36f5f-42dd-4&from=paste&height=456&id=uf5c71836&originHeight=456&originWidth=1197&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85747&status=done&style=none&taskId=u001bd45e-7269-4f20-8895-37f7c9f2068&title=&width=1197" alt="4B715968-A13F-4fee-B41B-604504A1D847.png"><br><strong>二级缓存的失效：只要两次查询之间出现了增删改操作。二级缓存就会失效。【一级缓存也会失效】</strong><br><strong>二级缓存的相关配置：</strong><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661158385819-8074adeb-f769-48f5-8519-a79a515e8631.png#clientId=ubeb36f5f-42dd-4&from=paste&height=294&id=u7f47bc31&originHeight=294&originWidth=667&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24147&status=done&style=none&taskId=u7ec00183-f3f3-465e-abf6-c9edfafcc54&title=&width=667" alt="F7BACAAD-5DD9-43e8-A2A5-5AC787BAFFB4.png"></p><ol><li>eviction：指定从缓存中移除某个对象的淘汰算法。默认采用LRU策略。<ol><li>LRU：Least Recently Used。最近最少使用。优先淘汰在间隔时间内使用频率最低的对象，不是不常使用只是最近很少使用。(其实还有一种淘汰算法LFU，淘汰最不常用的对象。)</li><li>FIFO：First In First Out。一种先进先出的数据缓存器。先进入二级缓存的对象最先被淘汰，也就是最老的被淘汰。</li><li>SOFT：软引用。淘汰软引用指向的对象。具体算法和JVM的垃圾回收算法有关。</li><li>WEAK：弱引用。淘汰弱引用指向的对象。具体算法和JVM的垃圾回收算法有关。</li></ol></li><li>flushInterval：<ol><li>二级缓存的刷新时间间隔，刷新就会使缓存失效。单位毫秒。如果没有设置。就代表不刷新缓存，只要内存足够大，一直会向二级缓存中缓存数据。除非执行了增删改。</li></ol></li><li>readOnly：<ol><li>true：多条相同的sql语句执行之后返回的对象是共享的同一个。性能好。但是多线程并发可能会存在安全问题。</li><li>false：多条相同的sql语句执行之后返回的对象是副本，调用了clone方法。性能一般。但安全。</li></ol></li><li>size：<ol><li>设置二级缓存中最多可存储的java对象数量。默认值1024。</li></ol></li></ol><h2 id="14-3-MyBatis集成EhCache"><a href="#14-3-MyBatis集成EhCache" class="headerlink" title="14.3 MyBatis集成EhCache"></a>14.3 MyBatis集成EhCache</h2><p>集成EhCache是为了代替mybatis自带的二级缓存。一级缓存是无法替代的。<br>mybatis对外提供了接口，也可以集成第三方的缓存组件。比如EhCache、Memcache等。都可以。<br>EhCache是Java写的。Memcache是C语言写的。所以mybatis集成EhCache较为常见，按照以下步骤操作，就可以完成集成：</p><p>了解一下就好</p><p>第一步：引入mybatis整合ehcache的依赖。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis集成ehcache的组件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.caches<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第二步：在类的根路径下新建echcache.xml文件，并提供以下配置信息。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;http://ehcache.org/ehcache.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">updateCheck</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--磁盘存储:将缓存中暂时不使用的对象,转移到硬盘,类似于Windows系统的虚拟内存--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">&quot;e:/ehcache&quot;</span>/&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!--defaultCache：默认的管理策略--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--eternal：设定缓存的elements是否永远不过期。如果为true，则缓存的数据始终有效，如果为false那么还要根据timeToIdleSeconds，timeToLiveSeconds判断--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--maxElementsInMemory：在内存中缓存的element的最大数目--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--overflowToDisk：如果内存中数据超过内存限制，是否要缓存到磁盘上--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--diskPersistent：是否在磁盘上持久化。指重启jvm后，数据是否有效。默认为false--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--timeToIdleSeconds：对象空闲时间(单位：秒)，指对象在多长时间没有被访问就会失效。只对eternal为false的有效。默认值0，表示一直可以访问--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--timeToLiveSeconds：对象存活时间(单位：秒)，指对象从创建到失效所需要的时间。只对eternal为false的有效。默认值0，表示一直可以访问--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--memoryStoreEvictionPolicy：缓存的3 种清空策略--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--FIFO：first in first out (先进先出)--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--LFU：Less Frequently Used (最少使用).意思是一直以来最少被使用的。缓存的元素有一个hit 属性，hit 值最小的将会被清出缓存--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--LRU：Least Recently Used(最近最少使用). (ehcache 默认值).缓存的元素有一个时间戳，当缓存容量满了，而又需要腾出地方来缓存新的元素的时候，那么现有缓存元素中时间戳离当前时间最远的元素将被清出缓存--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultCache</span> <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span> <span class="attr">maxElementsInMemory</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">overflowToDisk</span>=<span class="string">&quot;false&quot;</span> <span class="attr">diskPersistent</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;0&quot;</span> <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;600&quot;</span> <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第三步：修改SqlMapper.xml文件中的<cache/>标签，添加type属性。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--集成Ehcache组件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>第四步：编写测试程序使用。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectById2</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession1</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper1</span> <span class="operator">=</span> sqlSession1.getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car1</span> <span class="operator">=</span> mapper1.selectById(<span class="number">83L</span>);</span><br><span class="line">    System.out.println(car1);</span><br><span class="line">    </span><br><span class="line">    sqlSession1.close();</span><br><span class="line">    </span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession2</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper2</span> <span class="operator">=</span> sqlSession2.getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car2</span> <span class="operator">=</span> mapper2.selectById(<span class="number">83L</span>);</span><br><span class="line">    System.out.println(car2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661162595603-3aeecedf-d1f5-4b53-bd76-ee3c52f014fd.png#clientId=ubeb36f5f-42dd-4&from=paste&height=400&id=ua7ee1609&originHeight=400&originWidth=1129&originalType=binary&ratio=1&rotation=0&showTitle=false&size=70384&status=done&style=none&taskId=u14da606c-a1cb-42e2-babd-184e7bab9e4&title=&width=1129" alt="509D28EA-B111-4151-AFC3-E6D3C3BB3F52.png"><br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=YYR3y&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p><h1 id="十五、MyBatis的逆向工程"><a href="#十五、MyBatis的逆向工程" class="headerlink" title="十五、MyBatis的逆向工程"></a>十五、MyBatis的逆向工程</h1><p>所谓的逆向工程是：根据数据库表逆向生成Java的pojo类，SqlMapper.xml文件，以及Mapper接口类等。<br>要完成这个工作，需要借助别人写好的逆向工程插件。<br>思考：使用这个插件的话，需要给这个插件配置哪些信息？</p><ul><li>pojo类名、包名以及生成位置。</li><li>SqlMapper.xml文件名以及生成位置。</li><li>Mapper接口名以及生成位置。</li><li>连接数据库的信息。</li><li>指定哪些表参与逆向工程。</li><li>……</li></ul><h2 id="15-1-逆向工程配置与生成"><a href="#15-1-逆向工程配置与生成" class="headerlink" title="15.1 逆向工程配置与生成"></a>15.1 逆向工程配置与生成</h2><h3 id="第一步：基础环境准备"><a href="#第一步：基础环境准备" class="headerlink" title="第一步：基础环境准备"></a>第一步：基础环境准备</h3><p>新建模块：mybatis-011-generator<br>打包方式：jar</p><h3 id="第二步：在pom中添加逆向工程插件"><a href="#第二步：在pom中添加逆向工程插件" class="headerlink" title="第二步：在pom中添加逆向工程插件"></a>第二步：在pom中添加逆向工程插件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--定制构建过程--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--可配置多个插件--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--其中的一个插件：mybatis逆向工程插件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--插件的GAV坐标--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--允许覆盖，不允许的话生成的东西可能是追加的方式添加，会出错--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">overwrite</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overwrite</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--插件的依赖--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql驱动依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="第三步：配置generatorConfig-xml"><a href="#第三步：配置generatorConfig-xml" class="headerlink" title="第三步：配置generatorConfig.xml"></a>第三步：配置generatorConfig.xml</h3><p>该文件名必须叫做：generatorConfig.xml<br>该文件必须放在类的根路径下。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        targetRuntime有两个值：</span></span><br><span class="line"><span class="comment">            MyBatis3Simple：生成的是基础版，只有基本的增删改查。</span></span><br><span class="line"><span class="comment">            MyBatis3：生成的是增强版，除了基本的增删改查之外还有复杂的增删改查。</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;DB2Tables&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--防止生成重复代码--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.generator.plugins.UnmergeableXmlMappersPlugin&quot;</span>/&gt;</span></span><br><span class="line">      </span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span>注释信息的生成</span><br><span class="line">            <span class="comment">&lt;!--是否去掉生成日期--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressDate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--是否去除注释--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--连接数据库信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/powernode&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">password</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 生成pojo包名和位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.powernode.mybatis.pojo&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--是否开启子包，没有这一项的话会直接把这个当做一个文件夹的名字生成--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--是否去除字段名的前后空白--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 生成SQL映射文件的包名和位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.powernode.mybatis.mapper&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/resources&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--是否开启子包--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 生成Mapper接口的包名和位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span></span></span><br><span class="line"><span class="tag">                <span class="attr">type</span>=<span class="string">&quot;xmlMapper&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">targetPackage</span>=<span class="string">&quot;com.powernode.mybatis.mapper&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 表名和对应的实体类名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;t_car&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Car&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="第四步：运行插件"><a href="#第四步：运行插件" class="headerlink" title="第四步：运行插件"></a>第四步：运行插件</h3><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661220807303-79730f99-9a3c-4394-a29f-910eccd698cc.png#clientId=u50a30195-6f18-4&from=paste&height=309&id=RBX4s&originHeight=309&originWidth=521&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16729&status=done&style=none&taskId=uc42c264a-2b51-4500-8e42-33afc6d608a&title=&width=521" alt="14F24AF8-789F-4267-9694-0FDF158366C1.png"></p><h2 id="15-2-测试逆向工程生成的是否好用"><a href="#15-2-测试逆向工程生成的是否好用" class="headerlink" title="15.2 测试逆向工程生成的是否好用"></a>15.2 测试逆向工程生成的是否好用</h2><h3 id="第一步：环境准备"><a href="#第一步：环境准备" class="headerlink" title="第一步：环境准备"></a>第一步：环境准备</h3><ul><li>依赖：mybatis依赖、mysql驱动依赖、junit依赖、logback依赖</li><li>jdbc.properties</li><li>mybatis-config.xml</li><li>logback.xml</li></ul><h3 id="第二步：编写测试程序"><a href="#第二步：编写测试程序" class="headerlink" title="第二步：编写测试程序"></a>第二步：编写测试程序</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GeneratorTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 生成的CarExample类负责封装查询条件的</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGenerator</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(CarMapper.class);</span><br><span class="line">        <span class="comment">// 增</span></span><br><span class="line">        <span class="comment">/*Car car = new Car();</span></span><br><span class="line"><span class="comment">        car.setCarNum(&quot;1111&quot;);</span></span><br><span class="line"><span class="comment">        car.setBrand(&quot;比亚迪唐&quot;);</span></span><br><span class="line"><span class="comment">        car.setGuidePrice(new BigDecimal(30.0));</span></span><br><span class="line"><span class="comment">        car.setProduceTime(&quot;2010-10-12&quot;);</span></span><br><span class="line"><span class="comment">        car.setCarType(&quot;燃油车&quot;);</span></span><br><span class="line"><span class="comment">        int count = mapper.insert(car);</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;插入了几条记录：&quot; + count);*/</span></span><br><span class="line">        <span class="comment">// 删</span></span><br><span class="line">        <span class="comment">/*int count = mapper.deleteByPrimaryKey(83L);</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;删除了几条记录：&quot; + count);*/</span></span><br><span class="line">        <span class="comment">// 改</span></span><br><span class="line">        <span class="comment">// 根据主键修改</span></span><br><span class="line">        <span class="comment">/*Car car = new Car();</span></span><br><span class="line"><span class="comment">        car.setId(89L);</span></span><br><span class="line"><span class="comment">        car.setGuidePrice(new BigDecimal(20.0));</span></span><br><span class="line"><span class="comment">        car.setCarType(&quot;新能源&quot;);</span></span><br><span class="line"><span class="comment">        int count = mapper.updateByPrimaryKey(car);</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;更新了几条记录：&quot; + count);*/</span></span><br><span class="line">        <span class="comment">// 根据主键选择性修改</span></span><br><span class="line">        <span class="comment">/*car = new Car();</span></span><br><span class="line"><span class="comment">        car.setId(89L);</span></span><br><span class="line"><span class="comment">        car.setCarNum(&quot;3333&quot;);</span></span><br><span class="line"><span class="comment">        car.setBrand(&quot;宝马520Li&quot;);</span></span><br><span class="line"><span class="comment">        car.setProduceTime(&quot;1999-01-10&quot;);</span></span><br><span class="line"><span class="comment">        count = mapper.updateByPrimaryKeySelective(car);</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;更新了几条记录：&quot; + count);*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查一个</span></span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> mapper.selectByPrimaryKey(<span class="number">89L</span>);</span><br><span class="line">        System.out.println(car);</span><br><span class="line">        <span class="comment">// 查询所有(selectByExample，根据条件查询，如果条件是null表示没有条件。)</span></span><br><span class="line">        List&lt;Car&gt; cars = mapper.selectByExample(<span class="literal">null</span>);</span><br><span class="line">        cars.forEach(c -&gt; System.out.println(c));</span><br><span class="line">        <span class="comment">// 多条件查询</span></span><br><span class="line">        <span class="comment">//封装条件，通过CarExample对象来封装查询条件，也就是where后面的那些</span></span><br><span class="line">        <span class="comment">// QBC 风格：Query By Criteria 一种查询方式，比较面向对象，看不到sql语句。</span></span><br><span class="line">        <span class="type">CarExample</span> <span class="variable">carExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CarExample</span>();</span><br><span class="line">        <span class="comment">//调用carExample.createCriteria()方法来创建查询条件，后面的是品牌等于什么什么，相当于where brand = &quot;丰田霸道&quot;</span></span><br><span class="line">        carExample.createCriteria()</span><br><span class="line">                .andBrandEqualTo(<span class="string">&quot;丰田霸道&quot;</span>)</span><br><span class="line">                .andGuidePriceGreaterThan(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">60.0</span>));<span class="comment">//这个是大于60万的意思</span></span><br><span class="line">  <span class="comment">//如果要加or就在上面的语句加个分号，然后.or继续添加</span></span><br><span class="line">        carExample.or().andProduceTimeBetween(<span class="string">&quot;2000-10-11&quot;</span>, <span class="string">&quot;2022-10-11&quot;</span>);</span><br><span class="line"></span><br><span class="line">        mapper.selectByExample(carExample);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=IUD4s&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p><h1 id="十六、MyBatis使用PageHelper"><a href="#十六、MyBatis使用PageHelper" class="headerlink" title="十六、MyBatis使用PageHelper"></a>十六、MyBatis使用PageHelper</h1><h2 id="16-1-limit分页"><a href="#16-1-limit分页" class="headerlink" title="16.1 limit分页"></a>16.1 limit分页</h2><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/image-20251210031226614.png" alt="image-20251210031226614"></p><p>mysql的limit后面两个数字：</p><ul><li>第一个数字：startIndex（起始下标。下标从0开始。）</li><li>第二个数字：pageSize（每页显示的记录条数）</li></ul><p>假设已知页码pageNum，还有每页显示的记录条数pageSize，第一个数字可以动态的获取吗？</p><ul><li>startIndex &#x3D; (pageNum - 1) * pageSize</li></ul><p>所以，标准通用的mysql分页SQL：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">  <span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">  tableName ...... </span><br><span class="line">limit </span><br><span class="line">  (pageNum <span class="operator">-</span> <span class="number">1</span>) <span class="operator">*</span> pageSize, pageSize</span><br></pre></td></tr></table></figure><p>使用mybatis应该怎么做？<br>模块名：mybatis-012-page</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 通过分页的方式获取Car列表</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> startIndex 页码</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pageSize 每页显示记录条数</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    List&lt;Car&gt; <span class="title function_">selectAllByPage</span><span class="params">(<span class="meta">@Param(&quot;startIndex&quot;)</span> Integer startIndex, <span class="meta">@Param(&quot;pageSize&quot;)</span> Integer pageSize)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.mybatis.mapper.CarMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllByPage&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">        select * from t_car limit #&#123;startIndex&#125;,#&#123;pageSize&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarMapperTest</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByPage</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">// 获取每页显示的记录条数</span></span><br><span class="line"><span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"><span class="comment">// 显示第几页:页码</span></span><br><span class="line"><span class="type">int</span> <span class="variable">pageNum</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="comment">// 计算开始下标</span></span><br><span class="line"><span class="type">int</span> startIndex=(pageNum-<span class="number">1</span>)* pageSize;</span><br><span class="line">SqlSession sqlSession=SqlSessionUtil.openSession();</span><br><span class="line">CarMapper mapper=sqlSession.getMapper(CarMapper.class);</span><br><span class="line">List&lt;Car&gt; cars = mapper.selectByPage(startIndex, pageSize);</span><br><span class="line">cars.forEach(car -&gt;System.out.println&#123;car));</span><br><span class="line">sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661239750003-ff5657d8-9d9a-4c96-b908-eb5a644525bd.png#clientId=u7b0692f6-7a01-4&from=paste&height=181&id=uee073f3b&originHeight=181&originWidth=1075&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31260&status=done&style=none&taskId=ufee64ea5-a73b-42bd-be29-f28c8af0a07&title=&width=1075" alt="8603C746-8E85-4cfd-9D9D-4305643249E0.png"><br>获取数据不难，难的是获取分页相关的数据比较难。可以借助mybatis的PageHelper插件。</p><h2 id="16-3-PageHelper插件"><a href="#16-3-PageHelper插件" class="headerlink" title="16.3 PageHelper插件"></a>16.3 PageHelper插件</h2><p>使用PageHelper插件进行分页，更加的便捷。</p><h3 id="第一步：引入依赖"><a href="#第一步：引入依赖" class="headerlink" title="第一步：引入依赖"></a>第一步：引入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="第二步：在mybatis-config-xml文件中配置插件"><a href="#第二步：在mybatis-config-xml文件中配置插件" class="headerlink" title="第二步：在mybatis-config.xml文件中配置插件"></a>第二步：在mybatis-config.xml文件中配置插件</h3><p>typeAliases标签下面进行配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis分页的拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="第三步：编写Java代码"><a href="#第三步：编写Java代码" class="headerlink" title="第三步：编写Java代码"></a>第三步：编写Java代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询所有的Car，通过分页查询插件PageHelper元成。</span></span><br><span class="line">List&lt;Car&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">  select * from t_car</span><br><span class="line">&lt;/select &gt;</span><br></pre></td></tr></table></figure><p>关键点：</p><ul><li>在查询语句之前开启分页功能。</li><li>在查询语句之后封装PageInfo对象。（PageInfo对象将来会存储到request域当中。在页面上展示。）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPageHelper</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.openSession();</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(CarMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一定一定一定要注意:在执行DQL语句之前。开启分页功能:</span></span><br><span class="line"><span class="type">int</span> <span class="variable">pageNum</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">PageHelper.startPage(pageNum,pagesize);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 开启分页</span></span><br><span class="line">    PageHelper.startPage(pageNum,pagesize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行查询语句</span></span><br><span class="line">    List&lt;Car&gt; cars = mapper.selectAll();</span><br><span class="line"><span class="comment">//cars.forEach(car -&gt; System.out.println(car));</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 获取分页信息对象</span></span><br><span class="line">    <span class="comment">// PageInfo对象是PageHelper插件提供的，用来封装分页相关的信息的对象</span></span><br><span class="line">    <span class="comment">//把上面查到的集合car传进去，后面是页面下方1页2页3页的那个导航按钮数量</span></span><br><span class="line">    PageInfo&lt;Car&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(cars, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(pageInfo);</span><br><span class="line">    </span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PageInfo&#123;</span><br><span class="line">  pageNum=2, pageSize=2, size=2, startRow=3, endRow=4, total=6, pages=3, </span><br><span class="line">  list=Page&#123;count=true, pageNum=2, pageSize=2, startRow=2, endRow=4, total=6, pages=3, reasonable=false, pageSizeZero=false&#125;</span><br><span class="line">  [Car&#123;id=86, carNum=&#x27;1234&#x27;, brand=&#x27;丰田霸道&#x27;, guidePrice=50.5, produceTime=&#x27;2020-10-11&#x27;, carType=&#x27;燃油车&#x27;&#125;, </span><br><span class="line">  Car&#123;id=87, carNum=&#x27;1234&#x27;, brand=&#x27;丰田霸道&#x27;, guidePrice=50.5, produceTime=&#x27;2020-10-11&#x27;, carType=&#x27;燃油车&#x27;&#125;], </span><br><span class="line">  prePage=1, nextPage=3, isFirstPage=false, isLastPage=false, hasPreviousPage=true, hasNextPage=true, </span><br><span class="line">  navigatePages=5, navigateFirstPage=1, navigateLastPage=3, navigatepageNums=[1, 2, 3]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1659578619308-ceb8077a-94a7-4f64-b41d-e54b3c14e7fb.png#clientId=u6b7aa99c-2be4-4&from=paste&id=GWW3k&originHeight=152&originWidth=1180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17957&status=done&style=none&taskId=u6b6c011d-5b8c-4c26-8cd3-e70c19148ae&title=" alt="logo.png"></p><h1 id="十七、MyBatis的注解式开发"><a href="#十七、MyBatis的注解式开发" class="headerlink" title="十七、MyBatis的注解式开发"></a>十七、MyBatis的注解式开发</h1><p>mybatis中也提供了注解式开发方式，采用注解可以减少Sql映射文件的配置。<br>当然，使用注解式开发的话，sql语句是写在java程序中的，这种方式也会给sql语句的维护带来成本。<br>官方是这么说的：</p><blockquote><p>使用注解来映射简单语句会使代码显得更加简洁，但对于稍微复杂一点的语句，Java 注解不仅力不从心，还会让你本就复杂的 SQL 语句更加混乱不堪。 因此，如果你需要做一些很复杂的操作，最好用 XML 来映射语句。</p></blockquote><p>使用注解编写复杂的SQL是这样的：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661243511174-55bc0ee4-9561-448d-ad21-f02591d88798.png#clientId=u7b0692f6-7a01-4&from=paste&height=115&id=u8da4b2f4&originHeight=115&originWidth=572&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6952&status=done&style=none&taskId=ubf0f9985-cab0-442b-a0b7-1119ff8eb90&title=&width=572" alt="7B6EA744-14B7-4f41-94DC-AD005612A026.png"><br>原则：简单sql可以注解。复杂sql使用xml。<br>模块名：mybatis-013-annotation<br>打包方式：jar<br>依赖：mybatis，mysql驱动，junit，logback<br>配置文件：jdbc.properties、mybatis-config.xml、logback.xml<br>pojo：com.powernode.mybatis.pojo.Car<br>mapper接口：com.powernode.mybatis.mapper.CarMapper</p><h2 id="17-1-Insert"><a href="#17-1-Insert" class="headerlink" title="17.1 @Insert"></a>17.1 @Insert</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert(value=&quot;insert into t_car values(null,#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(Car car)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">        <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(CarMapper.class);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="literal">null</span>, <span class="string">&quot;1112&quot;</span>, <span class="string">&quot;卡罗拉&quot;</span>, <span class="number">30.0</span>, <span class="string">&quot;2000-10-10&quot;</span>, <span class="string">&quot;燃油车&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> mapper.insert(car);</span><br><span class="line">        System.out.println(<span class="string">&quot;插入了几条记录：&quot;</span> + count);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="17-2-Delete"><a href="#17-2-Delete" class="headerlink" title="17.2 @Delete"></a>17.2 @Delete</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Delete(&quot;delete from t_car where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(CarMapper.class);</span><br><span class="line">    mapper.deleteById(<span class="number">89L</span>);</span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="17-3-Update"><a href="#17-3-Update" class="headerlink" title="17.3 @Update"></a>17.3 @Update</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Update(&quot;update t_car set car_num=#&#123;carNum&#125;,brand=#&#123;brand&#125;,guide_price=#&#123;guidePrice&#125;,produce_time=#&#123;produceTime&#125;,car_type=#&#123;carType&#125; where id=#&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span><span class="params">(Car car)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="number">88L</span>,<span class="string">&quot;1001&quot;</span>, <span class="string">&quot;凯美瑞&quot;</span>, <span class="number">30.0</span>,<span class="string">&quot;2000-11-11&quot;</span>, <span class="string">&quot;新能源&quot;</span>);</span><br><span class="line">    mapper.update(car);</span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="17-4-Select"><a href="#17-4-Select" class="headerlink" title="17.4 @Select"></a>17.4 @Select</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from t_car where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;id&quot;, property = &quot;id&quot;, id = true),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;car_num&quot;, property = &quot;carNum&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;brand&quot;, property = &quot;brand&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;guide_price&quot;, property = &quot;guidePrice&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;produce_time&quot;, property = &quot;produceTime&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;car_type&quot;, property = &quot;carType&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line">Car <span class="title function_">selectById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectById</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">carMapper</span> <span class="operator">=</span> sqlSession.getMapper(CarMapper.class);</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> carMapper.selectById(<span class="number">88L</span>);</span><br><span class="line">    System.out.println(car);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：<br><img src="/./images/%E8%80%81%E6%9D%9CMyBatis/1661245790082-b0ae21de-bdc7-41ba-a937-31bad62d1ade.png#clientId=u7b0692f6-7a01-4&from=paste&height=134&id=u5ce27a82&originHeight=134&originWidth=1045&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14657&status=done&style=none&taskId=u724a0567-f216-46ed-a808-96dc712c484&title=&width=1045" alt="76ADC80A-E5F0-4805-92F2-E98A4D92EBA0.png"></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSM </tag>
            
            <tag> Java </tag>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Servlet-JSP-课堂笔记</title>
      <link href="/posts/4d910bb8.html"/>
      <url>/posts/4d910bb8.html</url>
      
        <content type="html"><![CDATA[<h1 id="关于直播"><a href="#关于直播" class="headerlink" title="关于直播"></a>关于直播</h1><ol><li>什么时间直播？<ul><li>晚上8:00到10:00</li></ul></li><li>每周直播几天？<ul><li>3天（周一、周三、周五）</li><li>本周比较特殊：周四周五周六三天直播，从下周开始就是一三五直播。</li></ul></li><li>直播什么内容？<ul><li>从JavaWEB开始。（Servlet为核心，从Servlet开始学习。）</li><li>JSP（JSP使用较少了，但是还有用，所以时间上少一些。快速地学习一下JSP。）</li><li>AJAX（异步通信技术。）</li><li>jQuery（JavaScript库。）</li><li>MyBatis</li><li>Spring</li><li>SpringMVC</li><li>SpringBoot</li><li>SpringCloud</li><li>….</li></ul></li></ol><h1 id="需要提前准备了哪些技术，接下来的课才能听懂？"><a href="#需要提前准备了哪些技术，接下来的课才能听懂？" class="headerlink" title="需要提前准备了哪些技术，接下来的课才能听懂？"></a>需要提前准备了哪些技术，接下来的课才能听懂？</h1><ul><li>JavaSE（Java语言的标准版，Java提供的最基本的类库）<ul><li>Java的开发环境搭建</li><li>Java的基础语法</li><li>Java的面向对象</li><li>数组</li><li>常用类</li><li>异常</li><li>集合</li><li>多线程</li><li>IO流</li><li>反射机制</li><li>注解Annotation</li><li>…..</li></ul></li><li>MySQL（数据库）<ul><li>最基本的要求是：能够编写增删改查等简单的SQL语句即可。</li></ul></li><li>JDBC（Java语言链接数据库）<ul><li>这是一套Java语言链接数据库的接口。</li></ul></li><li>WEB前端（会一些）<ul><li>HTML（网页）</li><li>CSS（层叠样式表语言，修饰HTML）</li><li>JavaScript（一种脚本语言，运行在浏览器当中，让浏览器中的元素可以增删改。让网页产生更强的交互效果）</li></ul></li><li>WEB后端<ul><li>Servlet（Server Applet：服务器端的Java小程序）</li><li>JSP</li><li>AJAX</li><li>jQuery</li><li>MyBatis</li><li>Spring</li><li>SpringMVC</li><li>SpringBoot</li><li>SpringCloud</li><li>……</li></ul></li></ul><h1 id="Typora软件介绍"><a href="#Typora软件介绍" class="headerlink" title="Typora软件介绍"></a>Typora软件介绍</h1><ul><li><p>Markdown文本编辑器（可以编辑xxx.md文件）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Test code!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h1><h2 id="关于系统架构"><a href="#关于系统架构" class="headerlink" title="关于系统架构"></a>关于系统架构</h2><ol><li>系统架构包括什么形式？<ul><li>C&#x2F;S架构</li><li>B&#x2F;S架构</li></ul></li><li>C&#x2F;S架构？<ul><li>Client &#x2F; Server（客户端 &#x2F; 服务器）</li><li>C&#x2F;S架构的软件或者说系统有哪些呢？<ul><li>QQ</li></ul></li><li>C&#x2F;S架构的特点：需要安装特定的客户端软件。</li><li>C&#x2F;S架构的系统优点和缺点分别是什么？<ul><li>优点：<ul><li>速度快（软件中的数据大部分都是集成到客户端软件当中的，很少量的数据从服务器端传送过来，所以C&#x2F;S结构的系统速度快）</li><li>体验好（速度又快，界面又酷炫，当然体验好了。）</li><li>界面酷炫（专门的语言去实现界面的，更加灵活。）</li><li>服务器压力小（因为大量的数据都是集成在客户端软件当中，所以服务器只需要传送很少的数据量，当然服务器压力小。）</li><li>安全（因为大量的数据是集成在客户端软件当中的，并且客户端有很多个，服务器虽然只有一个，就算服务器那边地震了，火灾了，服务器受损了，问题也不大，因为大量的数据在多个客户端上有缓存，有存储，所以从这个方面来说，C&#x2F;S结构的系统比较安全。）</li><li>…..</li></ul></li><li>缺点：<ul><li>升级维护比较差劲。（升级维护比较麻烦。成本比较高。每一个客户端软件都需要升级。有一些软件不是那么容易安装的。）</li></ul></li></ul></li></ul></li><li>B&#x2F;S架构？<ul><li>B&#x2F;S（Browser &#x2F; Server，浏览器 &#x2F; 服务器）</li><li><a href="http://www.baidu.com/">http://www.baidu.com</a></li><li><a href="http://www.jd.com/">http://www.jd.com</a></li><li><a href="http://www.126.com/">http://www.126.com</a></li><li>B&#x2F;S结构的系统是不是一个特殊的C&#x2F;S系统？<ul><li>实际上B&#x2F;S结构的系统还是一个C&#x2F;S，只不过这个C比较特殊，这个Client是一个固定不变浏览器软件。</li></ul></li><li>B&#x2F;S结构的系统优点和缺点是：<ul><li>优点：<ul><li>升级维护方便，成本比较低。（只需要升级服务器端即可。）</li><li>不需要安装特定的客户端软件，用户操作极其方便。只需要打开浏览器，输入网址即可。</li></ul></li><li>缺点：<ul><li>速度慢（不是因为带宽低的问题，是因为所有的数据都是在服务器上，用户发送的每一个请求都是需要服务器全身心的响应数据，所以B&#x2F;S结构的系统在网络中传送的数据量比较大。）</li><li>体验差（界面不是那么酷炫，因为浏览器只支持三个语言HTML CSS JavaScript。在加上速度慢。）</li><li>不安全（所有的数据都在服务器上，只要服务器发生火灾，地震等不可抗力，最终数据全部丢失。）</li><li>….</li></ul></li></ul></li></ul></li><li>C&#x2F;S和B&#x2F;S结构的系统，哪个好，哪个不好？<ul><li>这个问题问的没有水平。并不是哪个好，哪个不好。不同结构的系统在不同的业务场景下有不同的适用场景。</li><li>娱乐性软件建议使用？<ul><li>C&#x2F;S 结构</li></ul></li><li>公司内部使用的一些业务软件建议使用？<ul><li>公司内部使用的系统，需要维护成本低。</li><li>公司内部使用的系统，不需要很酷炫。</li><li>公司内部使用的企业级系统主要是能够进行数据的维护即可。</li><li>B&#x2F;S 结构。</li></ul></li></ul></li><li>注意了：开发B&#x2F;S结构的系统，其实就是开发网站，其实就是开发一个WEB系统。<ul><li>开发一个WEB系统你需要会哪些技术？<ul><li>WEB前端（运行在浏览器上的程序。）<ul><li>HTML</li><li>CSS</li><li>JavaScript</li></ul></li><li>WEB后端（WEB服务器端的程序。）<ul><li>Java可以（Java做WEB开发我们称为JavaWEB开发。JavaWEB开发最核心的规范：Servlet【Server Applet服务器端的Java小程序。】）</li><li>C语言也可以</li><li>C++也可以</li><li>Python也行</li><li>PHP也可以</li><li>….</li></ul></li></ul></li></ul></li><li>JavaEE是什么？<ul><li>Java包括三大块：<ul><li>JavaSE<ul><li>Java标准版（一套类库：别人写好的一套类库，只不过这个类库是标准类库，走EE，或者走ME，这个SE一定是基础，先学。）</li></ul></li><li>JavaEE（WEB方向，WEB系统。）<ul><li>Java企业版（也是一套类库：也是别人写好的一套类库，只不过这套类库可以帮助我们完成企业级项目的开发，专门为企业内部提供解决方案的一套（多套）类库。）</li><li>别人写好的，你用就行了，用它可以开发企业级项目。</li><li>可以开发web系统。</li><li>Java比较火爆的就是这个JavaEE方向。</li></ul></li><li>JavaME<ul><li>Java微型版（还是一套类库，只不过这套类库帮助我们进行电子微型设备内核程序的开发）</li><li>机顶盒内核程序，吸尘器内核程序，电冰箱内核程序，电饭煲内核程序。。。。。</li></ul></li></ul></li><li>JavaEE实际上包括很多种规范，13种规范，其中Servlet就是JavaEE规范之一。学Servlet还是Java语言。</li></ul></li></ol><h2 id="B-S结构的系统通信原理（没有涉及到Java小程序）"><a href="#B-S结构的系统通信原理（没有涉及到Java小程序）" class="headerlink" title="B&#x2F;S结构的系统通信原理（没有涉及到Java小程序）"></a>B&#x2F;S结构的系统通信原理（没有涉及到Java小程序）</h2><ul><li>WEB系统的访问过程<ul><li>第一步：打开浏览器</li><li>第二步：找到地址栏</li><li>第三步：输入一个合法的网址</li><li>第四步：回车</li><li>第五步：在浏览器上会展示响应的结果。</li></ul></li><li>关于域名：<ul><li><a href="https://www.baidu.com/">https://www.baidu.com/</a> （网址）</li><li><a href="http://www.baidu.com/">www.baidu.com</a> 是一个域名</li><li>在浏览器地址栏上输入域名，回车之后，域名解析器会将域名解析出来一个具体的IP地址和端口号等。</li><li>解析结果也许是：<a href="http://110.242.68.3/index.html">http://110.242.68.3:80/index.html</a></li></ul></li><li>IP地址是啥？<ul><li>计算机在网络当中的一个身份证号。在同一个网络当中，IP地址是唯一的。</li><li>A计算机要想和B计算机通信，首先你需要知道B计算机的IP地址，有了IP地址才能建立连接。</li></ul></li><li>端口号是啥？<ul><li>一个端口代表一个软件（一个端口代表一个应用，一个端口仅代表一个服务）。</li><li>一个计算机当中有很多软件，每一个软件启动之后都有一个端口号。</li><li>在同一个计算机上，端口号具有唯一性。</li></ul></li><li>一个WEB系统的通信原理？通信步骤：<ul><li>第一步：用户输入网址（URL）</li><li>第二步：域名解析器进行域名解析：<a href="http://110.242.68.3/index.html">http://110.242.68.3:80/index.html</a></li><li>第三步：浏览器软件在网络中搜索110.242.68.3这一台主机，直到找到这台主机。</li><li>第四步：定位110.242.68.3这台主机上的服务器软件，因为是80端口，可以很轻松的定位到80端口对应的服务器软件。</li><li>第五步：80端口对应的服务器软件得知浏览器想要的资源名是：index.html</li><li>第六步：服务器软件找到index.html文件，并且将index.html文件中的内容直接输出响应到浏览器上。</li><li>第七步：浏览器接收到来自服务器的代码（HTML CSS JS）</li><li>第八步：浏览器渲染，执行HTML CSS JS代码，展示效果。</li></ul></li><li>什么是URL？<ul><li>统一资源定位符（<a href="http://www.baidu.com)/">http://www.baidu.com）</a></li></ul></li><li>什么是请求，什么是响应？<ul><li>请求和响应实际上说的是数据的流向不同。</li><li>从Browser端发送数据到Server端，我们称为请求。英语单词：request</li><li>从Server端向浏览器Browser端发送数据，我们称为响应。英语单词：response</li><li>B –&gt; S （请求request）</li><li>S –&gt; B （响应response）</li></ul></li></ul><h2 id="关于WEB服务器软件"><a href="#关于WEB服务器软件" class="headerlink" title="关于WEB服务器软件"></a>关于WEB服务器软件</h2><ul><li><p>WEB服务器软件都有哪些呢？（这些软件都是提前开发好的。）</p><ul><li>Tomcat（WEB服务器）</li><li>jetty（WEB服务器）</li><li>JBOSS（应用服务器）</li><li>WebLogic（应用服务器）</li><li>WebSphere（应用服务器）</li></ul></li><li><p>应用服务器和WEB服务器的关系？</p><ul><li>应用服务器实现了JavaEE的所有规范。(JavaEE有13个不同的规范。)</li><li>WEB服务器只实现了JavaEE中的Servlet + JSP两个核心的规范。</li><li>通过这个讲解说明了：应用服务器是包含WEB服务器的。</li><li>用过JBOSS服务器的同学应该很清楚，JBOSS中内嵌了一个Tomcat服务器。</li></ul></li><li><p>Tomcat下载</p><ul><li>apache官网地址：<a href="https://www.apache.org/">https://www.apache.org/</a></li><li>tomcat官网地址：<a href="https://tomcat.apache.org/">https://tomcat.apache.org</a></li><li>tomcat开源免费的轻量级WEB服务器。</li><li>tomcat还有另外一个名字：catalina（catalina是美国的一个岛屿，风景秀丽，据说作者是在这个风景秀丽的小岛上开发了一个轻量级的WEB服务器，体积小，运行速度快，因此tomcat又被称为catalina）</li><li>tomcat的logo是一只公猫（寓意表示Tomcat服务器是轻巧的，小巧的，果然，体积小，运行速度快，只实现了Servlet+JSP规范）</li><li>tomcat是java语言写的。</li><li>tomcat服务器要想运行，必须先又jre（Java的运行时环境）</li></ul></li><li><p>Tomcat服务器要想运行，需要先有jre，所以要先安装JDK，配置java运行环境。</p><ul><li>JAVA_HOME&#x3D;C:\Program Files\Java\jdk-17.0.1</li><li>PATH&#x3D;%JAVA_HOME%\bin</li><li>目前JAVA_HOME没有配置，思考一个问题，这样行不行呢？目前只运行java程序是没问题的。真的没问题吗？</li></ul></li><li><p>Tomcat服务器的安装：</p><ul><li>绿色版本的安装很简单，直接zip包解压即可。解压就是安装。</li><li>我有一个好习惯，在C盘的根目录下新建一个dev目录，java开发所有相关的工具都安装到dev目录下，这样比较方便管理。（你随意）</li><li>启动Tomcat<ul><li>bin目录下有一个文件：startup.bat,通过它可以启动Tomcat服务器。<ul><li>xxx.bat文件是个什么文件？bat文件是windows操作系统专用的，bat文件是批处理文件，这种文件中可以编写大量的windows的dos命令，然后执行bat文件就相当于批量的执行dos命令。</li><li>startup.sh，这个文件在windows当中无法执行，在Linux环境当中可以使用。在Linux环境下能够执行的是shell命令，大量的shell命令编写在shell文件当中，然后执行这个shell文件可以批量的执行shell命令。</li><li>tomcat服务器提供了bat和sh文件，说明了这个tomcat服务器的通用性。</li><li>分析startup.bat文件得出，执行这个命令，实际上最后是执行：catalina.bat文件。</li><li>catalina.bat文件中有这样一行配置：MAINCLASS&#x3D;org.apache.catalina.startup.Bootstrap （这个类就是main方法所在的类。）</li><li>tomcat服务器就是Java语言写的，既然是java语言写的，那么启动Tomcat服务器就是执行main方法。</li></ul></li><li>我们尝试打开dos命令窗口，在dos命令窗口中输入startup.bat来启动tomcat服务器。</li><li>启动Tomcat服务器只配置path对应的bin目录是不行的。有两个环境变量需要配置：<ul><li>JAVA_HOME&#x3D;JDK的根</li><li>CATALINA_HOME&#x3D;Tomcat服务器的根</li></ul></li></ul></li></ul></li><li><p>关于Tomcat服务器的目录</p><ul><li>bin ： 这个目录是Tomcat服务器的命令文件存放的目录，比如：启动Tomcat，关闭Tomcat等。</li><li>conf： 这个目录是Tomcat服务器的配置文件存放目录。（server.xml文件中可以配置端口号，默认Tomcat端口是8080）</li><li>lib ：这个目录是Tomcat服务器的核心程序目录，因为Tomcat服务器是Java语言编写的，这里的jar包里面都是class文件。</li><li>logs: Tomcat服务器的日志目录，Tomcat服务器启动等信息都会在这个目录下生成日志文件。</li><li>temp：Tomcat服务器的临时目录。存储临时文件。</li><li>webapps：这个目录当中就是用来存放大量的webapp（web application：web应用）</li><li>work：这个目录是用来存放JSP文件翻译之后的java文件以及编译之后的class文件。</li></ul></li><li><p>配置Tomcat服务器需要哪些环境变量？</p><ul><li>JAVA_HOME&#x3D;JDK的根</li><li>CATALINA_HOME&#x3D;Tomcat服务器的根</li><li>PATH&#x3D;%JAVA_HOME%\bin;%CATALINA_HOME%\bin</li></ul></li><li><p>启动Tomcat： startup</p></li><li><p>关闭Tomcat：stop （shutdown.bat文件重命名为stop.bat，为什么？原因是shutdown命令和windows中的关机命令冲突。所以修改一下。）</p></li><li><p>怎么测试Tomcat服务器有没有启动成功呢？</p><ul><li>打开浏览器，在浏览器的地址栏上输入URL即可：<ul><li><a href="http://ip地址:端口号">http://ip地址:端口号</a></li><li>ip地址是什么？端口号我知道，是8080</li><li>本机的IP地址是：127.0.0.1，或者是localhost，都行。</li></ul></li></ul></li></ul><h2 id="实现一个最基本的web应用（这个web应用中没有java小程序）"><a href="#实现一个最基本的web应用（这个web应用中没有java小程序）" class="headerlink" title="实现一个最基本的web应用（这个web应用中没有java小程序）"></a>实现一个最基本的web应用（这个web应用中没有java小程序）</h2><ul><li><p>第一步：找到CATALINA_HOME\webapps目录</p><ul><li>因为所有的webapp要放到webapps目录下。（没有为什么，这是Tomcat服务器的要求。如果不放到这里，Tomcat服务器找不到你的应用。）</li></ul></li><li><p>第二步：在CATALINA_HOME\webapps目录下新建一个子目录，起名：oa</p><ul><li>这个目录名oa就是你这个webapp的名字。</li></ul></li><li><p>第三步：在oa目录下新建资源文件，例如：index.html</p><ul><li>编写index.html文件的内容。</li></ul></li><li><p>第四步：启动Tomcat服务器</p></li><li><p>第五步：打开浏览器，在浏览器地址栏上输入这样的URL：</p></li><li><p><a href="http://127.0.0.1:8080/oa/index.html">http://127.0.0.1:8080/oa/index.html</a></p></li><li><p>思考一个问题：</p><ul><li><p>我们在浏览器上直接输入一个URL，然后回车。这个动作和超链接一样吗？既然是一样的，我们完全可以使用超链接。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注意以下的路径，以/开始，带项目名，是一个绝对路径。不需要添加：http://127.0.0.1:8080--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/oa/login.html&quot;</span>&gt;</span>user login2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--多个层级也没有关系，正常访问即可。--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--注意：我们目前前端上的路径都以“/”开始的，都是加项目名的。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/oa/test/debug/d.html&quot;</span>&gt;</span>d page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><a href="http://127.0.0.1:8080/oa/userList.html">http://127.0.0.1:8080/oa/userList.html</a> </p><ul><li>访问这个地址，可以展示一个用户列表页面。但是这个用户列表页面是写死在HTML文件当中的。这种资源我们称为静态资源。怎么能变成动态资源。显然需要连接数据库。</li><li>连接数据库需要JDBC程序，也就是说需要编写Java程序连接数据库，数据库中有多少条记录，页面上就显示多少条记录，这种技术被称为动态网页技术。（动态网页技术并不是说页面中有flash动画。动态网页技术是说页面中的数据是动态的，根据数据库中数据的变化而变化。）</li></ul></li></ul><h2 id="对于一个动态的web应用来说，一个请求和响应的过程有多少个角色参与，角色和角色之间有多少个协议"><a href="#对于一个动态的web应用来说，一个请求和响应的过程有多少个角色参与，角色和角色之间有多少个协议" class="headerlink" title="对于一个动态的web应用来说，一个请求和响应的过程有多少个角色参与，角色和角色之间有多少个协议"></a>对于一个动态的web应用来说，一个请求和响应的过程有多少个角色参与，角色和角色之间有多少个协议</h2><p><img src="/./images/Servlet-JSP-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/BS%E7%BB%93%E6%9E%84%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%862.png" alt="BS结构系统的通信原理2"></p><ul><li>有哪些角色（在整个BS结构的系统当中，有哪些人参与进去了）<ul><li>浏览器软件的开发团队（浏览器软件太多了：谷歌浏览器、火狐浏览器、IE浏览器….）</li><li>WEB Server的开发团队（WEB Server这个软件也是太多了：Tomcat、Jetty、WebLogic、JBOSS、WebSphere….）</li><li>DB Server的开发团队（DB Server这个软件也是太多了：Oracle、MySQL…..）</li><li>webapp的开发团队（WEB应用是我们做为JavaWEB程序员开发的）</li></ul></li><li>角色和角色之间需要遵守哪些规范，哪些协议<ul><li>webapp的开发团队   和    WEB Server的开发团队  之间有一套规范: JavaEE规范之一Servlet规范。<ul><li>Servlet规范的作用是什么？<ul><li>WEB Server   和   webapp解耦合。</li></ul></li></ul></li><li>Browser  和   WebServer之间有一套传输协议：HTTP协议。（超文本传输协议。）</li><li>webapp开发团队  和  DB Server的开发团队之间有一套规范：JDBC规范。</li></ul></li></ul><p><img src="/./images/Servlet-JSP-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/BS%E7%BB%93%E6%9E%84%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%A7%92%E8%89%B2%E5%92%8C%E5%8D%8F%E8%AE%AE.png" alt="BS结构系统的角色和协议"></p><ul><li>Servlet规范是一个什么规范？<ul><li>遵循Servlet规范的webapp，这个webapp就可以放在不同的WEB服务器中运行。（因为这个webapp是遵循Servlet规范的。）</li><li>Servlet规范包括什么呢？<ul><li>规范了哪些接口</li><li>规范了哪些类</li><li>规范了一个web应用中应该有哪些配置文件</li><li>规范了一个web应用中配置文件的名字</li><li>规范了一个web应用中配置文件存放的路径</li><li>规范了一个web应用中配置文件的内容</li><li>规范了一个合法有效的web应用它的目录结构应该是怎样的。</li><li>…..</li></ul></li></ul></li></ul><h2 id="开发一个带有Servlet（Java小程序）的webapp（重点）"><a href="#开发一个带有Servlet（Java小程序）的webapp（重点）" class="headerlink" title="开发一个带有Servlet（Java小程序）的webapp（重点）"></a>开发一个带有Servlet（Java小程序）的webapp（重点）</h2><ul><li><p>开发步骤是怎样的？</p><ul><li><p>第一步：在webapps目录下新建一个目录，起名crm（这个crm就是webapp的名字）。当然，也可以是其它项目，比如银行项目，可以创建一个目录bank，办公系统可以创建一个oa。</p><ul><li>注意：crm就是这个webapp的根</li></ul></li><li><p>第二步：在webapp的根下新建一个目录：WEB-INF</p><ul><li>注意：这个目录的名字是Servlet规范中规定的，必须全部大写，必须一模一样。必须的必须。</li></ul></li><li><p>第三步：在WEB-INF目录下新建一个目录：classes</p><ul><li>注意：这个目录的名字必须是全部小写的classes。这也是Servlet规范中规定的。另外这个目录下一定存放的是Java程序编译之后的class文件（这里存放的是字节码文件）。</li></ul></li><li><p>第四步：在WEB-INF目录下新建一个目录：lib</p><ul><li>注意：这个目录不是必须的。但如果一个webapp需要第三方的jar包的话，这个jar包要放到这个lib目录下，这个目录的名字也不能随意编写，必须是全部小写的lib。例如java语言连接数据库需要数据库的驱动jar包。那么这个jar包就一定要放到lib目录下。这Servlet规范中规定的。</li></ul></li><li><p>第五步：在WEB-INF目录下新建一个文件：web.xml</p><ul><li><p>注意：这个文件是必须的，这个文件名必须叫做web.xml。这个文件必须放在这里。一个合法的webapp，web.xml文件是必须的，这个web.xml文件就是一个配置文件，在这个配置文件中描述了请求路径和Servlet类之间的对照关系。</p></li><li><p>这个文件最好从其他的webapp中拷贝，最好别手写。没必要。复制粘贴</p></li><li><pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;web-app xmlns=&quot;https://jakarta.ee/xml/ns/jakartaee&quot;  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;  xsi:schemaLocation=&quot;https://jakarta.ee/xml/ns/jakartaee                      https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd&quot;  version=&quot;5.0&quot;  metadata-complete=&quot;true&quot;&gt;&lt;/web-app&gt;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 第六步：编写一个Java程序，这个小Java程序也不能随意开发，这个小java程序必须实现Servlet接口。</span><br><span class="line"></span><br><span class="line">  - 这个Servlet接口不在JDK当中。（因为Servlet不是JavaSE了。Servlet属于JavaEE，是另外的一套类库。）</span><br><span class="line">  - Servlet接口（Servlet.class文件）是Oracle提供的。（最原始的是sun公司提供的。）</span><br><span class="line">  - Servlet接口是JavaEE的规范中的一员。</span><br><span class="line">  - Tomcat服务器实现了Servlet规范，所以Tomcat服务器也需要使用Servlet接口。Tomcat服务器中应该有这个接口，Tomcat服务器的CATALINA_HOME\lib目录下有一个servlet-api.jar，解压这个servlet-api.jar之后，你会看到里面有一个Servlet.class文件。</span><br><span class="line">  - 重点：从JakartaEE9开始，Servlet接口的全名变了：jakarta.servlet.Servlet</span><br><span class="line">  - 注意：编写这个Java小程序的时候，java源代码你愿意在哪里就在哪里，位置无所谓，你只需要将java源代码编译之后的class文件放到classes目录下即可。</span><br><span class="line"></span><br><span class="line">- 第七步：编译我们编写的HelloServlet</span><br><span class="line"></span><br><span class="line">  - 重点：你怎么能让你的HelloServlet编译通过呢？配置环境变量CLASSPATH</span><br><span class="line"></span><br><span class="line">    CLASSPATH=.;C:\dev\apache-tomcat-10.0.12\lib\servlet-api.jar</span><br><span class="line"></span><br><span class="line">  - 思考问题：以上配置的CLASSPATH和Tomcat服务器运行有没有关系？</span><br><span class="line"></span><br><span class="line">    - 没有任何关系，以上配置这个环境变量只是为了让你的HelloServlet能够正常编译生成class文件。</span><br><span class="line"></span><br><span class="line">- 第八步：将以上编译之后的HelloServlet.class文件拷贝到WEB-INF\classes目录下。</span><br><span class="line"></span><br><span class="line">- 第九步：在web.xml文件中编写配置信息，让“请求路径”和“Servlet类名”关联在一起。</span><br><span class="line"></span><br><span class="line">  - 这一步用专业术语描述：在web.xml文件中注册Servlet类。</span><br><span class="line"></span><br><span class="line">  - ```xml</span><br><span class="line">    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;web-app xmlns=&quot;https://jakarta.ee/xml/ns/jakartaee&quot;</span><br><span class="line">      xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">      xsi:schemaLocation=&quot;https://jakarta.ee/xml/ns/jakartaee</span><br><span class="line">                          https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd&quot;</span><br><span class="line">      version=&quot;5.0&quot;</span><br><span class="line">      metadata-complete=&quot;true&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!--servlet描述信息--&gt;</span><br><span class="line">    &lt;!--任何一个servlet都对应一个servlet-mapping --&gt;</span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;fdsafdsagfdsafdsa&lt;/servlet-name&gt;</span><br><span class="line">    &lt;!--这个位置必须是带有包名的全限定类名--&gt;</span><br><span class="line">    &lt;servlet-class&gt;com.bjpowernode.servlet.HelloServlet&lt;/servlet-class&gt;</span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!--servlet映射信息--&gt;</span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">    &lt;!--这个也是随便的，不过这里写的内容要和上面的一样。--&gt;</span><br><span class="line">    &lt;servlet-name&gt;fdsafdsagfdsafdsa&lt;/servlet-name&gt;</span><br><span class="line">    &lt;!--这里需要一个路径--&gt;</span><br><span class="line">    &lt;!--这个路径唯一的要求是必须以 / 开始--&gt;</span><br><span class="line">    &lt;!--当前这个路径可以随便写--&gt;</span><br><span class="line">    &lt;url-pattern&gt;/fdsa/fd/saf/d/sa/fd/sa/fd&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;/web-app&gt;</span><br><span class="line">    </span><br></pre></td></tr></table></figure></code></pre></li></ul></li><li><p>第十步：启动Tomcat服务器</p></li><li><p>第十一步：打开浏览器，在浏览器地址栏上输入一个url，这个URL必须是：</p><ul><li><a href="http://127.0.0.1:8080/crm/fdsa/fd/saf/d/sa/fd/sa/fd">http://127.0.0.1:8080/crm/fdsa/fd/saf/d/sa/fd/sa/fd</a>   </li><li>非常重要的一件事：浏览器上的请求路径不能随便写，这个请求路径必须和web.xml文件中的url-pattern一致。</li><li>注意：浏览器上的请求路径和web.xml文件中的url-pattern的唯一区别就是：浏览器上的请求路径带项目名：&#x2F;crm（也就是新建文件夹时取得那个名）</li></ul></li><li><p>浏览器上编写的路径太复杂，可以使用超链接。（<strong>非常重要：html页面只能放到WEB-INF目录外面。</strong>）</p></li><li><p>以后不需要我们编写main方法了。tomcat服务器负责调用main方法，Tomcat服务器启动的时候执行的就是main方法。我们javaweb程序员只需要编写Servlet接口的实现类，然后将其注册到web.xml文件中，即可。</p></li><li><p>总结一下：一个合法的webapp目录结构应该是怎样的？</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">webapproot</span><br><span class="line">     |------WEB-INF</span><br><span class="line">       |------classes(存放字节码)</span><br><span class="line">       |------lib(第三方jar包)</span><br><span class="line">       |------web.xml(注册Servlet)</span><br><span class="line">     |------html</span><br><span class="line">     |------css</span><br><span class="line">     |------javascript</span><br><span class="line">     |------image</span><br><span class="line">     ....</span><br></pre></td></tr></table></figure></li><li><p>浏览器发送请求，到最终服务器调用Servlet中的方法，是怎样的一个过程？（以下这个过程描述的很粗糙。其中还有很多步骤我省略了。）</p><ul><li>用户输入URL，或者直接点击超链接：<a href="http://127.0.0.1:8080/crm/fdsa/fd/saf/d/sa/fd/sa/fd">http://127.0.0.1:8080/crm/fdsa/fd/saf/d/sa/fd/sa/fd</a>  </li><li>然后Tomcat服务器接收到请求，截取路径：&#x2F;crm&#x2F;fdsa&#x2F;fd&#x2F;saf&#x2F;d&#x2F;sa&#x2F;fd&#x2F;sa&#x2F;fd  </li><li>Tomcat服务器找到crm项目</li><li>Tomcat服务器在web.xml文件中查找&#x2F;fdsa&#x2F;fd&#x2F;saf&#x2F;d&#x2F;sa&#x2F;fd&#x2F;sa&#x2F;fd  对应的Servlet是：com.bjpowernode.servlet.HelloServlet</li><li>Tomcat服务器通过反射机制，创建com.bjpowernode.servlet.HelloServlet的对象。</li><li>Tomcat服务器调用com.bjpowernode.servlet.HelloServlet对象的service方法。</li></ul></li></ul></li></ul><h2 id="关于JavaEE的版本"><a href="#关于JavaEE的版本" class="headerlink" title="关于JavaEE的版本"></a>关于JavaEE的版本</h2><ul><li>JavaEE目前最高版本是 JavaEE8</li><li>JavaEE被Oracle捐献了，Oracle将JavaEE规范捐献给Apache了。</li><li>Apache把JavaEE换名了，以后不叫JavaEE了，以后叫做 jakarta EE。</li><li>以后没有JavaEE了。以后都叫做Jakarta EE。</li><li>JavaEE8版本升级之后的”JavaEE 9”，不再是”JavaEE9”这个名字了，叫做JakartaEE9</li><li>JavaEE8的时候对应的Servlet类名是：javax.servlet.Servlet</li><li>JakartaEE9的时候对应的Servlet类名是：jakarta.servlet.Servlet （包名都换了）</li><li>如果你之前的项目还是在使用javax.servlet.Servlet，那么你的项目无法直接部署到Tomcat10+版本上。你只能部署到Tomcat9-版本上。在Tomcat9以及Tomcat9之前的版本中还是能够识别javax.servlet这个包。</li></ul><h2 id="解决Tomcat服务器在DOS命令窗口中的乱码问题（控制台乱码）"><a href="#解决Tomcat服务器在DOS命令窗口中的乱码问题（控制台乱码）" class="headerlink" title="解决Tomcat服务器在DOS命令窗口中的乱码问题（控制台乱码）"></a>解决Tomcat服务器在DOS命令窗口中的乱码问题（控制台乱码）</h2><p>将CATALINA_HOME&#x2F;conf&#x2F;logging.properties文件中的内容修改如下：</p><p>java.util.logging.ConsoleHandler.encoding &#x3D; GBK</p><h2 id="向浏览器响应一段HTML代码"><a href="#向浏览器响应一段HTML代码" class="headerlink" title="向浏览器响应一段HTML代码"></a>向浏览器响应一段HTML代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest request, ServletResponse response)</span>&#123;</span><br><span class="line">    <span class="comment">//设置内容类型，就可以把下面的字符串以html语言显示</span></span><br><span class="line">    response.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">    <span class="comment">//这个输出流不需要刷新关闭，由tomcat维护</span></span><br><span class="line">    <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">    out.print(<span class="string">&quot;&lt;h1&gt;hello servlet!&lt;/h1&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="在Servlet中连接数据库，怎么做？"><a href="#在Servlet中连接数据库，怎么做？" class="headerlink" title="在Servlet中连接数据库，怎么做？"></a>在Servlet中连接数据库，怎么做？</h2><ul><li>Servlet是Java程序，所以在Servlet中完全可以编写JDBC代码连接数据库。</li><li>在一个webapp中去连接数据库，需要将驱动jar包放到WEB-INF&#x2F;lib目录下。（com.mysql.cj.jdbc.Driver 这个类就在驱动jar包当中。）</li></ul><h2 id="在集成开发环境当中开发Servlet程序"><a href="#在集成开发环境当中开发Servlet程序" class="headerlink" title="在集成开发环境当中开发Servlet程序"></a>在集成开发环境当中开发Servlet程序</h2><ul><li><p>集成开发工具很多，其中目前使用比较多的是：</p><ul><li>IntelliJ IDEA（这个居多，IDEA在提示功能方面要强于Eclipse，也就是说IDEA使用起来比Eclipse更加智能，更好用。JetBrain公司开发的。收费的。）</li><li>Eclipse（这个少一些），Eclipse目前还是有团队使用，只不过处于减少的趋势，自己从事工作之后，可能会遇到。Eclipse是IBM团队开发的。Eclipse寓意是“日食”。“日食”表示将太阳吃掉。太阳是SUN。IBM团队开发Eclipse的寓意是吞并SUN公司，但是2009年的时候SUN公司被Oracle公司并购了。IBM并没有成功并购SUN公司。</li></ul></li><li><p>使用IDEA集成开发工具开发Servlet</p><ul><li>第一步：New Project（我比较习惯先创建一个Empty Project【空工程】，然后在空工程下新建Module【模块】，这不是必须的，只是一种习惯，你可以直接新建非空的Project），这个Empty Project起名为：javaweb（不是必须的，只是一个名字而已。一般情况下新建的Project的名字最好和目录的名字一致。）</li><li>第二步：新建模块（File –&gt; new –&gt; Module…）<ul><li>这里新建的是一个普通的JavaSE模块（这里先不要新建Java Enterprise模块）</li><li>这个Module自动会被放在javaweb的project下面。</li><li>这个Module起名：servlet01</li></ul></li><li>第三步：让Module变成JavaEE的模块。（让Module变成webapp的模块。符合webapp规范。符合Servlet规范的Module）<ul><li>在Module上点击右键：Add Framework Support…（添加框架支持）</li><li>在弹出的窗口中，选择Web Application（选择的是webapp的支持）</li><li>选择了这个webapp的支持之后，IDEA会自动给你生成一个符合Servlet规范的webpp目录结构。</li><li><strong>重点，需要注意的：在IDEA工具中根据Web Application模板生成的目录中有一个web目录，这个目录就代表webapp的根</strong>（比如之前的crm目录）</li></ul></li><li>第四步（非必须）：根据Web Application生成的资源中有index.jsp文件，这里我选择删除这个index.jsp文件。</li><li>第五步：编写Servlet（StudentServlet）<ul><li>class StudentServlet implements Servlet</li><li>这个时候发现Servlet.class文件没有。怎么办？将CATALINA_HOME&#x2F;lib&#x2F;servlet-api.jar和jsp-api.jar添加到classpath当中（这里的classpath说的是IDEA的classpath）<ul><li>File –&gt; Project Structrue –&gt; Modules –&gt; + 加号 –&gt; Add JARS….</li></ul></li><li>实现jakarta.servlet.Servlet接口中的5个方法。</li></ul></li><li>第六步：在Servlet当中的service方法中编写业务代码（我们这里连接数据库了。）</li><li>第七步：在WEB-INF目录下新建了一个子目录：lib（这个目录名可不能随意，必须是全部小写的lib），并且将连接数据库的驱动jar（mysql-connector-java-8.0.27.jar）包放到lib目录下。</li><li>第八步：在web.xml文件中完成StudentServlet类的注册。（请求路径和Servlet之间对应起来）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;web-app xmlns=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="line">         version=<span class="string">&quot;4.0&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;studentServlet&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-class&gt;com.bjpowernode.javaweb.servlet.StudentServlet&lt;/servlet-class&gt;</span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;studentServlet&lt;/servlet-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/servlet/student&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure><ul><li><p>第九步：给一个html页面，在HTML页面中编写一个超链接，用户点击这个超链接，发送请求，Tomcat执行后台的StudentServlet。</p><ul><li><p>student.html</p></li><li><p>这个文件不能放到WEB-INF目录里面，只能放到WEB-INF目录外面。</p></li><li><p>student.html文件的内容</p></li><li><pre><code class="language-html">&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot;&gt;    &lt;title&gt;student page&lt;/title&gt;&lt;/head&gt;&lt;body&gt;    &lt;!--这里的项目名是 /xmm ，无法动态获取，先写死--&gt;    &lt;a href=&quot;/xmm/servlet/student&quot;&gt;student list&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">  - 第十步：让IDEA工具去关联Tomcat服务器。关联的过程当中将webapp部署到Tomcat服务器当中。</span><br><span class="line"></span><br><span class="line">    - IDEA工具右上角，绿色小锤子右边有一个：Add Configuration</span><br><span class="line">    - 左上角加号，点击Tomcat Server --&gt; local</span><br><span class="line">    - 在弹出的界面中设置服务器Server的参数（基本上不用动）</span><br><span class="line">    - 在当前窗口中有一个Deployment（点击这个用来部署webapp），继续点击加号，部署即可。</span><br><span class="line">    - 修改 Application context为：/xmm</span><br><span class="line"></span><br><span class="line">  - 第十一步：启动Tomcat服务器</span><br><span class="line"></span><br><span class="line">    - 在右上角有绿色的箭头，或者绿色的小虫子，点击这个绿色的小虫子，可以采用debug的模式启动Tomcat服务器。</span><br><span class="line">    - 我们开发中建议适用debug模式启动Tomcat</span><br><span class="line"></span><br><span class="line">  - 第十二步：打开浏览器，在浏览器地址栏上输入：http://localhost:8080/xmm/student.html</span><br><span class="line"></span><br><span class="line">## Servlet对象的生命周期</span><br><span class="line"></span><br><span class="line">- 什么是Servlet对象生命周期？</span><br><span class="line"></span><br><span class="line">  - Servlet对象什么时候被创建。</span><br><span class="line">  - Servlet对象什么时候被销毁。</span><br><span class="line">  - Servlet对象创建了几个？</span><br><span class="line">  - Servlet对象的生命周期表示：一个Servlet对象从出生在最后的死亡，整个过程是怎样的。</span><br><span class="line"></span><br><span class="line">- Servlet对象是由谁来维护的？</span><br><span class="line"></span><br><span class="line">  - Servlet对象的创建，对象上方法的调用，对象最终的销毁，Javaweb程序员是无权干预的。</span><br><span class="line">  - Servlet对象的生命周期是由Tomcat服务器（WEB Server）全权负责的。</span><br><span class="line">  - Tomcat服务器通常我们又称为：WEB容器。（这个叫法你要知道【WEB Container】）</span><br><span class="line">  - WEB容器来管理Servlet对象的死活。</span><br><span class="line"></span><br><span class="line">- 思考：我们自己new的Servlet对象受WEB容器的管理吗？</span><br><span class="line"></span><br><span class="line">  - 我们自己new的Servlet对象是不受WEB容器管理的。</span><br><span class="line">  - WEB容器创建的Servlet对象，这些Servlet对象都会被放到一个集合当中（HashMap），只有放到这个HashMap集合中的Servlet才能够被WEB容器管理，自己new的Servlet对象不会被WEB容器管理。（自己new的Servlet对象不在容器当中）</span><br><span class="line">  - web容器底层应该有一个HashMap这样的集合，在这个集合当中存储了Servlet对象和请求路径之间的关系</span><br><span class="line">  - ![WEB容器中的Map集合](./images/Servlet-JSP-课堂笔记/WEB容器中的Map集合.png)</span><br><span class="line"></span><br><span class="line">- 研究：服务器在启动的Servlet对象有没有被创建出来（默认情况下）？</span><br><span class="line"></span><br><span class="line">  - 在Servlet中提供一个无参数的构造方法，启动服务器的时候看看构造方法是否执行。</span><br><span class="line">  - 经过测试得出结论：默认情况下，服务器在启动的时候Servlet对象并不会被实例化。</span><br><span class="line">  - 这个设计是合理的。用户没有发送请求之前，如果提前创建出来所有的Servlet对象，必然是耗费内存的，并且创建出来的Servlet如果一直没有用户访问，显然这个Servlet对象是一个废物，没必要先创建。</span><br><span class="line"></span><br><span class="line">- 怎么让服务器启动的时候创建Servlet对象呢？</span><br><span class="line"></span><br><span class="line">  - 在servlet标签中添加&lt;load-on-startup&gt;子标签，在该子标签中填写整数，越小的整数优先级越高。</span><br><span class="line"></span><br><span class="line">  - ```xml</span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;aservlet&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-class&gt;com.bjpowernode.javaweb.servlet.AServlet&lt;/servlet-class&gt;</span><br><span class="line">        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;aservlet&lt;/servlet-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/a&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure></code></pre></li></ul></li></ul></li><li><p>Servlet对象生命周期</p><ul><li><p>默认情况下服务器启动的时候AServlet对象并没有被实例化</p></li><li><p>用户发送第一次请求的时候，控制台输出了以下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AServlet无参数构造方法执行了</span><br><span class="line">AServlet&#x27;s init method execute!</span><br><span class="line">AServlet&#x27;s service method execute!</span><br></pre></td></tr></table></figure></li><li><p>根据以上输出内容得出结论：</p><ul><li>用户在发送第一次请求的时候Servlet对象被实例化（AServlet的构造方法被执行了。并且执行的是无参数构造方法。）</li><li>AServlet对象被创建出来之后，Tomcat服务器马上调用了AServlet对象的init方法。（init方法在执行的时候，AServlet对象已经存在了。已经被创建出来了。）</li><li>用户发送第一次请求的时候，init方法执行之后，Tomcat服务器马上调用AServlet对象的service方法。</li></ul></li><li><p>用户继续发送第二次请求，控制台输出了以下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AServlet&#x27;s service method execute!</span><br></pre></td></tr></table></figure></li><li><p>根据以上输出结果得知，用户在发送第二次，或者第三次，或者第四次请求的时候，Servlet对象并没有新建，还是使用之前创建好的Servlet对象，直接调用该Servlet对象的service方法，这说明：</p><ul><li>第一：Servlet对象是单例的（单实例的。但是要注意：Servlet对象是单实例的，但是Servlet类并不符合单例模式。我们称之为假单例。之所以单例是因为Servlet对象的创建我们javaweb程序员管不着，这个对象的创建只能是Tomcat来说了算，Tomcat只创建了一个，所以导致了单例，但是属于假单例。真单例模式，构造方法是私有化的。）</li><li>第二：无参数构造方法、init方法只在第一次用户发送请求的时候执行。也就是说无参数构造方法只执行一次。init方法也只被Tomcat服务器调用一次。</li><li>第三：只要用户发送一次请求：service方法必然会被Tomcat服务器调用一次。发送100次请求，service方法会被调用100次。</li></ul></li><li><p>关闭服务器的时候，控制台输出了以下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AServlet&#x27;s destroy method execute!</span><br></pre></td></tr></table></figure></li><li><p>通过以上输出内容，可以得出以下结论：</p><ul><li>Servlet的destroy方法只被Tomcat服务器调用一次。</li><li>destroy方法是在什么时候被调用的？<ul><li>在服务器关闭的时候。</li><li>因为服务器关闭的时候要销毁AServlet对象的内存。</li><li>服务器在销毁AServlet对象内存之前，Tomcat服务器会自动调用AServlet对象的destroy方法。</li></ul></li></ul></li><li><p>请问：destroy方法调用的时候，对象销毁了还是没有销毁呢？</p><ul><li>destroy方法执行的时候AServlet对象还在，没有被销毁。destroy方法执行结束之后，AServlet对象的内存才会被Tomcat释放。</li></ul></li><li><p>Servlet对象更像一个人的一生：</p><ul><li>Servlet的无参数构造方法执行：标志着你出生了。</li><li>Servlet对象的init方法的执行：标志着你正在接受教育。</li><li>Servlet对象的service方法的执行：标志着你已经开始工作了，已经开始为人类提供服务了。</li><li>Servlet对象的destroy方法的执行：标志着临终。有什么遗言，抓紧的。要不然，来不及了。</li></ul></li><li><p>关于Servlet类中方法的调用次数？</p><ul><li>构造方法只执行一次。</li><li>init方法只执行一次。</li><li>service方法：用户发送一次请求则执行一次，发送N次请求则执行N次。</li><li>destroy方法只执行一次。</li></ul></li><li><p>当我们Servlet类中编写一个有参数的构造方法，如果没有手动编写无参数构造方法会出现什么问题？</p><ul><li>报错了：500错误。</li><li>注意：500是一个HTTP协议的错误状态码。</li><li>500一般情况下是因为服务器端的Java程序出现了异常。（服务器端的错误都是500错误：服务器内部错误。）</li><li>如果没有无参数的构造方法，会导致出现500错误，无法实例化Servlet对象。</li><li>所以，一定要注意：在Servlet开发当中，不建议程序员来定义构造方法，因为定义不当，一不小心就会导致无法实例化Servlet对象。</li></ul></li><li><p>思考：Servlet的无参数构造方法是在对象第一次创建的时候执行，并且只执行一次。init方法也是在对象第一次创建的时候执行，并且只执行一次。那么这个无参数构造方法可以代替掉init方法吗？</p><ul><li>不能。</li><li>Servlet规范中有要求，作为javaweb程序员，编写Servlet类的时候，不建议手动编写构造方法，因为编写构造方法，很容易让无参数构造方法消失，这个操作可能会导致Servlet对象无法实例化。所以init方法是有存在的必要的。</li></ul></li><li><p>init、service、destroy方法中使用最多的是哪个方法？</p><ul><li>使用最多就是service方法，service方法是一定要实现的，因为service方法是处理用户请求的核心方法。</li><li>什么时候使用init方法呢？<ul><li>init方法很少用。</li><li>通常在init方法当中做初始化操作，并且这个初始化操作只需要执行一次。例如：初始化数据库连接池，初始化线程池….</li></ul></li><li>什么时候使用destroy方法呢？<ul><li>destroy方法也很少用。</li><li>通常在destroy方法当中，进行资源的关闭。马上对象要被销毁了，还有什么没有关闭的，抓紧时间关闭资源。还有什么资源没保存的，抓紧时间保存一下。</li></ul></li></ul></li></ul></li></ul><h2 id="GenericServlet"><a href="#GenericServlet" class="headerlink" title="GenericServlet"></a>GenericServlet</h2><ul><li><p>我们编写一个Servlet类直接实现Servlet接口有什么缺点？</p><ul><li>我们只需要service方法，其他方法大部分情况下是不需要使用的。代码很丑陋。</li></ul></li><li><p>适配器设计模式Adapter</p><ul><li>手机直接插到220V的电压上，手机直接就报废了。怎么办？可以找一个充电器。这个充电器就是一个适配器。手机连接适配器。适配器连接220V的电压。这样问题就解决了。</li></ul></li><li><p>编写一个GenericServlet类，这个类是一个抽象类，其中有一个抽象方法service。</p><ul><li>GenericServlet实现Servlet接口。</li><li>GenericServlet是一个适配器。</li><li>以后编写的所有Servlet类继承GenericServlet，重写service方法即可。</li></ul></li><li><p>思考：GenericServlet类是否需要改造一下？怎么改造？更利于子类程序的编写？</p><ul><li><p>思考第一个问题：我提供了一个GenericServlet之后，init方法还会执行吗？</p><ul><li>还会执行。会执行GenericServlet类中的init方法。</li></ul></li><li><p>思考第二个问题：init方法是谁调用的？</p><ul><li>Tomcat服务器调用的。</li></ul></li><li><p>思考第三个问题：init方法中的ServletConfig对象是谁创建的？是谁传过来的？</p><ul><li>都是Tomcat干的。</li><li>Tomcat服务器先创建了ServletConfig对象，然后调用init方法，将ServletConfig对象传给了init方法。</li></ul></li><li><p>思考一下Tomcat服务器伪代码：</p><ul><li><pre><code class="language-java">public class Tomcat {    public static void main(String[] args){        // .....        // Tomcat服务器伪代码        // 创建LoginServlet对象（通过反射机制，调用无参数构造方法来实例化LoginServlet对象）        Class clazz = Class.forName(&quot;com.bjpowernode.javaweb.servlet.LoginServlet&quot;);        Object obj = clazz.newInstance();                // 向下转型        Servlet servlet = (Servlet)obj;                // 创建ServletConfig对象        // Tomcat服务器负责将ServletConfig对象实例化出来。        // 多态（Tomcat服务器完全实现了Servlet规范）        ServletConfig servletConfig = new org.apache.catalina.core.StandardWrapperFacade();                // 调用Servlet的init方法        servlet.init(servletConfig);                // 调用Servlet的service方法        // ....            }}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## ServletConfig</span><br><span class="line"></span><br><span class="line">- 什么是ServletConfig？</span><br><span class="line"></span><br><span class="line">  - Servlet对象的配置信息对象。</span><br><span class="line">  - ServletConfig对象中封装了&lt;servlet&gt;&lt;/servlet&gt;标签中的配置信息。（web.xml文件中servlet的配置信息）</span><br><span class="line"></span><br><span class="line">- 一个Servlet对应一个ServletConfig对象。</span><br><span class="line"></span><br><span class="line">- Servlet对象是Tomcat服务器创建，并且ServletConfig对象也是Tomcat服务器创建。并且默认情况下，他们都是在用户发送第一次请求的时候创建。</span><br><span class="line"></span><br><span class="line">- Tomcat服务器调用Servlet对象的init方法的时候需要传一个ServletConfig对象的参数给init方法。</span><br><span class="line"></span><br><span class="line">- ServletConfig接口的实现类是Tomcat服务器给实现的。（Tomcat服务器说的就是WEB服务器。）</span><br><span class="line"></span><br><span class="line">- ServletConfig接口有哪些常用的方法？</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    public String getInitParameter(String name); // 通过初始化参数的name获取value</span><br><span class="line">    public Enumeration&lt;String&gt; getInitParameterNames(); // 获取所有的初始化参数的name</span><br><span class="line">    public ServletContext getServletContext(); // 获取ServletContext对象</span><br><span class="line">    public String getServletName(); // 获取Servlet的name</span><br></pre></td></tr></table></figure></code></pre></li></ul></li><li><p>以上方法在Servlet类当中，都可以使用this去调用。因为GenericServlet实现了ServletConfig接口。</p></li></ul></li></ul><h2 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h2><ul><li><p>一个Servlet对象对应一个ServletConfig。100个Servlet对象则对应100个ServletConfig对象。</p></li><li><p>只要在同一个webapp当中，只要在同一个应用当中，所有的Servlet对象都是共享同一个ServletContext对象的。</p></li><li><p>ServletContext对象在服务器启动阶段创建，在服务器关闭的时候销毁。这就是ServletContext对象的生命周期。ServletContext对象是应用级对象。</p></li><li><p>Tomcat服务器中有一个webapps，这个webapps下可以存放webapp，可以存放多个webapp，假设有100个webapp，那么就有100个ServletContext对象。但是，总之，一个应用，一个webapp肯定是只有一个ServletContext对象。</p></li><li><p>ServletContext被称为Servlet上下文对象。（Servlet对象的四周环境对象。）</p></li><li><p>一个ServletContext对象通常对应的是一个web.xml文件。</p></li><li><p>ServletContext对应显示生活中的什么例子呢？</p><ul><li>一个教室里有多个学生，那么每一个学生就是一个Servlet，这些学生都在同一个教室当中，那么我们可以把这个教室叫做ServletContext对象。那么也就是说放在这个ServletContext对象（环境）当中的数据，在同一个教室当中，物品都是共享的。比如：教室中有一个空调，所有的学生都可以操作。可见，空调是共享的。因为空调放在教室当中。教室就是ServletContext对象。</li></ul></li><li><p>ServletContext是一个接口，Tomcat服务器对ServletContext接口进行了实现。</p><ul><li>ServletContext对象的创建也是Tomcat服务器来完成的。启动webapp的时候创建的。</li></ul></li><li><p>ServletContext接口中有哪些常用的方法？</p><ul><li><pre><code class="language-java">public String getInitParameter(String name); // 通过初始化参数的name获取valuepublic Enumeration&lt;String&gt; getInitParameterNames(); // 获取所有的初始化参数的name<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```xml</span><br><span class="line">  &lt;!--以上两个方法是ServletContext对象的方法，这个方法获取的是什么信息？是以下的配置信息--&gt;</span><br><span class="line">  &lt;context-param&gt;</span><br><span class="line">      &lt;param-name&gt;pageSize&lt;/param-name&gt;</span><br><span class="line">      &lt;param-value&gt;10&lt;/param-value&gt;</span><br><span class="line">  &lt;/context-param&gt;</span><br><span class="line">  &lt;context-param&gt;</span><br><span class="line">      &lt;param-name&gt;startIndex&lt;/param-name&gt;</span><br><span class="line">      &lt;param-value&gt;0&lt;/param-value&gt;</span><br><span class="line">  &lt;/context-param&gt;</span><br><span class="line">  &lt;!--注意：以上的配置信息属于应用级的配置信息，一般一个项目中共享的配置信息会放到以上的标签当中。--&gt;</span><br><span class="line">  &lt;!--如果你的配置信息只是想给某一个servlet作为参考，那么你配置到servlet标签当中即可，使用ServletConfig对象来获取。--&gt;</span><br></pre></td></tr></table></figure></code></pre></li><li><pre><code class="language-java">// 获取应用的根路径（非常重要），因为在java源代码当中有一些地方可能会需要应用的根路径，这个方法可以动态获取应用的根路径// 在java源码当中，不要将应用的根路径写死，因为你永远都不知道这个应用在最终部署的时候，起一个什么名字。public String getContextPath();//String contextPath = application.getContextPath();<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">  // 获取文件的绝对路径（真实路径）</span><br><span class="line">  public String getRealPath(String path);</span><br></pre></td></tr></table></figure></code></pre></li><li><pre><code class="language-java">// 通过ServletContext对象也是可以记录日志的public void log(String message);public void log(String message, Throwable t);// 这些日志信息记录到哪里了？// localhost.2021-11-05.log// Tomcat服务器的logs目录下都有哪些日志文件？//catalina.2021-11-05.log 服务器端的java程序运行的控制台信息。//localhost.2021-11-05.log ServletContext对象的log方法记录的日志信息存储到这个文件中。//localhost_access_log.2021-11-05.txt 访问日志<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">  // ServletContext对象还有另一个名字：应用域（后面还有其他域，例如：请求域、会话域）</span><br><span class="line">  </span><br><span class="line">  // 如果所有的用户共享一份数据，并且这个数据很少的被修改，并且这个数据量很少，可以将这些数据放到ServletContext这个应用域中</span><br><span class="line">  </span><br><span class="line">  // 为什么是所有用户共享的数据？ 不是共享的没有意义。因为ServletContext这个对象只有一个。只有共享的数据放进去才有意义。</span><br><span class="line">  </span><br><span class="line">  // 为什么数据量要小？ 因为数据量比较大的话，太占用堆内存，并且这个对象的生命周期比较长，服务器关闭的时候，这个对象才会被销毁。大数据量会影响服务器的性能。占用内存较小的数据量可以考虑放进去。</span><br><span class="line">  </span><br><span class="line">  // 为什么这些共享数据很少的修改，或者说几乎不修改？</span><br><span class="line">  // 所有用户共享的数据，如果涉及到修改操作，必然会存在线程并发所带来的安全问题。所以放在ServletContext对象中的数据一般都是只读的。</span><br><span class="line">  </span><br><span class="line">  // 数据量小、所有用户共享、又不修改，这样的数据放到ServletContext这个应用域当中，会大大提升效率。因为应用域相当于一个缓存，放到缓存中的数据，下次在用的时候，不需要从数据库中再次获取，大大提升执行效率。</span><br><span class="line">  </span><br><span class="line">  // 存（怎么向ServletContext应用域中存数据）</span><br><span class="line">  public void setAttribute(String name, Object value); // map.put(k, v)</span><br><span class="line">  // 取（怎么从ServletContext应用域中取数据）</span><br><span class="line">  public Object getAttribute(String name); // Object v = map.get(k)</span><br><span class="line">  // 删（怎么删除ServletContext应用域中的数据）</span><br><span class="line">  public void removeAttribute(String name); // map.remove(k)</span><br><span class="line">  </span><br><span class="line">  </span><br></pre></td></tr></table></figure></code></pre></li></ul></li><li><p>注意：以后我们编写Servlet类的时候，实际上是不会去直接继承GenericServlet类的，因为我们是B&#x2F;S结构的系统，这种系统是基于HTTP超文本传输协议的，在Servlet规范当中，提供了一个类叫做HttpServlet，它是专门为HTTP协议准备的一个Servlet类。我们编写的Servlet类要继承HttpServlet。（HttpServlet是HTTP协议专用的。）使用HttpServlet处理HTTP协议更便捷。但是你需要直到它的继承结构：</p><ul><li><pre><code>jakarta.servlet.Servlet（接口）【爷爷】jakarta.servlet.GenericServlet implements Servlet（抽象类）【儿子】jakarta.servlet.http.HttpServlet extends GenericServlet（抽象类）【孙子】我们以后编写的Servlet要继承HttpServlet类。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 大家到目前为止都接触过哪些缓存机制了？</span><br><span class="line"></span><br><span class="line">  - 堆内存当中的字符串常量池。</span><br><span class="line">    - &quot;abc&quot; 先在字符串常量池中查找，如果有，直接拿来用。如果没有则新建，然后再放入字符串常量池。</span><br><span class="line">  - 堆内存当中的整数型常量池。</span><br><span class="line">    - [-128 ~ 127] 一共256个Integer类型的引用，放在整数型常量池中。没有超出这个范围的话，直接从常量池中取。</span><br><span class="line">  - 连接池(Connection Cache)</span><br><span class="line">    - 这里所说的连接池中的连接是java语言连接数据库的连接对象：java.sql.Connection对象。</span><br><span class="line">    - JVM是一个进程。MySQL数据库是一个进程。进程和进程之间建立连接，打开通道是很费劲的。是很耗费资源的。怎么办？可以提前先创建好N个Connection连接对象，将连接对象放到一个集合当中，我们把这个放有Connection对象的集合称为连接池。每一次用户连接的时候不需要再新建连接对象，省去了新建的环节，直接从连接池中获取连接对象，大大提升访问效率。</span><br><span class="line">    - 连接池</span><br><span class="line">      - 最小连接数</span><br><span class="line">      - 最大连接数</span><br><span class="line">      - 连接池可以提高用户的访问效率。当然也可以保证数据库的安全性。</span><br><span class="line">  - 线程池</span><br><span class="line">    - Tomcat服务器本身就是支持多线程的。</span><br><span class="line">    - Tomcat服务器是在用户发送一次请求，就新建一个Thread线程对象吗？</span><br><span class="line">      - 当然不是，实际上是在Tomcat服务器启动的时候，会先创建好N多个线程Thread对象，然后将线程对象放到集合当中，称为线程池。用户发送请求过来之后，需要有一个对应的线程来处理这个请求，这个时候线程对象就会直接从线程池中拿，效率比较高。</span><br><span class="line">      - 所有的WEB服务器，或者应用服务器，都是支持多线程的，都有线程池机制。</span><br><span class="line">  - redis</span><br><span class="line">    - NoSQL数据库。非关系型数据库。缓存数据库。</span><br><span class="line">  - 向ServletContext应用域中存储数据，也等于是将数据存放到缓存cache当中了。</span><br><span class="line"></span><br><span class="line">## HTTP协议</span><br><span class="line"></span><br><span class="line">- 什么是协议？</span><br><span class="line"></span><br><span class="line">  - 协议实际上是某些人，或者某些组织提前制定好的一套规范，大家都按照这个规范来，这样可以做到沟通无障碍。</span><br><span class="line">  - 协议就是一套规范，就是一套标准。由其他人或其他组织来负责制定的。</span><br><span class="line">  - 我说的话你能听懂，你说的话，我也能听懂，这说明我们之间是有一套规范的，一套协议的，这套协议就是：中国普通话协议。我们都遵守这套协议，我们之间就可以沟通无障碍。</span><br><span class="line"></span><br><span class="line">- 什么是HTTP协议？</span><br><span class="line"></span><br><span class="line">  - HTTP协议：是W3C制定的一种超文本传输协议。（通信协议：发送消息的模板提前被制定好。）</span><br><span class="line">  - W3C：</span><br><span class="line">    - 万维网联盟组织</span><br><span class="line">    - 负责制定标准的：HTTP HTML4.0 HTML5 XML DOM等规范都是W3C制定的。</span><br><span class="line">    - 万维网之父：蒂姆·伯纳斯·李</span><br><span class="line">  - 什么是超文本？</span><br><span class="line">    - 超文本说的就是：不是普通文本，比如流媒体：声音、视频、图片等。</span><br><span class="line">    - HTTP协议支持：不但可以传送普通字符串，同样支持传递声音、视频、图片等流媒体信息。</span><br><span class="line">  - 这种协议游走在B和S之间。B向S发数据要遵循HTTP协议。S向B发数据同样需要遵循HTTP协议。这样B和S才能解耦合。</span><br><span class="line">  - 什么是解耦合？</span><br><span class="line">    - B不依赖S。</span><br><span class="line">    - S也不依赖B。</span><br><span class="line">  - B/S表示：B/S结构的系统（浏览器访问WEB服务器的系统）</span><br><span class="line">  - 浏览器   向   WEB服务器发送数据，叫做：请求（request)</span><br><span class="line">  - WEB服务器   向   浏览器发送数据，叫做：响应（response）</span><br><span class="line">  - HTTP协议包括：</span><br><span class="line">    - 请求协议</span><br><span class="line">      - 浏览器  向   WEB服务器发送数据的时候，这个发送的数据需要遵循一套标准，这套标准中规定了发送的数据具体格式。</span><br><span class="line">    - 响应协议</span><br><span class="line">      - WEB服务器  向  浏览器发送数据的时候，这个发送的数据需要遵循一套标准，这套标准中规定了发送的数据具体格式。</span><br><span class="line">  - HTTP协议就是提前制定好的一种消息模板。</span><br><span class="line">    - 不管你是哪个品牌的浏览器，都是这么发。</span><br><span class="line">    - 不管你是哪个品牌的WEB服务器，都是这么发。</span><br><span class="line">    - FF浏览器  可以向 Tomcat发送请求，也可以向Jetty服务器发送请求。浏览器不依赖具体的服务器品牌。</span><br><span class="line">    - WEB服务器也不依赖具体的浏览器品牌。可以是FF浏览器，也可以是Chrome浏览器，可以是IE，都行。</span><br><span class="line"></span><br><span class="line">- HTTP的请求协议（B --&gt; S）</span><br><span class="line"></span><br><span class="line">  - HTTP的请求协议包括：4部分</span><br><span class="line"></span><br><span class="line">    - 请求行</span><br><span class="line">    - 请求头</span><br><span class="line">    - 空白行</span><br><span class="line">    - 请求体</span><br><span class="line"></span><br><span class="line">  - HTTP请求协议的具体报文：GET请求</span><br><span class="line"></span><br><span class="line">    - ```</span><br><span class="line">      GET /servlet05/getServlet?username=lucy&amp;userpwd=1111 HTTP/1.1                           请求行</span><br><span class="line">      Host: localhost:8080                                                                    请求头</span><br><span class="line">      Connection: keep-alive</span><br><span class="line">      sec-ch-ua: &quot;Google Chrome&quot;;v=&quot;95&quot;, &quot;Chromium&quot;;v=&quot;95&quot;, &quot;;Not A Brand&quot;;v=&quot;99&quot;</span><br><span class="line">      sec-ch-ua-mobile: ?0</span><br><span class="line">      sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">      Upgrade-Insecure-Requests: 1</span><br><span class="line">      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36</span><br><span class="line">      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">      Sec-Fetch-Site: same-origin</span><br><span class="line">      Sec-Fetch-Mode: navigate</span><br><span class="line">      Sec-Fetch-User: ?1</span><br><span class="line">      Sec-Fetch-Dest: document</span><br><span class="line">      Referer: http://localhost:8080/servlet05/index.html</span><br><span class="line">      Accept-Encoding: gzip, deflate, br</span><br><span class="line">      Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">                                                                                              空白行</span><br><span class="line">                                                                                              请求体</span><br></pre></td></tr></table></figure></code></pre></li><li><p>HTTP请求协议的具体报文：POST请求</p><ul><li><pre><code>POST /servlet05/postServlet HTTP/1.1                                                  请求行Host: localhost:8080                                                                  请求头Connection: keep-aliveContent-Length: 25Cache-Control: max-age=0sec-ch-ua: &quot;Google Chrome&quot;;v=&quot;95&quot;, &quot;Chromium&quot;;v=&quot;95&quot;, &quot;;Not A Brand&quot;;v=&quot;99&quot;sec-ch-ua-mobile: ?0sec-ch-ua-platform: &quot;Windows&quot;Upgrade-Insecure-Requests: 1Origin: http://localhost:8080Content-Type: application/x-www-form-urlencodedUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Sec-Fetch-Site: same-originSec-Fetch-Mode: navigateSec-Fetch-User: ?1Sec-Fetch-Dest: documentReferer: http://localhost:8080/servlet05/index.htmlAccept-Encoding: gzip, deflate, brAccept-Language: zh-CN,zh;q=0.9                                                                                      空白行username=lisi&amp;userpwd=123                                                             请求体<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 请求行</span><br><span class="line"></span><br><span class="line">    - 包括三部分：</span><br><span class="line">      - 第一部分：请求方式（7种）</span><br><span class="line">        - get（常用的）</span><br><span class="line">        - post（常用的）</span><br><span class="line">        - delete</span><br><span class="line">        - put</span><br><span class="line">        - head</span><br><span class="line">        - options</span><br><span class="line">        - trace</span><br><span class="line">      - 第二部分：URI</span><br><span class="line">        - 什么是URI？ 统一资源标识符。代表网络中某个资源的名字。但是通过URI是无法定位资源的。</span><br><span class="line">        - 什么是URL？统一资源定位符。代表网络中某个资源，同时，通过URL是可以定位到该资源的。</span><br><span class="line">        - URI和URL什么关系，有什么区别？</span><br><span class="line">          - URL包括URI</span><br><span class="line">          - http://localhost:8080/servlet05/index.html 这是URL。</span><br><span class="line">          - /servlet05/index.html 这是URI。</span><br><span class="line">      - 第三部分：HTTP协议版本号</span><br><span class="line"></span><br><span class="line">  - 请求头</span><br><span class="line"></span><br><span class="line">    - 请求的主机</span><br><span class="line">    - 主机的端口</span><br><span class="line">    - 浏览器信息</span><br><span class="line">    - 平台信息</span><br><span class="line">    - cookie等信息</span><br><span class="line">    - ....</span><br><span class="line"></span><br><span class="line">  - 空白行</span><br><span class="line"></span><br><span class="line">    - 空白行是用来区分“请求头”和“请求体”</span><br><span class="line"></span><br><span class="line">  - 请求体</span><br><span class="line"></span><br><span class="line">    - 向服务器发送的具体数据。</span><br><span class="line"></span><br><span class="line">- HTTP的响应协议（S --&gt; B）</span><br><span class="line"></span><br><span class="line">  - HTTP的响应协议包括：4部分</span><br><span class="line"></span><br><span class="line">    - 状态行</span><br><span class="line">    - 响应头</span><br><span class="line">    - 空白行</span><br><span class="line">    - 响应体</span><br><span class="line"></span><br><span class="line">  - HTTP响应协议的具体报文：</span><br><span class="line"></span><br><span class="line">    - ```</span><br><span class="line">      HTTP/1.1 200 ok                                     状态行</span><br><span class="line">      Content-Type: text/html;charset=UTF-8               响应头</span><br><span class="line">      Content-Length: 160</span><br><span class="line">      Date: Mon, 08 Nov 2021 13:19:32 GMT</span><br><span class="line">      Keep-Alive: timeout=20</span><br><span class="line">      Connection: keep-alive</span><br><span class="line">                                                          空白行</span><br><span class="line">      &lt;!doctype html&gt;                                     响应体</span><br><span class="line">      &lt;html&gt;</span><br><span class="line">          &lt;head&gt;</span><br><span class="line">              &lt;title&gt;from get servlet&lt;/title&gt;</span><br><span class="line">          &lt;/head&gt;</span><br><span class="line">          &lt;body&gt;</span><br><span class="line">              &lt;h1&gt;from get servlet&lt;/h1&gt;</span><br><span class="line">          &lt;/body&gt;</span><br><span class="line">      &lt;/html&gt;</span><br></pre></td></tr></table></figure></code></pre></li></ul></li><li><p>状态行</p><ul><li>三部分组成<ul><li>第一部分：协议版本号（HTTP&#x2F;1.1）</li><li>第二部分：状态码（HTTP协议中规定的响应状态号。不同的响应结果对应不同的号码。）<ul><li>200 表示请求响应成功，正常结束。</li><li>404表示访问的资源不存在，通常是因为要么是你路径写错了，要么是路径写对了，但是服务器中对应的资源并没有启动成功。总之404错误是前端错误。</li><li>405表示前端发送的请求方式与后端请求的处理方式不一致时发生：<ul><li>比如：前端是POST请求，后端的处理方式按照get方式进行处理时，发生405</li><li>比如：前端是GET请求，后端的处理方式按照post方式进行处理时，发生405</li></ul></li><li>500表示服务器端的程序出现了异常。一般会认为是服务器端的错误导致的。</li><li>以4开始的，一般是浏览器端的错误导致的。</li><li>以5开始的，一般是服务器端的错误导致的。</li></ul></li><li>第三部分：状态的描述信息<ul><li>ok 表示正常成功结束。</li><li>not found 表示资源找不到。</li></ul></li></ul></li></ul></li><li><p>响应头：</p><ul><li>响应的内容类型</li><li>响应的内容长度</li><li>响应的时间</li><li>….</li></ul></li><li><p>空白行：</p><ul><li>用来分隔“响应头”和“响应体”的。</li></ul></li><li><p>响应体：</p><ul><li>响应体就是响应的正文，这些内容是一个长的字符串，这个字符串被浏览器渲染，解释并执行，最终展示出效果。</li></ul></li></ul></li><li><p>怎么查看的协议内容？</p><ul><li>使用chrome浏览器：F12。然后找到network，通过这个面板可以查看协议的具体内容。</li></ul></li><li><p>怎么向服务器发送GET请求，怎么向服务器发送POST请求？</p><ul><li>到目前为止，只有一种情况可以发送POST请求：使用form表单，并且form标签中的method属性值为：method&#x3D;”post”。</li><li>其他所有情况一律都是get请求：<ul><li>在浏览器地址栏上直接输入URL，敲回车，属于get请求。</li><li>在浏览器上直接点击超链接，属于get请求。</li><li>使用form表单提交数据时，form标签中没有写method属性，默认就是get</li><li>或者使用form的时候，form标签中method属性值为：method&#x3D;”get”</li><li>….</li></ul></li></ul></li><li><p>GET请求和POST请求有什么区别？</p><ul><li>get请求发送数据的时候，数据会挂在URI的后面，并且在URI后面添加一个“?”，”?”后面是数据。这样会导致发送的数据回显在浏览器的地址栏上。（get请求在“请求行”上发送数据）<ul><li><a href="http://localhost:8080/servlet05/getServlet?username=zhangsan&userpwd=1111">http://localhost:8080/servlet05/getServlet?username=zhangsan&amp;userpwd=1111</a></li></ul></li><li>post请求发送数据的时候，在请求体当中发送。不会回显到浏览器的地址栏上。也就是说post发送的数据，在浏览器地址栏上看不到。（post在“请求体”当中发送数据）</li><li>get请求只能发送普通的字符串。并且发送的字符串长度有限制，不同的浏览器限制不同。这个没有明确的规范。</li><li>get请求无法发送大数据量。</li><li>post请求可以发送任何类型的数据，包括普通字符串，流媒体等信息：视频、声音、图片。</li><li>post请求可以发送大数据量，理论上没有长度限制。</li><li>get请求在W3C中是这样说的：get请求比较适合从服务器端获取数据。</li><li>post请求在W3C中是这样说的：post请求比较适合向服务器端传送数据。</li><li>get请求是安全的。get请求是绝对安全的。为什么？因为get请求只是为了从服务器上获取数据。不会对服务器造成威胁。（get本身是安全的，你不要用错了。用错了之后又冤枉人家get不安全，你这样不好（太坏了），那是你自己的问题，不是get请求的问题。）</li><li>post请求是危险的。为什么？因为post请求是向服务器提交数据，如果这些数据通过后门的方式进入到服务器当中，服务器是很危险的。另外post是为了提交数据，所以一般情况下拦截请求的时候，大部分会选择拦截（监听）post请求。</li><li>get请求支持缓存。<ul><li><a href="https://n.sinaimg.cn/finance/590/w240h350/20211101/b40c-b425eb67cabc342ff5b9dc018b4b00cc.jpg">https://n.sinaimg.cn/finance/590/w240h350/20211101/b40c-b425eb67cabc342ff5b9dc018b4b00cc.jpg</a></li><li>任何一个get请求最终的“响应结果”都会被浏览器缓存起来。在浏览器缓存当中：<ul><li>一个get请求的路径a  对应  一个资源。</li><li>一个get请求的路径b  对应  一个资源。</li><li>一个get请求的路径c  对应  一个资源。</li><li>……</li></ul></li><li>实际上，你只要发送get请求，浏览器做的第一件事都是先从本地浏览器缓存中找，找不到的时候才会去服务器上获取。这种缓存机制目的是为了提高用户的体验。</li><li>有没有这样一个需求：我们不希望get请求走缓存，怎么办？怎么避免走缓存？我希望每一次这个get请求都去服务器上找资源，我不想从本地浏览器的缓存中取。<ul><li>只要每一次get请求的请求路径不同即可。</li><li><a href="https://n.sinaimg.cn/finance/590/w240h350/20211101/7cabc342ff5b9dc018b4b00cc.jpg?t=789789787897898">https://n.sinaimg.cn/finance/590/w240h350/20211101/7cabc342ff5b9dc018b4b00cc.jpg?t=789789787897898</a></li><li><a href="https://n.sinaimg.cn/finance/590/w240h350/20211101/7cabc342ff5b9dc018b4b00cc.jpg?t=789789787897899">https://n.sinaimg.cn/finance/590/w240h350/20211101/7cabc342ff5b9dc018b4b00cc.jpg?t=789789787897899</a></li><li><a href="https://n.sinaimg.cn/finance/590/w240h350/20211101/7cabc342ff5b9dc018b4b00cc.jpg?t=%E7%B3%BB%E7%BB%9F%E6%AF%AB%E7%A7%92%E6%95%B0">https://n.sinaimg.cn/finance/590/w240h350/20211101/7cabc342ff5b9dc018b4b00cc.jpg?t=系统毫秒数</a></li><li>怎么解决？可以在路径的后面添加一个每时每刻都在变化的“时间戳”，这样，每一次的请求路径都不一样，浏览器就不走缓存了。</li></ul></li></ul></li><li>post请求不支持缓存。（POST是用来修改服务器端的资源的。）<ul><li>post请求之后，服务器“响应的结果”不会被浏览器缓存起来。因为这个缓存没有意义。</li></ul></li></ul></li><li><p>GET请求和POST请求如何选择，什么时候使用GET请求，什么时候使用POST请求？</p><ul><li>怎么选择GET请求和POST请求呢？衡量标准是什么呢？你这个请求是想获取服务器端的数据，还是想向服务器发送数据。如果你是想从服务器上获取资源，建议使用GET请求，如果你这个请求是为了向服务器提交数据，建议使用POST请求。</li><li>大部分的form表单提交，都是post方式，因为form表单中要填写大量的数据，这些数据是收集用户的信息，一般是需要传给服务器，服务器将这些数据保存&#x2F;修改等。</li><li>如果表单中有敏感信息，还是建议适用post请求，因为get请求会回显敏感信息到浏览器地址栏上。（例如：密码信息）</li><li>做文件上传，一定是post请求。要传的数据不是普通文本。</li><li>其他情况都可以使用get请求。</li></ul></li><li><p>不管你是get请求还是post请求，发送的请求数据格式是完全相同的，只不过位置不同，格式都是统一的：</p><ul><li>name&#x3D;value&amp;name&#x3D;value&amp;name&#x3D;value&amp;name&#x3D;value</li><li>name是什么？<ul><li>以form表单为例：form表单中input标签的name。</li></ul></li><li>value是什么？<ul><li>以form表单为例：form表单中input标签的value。</li></ul></li></ul></li></ul><h2 id="模板方法设计模式"><a href="#模板方法设计模式" class="headerlink" title="模板方法设计模式"></a>模板方法设计模式</h2><ul><li>什么是设计模式？<ul><li>某个问题的固定的解决方案。(可以被重复使用。)</li></ul></li><li>你知道哪些设计模式？<ul><li>GoF设计模式：<ul><li>通常我们所说的23种设计模式。（Gang of Four：4人组提出的设计模式）</li><li>单例模式</li><li>工厂模式</li><li>代理模式</li><li>门面模式</li><li>责任链设计模式</li><li>观察者模式</li><li>模板方法设计模式</li><li>…..</li></ul></li><li>JavaEE设计模式：<ul><li>DAO</li><li>DTO</li><li>VO</li><li>PO</li><li>pojo</li><li>….</li></ul></li><li>….例子看视频p18的最后</li></ul></li><li>什么是模板方法设计模式？<ul><li>在模板类的模板方法当中定义核心算法骨架，具体的实现步骤可以延迟到子类当中完成。</li></ul></li><li>模板类通常是一个抽象类，模板类当中的模板方法定义核心算法，这个方法通常是final的（但也可以不是final的）</li><li>模板类当中的抽象方法就是不确定实现的方法，这个不确定怎么实现的事儿交给子类去做。</li></ul><h2 id="HttpServlet源码分析"><a href="#HttpServlet源码分析" class="headerlink" title="HttpServlet源码分析"></a>HttpServlet源码分析</h2><ul><li>HttpServlet类是专门为HTTP协议准备的。比GenericServlet更加适合HTTP协议下的开发。</li><li>HttpServlet在哪个包下？<ul><li>jakarta.servlet.http.HttpServlet</li></ul></li><li>到目前为止我们接触了servlet规范中哪些接口？<ul><li>jakarta.servlet.Servlet  核心接口（接口）</li><li>jakarta.servlet.ServletConfig Servlet配置信息接口（接口）</li><li>jakarta.servlet.ServletContext Servlet上下文接口（接口）</li><li>jakarta.servlet.ServletRequest Servlet请求接口（接口）</li><li>jakarta.servlet.ServletResponse Servlet响应接口（接口）</li><li>jakarta.servlet.ServletException Servlet异常（类）</li><li>jakarta.servlet.GenericServlet 标准通用的Servlet类（抽象类）</li></ul></li><li>http包下都有哪些类和接口呢？jakarta.servlet.http.*;<ul><li>jakarta.servlet.http.HttpServlet （HTTP协议专用的Servlet类，抽象类）</li><li>jakarta.servlet.http.HttpServletRequest （HTTP协议专用的请求对象）</li><li>jakarta.servlet.http.HttpServletResponse （HTTP协议专用的响应对象）</li></ul></li><li>HttpServletRequest对象中封装了什么信息？<ul><li>HttpServletRequest，简称request对象。</li><li>HttpServletRequest中封装了请求协议的全部内容。</li><li>Tomcat服务器（WEB服务器）将“请求协议”中的数据全部解析出来，然后将这些数据全部封装到request对象当中了。</li><li>也就是说，我们只要面向HttpServletRequest，就可以获取请求协议中的数据。</li></ul></li><li>HttpServletResponse对象是专门用来响应HTTP协议到浏览器的。</li><li>回忆Servlet生命周期？<ul><li>用户第一次请求<ul><li>Tomcat服务器通过反射机制，调用无参数构造方法。创建Servlet对象。(web.xml文件中配置的Servlet类对应的对象。)</li><li>Tomcat服务器调用Servlet对象的init方法完成初始化。</li><li>Tomcat服务器调用Servlet对象的service方法处理请求。</li></ul></li><li>用户第二次请求<ul><li>Tomcat服务器调用Servlet对象的service方法处理请求。</li></ul></li><li>用户第三次请求<ul><li>Tomcat服务器调用Servlet对象的service方法处理请求。</li></ul></li><li>….<ul><li>Tomcat服务器调用Servlet对象的service方法处理请求。</li></ul></li><li>服务器关闭<ul><li>Tomcat服务器调用Servlet对象的destroy方法，做销毁之前的准备工作。</li><li>Tomcat服务器销毁Servlet对象。</li></ul></li></ul></li><li>HttpServlet源码分析：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"><span class="comment">// 用户第一次请求，创建HelloServlet对象的时候，会执行这个无参数构造方法。</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HelloServlet</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//override 重写 doGet方法</span></span><br><span class="line">    <span class="comment">//override 重写 doPost方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">GenericServlet</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span>, ServletConfig,</span><br><span class="line">        java.io.Serializable &#123;</span><br><span class="line">           </span><br><span class="line"><span class="comment">// 用户第一次请求的时候，HelloServlet对象第一次被创建之后，这个init方法会执行。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="built_in">this</span>.config = config;</span><br><span class="line">        <span class="built_in">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 用户第一次请求的时候，带有参数的init(ServletConfig config)执行之后，会执行这个没有参数的init()</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="comment">// NOOP by default</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HttpServlet模板类。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">HttpServlet</span> <span class="keyword">extends</span> <span class="title class_">GenericServlet</span> &#123;</span><br><span class="line">    <span class="comment">// 用户发送第一次请求的时候这个service会执行</span></span><br><span class="line">    <span class="comment">// 用户发送第N次请求的时候，这个service方法还是会执行。</span></span><br><span class="line">    <span class="comment">// 用户只要发送一次请求，这个service方法就会执行一次。</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span><br><span class="line">        <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        HttpServletRequest  request;</span><br><span class="line">        HttpServletResponse response;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 将ServletRequest和ServletResponse向下转型为带有Http的HttpServletRequest和HttpServletResponse</span></span><br><span class="line">            request = (HttpServletRequest) req;</span><br><span class="line">            response = (HttpServletResponse) res;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassCastException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>(lStrings.getString(<span class="string">&quot;http.non_http&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 调用重载的service方法。</span></span><br><span class="line">        service(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 这个service方法的两个参数都是带有Http的。</span></span><br><span class="line">    <span class="comment">// 这个service是一个模板方法。</span></span><br><span class="line">    <span class="comment">// 在该方法中定义核心算法骨架，具体的实现步骤延迟到子类中去完成。</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">        <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 获取请求方式</span></span><br><span class="line">        <span class="comment">// 这个请求方式最终可能是：&quot;&quot;</span></span><br><span class="line">        <span class="comment">// 注意：request.getMethod()方法获取的是请求方式，可能是七种之一：</span></span><br><span class="line">        <span class="comment">// GET POST PUT DELETE HEAD OPTIONS TRACE</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> req.getMethod();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果请求方式是GET请求，则执行doGet方法。</span></span><br><span class="line">        <span class="keyword">if</span> (method.equals(METHOD_GET)) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">lastModified</span> <span class="operator">=</span> getLastModified(req);</span><br><span class="line">            <span class="keyword">if</span> (lastModified == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// servlet doesn&#x27;t support if-modified-since, no reason</span></span><br><span class="line">                <span class="comment">// to go through further expensive logic</span></span><br><span class="line">                doGet(req, resp);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">long</span> ifModifiedSince;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ifModifiedSince = req.getDateHeader(HEADER_IFMODSINCE);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IllegalArgumentException iae) &#123;</span><br><span class="line">                    <span class="comment">// Invalid date header - proceed as if none was set</span></span><br><span class="line">                    ifModifiedSince = -<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (ifModifiedSince &lt; (lastModified / <span class="number">1000</span> * <span class="number">1000</span>)) &#123;</span><br><span class="line">                    <span class="comment">// If the servlet mod time is later, call doGet()</span></span><br><span class="line">                    <span class="comment">// Round down to the nearest second for a proper compare</span></span><br><span class="line">                    <span class="comment">// A ifModifiedSince of -1 will always be less</span></span><br><span class="line">                    maybeSetLastModified(resp, lastModified);</span><br><span class="line">                    doGet(req, resp);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    resp.setStatus(HttpServletResponse.SC_NOT_MODIFIED);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_HEAD)) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">lastModified</span> <span class="operator">=</span> getLastModified(req);</span><br><span class="line">            maybeSetLastModified(resp, lastModified);</span><br><span class="line">            doHead(req, resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_POST)) &#123;</span><br><span class="line">            <span class="comment">// 如果请求方式是POST请求，则执行doPost方法。</span></span><br><span class="line">            doPost(req, resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_PUT)) &#123;</span><br><span class="line">            doPut(req, resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_DELETE)) &#123;</span><br><span class="line">            doDelete(req, resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_OPTIONS)) &#123;</span><br><span class="line">            doOptions(req,resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_TRACE)) &#123;</span><br><span class="line">            doTrace(req,resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            <span class="comment">// Note that this means NO servlet supports whatever</span></span><br><span class="line">            <span class="comment">// method was requested, anywhere on this server.</span></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">errMsg</span> <span class="operator">=</span> lStrings.getString(<span class="string">&quot;http.method_not_implemented&quot;</span>);</span><br><span class="line">            Object[] errArgs = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">1</span>];</span><br><span class="line">            errArgs[<span class="number">0</span>] = method;</span><br><span class="line">            errMsg = MessageFormat.format(errMsg, errArgs);</span><br><span class="line"></span><br><span class="line">            resp.sendError(HttpServletResponse.SC_NOT_IMPLEMENTED, errMsg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">        <span class="keyword">throws</span> ServletException, IOException&#123;</span><br><span class="line">        <span class="comment">// 报405错误</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> lStrings.getString(<span class="string">&quot;http.method_get_not_supported&quot;</span>);</span><br><span class="line">        sendMethodNotAllowed(req, resp, msg);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">        <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 报405错误</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> lStrings.getString(<span class="string">&quot;http.method_post_not_supported&quot;</span>);</span><br><span class="line">        sendMethodNotAllowed(req, resp, msg);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">通过以上源代码分析：</span></span><br><span class="line"><span class="comment">假设前端发送的请求是get请求，后端程序员重写的方法是doPost</span></span><br><span class="line"><span class="comment">假设前端发送的请求是post请求，后端程序员重写的方法是doGet</span></span><br><span class="line"><span class="comment">会发生什么呢？</span></span><br><span class="line"><span class="comment">发生405这样的一个错误。</span></span><br><span class="line"><span class="comment">405表示前端的错误，发送的请求方式不对。和服务器不一致。不是服务器需要的请求方式。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">通过以上源代码可以知道：只要HttpServlet类中的doGet方法或doPost方法执行了，必然405.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">怎么避免405的错误呢？</span></span><br><span class="line"><span class="comment">后端重写了doGet方法，前端一定要发get请求。</span></span><br><span class="line"><span class="comment">后端重写了doPost方法，前端一定要发post请求。</span></span><br><span class="line"><span class="comment">这样可以避免405错误。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">这种前端到底需要发什么样的请求，其实应该后端说了算。后端让发什么方式，前端就得发什么方式。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">有的人，你会看到为了避免405错误，在Servlet类当中，将doGet和doPost方法都进行了重写。</span></span><br><span class="line"><span class="comment">这样，确实可以避免405的发生，但是不建议，405错误还是有用的。该报错的时候就应该让他报错。</span></span><br><span class="line"><span class="comment">如果你要是同时重写了doGet和doPost，那还不如你直接重写service方法好了。这样代码还能</span></span><br><span class="line"><span class="comment">少写一点。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">视频里讲的是前端发get请求但后端子类只重写了post，那么这个请求就一定调用父类的get，但父类的get会提示报错，应该是这样</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>我们编写的HelloServlet直接继承HttpServlet，直接重写HttpServlet类中的service()方法行吗？</p><ul><li>可以，只不过你享受不到405错误。享受不到HTTP协议专属的东西。</li></ul></li><li><p>到今天我们终于得到了最终的一个Servlet类的开发步骤：</p><ul><li>第一步：编写一个Servlet类，直接继承HttpServlet</li><li>第二步：重写doGet方法或者重写doPost方法，到底重写谁，javaweb程序员说了算。</li><li>第三步：将Servlet类配置到web.xml文件当中。</li><li>第四步：准备前端的页面（form表单），form表单中指定请求路径即可。</li></ul></li></ul><h2 id="关于一个web站点的欢迎页面"><a href="#关于一个web站点的欢迎页面" class="headerlink" title="关于一个web站点的欢迎页面"></a>关于一个web站点的欢迎页面</h2><ul><li><p>什么是一个web站点的欢迎页面？</p><ul><li>对于一个webapp来说，我们是可以设置它的欢迎页面的。</li><li>设置了欢迎页面之后，当你访问这个webapp的时候，或者访问这个web站点的时候，没有指定任何“资源路径”，这个时候会默认访问你的欢迎页面。</li><li>我们一般的访问方式是：<ul><li><a href="http://localhost:8080/servlet06/login.html">http://localhost:8080/servlet06/login.html</a> 这种方式是指定了要访问的就是login.html资源。</li></ul></li><li>如果我们访问的方式是：<ul><li><a href="http://localhost:8080/servlet06">http://localhost:8080/servlet06</a> 如果我们访问的就是这个站点，没有指定具体的资源路径。它默认会访问谁呢？</li><li>默认会访问你设置的欢迎页面。</li></ul></li></ul></li><li><p>怎么设置欢迎页面呢？</p><ul><li><p>第一步：我在IDEA工具的web目录下新建了一个文件login.html</p></li><li><p>第二步：在web.xml文件中进行了以下的配置</p><ul><li><pre><code class="language-xml">&lt;welcome-file-list&gt;        &lt;welcome-file&gt;login.html&lt;/welcome-file&gt;    &lt;/welcome-file-list&gt;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    - 注意：设置欢迎页面的时候，这个路径不需要以“/”开始。并且这个路径默认是从webapp的根下开始查找。</span><br><span class="line"></span><br><span class="line">  - 第三步：启动服务器，浏览器地址栏输入地址</span><br><span class="line"></span><br><span class="line">    - http://localhost:8080/servlet07</span><br><span class="line"></span><br><span class="line">- 如果在webapp的根下新建一个目录，目录中再给一个文件，那么这个欢迎页该如何设置呢？</span><br><span class="line"></span><br><span class="line">  - 在webapp根下新建page1</span><br><span class="line"></span><br><span class="line">  - 在page1下新建page2目录</span><br><span class="line"></span><br><span class="line">  - 在page2目录下新建page.html页面</span><br><span class="line"></span><br><span class="line">  - 在web.xml文件中应该这样配置</span><br><span class="line"></span><br><span class="line">    - ```</span><br><span class="line">      &lt;welcome-file-list&gt;</span><br><span class="line">          &lt;welcome-file&gt;page1/page2/page.html&lt;/welcome-file&gt;</span><br><span class="line">      &lt;/welcome-file-list&gt;</span><br></pre></td></tr></table></figure></code></pre></li><li><p>注意：路径不需要以“&#x2F;”开始，并且路径默认从webapp的根下开始找。</p></li></ul></li></ul></li><li><p>一个webapp是可以设置多个欢迎页面的</p><ul><li><pre><code class="language-xml">&lt;welcome-file-list&gt;    &lt;welcome-file&gt;page1/page2/page.html&lt;/welcome-file&gt;    &lt;welcome-file&gt;login.html&lt;/welcome-file&gt;&lt;/welcome-file-list&gt;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 注意：越靠上的优先级越高。找不到的继续向下找。</span><br><span class="line"></span><br><span class="line">- 你有没有注意一件事：当我的文件名设置为index.html的时候，不需要在web.xml文件中进行配置欢迎页面。这是为什么？</span><br><span class="line"></span><br><span class="line">  - 这是因为小猫咪Tomcat服务器已经提前配置好了。</span><br><span class="line"></span><br><span class="line">  - 实际上配置欢迎页面有两个地方可以配置：</span><br><span class="line"></span><br><span class="line">    - 一个是在webapp内部的web.xml文件中。（在这个地方配置的属于局部配置）</span><br><span class="line"></span><br><span class="line">    - 一个是在CATALINA_HOME/conf/web.xml文件中进行配置。（在这个地方配置的属于全局配置）</span><br><span class="line"></span><br><span class="line">      - ```xml</span><br><span class="line">        &lt;welcome-file-list&gt;</span><br><span class="line">            &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;</span><br><span class="line">            &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt;</span><br><span class="line">            &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;</span><br><span class="line">        &lt;/welcome-file-list&gt;</span><br></pre></td></tr></table></figure>  - Tomcat服务器的全局欢迎页面是：index.html index.htm index.jsp。如果你一个web站点没有设置局部的欢迎页面，Tomcat服务器就会以index.html index.htm index.jsp作为一个web站点的欢迎页面。- 注意原则：局部优先原则。（就近原则）</code></pre></li></ul></li><li><p>欢迎页可以是一个Servlet吗？</p><ul><li><p>当然可以。</p></li><li><p>你不要多想，欢迎页就是一个资源，既然是一个资源，那么可以是静态资源，也可以是动态资源。</p></li><li><p>静态资源：index.html welcome.html …..</p></li><li><p>动态资源：Servlet类。</p></li><li><p>步骤：</p><ul><li><p>第一步：写一个Servlet</p><ul><li><pre><code class="language-java">public class WelcomeServlet extends HttpServlet {    @Override    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {        response.setContentType(&quot;text/html&quot;);        PrintWriter out = response.getWriter();        out.print(&quot;&lt;h1&gt;welcome to bjpowernode!&lt;/h1&gt;&quot;);    }}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">- 第二步：在web.xml文件中配置servlet</span><br><span class="line"></span><br><span class="line">  - ```xml</span><br><span class="line">        &lt;servlet&gt;</span><br><span class="line">            &lt;servlet-name&gt;welcomeServlet&lt;/servlet-name&gt;</span><br><span class="line">            &lt;servlet-class&gt;com.bjpowernode.javaweb.servlet.WelcomeServlet&lt;/servlet-class&gt;</span><br><span class="line">        &lt;/servlet&gt;</span><br><span class="line">        &lt;servlet-mapping&gt;</span><br><span class="line">            &lt;servlet-name&gt;welcomeServlet&lt;/servlet-name&gt;</span><br><span class="line">            &lt;url-pattern&gt;/fdsa/fds/a/fds/af/ds/af/dsafdsafdsa&lt;/url-pattern&gt;</span><br><span class="line">        &lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure></code></pre></li></ul></li><li><p>第三步：在web.xml文件中配置欢迎页，这里配置了小猫咪自己的欢迎页就失效了</p><ul><li><pre><code class="language-xml">    &lt;welcome-file-list&gt;        &lt;welcome-file&gt;fdsa/fds/a/fds/af/ds/af/dsafdsafdsa&lt;/welcome-file&gt;    &lt;/welcome-file-list&gt;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">## 关于WEB-INF目录</span><br><span class="line"></span><br><span class="line">- 在WEB-INF目录下新建了一个文件：welcome.html</span><br><span class="line">- 打开浏览器访问：http://localhost:8080/servlet07/WEB-INF/welcome.html 出现了404错误。</span><br><span class="line">- 注意：放在WEB-INF目录下的资源是受保护的。在浏览器上不能够通过路径直接访问。所以像HTML、CSS、JS、image等静态资源一定要放到WEB-INF目录之外。</span><br><span class="line"></span><br><span class="line">## HttpServletRequest接口详解</span><br><span class="line"></span><br><span class="line">- HttpServletRequest是一个接口，全限定名称：jakarta.servlet.http.HttpServletRequest</span><br><span class="line"></span><br><span class="line">- HttpServletRequest接口是Servlet规范中的一员。</span><br><span class="line"></span><br><span class="line">- HttpServletRequest接口的父接口：ServletRequest</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    public interface HttpServletRequest extends ServletRequest &#123;&#125;</span><br></pre></td></tr></table></figure></code></pre></li></ul></li></ul></li></ul></li><li><p>HttpServletRequest接口的实现类谁写的? HttpServletRequest对象是谁给创建的？</p><ul><li><p>通过测试：直接输出request得到了下面这行结果：org.apache.catalina.connector.RequestFacade ，然后找到这个类发现实现了 HttpServletRequest接口</p><ul><li><pre><code class="language-java">public class RequestFacade implements HttpServletRequest {}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 测试结果说明：Tomcat服务器（WEB服务器、WEB容器）实现了HttpServletRequest接口，还是说明了Tomcat服务器实现了Servlet规范。而对于我们javaweb程序员来说，实际上不需要关心这个，我们只需要面向接口编程即可。我们关心的是HttpServletRequest接口中有哪些方法，这些方法可以完成什么功能！！！！</span><br><span class="line"></span><br><span class="line">- HttpServletRequest对象中都有什么信息？都包装了什么信息？</span><br><span class="line"></span><br><span class="line">  - HttpServletRequest对象是Tomcat服务器负责创建的。这个对象中封装了什么信息？封装了HTTP的请求协议。</span><br><span class="line">  - 实际上是用户发送请求的时候，遵循了HTTP协议，发送的是HTTP的请求协议，Tomcat服务器将HTTP协议中的信息以及数据全部解析出来，然后Tomcat服务器把这些信息封装到HttpServletRequest对象当中，传给了我们javaweb程序员。</span><br><span class="line">  - javaweb程序员面向HttpServletRequest接口编程，调用方法就可以获取到请求的信息了。</span><br><span class="line"></span><br><span class="line">- request和response对象的生命周期？</span><br><span class="line"></span><br><span class="line">  - request对象和response对象，一个是请求对象，一个是响应对象。这两个对象只在当前请求中有效。</span><br><span class="line">  - 一次请求对应一个request。</span><br><span class="line">  - 两次请求则对应两个request。</span><br><span class="line">  - .....</span><br><span class="line"></span><br><span class="line">- HttpServletRequest接口中有哪些常用的方法？</span><br><span class="line"></span><br><span class="line">  - 怎么获取前端浏览器用户提交的数据？</span><br><span class="line"></span><br><span class="line">    - ```java</span><br><span class="line">      Map&lt;String,String[]&gt; getParameterMap() 这个是获取Map</span><br><span class="line">      Enumeration&lt;String&gt; getParameterNames() 这个是获取Map集合中所有的key</span><br><span class="line">      String[] getParameterValues(String name) 根据key获取Map集合的value</span><br><span class="line">      String getParameter(String name)  获取value这个一维数组当中的第一个元素。这个方法最常用。</span><br><span class="line">      // 以上的4个方法，和获取用户提交的数据有关系。</span><br></pre></td></tr></table></figure></code></pre></li><li><p>思考：如果是你，前端的form表单提交了数据之后，你准备怎么存储这些数据，你准备采用什么样的数据结构去存储这些数据呢？</p><ul><li><p>前端提交的数据格式：username&#x3D;abc&amp;userpwd&#x3D;111&amp;aihao&#x3D;s&amp;aihao&#x3D;d&amp;aihao&#x3D;tt</p></li><li><p>我会采用Map集合来存储：</p><ul><li><pre><code class="language-java">Map&lt;String,String&gt;    key存储String    value存储String    这种想法对吗？不对。    如果采用以上的数据结构存储会发现key重复的时候value覆盖。    key         value    ---------------------    username    abc    userpwd     111    aihao       s    aihao       d    aihao       tt    这样是不行的，因为map的key不能重复。Map&lt;String, String[]&gt;    key存储String    value存储String[]    key                value    -------------------------------    username        {&quot;abc&quot;}    userpwd            {&quot;111&quot;}    aihao            {&quot;s&quot;,&quot;d&quot;,&quot;tt&quot;}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    - 注意：前端表单提交数据的时候，假设提交了120这样的“数字”，其实是以字符串&quot;120&quot;的方式提交的，所以服务器端获取到的一定是一个字符串的&quot;120&quot;，而不是一个数字。（**前端永远提交的是字符串，后端获取的也永远是字符串**。）</span><br><span class="line">  </span><br><span class="line">- 手工开发一个webapp。测试HttpServletRequest接口中的相关方法。</span><br><span class="line"></span><br><span class="line">  - ![image-20251106191635951](./images/Servlet-JSP-课堂笔记/image-20251106191635951.png)</span><br><span class="line"></span><br><span class="line">  - 先测试了4个常用的方法，获取请求参数的四个方法。也就是从前端获取的参数</span><br><span class="line">  </span><br><span class="line">    - ```java</span><br><span class="line">      Map&lt;String,String[]&gt; parameterMap = request.getParameterMap();</span><br><span class="line">      Enumeration&lt;String&gt; names = request.getParameterNames();</span><br><span class="line">      String[] values = request.getParameterValues(&quot;name&quot;);</span><br><span class="line">      String value = request.getParameter(&quot;name&quot;);</span><br></pre></td></tr></table></figure></code></pre></li></ul></li></ul></li><li><p>request对象实际上又称为“请求域”对象。</p><ul><li><p>应用域对象是什么？</p><ul><li><p>ServletContext （Servlet上下文对象。）</p></li><li><p>什么情况下会考虑向ServletContext这个应用域当中绑定数据呢？</p><ul><li>第一：所有用户共享的数据。</li><li>第二：这个共享的数据量很小。</li><li>第三：这个共享的数据很少的修改操作。</li><li>在以上三个条件都满足的情况下，使用这个应用域对象，可以大大提高我们程序执行效率。</li><li>实际上向应用域当中绑定数据，就相当于把数据放到了缓存（Cache）当中，然后用户访问的时候直接从缓存中取，减少IO的操作，大大提升系统的性能，所以缓存技术是提高系统性能的重要手段。</li></ul></li><li><p>你见过哪些缓存技术呢？</p><ul><li>字符串常量池</li><li>整数型常量池 [-128~127]，但凡是在这个范围当中的Integer对象不再创建新对象，直接从这个整数型常量池中获取。大大提升系统性能。</li><li>数据库连接池（提前创建好N个连接对象，将连接对象放到集合当中，使用连接对象的时候，直接从缓存中拿。省去了连接对象的创建过程。效率提升。）</li><li>线程池（Tomcat服务器就是支持多线程的。所谓的线程池就是提前先创建好N个线程对象，将线程对象存储到集合中，然后用户请求过来之后，直接从线程池中获取线程对象，直接拿来用。提升系统性能）</li><li>后期你还会学习更多的缓存技术，例如：redis、mongoDB…..</li></ul></li><li><p>ServletContext当中有三个操作域的方法：</p><ul><li><pre><code class="language-java">void setAttribute(String name, Object obj); // 向域当中绑定数据。Object getAttribute(String name); // 从域当中根据name获取数据。void removeAttribute(String name); // 将域当中绑定的数据移除// 以上的操作类似于Map集合的操作。Map&lt;String, Object&gt; map;map.put(&quot;name&quot;, obj); // 向map集合中放key和valueObject obj = map.get(&quot;name&quot;); // 通过map集合的key获取valuemap.remove(&quot;name&quot;); // 通过Map集合的key删除key和value这个键值对。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- “请求域”对象</span><br><span class="line"></span><br><span class="line">  - “请求域”对象要比“应用域”对象范围小很多。生命周期短很多。请求域只在一次请求内有效。</span><br><span class="line"></span><br><span class="line">  - 一个请求对象request对应一个请求域对象。一次请求结束之后，这个请求域就销毁了。</span><br><span class="line"></span><br><span class="line">  - 请求域对象也有这三个方法：</span><br><span class="line">    </span><br><span class="line">    - ```java</span><br><span class="line">      void setAttribute(String name, Object obj); // 向域当中绑定数据。</span><br><span class="line">      Object getAttribute(String name); // 从域当中根据name获取数据。</span><br><span class="line">      void removeAttribute(String name); // 将域当中绑定的数据移除</span><br></pre></td></tr></table></figure></code></pre></li></ul></li><li><p>请求域和应用域的选用原则？</p><ul><li>尽量使用小的域对象，因为小的域对象占用的资源较少。</li></ul></li></ul></li><li><p>跳转</p><ul><li><pre><code class="language-java">// 这样做可以吗?// 在AServlet当中new一个BServlet对象，然后调用BServlet对象的doGet方法，把request对象传过去。//不行，程序员自己new的servlet生命周期不受小猫咪管理，虽然可以实现功能BServlet bServlet = new BServlet();bServlet.doGet(request,response);<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br></pre></td><td class="code"><pre><span class="line">          </span><br><span class="line">        - 转发（一次请求）</span><br><span class="line">      </span><br><span class="line">          - ```java</span><br><span class="line">            // 第一步：获取请求转发器对象</span><br><span class="line">            //相当于把&quot;/b&quot;这个路径包装到请求转发器当中，实际上是把下一个跳转的资源的路径告知给Tomcat服务器了。</span><br><span class="line">            RequestDispatcher dispatcher = request.getRequestDispatcher(&quot;/b&quot;);</span><br><span class="line">            </span><br><span class="line">            // 第二步：调用转发器的forward方法完成跳转/转发</span><br><span class="line">            // 转发的时候:这两个参数很重要。request和response都是要传递给下一个资源的。</span><br><span class="line">            dispatcher.forward(request,response);</span><br><span class="line">            </span><br><span class="line">            // 第一步和第二步代码可以联合在一起。</span><br><span class="line">            request.getRequestDispatcher(&quot;/b&quot;).forward(request,response);</span><br><span class="line">            ```</span><br><span class="line">      </span><br><span class="line">      - 两个Servlet怎么共享数据？</span><br><span class="line">      </span><br><span class="line">        - 将数据放到ServletContext应用域当中，当然是可以的，但是应用域范围太大，占用资源太多。不建议使用。</span><br><span class="line">        - 可以将数据放到request域当中，然后AServlet转发到BServlet，保证AServlet和BServlet在同一次请求当中，这样就可以做到两个Servlet，或者多个Servlet共享同一份数据。</span><br><span class="line">      </span><br><span class="line">      - 转发的下一个资源必须是一个Servlet吗？</span><br><span class="line">      </span><br><span class="line">        - 不一定，只要是Tomcat服务器当中的合法资源，都是可以转发的。例如：html....</span><br><span class="line">        - 注意：转发的时候，路径的写法要注意，转发的路径以“/”开始，不加项目名。</span><br><span class="line">      </span><br><span class="line">      - 关于request对象中两个非常容易混淆的方法：</span><br><span class="line">      </span><br><span class="line">        - ```java</span><br><span class="line">          // uri?username=zhangsan&amp;userpwd=123&amp;sex=1</span><br><span class="line">          String username = request.getParameter(&quot;username&quot;);</span><br><span class="line">          </span><br><span class="line">          // 之前一定是执行过：request.setAttribute(&quot;name&quot;, new Object())</span><br><span class="line">          Object obj = request.getAttribute(&quot;name&quot;);</span><br><span class="line">          </span><br><span class="line">          // 以上两个方法的区别是什么？</span><br><span class="line">          // 第一个方法：获取的是用户在浏览器上提交的数据。</span><br><span class="line">          // 第二个方法：获取的是请求域当中绑定的数据。</span><br><span class="line">          ```</span><br><span class="line">        </span><br><span class="line">      - HttpServletRequest接口的其他常用方法（包含前前端请求乱码解决方法）：</span><br><span class="line">      </span><br><span class="line">        - ```java</span><br><span class="line">          // 获取客户端的IP地址</span><br><span class="line">          String remoteAddr = request.getRemoteAddr();</span><br><span class="line">          </span><br><span class="line">          // get请求在请求行上提交数据。</span><br><span class="line">          // post请求在请求体中提交数据。</span><br><span class="line">          // 设置请求体的字符集。（显然这个方法是处理POST请求的乱码问题。这种方式并不能解决get请求的乱码问题。）</span><br><span class="line">          // Tomcat10之后，request请求体当中的字符集默认就是UTF-8，不需要设置字符集，不会出现乱码问题。</span><br><span class="line">          // Tomcat9前（包括9在内），如果前端请求体提交的是中文，后端获取之后出现乱码，怎么解决这个乱码？执行以下代码。</span><br><span class="line">          request.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">          // 在Tomcat9之前（包括9），响应中文也是有乱码的，怎么解决这个响应的乱码？</span><br><span class="line">          response.setContentType(&quot;text/html;charset=UTF-8&quot;);</span><br><span class="line">          // 在Tomcat10之后，包括10在内，响应中文的时候就不在出现乱码问题了。以上代码就不需要设置UTF-8了。</span><br><span class="line">          </span><br><span class="line">          // 注意一个细节</span><br><span class="line">          // 在Tomcat10包括10在内之后的版本，中文将不再出现乱码。（这也体现了中文地位的提升。）</span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">          // get请求乱码问题怎么解决？</span><br><span class="line">          // get请求发送的时候，数据是在请求行上提交的，不是在请求体当中提交的。</span><br><span class="line">          // get请求乱码怎么解决</span><br><span class="line">          // 方案：修改CATALINA_HOME/conf/server.xml配置文件</span><br><span class="line">          &lt;Connector URIEncoding=&quot;UTF-8&quot; /&gt;</span><br><span class="line">          // 注意：从Tomcat8之后，URIEncoding的默认值就是UTF-8，所以GET请求也没有乱码问题了。</span><br><span class="line">              </span><br><span class="line">          // 获取应用的根路径</span><br><span class="line">          String contextPath = request.getContextPath();</span><br><span class="line">          </span><br><span class="line">          // 获取请求方式</span><br><span class="line">          String method = request.getMethod();</span><br><span class="line">          </span><br><span class="line">          // 获取请求的URI</span><br><span class="line">          String uri = request.getRequestURI();  // /aaa/testRequest</span><br><span class="line">          </span><br><span class="line">          // 获取servlet path</span><br><span class="line">          String servletPath = request.getServletPath(); //   /testRequest</span><br><span class="line">          </span><br><span class="line">          ```</span><br><span class="line"></span><br><span class="line">## 使用纯Servlet做一个单表的CRUD操作</span><br><span class="line"></span><br><span class="line">- 使用纯粹的Servlet完成单表【对部门的】的增删改查操作。（B/S结构的。）</span><br><span class="line"></span><br><span class="line">- 实现步骤</span><br><span class="line"></span><br><span class="line">  - 第一步：准备一张数据库表。（sql脚本）</span><br><span class="line"></span><br><span class="line">    - ```sql</span><br><span class="line">      # 部门表</span><br><span class="line">      drop table if exists dept;</span><br><span class="line">      create table dept(</span><br><span class="line">      deptno int primary key,</span><br><span class="line">          dname varchar(255),</span><br><span class="line">          loc varchar(255)</span><br><span class="line">      );</span><br><span class="line">      insert into dept(deptno, dname, loc) values(10, &#x27;XiaoShouBu&#x27;, &#x27;BEIJING&#x27;);</span><br><span class="line">      insert into dept(deptno, dname, loc) values(20, &#x27;YanFaBu&#x27;, &#x27;SHANGHAI&#x27;);</span><br><span class="line">      insert into dept(deptno, dname, loc) values(30, &#x27;JiShuBu&#x27;, &#x27;GUANGZHOU&#x27;);</span><br><span class="line">      insert into dept(deptno, dname, loc) values(40, &#x27;MeiTiBu&#x27;, &#x27;SHENZHEN&#x27;);</span><br><span class="line">      commit;</span><br><span class="line">      select * from dept;</span><br><span class="line">      ```</span><br><span class="line"></span><br><span class="line">  - 第二步：准备一套HTML页面（项目原型）【前端开发工具使用HBuilder】</span><br><span class="line"></span><br><span class="line">    - 把HTML页面准备好</span><br><span class="line">    - 然后将HTML页面中的链接都能够跑通。（页面流转没问题。）</span><br><span class="line">    - 应该设计哪些页面呢？</span><br><span class="line">      - 欢迎页面：index.html</span><br><span class="line">      - 列表页面：list.html（以列表页面为核心，展开其他操作。）</span><br><span class="line">      - 新增页面：add.html</span><br><span class="line">      - 修改页面：edit.html</span><br><span class="line">      - 详情页面：detail.html</span><br><span class="line"></span><br><span class="line">  - 第三步：分析我们这个系统包括哪些功能？</span><br><span class="line"></span><br><span class="line">    - 什么叫做一个功能呢？</span><br><span class="line">      - 只要 这个操作连接了数据库，就表示一个独立的功能。</span><br><span class="line">    - 包括哪些功能？</span><br><span class="line">      - 查看部门列表</span><br><span class="line">      - 新增部门</span><br><span class="line">      - 删除部门</span><br><span class="line">      - 查看部门详细信息</span><br><span class="line">      - 跳转到修改页面</span><br><span class="line">      - 修改部门</span><br><span class="line"></span><br><span class="line">  - 第四步：在IDEA当中搭建开发环境</span><br><span class="line"></span><br><span class="line">    - 创建一个webapp（给这个webapp添加servlet-api.jar和jsp-api.jar到classpath当中。）</span><br><span class="line">    - 向webapp中添加连接数据库的jar包（mysql驱动）</span><br><span class="line">      - 必须在WEB-INF目录下新建lib目录，然后将mysql的驱动jar包拷贝到这个lib目录下。这个目录名必须叫做lib，全部小写的。</span><br><span class="line">    - JDBC的工具类</span><br><span class="line">    - 将所有HTML页面拷贝到web目录下。</span><br><span class="line"></span><br><span class="line">  - 第五步：实现第一个功能：查看部门列表</span><br><span class="line"></span><br><span class="line">    - 我们应该怎么去实现一个功能呢？</span><br><span class="line"></span><br><span class="line">      - 建议：你可以从后端往前端一步一步写。也可以从前端一步一步往后端写。都可以。但是千万要记住不要想起来什么写什么。你写代码的过程最好是程序的执行过程。也就是说：程序执行到哪里，你就写哪里。这样一个顺序流下来之后，基本上不会出现什么错误、意外。</span><br><span class="line">      - 从哪里开始？</span><br><span class="line">        - 假设从前端开始，那么一定是从用户点击按钮那里开始的。</span><br><span class="line"></span><br><span class="line">    - 第一：先修改前端页面的超链接，因为用户先点击的就是这个超链接。</span><br><span class="line"></span><br><span class="line">      - ```html</span><br><span class="line">        &lt;!--前端超链接发送请求的时候，请求路径以&quot;/&quot;开始，并且要带着项目名--&gt;</span><br><span class="line">        &lt;a href=&quot;/oa/dept/list&quot;&gt;查看部门列表&lt;/a&gt;</span><br><span class="line">        ```</span><br><span class="line">  </span><br><span class="line">    - 第二：编写web.xml文件</span><br><span class="line">  </span><br><span class="line">      - ```xml</span><br><span class="line">        &lt;servlet&gt;</span><br><span class="line">            &lt;servlet-name&gt;list&lt;/servlet-name&gt;</span><br><span class="line">            &lt;servlet-class&gt;com.bjpowernode.oa.web.action.DeptListServlet&lt;/servlet-class&gt;</span><br><span class="line">        &lt;/servlet&gt;</span><br><span class="line">        &lt;servlet-mapping&gt;</span><br><span class="line">            &lt;servlet-name&gt;list&lt;/servlet-name&gt;</span><br><span class="line">            &lt;!--web.xml文件中的这个路径也是以“/”开始的，但是不需要加项目名--&gt;</span><br><span class="line">            &lt;url-pattern&gt;/dept/list&lt;/url-pattern&gt;</span><br><span class="line">        &lt;/servlet-mapping&gt;</span><br><span class="line">        ```</span><br><span class="line">  </span><br><span class="line">    - 第三：编写DeptListServlet类继承HttpServlet类。然后重写doGet方法。</span><br><span class="line">  </span><br><span class="line">      - ```java</span><br><span class="line">        package com.bjpowernode.oa.web.action;</span><br><span class="line">        </span><br><span class="line">        import jakarta.servlet.ServletException;</span><br><span class="line">        import jakarta.servlet.http.HttpServlet;</span><br><span class="line">        import jakarta.servlet.http.HttpServletRequest;</span><br><span class="line">        import jakarta.servlet.http.HttpServletResponse;</span><br><span class="line">        </span><br><span class="line">        import java.io.IOException;</span><br><span class="line">        </span><br><span class="line">        public class DeptListServlet extends HttpServlet &#123;</span><br><span class="line">            @Override</span><br><span class="line">            protected void doGet(HttpServletRequest request, HttpServletResponse response)</span><br><span class="line">                    throws ServletException, IOException &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ```</span><br><span class="line">  </span><br><span class="line">    - 第四：在DeptListServlet类的doGet方法中连接数据库，查询所有的部门，动态的展示部门列表页面.</span><br><span class="line">  </span><br><span class="line">      - 分析list.html页面中哪部分是固定死的，哪部分是需要动态展示的。</span><br><span class="line">  </span><br><span class="line">      - list.html页面中的内容所有的双引号要替换成单引号，因为out.print(&quot;&quot;)这里有一个双引号，容易冲突。</span><br><span class="line">  </span><br><span class="line">      - 现在写完这个功能之后，你会有一种感觉，感觉开发很繁琐，只使用servlet写代码太繁琐了。</span><br><span class="line">  </span><br><span class="line">      - ```java</span><br><span class="line">        while(rs.next())&#123;</span><br><span class="line">            String deptno = rs.getString(&quot;a&quot;);</span><br><span class="line">            String dname = rs.getString(&quot;dname&quot;);</span><br><span class="line">            String loc = rs.getString(&quot;loc&quot;);</span><br><span class="line">        </span><br><span class="line">            out.print(&quot;&lt;tr&gt;&quot;);</span><br><span class="line">            out.print(&quot;&lt;td&gt;&quot;+(++i)+&quot;&lt;/td&gt;&quot;);</span><br><span class="line">            out.print(&quot;&lt;td&gt;&quot;+deptno+&quot;&lt;/td&gt;&quot;);</span><br><span class="line">            out.print(&quot;&lt;td&gt;&quot;+dname+&quot;&lt;/td&gt;&quot;);</span><br><span class="line">            out.print(&quot;&lt;td&gt;&quot;);</span><br><span class="line">            out.print(&quot;&lt;a href=&#x27;&#x27;&gt;删除&lt;/a&gt;&quot;);</span><br><span class="line">            out.print(&quot;&lt;a href=&#x27;edit.html&#x27;&gt;修改&lt;/a&gt;&quot;);</span><br><span class="line">            out.print(&quot;&lt;a href=&#x27;detail.html&#x27;&gt;详情&lt;/a&gt;&quot;);</span><br><span class="line">            out.print(&quot;&lt;/td&gt;&quot;);</span><br><span class="line">            out.print(&quot;&lt;/tr&gt;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        ```</span><br><span class="line">  </span><br><span class="line">  - 第六步：查看部门详情。</span><br><span class="line">  </span><br><span class="line">    - 建议：从前端往后端一步一步实现。首先要考虑的是，用户点击的是什么？用户点击的东西在哪里？</span><br><span class="line">  </span><br><span class="line">      - 一定要先找到用户点的“详情”在哪里。找了半天，终于在后端的java程序中找到了</span><br><span class="line">  </span><br><span class="line">        - ```html</span><br><span class="line">          &lt;a href=&#x27;写一个路径&#x27;&gt;详情&lt;/a&gt;</span><br><span class="line">          ```</span><br><span class="line">  </span><br><span class="line">        - 详情  是需要连接数据库的，所以这个超链接点击之后也是需要执行一段java代码的。所以要将这个超链接的路径修改一下。</span><br><span class="line">  </span><br><span class="line">        - 注意：修改路径之后，这个路径是需要加项目名的。&quot;/oa/dept/detail&quot;，**前端发送请求要加项目名** </span><br><span class="line">  </span><br><span class="line">      - 技巧：</span><br><span class="line">  </span><br><span class="line">        - ```java</span><br><span class="line">          //获取应用的根路径</span><br><span class="line">          String contextPath = request.getConterPath;</span><br><span class="line">          </span><br><span class="line">          out.print(&quot;&lt;a href=&#x27;&quot;+contextPath+&quot;/dept/detail?suibianxie=&quot;+deptno+&quot;&#x27;&gt;详情&lt;/a&gt;&quot;);</span><br><span class="line">          ```</span><br><span class="line">          </span><br><span class="line">        - 重点：向服务器提交数据的格式：uri?name=value&amp;name=value&amp;name=value&amp;name=value</span><br><span class="line">        </span><br><span class="line">        - 这里的问号，必须是英文的问号。不能中文的问号。</span><br><span class="line">    </span><br><span class="line">    - 解决404的问题。写web.xml文件。</span><br><span class="line">    </span><br><span class="line">      - ```xml</span><br><span class="line">        &lt;servlet&gt;</span><br><span class="line">            &lt;servlet-name&gt;detail&lt;/servlet-name&gt;</span><br><span class="line">            &lt;servlet-class&gt;com.bjpowernode.oa.web.action.DeptDetailServlet&lt;/servlet-class&gt;</span><br><span class="line">        &lt;/servlet&gt;</span><br><span class="line">        &lt;servlet-mapping&gt;</span><br><span class="line">            &lt;servlet-name&gt;detail&lt;/servlet-name&gt;</span><br><span class="line">            &lt;url-pattern&gt;/dept/detail&lt;/url-pattern&gt;</span><br><span class="line">        &lt;/servlet-mapping&gt;</span><br><span class="line">        ```</span><br><span class="line">    </span><br><span class="line">    - 编写一个类：DeptDetailServlet继承HttpServlet，重写doGet方法。</span><br><span class="line">    </span><br><span class="line">      - ```java</span><br><span class="line">        package com.bjpowernode.oa.web.action;</span><br><span class="line">        </span><br><span class="line">        import jakarta.servlet.ServletException;</span><br><span class="line">        import jakarta.servlet.http.HttpServlet;</span><br><span class="line">        import jakarta.servlet.http.HttpServletRequest;</span><br><span class="line">        import jakarta.servlet.http.HttpServletResponse;</span><br><span class="line">        </span><br><span class="line">        import java.io.IOException;</span><br><span class="line">        </span><br><span class="line">        public class DeptDetailServlet extends HttpServlet &#123;</span><br><span class="line">            @Override</span><br><span class="line">            protected void doGet(HttpServletRequest request, HttpServletResponse response)</span><br><span class="line">                    throws ServletException, IOException &#123;</span><br><span class="line">                // 获取部门编号</span><br><span class="line">        ///oa/dept/detail?subianxie=30</span><br><span class="line">        //虽然是提交的30，但是服务器获取的是&quot;30&quot;这个字符串。</span><br><span class="line">        String deptno = request.getParameter( name: &quot;suibianxie&quot;);</span><br><span class="line">                //中文思路（思路来源于：你要做什么？目标：查看部门详细信息。）</span><br><span class="line">                // 第一步：获取部门编号</span><br><span class="line">                // 第二步：根据部门编号查询数据库，获取该部门编号对应的部门信息。</span><br><span class="line">                // 第三步：将部门信息响应到浏览器上。（显示一个详情。）  </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ```</span><br><span class="line">    </span><br><span class="line">    - 在doGet方法当中：连接数据库，根据部门编号查询该部门的信息。动态展示部门详情页。</span><br><span class="line">    </span><br><span class="line">  - 第七步：删除部门</span><br><span class="line">  </span><br><span class="line">    - 怎么开始？从哪里开始？从前端页面开始，用户点击删除按钮的时候，应该提示用户是否删除。因为删除这个动作是比较危险的。任何系统在进行删除操作之前，是必须要提示用户的，因为这个删除的动作有可能是用户误操作。（在前端页面上写JS代码，来提示用户是否删除。）</span><br><span class="line">  </span><br><span class="line">      - ```html</span><br><span class="line">        &lt;!--href后设置为javascript:void(0)表示:仍然保留住超链接的样子--&gt;</span><br><span class="line">        &lt;!--点击此超链接之后，不进行页面的跳转。</span><br><span class="line">        &lt;!--我只是希望用户点击该超链接的时候执行一段S代码，不进行页面的跳转。--&gt;</span><br><span class="line">        &lt;a href=&quot;javascript:void(0)&quot; onclick=&quot;del(30)&quot; &gt;删除&lt;/a&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">        function del(dno)&#123;</span><br><span class="line">                //弹出确认框，点击确定就是true</span><br><span class="line">        if(window.confirm(&quot;亲，删了不可恢复哦！&quot;))&#123;</span><br><span class="line">                    //发送请求进行删除数据的操作。在Js代码当中如何发送请求给服务器?</span><br><span class="line">                    //.href可以省略</span><br><span class="line">                    //window.location也可以</span><br><span class="line">        document.location.href = &quot;/oa/dept/delete?deptno=&quot; + dno;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &lt;/script&gt;</span><br><span class="line">        ```</span><br><span class="line">  </span><br><span class="line">    - 以上的前端程序要写到后端的java代码当中：</span><br><span class="line">  </span><br><span class="line">      - DeptListServlet类的doGet方法当中，使用out.print()方法，将以上的前端代码输出到浏览器上。</span><br><span class="line">  </span><br><span class="line">    - 解决404的问题：</span><br><span class="line">  </span><br><span class="line">      - http://localhost:8080/oa/dept/delete?deptno=30 </span><br><span class="line">  </span><br><span class="line">      - web.xml文件</span><br><span class="line">  </span><br><span class="line">        - ```xml</span><br><span class="line">          &lt;servlet&gt;</span><br><span class="line">              &lt;servlet-name&gt;delete&lt;/servlet-name&gt;</span><br><span class="line">              &lt;servlet-class&gt;com.bjpowernode.oa.web.action.DeptDelServlet&lt;/servlet-class&gt;</span><br><span class="line">          &lt;/servlet&gt;</span><br><span class="line">          &lt;servlet-mapping&gt;</span><br><span class="line">              &lt;servlet-name&gt;delete&lt;/servlet-name&gt;</span><br><span class="line">              &lt;url-pattern&gt;/dept/delete&lt;/url-pattern&gt;</span><br><span class="line">          &lt;/servlet-mapping&gt;</span><br><span class="line">          ```</span><br><span class="line">  </span><br><span class="line">      - 编写DeptDelServlet继承HttpServlet，重写doGet方法。</span><br><span class="line">  </span><br><span class="line">      - ```java</span><br><span class="line">        package com.bjpowernode.oa.web.action;</span><br><span class="line">        </span><br><span class="line">        import jakarta.servlet.ServletException;</span><br><span class="line">        import jakarta.servlet.http.HttpServlet;</span><br><span class="line">        import jakarta.servlet.http.HttpServletRequest;</span><br><span class="line">        import jakarta.servlet.http.HttpServletResponse;</span><br><span class="line">        </span><br><span class="line">        import java.io.IOException;</span><br><span class="line">        </span><br><span class="line">        public class DeptDelServlet extends HttpServlet &#123;</span><br><span class="line">            @Override</span><br><span class="line">            protected void doGet(HttpServletRequest request, HttpServletResponse response)</span><br><span class="line">                    throws ServletException, IOException &#123;</span><br><span class="line">                // 根据部门编号，删除部门。</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ```</span><br><span class="line">  </span><br><span class="line">      - 删除成功或者失败的时候的一个处理（这里我们选择了转发，并没有使用重定向机制。）</span><br><span class="line">  </span><br><span class="line">        - ```java</span><br><span class="line">          // 判断删除成功了还是失败了。</span><br><span class="line">          if (count == 1) &#123;</span><br><span class="line">              //删除成功</span><br><span class="line">              //仍然跳转到部门列表页面</span><br><span class="line">              //部门列表页面的显示需要执行另一个Servlet。怎么办？转发。</span><br><span class="line">              request.getRequestDispatcher(&quot;/dept/list&quot;).forward(request, response);</span><br><span class="line">          &#125;else&#123;</span><br><span class="line">              // 删除失败</span><br><span class="line">              request.getRequestDispatcher(&quot;/error.html&quot;).forward(request, response);</span><br><span class="line">          &#125;</span><br><span class="line">          ```</span><br><span class="line">  </span><br><span class="line">  - 第八步：新增部门（这里代码看视频）</span><br><span class="line">  </span><br><span class="line">    - 注意：最后保存成功之后，转发到 /dept/list 的时候，会出现405，为什么？</span><br><span class="line">      - 第一：保存用的是post请求。底层要执行doPost方法。</span><br><span class="line">      </span><br><span class="line">      - 第二：转发是一次请求，之前是post，之后还是post，因为它是一次请求。</span><br><span class="line">      </span><br><span class="line">      - 第三：/dept/list 的Servlet当中只有一个doGet方法，但前面发送的是post，没有重写所以会出405问题。</span><br><span class="line">      </span><br><span class="line">      - 怎么解决？两种方案</span><br><span class="line">        - 第一种：在/dept/list Servlet中添加doPost方法，然后在doPost方法中调用doGet。</span><br><span class="line">        </span><br><span class="line">        - ~~~java</span><br><span class="line">          @0verride</span><br><span class="line">          protected void doPost(HttpServletRequest request, HttpServletResponse response)</span><br><span class="line">          throws ServletException，I0Exception &#123;</span><br><span class="line">          doGet(request,response);</span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure></code></pre></li><li><p>第二种：重定向。</p></li></ul></li></ul></li></ul></li><li><p>第九步：跳转到修改部门的页面</p></li><li><p>第十步：修改部门</p></li></ul></li></ul><h2 id="在一个web应用中应该如何完成资源的跳转"><a href="#在一个web应用中应该如何完成资源的跳转" class="headerlink" title="在一个web应用中应该如何完成资源的跳转"></a>在一个web应用中应该如何完成资源的跳转</h2><ul><li><p>在一个web应用中通过两种方式，可以完成资源的跳转：</p><ul><li>第一种方式：转发</li><li>第二种方式：重定向</li></ul></li><li><p>转发和重定向有什么区别？</p><ul><li><p>代码上有什么区别？</p><ul><li><p>转发</p><ul><li><pre><code class="language-java">// 获取请求转发器对象RequestDispatcher dispatcher = request.getRequestDispatcher(&quot;/dept/list&quot;);// 调用请求转发器对象的forward方法完成转发dispatcher.forward(request, response);// 合并一行代码request.getRequestDispatcher(&quot;/dept/list&quot;).forward(request, response);// 转发的时候是一次请求，不管你转发了多少次。都是一次请求。// AServlet转发到BServlet，再转发到CServlet，再转发到DServlet，不管转发了多少次，都在同一个request当中。// 这是因为调用forward方法的时候，会将当前的request和response对象传递给下一个Servlet。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 重定向</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    // 注意：路径上要加一个项目名。为什么？</span><br><span class="line">    // 浏览器发送请求，请求路径上是需要添加项目名的。</span><br><span class="line">    // 以下这一行代码会将请求路径“/oa/dept/list”发送给浏览器</span><br><span class="line">    // 浏览器会自发的向服务器发送一次全新的请求：/oa/dept/list</span><br><span class="line">    response.sendRedirect(&quot;/oa/dept/list&quot;);</span><br></pre></td></tr></table></figure></code></pre></li></ul></li></ul></li><li><p>形式上有什么区别？</p><ul><li>转发（一次请求）<ul><li>在浏览器地址栏上发送的请求是：<a href="http://localhost:8080/servlet10/a">http://localhost:8080/servlet10/a</a> ，最终请求结束之后，浏览器地址栏上的地址还是这个。没变。</li></ul></li><li>重定向（两次请求）<ul><li>在浏览器地址栏上发送的请求是：<a href="http://localhost:8080/servlet10/a">http://localhost:8080/servlet10/a</a> ，最终在浏览器地址栏上显示的地址是：<a href="http://localhost:8080/servlet10/b">http://localhost:8080/servlet10/b</a></li></ul></li></ul></li><li><p>转发和重定向的本质区别？</p><ul><li>转发：是由WEB服务器来控制的。A资源跳转到B资源，这个跳转动作是Tomcat服务器内部完成的。</li><li>重定向：是浏览器完成的。具体跳转到哪个资源，是浏览器说了算。</li></ul></li><li><p>使用一个例子去描述这个转发和重定向</p><ul><li>借钱（转发：发送了一次请求）<ul><li>杜老师没钱了，找张三借钱，其实张三没有钱，但是张三够义气，张三自己找李四借了钱，然后张三把这个钱给了杜老师，杜老师不知道这个钱是李四的，杜老师只求了一个人。杜老师以为这个钱就是张三的。</li><li><img src="/./images/Servlet-JSP-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/%E8%BD%AC%E5%8F%91.png" alt="转发"></li></ul></li><li>借钱（重定向：发送了两次请求）<ul><li>杜老师没钱了，找张三借钱，张三没有钱，张三有一个好哥们，叫李四，李四是个富二代，于是张三将李四的家庭住址告诉了杜老师，杜老师按照这个地址去找到李四，然后从李四那里借了钱。显然杜老师在这个过程中，求了两个人。并且杜老师知道最终这个钱是李四借给俺的。</li><li><img src="/./images/Servlet-JSP-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/%E9%87%8D%E5%AE%9A%E5%90%91.png" alt="重定向"></li></ul></li></ul></li></ul></li><li><p>转发和重定向应该如何选择？什么时候使用转发，什么时候使用重定向？</p><ul><li>如果在上一个Servlet当中向request域当中绑定了数据，希望从下一个Servlet当中把request域里面的数据取出来，使用转发机制。</li><li>剩下所有的请求均使用重定向。（重定向使用较多。）</li></ul></li><li><p>跳转的下一个资源有没有要求呢？必须是一个Servlet吗？</p><ul><li>不一定，跳转的资源只要是服务器内部合法的资源即可。包括：Servlet、JSP、HTML…..</li></ul></li><li><p>转发会存在浏览器的刷新问题。</p></li></ul><h2 id="将oa项目中的资源跳转修改为合适的跳转方式"><a href="#将oa项目中的资源跳转修改为合适的跳转方式" class="headerlink" title="将oa项目中的资源跳转修改为合适的跳转方式"></a>将oa项目中的资源跳转修改为合适的跳转方式</h2><ul><li>删除之后，重定向</li><li>修改之后，重定向</li><li>保存之后，重定向</li><li>重定向：<ul><li>成功</li><li>失败</li></ul></li></ul><h2 id="Servlet注解，简化配置"><a href="#Servlet注解，简化配置" class="headerlink" title="Servlet注解，简化配置"></a>Servlet注解，简化配置</h2><ul><li><p>分析oa项目中的web.xml文件</p><ul><li>现在只是一个单标的CRUD，没有复杂的业务逻辑，很简单的一丢丢功能。web.xml文件中就有如此多的配置信息。如果采用这种方式，对于一个大的项目来说，这样的话web.xml文件会非常庞大，有可能最终会达到几十兆。</li><li>在web.xml文件中进行servlet信息的配置，显然开发效率比较低，每一个都需要配置一下。</li><li>而且在web.xml文件中的配置是很少被修改的，所以这种配置信息能不能直接写到java类当中呢？可以的。</li></ul></li><li><p>Servlet3.0版本之后，推出了各种Servlet基于注解式开发。优点是什么？</p><ul><li>开发效率高，不需要编写大量的配置信息。直接在java类上使用注解进行标注。</li><li>web.xml文件体积变小了。</li></ul></li><li><p>并不是说注解有了之后，web.xml文件就不需要了：</p><ul><li>有一些需要变化的信息，还是要配置到web.xml文件中。一般都是 注解+配置文件 的开发模式。</li><li>一些不会经常变化修改的配置建议使用注解。一些可能会被修改的建议写到配置文件中。</li></ul></li><li><p>我们的第一个注解：</p><ul><li><pre><code>jakarta.servlet.annotation.WebServlet<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 在Servlet类上使用：@WebServlet，WebServlet注解中有哪些属性呢？</span><br><span class="line"></span><br><span class="line">    - name属性：用来指定Servlet的名字。等同于：&lt;servlet-name&gt;</span><br><span class="line">    </span><br><span class="line">    - urlPatterns属性：用来指定Servlet的映射**路径**。可以指定多个字符串。&lt;url-pattern&gt;</span><br><span class="line">    </span><br><span class="line">      ~~~java</span><br><span class="line">      //@WebServlet(urlPatterns =&#123;&quot;/welcome1&quot;，&quot;/welcome2&quot;&#125;)</span><br><span class="line">      //注意:当注解的属性是一个数组，并且数组中只有一个元素，大括号可以省略。</span><br><span class="line">      @WebServlet(urlPatterns =&quot;/welcome&quot;)</span><br><span class="line">      ~~~</span><br><span class="line">    </span><br><span class="line">    - loadOnStartUp属性：用来指定在服务器启动阶段是否加载该Servlet，也相当于启动时是否创建servlet对象，值填数字。等同于：&lt;load-on-startup&gt;</span><br><span class="line">    </span><br><span class="line">    - value属性：当注解的属性名是value的时候，使用注解的时候，value属性名是可以省略的。</span><br><span class="line">    </span><br><span class="line">      ~~~java</span><br><span class="line">      //这个value属性和urlPatterns属性一致，都是用来指定Servlet的映射路径的。</span><br><span class="line">      //@WebServlet(value =&#123;&quot;/welcome1&quot;，&quot;/welcome2&quot;&#125;)</span><br><span class="line">      //如果注解的属性名是valve的话，属性名也是可以省略的</span><br><span class="line">      @WebServlet(value =&quot;/welcome1&quot;)</span><br><span class="line">      也可以@WebServlet(&quot;/wel&quot;)</span><br><span class="line">      ~~~</span><br><span class="line">    </span><br><span class="line">    - 注意：不是必须将所有属性都写上，只需要提供需要的。（需要什么用什么。）</span><br><span class="line">    </span><br><span class="line">    - 注意：属性是一个数组，如果数组中只有一个元素，使用该注解的时候，属性值的大括号可以省略。</span><br><span class="line"></span><br><span class="line">- 注解对象的使用格式：</span><br><span class="line"></span><br><span class="line">  - @注解名称(属性名=属性值, 属性名=属性值, 属性名=属性值....)</span><br><span class="line"></span><br><span class="line">~~~java</span><br><span class="line">@WebServlet(name = &quot;hello&quot;, urlPatterns = &#123;&quot;/hello1&quot;, &quot;/hello2&quot;,&quot;/hello3&quot;&#125;，load0nstartup =1,</span><br><span class="line">initParams = i@webInitParam(name=&quot;username&quot;, value=&quot;root&quot;), @WebInitParam(name=&quot;password&quot;, value=&quot;123&quot;)&#125;)</span><br><span class="line">    </span><br><span class="line">// 获取初始化参数</span><br><span class="line">Enumeration&lt;String&gt; names = getInitParameterNames();</span><br><span class="line">while (names.hasMoreElements())&#123;</span><br><span class="line">String name = names.nextElement();</span><br><span class="line">String value = getInitParameter(name);</span><br><span class="line">out.print(name +&quot;=&quot;+ value + &quot;&lt;br&gt;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">输出username=root</span><br><span class="line">    password=123</span><br><span class="line">~~~</span><br><span class="line"></span><br><span class="line">## 使用模板方法设计模式优化oa项目</span><br><span class="line"></span><br><span class="line">- 上面的注解解决了配置文件的问题。但是现在的oa项目仍然存在一个比较臃肿的问题。</span><br><span class="line">  - 一个单标的CRUD，就写了6个Servlet。如果一个复杂的业务系统，这种开发方式，显然会导致类爆炸。（类的数量太大。）</span><br><span class="line">  - 怎么解决这个类爆炸问题？可以使用模板方法设计模式。</span><br><span class="line">- 怎么解决类爆炸问题？</span><br><span class="line">  - 以前的设计是一个请求一个Servlet类。1000个请求对应1000个Servlet类。导致类爆炸。</span><br><span class="line">  - 可以这样做：一个请求对应一个方法。一个业务对应一个Servlet类。</span><br><span class="line">  - 处理部门相关业务的对应一个DeptServlet。处理用户相关业务的对应一个UserServlet。处理银行卡卡片业务对应一个CardServlet。</span><br><span class="line"></span><br><span class="line">## 分析使用纯粹Servlet开发web应用的缺陷</span><br><span class="line"></span><br><span class="line">- 在Servlet当中编写HTML/CSS/JavaScript等前端代码。存在什么问题？</span><br><span class="line">  - java程序中编写前端代码，编写难度大。麻烦。</span><br><span class="line">  - java程序中编写前端代码，显然程序的耦合度非常高。</span><br><span class="line">  - java程序中编写前端代码，代码非常不美观。</span><br><span class="line">  - java程序中编写前端代码，维护成本太高。（非常难于维护）</span><br><span class="line">    - 修改小小的一个前端代码，只要有改动，就需要重新编译java代码，生成新的class文件，打一个新的war包，重新发布。</span><br><span class="line">- 思考一下，如果是你的话，你准备怎么解决这个问题？</span><br><span class="line">  - 思路很重要。使用什么样的思路去做、去解决这个问题</span><br><span class="line">    - 上面的那个Servlet（Java程序）能不能不写了，让机器自动生成。我们程序员只需要写这个Servlet程序中的“前端的那段代码”，然后让机器将我们写的“前端代码”自动翻译生成“Servlet这种java程序”。然后机器再自动将“java”程序编译生成&quot;class&quot;文件。然后再使用JVM调用这个class中的方法。</span><br><span class="line"></span><br><span class="line">## 关于B/S结构系统的会话机制（session机制）</span><br><span class="line"></span><br><span class="line">- 什么是会话？</span><br><span class="line">  - 会话对应的英语单词：session</span><br><span class="line">  - 用户打开浏览器，进行一系列操作，然后最终将浏览器关闭，这个整个过程叫做：一次会话。会话在服务器端也有一个对应的java对象，这个java对象叫做：session。</span><br><span class="line">  - 什么是一次请求：用户在浏览器上点击了一下，然后到页面停下来，可以粗略认为是一次请求。请求对应的服务器端的java对象是：request。</span><br><span class="line">  - 一个会话当中包含多次请求。（一次会话对应N次请求。）</span><br><span class="line">  </span><br><span class="line">- 在java的servlet规范当中，session对应的类名：HttpSession（jarkata.servlet.http.HttpSession）</span><br><span class="line"></span><br><span class="line">- session机制属于B/S结构的一部分。如果使用php语言开发WEB项目，同样也是有session这种机制的。session机制实际上是一个规范。然后不同的语言对这种会话机制都有实现。</span><br><span class="line"></span><br><span class="line">- session对象最主要的作用是：保存会话状态。（用户登录成功了，这是一种登录成功的状态，你怎么把登录成功的状态一直保存下来呢？使用session对象可以保留会话状态。）</span><br><span class="line"></span><br><span class="line">- 为什么需要session对象来保存会话状态呢？</span><br><span class="line">  - 因为HTTP协议是一种无状态协议。</span><br><span class="line">  - 什么是无状态：请求的时候，B和S是连接的，但是请求结束之后，连接就断了。为什么要这么做？HTTP协议为什么要设计成这样？因为这样的无状态协议，可以降低服务器的压力。请求的瞬间是连接的，请求结束之后，连接断开，这样服务器压力小。</span><br><span class="line">  - 只要B和S断开了，那么关闭浏览器这个动作，服务器知道吗？</span><br><span class="line">    - 不知道。服务器是不知道浏览器关闭的。</span><br><span class="line">  </span><br><span class="line">- 张三打开一个浏览器A，李四打开一个浏览器B，访问服务器之后，在服务器端会生成：</span><br><span class="line">  - 张三专属的session对象</span><br><span class="line">  - 李四专属的session对象</span><br><span class="line">  </span><br><span class="line">- 为什么不使用request对象保存会话状态？为什么不使用ServletContext对象保存会话状态？</span><br><span class="line">  - request.setAttribute()存，request.getAttribute()取，ServletContext也有这个方法。request是请求域。ServletContext是应用域。</span><br><span class="line">  - request是一次请求一个对象（太小）。</span><br><span class="line">  - ServletContext对象是服务器启动的时候创建，服务器关闭的时候销毁，这个ServletContext对象只有一个。</span><br><span class="line">  - ServletContext对象的域太大。</span><br><span class="line">  - request请求域（HttpServletRequest）、session会话域（HttpSession）、application域（ServletContext）</span><br><span class="line">  - request &lt; session &lt; application（大小），request 相当于购物车里的商品，session 相当于购物车，application相当于超市</span><br><span class="line">  </span><br><span class="line">- 思考一下：session对象的实现原理。</span><br><span class="line">  - HttpSession session = request.getSession();</span><br><span class="line">  - 这行代码很神奇。张三访问的时候获取的session对象就是张三的。李四访问的时候获取的session对象就是李四的。</span><br><span class="line">  </span><br><span class="line">- session的实现原理：</span><br><span class="line"></span><br><span class="line">  - JSESSIONID=xxxxxx  这个是以Cookie的形式保存在浏览器的内存中的。浏览器只要关闭。这个cookie就没有了。</span><br><span class="line">  - session列表是一个Map，map的key是sessionid，map的value是session对象。</span><br><span class="line">  - 用户第一次请求，服务器生成session对象（session是保存在服务器的），同时生成id，将id发送给浏览器。</span><br><span class="line">  - 用户第二次请求，自动将浏览器内存中的id发送给服务器，服务器根据id查找session对象。</span><br><span class="line">  - 关闭浏览器，内存消失，cookie消失，sessionid消失，会话等同于结束。</span><br><span class="line"></span><br><span class="line">- Cookie禁用了，session还能找到吗？</span><br><span class="line"></span><br><span class="line">  - cookie禁用是什么意思？服务器正常发送cookie给浏览器，但是浏览器不要了。拒收了。并不是服务器不发了。</span><br><span class="line">  - 找不到了。每一次请求都会获取到新的session对象。</span><br><span class="line">  - cookie禁用了，session机制还能实现吗？</span><br><span class="line">    - 可以。需要使用URL重写机制。复制sessionid到链接后面，分号分隔</span><br><span class="line">    - http://localhost:8080/servlet12/test/session;jsessionid=19D1C99560DCBF84839FA43D58F56E16</span><br><span class="line">    - URL重写机制会提高开发者的成本。开发人员在编写任何请求路径的时候，后面都要添加一个sessionid，给开发带来了很大的难度，很大的成本。所以大部分的网站都是这样设计的：你要是禁用cookie，你就别用了。</span><br><span class="line"></span><br><span class="line">  session默认超时时间是30分钟（tomcat配置文件里的）</span><br><span class="line"></span><br><span class="line">  ~~~xml</span><br><span class="line">  &lt;session-config&gt;</span><br><span class="line">  &lt;session-timeout&gt;30&lt;/session-timeout&gt;</span><br><span class="line">  &lt;/session-config&gt;</span><br><span class="line">  ~~~</span><br><span class="line"></span><br><span class="line">- 总结一下到目前位置我们所了解的域对象：</span><br><span class="line"></span><br><span class="line">  - request（对应的类名：HttpServletRequest）</span><br><span class="line">    - 请求域（请求级别的）</span><br><span class="line">    </span><br><span class="line">  - session（对应的类名：HttpSession）</span><br><span class="line">    - 会话域（用户级别的）</span><br><span class="line">    </span><br><span class="line">  - application（对应的类名：ServletContext）</span><br><span class="line">    - 应用域（项目级别的，所有用户共享的。）</span><br><span class="line">    </span><br><span class="line">  - 这三个域对象的大小关系</span><br><span class="line">    - request &lt; session &lt; application</span><br><span class="line">    </span><br><span class="line">  - 他们三个域对象都有以下三个公共的方法：</span><br><span class="line">    - setAttribute（向域当中绑定数据）</span><br><span class="line">    </span><br><span class="line">    - getAttribute（从域当中获取数据，里面没有参数就会新建session，有false就不新建）</span><br><span class="line">    </span><br><span class="line">    - removeAttribute（删除域当中的数据）</span><br><span class="line">    </span><br><span class="line">    - 下面是两个例子</span><br><span class="line">    </span><br><span class="line">    - ![image-20251110195000186](./images/Servlet-JSP-课堂笔记/image-20251110195000186.png)</span><br><span class="line">    </span><br><span class="line">    - ~~~java</span><br><span class="line">      // 登录成功/失败</span><br><span class="line">      if(success)&#123;</span><br><span class="line">      //获取session对象(这里的要求是:必须获取到session，没有session也要新建一个session对象。)</span><br><span class="line">      HttpSession session = request.getSession();// session对象一定不是null</span><br><span class="line">      session.setAttribute( name:&quot;username&quot;,username);</span><br><span class="line">      &#125;</span><br><span class="line">      jsp在运行的时候就会创建session，可以在jsp顶部用这个代码禁止生成</span><br><span class="line">      &lt;%@page session=&quot;false&quot; %&gt;</span><br><span class="line">      ~~~</span><br><span class="line">    </span><br><span class="line">  - 使用原则：尽量使用小的域。</span><br><span class="line"></span><br><span class="line">- session掌握之后，我们怎么解决oa项目中的登录问题，怎么能让登录起作用。</span><br><span class="line"></span><br><span class="line">  - 登录成功之后，可以将用户的登录信息存储到session当中。也就是说session中如果有用户的信息就代表用户登录成功了。session中没有用户信息，表示用户没有登录过。则跳转到登录页面。</span><br><span class="line"></span><br><span class="line">- 销毁session对象（做退出功能）：</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    session.invalidate();</span><br></pre></td></tr></table></figure></code></pre></li></ul></li></ul><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><ul><li><p>session的实现原理中，每一个session对象都会关联一个sessionid，例如：</p><ul><li>JSESSIONID&#x3D;41C481F0224664BDB28E95081D23D5B8</li><li>以上的这个键值对数据其实就是cookie对象。</li><li>对于session关联的cookie来说，这个cookie是被保存在浏览器的“运行内存”当中。</li><li>只要浏览器不关闭，用户再次发送请求的时候，会自动将运行内存中的cookie发送给服务器。</li><li>例如，这个Cookie: JSESSIONID&#x3D;41C481F0224664BDB28E95081D23D5B8就会再次发送给服务器。</li><li>服务器就是根据41C481F0224664BDB28E95081D23D5B8这个值来找到对应的session对象的。</li></ul></li><li><p>cookie怎么生成？cookie保存在什么地方？cookie有啥用？浏览器什么时候会发送cookie，发送哪些cookie给服务器？？？？？？？</p></li><li><p>cookie最终是保存在浏览器客户端上的。</p><ul><li>可以保存在运行内存中。（浏览器只要关闭cookie就消失了。）</li><li>也可以保存在硬盘文件中。（永久保存。）</li></ul></li><li><p>cookie有啥用呢？</p><ul><li>cookie和session机制其实都是为了保存会话的状态。</li><li>cookie是将会话的状态保存在浏览器客户端上。（cookie数据存储在浏览器客户端上的。）</li><li>session是将会话的状态保存在服务器端上。（session对象是存储在服务器上。）</li><li>为什么要有cookie和session机制呢？因为HTTP协议是无状态 无连接协议。</li></ul></li><li><p>cookie的经典案例</p><ul><li>京东商城，在未登录的情况下，向购物车中放几件商品。然后关闭商城，再次打开浏览器，访问京东商城的时候，购物车中的商品还在，这是怎么做的？我没有登录，为什么购物车中还有商品呢？<ul><li>将购物车中的商品编号放到cookie当中，cookie保存在硬盘文件当中。这样即使关闭浏览器。硬盘上的cookie还在。下一次再打开京东商城的时候，查看购物车的时候，会自动读取本地硬盘中存储的cookie，拿到商品编号，动态展示购物车中的商品。<ul><li>京东存储购物车中商品的cookie可能是这样的：productIds&#x3D;xxxxx,yyyy,zzz,kkkk</li><li>注意：cookie如果清除掉，购物车中的商品就消失了。</li></ul></li></ul></li><li>126邮箱中有一个功能：十天内免登录<ul><li>这个功能也是需要cookie来实现的。</li><li>怎么实现的呢？<ul><li>用户输入正确的用户名和密码，并且同时选择十天内免登录。登录成功后。浏览器客户端会保存一个cookie，这个cookie中保存了用户名和密码等信息，这个cookie是保存在硬盘文件当中的，十天有效。在十天内用户再次访问126的时候，浏览器自动提交126的关联的cookie给服务器，服务器接收到cookie之后，获取用户名和密码，验证，通过之后，自动登录成功。</li><li>怎么让cookie失效？<ul><li>十天过后自动失效。</li><li>或者改密码。</li><li>或者在客户端浏览器上清除cookie。</li></ul></li></ul></li></ul></li></ul></li><li><p>cookie机制和session机制其实都不属于java中的机制，实际上cookie机制和session机制都是HTTP协议的一部分。php开发中也有cookie和session机制，只要是你是做web开发，不管是什么编程语言，cookie和session机制都是需要的。</p></li><li><p>HTTP协议中规定：任何一个cookie都是由name和value组成的。name和value都是字符串类型的。</p></li><li><p>在java的servlet中，对cookie提供了哪些支持呢？</p><ul><li>提供了一个Cookie类来专门表示cookie数据。jakarta.servlet.http.Cookie;</li><li>java程序怎么把cookie数据发送给浏览器呢？response.addCookie(cookie);</li></ul></li><li><p>在HTTP协议中是这样规定的：当浏览器发送请求的时候，会自动携带该path下的cookie数据给服务器。（URL。）</p></li><li><p>关于cookie的有效时间</p><ul><li>怎么用java设置cookie的有效时间<ul><li>cookie.setMaxAge(60 * 60); 设置cookie在一小时之后失效。</li></ul></li><li>没有设置有效时间：默认保存在浏览器的运行内存中，浏览器关闭则cookie消失。</li><li>只要设置cookie的有效时间 &gt; 0，这个cookie一定会存储到硬盘文件当中。</li><li>设置cookie的有效时间 &#x3D; 0 呢？<ul><li>cookie被删除，同名cookie被删除。</li></ul></li><li>设置cookie的有效时间 &lt; 0 呢？<ul><li>保存在运行内存中。和不设置一样。</li></ul></li></ul></li><li><p>关于cookie的path，cookie关联的路径：</p><ul><li>假设现在发送的请求路径是“<a href="http://localhost:8080/servlet13/cookie/generate%E2%80%9D%E7%94%9F%E6%88%90%E7%9A%84cookie%EF%BC%8C%E5%A6%82%E6%9E%9Ccookie%E6%B2%A1%E6%9C%89%E8%AE%BE%E7%BD%AEpath%EF%BC%8C%E9%BB%98%E8%AE%A4%E7%9A%84path%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F">http://localhost:8080/servlet13/cookie/generate”生成的cookie，如果cookie没有设置path，默认的path是什么？</a><ul><li>默认的path是：<a href="http://localhost:8080/servlet13/cookie">http://localhost:8080/servlet13/cookie</a> 以及它的子路径。</li><li>也就是说，以后只要浏览器的请求路径是<a href="http://localhost:8080/servlet13/cookie">http://localhost:8080/servlet13/cookie</a> 这个路径以及这个路径下的子路径，cookie都会被发送到服务器。</li></ul></li><li>手动设置cookie的path<ul><li>cookie.setPath(“&#x2F;servlet13”); 表示只要是这个servlet13项目的请求路径，都会提交这个cookie给服务器。</li></ul></li></ul></li><li><p>浏览器发送cookie给服务器了，服务器中的java程序怎么接收？</p><ul><li><pre><code class="language-java">Cookie[] cookies = request.getCookies(); // 这个方法可能返回nullif(cookies != null){    for(Cookie cookie : cookies){        // 获取cookie的name        String name = cookie.getName();        // 获取cookie的value        String value = cookie.getValue();    }}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 使用cookie实现一下十天内免登录功能。</span><br><span class="line"></span><br><span class="line">  - 先实现登录功能</span><br><span class="line">    - 登录成功</span><br><span class="line">      - 跳转到部门列表页面</span><br><span class="line">    - 登录失败</span><br><span class="line">      - 跳转到登录失败页面</span><br><span class="line">  - 修改前端页面</span><br><span class="line">    - 在登录页面给一个复选框，复选框后面给一句话：十天内免登录。</span><br><span class="line">    - 用户选择了复选框：表示要支持十天内免登录。</span><br><span class="line">    - 用户没有选择复选框：表示用户不想使用十天内免登录功能。</span><br><span class="line">  - 修改Servlet中的login方法</span><br><span class="line">    - 如果用户登录成功了，并且用户登录时选择了十天内免登录功能，这个时候应该在Servlet的login方法中创建cookie，用来存储用户名和密码，并且设置路径，设置有效期，将cookie响应给浏览器。（浏览器将其自动保存在硬盘文件当中10天）</span><br><span class="line">  - 用户再次访问该网站的时候，访问这个网站的首页的时候，有两个走向:</span><br><span class="line">    - 要么跳转到部门列表页面</span><br><span class="line">    - 要么跳转到登录页面</span><br><span class="line">    - 以上分别有两个走向，这显然是需要编写java程序进行控制的。</span><br><span class="line"></span><br><span class="line"># JSP</span><br><span class="line"></span><br><span class="line">- 我的第一个JSP程序：</span><br><span class="line">  </span><br><span class="line">  - 在WEB-INF目录之外创建一个index.jsp文件，然后这个文件中没有任何内容。</span><br><span class="line">  </span><br><span class="line">- 将上面的项目部署之后，启动服务器，打开浏览器，访问以下地址：</span><br><span class="line">  - http://localhost:8080/jsp/index.jsp 展现在大家面前的是一个空白。</span><br><span class="line">  - 实际上访问以上的这个：index.jsp，底层执行的是：index_jsp.class 这个java程序。</span><br><span class="line">  - 这个index.jsp会被tomcat翻译生成index_jsp.java文件，然后tomcat服务器又会将index_jsp.java编译生成index_jsp.class文件</span><br><span class="line">  - 访问index.jsp，实际上执行的是index_jsp.class中的方法。</span><br><span class="line">  </span><br><span class="line">- JSP实际上就是一个Servlet。</span><br><span class="line">  - index.jsp访问的时候，会自动翻译生成index_jsp.java，会自动编译生成index_jsp.class，那么index_jsp 这就是一个类。</span><br><span class="line">  - index_jsp 类继承 HttpJspBase，而HttpJspBase类继承的是HttpServlet。所以index_jsp类就是一个Servlet类。</span><br><span class="line">  - jsp的生命周期和Servlet的生命周期完全相同。完全就是一个东西。没有任何区别。</span><br><span class="line">  - jsp和servlet一样，都是单例的。（假单例。）</span><br><span class="line">  </span><br><span class="line">- jsp文件第一次访问的时候是比较慢的，为什么？</span><br><span class="line">  - 为什么大部分的运维人员在给客户演示项目的时候，为什么提前先把所有的jsp文件先访问一遍。</span><br><span class="line">  - 第一次比较麻烦：</span><br><span class="line">    - 要把jsp文件翻译生成java源文件</span><br><span class="line">    - java源文件要编译生成class字节码文件</span><br><span class="line">    - 然后通过class去创建servlet对象</span><br><span class="line">    - 然后调用servlet对象的init方法</span><br><span class="line">    - 最后调用servlet对象的service方法。</span><br><span class="line">  - 第二次就比较快了，为什么？</span><br><span class="line">    - 因为第二次直接调用单例servlet对象的service方法即可。</span><br><span class="line">  </span><br><span class="line">- JSP是什么？</span><br><span class="line">  - JSP是java程序。（JSP本质还是一个Servlet）</span><br><span class="line">  - JSP是：JavaServer Pages的缩写。（基于Java语言实现的服务器端的页面。）</span><br><span class="line">  - Servlet是JavaEE的13个子规范之一，那么JSP也是JavaEE的13个子规范之一。</span><br><span class="line">  - JSP是一套规范。所有的web容器/web服务器都是遵循这套规范的，都是按照这套规范进行的“翻译”</span><br><span class="line">  - 每一个web容器/web服务器都会内置一个JSP翻译引擎。</span><br><span class="line">  </span><br><span class="line">- 对JSP进行错误调试的时候，还是要直接打开JSP文件对应的java文件，检查java代码。</span><br><span class="line"></span><br><span class="line">- 开发JSP的最高境界：</span><br><span class="line">  </span><br><span class="line">  - 眼前是JSP代码，但是脑袋中呈现的是java代码。</span><br><span class="line">  </span><br><span class="line">- JSP既然本质上是一个Servlet，那么JSP和Servlet到底有什么区别呢？</span><br><span class="line">  - 职责不同：</span><br><span class="line">    - Servlet的职责是什么：收集数据。（Servlet的强项是逻辑处理，业务处理，然后链接数据库，获取/收集数据。）</span><br><span class="line">    - JSP的职责是什么：展示数据。（JSP的强项是做数据的展示）</span><br><span class="line">  </span><br><span class="line">- JSP的基础语法</span><br><span class="line">  - 在jsp文件中直接编写文字，都会自动被翻译到哪里？</span><br><span class="line">    - 翻译到servlet类的service方法的out.write(&quot;翻译到这里&quot;)，直接翻译到双引号里，被java程序当做普通字符串打印输出到浏览器。</span><br><span class="line">    - 在JSP中编写的HTML CSS JS代码，这些代码对于JSP来说只是一个普通的字符串。但是JSP把这个普通的字符串一旦输出到浏览器，浏览器就会对HTML CSS JS进行解释执行。展现一个效果。</span><br><span class="line">    </span><br><span class="line">  - JSP的page指令（这个指令后面再详细说，这里先解决一下中文乱码问题），解决响应时的中文乱码问题：</span><br><span class="line">    - 通过page指令来设置响应的内容类型，在内容类型的最后面添加：charset=UTF-8</span><br><span class="line">      - ~~~jsp</span><br><span class="line">        &lt;%@page contentType=&quot;text/html;charset=UTF-8&quot;%&gt;，表示响应的内容类型是text/html，采用的字符集UTF-8</span><br><span class="line">        ~~~</span><br><span class="line">      </span><br><span class="line">      - ~~~jsp</span><br><span class="line">        &lt;%@page import=&quot;java.util.List,java.util.ArrayList&quot;%&gt;</span><br><span class="line">        ~~~</span><br><span class="line">    </span><br><span class="line">  - 怎么在JSP中编写Java程序：</span><br><span class="line">    - &lt;% java语句; %&gt;</span><br><span class="line">      - 在这个符号当中编写的被视为java程序，被翻译到Servlet类的service方法内部。</span><br><span class="line">      - 这里你要细心点，你要思考，在&lt;% %&gt;这个符号里面写java代码的时候，你要时时刻刻的记住你正在“方法体”当中写代码，方法体中可以写什么，不可以写什么，你心里是否明白呢？</span><br><span class="line">      - 在service方法当中编写的代码是有顺序的，方法体当中的代码要遵循自上而下的顺序依次逐行执行。</span><br><span class="line">      - service方法当中不能写静态代码块，不能写方法，不能定义成员变量。。。。。。</span><br><span class="line">      - 在同一个JSP当中 &lt;%%&gt; 这个符号可以出现多个。</span><br><span class="line">    - &lt;%! %&gt;</span><br><span class="line">      - 在这个符号当中编写的java程序会自动翻译到service方法之外。</span><br><span class="line">      - 这个语法很少用，为什么？不建议使用，因为在service方法外面写静态变量和实例变量，都会存在线程安全问题，因为JSP就是servlet，servlet是单例的，多线程并发的环境下，这个静态变量和实例变量一旦有修改操作，必然会存在线程安全问题。</span><br><span class="line">    </span><br><span class="line">    - JSP的输出语句</span><br><span class="line">      - 怎么向浏览器上输出一个java变量。</span><br><span class="line">      - &lt;% String name = “jack”;  out.write(&quot;name = &quot; + name); %&gt;</span><br><span class="line">      - 注意：以上代码中的out是JSP的九大内置对象之一。可以直接拿来用。当然，必须只能在service方法内部使用。</span><br><span class="line">      - 如果向浏览器上输出的内容中没有“java代码”，例如输出的字符串是一个固定的字符串，可以直接在jsp中编写，不需要写到&lt;%%&gt; 这里。</span><br><span class="line">      - 如果输出的内容中含有“java代码”，这个时候可以使用以下语法格式：</span><br><span class="line">        - &lt;%= %&gt; 注意：在=的后面编写要输出的内容。</span><br><span class="line">        - &lt;%= %&gt; 这个符号会被翻译到哪里？最终翻译成什么？ </span><br><span class="line">          - 翻译成了这个java代码：   out.print();</span><br><span class="line">          - 翻译到service方法当中了。</span><br><span class="line">        - 什么时候使用&lt;%=%&gt; 输出呢？输出的内容中含有java的变量，输出的内容是一个动态的内容，不是一个死的字符串。如果输出的是一个固定的字符串，直接在JSP文件中编写即可。</span><br><span class="line">    </span><br><span class="line">  - 在JSP中如何编写JSP的专业注释</span><br><span class="line">    - &lt;%--JSP的专业注释，不会被翻译到java源代码当中。--%&gt;</span><br><span class="line">    - &lt;!--这种注释属于HTML的注释，这个注释信息仍然会被翻译到java源代码当中，不建议。--&gt;</span><br><span class="line">    </span><br><span class="line">  - JSP基础语法总结：</span><br><span class="line">    - JSP中直接编写普通字符串</span><br><span class="line">      - 翻译到service方法的out.write(&quot;这里&quot;)</span><br><span class="line">    - &lt;%%&gt;</span><br><span class="line">      - 翻译到service方法体内部，里面是一条一条的java语句。</span><br><span class="line">    - &lt;%! %&gt;</span><br><span class="line">      - 翻译到service方法之外。</span><br><span class="line">    - &lt;%= %&gt;</span><br><span class="line">      - 翻译到service方法体内部，翻译为：out.print();</span><br><span class="line">    - &lt;%@page  contentType=&quot;text/html;charset=UTF-8&quot;%&gt;</span><br><span class="line">      - page指令，通过contentType属性用来设置响应的内容类型。</span><br><span class="line">    </span><br><span class="line">  - 使用Servlet + JSP完成oa项目的改造。</span><br><span class="line">    - 使用Servlet处理业务，收集数据。 使用JSP展示数据。</span><br><span class="line">  </span><br><span class="line">    - 将之前原型中的html文件，全部修改为jsp，然后在jsp文件头部添加page指令（指定contentType防止中文乱码），将所有的JSP直接拷贝到web目录下。</span><br><span class="line">  </span><br><span class="line">    - 完成所有页面的正常流转。（页面仍然能够正常的跳转。修改超链接的请求路径。）</span><br><span class="line">      </span><br><span class="line">      - &lt;%=request.getContextPath() %&gt;  在JSP中动态的获取应用的根路径。</span><br><span class="line">      </span><br><span class="line">    - Servlet中连接数据库，查询所有的部门，遍历结果集。</span><br><span class="line">      - 遍历结果集的过程中，取出部门编号、部门名、位置等信息，封装成java对象（bean）。</span><br><span class="line">      - 将java对象存放到List集合中。</span><br><span class="line">      - 将List集合存储到request域当中。</span><br><span class="line">      - 转发forward到jsp。</span><br><span class="line">      </span><br><span class="line">    - 在JSP中：</span><br><span class="line">      - 从request域当中取出List集合。</span><br><span class="line">      - 遍历List集合，取出每个部门对象。动态生成tr。</span><br><span class="line">      </span><br><span class="line">    - 思考一个问题：如果我只用JSP这一个技术，能不能开发web应用？</span><br><span class="line">  </span><br><span class="line">      - 当然可以使用JSP来完成所有的功能。因为JSP就是Servlet，在JSP的&lt;%%&gt;里面写的代码就是在service方法当中的，所以在&lt;%%&gt;当中完全可以编写JDBC代码，连接数据库，查询数据，也可以在这个方法当中编写业务逻辑代码，处理业务，都是可以的，所以使用单独的JSP开发web应用完全没问题。</span><br><span class="line">      - 虽然JSP一个技术就可以完成web应用，但是不建议，还是建议采用servlet + jsp的方式进行开发。这样都能将各自的优点发挥出来。JSP就是做数据展示。Servlet就是做数据的收集。（JSP中编写的Java代码越少越好。）一定要职责分明。</span><br><span class="line">  </span><br><span class="line">    - JSP文件的扩展名必须是xxx.jsp吗？</span><br><span class="line">  </span><br><span class="line">      - jsp文件的扩展名是可以配置的。不是固定的。</span><br><span class="line">  </span><br><span class="line">      - 在CATALINA_HOME/conf/web.xml，在这个文件当中配置jsp文件的扩展名。</span><br><span class="line">  </span><br><span class="line">      - ```xml</span><br><span class="line">        &lt;servlet-mapping&gt;</span><br><span class="line">            &lt;servlet-name&gt;jsp&lt;/servlet-name&gt;</span><br><span class="line">            &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;</span><br><span class="line">            &lt;url-pattern&gt;*.jspx&lt;/url-pattern&gt;</span><br><span class="line">        &lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure>  - xxx.jsp文件对于小猫咪来说，只是一个普通的文本文件，web容器会将xxx.jsp文件最终生成java程序，最终调用的是java对象相关的方法，真正执行的时候，和jsp文件就没有关系了。  - 小窍门：JSP如果看不懂，建议把jsp翻译成java代码，就能看懂了。- 同学问：包名bean是什么意思？  - javabean（java的logo是一杯冒着热气的咖啡。javabean被翻译为：咖啡豆）  - java是一杯咖啡，咖啡又是由一粒一粒的咖啡豆研磨而成。  - 整个java程序中有很多bean的存在。由很多bean组成。  - 什么是javabean？实际上javabean你可以理解为符合某种规范的java类，比如：    - 有无参数构造方法    - 属性私有化    - 对外提供公开的set和get方法    - 实现java.io.Serializable接口    - 重写toString    - 重写hashCode+equals    - ....  - javabean其实就是java中的实体类。负责数据的封装。  - 由于javabean符合javabean规范，具有更强的通用性。- 完成剩下所有功能的改造。</code></pre></li></ul></li><li><p>当前的oa应用存在的问题：</p><ul><li>任何一个用户都可以访问这个系统，都可以对这个系统当中的数据进行增删改这些危险的操作。我只想让合法的用户去使用这个系统，不合法的用户不能访问这个系统，怎么办？<ul><li>加一个登录功能。登录成功的可以访问该系统，登录失败不能访问。</li></ul></li><li>实现登录功能：<ul><li>步骤1：数据库当中添加一个用户表：t_user<ul><li>t_user表当中存储的是用户的登录信息，最基本的也包括：登录的用户名和登录的密码。</li><li>密码一般在数据库表当中存储的是密文。一般不以明文的形式存储。（这里先使用明文方式。）</li><li>向t_user表中插入数据。</li></ul></li><li>步骤2：再实现一个登录页面。<ul><li>登录页面上应该有一个登录的表单。有用户名和密码输入的框。</li><li>用户点击登录，提交表单，提交用户名和密码。form是post方式提交。</li></ul></li><li>步骤3：后台要有一个对应的Servlet来处理登录的请求。<ul><li>登录成功：跳转到部门列表页面。</li><li>登录失败：跳转到失败的页面。</li></ul></li><li>步骤4：再提供一个登录失败的页面。</li></ul></li></ul></li><li><p>登录功能实现了，目前存在的最大的问题：</p><ul><li>这个登录功能目前只是一个摆设，没有任何作用。只要用户知道后端的请求路径，照样可以在不登录的情况下访问。</li><li>这个登录没有真正起到拦截的作用。怎么解决？</li></ul></li><li><p>JSP的指令</p><ul><li><p>指令的作用：指导JSP的翻译引擎如何工作（指导当前的JSP翻译引擎如何翻译JSP文件。）</p></li><li><p>指令包括哪些呢？</p></li><li><p><img src="/./images/Servlet-JSP-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/image-20251112022513942.png" alt="image-20251112022513942"></p><ul><li>include指令：包含指令，在JSP中完成静态包含，很少用了。（这里不讲）</li><li>taglib指令：引入标签库的指令。这个到JJSTL标签库的时候再学习。现在先不管。</li><li>page指令：目前重点学习一个page指令。</li></ul></li><li><p>指令的使用语法是什么？</p><ul><li>&lt;%@指令名  属性名&#x3D;属性值  属性名&#x3D;属性值  属性名&#x3D;属性值….%&gt;</li></ul></li><li><p>关于page指令当中都有哪些常用的属性呢？</p><ul><li><pre><code class="language-jsp">&lt;%@page session=&quot;true|false&quot; %&gt;true表示启用JSP的内置对象session，表示一定启动session对象。没有session对象会创建。如果没有设置，默认值就是session=&quot;true&quot;session=&quot;false&quot; 表示不启动内置对象session。当前JSP页面中无法使用内置对象session。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  &lt;%@page contentType=&quot;text/json&quot; %&gt;</span><br><span class="line">  contentType属性用来设置响应的内容类型</span><br><span class="line">  但同时也可以设置字符集。</span><br><span class="line">  &lt;%@page contentType=&quot;text/json;charset=UTF-8&quot; %&gt;</span><br></pre></td></tr></table></figure></code></pre></li><li><pre><code>&lt;%@page pageEncoding=&quot;UTF-8&quot; %&gt;pageEncoding=&quot;UTF-8&quot; 表示设置响应时采用的字符集。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  &lt;%@page import=&quot;java.util.List, java.util.Date, java.util.ArrayList&quot; %&gt;</span><br><span class="line">  &lt;%@page import=&quot;java.util.*&quot; %&gt;</span><br><span class="line">  import语句，导包。</span><br></pre></td></tr></table></figure></code></pre></li><li><pre><code>&lt;%@page errorPage=&quot;/error.jsp&quot; %&gt;当前页面出现异常之后，跳转到error.jsp页面。errorPage属性用来指定出错之后的跳转位置。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  &lt;%@page isErrorPage=&quot;true&quot; %&gt;</span><br><span class="line">  表示可以在当前页启用JSP九大内置对象之一：exception</span><br><span class="line">  默认值是false。</span><br></pre></td></tr></table></figure></code></pre></li></ul></li></ul></li><li><p>JSP的九大内置对象</p><ul><li><p>jakarta.servlet.jsp.PageContext pageContext       页面作用域</p></li><li><p>jakarta.servlet.http.HttpServletRequest request 请求作用域</p></li><li><p>jakarta.servlet.http.HttpSession session  会话作用域</p></li><li><p>jakarta.servlet.ServletContext application 应用作用域</p><ul><li>pageContext &lt; request &lt; session &lt; application</li><li>以上四个作用域都有：setAttribute、getAttribute、removeAttribute方法。</li><li>以上作用域的使用原则：尽可能使用小的域。</li></ul></li><li><p>java.lang.Throwable exception   </p></li><li><p>jakarta.servlet.ServletConfig config</p></li><li><p>java.lang.Object page  （其实是this，当前的servlet对象）</p></li><li><p>jakarta.servlet.jsp.JspWriter out  （负责输出）</p></li><li><p>jakarta.servlet.http.HttpServletResponse response （负责响应）</p></li></ul></li></ul><h1 id="EL表达式"><a href="#EL表达式" class="headerlink" title="EL表达式"></a>EL表达式</h1><ul><li><p>EL表达式是干什么用的？</p><ul><li>Expression Language（表达式语言）</li><li>EL表达式可以代替JSP中的java代码，让JSP文件中的程序看起来更加整洁，美观。</li><li>JSP中夹杂着各种java代码，例如&lt;% java代码 %&gt;、&lt;%&#x3D;%&gt;等，导致JSP文件很混乱，不好看，不好维护。所以才有了后期的EL表达式。</li><li>EL表达式可以算是JSP语法的一部分。EL表达式归属于JSP。</li></ul></li><li><p>EL表达式出现在JSP中主要是：</p><ul><li>从某个作用域中取数据（只负责取不负责存），然后将其转换成字符串，然后将其输出到浏览器。这就是EL表达式的功效。三大功效：<ul><li>第一功效：从某个域中取数据。<ul><li>四个域：<ul><li>pageContext</li><li>request</li><li>session</li><li>application</li></ul></li></ul></li><li>第二功效：将取出的数据转成字符串。<ul><li>如果是一个java对象，也会自动调用java对象的toString方法将其转换成字符串。</li></ul></li><li>第三功效：将字符串输出到浏览器。<ul><li>和这个一样：&lt;%&#x3D; %&gt;，将其输出到浏览器。</li></ul></li></ul></li></ul></li><li><p>EL表达式很好用，基本的语法格式：</p><ul><li>${表达式}</li></ul></li><li><p>EL表达式的使用：</p><ul><li><pre><code class="language-jsp">&lt;%    // 创建User对象并存数据    User user = new User();    user.setUsername(&quot;jackson&quot;);    user.setPassword(&quot;1234&quot;);    user.setAge(50);    // 将User对象存储到某个域当中。一定要存，因为EL表达式只能从某个范围中取数据。    // 数据是必须存储到四大范围之一的。    request.setAttribute(&quot;userObj&quot;, user);%&gt;&lt;%--使用EL表达式取--%&gt;${这个位置写什么？？？？这里写的一定是存储到域对象当中时的name}要这样写：${userObj}等同于java代码：&lt;%=request.getAttribute(&quot;userObj&quot;)%&gt;你不要这样写：${&quot;userObj&quot;}面试题：    ${abc} 和 ${&quot;abc&quot;}的区别是什么？        ${abc}表示从某个域中取出数据，并且被取的这个数据的name是&quot;abc&quot;，之前一定有这样的代码: 域.setAttribute(&quot;abc&quot;, 对象);        ${&quot;abc&quot;} 表示直接将&quot;abc&quot;当做普通字符串输出到浏览器。不会从某个域中取数据了。${userObj} 底层是怎么做的？从域中取数据，取出user对象，然后调用user对象的toString方法，转换成字符串，输出到浏览器。&lt;%--如果想输出对象的属性值，怎么办？--%&gt;${userObj.username} 使用这个语法的前提是：User对象有getUsername()方法。${userObj.password} 使用这个语法的前提是：User对象有getPassword()方法。${userObj.age} 使用这个语法的前提是：User对象有getAge()方法。${userObj.email} 使用这个语法的前提是：User对象有getEmail()方法。EL表达式中的. 这个语法，实际上调用了底层的getXxx()方法。注意：如果没有对应的get方法，则出现异常。报500错误。${userObj.addr222.zipcode}以上EL表达式对应的java代码：user.getAddr222().getZipcode()<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- EL表达式优先从小范围中读取数据。</span><br><span class="line"></span><br><span class="line">  - pageContext &lt; request &lt; session &lt; application</span><br><span class="line"></span><br><span class="line">- EL表达式中有四个隐含的隐式的范围：</span><br><span class="line"></span><br><span class="line">  - pageScope 对应的是 pageContext范围。</span><br><span class="line">  - requestScope 对应的是 request范围。</span><br><span class="line">  - sessionScope 对应的是 session范围。</span><br><span class="line">  - applicationScope 对应的是 application范围。</span><br><span class="line"></span><br><span class="line">- EL表达式对null进行了预处理。如果是null，则向浏览器输出一个空字符串。</span><br><span class="line"></span><br><span class="line">- EL表达式取数据的时候有两种形式：</span><br><span class="line"></span><br><span class="line">  - 第一种：.  （大部分使用这种方式）</span><br><span class="line">  - 第二种：[ ] （如果存储到域的时候，这个name中含有特殊字符，可以使用 [ ]）</span><br><span class="line">    - request.setAttribute(&quot;abc.def&quot;, &quot;zhangsan&quot;);</span><br><span class="line">    - $&#123;requestScope.abc.def&#125; 这样是无法取值的。</span><br><span class="line">    - 应该这样：$&#123;requestScope[&quot;abc.def&quot;]&#125;</span><br><span class="line"></span><br><span class="line">- 掌握使用EL表达式，怎么从Map集合中取数据：</span><br><span class="line"></span><br><span class="line">  - $&#123;map.key&#125;</span><br><span class="line"></span><br><span class="line">- 掌握使用EL表达式，怎么从数组和List集合中取数据：</span><br><span class="line"></span><br><span class="line">  - $&#123;数组[0]&#125;</span><br><span class="line">  - $&#123;数组[1]&#125;</span><br><span class="line">  - $&#123;list[0]&#125;</span><br><span class="line"></span><br><span class="line">- page指令当中，有一个属性，可以忽略EL表达式，就被当成普通字符串输出了</span><br><span class="line"></span><br><span class="line">  - ```</span><br><span class="line">    &lt;%@page contentType=&quot;text/html;charset=UTF-8&quot; isELIgnored=&quot;true&quot; %&gt;</span><br><span class="line">    isELIgnored=&quot;true&quot; 表示忽略EL表达式</span><br><span class="line">    isELIgnored=&quot;false&quot; 表示不忽略EL表达式。（这是默认值）</span><br><span class="line">    </span><br><span class="line">    isELIgnored=&quot;true&quot; 这个是全局的控制。</span><br><span class="line">    </span><br><span class="line">    可以使用反斜杠进行局部控制：\$&#123;username&#125; 这样也可以忽略EL表达式。</span><br></pre></td></tr></table></figure></code></pre></li><li><p>通过EL表达式获取应用的根：</p><ul><li><p>${pageContext.request.contextPath}</p></li><li><pre><code class="language-jsp">&lt;%--pagecontext.getReguest()是获取request对象。而JSP中自带了内置对象request，直接用reqvest内置对象就行了。这两请求的request地址都是同一个-%&gt;&lt;%=pageContext.getRequest()%&gt;&lt;br&gt;&lt;%=request %&gt;&lt;%-在EL表达式当中没有request这个隐式对象。requestScope 这个只代表“请求范围”。不等同于request对象。在EL表达式当中有一个隐式的对象:pageContextEL表达式中的pageContext和JSP中的九大内置对象pageContext是同一个对象，那么上面的代码就可以写成下面这个%&gt;${pageContext.request}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- EL表达式中其他的隐式对象：</span><br><span class="line"></span><br><span class="line">  - pageContext根路径</span><br><span class="line"></span><br><span class="line">  - param获取的是请求参数一维数组当中的第一个元素。</span><br><span class="line"></span><br><span class="line">    - ~~~jsp</span><br><span class="line">      用户名:&lt;%=request.getParameter(&quot;username&quot;)%&gt;&lt;br&gt;</span><br><span class="line">      用户名:$&#123;param.username&#125;</span><br></pre></td></tr></table></figure></code></pre></li><li><p>paramValues获取数组当中的元素:[下标]</p><ul><li><pre><code class="language-jsp">爱好:${paramValues.aihao[0]}、${paramValues.aihao[1]}、${paramValues.aihao[2]}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">- initParam</span><br><span class="line">  </span><br><span class="line">  - ~~~jsp</span><br><span class="line">    &lt;!--Servlet上下文初始化参数--&gt;这些是xml里的</span><br><span class="line">    &lt;!--上下文初始化参数被封装到，ServletContext对象当中了。--&gt;</span><br><span class="line">    &lt;context-param&gt;</span><br><span class="line">    &lt;param-name&gt;pageSize&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;20&lt;/param-value&gt;</span><br><span class="line">    &lt;/context-param&gt;</span><br><span class="line">    &lt;context-param&gt;</span><br><span class="line">    &lt;param-name&gt;pageNum&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;5&lt;/param-value&gt;</span><br><span class="line">    &lt;/context-param&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;%--EL表达式中的隐含对象:initParam--%&gt;</span><br><span class="line">    &lt;%--ServletContext是Servlet上下文对象，对应的JSP九大内置对象之一是:application--%&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">    String a=application.getInitParameter(&quot;pageSize&quot;);</span><br><span class="line">    String b=application.getInitParameter(&quot;pageNum&quot;);</span><br><span class="line">    %&gt;</span><br><span class="line">    每页显示的记录条数:&lt;%=a%&gt;&lt;br&gt;</span><br><span class="line">    页码:&lt;%=b%&gt;&lt;br&gt;</span><br><span class="line">    每页显示的记录条数:&lt;%=application.getInitParameter(&quot;pageSize&quot;)%&gt;&lt;br&gt;</span><br><span class="line">    页码:&lt;%=application.getInitParameter(&quot;pageNum&quot;)%&gt; &lt;br&gt;</span><br><span class="line">    每页显示的记录条数:$&#123;initParam.pageSize&#125;&lt;br&gt;</span><br><span class="line">    页码:$&#123;initParam.pageNum&#125; &lt;br&gt;</span><br></pre></td></tr></table></figure></code></pre></li></ul></li></ul></li><li><p>EL表达式的运算符</p><ul><li><p>算术运算符</p><ul><li><p>+、-、*、&#x2F;、%</p></li><li><pre><code class="language-jsp">&lt;%--在EL表达式当中&quot;+&quot;运算符只能做求和运算。不会进行字符串拼接操作。 --%&gt;&lt;%--&quot;20&quot;会被自动转换成数字20，转不成数字就报错--%&gt;${10 +&quot;20&quot;} &lt;br&gt;</code></pre></li></ul></li><li><p>关系运算符</p><ul><li><input disabled="" type="checkbox"> &#x3D;&#x3D; eq !&#x3D; &gt; &gt;&#x3D; &lt; &lt;&#x3D;</li></ul></li><li><p>逻辑运算符</p><ul><li><input disabled="" type="checkbox"> !  &amp;&amp; ||  not and or</li></ul></li><li><p>条件运算符</p><ul><li><input disabled="" type="checkbox"> ? :</li></ul></li><li><p>取值运算符</p><ul><li>[ ]和.</li></ul></li><li><p>empty运算符</p><ul><li><input disabled="" type="checkbox"> empty运算符的结果是boolean类型</li><li><input disabled="" type="checkbox"> ${empty param.username}</li><li><input disabled="" type="checkbox"> ${not empty param.username}</li><li><input disabled="" type="checkbox"> ${!empty param.password}</li></ul></li></ul></li></ul></li></ul><h1 id="JSTL标签库"><a href="#JSTL标签库" class="headerlink" title="JSTL标签库"></a>JSTL标签库</h1><ul><li><p>什么是JSTL标签库？</p><ul><li>Java Standard Tag Lib（Java标准的标签库）</li><li>JSTL标签库通常结合EL表达式一起使用。目的是让JSP中的java代码消失。</li><li>标签是写在JSP当中的，但实际上最终还是要执行对应的java程序。（java程序在jar包当中。）</li></ul></li><li><p>使用JSTL标签库的步骤：</p><ul><li><p>第一步：引入JSTL标签库对应的jar包。</p><ul><li>tomcat10之后引入的jar包是：<ul><li>jakarta.servlet.jsp.jstl-2.0.0.jar</li><li>jakarta.servlet.jsp.jstl-api-2.0.0.jar</li></ul></li><li>在IDEA当中怎么引入？<ul><li>在WEB-INF下新建lib目录，然后将jar包拷贝到lib当中。然后将其“Add Lib…”</li><li>一定是要和mysql的数据库驱动一样，都是放在WEB-INF&#x2F;lib目录下的。</li><li>什么时候需要将jar包放到WEB-INF&#x2F;lib目录下？如果这个jar是tomcat服务器没有的。</li></ul></li></ul></li><li><p>第二步：在JSP中引入要使用标签库。（使用taglib指令引入标签库。）</p><ul><li><p>JSTL提供了很多种标签，你要引入哪个标签？？？？重点掌握核心标签库。</p></li><li><pre><code>&lt;%@taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;这个就是核心标签库。prefix=&quot;这里随便起一个名字就行了，核心标签库，大家默认的叫做c，你随意。&quot;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">  - 第三步：在需要使用标签的位置使用即可。表面使用的是标签，底层实际上还是java程序。</span><br><span class="line">  </span><br><span class="line">- JSTL标签的原理</span><br><span class="line"></span><br><span class="line">  - ```</span><br><span class="line">    &lt;%@taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;</span><br><span class="line">    以上uri后面的路径实际上指向了一个xxx.tld文件。</span><br><span class="line">    tld文件实际上是一个xml配置文件。</span><br><span class="line">    在tld文件中描述了“标签”和“java类”之间的关系。</span><br><span class="line">    以上核心标签库对应的tld文件是：c.tld文件。它在哪里。</span><br><span class="line">    在jakarta.servlet.jsp.jstl-2.0.0.jar里面META-INF目录下，有一个c.tld文件。</span><br></pre></td></tr></table></figure></code></pre></li></ul></li><li><p>源码解析：配置文件tld解析</p><ul><li><pre><code>&lt;tag&gt;    &lt;description&gt;对该标签的描述&lt;/description&gt;    &lt;name&gt;catch&lt;/name&gt; 标签的名字    &lt;tag-class&gt;org.apache.taglibs.standard.tag.common.core.CatchTag&lt;/tag-class&gt; 标签对应的java类。    &lt;body-content&gt;JSP&lt;/body-content&gt; 标签体当中可以出现的内容，如果是JSP，就表示标签体中可以出现符合JSP所有语法的代码。例如EL表达式。    &lt;attribute&gt;        &lt;description&gt;            对这个属性的描述        &lt;/description&gt;        &lt;name&gt;var&lt;/name&gt; 属性名        &lt;required&gt;false&lt;/required&gt; false表示该属性不是必须的。true表示该属性是必须的。        &lt;rtexprvalue&gt;false&lt;/rtexprvalue&gt; 这个描述说明了该属性是否支持EL表达式。false表示不支持。true表示支持EL表达式。    &lt;/attribute&gt;  &lt;/tag&gt;&lt;c:catch var=&quot;&quot;&gt;    JSP....&lt;/c:catch&gt;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">- jstl中的核心标签库core当中有哪些常用的标签呢？</span><br><span class="line"></span><br><span class="line">  - c:if</span><br><span class="line"></span><br><span class="line">    - &lt;c:if test=&quot;boolean类型，支持EL表达式&quot;&gt;&lt;/c: if&gt;</span><br><span class="line"></span><br><span class="line">  - c:forEach</span><br><span class="line"></span><br><span class="line">    - &lt;c:forEach items=&quot;集合，支持EL表达式&quot; var=&quot;集合中的元素&quot; varStatus=&quot;元素状态对象&quot;&gt; $&#123;元素状态对象.count&#125; &lt;/c: forEach&gt;</span><br><span class="line">    - &lt;c:forEach var=&quot;i&quot; begin=&quot;1&quot; end=&quot;10&quot; step=&quot;2&quot;&gt; $&#123;i&#125; &lt;/c: forEach&gt;</span><br><span class="line"></span><br><span class="line">  - c:choose c:when c:otherwise</span><br><span class="line"></span><br><span class="line">    - ```</span><br><span class="line">      &lt;c:choose&gt;</span><br><span class="line">          &lt;c:when test=&quot;$&#123;param.age &lt; 18&#125;&quot;&gt;</span><br><span class="line">              青少年</span><br><span class="line">          &lt;/c:when&gt;</span><br><span class="line">          &lt;c:when test=&quot;$&#123;param.age &lt; 35&#125;&quot;&gt;</span><br><span class="line">              青年</span><br><span class="line">          &lt;/c:when&gt;</span><br><span class="line">          &lt;c:when test=&quot;$&#123;param.age &lt; 55&#125;&quot;&gt;</span><br><span class="line">              中年</span><br><span class="line">          &lt;/c:when&gt;</span><br><span class="line">          &lt;c:otherwise&gt;</span><br><span class="line">              老年</span><br><span class="line">          &lt;/c:otherwise&gt;</span><br><span class="line">      &lt;/c:choose&gt;</span><br></pre></td></tr></table></figure></code></pre></li></ul></li></ul></li></ul><h2 id="改造OA"><a href="#改造OA" class="headerlink" title="改造OA"></a>改造OA</h2><ul><li><p>使用什么技术改造呢？</p><ul><li>Servlet + JSP + EL表达式 + JSTL标签。进行改造。</li></ul></li><li><p>在前端HTML代码中，有一个标签，叫做base标签，这个标签可以设置整个网页的基础路径。</p><ul><li><p>这是Java的语法，也不是JSP的语法。是HTML中的一个语法。HTML中的一个标签。通常出现在head标签中。</p></li><li><p>&lt; base href&#x3D;”<a href="http://localhost:8080/oa/%22%3E">http://localhost:8080/oa/&quot;&gt;</a></p></li><li><p>在当前页面中，凡是路径没有以“&#x2F;”开始的，都会自动将base中的路径添加到这些路径之前。</p><ul><li>&lt; a href&#x3D;”ab&#x2F;def”&gt;&lt;&#x2F; a&gt;</li><li>等同于：&lt; a href&#x3D;”<a href="http://localhost:8080/oa/ab/def%22%3E">http://localhost:8080/oa/ab/def&quot;&gt;</a>&lt;&#x2F; a&gt;</li></ul></li><li><p>需要注意：在JS代码中的路径，保险起见，最好不要依赖base标签。JS代码中的路径最好写上全路径。</p></li><li><pre><code>&lt;base href=&quot;${pageContext.request.scheme}://${pageContext.request.serverName}:${pageContext.request.serverPort}${pageContext.request.contextPath}/&quot;&gt;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># Filter过滤器</span><br><span class="line"></span><br><span class="line">- 当前的OA项目存在什么缺陷？</span><br><span class="line">  - DeptServlet、EmpServlet、OrderServlet。每一个Servlet都是处理自己相关的业务。在这些Servlet执行之前都是需要判断用户是否登录了。如果用户登录了，可以继续操作，如果没有登录，需要用户登录。这段判断用户是否登录的代码是固定的，并且在每一个Servlet类当中都需要编写，显然代码没有得到重复利用。包括每一个Servlet都要解决中文乱码问题，也有公共的代码。这些代码目前都是重复编写，并没有达到复用。怎么解决这个问题?</span><br><span class="line">    - 可以使用Servlet规范中的Filter过滤器来解决这个问题。</span><br><span class="line">  </span><br><span class="line">- Filter是什么，有什么用，执行原理是什么？</span><br><span class="line">  - Filter是过滤器。</span><br><span class="line">  - Filter可以在Servlet这个目标程序执行之前添加代码。也可以在目标Servlet执行之后添加代码。之前之后都可以添加过滤规则。</span><br><span class="line">  - 一般情况下，都是在过滤器当中编写公共代码。</span><br><span class="line">  </span><br><span class="line">- 一个过滤器怎么写呢？</span><br><span class="line"></span><br><span class="line">  - 第一步：编写一个Java类实现一个接口：jarkata.servlet.Filter。并且实现这个接口当中所有的方法。</span><br><span class="line"></span><br><span class="line">    - init方法：在Filter对象第一次被创建之后调用，并且只调用一次。</span><br><span class="line">    - doFilter方法：只要用户发送一次请求，则执行一次。发送N次请求，则执行N次。在这个方法中编写过滤规则。![image-20251113031501487](./images/Servlet-JSP-课堂笔记/image-20251113031501487.png)</span><br><span class="line">    - destroy方法：在Filter对象被释放/销毁之前调用，并且只调用一次。</span><br><span class="line"></span><br><span class="line">  - 第二步：在web.xml文件中对Filter进行配置。这个配置和Servlet很像。</span><br><span class="line"></span><br><span class="line">    - ```</span><br><span class="line">      &lt;filter&gt;</span><br><span class="line">          &lt;filter-name&gt;filter2&lt;/filter-name&gt;</span><br><span class="line">          &lt;filter-class&gt;com.bjpowernode.javaweb.servlet.Filter2&lt;/filter-class&gt;</span><br><span class="line">      &lt;/filter&gt;</span><br><span class="line">      &lt;filter-mapping&gt;</span><br><span class="line">          &lt;filter-name&gt;filter2&lt;/filter-name&gt;</span><br><span class="line">          &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;</span><br><span class="line">      &lt;/filter-mapping&gt;</span><br></pre></td></tr></table></figure>- 或者使用注解：@WebFilter({&quot;*.do&quot;})</code></pre></li></ul></li><li><p>注意：</p><ul><li>Servlet对象默认情况下，在服务器启动的时候是不会新建对象的。</li><li>Filter对象默认情况下，在服务器启动的时候会新建对象。</li><li>Servlet是单例的。Filter也是单例的。（单实例。）</li></ul></li><li><p>目标Servlet是否执行，取决于两个条件：</p><ul><li>第一：在过滤器当中是否编写了：chain.doFilter(request, response); 代码。</li><li>第二：用户发送的请求路径是否和Servlet的请求路径一致。</li></ul></li><li><p>chain.doFilter(request, response); 这行代码的作用：</p><ul><li>执行下一个过滤器，如果下面没有过滤器了，执行最终的Servlet。</li></ul></li><li><p>注意：Filter的优先级，天生的就比Servlet优先级高。</p><ul><li>&#x2F;a.do 对应一个Filter，也对应一个Servlet。那么一定是先执行Filter，然后再执行Servlet。</li></ul></li><li><p>关于Filter的配置路径：</p><ul><li>&#x2F;a.do、&#x2F;b.do、&#x2F;dept&#x2F;save。这些配置方式都是精确匹配。</li><li>&#x2F;* 匹配所有路径。</li><li>*.do 后缀匹配。不要以 &#x2F; 开始</li><li>&#x2F;dept&#x2F;*  前缀匹配。</li></ul></li><li><p>在web.xml文件中进行配置的时候，Filter的执行顺序是什么？</p><ul><li>依靠filter-mapping标签的配置位置，越靠上优先级越高。</li></ul></li><li><p>过滤器的调用顺序，遵循栈数据结构。</p></li><li><p>使用@WebFilter的时候，Filter的执行顺序是怎样的呢？</p><ul><li>执行顺序是：比较Filter这个<strong>类名</strong>。</li><li>比如：FilterA和FilterB，则先执行FilterA。</li><li>比如：Filter1和Filter2，则先执行Filter1.</li></ul></li><li><p>Filter的生命周期？</p><ul><li>和Servlet对象生命周期一致。</li><li>唯一的区别：Filter默认情况下，在服务器启动阶段就实例化。Servlet不会。</li></ul></li><li><p>Filter过滤器这里有一个设计模式：</p><ul><li>责任链设计模式。</li><li>过滤器最大的优点：<ul><li>在程序编译阶段不会确定调用顺序。因为Filter的调用顺序是配置到web.xml文件中的，只要修改web.xml配置文件中filter-mapping的<strong>顺序</strong>就可以调整Filter的执行顺序。显然Filter的执行顺序是在程序运行阶段动态组合的。那么这种设计模式被称为责任链设计模式。</li></ul></li><li>责任链设计模式最大的核心思想：<ul><li>在程序运行阶段，动态的组合程序的调用顺序。</li></ul></li></ul></li><li><p>使用过滤器改造OA项目。</p></li><li><p>什么情况下不能拦截?<br>目前写的路径是:&#x2F;*表示所有的请求均拦截。<br>用户访间 index.jsp的时候不能拦截<br>用户已经登录了，这个需要放行，不能拦截。<br>用户要去登录，这个也不能拦截。<br>WelcomeServlet也不能拦截:</p></li></ul><h1 id="Listener监听器"><a href="#Listener监听器" class="headerlink" title="Listener监听器"></a>Listener监听器</h1><ul><li><p>什么是监听器？</p><ul><li>监听器是Servlet规范中的一员。就像Filter一样。Filter也是Servlet规范中的一员。</li><li>在Servlet中，所有的监听器接口都是以“Listener”结尾。</li></ul></li><li><p>监听器有什么用？</p><ul><li>监听器实际上是Servlet规范留给我们javaweb程序员的特殊时机。</li><li>特殊的时刻如果想执行这段代码，你需要想到使用对应的监听器。</li></ul></li><li><p>Servlet规范中提供了哪些监听器？</p><ul><li>jakarta.servlet包下：<ul><li>ServletContextListener</li><li>ServletContextAttributeListener</li><li>ServletRequestListener</li><li>ServletRequestAttributeListener</li></ul></li><li>jakarta.servlet.http包下：<ul><li>HttpSessionListener监听session的创建与销毁</li><li>HttpSessionAttributeListener<ul><li>该监听器需要使用@WebListener注解进行标注。</li><li>该监听器监听的是什么？是session<strong>域</strong>中数据的变化。只要数据变化，则执行相应的方法。主要监测点在session域对象上。</li><li><img src="/./images/Servlet-JSP-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/image-20251114153736947.png" alt="image-20251114153736947"></li></ul></li><li>HttpSessionBindingListener<ul><li>该监听器不需要使用@WebListener进行标注。</li><li>假设User类实现了该监听器，那么User<strong>对象</strong>在<strong>被放入</strong>session的时候触发bind事件，User对象从session中删除的时候，触发unbind事件。</li><li>假设Customer类没有实现该监听器，那么Customer对象放入session或者从session删除的时候，不会触发bind和unbind事件。</li></ul></li><li>HttpSessionIdListener<ul><li>session的id发生改变的时候，监听器中的唯一一个方法就会被调用。</li></ul></li><li>HttpSessionActivationListener<ul><li>监听session对象的钝化和活化的。</li><li>钝化：session对象从内存存储到硬盘文件。</li><li>活化：从硬盘文件把session恢复到内存。</li></ul></li></ul></li></ul></li><li><p>实现一个监听器的步骤：以ServletContextListener为例。</p><ul><li><p>第一步：编写一个类实现ServletContextListener接口。并且实现里面的方法。</p><ul><li><pre><code>//这个方法是在ServletContext对象被创建的时候调用。void contextInitialized(ServletContextEvent event)//这个方法是在ServletContext对象被销毁的时候调用。void contextDestroyed(ServletContextEvent event)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 第二步：在web.xml文件中对ServletContextListener进行配置，如下：</span><br><span class="line"></span><br><span class="line">  - ```</span><br><span class="line">    &lt;listener&gt;</span><br><span class="line">        &lt;listener-class&gt;com.bjpowernode.javaweb.listener.MyServletContextListener&lt;/listener-class&gt;</span><br><span class="line">    &lt;/listener&gt;</span><br></pre></td></tr></table></figure></code></pre></li><li><p>当然，第二步也可以不使用配置文件，也可以用注解，例如：@WebListener</p></li></ul></li></ul></li><li><p>注意：所有监听器中的方法都是不需要javaweb程序员调用的，由服务器来负责调用？什么时候被调用呢？</p><ul><li>当某个特殊的事件发生（特殊的事件发生其实就是某个时机到了。）之后，被web服务器自动调用。</li></ul></li><li><p>思考一个业务场景：</p><ul><li>请编写一个功能，记录该网站实时的在线用户的个数。</li><li>我们可以通过服务器端有没有分配session对象，因为一个session代表了一个用户。有一个session就代表有一个用户。如果你采用这种逻辑去实现的话，session有多少个，在线用户就有多少个。这种方式的话：HttpSessionListener够用了。session对象只要新建，则count++，然后将count存储到ServletContext域当中，在页面展示在线人数即可。</li><li>业务发生改变了，只统计登录的用户的在线数量，这个该怎么办？<ul><li>session.setAttribute(“user”, userObj); </li><li>用户登录的标志是什么？session中曾经存储过User类型的对象。那么这个时候可以让User类型的对象实现HttpSessionBindingListener监听器，只要User类型对象存储到session域中，则count++，然后将count++存储到ServletContext对象中。页面展示在线人数即可。</li></ul></li></ul></li><li><p>实现oa项目中当前登录在线的人数（看视频）。</p><ul><li>什么代表着用户登录了？<ul><li>session.setAttribute(“user”, userObj); User类型的对象只要往session中存储过，表示有新用户登录。</li><li>域的选择，request是一次请求一个，session是一个用户一个，所有用户用application</li></ul></li><li>什么代表着用户退出了？<ul><li>session.removeAttribute(“user”); User类型的对象从session域中移除了。</li><li>或者有可能是session销毁了。（session超时）</li></ul></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSM </tag>
            
            <tag> Java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一小时k8s</title>
      <link href="/posts/ea314a42.html"/>
      <url>/posts/ea314a42.html</url>
      
        <content type="html"><![CDATA[<h1 id="kubernetes组件"><a href="#kubernetes组件" class="headerlink" title="kubernetes组件"></a>kubernetes组件</h1><p>一个节点就是一个物理机或者虚拟机，在这个节点上我们可以运行一个或者多个Pod，Pod是Kubernetes的最小调度单元，一个Pod就是一个或者多个应用容器的组合。它创建了一个容器的运行环境，在这个环境容器可以共享一些资源，假设我们的系统包括一个应用程序和一个数据库，就可以将应用程序和数据库分别放到两个不同的Pod中，一般我们建议一个Pod中只运行一个容器，但是并不是只能运行一个容器，这样可以更好地实现应用程序的解耦和扩展，其实一个Pod中是可以运行多个容器的，但是一般也仅限于这些容器是高度耦合的情况，它们之间为了实现某种功能或者共享资源而不得不放到同一个Pod中，比如大家经常听到的Sidecar也就是边车模式，就是将一个应用容器和一个辅助容器放到同一个Pod中，这个辅助容器就是Sidecar，通常用来实现一些辅助的功能。</p><p>现在我们已经将应用程序和数据库分别放到了两个Pod中，应用程序要访问数据库的话就需要知道数据库的IP地址，这个IP地址是在Pod创建的时候自动分配的，它是一个集群内部的IP地址，Pod之间可以通过这个IP地址来进行通信，这样我们的应用程序就可以通过这个iP地址来访问数据库了</p><p><img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6k8s/image-20251103040532920.png" alt="image-20251103040532920"></p><p>但是这里有两个问题需要注意一下，一个是这个iP地址是一个内部的IP地址，在集群外部是无法访问的，还有一个问题就是Pod并不是一个稳定的实体，也就意味着它们非常容易被创建或者销毁，比如发生故障的时候，Kubernetes会自动将Pod销毀掉，然后重新创建一个新的Pod来替代它，这个时候Pod的IP地址也会发生变化，如果应用程序还使用原来的IP地址访问数据库的话就会发生问题。为了解决这个问题Kubernetes提供了一个叫做Service的资源对象，它可以将一组Pod封装成一个服务，这个服务可以通过一个统一的入口来访问。</p><p>拿刚刚的例子来说我们可以将应用程序和数据库的Pod分别封装成两个Service，这样应用程序就可以通过Service的IP地址来访问数据库了，当pod发生故障ip发生变化，但service的ip地址是不会变化的，Service会自动将请求转发到其他健康的Pod上，这样就解决了Pod的IP地址不稳定的问题</p><p><img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6k8s/image-20251103040551784.png" alt="image-20251103040551784"></p><p>服务也分为内部服务和外部服务，外部服务有几种常用的类型，其中一种类型就是NodePort，它会在节点上开放一个端口</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>快速Nginx</title>
      <link href="/posts/7fc464b8.html"/>
      <url>/posts/7fc464b8.html</url>
      
        <content type="html"><![CDATA[<p><img src="/./images/%E5%BF%AB%E9%80%9Fnginx/image-20251101224806945.png" alt="image-20251101224806945"></p><p><img src="/./images/%E5%BF%AB%E9%80%9Fnginx/image-20251101224917851.png" alt="image-20251101224917851"></p><p><img src="/./images/%E5%BF%AB%E9%80%9Fnginx/image-20251101224941672.png" alt="image-20251101224941672"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动</span></span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">#检查进程</span></span><br><span class="line">ps -ef | grep nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看端口占用情况</span></span><br><span class="line">lsof -i:80</span><br><span class="line"></span><br><span class="line"><span class="comment">#控制nginx的停止或重启</span></span><br><span class="line">nginx -s signal(signal是下图中的任意一个)</span><br></pre></td></tr></table></figure><p>&lt;img src&#x3D;”.&#x2F;images&#x2F;快速nginx&#x2F;image-20251101231003548.png” </p><h1 id="静态站点部署"><a href="#静态站点部署" class="headerlink" title="静态站点部署"></a>静态站点部署</h1><p>输入下面的命令，然后找到nginx.conf，安装方式不同会导致这个配置文件的位置不同</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看Nginx的安装目录 编译参数以及配置文件和日志文件的位置各种信息</span></span><br><span class="line">nginx -V</span><br><span class="line"></span><br><span class="line">使用vscode打开这个配置文件</span><br><span class="line">连接shelter@192.168.23.128</span><br></pre></td></tr></table></figure><p>&lt;img src&#x3D;”.&#x2F;images&#x2F;快速nginx&#x2F;image-20251101231500956.png” </p><p>往下翻找到一个server的部分，然后在 server 里面还有一个location，这个location就是匹配我们在浏览器中输入的URL的，比如这里的斜线就表示匹配根目录，也就是当我们只输入一个localhost后面什么都不输入的时候，就会匹配到这个location中的内容，然后就会到它里面指定目录下去找一个index.html这个文件也就是默认页面。</p><p>这里html就是根目录所对应的文件夹，它是一个相对路径，是相对于nginx安装的文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">       listen       80;</span><br><span class="line">       server_name  localhost;</span><br><span class="line"></span><br><span class="line">       <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">       location / &#123;</span><br><span class="line">           root   html;</span><br><span class="line">           try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">           index index.html index.htm;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><p>这个框架可以把Markdown格式的文档转换成静态页面</p><p><img src="/./images/%E5%BF%AB%E9%80%9Fnginx/image-20251102023012047.png" alt="image-20251102023012047"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> nginx</span><br><span class="line">hexo init blog-demo</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="built_in">cd</span> blog-demo</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">hexo g#生成静态站点，放到public文件夹</span><br><span class="line">hexo s#启动本地服务器</span><br><span class="line"></span><br><span class="line"><span class="comment">#部署</span></span><br><span class="line"><span class="built_in">cd</span> public</span><br><span class="line"><span class="built_in">cp</span> -rf * /opt/homebrew/var/www/</span><br></pre></td></tr></table></figure><h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><p>worker进程的数量就可以通过配置文件来修改，一打开就可以看到下面的这行，后面的数字就是worker进程的数量，默认1改成10，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  10;</span><br><span class="line"><span class="comment">#检查配置文件的内容是否正确，会提示原因</span></span><br><span class="line">nginx -t</span><br><span class="line"><span class="comment">#重新加载</span></span><br><span class="line">nginx -s reload</span><br><span class="line"><span class="comment">#查看nginx进程，这时候应该是10个</span></span><br><span class="line">ps -ef |grep nginx</span><br></pre></td></tr></table></figure><p>也可以设置成auto，这样Nginx就会根据内核的数量自动设置worker进程的数量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  auto;</span><br></pre></td></tr></table></figure><p>配置文件主要由三个配置块组成，最外面是全局块（全局配置）</p><p>然后是events块，主要是一些服务器和客户端之间网络连接的一些配置</p><p>然后是一个http块，http块里面又可以包含多server块，也叫虚拟主机，在最下面一行可以看到有一个include servers&#x2F;*，表示把servers目录下的所有配置文件都包含进来，这样就可以把每个虚拟主机的配置都放到一个单独的文件里面，让主配置文件看起来更加简洁清晰</p><p>include这个指令还可以包含其他的配置文件，比如include mime.types，把mime.types文件包含进来</p><h1 id="反向代理负载均衡"><a href="#反向代理负载均衡" class="headerlink" title="反向代理负载均衡"></a>反向代理负载均衡</h1><p>简单来说 正向代理就是代理客户端，反向代理就是代理服务端</p><p>跟着视频弄了三个服务端口号，然后修改一下config，添加一个upstream的配置，这个就是反向代理配置，后面的名字可以随便取，括号里是需要被代理的服务器的配置</p><p>配置完再在下面的server里再添加一个location配置，比如所有以app开头的请求都被代理到刚刚的upstream中，proxy_pass的地址需要和刚刚upstream后面的名字保持一致。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">upstream backend&#123;</span><br><span class="line">ip_hash;</span><br><span class="line">server 127.0.0.1:8000 weight=3;</span><br><span class="line">server 127.0.0.1:8001;</span><br><span class="line">server 127.0.0.1:8002;</span><br><span class="line">&#125;</span><br><span class="line">server&#123;</span><br><span class="line">xxx</span><br><span class="line">location /app&#123;</span><br><span class="line">proxy_pass http:/backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后重载运行，打开网址可以看到一个localhost&#x2F;app切换了三个页面，默认是轮流的方式代理，如果一台电脑比其他两台要好，就可以使用权重weight调整负载均衡策略，权重越大被请求的次数也就越多</p><p>还有个负载均衡策略就是ip_hash，这个策略会根据客户端的iP地址进行一个哈希，同一个客户端的请求就会被分配到同一个服务器上，这样就解决了一些session相关的问题</p><h1 id="HTTPS配置"><a href="#HTTPS配置" class="headerlink" title="HTTPS配置"></a>HTTPS配置</h1><p>HTTPS协议是HTTP协议的安全版本，它通过对传输的数据进行加密来保证数据的安全性</p><p>http默认端口80，而HTTPS协议的默认端口是443，HTTPS协议需要使用到SSL证书，在主流的云平台上都可以免费申请到SSL证书，如果没有云平台也没有关系，我们可以通过 openssl 命令来自己生成一个自签名的证书，使用下面这三行命令就可以了，或者也可以将这三行命分合并成一个命分</p><p><img src="/./images/%E5%BF%AB%E9%80%9Fnginx/image-20251102030051052.png" alt="image-20251102030051052"></p><p>输入之后提示我们输入信息比如国家 省份 城市 公司 邮箱等等，这些信息就是待会生成证书文件里面的信息，填写完成之后 就会生成两个文件，一个是私钥文件 private.key，另外一个就是证书文件以pem结尾。这两个文件需要放到服务器上然后在Nginx的配置文件中进行配置</p><p>首先需要在监听后面加上一个ssl，然后下面 server name 后面一般填写自己的网站域名，如果是本地测试的话可以随便填一个，然后下面两行就是我们刚刚生成证书文件和私钥文件的路径，再下面是一些加密协议和算法相关的配置，下面这几行配置一般都是固定的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">listen 443 ssl;</span><br><span class="line">server_name localhost;</span><br><span class="line"><span class="comment">#证书文件名称</span></span><br><span class="line">ssl certificate /opt/homebrew/etc/nginx/cacert.pem;</span><br><span class="line"><span class="comment">#证书私钥文件名称</span></span><br><span class="line">ssl_certificate_key /opt/homebrew/etc/nginx/private.key;</span><br><span class="line"><span class="comment"># ssl验证配置</span></span><br><span class="line">ssl session <span class="built_in">timeout</span>  5m;··# 缓存有效期</span><br><span class="line"><span class="comment">#安全链接可选的加密协议</span></span><br><span class="line">ssl protocolS TLSV1 TLSV1.1 TLSV1.2 TLSv1.3</span><br><span class="line"><span class="comment"># 配置加密套件/加密算法，写法遵循 openssl 标准。</span></span><br><span class="line">SSL CipherS ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br><span class="line"><span class="comment"># 使用服务器端的首选算法</span></span><br><span class="line">ssl_prefer_server_ciphers on;</span><br><span class="line"><span class="comment">#charset koi8-r;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置完重新启动nginx，然后打开浏览器</p><p>还有一点就是我们一般都会配置一个重定向来让HTTP的请求自动跳转到HTTPS，配置方法就是在HTTP的 Server 里面加上下面这一行就可以了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这个是再添加一个server块</span></span><br><span class="line">server&#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name geekhour.net www.geekhour.net;</span><br><span class="line"><span class="built_in">return</span> 301 https://$server_name<span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="虚拟主机"><a href="#虚拟主机" class="headerlink" title="虚拟主机"></a>虚拟主机</h1><p>Nginx中的虚拟主机就是通过server块来实现的，每个server块就是一个虚拟主机，然后通过 server_name来指定这个虚拟主机的域名，这样当我们访问这个域名的时候就会被这个server块所匹配，然后就会执行这个server块中的配置</p><p>我们也可以把nginx.conf中的server部分的内容复制一份，然后在server目录下新建一个文件粘贴进去就可以了，这里新建一个local.conf的文件然后把上节课的server内容复制进去</p><p>这里老师用vue再新建一个站点，然后新建一个vue.conf。</p><p>server的后面加上一对花括号，然后再来配置一下监听的端口，端口号可以随意配置，然后再来配置一个 server_name，在生产环境这里一般需要配置成你的域名，然后再来添加一个location的配置用来指定这个虚拟主机的根目录，也就是我们刚刚打包好的Vue项目的目录，把root后面的路径改成我们刚刚打包好的dist目录就行了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen 5173;</span><br><span class="line">server_name localhost;</span><br><span class="line">Location/&#123;</span><br><span class="line">root /Users/yiny/vue-demo/dist;</span><br><span class="line">index index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 服务器 </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>快速shell</title>
      <link href="/posts/5fe04742.html"/>
      <url>/posts/5fe04742.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看shell环境变量的值（使用的什么）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$SHELL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看当前正在执行的脚本的名称</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#可以直接输入其他脚本的路径来切换到这个脚本</span></span><br><span class="line">/bin/sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#退出</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="编写shell脚本"><a href="#编写shell脚本" class="headerlink" title="编写shell脚本"></a>编写shell脚本</h1><p>脚本文件可以是任何扩展名，但是约定为sh</p><p>Shell脚本文件的第一行一般是一个#!，后面加上bin&#x2F;bash用来表示这个脚本文件使用的是Bash解释器，用其他的解释器也可以替换，比如bin&#x2F;zsh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello Shell&quot;</span></span><br><span class="line"><span class="built_in">date</span>#显示时间</span><br><span class="line"><span class="built_in">whoami</span>#显示当前用户</span><br></pre></td></tr></table></figure><p>编辑完保存一下并执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> a+x hello.sh#设置权限</span><br><span class="line">./hello.sh#执行</span><br></pre></td></tr></table></figure><p>Shell脚本也是支持函数的，Shel脚本中的变量默认是全局的，它的作用域是从定义的地方开始一直到脚本结束，如果想要在函数中定义一个局部变量的话就需要在变量的前面加上一个local关键字</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数:检查一个数是否为素数</span></span><br><span class="line"><span class="comment">#$1表示函数的第一个参数，也就是要检查的数字</span></span><br><span class="line"><span class="function"><span class="title">is_prime</span></span>()&#123;</span><br><span class="line"><span class="built_in">local</span> num=<span class="variable">$1</span></span><br><span class="line"><span class="comment"># 小于2的数不是素数</span></span><br><span class="line"><span class="comment">#lt是小于，中括号两边都需要空格</span></span><br><span class="line"><span class="keyword">if</span>[ <span class="variable">$num</span> -lt 2 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">return</span> 1#返回1，表示不是素数</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#检查从2到sqrt(num)的数</span></span><br><span class="line"><span class="comment">#for循环需要两个小括号把三个表达式都括起来</span></span><br><span class="line"><span class="keyword">for</span>((i=<span class="number">2</span>;i*i&lt;=num;i++));<span class="keyword">do</span></span><br><span class="line"><span class="keyword">if</span>[$((num%i))-eq 0 ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">return</span> 1#返回1，表示不是素数</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">return</span> 0#返回0，表示是素数</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E5%BF%AB%E9%80%9Fshell/image-20251101032854734.png" alt="image-20251101032854734"></p><p>然后直接执行就行了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#后面是脚本名称</span></span><br><span class="line">sh is_prime.sh</span><br></pre></td></tr></table></figure><h1 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;请输入您的姓名：&quot;</span></span><br><span class="line"><span class="built_in">read</span> name#读取输入的名字赋给name</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;您好，<span class="variable">$name</span>&quot;</span></span><br><span class="line"></span><br><span class="line">编辑完后可以执行，执行方法有以下两种</span><br><span class="line">bash game.sh</span><br><span class="line">./game.sh#这种方式要添加执行权限</span><br><span class="line"><span class="built_in">chmod</span> +x game.sh</span><br></pre></td></tr></table></figure><p>我们也可以给这个脚本文件传递一些参数，这些参数可以在脚本里使用$加上数字序号的方式来引用($1、$2、$3等)</p><p>修改代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;请输入您的姓名：&quot;</span></span><br><span class="line"><span class="comment">#read name</span></span><br><span class="line">name=<span class="variable">$1</span></span><br><span class="line">channel=<span class="variable">$2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;您好，<span class="variable">$name</span>，欢迎来到#channel&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/./images/%E5%BF%AB%E9%80%9Fshell/image-20251101171705262.png" alt="image-20251101171705262"></p><p>可以把这些信息保存到一些变量中让脚本文件自动读取这些信息，也就是使用环境变量，这些变量是系统预先定义好的，我们也可以自己定义变量，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">name=老杨</span><br><span class="line">channel=geekhour</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$name</span>#查看值，变成了老杨，但这里只是普通变量，不属于环境变量，只在当前shell会话有效，脚本文件直接引用会无法获取值</span><br><span class="line"></span><br><span class="line"><span class="comment">#转变环境变量，但退出shell再进入就会失效</span></span><br><span class="line"><span class="built_in">export</span> name=老杨</span><br></pre></td></tr></table></figure><p>shell在启动时会读取一些配置文件，用ls -a可以看到下面这两个文件，.profile是在用户登录的时候执行的并且只执行一次，而.bashrc文件是在每次新打开一个终端或者新建一个Shell会话的时候执行的，这两个都可以。不同Shel的配置文件可能会有一些差异，比如zsh的配置文件是.zshrc文件</p><p><img src="/./images/%E5%BF%AB%E9%80%9Fshell/image-20251101182536145.png" alt="image-20251101182536145"></p><p>通常.bash profile里面会调用.bashrc，所以一般推荐把环境变量放到.bashrc文件中，这样就可以保证每次新打开一个终端的时候都可以获取到这些环境变量了</p><p>系统根目录下也会有一些系统级别的配置文件，比如根目录etc文件夹下的profile和bashrc文件等等，这些文件里面存储的环境变量是对所有用户都有效的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> /etc/bash</span><br><span class="line">vi .bashrc</span><br><span class="line"><span class="comment">#滚轮滑动到文件最后一行</span></span><br><span class="line"><span class="built_in">export</span> name=老杨</span><br><span class="line"><span class="built_in">export</span> channel=GeekHour</span><br><span class="line"><span class="comment">#重新加载文件</span></span><br><span class="line"><span class="built_in">source</span> .bashrc</span><br><span class="line">. .bashrc#或者这个，或者退出重进</span><br></pre></td></tr></table></figure><h1 id="猜数字小游戏"><a href="#猜数字小游戏" class="headerlink" title="猜数字小游戏"></a>猜数字小游戏</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#shuf生成随机数，-i 1-10是生成范围，-n 1生成的个数</span></span><br><span class="line"><span class="built_in">shuf</span> -i 1-10 -n 1</span><br><span class="line"></span><br><span class="line">vi game.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;请输入您的姓名：&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;您好，<span class="variable">$name</span>，欢迎来到#channel&quot;</span></span><br><span class="line"><span class="comment">#当我们想要把一个命令的输出结果赋值给一个变量的时候，需要使用到命令替换语法，也就是反引号，这样Shell才会把这个命令的输出结果当成整体处理</span></span><br><span class="line"><span class="comment">#在使用命令替换语法尽量使用$()，在可读性和灵活性都会更好</span></span><br><span class="line"><span class="comment">#number=`shuf -i 1-10 -n 1`</span></span><br><span class="line">number=$(<span class="built_in">shuf</span> -i 1-10 -n 1)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$number</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;请输入一个1-10之间的数字&quot;</span></span><br><span class="line"><span class="built_in">read</span> guess#读取 变量名</span><br><span class="line"><span class="comment">#eq是equal相等，lt是小于</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$guess</span> -eq <span class="variable">$number</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;猜对了&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$guess</span> -lt <span class="variable">$number</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;小了&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;大了&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">:wq</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行</span></span><br></pre></td></tr></table></figure><p><img src="/./images/%E5%BF%AB%E9%80%9Fshell/image-20251101184535473.png" alt="image-20251101184535473"></p><p>if语句格式：if后面加上条件语句，这个条件需要使用两个中括号把它括起来，后面再加上一个分号和then，然后在下面加上一些命令，这些命令就会在这个条件成立的时候被执行，最后再加上一个fi来结束这个if语句</p><p>上面的脚本只能执行一次，只要猜对了就结束了，如果想一直执行就是循环</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">vi game.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;请输入您的姓名：&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;您好，<span class="variable">$name</span>，欢迎来到#channel&quot;</span>`</span><br><span class="line">number=$(<span class="built_in">shuf</span> -i 1-10 -n 1)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$number</span></span><br><span class="line"><span class="comment">#while [[ $guess -ne $number ]]</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#开始</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;请输入一个1-10之间的数字&quot;</span></span><br><span class="line"><span class="built_in">read</span> guess#读取 变量名</span><br><span class="line"><span class="comment">#eq是equal相等，lt是小于</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$guess</span> -eq <span class="variable">$number</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;恭喜你猜对了！是否继续？(y/n)：&quot;</span></span><br><span class="line"><span class="built_in">read</span> choice</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$choice</span> = <span class="string">&quot;y&quot;</span> ]] || [[ <span class="variable">$choice</span> = <span class="string">&quot;Y&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="comment">#继续</span></span><br><span class="line"><span class="built_in">continue</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="comment">#结束循环</span></span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$guess</span> -lt <span class="variable">$number</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;小了&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;大了&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#结束</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">:wq</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行</span></span><br></pre></td></tr></table></figure><p>随机数的取法还有下面这种</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过取模进行1-10的取值，不加1就是0-9的范围</span></span><br><span class="line"><span class="built_in">echo</span> $((RANDOM % <span class="number">10</span> + <span class="number">1</span>))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>快速学习Linux</title>
      <link href="/posts/73ab5b62.html"/>
      <url>/posts/73ab5b62.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动vim</span></span><br><span class="line">vi hello.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看文件夹</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看文件内容</span></span><br><span class="line"><span class="built_in">cat</span> hello.txt</span><br></pre></td></tr></table></figure><img src="./images/快速学习Linux/image-20251029161735843.png" alt="image-20251029161735843" style="zoom: 33%;" /><p>进入时是命令模式，冒号是尾行模式的前缀，:q是退出，q是quit</p><img src="./images/快速学习Linux/image-20251029162013281.png" alt="image-20251029162013281" style="zoom: 25%;" /><p>上图是命令模式每个按键的作用，下图是光标移动</p><img src="./images/快速学习Linux/image-20251029162240498.png" alt="image-20251029162240498" style="zoom: 25%;" /><img src="./images/快速学习Linux/image-20251029162331087.png" alt="image-20251029162331087" style="zoom:20%;" /><img src="./images/快速学习Linux/image-20251029162432572.png" alt="image-20251029162432572" style="zoom:25%;" /><p>p键也可以把刚刚删除的内容粘贴到这里</p><p>输入2yy可以复制两行，2就是表示复制或者粘贴的次数</p><img src="./images/快速学习Linux/image-20251029162812025.png" alt="image-20251029162812025" style="zoom:25%;" /><img src="./images/快速学习Linux/image-20251029162854728.png" alt="image-20251029162854728" style="zoom:25%;" /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示行号</span></span><br><span class="line">:<span class="built_in">set</span> number</span><br><span class="line">:<span class="built_in">set</span> nu#缩写</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭行号</span></span><br><span class="line">:<span class="built_in">set</span> nonumber</span><br><span class="line"></span><br><span class="line"><span class="comment">#快速地跳转到文件的最后一行</span></span><br><span class="line">G</span><br><span class="line"></span><br><span class="line"><span class="comment">#跳转到文件的第一行</span></span><br><span class="line">gg</span><br><span class="line"></span><br><span class="line"><span class="comment">#跳转到文件中指定的某一行</span></span><br><span class="line">行号G</span><br><span class="line">:行号#输入</span><br><span class="line"></span><br><span class="line"><span class="comment">#查找（输入，区分大小写，内容后面\c可以忽略大小写）</span></span><br><span class="line">/内容#从光标位置开始向下查</span><br><span class="line">?内容#从光标位置向上查</span><br><span class="line">n#继续向下或向上查</span><br><span class="line">N#和n相反</span><br><span class="line"></span><br><span class="line"><span class="comment">#替换</span></span><br><span class="line">:数字,数字s/Hello/world/g#从第几行到第几行，第二个数字换成$就是最后一行，替换当前行就忽略数字，s是替换，后面是被替换的内容，g是全局，不加g只会替换每一行的第一个匹配到的内容。</span><br><span class="line"></span><br><span class="line"><span class="comment">#撤销（undo）</span></span><br><span class="line">u</span><br></pre></td></tr></table></figure><h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示目录内容</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="built_in">ls</span> -l#显示更详细的信息</span><br><span class="line"><span class="built_in">ls</span> -a#显示包括隐藏文件（.开头的）在内的所有文件和目录</span><br><span class="line"></span><br><span class="line"><span class="comment">#-h以人类可读的方式显示文件的大小</span></span><br><span class="line"><span class="comment">#-t按照时间排序</span></span><br><span class="line"><span class="comment">#-r逆序显示</span></span><br><span class="line"><span class="built_in">ls</span> -h -t -r -l</span><br><span class="line"><span class="built_in">ls</span> -ltr#可以这样写</span><br></pre></td></tr></table></figure><p><img src="/./images/%E5%BF%AB%E9%80%9F%E5%AD%A6%E4%B9%A0Linux/image-20251031032322023.png" alt="image-20251031032322023"></p><p>左边这一列是文件的类型和权限，第一个字符表示的是文件的类型，中杠（-）表示普通文件，d表示目录，l表示这是一个链接文件，链接文件是Linux系统中的一种特殊文件，它分为硬链接和软链接两种，软链接也叫符号链接，类似快捷方式，比如上面蓝色的，文件名左边表示的是链接文件本身，石边用箭头表示了它所指向的文件或者目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建链接文件的命令是ln，后面加上源文件的名称以及链接文件的名称，-s表示软链接，不加默认硬链接。后面加上表示目标文件的hello.txt，然后再加上链接文件的名称，这样内容会完全相同</span></span><br><span class="line"><span class="built_in">ln</span> -s hello.txt link.txt</span><br></pre></td></tr></table></figure><p>硬链接文件和原始文件共享相同的i节点，也就意味着它们共享相同的文件内容，图片里的不用记。源文件和硬链接实际上是文件系统中同一个文件的两个不同的名字，当我们删除其中一个文件的时候另一个文件还是可以正常访问的</p><img src="./images/快速学习Linux/image-20251031032912314.png" alt="image-20251031032912314" style="zoom:33%;" /><p><img src="/./images/%E5%BF%AB%E9%80%9F%E5%AD%A6%E4%B9%A0Linux/image-20251031033557854.png" alt="image-20251031033557854"></p><p>相应的位置上如果没有相应的权限就会显示成一个中杠(-)。可以使用 change mode 命令来修改文件的权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#想要给这个文件添加一个可执行权限，这里缩写了，然后再加文件名，把+换成-就是删除权限</span></span><br><span class="line"><span class="built_in">chmod</span> +x hello,txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#在加号或者减号的前面加上ug或者o来单独给文件的所有者 同组或者其他用户添加权限</span></span><br><span class="line"><span class="built_in">chmod</span> u+x hello,txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#用数字表示（更简便）看下图</span></span><br><span class="line"><span class="built_in">chmod</span> 777 hello,txt</span><br></pre></td></tr></table></figure><p>把它们加起来就可以得到这个组的权限数字，比如这里的默认权限就可以转换成644，这里的6表示文件的所有者同时具有读和写的权限</p><p><img src="/./images/%E5%BF%AB%E9%80%9F%E5%AD%A6%E4%B9%A0Linux/image-20251031034224986.png" alt="image-20251031034224986"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建文件</span></span><br><span class="line"><span class="comment">#可以用来更新文件的修改时间，如果没有这个文件就直接创建</span></span><br><span class="line"><span class="built_in">touch</span> hello.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出文本，后面加重定向符号(&gt;)保存到文件，文件不存在自动创建</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello&quot;</span> &gt; hello.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#显示当前所在目录的位置</span></span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#切换目录，/是根目录</span></span><br><span class="line"><span class="comment">#.当前目录，..上一层目录</span></span><br><span class="line"><span class="built_in">cd</span> /</span><br><span class="line"><span class="built_in">cd</span> .</span><br></pre></td></tr></table></figure><p><img src="/./images/%E5%BF%AB%E9%80%9F%E5%AD%A6%E4%B9%A0Linux/image-20251031140420533.png" alt="image-20251031140420533"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#复制文件</span></span><br><span class="line"><span class="comment">#cp+复制源文件+复制后的文件名</span></span><br><span class="line"><span class="built_in">cp</span> file2.txt file3.txt</span><br><span class="line"><span class="comment">#复制多级目录</span></span><br><span class="line"><span class="built_in">cp</span> -r folder1 folder_copy</span><br><span class="line"></span><br><span class="line"><span class="comment">#移动文件或重命名文件</span></span><br><span class="line"><span class="built_in">mv</span> file3.txt file4.txt#重命名</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除文件</span></span><br><span class="line"><span class="built_in">rm</span> file4.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建目录</span></span><br><span class="line"><span class="built_in">mkdir</span> xxx</span><br><span class="line"><span class="comment">#创建多级目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p aaaa/bbb/ccc</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看文件大小或结构，把所有文件和目录的大小都列出来</span></span><br><span class="line"><span class="built_in">du</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#删除目录（只能空文件）</span></span><br><span class="line"><span class="built_in">rmdir</span> xxx</span><br><span class="line"><span class="comment">#递归删除</span></span><br><span class="line"><span class="built_in">rm</span> -r xxx</span><br></pre></td></tr></table></figure><h1 id="vscode与虚拟机链接的方法"><a href="#vscode与虚拟机链接的方法" class="headerlink" title="vscode与虚拟机链接的方法"></a>vscode与虚拟机链接的方法</h1><ol><li>安装 <code>Remote - SSH</code> 扩展</li><li>按 <code>Ctrl+Shift+P</code></li><li>输入 <code>Remote-SSH: Connect to Host</code></li><li>输入：<code>shelter@192.168.23.128</code></li><li>输入你的 Linux 密码</li></ol>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git</title>
      <link href="/posts/518e617c.html"/>
      <url>/posts/518e617c.html</url>
      
        <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>git是免费开源的分布式版本控制系统，版本控制系统分为集中式和分布式，集中式依赖中央服务器，但出现问题就会无法工作，分布式是每个人电脑上都有一个完整的版本库，可以在本地修改不需要考虑网络问题。</p><h1 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h1><p><a href="https://git-scm.com/">https://git-scm.com/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">安装的时候看到这个(NEW!) Add a Git Bash Profile to Windows Terminal也推荐选择上</span><br><span class="line"></span><br><span class="line">安装了vscode可以选择Use Visual Studio Code as Git&#x27;s default editor，</span><br><span class="line"></span><br><span class="line">然后选main，</span><br><span class="line"></span><br><span class="line">然后Git from the command line and also from 3rd-party software，</span><br><span class="line"></span><br><span class="line">然后Use bundled OpenSsH，</span><br><span class="line"></span><br><span class="line">然后Use the openssL library，</span><br><span class="line"></span><br><span class="line">然后Checkout Windows-style，</span><br><span class="line"></span><br><span class="line">然后 Use MinTTY (the default terminal of MSYS2)，</span><br><span class="line"></span><br><span class="line">然后fast-forward or merge，</span><br><span class="line"></span><br><span class="line">然后Git Credential Manager</span><br><span class="line"></span><br><span class="line">Enable file system caching</span><br></pre></td></tr></table></figure><p>安装完输入这个</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看版本信息，有就是成功</span></span><br><span class="line">git -v</span><br></pre></td></tr></table></figure><p>Windows的话 安装完Git之后会自动安装Git Bash，鼠标右键有</p><p>git的使用方式有三种：命令行 图形化界面 和 IDE插件</p><p>命令行的方式是最基本和最常用的方式，就是在终端中输入Git命令的方式来使用Git。图形化界面也叫GUI，就是通过一些专用的图形化工具软件来使用Git，在Git官网上也可以找到常用的GUI工具。</p><p><img src="/./images/git/image-20251021035518780.png" alt="image-20251021035518780">IDE插件就是在常用的IDEA或者vscode这些IDE工具中，通过插件或者扩展的方式来使用git</p><p>为了区分Linux操作系统中的命令，Git的所有命令都以git开头，后面跟着具体的命令，比如 git init 就是初始化一个仓库</p><p><img src="/./images/git/image-20251021035753626.png" alt="image-20251021035753626"></p><p>蓝色背景的部分是当前所在目录的位置，波浪线表示的是用户的主目录，比如我们现在所在的目录就是主目录下的directory这个目录下。绿色背景这里可以显示Git的分支名称和当前仓库的状态等信息，这个不配置也不影响使用</p><p>在开始使用Git之前第一步就是先使用 git config 命令配置一下用户名和邮箱，这样在提交的时候 才能够识别出来是谁提交的内容。这里的 –global参数表示的是全局配置，也就是说这个配置对所有的Git仓库都有效，不加这个参数就表示只对当前的Git仓库有效，还有一个就是 –system 参数表示系统级别的配置，对所有的用户都有效，一般不会使用–system</p><p><img src="/./images/git/image-20251021040104117.png" alt="image-20251021040104117"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;Liu Qi&quot;</span></span><br><span class="line">git config --global user.email 1830191738@qq.com</span><br></pre></td></tr></table></figure><p>这里因为用户名中间存在空格，所以需要使用双引号把它括起来，如果没有空格的话 这个双引号是可以省略的。配置完用户名之后 我们再来配置一下邮箱，那因为邮箱中间是没有空格的 所以就可以省略掉这个双引号。这两个命令只需要执行一次，执行过就可以省略</p><p>我们还可以使用下面这个命令来保存用户名和密码，这样就不用每次都输入了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global credential.helper store</span><br></pre></td></tr></table></figure><p>我们也可以使用下面这个命令来查看Git的配置信息，可以看到刚刚我们配置的用户名和邮箱，配置完成之后 我们就可以使用Git来管理我们的代码了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global --list</span><br></pre></td></tr></table></figure><h1 id="新建版本库"><a href="#新建版本库" class="headerlink" title="新建版本库"></a>新建版本库</h1><p>版本库又叫仓库，英文名叫Repository简称Repo，大家可以把仓库理解成一个目录，这个目录里面所有的文件都可以被Git管理起来，每个文件的修改 删除 添加等操作Git都能够跟踪到，以便任何时候都可以追踪历史或者还原到之前的某一个版本。</p><p>创建仓库：方式1，git init。方式2,，git clone</p><p>​只需要把一个目录变成Git可以管理的仓库就可以了，一种是在自己电脑本地直接创建一个仓库，另一种是从远程服务器上克隆一个已经存在的仓库</p><ol><li>首先需要找到一个合适的位置来创建一个空目录，比如这里我们就创建一个叫做 learn-git 的目录，后面课程中的所有操作也都会在这个目录下进行，然后输入git init就可以创建一个仓库了，然后提示我们已经初始化了一个空的仓库和位置，命令行前面提示符的部分也变成了main，这个 main 就是当前所在的分支的名称，表示当前这个目录已经是一个被Git管理的仓库，然后ls -a来看一下这个目录下到底有没有一个叫.git 的目录，因为.git是隐藏文件所以加-a</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> learn-git</span><br><span class="line"><span class="built_in">cd</span> learn-git</span><br><span class="line">git init（输出Initialized empty Git repository <span class="keyword">in</span> F:/learn-git/.git/</span><br><span class="line"><span class="built_in">ls</span> -a</span><br></pre></td></tr></table></figure><p>git 这个目录存放了Git仓库的所有数据，用下面两个命令可以看到很多文件和目录，这里都是重要文件不要随意修改，删除这个目录等于删除仓库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> .git</span><br><span class="line"><span class="built_in">ls</span> -altr</span><br></pre></td></tr></table></figure><p>git init 后面还可以指定目录的名称，如果指定了就会在当前目录下面创建一个新的目录作为Git仓库，比如我们可以创建一个叫做my-repo的Git仓库，会在learn-git后面的 my-repo 里面生成了一个.git目录，也就是说 my-repo 才是我们创建的仓库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init my-repo</span><br></pre></td></tr></table></figure><ol start="2"><li>使用 git clone 命令来从Github 或者 Gitee这种远程服务器上来克隆一个已经存在的仓库，直接在命令行中输入 git clone 后面加上仓库的地址。可以看到除了 my-repo 这个仓库以外又多了一个remote-repo 这样的目录，进入后它也是显示了一个绿色的main 分支，再-a看一下也是有一个.git 的目录</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/geekhall-laoyang/remote-repo.git</span><br><span class="line"><span class="built_in">ls</span> -ltr（按大小排序的长格式列表，降序</span><br><span class="line"><span class="built_in">cd</span> remote-repo</span><br></pre></td></tr></table></figure><h1 id="Git的工作区域和文件状态"><a href="#Git的工作区域和文件状态" class="headerlink" title="Git的工作区域和文件状态"></a>Git的工作区域和文件状态</h1><p>Git的本地数据管理分为工作区 暂 存区和本地仓库，工作区域英文名叫 Working Directory，也叫工作目录或者本地工作目录，暂存区英文名叫 Staging Area，也称为索引index，是一种临时存储区域，用于保存即将提交到Git仓库的修改内容，暂存区域是在Git进行版本控制时非常重要的一个区域，本地仓库就是我们上一节课通过 git init 命令创建的那个仓库，它包含了完整的项目历史和元数据，是Gi存储代码和版本信息的主要位置</p><p>当你修改完工作区的文件之后需要将它们添加到暂存区，然后再将暂存区的修改提交到本地仓库中，这个过程中我们可以使用Git提供的命令来查看 比较或者撤销修改，来保证版本控制的准确性和完整性</p><p>举个例子，我们可以把仓库理解成工厂里面的<strong>仓库</strong>，这个仓库里面有很多的货物和产品，这些<strong>货物和产品</strong>就是我们的<strong>文件</strong>，比如说我们的代码文件 文本文件 图片文件等等，<strong>工作区</strong>就是<strong>生产</strong>这些货物的车间，对我们的货物进行生产 加工和修改，车间生产完这些产品之后需要运送到仓库里面保管起来。那车间和仓库之间需要有一个运输工具，比如我们使用小货车来运输的话，那这个<strong>小货车</strong>里面就是<strong>暂存区</strong>，车间生产完产品之后把产品放到小货车上，然后运输到仓库里面保存起来</p><p>联系到工作中，当我们的代码完成了一个阶段想存档备份的时候，就可以把这个版本放到本地仓库里面保存起来，在版本控制系统中，这个保存到仓库中的过程就叫做<strong>提交</strong>。但是如果我们每次文件修改之后都需要进行一次提交的话会比较麻烦，git提供一种方式：可以将修改的文件先添加到暂存区中，然后再把所有暂存区中的文件统一执行一下提交操作。联想到我们刚刚的例子的话，就是我们的车间生产完货物之后，并不是每次都需要运送到仓库里面，而是先把这些货物放到小货车上，然后一次性的运送到仓库里面保存起来。</p><p>相应的 Git中的文件也存在几种状态，分别是未跟踪 未修改 已暂存 已提交</p><p>未跟踪就是我们新创建的还没有被Git管理起来的文件，未修改就是我们已经被Gt管理起来但是文件的内容没有发生变化，还没有被修改过。已修改就是我们修改了文件，但是还没有添加到暂存区里面。已暂存就是我们修改后并且已经添加到了暂存区域内的文件，联想到刚刚的例子也就是已经放到小货车里面的货物</p><p><img src="/./images/git/image-20251021224351090.png" alt="image-20251021224351090"></p><h1 id="添加提交仓库"><a href="#添加提交仓库" class="headerlink" title="添加提交仓库"></a>添加提交仓库</h1><p><strong>git status</strong></p><p>status这个单词本身就是状态的意思，用于查看仓库的状态，比如可以查看当前仓库处在哪个分支、有哪些文件以及这些文件当前处在怎样的一个状态，使用后可能会看到自己的分支名称是 master 而不是main，这是由于Git的版本不同导致的，没什么事</p><p>首先创建一个文件，创建文件有很多种方式，用熟悉的就行，这里直接使用 Linux 下的 echo 命令，将回显的内容输出到一个文件里面，比如输出一个“这是第一个文件”，可以看到 本地已经多一个file.txt的文件，看一下这个文件里面的内容可以看到刚刚输入的内容已经被写入到这个文件里面了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> my-repo</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;这是第一个文件&quot;</span> &gt; file.txt</span><br></pre></td></tr></table></figure><p>再来看一下仓库的状态，可以看到命令的回显中比刚才多了一红色的文件，就是刚刚新建的文件，这个文件现在就是处在一个未被跟踪的状态，接下来就可以使用 git add 命令来把文件放到小货车里面，这个命令的作用就是将文件添加到暂存区，等待后续的提交操作。</p><p>再来看一下仓库的状态，可以看到刚刚红色的 filext已经变成了绿色，表示这个文件现在已经被添加到了暂存区等待被提交，提示符里面也多了一个加号（我这里没显示），表示我们的仓库中存在已经修改了但是没有提交的文件，下面括号里面还有这样一行提示  (use “git rm –cached <file>…” to unstage)，他告诉我们可以使用这样的命令来把添加到暂存区的文件再取消暂存，也就是可以把刚刚放到小货车里面的货物再拿回来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br><span class="line">git add file.txt</span><br><span class="line"></span><br><span class="line">git status</span><br></pre></td></tr></table></figure><p><strong>git commit</strong></p><p>commit就是提交的意思，我们的文件只有被提交到仓库中才算真正的被保管起来，这里有一个需要注意的地方就是 git commit 这个命令只会提交暂存区中的文件而不会提交工作区中的其他文件，比如我们现在再来创建一个新的文件，然后再来看一下仓库的状态，可以看到刚刚创建的这个 file2是红色的未跟踪的状态，然后提交一下，注意git commit 这个命令在提交的时候需要使用 -m 参数来指定提交的信息，这个信息会被记录到仓库中，如果不指定 -m 这个参数，那么git commit 命令会进入一个交互式的界面，默认会使用:vim 来编辑提交信息。提交完成之后再看看仓库状态，刚刚绿色的 filetxt已经不见了，这是因为我们已经把file提交到仓库里面保管起来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;这是文件2的内容&quot;</span> &gt; file2.txt</span><br><span class="line">git status</span><br><span class="line">git commit -m <span class="string">&quot;第一次提交&quot;</span></span><br><span class="line">git status</span><br></pre></td></tr></table></figure><p><strong>git add</strong> 命令还可以使用通配符来添加多个文件，为了演示通配符的使用 我们再来多添加几个文件，然后可以看到仓库里面有四个txt文件和一个以sh结尾的shell脚本文件，执行git status可以看到除了file己经被仓库保管起来之外下面四个新建的文件都处于一个未跟踪的状态，可以使用 git add *.txt来把所有以txt结尾的文件都添加到暂存区里面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;file3&quot;</span> &gt; file3.txt</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;file4&quot;</span> &gt; file4.txt</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;file5&quot;</span> &gt; file5.sh</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">git status</span><br><span class="line">git add *.txt</span><br></pre></td></tr></table></figure><p>git add 命令还可以接受文件夹作为参数，比如想要添加所有文件的话可以使用 git add.这个命令来把当前文件夹下的所有文件都添加到暂存区里面，这里的点就表示当前目录，这次我们不输入-m参数，Git就会自动地进入一个交互式界面，默认会使用vim来编辑提交信息，可以使用方向键来移动光标，t使用i键进入编辑模式，安装的时候好像设置成了vscode启动了，输入这是第二次提交然后保存退出提交，再看一下状态提示我们所有的文件都提交完成了</p><p><strong>git log</strong></p><p>可以使用 git log 命令来查看提交记录。每次提交都有一个唯一的提交ID，就是 commit 后面这个16进制的字符串，还有每次提交的作者和邮箱以及提交的时间和刚刚提交时编写的注释信息等等内容，这里的名字和邮箱就是我们使用 git config 命令配置的，git log 后面还可以接收一些参数，比如说可以使用 git log 后面加上 –oneline来查看简洁的提交记录，这样就只显示每次提交的 ID 和提交信息了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit</span><br><span class="line">git status</span><br><span class="line">git <span class="built_in">log</span></span><br><span class="line">git <span class="built_in">log</span> --oneline</span><br></pre></td></tr></table></figure><h1 id="git-reset回退版本"><a href="#git-reset回退版本" class="headerlink" title="git reset回退版本"></a>git reset回退版本</h1><p>reset 命令用于回退版本，可以退回到之前的某一个提交的状态</p><p>git reset的三种模式：git rese –soft、git rese –hard、git rese –mixed，也就是软的 硬的和混合的</p><p>soft 参数表示回退到某一个版本并且保留工作区和暂存区的所有修改内容，hard 的参数表示回退到某一个版本并且丢弃工作区和暂存区的所有修改内容，mixed 这个参数就是介于 soft 和 hard 这两个参数之间，它表示回退到某一个版本并且只保留工作区的修改内容而丢弃暂存区的修改内容，mixed 也是 reset 命令的默认参数</p><p><img src="/./images/git/image-20251022031628912.png" alt="image-20251022031628912"></p><p>例子：首先来新建一个仓库 并且添加几次提交内容，提交完来使用 git log 查看一下提交历史，然后这个时候如果我们想要回退到上一个版本的话就可以使用 git reset 命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git init repo</span><br><span class="line"><span class="built_in">cd</span> repo</span><br><span class="line"><span class="built_in">echo</span> 111 &gt; file1.txt</span><br><span class="line"><span class="built_in">echo</span> 222 &gt; file2.txt</span><br><span class="line"><span class="built_in">echo</span> 333 &gt; file3.txt</span><br><span class="line">git add file1.txt</span><br><span class="line">git commit -m <span class="string">&quot;commit1&quot;</span></span><br><span class="line">git add file2.txt</span><br><span class="line">git commit -m <span class="string">&quot;commit2&quot;</span></span><br><span class="line">git add file3.txt</span><br><span class="line">git commit -m <span class="string">&quot;commit3&quot;</span></span><br><span class="line">git <span class="built_in">log</span> --oneline</span><br></pre></td></tr></table></figure><p>为了方便演示再打开一个终端，然后把这个仓库目录复制三份，分别来执行三种不同的参数</p><p>首先我们来看一下 soft 参数，直接在命令行输入 git reset –soft，后面加上要回退的版本ID就可以了，回车之后再来使用 git log 查看一下提交历史，可以看到现在提交历史只有两次了，HEAD 指针也指向了第二个版本，那再来看一下工作区和暂存区的内容，使用ls命令查看一下工作区的内容，可以看到 file3 这个文件还在，cat 命令查看一下 file3 的内容也是没有问题的，file3在暂存区里面也是存在的</p><p>再来看一下仓库的状态，提示我们 file3 是一个新文件，因为我们使用的是 soft 参数，所以回退到上一个版本的时候，工作区和暂存区的内容都不会被清空，所以file3这个文件还是存在的，但是因为回退到了第二个版本，而file3这个文件是在第三个版本才添加的，所以对于第二个版本来说i这个file3文件就是一个新文件，这个时候我们就可以修改一下file3的内容，然后重新添加暂存和提交一下就可以了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> f:/learn-git</span><br><span class="line"><span class="built_in">cp</span> -rf repo repo-soft</span><br><span class="line"><span class="built_in">cp</span> -rf repo repo-hard</span><br><span class="line"><span class="built_in">cp</span> -rf repo repo-mixed</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> repo-soft</span><br><span class="line">git reset --soft 7f644ae</span><br><span class="line">git <span class="built_in">log</span> --oneline</span><br><span class="line">clear</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="built_in">cat</span> file3.txt</span><br></pre></td></tr></table></figure><p>hard参数，这里我们也是回退到上一个版本，使用 HEAD 加上尖角号来表示上一个版本，回车之后再使用 git log 查看一下提交历史，可以看到现在提交历史也是只有两次了，这个和 soft 参数是一样的，再来看一下工作区和暂存区的内容，ls命令查看一下工作区的内容，能够看到file3这个文件已经不存在了，再来查看一下暂存区的内容也没有了</p><p>就是说如果我们使用 hard 参数回退到上一个版本的时候，工作区和暂存区的内容都会被清空</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> learn-git</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="built_in">cd</span> repo-hard</span><br><span class="line">git reset --hard HEAD^</span><br><span class="line">git <span class="built_in">log</span></span><br><span class="line"><span class="built_in">ls</span> （file3不存在</span><br><span class="line">git ls-files（暂存区没有</span><br></pre></td></tr></table></figure><p>最后再来看一下默认的 mixed 参数，同样回退，这次我们不加任何参数直接输入 git reset，回车之后再来使用 git log 查看一下提交历史，可以看到现在提交历史也是只有两次，在工作区和暂存区file3这个文件还是存在的，cat命令查看内容也是没有问题的，然后再查看一下暂存区的内容，可以看到暂存区里面已经没有file3这个文件了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> learn-git</span><br><span class="line"><span class="built_in">cd</span> repo-mixed</span><br><span class="line">git reset HEAD^</span><br><span class="line">git <span class="built_in">log</span> --oneline</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="built_in">cat</span> file3.txt</span><br><span class="line">git ls-files</span><br></pre></td></tr></table></figure><p>在使用场景方面soft和 mixed 的作用基本相似，区别就在于是否保留暂存区的内容，一般来说当我们连续提交了多个版本，但是又觉得这些提交没有太大意义可以合并成一个版本的时候，就可以通过这两个参数来进行回退之后再重新提交</p><p>那它们主要的区别就是在重新提交之前，混合模式需要执行一下get add操作来将变动的内容重新添加到暂存区，而soft模式就不需要了，因为暂存区并没有被清空，而hard参数的使用场景则一般是真的要放弃目前本地所有修改内容的时候，建议大家谨慎使用,hard.这个参数，因为它会删除这两个版本之间的工作区和暂存区的所有修改内容</p><p>如果不小心误操作的话也不用太担心，Git中的所有操作都是可以回溯的，可以使用git reflog 命令来查看一下我们操作的历史记录，然后找到误操作之前的版本号再使用 git reset 命令来回退到这个版本就可以了</p><h1 id="git-diff"><a href="#git-diff" class="headerlink" title="git diff"></a>git diff</h1><p>它可以用来查看文件在工作区 暂存区以及版本库之间的差异，它还可以查看文件在两个特定版本之间的差异，或者文件在两个分支之间的差异，平时我们开发的时候更多的是使用一些图形化的工具，但是需要了解一下这个，因为有的时候我们需要在一些没有图形化工具的服务器上来使用Git</p><p>git diff 后面如果什么都不加的话，会默认比较的是工作区和暂存区之间的差异内容，它会显示发生更改的文件以及更改的详细信息</p><p>演示：还是使用上面创建的仓库，这个仓库目前有三次提交，每次提交都新增了一个文件，比如第一次提交新增了一个file1.txt 里面是三个1以此类推，然后来修改一下file3这个文件，把文件内容改成 一键三连了吗，然后保存退出，能够看到现在终端的命令提示符已经变成了黄色，表示我们修改了一些仓库中的内容。那现在我们使用 git diff 命令来查看一下</p><p>第一行提示了我们发生变更的文件，第二行解释：Git会将文件的内容使用哈希算法生成一个40位的哈希值，这里只显示了哈希值的前七位，后面的100644表示的是文件的权限，再往下就是刚刚修改的内容了，红色是删除内容绿色是添加，现在比较的是工作区和暂存区之间的差异，因为我们修改的内容还没有被添加到暂存区，我们添加一下 ，然后再来使用 git diff 看一下输出结果，可以看到没有任何内容了，表示我们的工作区和暂存区的内容是相同的</p><p><img src="/./images/git/image-20251023035448689.png" alt="image-20251023035448689"></p><p><img src="./images/git/image-20251024030253586.png">  access.log<br>git status</p><p>echo “other log” &gt; other.log<br>git status</p><p>echo access.log &gt; .gitignore<br>cat .gitignore（输出access.log<br>git status</p><p>git add .<br>git status<br>git commit -m “ignore file sample”<br>git ls-files</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">我们也可以使用*.log这样的通配符来匹配所有以log结尾的文件，那我们现在来修改一下点 .gitignore文件，我们在下面加上一行\*.log表示我们忽略所有的以log结尾的文件，然后我们再来添加一个日志文件，使用 git status 来看一下状态，我们现在只能看到,gitignore这个文件的修改，而 hello.log 的修改被我们忽略掉了，然后再提交一下，然后我们再来看一下我们版本库中的文件，可以看到 hello.log 这个文件也是没有被添加进来的，表示我们\*.log 成功的适配了所有的 \*.log结尾的文件</span><br><span class="line"></span><br><span class="line">~~~bash</span><br><span class="line">vi .gitignore</span><br><span class="line">*.log</span><br><span class="line">echo hell0 &gt; hello.log</span><br><span class="line">git status(只有.gitignore)</span><br><span class="line">git commit -m &quot;test ignore log&quot;</span><br><span class="line">git ls-files</span><br></pre></td></tr></table></figure><p><strong>小知识点</strong>：如果对已经添加到仓库的other.log 这个文件做一些修改的话，Git还会不会监测到它的版本变化呢？</p><p>比如我们在other.log文件里面追加一些内容，两个右箭头在Linux 命令里面表示追加到这个文件的后面，那我们现在使用 git status 来看一下它的状态，Git还是提示我们other.log 这个文件发生了变化，而且我们使用 gitdiff这个命令也是可以看到它的变化内容的</p><p>.gitignore文件生效需要有一个前提，就是这个文件不能是已经被添加到版本库中的文件，那这个时候我们就需要把other.log 这个文件先从版本库中先删除掉，使用git rm 命令会把文件从工作区和暂存区同时删除，如果我们只是想把它从版本库里面删除而不想删除本地文件的话，就可以在后面加上–cached的这个参数，然后我们来看一下仓库的状态，它提示我们 other.log这个文件已经被删除了，然后我们再来看一下本地文件，可以看到在本地没有被删除。然后再提交一下，这样以后无论这个文件发生了什么变化就都不会被纳入到版本控制中了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot; modified &quot;</span> &gt;&gt; other.log</span><br><span class="line"> git status </span><br><span class="line"> git diff</span><br><span class="line"> git <span class="built_in">rm</span> --cached other.log</span><br><span class="line"> git status</span><br><span class="line"> <span class="built_in">ls</span></span><br><span class="line"> git commit -am <span class="string">&quot;delete other.log&quot;</span></span><br></pre></td></tr></table></figure><p>.gitignore文件中还可以配置文件夹的名称，比如这里我们创建一个 temp 文件夹，用来存放一些临时文件，小<strong>知识点</strong>：如果temp文件夹下面什么都没有的话，这个文件夹是不会被纳入到版本控制中的，因为Git默认是不会将空的文件夹添加到仓库里面的，这个时候如果我们使用 git status 命令也是看不到任何变化的，temp文件夹下面有文件的话就会被纳入到版本控制中</p><p>比如我们来添加一个hello 到temp&#x2F;hello，再来使用git status -s这个命令来看一下仓库的状态，-s是 short 的缩写，表示查看状态这个命令的简略模式，这个命命的回显最前面有两个问号，这里的两个间号第一列表示是暂存区的状态，第二列表示工作区的状态，然后我们在 .gitignore文件中添加 temp 文件夹的名称，这样我们就忽略了 temp 文件夹，注意文件夹的格式是以斜线结尾的，保存退出然后再来看一下仓库的状态，可以看到temp文件夹已经被忽略掉 不显示了，那这里的 M 表示.gitignore文件被修改过，然后提交，我们看一下仓库的文件内容，可以看到 temp 文件夹以及它下面的所有文件并没有被提交到我们的仓库里面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> temp</span><br><span class="line">git status</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hello&quot;</span> &gt; temp/hello.txt</span><br><span class="line">git status -s(输出?? temp/)</span><br><span class="line">vi .gitignore</span><br><span class="line">temp/</span><br><span class="line">:wq</span><br><span class="line">git status -s（输出 M.gitignore）</span><br><span class="line"> git commit -am <span class="string">&quot;test ignore folder&quot;</span></span><br><span class="line"> git ls-files</span><br></pre></td></tr></table></figure><p>.gitignore文件的匹配规则：gitignore 这个配置文件是按行从上到下进行规则匹配的，忽略文件的匹配规则在Git官网上有详细的说明<a href="https://git-scm.com/docs/gitignore">https://git-scm.com/docs/gitignore</a></p><ul><li><p>空行或者以#开头的行会被Git忽略。一般空行用于可读性的分隔,#一般用作注释</p></li><li><p>使用标准的Blob模式匹配,所谓的 glob 模式就是指 she!ll所使用的简化了的正则表达式，例如:</p><ul><li>星号*通配任意个字符</li><li>问号 ?匹配单个字符</li><li>中括号[]表示匹配列表中的单个字符,比如:[abc] 表示a&#x2F;b&#x2F;c</li></ul></li><li><p>两个星号 **表示匹配任意的中间目录</p></li><li><p>中括号可以使用短中线连接，比如:</p><ul><li>[0-9] 表示任意一位数字,[a-z]表示任意一位小写字母</li></ul></li><li><p>感叹号 ! 表示取反，要忽略指令模式以外的文件或者目录可以在模式前加上感叹号就可以了</p></li></ul><p>例子：</p><p><img src="./images/git/image-20251025032750272.png">  hello.txt<br>git add .<br>git commit -m “first commit”<br>git ls-files</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这里稍微解释一下，Git是一种分布式的版本控制系统，我们的本地仓库和远程仓库是两个仓库，它们之间是相互独立的，我们可以在本地仓库中做任何修改，但是这些修改并不会影响到远程仓库，反之亦然。因此我们需要一种机制来同步本地仓库和远程仓库的修改内容，让他们的状态保持一致，pull和push，一个表示拉取 一个表示推送。push就是把本地仓库的修改推送给远程仓库，pull就是把远程仓库的修改拉取到本地仓库，刚刚我们在本地仓库新建了一个文件，但是这个文件并没有同步给远程仓库，下面就使用push命令来把本地仓库的修改内容推送给远程仓库</span><br><span class="line"></span><br><span class="line">~~~bash</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><p>推送命令执行成功了，打开页面Ctr+shit+R刷新一下，可以看到 hello.txt 这个文件已经推送到了GtHub上</p><h1 id="关联本地仓库和远程仓库"><a href="#关联本地仓库和远程仓库" class="headerlink" title="关联本地仓库和远程仓库"></a>关联本地仓库和远程仓库</h1><p>上节课是远程克隆到本地，如果我们本地已经有了一个仓库的话怎样才能把它放到远程仓库里面呢</p><p>首先我们还是需要在GitHub上创建一个新的仓库，叫first-repo，之前我们创建过一个叫做my-repo的本地仓库，那现在我们就来把my-repo这个本地仓库和刚刚在GitHub上创建的远程仓库关联起来，新创建的时候github已经提示了我们需要使用 git remote add<shortname><url> 这个命令，它的意思就是添加一个远程仓库，这里的orgin就是我们远程仓库的别名，.一般默认的别名都是这个，也可以自己指定一个其他的名字，复制第一行到终端，再使用 git remote -v这个命令来查看一下，这个命令可以查看我们当前仓库所对应的远程仓库的别名和地址，可以看到我们现在本地仓库所对应的远程仓库别名叫做origin</p><p><img src="/./images/git/image-20251025183411408.png" alt="image-20251025183411408"></p><p><img src="/./images/git/image-20251025184223858.png" alt="image-20251025184223858"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> my-repo</span><br><span class="line">git remote add origin git@github.com:shelterlq77-bit/first-repo.git</span><br><span class="line">git remote -v</span><br></pre></td></tr></table></figure><p>那第二行的最会的意思是指定分支的名称为main，因为我们这里默认的分支名称就是main，所以这一行的命令我们可以省略掉，最后一行就是把我们本地的main分支和远程的origin仓库的main分支关联起来，其实这个命令的全称应该是这样写的，-u是upstream的缩写，它的意思就是把我们本地仓库和别名为origin的远程仓库关联起来，后面的main:main就是把本地仓库的main分支推送给远程仓库的main分支。如果本地分支的名称与远程分支的名称相同的话我们就可以省略只写一个main就可以了，回车之后它会提示我们输入密码，回到页面就成功推送了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#git push -u origin main:main</span></span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure><p>同样地 如果我们在远程仓库修改了一些内容，那么就需要使用pull命令来把远程仓库的修改拉取到本地，GitHub上的文件是可以直接在线编辑的，比如我们可以在这里添加一个新的文件来模拟一下远程仓库的修改，添加一个readme，当我们访问一个仓库地址的时候这个仓库的首页就会显示这个README文件中的内容，这样可以添加一些介绍</p><p>然后使用pull来拉取一下远程仓库的修改内容，这里面仓库的名称和分支的名称可以省略，如果省略的话默认就是拉取仓库别名为origin的main分支，它的作用就是把远程仓库的指定分支拉取到本地再进行合并，我们可以cat一下这个文件的内容和远程仓库的内容是一样的。</p><p><img src="./images/git/image-20251025233425125.png">  main1.txt<br>git add .<br>git commit -m “main:1”<br>略<br>git branch dev</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20251026001715724](./images/git/image-20251026001715724.png)</span><br><span class="line"></span><br><span class="line">那现在我们可以看到这个新的分支已经创建完成了，可以在这个分支上进行开发和测试，这里需要注意的是git branch 命令只是创建了一个新的分支，并没有切换到这个新的分支上，可以使用 git checkout,后面加上分支的名称来切换到不同的分支，可以看到我们的命含提示符已经变成了dev。</span><br><span class="line"></span><br><span class="line">使用git checkout命令来切换分支的时候存在的潜在问题：因为除了切换分支和状态之外git checkout命令还可以用来恢复文件或者目录到之前的某一个状态，恢复的时候如果分支名称和文件名称相同的话就会出现歧义，git checkout 命令会默认切换分支而不是恢复文件，Git官方在2.23版本开始为我们提供了一个新的命令git switch，它是专门用来切换分支的，语义更加明确，我们可以使用 git switch 来试一下，可以看到也成功地切回到了main分支</span><br><span class="line"></span><br><span class="line">~~~bash</span><br><span class="line">git checkout dev</span><br><span class="line">git switch dev</span><br></pre></td></tr></table></figure><p>那现在假如测试完成没有问题之后我们就需要把这个dev功能的分支合并到主线代码中，我们可以使用git merge命令来将不同的分支合并到当前分支中，merge后面的分支名称是将要被合并的分支，而我们当前所在的分支就是合并后的目标分支，比如说我们要把dev分支合并到main分支中的话，就需要首先切换到main分支，然后执行git merge dev命令，这样就可以把dev分支合并到main分支中了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge dev</span><br></pre></td></tr></table></figure><p>回车之后Git会自动为我们产生一次提交，我们需要输入提交的消息，直接使用默认的提交信息保存，在GitKraken的分支图上可以看到dev分支和main分支已经合并了，它也非常形象地展示了分支合并的过程，其实这个分支图就是我们提交记录的一个可视化的展示，在命令行中也可以通过 ,gitlog 来查看我们的分支图</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --graph --oneline --decorate --all</span><br></pre></td></tr></table></figure><p>合并完成之后我们再来使用git branch 命令来看一下，可以看到这个dev分支还是存在的，这里有的同学可能会有一些误解，认为分支被合并之后就会消失掉，其实如果我们不手工删除这个分支的话还是会存在，如果分支不再需要，就可以使用 git branch -d 命令来删除这个分支，这里的 -d 参数表示删除已经完成合并的分支，意思就是如果一个分支已经被合并到其他分支中了，那么我们就可以使用这个命令来删除这个分支</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch</span><br><span class="line">git branch -d dev</span><br></pre></td></tr></table></figure><p>但是如果没有被合并的话是不能使用这个小d参数来删除的，这个时候就需要使用 git branch 后面加上大写字母的 -D 命令来强制删除这个分支<br><img src="/./images/git/image-20251026003143947.png" alt="image-20251026003143947"></p><h1 id="解决合并冲突"><a href="#解决合并冲突" class="headerlink" title="解决合并冲突"></a>解决合并冲突</h1><p>如果两个分支修改了同一个文件的同一行代码，Git就不知道应该保留哪个分支的修改内容了，这个时候就需要我们手动来解决冲突</p><p>我们还是使用上一节课的仓库，新建一个分支feat，分支的命名其实也是有一定规则和含义的，feat就是feature的缩写，一般用来表示开发某一个功能的分支，然后我们切换到feat分支，我们来修改-下main1.txt文件中的内容，添加一行“这是feat分支中添加的内容”，保存之后我们来提交一下，提交信息我们使用 feat:1表示这是feat分支的第一次提交，技巧：就是在提交命令后面加上-a参数，就可以一个命令完成添加暂存和提交两个动作</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git branch feat</span><br><span class="line">git switch feat</span><br><span class="line">vi main1.txt</span><br><span class="line">git commit -a -m <span class="string">&quot;feat:1&quot;</span></span><br></pre></td></tr></table></figure><p>然后我们切换回main分支，我们在main分支里面也同样修改一下这个文件中的内容，当切换回main分支之后，工作区的文件内容也自动发生了变化，刚刚在feat分支添加的内容就消失不见了，因为在main分支中我们还没有对这个文件进行修改，所以切换回main分支之后Git自动为我们把工作区域的内容也恢复了，同样也在第二行加上一句话“xxxx”，然后同样也来保存提交一下，这里 -a -m 也可以省略成-am，这个时候就可以看到feat分支和main分支的修改内容产生了分歧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git switch main</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">vi main1.txt</span><br><span class="line">git commit -am <span class="string">&quot;main:6&quot;</span></span><br></pre></td></tr></table></figure><p>那现在我们来尝试合并一下分支，输入 git merge 来把feat分支的内容合并到main分支，回车之后 Git就会提示我们产生了冲突，自动合并失败了，需要解决冲突之后再提交，现在我们也可以使用 git status 命令来查看一下冲突文件的列表，也可以使用 git diff 命令来查看冲突的具体内容，Git会把两个分支的修改内容全都显示出来</p><p>然后Git会使用左箭头 等号和右箭头分别来表示两个分支的修改内容，其中等号上面的部分表示我们刚刚main分支中的修改内容，而等号下面到右箭头之间的部分是我们刚刚在feat分支中添加的内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git merge feat</span><br><span class="line">git status</span><br></pre></td></tr></table></figure><p>&lt;img src&#x3D;”.&#x2F;images&#x2F;git&#x2F;image-20251026025650819.png” </p><p>那现在我们需要做的就是需要手工编辑这个文件，留下我们想要的内容之后然后再重新提交，我们把左箭头 等号和右箭头都去掉，把第二行的内容合并到第一行后面，然后添加一个逗号，这样我们就把两个分支的修改内容合在了一起，然后保存退出，然后添加暂存提交，可以看到提交之后就自动完成了我们合并的过程</p><p><img src="/./images/git/image-20251026030013097.png" alt="image-20251026030013097"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi main1.txt</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;merge conflict&quot;</span></span><br></pre></td></tr></table></figure><p>在提交之前如果想中断这次合并的话，我们也可以使用 git merge  –abort 这个命令来终止合并</p><h1 id="回退和rebase"><a href="#回退和rebase" class="headerlink" title="回退和rebase"></a>回退和rebase</h1><p>除了merge以外还有另外一个方法可以将不同分支的修改内容整合到一起，就是rebase，中文意思是变基</p><p><img src="/./images/git/image-20251026030422878.png" alt="image-20251026030422878"></p><p>之前因为上一范课演示合并冲突的时候新建了一个feat分支，那我们先将这个feat分支删除掉，避免它干扰我们的演示，执行 git branch -d feat 命令就可以了，还有在之前合并完成之后我们已经把dev分支删除掉了，那么现在就需要把它恢复回来，执行gie checkout -b dev，后面加_dev:2这次提交的提交ID，这样就可以恢复到这个分支的这一时间点的状态，那这个提交ID可以在GitKraken中看到，如果没有的话 就在标题中点一下右键然后选中这个Sha，也可以在命令行中使用 git log 命令来查看</p><p>这个命令太长了可以使用alias命令来将它定义成一个别名，比如这里我们将它定义成graph，这样以后我们就可以直接使用graph命令来查看图形化的提交记录了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git branch -d feat</span><br><span class="line">gie checkout -b dev</span><br><span class="line">git <span class="built_in">log</span> --oneline --graph --decorate --all</span><br><span class="line"><span class="built_in">alias</span> graph=<span class="string">&quot;git log --oneline --graph --decorate --all&quot;</span></span><br></pre></td></tr></table></figure><p>然后我们再切换回main分支</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一小时kafka</title>
      <link href="/posts/5cbbfd6.html"/>
      <url>/posts/5cbbfd6.html</url>
      
        <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>kafka是开源的分布式事件流处理平台</p><p>可以使用kafka作为消息中间件，将服务之间的通信和数据交换解耦，每个服务可以将自己的操作封装成一个事件，比如用户下单之后，订单服务会产生一个订单已创建事件，订单服务就是一个生产者，然后这个事件会被发送到卡夫卡中，库存 积分 支付等等其他服务就可以订阅这个事件，它们也就是消费者 Consumer，当他们准备好的时候就可以从Kafka中读取这个事件并进行处理，这种模式就是我们常说的生产者消费者模式。</p><p>一些服务作为生产者来产生事件，其他服务作为消费者来处理事件，中间的Kafka就是一个消息队列，将生产者和消费者解耦，每个事件在Kafka中都有一个唯一的序号叫做offset，用来标识事件的位置，消费者可以通过offset来跟踪已消费的事件，确保不会重复消费或者漏消费，而且这些事件会被持久化到Kafka中，即使某个服务暂时不可用也不会丢失数据，等到服务恢复后就可以从上一次的offset开始继续处理。</p><p>在实际业务中不同服务的速度可能会有差异，比如订单服务可能处理得比较快，而支付服务可能处理得比较慢，这就会导致消费者的处理速度跟不上生产者的发送速度，如果生产者一直在发送消息而消费者处理不过来，那么这些消息自然也就积压在Kafka中，既然一个消费者跟不上的话，那么就可以增加更多的消费者来处理。同样的道理 如果生产者不够快，当然也可以增加更多的生产者来发送消息。</p><p>但是新的问题来了，当有很多个生产者和消费者时，如何让消息更加有序地进行分类和组织呢，Kafka提供了一个机制：主题 <strong>Topic</strong>，也就是可以将消息按照主题来进行分类和组织，可以把主题看作是文件系统中的文件夹，而事件则是文件夹中的文件，或者也可以类比成数据库中的表，生产者可以把不同类型的消息放到不同的主题中，不同的消费者就可以订阅不同的主题，每个消费者只需要关注自己订阅的主题，然后独立地进行处理而不需要关心其他主题的消息</p><p>每个主题还可以再细分成多个<strong>partition</strong>分区，每个分区可以被不同的消费者线程并行处理，比如一个主题有10个分区，那么就可以最多有10个消费者，同时并行地来处理这个主题的消息，需要注意的是Kafka只会保证每个分区内的消息是有序的，但是不同分区之间的消息顺序是不保证的，也就是说如果有一个主题有多个分区，那么就不能保证整个主题的全局顺序，所以在设计卡夫卡的主题和分区时需要根据业务需求来合理划分，比如如果想要保证用户的交易记录是有序的，那么就可以把同一个用户的交易记录放到同一个分区里面就可以了，常用的做法是把用户ID作为分区的Key，Kafka会根据Key的哈希值来决定消息应该放到哪个分区，相同的Key也就会被放到同一个分区中</p><p><img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6kafka/image-20251015165012924.png"></p><p>为了确保Kafka的高可用性和可靠性，Kafka集群通常由多个<strong>Broker</strong>组成，每个Broker都是一个独立的服务器，负责存储和转发消息，每个broker可以存储多个主题的多个分区，并且每个分区可以有多个副本，副本是分区的备份，每个分区有一个Leader和多个Follower，Leader负责对外处理实际的读写请求，而Follower负责复制Leader的数据，这样就可以保证即使某个Broker宕机也不会丢失数据，其他Broker上的副本可以继续对外提供服务，Kafka集群的规模可以根据业务需求进行扩展，比如可以增加更多的Broker来提高吞吐量和可用性，Kafka会自动将主题的分区分布到不同的Broker上，来实现负载均衡和高可用性</p><p><img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6kafka/image-20251015170936455.png" alt="image-20251015170936455"></p><p>Kafka还提供了消费者组（consumer group）的概念，多个消费者可以组成一个消费者组，共同消费同一个或者多个主题的消息，有一点需要稍微注意的是每条消息只能被同一消费者组中的一个消费者消费，但是可以被多个不同的消费者组消费，这样就可以实现多种不同的消费场景，最简单和常用的使用场景就是，当多个系统或者服务需要消费同一个主题的消息时，就可以让不同的系统使用不同的消费者组，比如还是我们之前的例子，就可以把库存服务 积分服务 支付服务等分别放到不同的消费者组中，每个消费者组可以独立地消费消息和处理业务，这样即便订阅的是同一个主题，系统之间也不会互相干扰</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>官网：<a href="https://kafka.apache.org/">https://kafka.apache.org/</a></p><p>快速开始：<a href="https://kafka.apache.org/quickstart">https://kafka.apache.org/quickstart</a></p><p>一般不在win安装，先把下载的文件传到linux里，上传完成之后输入ls命令来查看一下确认安装包，然后使用tar命令来解压一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf kafka_2.13-4.1.0.tgz</span><br></pre></td></tr></table></figure><p>进入解压后的目录里面来看一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> kafka_2.13-4.1.0</span><br><span class="line"><span class="built_in">ls</span></span><br></pre></td></tr></table></figure><p>接下来需要启动Kafka服务，我们先回到官网找到快速开始这个页面<a href="https://kafka.apache.org/quickstart%EF%BC%8C%E9%A6%96%E5%85%88%E8%A6%81%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E9%9B%86%E7%BE%A4%E7%9A%84UUID%EF%BC%8C%E8%BF%99%E4%B8%AAUUID%E5%B0%B1%E6%98%AFKafka%E5%9C%A8KRatt%E6%A8%A1%E5%BC%8F%E5%BC%95%E5%85%A5%E7%9A%84%E8%AE%BE%E8%AE%A1%EF%BC%8C%E7%94%A8%E6%9D%A5%E5%94%AF%E4%B8%80%E6%A0%87%E8%AF%86%E4%B8%80%E4%B8%AA%E9%9B%86%E7%BE%A4%EF%BC%8C%E9%98%B2%E6%AD%A2%E4%B8%8D%E5%90%8C%E9%9B%86%E7%BE%A4%E7%9A%84Broker%E4%B9%8B%E9%97%B4%E5%8F%91%E7%94%9F%E5%86%B2%E7%AA%81%EF%BC%8C%E6%89%A7%E8%A1%8C%E8%BF%99%E8%A1%8C%E5%91%BD%E4%BB%A4,%E8%BF%99%E6%A0%B7%E5%B0%B1%E4%BC%9A%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E5%94%AF%E4%B8%80%E7%9A%84%E9%9B%86%E7%BE%A4ID%EF%BC%8C%E5%B9%B6%E4%B8%94%E6%8A%8A%E5%AE%83%E4%BF%9D%E5%AD%98%E5%88%B0%E8%BF%99%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%87%8C%E9%9D%A2">https://kafka.apache.org/quickstart，首先要生成一个集群的UUID，这个UUID就是Kafka在KRatt模式引入的设计，用来唯一标识一个集群，防止不同集群的Broker之间发生冲突，执行这行命令,这样就会生成一个唯一的集群ID，并且把它保存到这个环境变量里面</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> kafka_2.13-4.1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建用户目录下的数据目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/kafka-data</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;log.dirs=/home/shelter/kafka_2.13-4.1.0/kafka-data&quot;</span> &gt;&gt; config/server.properties</span><br><span class="line"></span><br><span class="line">KAFKA_CLUSTER_ID=<span class="string">&quot;<span class="subst">$(bin/kafka-storage.sh random-uuid)</span>&quot;</span></span><br></pre></td></tr></table></figure><p>然后把第二行命令也复制粘贴执行一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-storage.sh format --standalone -t <span class="variable">$KAFKA_CLUSTER_ID</span> -c config/server.properties</span><br></pre></td></tr></table></figure><p>最后是启动Kafka服务的命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-server-start.sh config/server.properties</span><br></pre></td></tr></table></figure><p>最后提示Kafka Server started就说明启动成功了，然后新打开一个终端窗口，进入到Kafka的安装目录下，先来查看一下版本信息，可以看到是4.1.0，然后再来查看一下主题列表，这里大家可以先不用管这一行命令的具体含义，只需要知道这是用来查看Kafka主题列表的命令就可以了，回车之后可以看到没有任何返回，这是因为我们还没有创建任何主题</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> kafka_2.13-4.1.0</span><br><span class="line"><span class="comment">#查看kafka版本</span></span><br><span class="line">bin/kafka-topics.sh --version</span><br><span class="line"><span class="comment">#查看主题</span></span><br><span class="line">bin/kafka-topics.sh --bootstrap-server localhost:9092 --list</span><br></pre></td></tr></table></figure><p>需要注意的是kafka是基于java运行的所以需要jdk环境，尤其是对于新版的Kafka4.0.0，需要java11或者更高的版本，linux使用docker的话因为容器的隔离性，所以不能正常让kafka运行，要直接在宿主机安装java</p><p><strong>如果需要docker安装，再去看视频，这里懒得弄了</strong></p><h1 id="创建和管理主题"><a href="#创建和管理主题" class="headerlink" title="创建和管理主题"></a>创建和管理主题</h1><p> 另外我也是使用Fish Shell的简写也就是abbr功能来简化一些常用的操作，比如当我输入了ks之后就会自动补全整行命令，这样就可以快速列出所有的主题</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">注意这里的 kls 并不是Kafka自身的命令</span><br><span class="line">而是Fish Shell定义的一个简写功能。</span><br><span class="line">定义方法:</span><br><span class="line"><span class="variable">$abbr</span>-a 简写 命令行</span><br><span class="line">例如:</span><br><span class="line"><span class="variable">$abbr</span> -a yjslecho 一键三连</span><br></pre></td></tr></table></figure><p>我们先来查看一下当前都有哪些主题，在bmn目录下有一个叫做kafka-topics的脚本，这个脚本就是用来管理Kafka主题的，我们可以使用它来列出当前所有的主题，或者创建 修改和删除主题等操作都可以通过这个脚本来完成</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> kafka_2.13-4.1.0</span><br><span class="line"><span class="built_in">ls</span> bin</span><br></pre></td></tr></table></figure><p>第一个参数表示连接到Kafka服务的地址，这里我们使用本地的Kafka服务，所以使用的是localhost;9092端口，第二个参数是-list，也就表示列出所有的主题，回车之后可以看到返回结果是空的，因为目前我们还没有创建任何主题</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --bootstrap-server localhost:9092 --list</span><br></pre></td></tr></table></figure><p>那我们先来创建一个主题，比如我们创建一个叫做mytopic的主题，就可以输入kafka-topics之后，后面还是加上表示本地服务的参数，然后再加上–create选项，最后再指定主题的名称比如就叫做my-topic，回车之后 一个主题就创建好了，可以看到提示信息Created topic my-topic.显示主题创建成功了，再次查询就显示主题了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --bootstrap-server localhost:9092 --create --topic my-topic</span><br></pre></td></tr></table></figure><p>我们也可以把-list参数换成–describe，这样就可以查看主题的详细信息，比如分区数 副本因子等等。小技巧：因为kafka指令长，所以可以在每个参数后面加上一个反斜杠，这样就可以把命令分成多行来输入，可以提高一点可读性</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh \</span><br><span class="line">--bootstrap-server localhost:9092 \</span><br><span class="line">--list</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看配置</span></span><br><span class="line">bin/kafka-topics.sh --bootstrap-server localhost:9092 --describe</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line">Topic: my-topicTopicId: 1yc984vWQs22JpABqx1GsAPartitionCount: 1ReplicationFactor: 1Configs: min.insync.replicas=1,segment.bytes=1073741824</span><br><span class="line">Topic: my-topicPartition: 0Leader: 1Replicas: 1Isr: 1Elr: LastKnownElr: </span><br></pre></td></tr></table></figure><h1 id="修改主题"><a href="#修改主题" class="headerlink" title="修改主题"></a>修改主题</h1><p>我们也可以对主题的设置进行一些修改，比如修改分区数 保留时间等等，还是以刚刚的my-topic主题为例，它的分区数和副本因子都是1，这里也并没有显示它的默认保留时间，默认情况下Kafka会保留消息7天，如果想要修改这个时间的话，可以使用kafka-configs这个脚本来修改主题的配置</p><p>比如把保留时间改为10秒的话，就可以输入kafka-configs之后后面加上服务器地址参数，然后再加上–entity-type topics表示我们要修改的是主题的配置，接着再加上–entityname my-topic表示我们要修改的主题名称，然后再加上一个–alter选项表示我们要修改配置，最后再加上一个–add-config和一个保留时间的参数表示我们要把保密时间设置为10秒，回车之后修改就生效了，然后再次查看主题的配置，可以看到保密时间已经被修改为10秒了，注意 这里仅仅是为了演示，实际使用中一般不会把保留时间设置得这么短，因为这样会导致消息很快就被删除了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-configs.sh --bootstrap-server localhost:9092 --entity-type topics --entity-name my-topic --alter --add-config retention.ms=10000</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line">shelter@shelter-virtual-machine:~/kafka_2.13-4.1.0$ bin/kafka-topics.sh --bootstrap-server localhost:9092 --describe</span><br><span class="line">Topic: my-topicTopicId: 1yc984vWQs22JpABqx1GsAPartitionCount: 1ReplicationFactor: 1Configs: min.insync.replicas=1,segment.bytes=1073741824,retention.ms=10000</span><br><span class="line">Topic: my-topicPartition: 0Leader: 1Replicas: 1Isr: 1Elr: LastKnownElr:</span><br></pre></td></tr></table></figure><h1 id="删除主题"><a href="#删除主题" class="headerlink" title="删除主题"></a>删除主题</h1><p>删除一个主题也非常简单，还是使用刚刚的kafka-topics脚本，只需要加上–delete选项，然后再使用–topic参数指定要删除的主题名称，比如我们要删除刚刚创建的my-topic主题，回车之后就会提示主题删除成功了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh -bootstrap-server localhost:9092 --delete --topic my-topic</span><br></pre></td></tr></table></figure><h1 id="发送接收消息"><a href="#发送接收消息" class="headerlink" title="发送接收消息"></a>发送接收消息</h1><p>接下来我们来模拟一个生产者发送一些事件到Kafka主题中，在bin目录下有一个kafka-console-producer的脚本，这个脚本可以用来发送消息到指定的Kafka主题，因为上节课创建的主题最后被删除了，所以我们还是先来创建一个，名字还是叫my-topic，主题创建好之后我们就可以使用kafka-console-producer这个命令来发送事件到刚刚创建的主题中,服务器地址使用localhost;9092，主题名是刚刚创建的my-topic，回车之后就会进入一个交互式的命令行界面</p><p>在这里我们可以输入一些事件数据，每输入一行数据都会作为一条消息发送到Kafka的my-topic主题中，比如我们可以输入一些简单的文本信息，先来输入一个欢迎来到GeekHour，然后再来个一键三连 ，输入完成之后可以使用Control+C快捷键来退出，这样我们就成功地将一些事件发送到了Kafka的主题中。</p><p>然后我们再来打开一个新的终端来读取刚刚发送的事件消息，方法是使用bin目录下的另外一个脚本，也就是kafka-console-consumer这个脚本，这个脚本可以用来消费Kafka主题中的消息，输入脚本名称之后服务器地址还是使用localhost:9092，中间加上了一个–from-beginning选项表示从主题的开头开始读取消息，如果不加这个选项的话就会从上次消费的位置开始读取，最后指定主题名是my-topic，回车之后就可以看到刚刚发送的消息了，这个时候如果我们再回到第一个终端，在生产者中继续输入新的消息那么在消费者终端中也会实时显示出来，这样就实现了生产者和消费者之间的实时消息传递</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --bootstrap-server localhost:9092 --create --topic my-topic</span><br><span class="line"></span><br><span class="line">bin/kafka-topics.sh --bootstrap-server localhost:9092 --list</span><br><span class="line"></span><br><span class="line">bin/kafka-console-producer.sh --bootstrap-server localhost:9092 --topic my-topic</span><br><span class="line"></span><br><span class="line">欢迎来到geekhour</span><br><span class="line">一键三连</span><br><span class="line"></span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --from-beginning --topic my-topic</span><br></pre></td></tr></table></figure><p>这个示例只是让大家对于Kafka有个直观的了解，实际使用中我们一般不会直接在命令行中来发送和消费消息，而是会使用编码的方式来操作Kafka</p><h1 id="GUI工具"><a href="#GUI工具" class="headerlink" title="GUI工具"></a>GUI工具</h1><p>图形化工具：Offset Explorer : <a href="https://kafkatool.com/%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E4%B9%8B%E5%89%8D%E7%9A%84Kafka">https://kafkatool.com/，也就是之前的Kafka</a> Tool，它是一个跨平台的Kafka管理工具，可以帮助我们可视化地管理Kafka集群 主题和消费者，这里不多做演示，可以看视频</p><h1 id="在程序中使用kafka"><a href="#在程序中使用kafka" class="headerlink" title="在程序中使用kafka"></a>在程序中使用kafka</h1><p>首先是前端最经常使用的javaScript，在前端NodeJS环境中可以很方便地同Kafka进行交互，可以使用一些现成的库来实现Kafka的Producer和Consumer，比如使用KafkajS，它是一个纯javaScript编与的Kafka客户端库，可以通过API的方式来提供Kafka的Producer和Consumer功能，包括发送和接收消息，并且提供了简单易用的API接口可以很方便地集成到NodeS应用程序中，KafkaS是一个开源项目，可以在GitHub上找到它的源代码和文档</p><p>首先需要创建一个新的NodeJS项目，打开一个终端之后先来创建一个文件夹比如就叫做kafka-js-demo，然后进入到这个文件夹里面，输入pnpmintt 命令来初始化一个新的NodeJS项目，这个命令会创建一个package.json文件，文件里面包含了项目的基本信息和依赖关系，我个人比较习惯使用pnpm来管理前端NodeJS的项目，当然使用其他的包管理器比如npm或者yamn也是没有问题的</p><p>接下来还需要安装一个KafkaJS库，执行 pnpm install kafkajs 命令，在命令行使用code命令来在VSCode中打开这个文件夹，这里的点号表示当前目录，-r表示在当前窗口打开，当然使用Cursor也是OK的，然后新建一个js文件比如叫做producer.js，负责发送消息到Kafka。小技巧：使用cursor可以先输入一些简单的注释来提示AI你想要实现的功能，比如这里我们在文件的第一行输入一个&#x2F;&#x2F;kafka producer example，这样cursor就会根据这个提示来自动补全代码，首先需要引入KafkaJS库，然后创建一个Kafka客户端实例，最后创建一个发送消息的函数，并且调用它来发送消息到Kafka，第一个参数表示主题的名称也就是我们之前创建的my-topic，第二个参数是消息内容就直接使用它自动生成的内容就可以，这样这个Producer文件就完成了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> kafka-js-demo</span><br><span class="line"><span class="built_in">cd</span> kafka-js-demo</span><br><span class="line">pnpm init 这里我们用npm init</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> package.json 这里我们使用<span class="built_in">type</span> package.json</span><br><span class="line">pnpm install kafkajs 这里我们使用npm install kafkajs</span><br><span class="line">code .-r 这里直接用cursor打开目录</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// kafka producer example</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Kafka</span> &#125;= <span class="built_in">require</span>(<span class="string">&#x27;kafkajs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> kafka = <span class="keyword">new</span> <span class="title class_">Kafka</span>(&#123;</span><br><span class="line">    <span class="attr">clientId</span>:<span class="string">&#x27;my-producer&#x27;</span>,</span><br><span class="line">    <span class="attr">brokers</span>:[<span class="string">&#x27;192.168.23.128:9092&#x27;</span>]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> producer = kafka.<span class="title function_">producer</span>();  </span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params">topic,message</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> producer.<span class="title function_">connect</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Producer connected&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> producer.<span class="title function_">send</span>(&#123;</span><br><span class="line">            <span class="attr">topic</span>: topic,</span><br><span class="line">            <span class="attr">messages</span>:[&#123;<span class="attr">value</span>:message&#125;]</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Message sent successfully:&#x27;</span>, result);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error sending message:&#x27;</span>, error);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> producer.<span class="title function_">disconnect</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Producer disconnected&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sendMessage</span>(<span class="string">&#x27;test-topic&#x27;</span>, <span class="string">&#x27;Hello KafkaJS user!&#x27;</span>);</span><br></pre></td></tr></table></figure><p>保存一下这个文件，然后在下面的终端里面输入node加上这个文件名来执行一下，回车之后可以看到提示我们消息发送成功了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> F:\kafka-js-demo</span><br><span class="line">node producer.js</span><br><span class="line"></span><br><span class="line">遇到问题：虽然您的代码配置了 192.168.23.128:9092，但 Kafka 服务返回的元数据中告诉客户端要连接 localhost:9092。这是 Kafka 服务端配置问题，具体是 advertised.listeners 配置不正确。在 Linux 虚拟机 中执行：</span><br><span class="line"><span class="built_in">cd</span> ~/kafka_2.13-4.1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 强制删除整个数据目录</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf kafka-data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 重新创建数据目录</span></span><br><span class="line"><span class="built_in">mkdir</span> kafka-data</span><br><span class="line"></span><br><span class="line">创建正确的配置文件：</span><br><span class="line"><span class="built_in">cat</span> &gt; config/server.properties &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment"># Kafka KRaft 模式配置</span></span><br><span class="line">process.roles=broker,controller</span><br><span class="line">node.id=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 监听器配置 - 正确的格式</span></span><br><span class="line">listeners=PLAINTEXT://0.0.0.0:9092,CONTROLLER://localhost:9093</span><br><span class="line">controller.listener.names=CONTROLLER</span><br><span class="line">advertised.listeners=PLAINTEXT://192.168.23.128:9092</span><br><span class="line">inter.broker.listener.name=PLAINTEXT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制器配置</span></span><br><span class="line">controller.quorum.voters=1@localhost:9093</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据目录</span></span><br><span class="line">log.dirs=/home/shelter/kafka_2.13-4.1.0/kafka-data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基础配置</span></span><br><span class="line">num.partitions=1</span><br><span class="line">offsets.topic.replication.factor=1</span><br><span class="line">transaction.state.log.replication.factor=1</span><br><span class="line">transaction.state.log.min.isr=1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">KAFKA_CLUSTER_ID=<span class="string">&quot;<span class="subst">$(bin/kafka-storage.sh random-uuid)</span>&quot;</span></span><br><span class="line">bin/kafka-storage.sh format --standalone -t <span class="variable">$KAFKA_CLUSTER_ID</span> -c config/server.properties</span><br><span class="line">bin/kafka-server-start.sh config/server.properties</span><br></pre></td></tr></table></figure><p>接下来我们再来创建一个消费者来接收这个消息，创建一个consumer.js的消费者文件，同样先来添加一行&#x2F;&#x2F;kafka consumer example的注释来补全代码，同样需要先引入KafkaJS库，然后创建一个Kafka客户端实例，接着创建一个消费者函数，最后还需要调用一下这个函数来接收消息，然后保存一下这个文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// kafka consumer example</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Kafka</span> &#125;= <span class="built_in">require</span>(<span class="string">&#x27;kafkajs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> kafka = <span class="keyword">new</span> <span class="title class_">Kafka</span>(&#123;</span><br><span class="line">    <span class="attr">clientId</span>:<span class="string">&#x27;my-consumer&#x27;</span>,</span><br><span class="line">    <span class="attr">brokers</span>:[<span class="string">&#x27;192.168.23.128:9092&#x27;</span>]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> consumer = kafka.<span class="title function_">consumer</span>(&#123; <span class="attr">groupId</span>:<span class="string">&#x27;my-group&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">consumeMessages</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> consumer.<span class="title function_">connect</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Consumer connected&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> consumer.<span class="title function_">subscribe</span>(&#123; <span class="attr">topic</span>:<span class="string">&#x27;test-topic&#x27;</span>, <span class="attr">fromBeginning</span>:<span class="literal">true</span>&#125;);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Subscribed to topic test-topic&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> consumer.<span class="title function_">run</span>(&#123;</span><br><span class="line">            <span class="attr">eachMessage</span>:<span class="title function_">async</span> (&#123;topic,partition,message&#125;)=&gt;&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Received message on topic <span class="subst">$&#123;topic&#125;</span> in partition <span class="subst">$&#123;partition&#125;</span> at offset <span class="subst">$&#123;message.offset&#125;</span>:`</span>, message.<span class="property">value</span>.<span class="title function_">toString</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error consuming messages:&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">consumeMessages</span>(<span class="string">&quot;my-topic&quot;</span>);</span><br></pre></td></tr></table></figure><p>再打开一个终端使用命令行工具看一下，先来进入到Kafka的安装目录看一下有哪些主题，这里多了一个-consumer offsets的主题，这是Kafka内部使用的一个主题，用来存储消费者的偏移量信息，一般不需要太关注它，然后使用命令来接收一下消息，回车之后可以看到在producer,js中发送的消息也已经被接收到了，这就说明我们的JavaScript代码成功地与Kafka进行了交互</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> kafka_2.13-4.1.0</span><br><span class="line">bin/kafka-topics.sh --bootstrap-server localhost:9092 --list</span><br><span class="line"></span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --from-beginning --topic my-topic</span><br></pre></td></tr></table></figure><h1 id="搭建使用kafka集群"><a href="#搭建使用kafka集群" class="headerlink" title="搭建使用kafka集群"></a>搭建使用kafka集群</h1><p>接下来我们将会搭建一个包含三个Broker的Kafka集群，每个Broker都运行在独立的Docker容器中，我们将使用Docker Compose来简化容器的管理和配置，还会启动一个Kafka Ul界面工具来方便我们进行集群的管理和监控。</p><p><img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6kafka/image-20251020181017728.png" alt="image-20251020181017728"></p><p>先来创建一个Docker网络用来让Kafka的容器之间可以互相通信，创建Docker网络的命令是dockernetwork create，后面加上网络的名称和子网地址就可以了，然后再来创建一个文件夹用来存储Kafka集群的配置文件和数据，在这个目录下再分别创建三个子目录，分别用来存储每个Broker的数据，比如就叫做kafka1 2和3</p><p>接下来还需要创建一个DockerCompose文件来定义Kafka集群的配置，这里我们已经提前准备好了一个Docker Compose文件，我们稍微来解释一下这个文件的内容，networks这里定义了一个叫做kafka-net的Docker网络，其实如果这里定义了的话那刚刚我们手动创建网络的那个步骤是可以省略的，因为待会我们执行DockerCompose的时候也会自动帮我们创建这个网络，不过事先创建好也是可以的</p><p>然后下面的service部分就分别定义了三个Kafka Broker和一个kafika UI服务，第一个kafka1服务将9092和9093端口正常映射到宿主机，下面使用volumes将本地电脑中的&#x2F;kafkal&#x2F;data目录挂载到了容器中的&#x2F;var&#x2F;lib&#x2F;kafka&#x2F;data目录，这样就可以将Kafka容器中的数据持久化到本地文件系统中，即使容器重启或者被删除，数据也仍然会保留在本地不会丢失。再下面就是使用了刚刚定义的kafka-net网络，下面的Kafka2和KafKa3服务也是类似的配置，唯一不同的是端口号和数据目录，Kafka2服务将端口映射到宿主机的9094和9095端口</p><p>还有下面的数据挂载位置也是&#x2F;kafka2下面的data目录，Kafka3服务也是一样的，端口映射到了9096和9097，挂载位置是kafka3下面的data目录，最后还有一个Kafka UI服务，是一个Web界面工具，端口是8080，用来管理和监控Kafka集群，它依赖于上面定义的三个Kafka Broker服务和kafka-net网络，这就是这个Kafka配置文件的基本内容</p><p>保存退出之后回到命令行，输入DockerCompose之后后面加上-f指定这个配置文件，然后再加上up参数和-d选项之后回车，就会在后台启动所有的Kafka Broker和Kafka U容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> docker network create kafka-net --subnet 172.20.0.0/16</span><br><span class="line"><span class="built_in">mkdir</span> kafka-cluster</span><br><span class="line"><span class="built_in">cd</span> kafka-cluster</span><br><span class="line"><span class="built_in">mkdir</span> -p kafka1/data kafka2/data kafka3/data</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">vi docker-compose.yml</span><br><span class="line"></span><br><span class="line">:wq</span><br><span class="line"><span class="built_in">sudo</span> docker compose -f docker-compose.yml up -d</span><br></pre></td></tr></table></figure><p>我们可以使用docker compose后面加上-f参数和配置文件的名称，然后再加上一个ps来查看Kafka集群的状态，这个命令将会显示所有容器的状态确保所有的Kafka Broker都在运行，然后打开一个浏览器在地址栏输入localhost:8080就可以打开一个Kafka ul界面，在这里我们可以看到所有的Broker主题 消费者组等信息，还可以创建新的主题</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> docker compose -f docker-compose.yml ps</span><br></pre></td></tr></table></figure><p>Kafka集群启动之后也可以创建或者查看一个主题，不过因为是使用Docker来运行的，所以命令前面我们需要加上 docker exec来执行Kafka的命令行工具，我们可以使用下面的命令来创建一个主题，这里的replication-factor参数表示主题的副本数，partitions参数表示主题的分区数，也可以使用list参数来查看所有的主题，可以看到一个叫做my-topic的主题就被创建好了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> it kafkal kafka-topics \</span><br><span class="line">    --create \</span><br><span class="line">    --topic my-topic \</span><br><span class="line">    --bootstrap-server kafka1:9092 \</span><br><span class="line">    --replication-factor 3 \</span><br><span class="line">    --partitions 3</span><br><span class="line">    </span><br><span class="line">docker <span class="built_in">exec</span> it kafkal kafka-topics \</span><br><span class="line">    --list \</span><br><span class="line">    --bootstrap-server kafka1:9092</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 中间件 </tag>
            
            <tag> kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>15分钟搭建堡垒机</title>
      <link href="/posts/a492c436.html"/>
      <url>/posts/a492c436.html</url>
      
        <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>堡垒机 也叫跳板机，是一种网络安全产品，用来管理和控制服务器的访问权限 ，完成用户身份认证 授权 审计等等一系列的安全保障工作</p><h1 id="安装配置虚拟机"><a href="#安装配置虚拟机" class="headerlink" title="安装配置虚拟机"></a>安装配置虚拟机</h1><p> 打开VMware之后在页面左侧的空白区域点击鼠标右键选择新建虚拟机，然后类型这里选择推荐的典型配置，这里需要选择一下Linux系统的iso镜像文件，然后点击下一步，这里需要配置一下系统的名称 用户名和密码，这些内容都可以随便填写一下，比如系统名称就叫做JumpServer，用户名叫shelter，密码随便填一个，然后点击下一步，这里需要选择一下虚拟机的名称和存储的位置，有一点需要提示的就是下面的虚拟机存储位置需要预留足够的空间，然后下一步，保留20g就行，下一步，这里可以调整一下虚拟机的硬件配置，建议至少调整到4核CPU和8G内存以上，最后点完成</p><p>貌似安装过就不需要再安装了</p><p>进入后打开终端，输入ifconfig查看虚拟机ip地址192.168.23.128，也可以用xshell通过ssh连接虚拟机</p><p>然后模拟企业内部的各种服务器资源，可以右击管理-克隆几台这个虚拟机</p><h1 id="安装部署jumpServer"><a href="#安装部署jumpServer" class="headerlink" title="安装部署jumpServer"></a>安装部署jumpServer</h1><p>下载地址：<a href="https://community.fit2cloud.com/#/products/jumpserver/downloads">https://community.fit2cloud.com/#/products/jumpserver/downloads</a></p><p>JumpServer官网：jumpserver.org</p><p>下载完安装包后用xshell的传输，输入快捷键 Ctr+AIt+F打开文件传输窗口，找到刚刚下载的安装包，然后就可以直接传输到虚拟机里面了，或者使用scp命令也是可以的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp jumpserver-ce-v4.5.0-x86_64.tar.gz root@192.168.114.134:~/</span><br></pre></td></tr></table></figure><p>传输完成之后就可以开始安装jumpServer了，登录之后首先需要来解压一下这个安装包，输入下面的tar命令来解压一下jumpServer的压缩包</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf undefined.gz</span><br></pre></td></tr></table></figure><p>然后进入到解压出来的目录里面</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> jumpserver-ce-v4.<span class="number">10</span>.<span class="number">10</span>-x86_64</span><br></pre></td></tr></table></figure><p>我们先来查看一下README文件，一般来说这个文件里面会有一些安装的说明和步骤，使用vi命令后面加上文件名来打开文件，然后往下翻一翻，它提示我们说只要使用这一行命令就可以安装JumpServer了，那我们回到终端来执行一下，这是一个安装脚本，会自动安装jumpServer的所有组件</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi README.<span class="built_in">md</span></span><br></pre></td></tr></table></figure><p><img src="/./images/15%E5%88%86%E9%92%9F%E6%90%AD%E5%BB%BA%E5%A0%A1%E5%9E%92%E6%9C%BA/image-20251017214835494.png" alt="image-20251017214835494"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">:q!强制退出，:wq保存退出 :q退出</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到 root 用户</span></span><br><span class="line"><span class="built_in">sudo</span> su -</span><br><span class="line"></span><br><span class="line">启动：</span><br><span class="line"><span class="comment"># 然后运行安装脚本</span></span><br><span class="line"><span class="built_in">cd</span> /home/shelter/jumpserver-ce-v4.10.10-x86_64</span><br><span class="line"></span><br><span class="line">./jmsctl.sh install</span><br></pre></td></tr></table></figure><p>首先第一步是检查配置文件，然后是安装和配置Docker各种镜像文件包括Redis PostgreSOL数据库，下面就是JumpServer的各个组件</p><ul><li><p>弹出个Configure Persistent Directory，这里是询问我们是否使用默认的持久化目录配置，保持默认就可以</p></li><li><p>弹出个Configure DB，这一步是询问我们是否想要使用外部的PostgreSOL数据库，如果你想要单独部署数据库的话这里可以选择yes，这里选择了no</p></li><li><p>弹出个Configure Redis，选择redis还是哨兵模式，默认redis就行，不使用外部redis</p></li><li><p>弹出是否需要配置 JumpServer 对外访问端口?(y&#x2F;n)(默认为 n):默认是80端口，选择 <code>y</code> 后，系统通常会询问这些端口，<strong>初学者建议这样设置</strong>：</p></li><li><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP 端口 (默认 80): [直接回车]</span><br><span class="line">HTTPS 端口 (默认 443): [直接回车] </span><br><span class="line">SSH 端口 (默认 2222): [直接回车]</span><br></pre></td></tr></table></figure></li></ul><p>然后就是数据库初始化，他还提示我们：</p><ol><li><a href="http://192.168.23.128/">http://192.168.23.128:80</a></li><li>默认用户:admin</li><li>默认密码:ChangeMe</li></ol><p>使用.&#x2F;jmsctl.sh可以看到一些命令，然后我们启动docker服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./jmsctl.sh start</span><br><span class="line">docker ps 检查容器状态</span><br></pre></td></tr></table></figure><p>打开浏览器复制上面的地址，浏览器默认使用的是https的方式，有的时候即便我们输入的是http它也会自动跳转到https，但是我们这里因为没有配置SSL证书，所以只能通过http的方式来访问，如果发现页面访问不到的话确认一下你的地址是不是浏览器自动帮你加上了s，是的话就去掉s。然后就可以看到lumpServer的登录界面表示安装成功</p><h1 id="配置和使用jumpServer"><a href="#配置和使用jumpServer" class="headerlink" title="配置和使用jumpServer"></a>配置和使用jumpServer</h1><p>首先输入默认的用户名和密码，第一次登录的时候会提示我们修改密码</p><p>主界面左侧是一个导航栏，左上角有一个切换按钮，点击之后可以切换到控制台 审计台和工作台，控制台就是用来管理lumpServer的各种配置和设置的，比如添加用户和用户组，配置各种服务器资产，管理账号和权限等等。审计台也就是用来查看和审计用户的各种操作记录和日志的，用户通过jumpServer登录到服务器上的所有操作都会被记录下来。工作台是用来连接到各种服务器资源或者传输和管理文件的</p><p><strong>用户列表：</strong></p><p>我们先来切换到控制台添加一些用户和服务器，先添加用户比如就叫做shelter，邮箱随便，点击提交之后这个用户就创建好了，注意这里的用户是lumpServer的用户而并不是Linux服务器的用户。</p><p><strong>资产列表：</strong></p><p>下面再来添加一台服务器，点击左边资产管理的资产列表，在右侧的详细页面上面就有一个创建按钮，点击之后选择一个Linux服务器用户。服务器名称这里可以随便填一个，比如server1，ip地址填一下192.168.23.128，节点选择默认就好，账号这里点击新增来添加一个，名称和用户名这里还是都叫做shelter，然后输入密码点击确认。</p><p>这里稍微来说明一下，我们在之前配置的用户和用户组是用来登录到umpServer管理台或者工作台的，而这里的账号是用来连接到这台Linux服务器的。另外如果想要添加特权账号的话，还需要在目标服务器上提前配置这个用户的sudo权限，方法就是在根etc下的sudo配置文件里面添加这样的一行就可以了</p><p><img src="/./images/15%E5%88%86%E9%92%9F%E6%90%AD%E5%BB%BA%E5%A0%A1%E5%9E%92%E6%9C%BA/image-20251018011143745.png" alt="image-20251018011143745"></p><p>geekhour改为shelter</p><p>这样我们就添加了一台服务器资源，在资产列表页面 也能够找到这一台服务器，点击最右边的扩展按钮来测试一下，如果能看到这个界面的话就表示连接成功了，连接失败一般都是账号或者密码填写错误或者服务器防火墙没有打开之类的问题</p><p><img src="/./images/15%E5%88%86%E9%92%9F%E6%90%AD%E5%BB%BA%E5%A0%A1%E5%9E%92%E6%9C%BA/image-20251018011300654.png" alt="image-20251018011300654"></p><p>同样的方法 我们再来添加另外几台服务器</p><p><strong>资产授权</strong>：</p><p>配置完还需要再来配置一下资产授权，所谓的资产授权就是用来配置哪些用户可以访问哪些服务器资源的。点击左侧授权管理的资产授权，就会来到一个资产授权规则的配置页面，名称就叫做规则1，用户就选择刚刚添加的shelter，资产这里可以把我们刚刚添加的三台服务器都添加进来，节点还是选择默认就好，下面基本上都保持默认就可以然后提交</p><p><strong>模拟</strong></p><p>然后模拟一下其他用户的情况，重新打开一个这个页面，输入刚刚配置的用户名密码就可以进入。这里可以看到普通用户的话在左侧的切换按钮里面就只有一个工作台，是看不到控制台和审计台面板的，这两个面板只有lumpServer的管理员才能看到。点击一下菜单栏里面的连接资产之后，在界面右侧就可以看到这个用户有权限访问的服务器资源，点击列表右侧的连接按钮就可以连接到这台服务器，点击之后会弹出一个连接设置按钮，连接方式选择SSH，点击连接之后就可以看到成功连接到这台服务器上，在这里执行任何命令 也都是没有问题的，而且在命令面板的背景有水印，可以看到当前是哪个用户正在操作，而且也会作为审计记录被保存下来，这个等到待会我们演示审计功能的时候会再来详细介绍</p><p><strong>命令过滤</strong>：</p><p>有的时候我们不希望用户在服务器上执行一些危险的命令，比如强制删除 关机 重启这些可能导致服务器宕机的命令，这个时候就可以在访问控制下面的命令过滤这里来配置，这里上面有两个Tab页，一个是命令过滤的规则，另一个是命令组。我们先来创建一个命令组</p><p><img src="/./images/15%E5%88%86%E9%92%9F%E6%90%AD%E5%BB%BA%E5%A0%A1%E5%9E%92%E6%9C%BA/image-20251019034932228.png" alt="image-20251019034932228"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /</span><br><span class="line">shutdown</span><br><span class="line">rebaot</span><br></pre></td></tr></table></figure><p>名称比如就叫做危险命令，内容这里就把刚刚我们提到的删除 关机和重启这三个命令都添加进来，点提交这样一个命令组就创建完成了，再来创建一个命令过滤规则，名称随便起一个，比如就叫做规则1，在命令组这里选择刚刚创建的危险命令，其他都选择默认就可以，然后提交，这样这个命令过滤规则就生效了。接下来我们回到普通用户的界面，注意这里是需要重新连接之后才能生效的，比如我们现在执行一下reboot可以看到还是可以执行的，关掉重连再次输入就会提示禁止。</p><p>最后我们再来看一下审计的功能，管理员界面切换审计台，在左侧会话审计里面就可以看到所有的操作记录，会话命令里面也能够看到哪些用户执行了哪些命令，以及这些命令的风险等级，是否被拦截等等，点击对应的转到会话按钮就可以查看这条命令的详细信息，包括哪个用户 哪台服务器，在右边也可以回放这个会话，点击一下回放之后，就可以还原当时用户的操作过程，这样以后如果有人执行了一些不该执行的命令就可以当做证据</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 堡垒机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>30分钟docker</title>
      <link href="/posts/565df004.html"/>
      <url>/posts/565df004.html</url>
      
        <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Docker是一个用于 构建(build) 运行(run) 传送(share) 应用程序的平台，可以将我们的应用程序打包成一个个的集装箱，然后把它运送到任何需要的地方</p><p>有了docker，我们就可以将应用程序和它运行时所需要的各种依赖包，第三方软件库，配置文件等打包在一起，以便在任何环境中都可以正确地运行</p><p>为什么要使用Docker：</p><p>举个例子，比如我们写了一个网站用到了现在比较流行的前后端分离架构，前端使用Vue框架来构建网站的界面，后端使用Java的SpringBoot微服务框架来提供各种服务和接口，然后使用MySQL数据库来存储数据。如果没有Docker，你可能需要在本地先安装前端NodeJS环境，各种npm依赖包，Java运行时环境和SpringBoot微服务的各种第三方依赖包，MySQL数据库，配置各种环境变量，然后再启动这些服务，网站才能正常运行起来，如果项目规模再大一点，你可能还需要配置Redis缓存，Nginx负载均衡，甚至各种微服务框架等等</p><p>而有了Docker，我们就可以将它们打包成一个个的集装箱，只要你在开发环境中运行成功了，那么在其他环境中一定也是可以运行成功的</p><h1 id="Docker和虚拟机的区别"><a href="#Docker和虚拟机的区别" class="headerlink" title="Docker和虚拟机的区别"></a>Docker和虚拟机的区别</h1><p>虚拟机这是通过一种叫做虚拟化的技术来实现的，虚拟化技术是一种将物理资源虚拟为多个逻辑资源的技术，它可以将一台物理服务器虚拟成多个逻辑服务器，每个逻辑服务器都有自己的操作系统CPU 内存 硬盘和网络接口等等，它们之间是完全隔离的，可以独立运行。虚拟机在一定程度上实现了资源的整合，可以将一台服务器的计算能力，存储能力， 网络资源分配给多个逻辑服务器，实现多台服务器的功能，但是它的缺点也非常明显，每台虚拟机都需要占用大量的资源，启动速度慢，因为他们都是一个完整的系统但我们只要提供服务就行</p><p>docker和容器是两个不同的概念，其实Docker只是容器的一种实现，是一个容器化的解决方案和平台，而容器是一种虚拟化技术，和虚拟机类似也是一个独立的环境，可以在这个环境中运行应用程序。和虚拟机不同的是它并不需要在容器中运行一个完整的操作系统，而是使用宿主机的操作系统，所以启动速度非常快，通常只需要几秒钟，同时因为需要的资源更少，所以可以在一台物理服务器上运行更多的容器，这样就可以更加充分地利用服务器的资源，减少资源的闲置和浪费。比如我们一合物理服务器上可能只能运行几个虚拟机，但是却可以运行上百个容器，这就是容器和虚拟机的一些主要区别</p><h1 id="基本原理和概念"><a href="#基本原理和概念" class="headerlink" title="基本原理和概念"></a>基本原理和概念</h1><p>需要学习几个概念就是Docker中的镜像 容器和仓库。镜像是一个只读的模板，它可以用来创建容器，容器是Docker的运行实例，它提供了一个独立的可移植的环境，可以在这个环境中运行应用程序。</p><p>镜像是一个只读的模板，而容器是一个运行实例，镜像和容器的关系就像Java中的类和实例的关系一样，我们可以定义一个类中有哪些属性和方法，这个定义好的类就是一个模板，然后我们可以根据这个模板来创建多个实例，这些实例就是这个类的对象，对应到Docker中镜像就是一个模板，容器就是这个模板的一个实例，可以有一个也可以有多个。</p><p>现实中的例子：镜像就像是一个食谱，详细地描述了如何来制作一道美味的菜肴，而容器就是你根据这个食谱做出来的那道菜，你可以根据这个食谱做出很多道菜，但是这些菜都是根据同一个食谱做出来的，只要你严格按照食谱的要求来做，那么做出来的菜就是一样的。而且你也可以把这个食谱分享给其他同样喜欢美食的朋友，食谱如何分享给别人呢，这就涉及到我们刚刚提到的第三个概念仓库</p><p>Docker仓库是用来存储Docker镜像的地方，最流行和最常用的仓库就是Dockerhub，它是一个公共的Docker仓库，用来集中存储和管理Docker镜像，我们可以在这里下载各种镜像，也可以将自己的镜像上传到这里，这样就可以实现镜像的共享和复用，这也是Docker非常流行的一个重要原因</p><h1 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h1><p>下载安装包后如果是win10可以通过cmd输入改变安装位置</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Docker Desktop Installer.exe&quot; install --installation-<span class="built_in">dir</span>=&quot;D:\Docker&quot;</span><br></pre></td></tr></table></figure><p>然后启动终端在命令行输入，会看到docker的版本信息</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure><p>可以看到client和server，如果只看到client说明docker没有启动</p><p>Docker的体系结构：Docker是使用client-Server架构模式，Docker client 和 Docker Daemon 之间通过 Socket 或者 RESTfuLAPI 进行通信。Docker Daemon就是服务端的守护进程，他负责管理Docker的各种资源，Docker client负责同Docker Daemon发送请求，Docker Daemon接收到请求之后进行处理，然后将结果返回给Docker client。</p><p>这里的 Docker Daemon 是一个后台进程，用来接收并处理来自Docker客户端的请求，然后将结果返回给客户端，所以我们在终端中输入的各种Docker命令，实际上都是通过Docker客户端发送给Docker Daemon的，然后Docker Deamon再进行处理，最后再将结果返回给客户端，然后就可以在终端中看到执行结果了</p><p><img src="/./images/30%E5%88%86%E9%92%9Fdocker/image-20251016012805365.png" alt="image-20251016012805365"></p><h1 id="容器化和dockerfile"><a href="#容器化和dockerfile" class="headerlink" title="容器化和dockerfile"></a>容器化和dockerfile</h1><p>容器化顾名思义就是将应用程序打包成容器，然后在容器中运行应用程序的过程，这个过程简单来说可以分成三个步骤</p><ol><li>首先需要创建一个Dockerfile，来告诉Docker构建应用程序镜像所需要的步骤和配置</li><li>然后使用Dockerfile来构建镜像</li><li>接下来我们就可以使用这个镜像来创建和运行容器</li></ol><p>这里出现了一个新的概念Dockerfile，Dockerfile是一个文本文件，里面包含了一条条的指令，用来告诉Docker如何来构建镜像，这个镜像中包括了我们应用程序执行的所有命令，也就是我们刚刚提到的各种依赖 配置环境和运行应用程序所需要的所有内容，一般包括精简版的操作系统，应用程序的运行时环境，应用程序，比如jar包，应用程序的第三方依赖库或者包，应用程序的配置文件 环境变量等等，一般来说我们会在项目的根目录下创建一个叫Dockerfile的文件，第一个字母D大写 其他都小写，在这个文件中写入构建镜像所需要的各种指令之后，Docker就会根据这个Dockerfile文件构建镜像，有了镜像之后我们就可以使用这个镜像来创建容器，然后在容器中运行应用程序</p><h1 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h1><p>可以把这些命令写到dockerfile中，剩下的工作就可以交给docker自动完成</p><ol><li>Step1:安装操作系统</li><li>Step2: 安装JavaScript运行环境(NodejS)</li><li>Step3: 复制应用程序、依赖包、配置文件</li><li>Step4: 执行启动命令运行程序</li></ol><p>我们在项目的根目录下再创建一个叫做Dockerfile的文件，注意 这个文件的命名是Dockerfile，没有任何扩展名，第一个字母D大写其他都小写，如果没有安装docker就可以在扩展里搜docker然后安装</p><p>在这个Dockerfile我们需要先指定一个基础镜像，镜像是按层次结构来构建的，每一层都是基于上一层的，所以我们需要先指定一个基础镜像，然后在这个镜像的基础上添加我们的应用程序。</p><p>我们可以从一个最基础的Linux镜像开始，然后在这个镜像基础上安装Node]s和我们的应用程序，或者 我们也可以直接使用NodeJs的镜像，因为这个镜像已经是基于Linux来构建的了，所以直接拿来使用就可以了。node后面的14表示NodeJs的版本，这里我们使用的是14版本，再后面中杠后面的Alpine表示的是这个镜像是基于Alpine这个Linux发行版来构建的。Alpine和其他我们经常听说的RedHat CentOs 一样，都是一种Linux发行版，只不过它是一个非常轻量级的Linux发行版，体积非常小，只有几十m，所以下载和部署都非常的快。</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">14</span>-alpine</span><br></pre></td></tr></table></figure><p>配置完运行环境之后还需要把我们的应用程序复制到镜像中，可以使用COPY命令来复制文件，COPY命令后面可以加上两个参数，第一个参数表示源路径，第二个参数表示目标路径。这里的源路径是指相对于Dockerfile文件的路径，目标路径是相对于镜像的路径，那现在我们需要把index.js这个文件复制到镜像的根目录下，就可以执行 COPY index.js，后面加上根目录就可以了。</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> index.js /index.js</span></span><br></pre></td></tr></table></figure><p>然后我们需要在镜像中运行应用程序，可以使用CMD命令来运行应用程序，CMD命令后面可以加上一对方括号，方括号里面的第一个参数表示可执行程序的名字，第二个参数以后表示这个可执行程序接收到的参数，或者也可以使用第二行的格式</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;node&quot;</span>,<span class="string">&quot;/index.js&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> node /index.js</span></span><br></pre></td></tr></table></figure><p>到这里就编写完成了，保存一下</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t hello-docker .</span><br></pre></td></tr></table></figure><p>hello-docker是镜像的名字，点 是当前目录也就是Dockerfile所在的目录，然后我们来执行一下，在一些回显之后镜像构建完成。可以使用下面查看所有的镜像</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image ls</span><br></pre></td></tr></table></figure><p><img src="/./images/30%E5%88%86%E9%92%9Fdocker/image-20251016223640441.png" alt="image-20251016223640441"></p><p>这里你就会看到刚刚构建的镜像，它的名字是hello-docker，这里的latest表示的是镜像的标签，也就是镜像的版本。如果不指定版本那默认就是latest，如果想指定版本，那么就可以在镜像名字后面加上冒号和版本号，这样我们就完成了镜像的构建，使用 下面这个就可以运行</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-docker</span><br></pre></td></tr></table></figure><p>如果想在另一个系统运行这个程序，那么就只需要把这个镜像文件复制过去，然后执行一下刚刚的命令就可以了，也可以把这个镜像文件上传到DockerHub或者 Harbor 镜像仓库中，然后任何人都可以在任何地方，使用 docker pull 命令来下载这个镜像文件，然后运行这个应用程序</p><p>我们在一个网站中运行这个镜像，这个网站叫做 Play With Docker，它是一个非常好用的在线 Docker 环境，你可以在这里免费兴试使用Docker的各种功能，比如构建镜像 运行容器等等。点击一下左上角这个小扳手的设置按钮，然后选择最下面的选项，就可以进入到这个虚拟机的控制台界面了</p><p><img src="/./images/30%E5%88%86%E9%92%9Fdocker/image-20251016234349995.png" alt="image-20251016234349995"></p><p>这个屏幕没有全屏字体也有点小， 那我们再来点一下左上角的设置按钮，它提示我们可以使用Alt加上回车键，使用Command和加号键来放大字体。调整完然后在终端中输入 docker pull，后面加上DockerHub上镜像的地址,这里斜杠前面表示用户名后面表示镜像的名称</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull geekhour/hello-docker</span><br><span class="line">docker images</span><br></pre></td></tr></table></figure><p>执行完后我们再来输入 docker images来查看一下镜像列表，就可以看到我们刚刚下载的这个镜像了，然后我们使用 docker run 命令来启动一下就启动了</p><h1 id="docker-desktop使用"><a href="#docker-desktop使用" class="headerlink" title="docker desktop使用"></a>docker desktop使用</h1><p>Docker Desktop 封装了容器日常使用和管理的各种常用功能，打开控制台面板之后在左上角菜单中就会看到容器和镜像，点一下镜像按钮就可以看到我们刚刚构建的镜像了，在这里可以找到镜像的名称 标签 状态 创建时间 大小等信息，后面还有一个播放按钮，点击就可以直接使用这个镜像来运行一个容器了。在后面的三个小点表示的是更多操作，点击之后会展开一个弹出菜单，<img src="/./images/30%E5%88%86%E9%92%9Fdocker/image-20251017000422874.png" alt="image-20251017000422874"></p><p>第一项是查看这个镜像包中的详细信息，第三项和第四项就是镜像的远程仓库相关的操作，也就是从远程仓库拉取镜像，或者把这个镜像推送到远程仓库中，当然前提是你需要先点击一下右上角的头像这个位置来登录到远程仓库中</p><p>我们再来看一下容器，和镜像操作差不多，容器和镜像下面还有一个Volumes的菜单，这个是逻辑卷的意思，我们可以在这里查看容器中的逻辑卷，逻辑卷是Docker中用来存储数据的，Docker容器有一个特点就是容器中的数据是不会持久化的，当我们创建一个容器的时候，它通常以一个干净的文件系统开始，容器启动之后我们可以在容器中创建文件 修改文件，但是当容器停止之后容器中的所有数据都会丢失掉，如果我们想要持久化容器中的数据的话，逻辑卷就是用来解决这个问题的，它可以把容器中的目录或者指定路径映射到宿主机的某一个目录或者位置上，这样就可以将数据保存到宿主机的磁盘上，实现了数据的持久化</p><p>再往下面是一个Beta版的测试功能，是用来管理开发环境的，可以在这里创建一个开发环境，然后使用一些代码来配置这个开发环境，这样就可以把这个开发环境共享给项目中的其他开发人员，让每个人都在一个相同的环境下进行开发，避免因为环境的不一致导致的各种问题</p><p><img src="/./images/30%E5%88%86%E9%92%9Fdocker/image-20251017002424657.png" alt="image-20251017002424657"></p><p>下面一个菜单是官方提供的学习中心</p><p>最后还提供了一个添加扩展的功能，可以在这里安装一些扩展来增强它的功能</p><h1 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker compose"></a>docker compose</h1><p>Docker Compose 是由Docker官方开源的项目，是一个用来定义和运行多个Docker容器应用程序的工具，比如如果想要搭建一个网站的话，可能会使用到前端 后端 数据库，甚至缓存 负载均衡等多个服务器，这些服务都是独立的，但是它们之间又是有关联的，需要相互配合来工作，这些服务之间的关联关系，就是Docker compose要解决的问题，它通过一个单独的docker-compose.yaml的配置文件，来将这一组互相关联的容器组合在一起形成一个项目，然后使用一条命令就可以启动 停止或者重建这些服务，这样就可以非常方便的管理这些服务了</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker compose up</span><br></pre></td></tr></table></figure><p>举例：如果你的项目组中来了一个新同事，之前他可能需要半天时间去安装各种依赖和配置运行环境，现在有了Docker Compose之后只需要执行一下docker compose up 命令，就可以自动安装各种依赖和配置运行环境然后运行。</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cursor使用指南</title>
      <link href="/posts/1f08e59c.html"/>
      <url>/posts/1f08e59c.html</url>
      
        <content type="html"><![CDATA[<h3 id="汉化"><a href="#汉化" class="headerlink" title="汉化"></a><strong>汉化</strong></h3><p>下载后点击<img src="/./images/cursor%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/image-20251011183728706.png" alt="image-20251011183728706"> 这个按钮然后搜Chinese下载安装汉化就可以</p><h3 id="对话"><a href="#对话" class="headerlink" title="对话"></a><strong>对话</strong></h3><p>你可以直接选中一部分代码，然后Command+L(Ctrl+L)或者Command+l(Ctrl+l)来唤醒 Chat 或者是 Composer进行针对选区代码块的问答</p><p>也可以在某行使用ctrl+k内嵌一个对话框进行问答</p><p>点击设置选models，里面就是大模型，然后在这里&lt;img src&#x3D;”.&#x2F;images&#x2F;cursor使用指南&#x2F;image-20251011185229463.png”  可以切换模型，但注意有些是限量使用的，然后ask是稍微快的，agent可以自动提取相关上下文，运行终端命令等高级操作，执行复杂功能，其他的用ask</p><p>cursor是基于项目的，打开哪个文件夹就会被认为一个项目然后自动采集项目内的代码，在聊天对话框里用@就可以唤起一个功能菜单，比如引用文件就可以@Files，也可以在资源管理器中拖拽文件到对话框里。用@code也可以选中一块代码到对话框</p><p>cursor支持三方文档，可以将一些接口文档连接、需求文档链接录入到docs，这样在问答时选中文档然后让ai帮忙生成东西，点击设置找到indexing&amp;docs就可以添加文档。</p><p>添加文档时的连接如果最后没有&#x2F;那么默认索引当前这一个页面，如果最后再加个&#x2F;就会把这个页面下所有的子页面和子目录都索引</p><p>如果直接@链接，显示一个add link就会作为一个文本去响应</p><p>@web可以自动查询网络上的信息</p><p>@git选择历史提交，可以将某一次提交添加到输入框中作为上下文</p><p>@notepad记事本，可以临时记录一些信息，这些信息可以提供给ai，因为不同对话的上下文是不互通的</p><p>@codebase会采集我们代码中重要的文件或代码块</p><p>每次打开新项目的时候，点击设置-indexing&amp;docs点击codebase indexing的retry可以重新采集项目数据，Cursor 在索引前会检查你的项目根目录，如果你的根目录中有.gitignore 文件，那 .gitignore 文件中声明的文件或者是目录都不会被索引。或者是你想尽可能的缩小一些索引的范围，你可以在项目根目录创建一个.cursorignore 文件来声明一些所引要忽略的文件或者是目录</p><h3 id="技巧思路"><a href="#技巧思路" class="headerlink" title="技巧思路"></a>技巧思路</h3><p>预防检测回滚</p><p>检测：它会让我们自己判断是否应用生成的代码，有个save all可以先保存所有修改，然后运行去查看效果，如果符合要求再点击accept all，否则reject all</p><p>回滚：翻找历史对话有个checkpoint标记，点击restore就可以回滚</p><p>预防：ai改代码改的乱七八糟是因为误解了我们的语言，所以可以通过让ai复述一遍需求再进行答复，可以迅速确认ai是否精准理解我们的需求。第二点明确需求辐射范围，在发出一个需求指令之前一定要尽可能的让这个需求指令足够小，足够单一化，不要让 AI猜你要做什么，要有足够的针对性，并且要明确这次指令的范围，最大程度上缩小这个指令的辐射范围</p><p>如果是一个相对复杂的项目，在和 Chat 沟通完需求之后你可以把需求做拆解，比如拆解成一个个功能 Feature，把这些 Feature 通过 Notepad 单独记录下来，然后按照需求步骤，在 Composer 输入框中选择对应的 Notepad 去完成需求，如果有问题就新建Notepad 记录，然后新建对话框选择这个Notepad 去询问，得到方案之后再更新 Notepad，最后回到 Composer 中选中对应的 Notepad 去做生成</p><p>如果是现有项目，你想使用 Cursor 辅助开发这个项目的后续需求，包括改一些 BUG 等等，那在 Cursor 打开项目之后，第一你应该先让 Cursor Al检索整个项目帮你去生成一个.cursorignore 的文件，然后在.cursorignore 文件中编辑一下添加上你想要索引忽略掉的文件，做好后点设置codebase indexing点resync index重新索引，第二把项目相关的在线文档全部录入到 Docs 里以作备用，第三你应该在项目根目录中新建一个.cursorrules 文件并设置项目规则，可以让ai检索文档然后生成这个文件，但是要记得备份这个文档，因为不一定在项目的文件里</p><p>另外随便改个文档，可以<img src="/./images/cursor%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/image-20251011205351044.png" alt="image-20251011205351044"> 暂存这个更改，如果项目中使用了git，那你修改代码并暂存之后就不需要自己费劲的去写 Commit 信息了，Cursor 可以为 Git 暂存的文件一键生成更有意义的提交信息，CursorAI会分析你当前的更改和以前提交的信息生成符合上下文的 commit message，它会从你的历史提交记录中去学习</p><h3 id="白嫖"><a href="#白嫖" class="headerlink" title="白嫖"></a>白嫖</h3><p>使用临时邮箱网站，注册完然后接收到验证码后就可以关闭了，也可以使用无限邮箱，比如<a href="mailto:&#x6c;&#x69;&#117;&#113;&#105;&#x40;&#x31;&#50;&#51;&#x2e;&#x63;&#111;&#x6d;">liuqi@123.com</a>，子邮箱就是<a href="mailto:&#x6c;&#105;&#x75;&#113;&#x69;&#48;&#x31;&#64;&#x31;&#x32;&#x33;&#46;&#x63;&#x6f;&#x6d;">liuqi01@123.com</a></p>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
            <tag> 工具 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一小时快速上手Redis</title>
      <link href="/posts/5f7c9bb5.html"/>
      <url>/posts/5f7c9bb5.html</url>
      
        <content type="html"><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>redis是一个开源的基于内存的数据存储系统，用作数据库缓存和消息队列等场景，也是热门noSql数据库之一</p><p>传统数据库面对高并发场景，硬盘io是缓慢的，而内存相比就快很多所以有了这个</p><p>Redis的优势：</p><ol><li>性能极高</li><li>数据类型丰富，单键值对最大支持512M大小的数据</li><li>简单易用，支持所有主流编程语言</li><li>支持数据持久化、主从复制、哨兵模式等高可用特性</li></ol><p>下载通过<a href="https://github.com/redis-windows/redis-windows">https://github.com/redis-windows/redis-windows</a></p><p>然后点<img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8Bredis/image-20250612185303511.png" alt="image-20250612185303511"></p><p>安装<img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8Bredis/image-20250612185320223.png" alt="image-20250612185320223"></p><p>然后运行install_redis_service.bat，选择需要安装的目录，可以继承默认路径，redis-cli.exe是客户端，启动后输入info可以查看信息，uninstall_redis_service.bat是卸载程序</p><p>用命令提示符启动是redis-server.exe，停止方法是ctrl+c，启动客户端是redis-cli</p><p>然后用<a href="https://redis.io/downloads/#:~:text=Redis-,Insight,-Download%20a%20powerful%E4%B8%8B%E8%BD%BDredisinsight">https://redis.io/downloads/#:~:text=Redis-,Insight,-Download%20a%20powerful下载redisinsight</a></p><p>一路next，打开后添加本地的地址和端口号，</p><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><p>redis中的数据是以键值对的形式存储的，redis中的键是区分大小写的，默认使用字符串存储数据，是二进制安全的</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span>设置 get获取 <span class="built_in">del</span>删除 exists判断键是否存在</span><br><span class="line">keys *查找所有键 keys *me查找所有以me结尾的键</span><br><span class="line">flushall删除所有键</span><br></pre></td></tr></table></figure><p>redis默认不支持中文，如果把键的值设置成中文，会看到把中文换成了二进制形式，\x是16进制，如果要显示中文，可以先quit退出，登录的时候再加上–raw就可以了<br><img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8Bredis/image-20251006023421818-1759689262511-1.png" alt="image-20251006023421818"></p><p>TTL是Time To Live的缩写</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TTL name查看name的过期时间，返回<span class="literal">-1</span>表示没有设置过期时间</span><br><span class="line">EXPIRE name <span class="number">10</span>设置十秒过期</span><br><span class="line">SETEX设置一个带有过期时间的键值对，比如SETEX name <span class="number">5</span> 啊啊啊</span><br><span class="line">SETNX只有当键不存在时才设置键的值，如果存在则不做动作。比如SETNX name</span><br></pre></td></tr></table></figure><h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><p>用LPUSH或者RPUSH命令来将元素添加到列表的头部或尾部，这里添加是类似栈的形式，往头部添加，用RPUSH就是从尾部添加了，应该是双向链表</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">LPUSH letter a在头部添加a元素，letter是列表名</span><br><span class="line">LRANG letter <span class="number">0</span> <span class="literal">-1</span>获取列表内容，<span class="number">0</span>是起始位置，<span class="literal">-1</span>是最后一个元素</span><br><span class="line">RPOP letter删除最后一个元素</span><br><span class="line">LPOP letter <span class="number">2</span>删除前两个元素</span><br><span class="line">LLEN letter查看列表的长度</span><br><span class="line">用RPOPLPUSH可以实现最后一个元素删除，添加一个新元素，也就是先进先出</span><br><span class="line">LTRIM letter删除列表中指定范围以外的元素，TRIM是修剪的意思，比如</span><br><span class="line">LTRIM letter <span class="number">1</span> <span class="number">3</span>也就是只保留<span class="number">1</span>到<span class="number">3</span>之间的元素</span><br></pre></td></tr></table></figure><h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><p>set是无序集合，list列表元素可以重复set不可以重复，指令大多以S开头，如果再次添加已有元素会显示失败</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SADD course redis 添加一个元素叫redis。course是集合的名称</span><br><span class="line">SMEMBERS course查看集合中的元素，输出的是redis</span><br><span class="line">SADD course redis再次添加会返回0，也就是添加失败了，因为set是不可重复集合</span><br><span class="line">SISMEMBER course redis判断redis是否在集合中，返回的是1，没有就是0</span><br><span class="line">SREM course redis删除一个元素，返回1代表成功</span><br></pre></td></tr></table></figure><h2 id="有序集合SortedSet"><a href="#有序集合SortedSet" class="headerlink" title="有序集合SortedSet"></a>有序集合SortedSet</h2><p>有序集合的每个元素都会关联一个浮点类型的分数，按照这个分数来对集合中的元素进行从小到大的排序</p><p>有序集合的成员是唯一的，分数是可以重复的</p><p>有序集合的相关命令以Z开头，后面是集合的名字，然后是分数和成员名</p><p><img src="./images/一小时快速上手redis/image-20251009155727241.png">      XREADGROUP GROUP读取组消息 组名称 消费者名称 一次读两条消息 没有消息就堵塞3秒 消息名 右箭头是从这个消息中读取最新的消息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 地理空间Geospatial</span><br><span class="line"></span><br><span class="line">地理位置指令都以GEO开头</span><br><span class="line"></span><br><span class="line">~~~shell</span><br><span class="line">GEOADD city 116.405285 39.904989 beijing 添加地理信息 city是key表示地理位置信息名字 后面是经纬度和城市名，也可以同时添加多个</span><br><span class="line">GEOADD city 116.405285 39.904989 beijing 405285 39.904989 shanghai</span><br><span class="line">GEOPOS city beijing获取北京的经纬度，返回结果第一个是经度第二个是维度</span><br><span class="line">GEODIST city beijing shanghai计算北京到上海的距离，返回的是直线距离，默认单位是米，如果想换成千米就在shanhai后面加上 空格 KM</span><br><span class="line"></span><br><span class="line">搜索指定范围内的成员并返回，可以以成员的位置或一个指定的经纬度为中心，按照圆形或者矩形的范围来搜索</span><br><span class="line">GEOSEARCH city FROMMEMBER shanghai BYRADIUS 300 KM 搜索上海300km以内的城市，BYRADIUS是一个圆形的范围，300km是半径，BYBOX是矩形</span><br></pre></td></tr></table></figure><h2 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h2><p>这是一种用来做基数统计的算法，如果集合中每个元素都是唯一且不重复的，那么这个集合的基数就是集合中元素的个数，比如1122334455，基数就是5,原理是用随机算法计算，优点占用内存小，缺点会有误差。命令都以PF开头</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PFADD course git docker redis 添加一个叫课程的元素</span><br><span class="line">PFCOUNT course 查看基数 返回3</span><br><span class="line"></span><br><span class="line">新增一个课程，然后合并</span><br><span class="line">PFMEAGE result course course2 把course course2合并到result里</span><br></pre></td></tr></table></figure><h2 id="位图Bitmap"><a href="#位图Bitmap" class="headerlink" title="位图Bitmap"></a>位图Bitmap</h2><p>位图是字符串的扩展，可以使用一个String来模拟一个bit数组，数组的下标就是偏移量，值只有0和1，也支持一些位运算，比如与或非，异或等，命令以SET开头</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SETBIT dianzan 0 1     SETBIT设置某个偏移量的值，dianzan是键的名字，把偏移量0的位置上设置为1</span><br><span class="line">SETBIT dianzan 0 1 再把偏移量为1的地方设置为0</span><br><span class="line">GETBIT dianzan 0 获取偏移量的值</span><br><span class="line"></span><br><span class="line">重新设置点赞的值，让它前四位都为1，后面四位都为0，我们可以使用16进制来表示一个二进制的数，这里的\xF0表示11110000，可以一次性设置8个</span><br><span class="line">SET dianzan &quot;\xF0&quot;</span><br><span class="line"></span><br><span class="line">BITCOUNT dianzan统计某一个key的值里面有多少个bit是1，这里返回的是4</span><br><span class="line">BITPOS dianzan 0可以获取某个key里面第一个出现的0或者1的位置，返回的是4，后面还可以添加开始和结束这个范围</span><br></pre></td></tr></table></figure><h2 id="位域Bitfield"><a href="#位域Bitfield" class="headerlink" title="位域Bitfield"></a>位域Bitfield</h2><p>位域能将很多小的整数存储到一个较大的位图中，这样可以较高效的使用内存</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">这里设置一个游戏角色</span><br><span class="line">BITFIELD player:1 set u8 #0 1  player:1这个key表示id，u8表示等级，意思是一个8位无符号整数，#0表示第一个位置,等级为1</span><br><span class="line">GET player:1 返回\x01表示等级为1</span><br><span class="line">BITFIELD player:1 get u8 #0   这里把set换成get就可以返回等级1了，而不是16进制</span><br><span class="line">BITFIELD player:1 incrby u8 #0 10 增加了十级，返回11 </span><br></pre></td></tr></table></figure><h2 id="Redis事务"><a href="#Redis事务" class="headerlink" title="Redis事务"></a>Redis事务</h2><p>主要是通过MULTI和EXEC这两个实现，一个是开启事务一个是执行</p><p>在关系型数据库中事务一般是一个原子操作，要么全部执行成功，要么全部执行失败</p><p>而在redis中事务并不能保证所有的命令都会执行成功，但是redis可以保证三点：</p><ol><li>在发送exec命令之前，所有的命令都会被放入到一个队列中缓存起来，不会立即执行</li><li>在收到exec命令之后，事务开始执行，事务中任何一个命令执行失败，其他命令依然会被执行，就是说不会因为某一个命令执行失败而导致其他命令不会被执行的情况发生</li><li>在事务执行的过程中，其他客户端提交的命令请求并不会被插入到事务的执行命令序列中</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MULTI 回车后返回ok，进入到事务模式（TX）</span><br><span class="line">SET k1 v1  返回QUEUED表示放在队列中</span><br><span class="line">SET k2 v2</span><br><span class="line">EXEC执行</span><br></pre></td></tr></table></figure><h2 id="Redis持久化"><a href="#Redis持久化" class="headerlink" title="Redis持久化"></a>Redis持久化</h2><p>如果没有持久化，之前所有的数据都会丢失</p><p>redis有两种方式</p><p>1：RDB(Redis Database)，是指在指定时间间隔内将内存中的数据快照写入磁盘，它是某一个时间点上数据的完整副本，可以通过配置文件中的save参数来配置，指令是vi redis.conf</p><p><img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8Bredis/image-20251011013924855.png" alt="image-20251011013924855"></p><p>后面的参数是时间和修改次数的组合，第一个参数是秒数，第二个是修改次数，</p><p><img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8Bredis/image-20251011014036278.png" alt="image-20251011014036278"></p><p>第一行就表示3600秒也就是一个小时之内只要有一次修改就进行一次快照，第二行就表示300秒内有100次修改的话才进行一次快照，第三条表示60秒内有1万次修改的话才进行一次快照，也可以通过save命令手动触发快照。</p><p><img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8Bredis/image-20251011014532405.png" alt="image-20251011014532405"></p><p>快照文件的缺点是如果服务器在快照之后宕机了，那么最后一次快照之后的所有修改内容都会丢失掉，所以 RDB更适合用来做备份，比如我们可以在每天凌晨的时候通过crontab来执行一次save命令，然后将快照文件备份到其他地方，这样就可以保证数据的安全了</p><p>还有一个问题就是由于生产环境中我们为Redis开辟的内存区域一般都比较大，那么内存中的数据同步到硬盘这个过程就会持续比较长的时间，这段时间内Redis都是处于一个阻塞的状态，不能接受任何请求，于是Redis又提供了一个叫做bgsave的命令，这个命令会单独创建一个子进程来负责将内存中的数据写入到硬盘中，这样的话主进程就可以继续处理请求了，但是这个过程中还会有一定的性能损耗，因为fork一个子进程也是需要时间的，这段时间内Redis还是不能处理任何请求，做不到秒级快照，为了解决问题Redis又提供了另一种叫做AOF的持久化方式</p><p>2：AOF(Append only File)，指追加文件，它的原理是在执行写命令的时候，不仅会将命令写入到内存中，还会将命令写入到一个追加的文件中，这个追加的文件就是aof，它会以日志的形式来记录每一个写操作，当Redis重启的时候就会通过重新执行AOF文件中的命令来在内存中重建整个数据库的内容</p><p>开启方式：配置文件中<img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8Bredis/image-20251011015257555.png" alt="image-20251011015257555"> no改成yes</p><h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><p>是指将一台Redis服务器的数据复制到其他Redis服务器，也叫主节点和从节点</p><p>一个主节点可以有多个从节点，而每个从节点只能有一个主节点，数据的复制是单向的，只能由主节点到从节点，主节点负责写操作，从节点负责读操作。</p><p>主节点会将自己的数据变化通过异步的方式发送给从节点，从节点接收到主节点的数据之后更新自己的数据，这样就达到了数据一致的目的</p><p><strong>配置</strong>：主节点不需要修改任何配置因为默认的配置就是主节点，只需要修改从节点的配置就可以了</p><ol><li><p>通过命令行执行命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof直接指定主节点的IP和端口（旧版，不常用）</span><br></pre></td></tr></table></figure></li><li><p>通过配置文件修改</p><p>redis配置文件是redis.conf，一般在安装目录里</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/homebrew/etc</span><br><span class="line">ls -ltr</span><br><span class="line">找到redis.conf，用cp redis.conf ~复制到根目录一份</span><br><span class="line">cd回到根目录再复制一个6380文件</span><br><span class="line">cp redis.conf redis-6380.conf，把这个作为从节点配置文件，6380就是待会要使用的从节点端口号，用vscode打开这个配置文件</span><br><span class="line">找到port 6379改为6380</span><br><span class="line">找到pidfile /var/run/redis_6379.pid也改6380，pid也就是进程id，redis是以守护进程的方式运行，系统默认会把pid写入到这个文件里面，因为这里我们要启动多个Redis服务，所以要把两个Redis的pid文件区分开</span><br><span class="line">再找到一个dbfilename这个配置项</span><br><span class="line">dbfilename dump-6380.rdb这个就是之前我们说的持久化文件了，当我们执行save或者bgsave命令的时候，就会把内存中的数据保存到这个文件里面。为了区分开主节点和从节点的数据我们也要把这个文件名加上端口号</span><br><span class="line">最后再找到-个replicaof这个配置项，它是用来指定主节点的，默认是注释掉的，我们把它复制一行加到下面，IP地址改成127.0.0.1，端口号改成6379，表示我们现在配置的这个节点是6379这个库的从节点</span><br><span class="line">然后保存</span><br></pre></td></tr></table></figure><p>启动一个客户端，执行第一行，再启动一个执行第二行连接这个从节点</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis-6380.conf</span><br><span class="line">redis-cli -p 6380</span><br><span class="line">info replication查看信息，可以看到从节点角色是slave，port端口号是6379，这样就成功了</span><br></pre></td></tr></table></figure><p>如果主节点有密码，从节点要设置masterauth</p><p>从节点也可以配置多个，把刚刚的6380复制出来变成6381</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp redis-6380.conf redis-6381.conf</span><br><span class="line">vi redis-6381.conf使用vi编辑器将6380整体替换6381</span><br><span class="line">:1,$s/6380/6381/g回车会提示替换了四个位置</span><br><span class="line">:wq保存退出</span><br></pre></td></tr></table></figure></li></ol><h2 id="哨兵模式Sentinel"><a href="#哨兵模式Sentinel" class="headerlink" title="哨兵模式Sentinel"></a>哨兵模式Sentinel</h2><p>如果主节点宕机就需要人工干预把从节点变成主节点，这样就不能实现真正的高可用</p><p>哨兵会以一个独立的进程运行在Redis集群中，用来监控Redis集群中的各个节点中是否运行正常。功能如下：</p><ol><li>监控：通过不断地发送命令来检查Redis节点是否正常</li><li>通知：如果发现某个节点出了问题，那么哨兵就会通过发布订阅模式来通知其他节点</li><li>自动故障转移：当主节点不能正常工作的时候，哨兵会开始一个自动故障转移的操作，它会将一个从节点升级为新的主节点，然后再将其他从节点指向新的主节点</li></ol><p>配置：首先需要在Redis集群中添加一个哨兵节点</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">启动哨兵节点，需要添加配置文件sentinel.conf</span><br><span class="line">vi sentinel.conf使用vim新建一个sentinel.conf文件</span><br><span class="line">然后在文件添加配置</span><br><span class="line">sentinel monitor master 127.0.0.1 6379 1    master就是要监控的主节点的名称，可以自己定义，后面加上主节点的IP地址和端口号，最后一个参数1表示只需要一个哨兵节点同意就可以进行故障转移了</span><br><span class="line">:wq</span><br><span class="line">redis -sentinel启动哨兵节点</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>哨兵本身也是一个进程，它自己也会有单节点故障的问题，所以一般在实际的生产环境会使用三个哨兵节点来保证高可用，这三个哨兵节点会通过选举的方式来选出一个领导者，然后由领导者来监控其他节点，如果领导者挂了那么其他哨兵节点会重新选举出一个领导者，这样就可以保证哨兵的高可用了</p><h2 id="Cluster"><a href="#Cluster" class="headerlink" title="Cluster"></a>Cluster</h2><p>Cluster是Redis提供的分布式数据库解决方案<br>自动将你的数据切分给多个节点存储，然后让节点去认领<br>即使这些节点中一部分宕机，也可以继续执行数据操作</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 中间件 </tag>
            
            <tag> Redis </tag>
            
            <tag> 数据库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot 3</title>
      <link href="/posts/d6ebbbdf.html"/>
      <url>/posts/d6ebbbdf.html</url>
      
        <content type="html"><![CDATA[<h1 id="第1章-First-Spring-Boot"><a href="#第1章-First-Spring-Boot" class="headerlink" title="第1章 First Spring Boot"></a>第1章 First Spring Boot</h1><h2 id="认识Spring-Boot"><a href="#认识Spring-Boot" class="headerlink" title="认识Spring Boot"></a>认识Spring Boot</h2><p>我们来看看官方是如何介绍的：</p><p><a href="https://docs.spring.io/spring-boot/index.html">https://docs.spring.io/spring-boot/index.html</a></p><p>![image-20250413160742206](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250413160742206.png)</p><p>![image-20250413160744834](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250413160744834.png)</p><p>Spring Boot倡导<code>约定优于配置</code>，将<code>简化开发</code>发挥到极致。使用Spring Boot框架可以快速构建Spring应用，再也不需要<code>大量的繁琐的</code>的各种配置。Spring Boot框架设计的目标是：程序员关注业务逻辑就行了，环境方面的事儿交给Spring Boot就行。</p><p>Spring Boot特性：</p><ol><li>快速创建独立的Spring应用程序。（Spring支持的SpringBoot都支持，也就是说SpringBoot全方位支持IoC，AOP等）</li><li>嵌入式的Tomcat、Jetty、Undertow容器。（web服务器本身就是几个jar包，Spring Boot框架自动嵌入了。）</li><li>需要什么功能时只需要引入对应的starter启动器即可。（启动器可以自动管理这个功能相关的依赖，自动管理依赖版本的控制）</li><li>尽最大努力，最大可能的自动配置Spring应用和第三方库。（例如：如果要进行事务的控制，不用做任何事务相关的配置，只需要在service类上添加@Transactional注解即可。）</li><li>没有代码生成，没有XML配置。（Spring Boot的应用程序在启动后不会动态地创建新的Java类，所有逻辑都是在编译期就已经确定好的）</li><li>提供了生产监控的支持，例如健康检查，度量信息，跟踪信息，审计信息等。也支持集成外部监控系统。</li></ol><p>Spring Boot的开箱即用和约定优于配置：</p><ul><li>开箱即用：Spring Boot框架设计得非常便捷，开发者能够在几乎不需要任何复杂的配置的情况下，快速搭建并运行一个功能完备的Spring应用。</li><li>约定优于配置：“约定优于配置”（Convention Over Configuration, CoC）是一种软件设计哲学，核心思想是通过提供一组合理的默认行为来减少配置的数量，从而简化开发流程。例如：Spring Boot默认约定了使用某个事务管理器，在事务方面不需要做任何配置，只需要在对应代码的位置上使用<code>@Transactional</code>注解即可。</li></ul><h2 id="知识储备"><a href="#知识储备" class="headerlink" title="知识储备"></a>知识储备</h2><p>学习本套课程的前提是你已经学过了：</p><ul><li>MyBatis</li><li>Spring</li><li>SpringMVC</li></ul><h2 id="主要版本说明"><a href="#主要版本说明" class="headerlink" title="主要版本说明"></a>主要版本说明</h2><p>Spring Boot版本：3.3.5</p><p>IDEA版本：2024.2.4</p><p>JDK版本：21（Spring Boot3要求JDK的最低版本是JDK17）</p><h2 id="First-Spring-Boot"><a href="#First-Spring-Boot" class="headerlink" title="First Spring Boot"></a>First Spring Boot</h2><p>需求：在浏览器上输入请求路径 <a href="http://localhost:8080/hello%EF%BC%8C%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8A%E6%98%BE%E7%A4%BA">http://localhost:8080/hello，在浏览器上显示</a> HelloWorld!</p><p>使用**<font style="color:#DF2A3F;">Spring Boot3 开发web应用</font>**，实现步骤如下：</p><h3 id="第一步：创建一个空的工程，并设置JDK版本21（Spring-Boot-3要求JDK最低版本是17）"><a href="#第一步：创建一个空的工程，并设置JDK版本21（Spring-Boot-3要求JDK最低版本是17）" class="headerlink" title="第一步：创建一个空的工程，并设置JDK版本21（Spring Boot 3要求JDK最低版本是17）"></a>第一步：创建一个空的工程，并设置JDK版本21（Spring Boot 3要求JDK最低版本是17）</h3><p>![image-20250413163139334](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250413163139334.png)</p><p>设置jdk21</p><p>![image-20250413163147002](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250413163147002.png)</p><h3 id="第二步：设置maven"><a href="#第二步：设置maven" class="headerlink" title="第二步：设置maven"></a>第二步：设置maven</h3><p>![image-20250414180440476](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414180440476.png)</p><h3 id="第三步：创建一个Maven模块-sb3-01-first-web"><a href="#第三步：创建一个Maven模块-sb3-01-first-web" class="headerlink" title="第三步：创建一个Maven模块 sb3-01-first-web"></a>第三步：创建一个Maven模块 sb3-01-first-web</h3><p>![image-20250414180717296](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414180717296.png)</p><h3 id="第四步：打开Spring-Boot-3官方文档，按照文档一步一步进行"><a href="#第四步：打开Spring-Boot-3官方文档，按照文档一步一步进行" class="headerlink" title="第四步：打开Spring Boot 3官方文档，按照文档一步一步进行"></a>第四步：打开Spring Boot 3官方文档，按照文档一步一步进行</h3><p>![image-20250414180926480](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414180926480.png)</p><p>![image-20250414180931149](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414180931149.png)</p><h3 id="第五步：要使用Spring-Boot-3，需要继承这个开源项目。从官方指导文档中复制以下内容："><a href="#第五步：要使用Spring-Boot-3，需要继承这个开源项目。从官方指导文档中复制以下内容：" class="headerlink" title="第五步：要使用Spring Boot 3，需要继承这个开源项目。从官方指导文档中复制以下内容："></a>第五步：要使用Spring Boot 3，需要继承这个开源项目。从官方指导文档中复制以下内容：</h3><p>![image-20250414180949569](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414180949569.png)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--继承Spring Boot 3.3.3开源项目--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--使用SpringBoot框架，首先要继承SpringBoot这个父工程。--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这里为什么不是直接引入springboot依赖，而是继承SpringBoot父工程的方式??????--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><p>我们开发的每一个项目其实可以看做是 Spring Boot 项目下的子项目。</p><h3 id="第六步：添加Spring-Boot的web-starter"><a href="#第六步：添加Spring-Boot的web-starter" class="headerlink" title="第六步：添加Spring Boot的web starter"></a>第六步：添加Spring Boot的web starter</h3><p>![image-20250414181710087](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414181710087.png)</p><p>这个也就是web启动器，在parent下立即添加如下配置，让Spring Boot项目具备开发web应用的依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!--依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--引入web启动器，这样的话自动会将web开发相关的所有依赖全部引入，例如：json、tomcat、springmvc等，包括这些依赖的版本也不需要我们管理，自动管理。这里的版本号也在父工程管理好了--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>关联的依赖也被引入进来，如下：</p><p>![image-20250414182237867](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414182237867.png) </p><p>可以看到spring mvc被引入了，tomcat服务器也被引入了。</p><h3 id="第七步：编写Spring-Boot主入口程序"><a href="#第七步：编写Spring-Boot主入口程序" class="headerlink" title="第七步：编写Spring Boot主入口程序"></a>第七步：编写Spring Boot主入口程序</h3><p>新建下面这个</p><p>![image-20250414182626673](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414182626673.png)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.springboot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 所有的springboot应用的主入口程序必须使用 @SpringBootApplication 注解进行标注。</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 主入口，运行main方法就是启动服务器</span></span><br><span class="line">        <span class="comment">//需要两个参数，一个是主入口类，一个是主入口里面的这个参数比如args</span></span><br><span class="line">        SpringApplication.run(MyApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="第八步：编写controller"><a href="#第八步：编写controller" class="headerlink" title="第八步：编写controller"></a>第八步：编写controller</h3><p>必须要放在主入口程序同级目录下或者子目录里</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提醒：这个HelloController要想被spring容器管理，这个类所在的位置必须满足：和SpringBoot主入口程序在同级目录下，或者子目录下。</span></span><br><span class="line"><span class="comment">//@Controller</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送一个get请求，后面是请求路径，然后返回字符串到浏览器上，就要加一个@ResponseBody</span></span><br><span class="line">    <span class="comment">// 也可以不加，就需要把Controller换成RestController，既起到了Controller作用又给这个Controller所有的方法都加上ResponseBody注解</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="comment">//@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, SpringBoot3!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="第九步：运行main方法就是启动web容器"><a href="#第九步：运行main方法就是启动web容器" class="headerlink" title="第九步：运行main方法就是启动web容器"></a>第九步：运行main方法就是启动web容器</h3><p>![image-20250414184053516](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414184053516.png)</p><h3 id="第十步：打开浏览器访问"><a href="#第十步：打开浏览器访问" class="headerlink" title="第十步：打开浏览器访问"></a>第十步：打开浏览器访问</h3><p>![image-20250414184101339](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414184101339.png)</p><h2 id="便捷的部署方式"><a href="#便捷的部署方式" class="headerlink" title="便捷的部署方式"></a>便捷的部署方式</h2><h3 id="打jar包运行"><a href="#打jar包运行" class="headerlink" title="打jar包运行"></a>打jar包运行</h3><p>Spring Boot提供了打包插件，可以将Spring Boot项目打包为**<font style="color:#DF2A3F;">可执行 jar 包</font>**。Web服务器（Tomcat）也会连同一块打入jar包中。只要电脑上安装了Java的运行环境（JDK），就可以启动Spring Boot项目。但注意不要去占用8080端口</p><p>![image-20250414184720123](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414184720123.png)</p><p>根据官方文档指导，使用打包功能需要引入以下的插件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--这是一个能够创建可执行jar包的springboot插件。--&gt;</span><br><span class="line">&lt;build&gt;</span><br><span class="line">&lt;plugins&gt;</span><br><span class="line">&lt;plugin&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br><span class="line">&lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure><p>执行打包命令，生成可执行jar包：</p><p>![image-20250414185231753](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414185231753.png)</p><p>![image-20250414185235074](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414185235074.png)</p><p>![image-20250414185239632](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414185239632.png)</p><p>单独的将这个 jar 包可以拷贝到任何位置运行，通过<code>java -jar sb3-01-first-web-1.0-SNAPSHOT.jar</code>命令来启动 Spring Boot 项目：</p><p>![image-20250414185249149](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414185249149.png)</p><p>另外，Spring Boot框架为我们提供了非常灵活的配置，在可执行jar包的同级目录下新建配置文件：application.properties，并配置以下信息：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8888</span></span><br></pre></td></tr></table></figure><p>重新启动服务器，然后使用新的端口号访问：</p><p>![image-20250414185311030](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414185311030.png)</p><h3 id="SpringBoot的jar包和普通jar包的区别（面试题）"><a href="#SpringBoot的jar包和普通jar包的区别（面试题）" class="headerlink" title="SpringBoot的jar包和普通jar包的区别（面试题）"></a>SpringBoot的jar包和普通jar包的区别（面试题）</h3><p>Spring Boot 打包成的 JAR 文件与传统的 Java 应用程序中的 JAR 文件相比确实有一些显著的区别，主要体现在<code>依赖管理</code>和<code>可执行性</code>上。</p><p><strong>依赖管理</strong>：</p><ul><li>Spring Boot 的 JAR 包通常包含了应用程序运行所需的所有依赖项，也就是说它是一个“fat jar”（胖 JAR 包），这种打包方式使得应用可以独立运行，而不需要外部的类路径或应用服务器上的其他依赖。</li><li>普通的 JAR 文件一般只包含一个类库的功能，并且需要依赖于特定的类路径来找到其他的类库或者框架，这些依赖项通常在部署环境中已经存在，比如在一个应用服务器中。</li></ul><p><strong>可执行性</strong>：</p><ul><li>Spring Boot 的 JAR 文件可以通过直接执行这个 JAR 文件来启动应用程序，也就是说它是一个可执行的 JAR 文件。通过 <code>java -jar your-application.jar</code> 命令就可以直接运行应用程序。</li><li>而普通的 JAR 文件通常是不可直接执行的，需要通过指定主类（main class）的方式或者其他方式来启动一个应用程序，例如使用 <code>-cp</code> 或 <code>-classpath</code> 加上类路径以及主类名来执行。</li></ul><p>Spring Boot 的这些特性使得部署和运行变得更加简单和方便，特别是在微服务架构中，每个服务都可以被打包成独立的 JAR 文件并部署到任何支持 Java 的地方。</p><p>SpringBoot的可执行jar包目录结构：</p><p>![image-20250414194631521](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414194631521.png)</p><p>普通jar包的目录结构：![image-20250414194638757](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414194638757.png) </p><h2 id="Spring-Boot脚手架"><a href="#Spring-Boot脚手架" class="headerlink" title="Spring Boot脚手架"></a>Spring Boot脚手架</h2><h3 id="什么是脚手架"><a href="#什么是脚手架" class="headerlink" title="什么是脚手架"></a>什么是脚手架</h3><h4 id="建筑工程中的脚手架"><a href="#建筑工程中的脚手架" class="headerlink" title="建筑工程中的脚手架"></a>建筑工程中的脚手架</h4><p>在建筑工程领域，“脚手架”指的是临时性的结构，用于支撑建筑物以及建筑材料，同时为建筑工人提供工作平台。这种脚手架通常是由钢管、扣件、木板和其他配件组成的，可以根据施工需要搭建不同高度和形状的结构</p><p>![image-20250414194943558](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414194943558.png)</p><h4 id="软件开发中的脚手架"><a href="#软件开发中的脚手架" class="headerlink" title="软件开发中的脚手架"></a>软件开发中的脚手架</h4><p>在软件开发领域，“脚手架”指的是用于快速创建项目基本结构的工具或模板。它帮助开发者初始化项目，设置必要的目录结构、文件模板以及依赖项。 </p><h4 id="Spring-Boot脚手架-1"><a href="#Spring-Boot脚手架-1" class="headerlink" title="Spring Boot脚手架"></a>Spring Boot脚手架</h4><p>Spring Boot 脚手架（Scaffold）可以帮助开发者快速搭建一个Spring Boot项目结构，让开发者只专注于业务逻辑的开发，而不是在项目的初始阶段花费大量时间来配置环境或者解决依赖关系。</p><p>Spring Boot 脚手架工具存在多种形式，以下是一些常见的 Spring Boot 脚手架工具和方法：</p><ul><li><strong>Spring Initializr：</strong></li></ul><p>这是 Spring 官方提供的工具，可以在 <a href="https://start.spring.io/">https://start.spring.io</a> 上找到。它允许开发者选择所需的依赖、Java 版本、构建工具（Maven 或 Gradle）以及其他配置选项来生成一个新的 Spring Boot 项目。</p><ul><li><strong>IntelliJ IDEA 内置支持：</strong></li></ul><p>IntelliJ IDEA 集成了 Spring Initializr 的功能，可以在 IDE 内直接创建 Spring Boot 项目。</p><ul><li><strong>Start Alibaba Cloud：</strong></li></ul><p>阿里云提供的 Start Alibaba Cloud 增强版工具，除了基本的 Spring Boot 模块外，还集成了阿里云服务和中间件的支持。</p><ul><li><strong>JHipster：</strong></li></ul><p>JHipster 是一个流行的脚手架工具，用于生成完整的 Spring Boot 应用程序，包括前端（Angular, React 或 Vue.js）和后端。它还包括用户管理和认证等功能。</p><ul><li><strong>Yeoman Generators：</strong></li></ul><p>Yeoman 是一个通用的脚手架工具，它有一个庞大的插件生态系统，其中包括用于生成 Spring Boot 项目的插件。</p><ul><li><strong>Bootify：</strong></li></ul><p>Bootify 是另一个用于生成 Spring Boot 应用程序的脚手架工具，提供了一些预定义的应用模板。</p><ul><li><strong>Spring Boot CLI：</strong></li></ul><p>Spring Boot CLI 是一个命令行工具，允许用户通过命令行来编写和运行 Spring Boot 应用。</p><ul><li><strong>Visual Studio Code 插件：</strong></li></ul><p>Visual Studio Code 社区提供了多个插件，如 Spring Boot Extension Pack，可以帮助开发者生成 Spring Boot 项目的基本结构。</p><ul><li><strong>GitHub Gist 和 Bitbucket Templates：</strong></li></ul><p>在 GitHub 和 Bitbucket 上，有很多开发者分享了用于生成 Spring Boot 项目的脚本或模板。</p><ul><li><strong>自定义脚手架：</strong></li></ul><p>很多开发者也会根据自己的需求定制自己的脚手架工具，比如使用 Bash 脚本、Gradle 或 Maven 插件等。</p><h3 id="使用官方提供的"><a href="#使用官方提供的" class="headerlink" title="使用官方提供的"></a>使用官方提供的</h3><h4 id="使用官方脚手架生成Spring-Boot项目"><a href="#使用官方脚手架生成Spring-Boot项目" class="headerlink" title="使用官方脚手架生成Spring Boot项目"></a>使用官方脚手架生成Spring Boot项目</h4><p>Spring Initializr：<a href="https://start.spring.io/">https://start.spring.io</a></p><p>![image-20250414195328832](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414195328832.png)</p><p>点击“GENERATE”后，生成zip压缩包</p><p>将其解压后的目录结构是一个标准的maven 工程：![image-20250414195343809](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414195343809.png) </p><h4 id="将项目放到IDEA当中"><a href="#将项目放到IDEA当中" class="headerlink" title="将项目放到IDEA当中"></a>将项目放到IDEA当中</h4><p>直接将解压后的<code>sb3-02-use-spring-initializr</code>拷贝到我们新建的空工程<code>SpringBoot3</code>下，然后重启idea就行了</p><p>![image-20250414213321678](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250414213321678.png)</p><p>注意：如果<code>pom.xml</code>文件的图标颜色不是蓝色，而是橘色，需要在<code>pom.xml</code>文件上右键，选择：add as maven project。这样<code>pom.xml</code>文件的图标就会变为蓝色了。</p><h4 id="脚手架生成的pom-xml文件"><a href="#脚手架生成的pom-xml文件" class="headerlink" title="脚手架生成的pom.xml文件"></a>脚手架生成的pom.xml文件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--继承Spring Boot父工程--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--自己项目的坐标--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.powernode<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sb3-02-use-spring-initializr<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>sb3-02-use-spring-initializr<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>使用spring官方提供的脚手架构建springboot项目<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">licenses</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">license</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">licenses</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">developers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">developer</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">developers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scm</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">connection</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">developerConnection</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tag</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">java.version</span>&gt;</span>21<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web起步依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--单元测试起步依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--打包插件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="脚手架生成的Spring-Boot项目的结构"><a href="#脚手架生成的Spring-Boot项目的结构" class="headerlink" title="脚手架生成的Spring Boot项目的结构"></a>脚手架生成的Spring Boot项目的结构</h4><p>![image-20250415010746176](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250415010746176.png)</p><p>src下面就是程序的入口，java的这个位置是类的根路径，resources同样也是类的根路径，放在这里面相当于java的com同级，只不过java放的是源文件，resources放的是配置文件，static主要放静态的，templates放动态网页的模板文件</p><p>application.properties是我们主要配置的文件，是springboot默认的配置文件，</p><h4 id="编写controller并测试"><a href="#编写controller并测试" class="headerlink" title="编写controller并测试"></a>编写controller并测试</h4><p>新建controller包，并新建HelloController类，如下图：</p><p>![image-20250415011419320](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250415011419320.png)</p><p><strong><font style="color:#DF2A3F;">重点：默认情况下，SpringBoot项目只扫描主入口程序所在目录以及子目录，因此创建的Controller类要求放在主入口程序的同级目录下或子目录下。其他位置默认情况下扫描不到。</font></strong></p><p>启动应用并访问：</p><p>![image-20250415011446207](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250415011446207.png)</p><h3 id="使用阿里提供的"><a href="#使用阿里提供的" class="headerlink" title="使用阿里提供的"></a>使用阿里提供的</h3><p>阿里巴巴提供的 Spring Boot 项目脚手架服务称为 DragonBoot（也被称为 Alibaba Cloud Spring Boot Initializr）。DragonBoot 基于 Spring Initializr，并在此基础上增加了更多的定制选项，特别是针对阿里巴巴云服务和中间件的支持。脚手架地址：<a href="https://start.aliyun.com/">https://start.aliyun.com/</a></p><p>当下（2024年）阿里云提供的脚手架使用的版本较低，国内有一些公司在用。如果要求版本较高的，则阿里云脚手架不适用。</p><p>![image-20250415013052683](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250415013052683.png)</p><h3 id="使用IDEA工具的脚手架插件"><a href="#使用IDEA工具的脚手架插件" class="headerlink" title="使用IDEA工具的脚手架插件"></a>使用IDEA工具的脚手架插件</h3><p> IDEA工具自带了Spring Boot脚手架的插件，使用它会更加的方便，让我们来操作一下：</p><p>![image-20250415013647170](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250415013647170.png)</p><p>![image-20250415013812077](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250415013812077.png)</p><h1 id="第2章-Spring-Boot核心机制"><a href="#第2章-Spring-Boot核心机制" class="headerlink" title="第2章 Spring Boot核心机制"></a>第2章 Spring Boot核心机制</h1><h2 id="为何以继承方式引入SpringBoot"><a href="#为何以继承方式引入SpringBoot" class="headerlink" title="为何以继承方式引入SpringBoot"></a>为何以继承方式引入SpringBoot</h2><h3 id="提出疑问"><a href="#提出疑问" class="headerlink" title="提出疑问"></a>提出疑问</h3><p>以前我们在开发项目时，需要什么，引入对应的依赖就行，比如我们需要连接mysql数据，则引入mysql驱动的依赖，如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>现在我们要使用SpringBoot框架，按说也应该采用依赖的方式将SpringBoot框架引入，如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>但是SpringBoot官方推荐的不是直接引入依赖，而是采用继承的方式实现，如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong><font style="color:#DF2A3F;">为什么？</font></strong></p><h3 id="作为父项目和作为依赖的区别"><a href="#作为父项目和作为依赖的区别" class="headerlink" title="作为父项目和作为依赖的区别"></a>作为父项目和作为依赖的区别</h3><p><strong>继承父工程的优势</strong></p><ul><li>依赖管理：可以在父工程中定义依赖的版本，子模块可以直接引用而不必指定版本号，让依赖管理更统一。</li><li>插件管理：可以在父工程中配置常用的插件及其版本，子模块可以直接使用这些配置。</li><li>属性设置：可以在父工程中定义一些通用的属性，如项目编码、Java 版本等。</li><li>统一配置：可以统一多个子模块的构建配置，确保一致性。</li></ul><p><strong>直接引入依赖的局限性</strong>（如果你不使用继承父工程的方式，而是通过直接引入依赖的方式来管理项目，那么你将失去上述的一些优势）</p><ul><li>依赖版本管理：每个子模块都需要单独指定依赖的版本，这会导致大量的重复配置，并且难以维护。</li><li>插件配置：每个子模块都需要单独配置插件及其版本，无法共享父工程中的插件配置。</li><li>属性设置：每个子模块都需要单独设置通用的属性，如项目编码、Java 版本等。</li><li>构建配置：每个子模块的构建配置需要单独维护，难以保证一致性。</li></ul><p><strong><font style="color:#DF2A3F;">总结：选择哪种方式取决于你的具体需求。</font></strong></p><ul><li><strong><font style="color:#DF2A3F;">如果你希望多个项目之间共享构建配置，那么使用父项目是一个好的选择；</font></strong></li><li><strong><font style="color:#DF2A3F;">如果你只是想在项目之间共享代码，那么应该使用依赖关系。</font></strong></li></ul><h3 id="原理揭晓"><a href="#原理揭晓" class="headerlink" title="原理揭晓"></a>原理揭晓</h3><p>通过源码来分析一下：</p><p>![image-20250415015255630](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250415015255630.png)</p><p>![image-20250415015258610](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250415015258610.png)</p><p>![image-20250415015301233](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250415015301233.png)</p><p>通过上图源码可以看到Spring Boot预先对开发中需要用到的依赖进行了版本的统一管理。我们需要和SpringBoot框架共享这个构建配置。因此官方推荐使用继承的方式引入SpringBoot框架。</p><h3 id="依赖统一管理的好处"><a href="#依赖统一管理的好处" class="headerlink" title="依赖统一管理的好处"></a>依赖统一管理的好处</h3><p>Spring Boot 框架的一个重要特性就是简化了项目依赖管理。它通过提供一个叫做“依赖管理”的功能来帮助开发者更容易地管理和使用第三方库和其他 Spring 组件。具体来说，Spring Boot 提供了一个包含多个 Spring 和其他常用库的依赖版本配置文件（通常是在 <code>spring-boot-dependencies</code> 文件中），这使得开发者不需要在自己的项目中显式指定这些依赖的版本号。</p><p>这样做有以下几个好处：</p><ol><li><strong>简化依赖声明</strong>：<br>开发者只需要在 <code>pom.xml</code> 文件中声明需要的依赖而不需要指定其版本号，因为 Spring Boot 已经为这些依赖指定了版本。例如，如果你需要使用mysql驱动，你只需要添加相应的依赖声明而不需要关心版本。</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li><strong>避免版本冲突</strong>：<br>当多个库之间存在依赖关系的时候，如果手动管理版本可能会导致版本之间的冲突（即“依赖地狱”）。Spring Boot 提供的统一版本管理可以减少这种冲突的可能性。</li><li><strong>易于升级</strong>：<br>当 Spring Boot 发布新版本时，通常会更新其依赖库到最新稳定版。因此，当你升级 Spring Boot 版本时，它所管理的所有依赖也会随之更新到兼容的版本。</li><li><strong>减少配置错误</strong>：<br>由于 Spring Boot 自动处理了依赖的版本，减少了手动输入版本号可能引入的拼写或格式错误。</li><li><strong>提高开发效率</strong>：<br>开发者可以专注于业务逻辑的编写，而不是花费时间在解决依赖问题上。</li></ol><p>总的来说，Spring Boot 的依赖管理功能使得开发者可以更加专注于业务逻辑的实现，同时减少了因依赖版本不一致而引发的问题，提高了项目的可维护性和开发效率。</p><p>当然，如果你在项目中需要更改某个依赖的版本号，不想使用SpringBoot框架指定的版本号，只需要在引入依赖时强行执行版本号即可，maven是支持就近原则的：</p><p>这样做就是采用SpringBoot指定版本的依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>![image-20250415153723118](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250415153723118.png)</p><p>这样做就是不采用SpringBoot指定版本的依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>![image-20250415153728868](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250415153728868.png)</p><h2 id="Starter-启动器"><a href="#Starter-启动器" class="headerlink" title="Starter-启动器"></a>Starter-启动器</h2><p>在 Spring Boot 中，启动器（Starter）本质上是一个简化依赖管理的概念。</p><p>Spring Boot 的启动器本质上就是一组预定义的依赖集合，它们被组织成一个个 Maven的依赖，以方便开发者快速集成特定的功能模块。</p><p>如果你想做web开发，只需要引入web启动器。web启动器会自动引入web开发所需要的子依赖。</p><h3 id="启动器实现原理"><a href="#启动器实现原理" class="headerlink" title="启动器实现原理"></a>启动器实现原理</h3><ol><li><strong>依赖聚合</strong>：<br>每个启动器通常对应一个特定的功能集或者一个完整的应用模块，如 <code>spring-boot-starter-web</code> 就包含了构建 Web 应用所需的所有基本依赖项，如 Spring MVC, Tomcat 嵌入式容器等。</li><li><strong>依赖传递</strong>：<br>当你在项目中引入一个启动器时，它不仅会把自身作为依赖加入到你的项目中，还会把它的所有直接依赖项（transitive dependencies）也加入进来。这意味着你不需要单独声明这些依赖项，它们会自动成为项目的一部分。</li><li><strong>版本管理</strong>：<br>启动器内部已经指定了所有依赖项的具体版本，这些版本信息存储在一个公共的 BOM（Bill of Materials，物料清单）文件中，通常是 <code>spring-boot-dependencies</code>。当引入启动器时，实际上也间接引用了这个 BOM，从而确保了所有依赖项版本的一致性。</li><li><strong>自动配置</strong>：<br>许多启动器还提供了自动配置（Auto-configuration），这是一种机制，允许 Spring Boot 根据类路径上的可用组件自动设置你的应用程序。例如，如果类路径上有 Spring MVC 和嵌入式 Tomcat，则 Spring Boot 会自动配置它们，并准备好一个 web 应用程序。</li></ol><p><strong>使用启动器的示例</strong></p><p>假设你想创建一个基于 Spring MVC 的 RESTful Web 应用，你可以简单地将 <code>spring-boot-starter-web</code> 添加到你的项目中：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当你添加这个依赖时，Spring Boot 会处理所有必要的细节，包括添加 Spring MVC 和 Tomcat 作为嵌入式 Servlet 容器，并且根据类路径上的内容进行适当的自动配置。如下图所示：</p><p>![image-20250415162234484](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250415162234484.png)</p><h3 id="都有哪些启动器"><a href="#都有哪些启动器" class="headerlink" title="都有哪些启动器"></a>都有哪些启动器</h3><p>启动器通常包括：</p><ul><li>SpringBoot官方提供的启动器</li><li>非官方提供的启动器</li></ul><h4 id="官方提供的启动器"><a href="#官方提供的启动器" class="headerlink" title="官方提供的启动器"></a>官方提供的启动器</h4><p>启动器命名特点：spring-boot-starter-*</p><p>![image-20250415162322902](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250415162322902.png)</p><h4 id="非官方的启动器"><a href="#非官方的启动器" class="headerlink" title="非官方的启动器"></a>非官方的启动器</h4><p>启动器命名特点：*-spring-boot-starter</p><p>![image-20250415162331627](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250415162331627.png)</p><h2 id="Spring-Boot核心注解"><a href="#Spring-Boot核心注解" class="headerlink" title="Spring Boot核心注解"></a>Spring Boot核心注解</h2><p>如果加入了mybatis启动器，就必须配置数据源，否则报错</p><h3 id="SpringBootApplication注解"><a href="#SpringBootApplication注解" class="headerlink" title="@SpringBootApplication注解"></a>@SpringBootApplication注解</h3><p>Spring Boot的主入口程序被<code>@SpringBootApplication</code>注解标注，可见这个注解的重要性，查看它的源码：</p><p>![image-20250416005803306](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250416005803306.png)</p><ol><li>当前类被 @SpringBootApplication 标注，被该注解标注的类是springboot项目的入口类。</li><li>该类的main方法就是整个springboot项目的入口。</li><li>关于 @SpringBootApplication 注解：<br> 从源码角度来看，该注解被以下三个注解标注了：<br> @SpringBootConfiguration<br> @EnableAutoConfiguration<br> @ComponentScan<br> 也就是说 @SpringBootApplication 注解是一个复合注解，同时拥有以上三个注解的功能。</li></ol><p>&#x2F;<em>@SpringBootConfiguration<br>@EnableAutoConfiguration<br>@ComponentScan(<br>        excludeFilters &#x3D; {@ComponentScan.Filter(<br>                type &#x3D; FilterType.CUSTOM,<br>                classes &#x3D; {TypeExcludeFilter.class}<br>        ), @ComponentScan.Filter(<br>                type &#x3D; FilterType.CUSTOM,<br>                classes &#x3D; {AutoConfigurationExcludeFilter.class}<br>        )}<br>)把这些注解直接复制到这里也可以代替@SpringBootApplication</em>&#x2F;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot304CoreAnnotationApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从这里开始。</span></span><br><span class="line">        <span class="comment">// SpringApplication 【spring应用程序】</span></span><br><span class="line">        <span class="comment">// run 【运行】</span></span><br><span class="line">        <span class="comment">// run方法的第一个参数其实就是配置类，对应的就是以前的配置文件</span></span><br><span class="line">        <span class="comment">// springboot应用程序就是从这个配置类开始，加载所有的bean的。</span></span><br><span class="line">        <span class="comment">// Springboot304CoreAnnotationApplication.class 又被称为源【起源】</span></span><br><span class="line">        <span class="comment">// args 可以传递命令行参数到这个数组上</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Springboot304CoreAnnotationApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="关于-SpringBootConfiguration-注解："><a href="#关于-SpringBootConfiguration-注解：" class="headerlink" title="关于 @SpringBootConfiguration 注解："></a>关于 @SpringBootConfiguration 注解：</h3><p>从源码角度来看，该注解被 @Configuration 注解标注，被该注解标注的类统一是配置类，代替以前的配置。<br>因此得出一个结论：springboot项目的主入口类同时又是一个配置类。<br>因此在springboot主入口配置类当中使用 @Bean 注解标注方法的话，该方法的返回值对象应该会被纳入IoC容器的管理。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot304CoreAnnotationApplication</span> &#123;</span><br><span class="line"><span class="meta">@Bean</span><span class="comment">//被bean这个注解标注的返回值将来会自动纳入IoC容器的管理，前提是这个类必须是配置类</span></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getDate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Springboot304CoreAnnotationApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>再写一个Controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从spring的IoC容器中查找Date对象，如果有的话会自动注入到这里。</span></span><br><span class="line">    <span class="meta">@Autowired</span><span class="comment">//自动注入</span></span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> date.toString();<span class="comment">//通过toString打印到浏览器上</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>就可以通过浏览器接收到date了</p><h3 id="关于-EnableAutoConfiguration-注解："><a href="#关于-EnableAutoConfiguration-注解：" class="headerlink" title="关于 @EnableAutoConfiguration 注解："></a>关于 @EnableAutoConfiguration 注解：</h3><p>该注解表示启用自动配置。<br>也就是说默认情况下，springboot应用都会默认启用自动配置。<br>自动配置有什么用？<br>    所谓的自动配置只要启动，springboot应用会去类路径当中查找class，根据类路径当中有某个类，或某些类，来自动管理bean，不需要我们程序员手动配置。<br>    比如：springboot检测到类路径当中有 SqlSessionFactory，或者在application.properties文件中配置了数据源，那么springboot会认为项目中<br>    有mybatis框架，因此会将mybatis中相关的bean自动初始化，然后放到IoC容器当中，自动将这些bean管理起来。</p><ul><li><p><strong>SqlSessionFactory</strong>: MyBatis的核心工厂SqlSessionFactory会被自动配置。这个工厂负责创建SqlSession实例，后者用来执行映射文件中的SQL语句。</p></li><li><p><strong>TransactionManager</strong>: DataSourceTransactionManager会被自动配置来管理与数据源相关的事务。</p><p>要先在pom里配上mybatis依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis启动器--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!--添加mysql驱动依赖--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后在application里配置数据源</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver//如果爆红就需要添加mysql依赖</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/springboot</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">liuqi3711022</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot304CoreAnnotationApplication</span> &#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 通过 run方法的返回值是可以获取到 Spring 上下文对象的(也就是.var的那个)。</span></span><br><span class="line">        <span class="comment">// ConfigurableApplicationContext 继承了 ApplicationContext</span></span><br><span class="line">        <span class="comment">// 因此 run方法的返回值就是spring容器。</span></span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> SpringApplication.run(Springboot304CoreAnnotationApplication.class, args);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过bean的name获取bean，就都能检测到</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;sqlSessionFactory&quot;</span>);</span><br><span class="line">        System.out.println(sqlSessionFactory);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">transactionManager</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;transactionManager&quot;</span>);</span><br><span class="line">        System.out.println(transactionManager);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭容器</span></span><br><span class="line">        applicationContext.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="关于-ComponentScan-注解："><a href="#关于-ComponentScan-注解：" class="headerlink" title="关于 @ComponentScan 注解："></a>关于 @ComponentScan 注解：</h3><p>负责组件扫描的。代替的xml配置是：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-packages</span>=<span class="string">&quot;com.powernode.springboot&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>这个注解出现在springboot主入口类上，因此组件扫描默认扫描的包是主入口程序所在的包以及该包下的所有子包。</p><p>要让bean纳入IoC容器的管理，必须将类放到主入口程序同级目录下，或者子目录下。</p><h2 id="Spring-Boot的单元测试（没看懂）"><a href="#Spring-Boot的单元测试（没看懂）" class="headerlink" title="Spring Boot的单元测试（没看懂）"></a>Spring Boot的单元测试（没看懂）</h2><p>controller属于表示层或者叫web层</p><h3 id="不使用单元测试怎么调用service"><a href="#不使用单元测试怎么调用service" class="headerlink" title="不使用单元测试怎么调用service"></a>不使用单元测试怎么调用service</h3><h4 id="创建模块"><a href="#创建模块" class="headerlink" title="创建模块"></a>创建模块</h4><p>使用脚手架创建springboot3-05-junit模块，不添加任何启动器</p><h4 id="编写service"><a href="#编写service" class="headerlink" title="编写service"></a>编写service</h4><p>![image-20250417024457620](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250417024457620.png)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;userService&quot;)</span><span class="comment">//给起个名字叫userService</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;jackson&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">//提供一个能返回user的方法</span></span><br><span class="line">    User <span class="title function_">findUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="直接在入口程序中调用service"><a href="#直接在入口程序中调用service" class="headerlink" title="直接在入口程序中调用service"></a>直接在入口程序中调用service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot305JunitApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//在不使用junit的前提下，怎么调用Service方法</span></span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> SpringApplication.run(Springboot305JunitApplication.class, args);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userService&quot;</span>, UserService.class);<span class="comment">//userService就是@Service的名字，这个返回userService</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.findUser();</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        applicationContext.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：</p><p>![image-20250417024804850](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250417024804850.png)</p><p>这种方式就是手动获取Spring上下文对象<code>ConfigurableApplicationContext</code>，然后调用getBean方法从Spring容器中获取service对象，然后调用方法。</p><h3 id="使用单元测试怎么调用service"><a href="#使用单元测试怎么调用service" class="headerlink" title="使用单元测试怎么调用service"></a>使用单元测试怎么调用service</h3><h4 id="test-starter引入以及测试类编写"><a href="#test-starter引入以及测试类编写" class="headerlink" title="test-starter引入以及测试类编写"></a>test-starter引入以及测试类编写</h4><p>使用单元测试应该如何调用service对象上的方法呢？</p><p>在使用脚手架创建Spring Boot项目时，为我们生成了单元测试类，如下：</p><p>![image-20250417025327260](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250417025327260.png)</p><p>![image-20250417025726542](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250417025726542.png)</p><p>当然，如果要使用单元测试，需要引入单元测试启动器，如果使用脚手架创建SpringBoot项目，这个test启动器会自动引入：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="SpringBootTest注解"><a href="#SpringBootTest注解" class="headerlink" title="@SpringBootTest注解"></a>@SpringBootTest注解</h4><p><code>@SpringBootTest</code> 会创建一个完整的 Spring 应用程序上下文（Application Context），这个上下文包含了应用程序的所有组件和服务。以下是 <code>@SpringBootTest</code> 做的一些主要工作：</p><ol><li><strong>创建 ApplicationContext</strong>：<ul><li><code>@SpringBootTest</code> 使用 <code>SpringApplication</code> 的 <code>run()</code> 方法来启动一个 Spring Boot 应用程序上下文。这意味着它会加载应用程序的主配置类和其他相关的配置类。</li></ul></li><li><strong>加载配置文件</strong>：<ul><li>它会查找并加载默认的配置文件，如 <code>application.properties</code></li></ul></li><li><strong>自动配置</strong>：<ul><li>如果应用程序依赖于 Spring Boot 的自动配置特性，<code>@SpringBootTest</code> 会确保这些自动配置生效。这意味着它会根据可用的类和bean来自动配置一些组件，如数据库连接、消息队列等。</li></ul></li><li><strong>注入依赖</strong>：<ul><li>使用 <code>@SpringBootTest</code> 创建的应用程序上下文允许你在测试类中使用 <code>@Autowired</code> 注入需要的 bean，就像在一个真实的 Spring Boot 应用程序中一样。</li></ul></li></ol><p>总的来说，<code>@SpringBootTest</code> 为你的测试提供了尽可能接近实际运行时环境的条件，这对于验证应用程序的行为非常有用。</p><h4 id="注入service并调用"><a href="#注入service并调用" class="headerlink" title="注入service并调用"></a>注入service并调用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// springboot项目中使用单元测试junit，那么单元测试类必须使用这个注解进行标注。</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Springboot305JunitApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 单元测试方法，单元测试方法使用 @Test 注解标注。</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.findUser();</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="外部化配置"><a href="#外部化配置" class="headerlink" title="外部化配置"></a>外部化配置</h2><h3 id="什么是外部化配置"><a href="#什么是外部化配置" class="headerlink" title="什么是外部化配置"></a>什么是外部化配置</h3><p>外部化配置是指：将<code>配置信息</code>存储在<code>应用程序代码</code>之外的地方。这样<code>配置信息</code>可以独立于代码进行管理。这样方便了配置的修改，并且修改后不需要重新编译代码，也不需要重新部署项目。</p><p>在springboot应用程序默认是先找外部化配置</p><h4 id="外部化配置的方式"><a href="#外部化配置的方式" class="headerlink" title="外部化配置的方式"></a>外部化配置的方式</h4><p>SpringBoot支持多种外部化配置方式，包括但不限于：</p><ul><li>properties文件</li><li>YAML文件</li><li>系统环境变量</li><li>命令行参数</li><li>……</li></ul><h4 id="外部化配置的优势"><a href="#外部化配置的优势" class="headerlink" title="外部化配置的优势"></a>外部化配置的优势</h4><ol><li><strong>灵活性</strong>：配置文件可以独立于应用程序部署，这使得可以根据运行环境的不同来调整配置，而无需修改代码。</li><li><strong>易于维护</strong>：配置变更不需要重新构建和部署应用程序，降低了维护成本。</li><li><strong>安全性</strong>：敏感信息如数据库密码、API密钥等可以存储在外部，并且可以限制谁有权限访问这些配置信息。</li><li><strong>共享性</strong>：多实例或多服务可以共享相同的配置信息，减少重复配置的工作量。</li><li><strong>版本控制</strong>：配置文件可以存放在版本控制系统中，便于跟踪历史版本和回滚配置。</li></ol><p>总之，外部化配置使得配置更加灵活、安全、易于管理和共享，是现代云原生应用中非常推荐的做法</p><h4 id="外部化配置对比传统配置"><a href="#外部化配置对比传统配置" class="headerlink" title="外部化配置对比传统配置"></a>外部化配置对比传统配置</h4><p>在传统的SSM三大框架中，如果修改XML的配置后，需要对应用重新打包，重新部署。</p><p>使用SpringBoot框架的<code>外部化配置</code>后，修改配置后，不需要对应用重新打包，也不需要重新部署，最多重启一下服务即可。</p><h3 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h3><p><code>application.properties</code>配置文件是SpringBoot框架默认的配置文件。</p><p><code>application.properties</code>不是必须的，SpringBoot对于应用程序来说，都提供了一套默认配置（就是我们所说的自动配置）。</p><p>如果你要改变这些默认的行为，可以在<code>application.properties</code>文件中进行配置。</p><p><code>application.properties</code>可以放在类路径当中，也可以放在项目之外。因此称为外部化配置。</p><p>![image-20250417031216205](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250417031216205.png) 类的根路径calsspath</p><p>Spring Boot 框架在启动时会尝试从以下位置加载 <code>application.properties</code> 配置文件（优先级从高到低）：</p><ol><li><strong>file:.&#x2F;config&#x2F;</strong>（在jar包外的）：首先在Spring Boot 当前工作目录下的 <code>config</code> 文件夹中查找。<ol><li><strong><font style="color:#DF2A3F;">注意：如果没有找到application.properties</font></strong><font style="color:#DF2A3F;"><strong>会继续找application.yml</strong></font><strong><font style="color:#DF2A3F;">，如果这两个都没有找到，才会进入以下位置查找，以此类推。</font></strong></li></ol></li><li><strong>file:.&#x2F;</strong>：如果在当前工作目录下<code>config</code>目录中找不到时，再从当前工作目录中查找，找不到properties就再找yml。</li><li><strong>classpath:&#x2F;config&#x2F;</strong>：如果从工作目录中找不到，会从类路径中找，先从类路径的 <code>/config/</code> 目录下寻找配置文件。</li><li><strong>classpath:&#x2F;</strong>：如果在 <code>/config/</code> 下没有找到，它会在类路径的根目录下查找。</li></ol><p>Spring Boot 会按照这个顺序来加载配置文件，如果在多个位置有相同的属性定义，那么最先检查的位置中的属性值将优先使用。</p><p>如果你想要指定其他的配置文件位置或者改变默认的行为，可以通过 <code>--spring.config.location=</code> 后跟路径的方式来指定配置文件的具体位置。例如 ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar sb3-01-first-web-1.0-SNAPSHOT.jar --spring.config.location=file:///E:\a\b\application.properties</span><br></pre></td></tr></table></figure><p>这样，Spring Boot 将会首先从 <code>E:\a\b\</code> 这个路径加载配置文件。注意，这种方式可以用来覆盖默认的配置文件位置，并且可以结合以上提到的位置一起使用。</p><p>注意：以上的<code>--spring.config.location=file:///E:\a\b\application.properties</code>就属于命令行参数，它将来会被传递到main方法的(String[] args)参数上。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot306PropertiesLocationApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// args 就是接收命令行参数的。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 打印命令行参数。</span></span><br><span class="line">        <span class="keyword">for</span> (String arg : args) &#123;</span><br><span class="line">            System.out.println(arg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//这里我们就知道为什么命令行参数要作为参数传到run方法里，因为run方法需要通过命令行参数来决定配置文件的路径</span></span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> SpringApplication.run(Springboot306PropertiesLocationApplication.class, args);</span><br><span class="line">        <span class="type">AppConfig</span> <span class="variable">appConfig</span> <span class="operator">=</span> applicationContext.getBean(AppConfig.class);</span><br><span class="line">        appConfig.printInfo();<span class="comment">//这是自定义的一个printInfo</span></span><br><span class="line">        applicationContext.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用-Value注解"><a href="#使用-Value注解" class="headerlink" title="使用@Value注解"></a>使用@Value注解</h3><p>@Value注解可以将<code>application.properties</code>&#x2F;<code>application.yml</code>文件中的配置信息注入&#x2F;绑定到java对象的属性上。</p><p><strong><font style="color:#DF2A3F;">语法格式：@Value(“${key}”)</font></strong></p><p>使用脚手架创建SpringBoot项目，不添加任何启动器，在<code>resources/application.properties</code>文件中进行如下配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">myapp.username</span>=<span class="string">jackson</span></span><br><span class="line"><span class="attr">myapp.email</span>=<span class="string">jackson@123.com</span></span><br><span class="line"><span class="attr">myapp.age</span>=<span class="string">2</span></span><br></pre></td></tr></table></figure><p>编写service类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemService</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;myapp.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;myapp.email&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注意：当使用 @Value注解的时候，如果这个key不存在，并且没有指定默认值，则报错。50就是默认值</span></span><br><span class="line">    <span class="comment">//@Value(&quot;$&#123;myapp.age&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;myapp.age:50&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(username);</span><br><span class="line">        System.out.println(email);</span><br><span class="line">        System.out.println(age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编写单元测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Springboot307ValueAnnotationApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SystemService systemService;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        systemService.printInfo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：![image-20250418164855135](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250418164855135.png) </p><h3 id="YAML"><a href="#YAML" class="headerlink" title="YAML"></a>YAML</h3><h4 id="YAML概述"><a href="#YAML概述" class="headerlink" title="YAML概述"></a>YAML概述</h4><p>SpringBoot采用集中式配置管理，所有的配置都编写到一个配置文件中：<code>application.properties</code></p><p>如果配置非常多，层级不够分明，因此SpringBoot为了提高配置文件可读性，也支持YAML格式的配置文件：<code>application.yml</code></p><p>YAML（YAML Ain’t Markup Language）是一种人类可读的数据序列化格式，它通常用于配置文件，在各种编程语言中作为一种存储或传输数据的方式。YAML的设计目标是易于阅读和编写，同时保持足够的表达能力来表示复杂的数据结构。</p><p><strong><font style="color:#DF2A3F;">YAML文件的扩展名可以是</font></strong><code>**&lt;font style=&quot;color:#DF2A3F;&quot;&gt;.yaml&lt;/font&gt;**</code><strong><font style="color:#DF2A3F;">或</font></strong><code>**&lt;font style=&quot;color:#DF2A3F;&quot;&gt;.yml&lt;/font&gt;**</code><strong><font style="color:#DF2A3F;">。</font></strong></p><h4 id="常见的数据存储和交换格式"><a href="#常见的数据存储和交换格式" class="headerlink" title="常见的数据存储和交换格式"></a>常见的数据存储和交换格式</h4><p><code>properties</code>、<code>XML</code>、<code>JSON</code>、<code>YAML</code>这几种格式确实是用来存储和交换数据的常见方式，但它们各有特点和适用场景：</p><p><strong>Properties</strong></p><ul><li>这种格式主要用于Java应用程序中的配置文件。它是键值对的形式，每一行是一个键值对，使用等号或冒号分隔键和值。</li><li>特点是简单易懂，但在处理复杂结构的数据时显得力不从心。</li></ul><p><strong>XML (eXtensible Markup Language)</strong></p><ul><li>XML是一种标记语言，用来描述数据的格式。它支持复杂的数据结构，包括嵌套和属性。</li><li>XML文档具有良好的结构化特性，适合传输和存储结构化的数据。但是，XML文档通常体积较大，解析起来也比较耗资源。</li></ul><p><strong>JSON (JavaScript Object Notation)</strong></p><ul><li>JSON是一种轻量级的数据交换格式，易于人阅读和编写，同时也易于机器解析和生成。它基于JavaScript的一个子集，支持多种数据类型，如数字、字符串、布尔值、数组和对象。</li><li>JSON因为简洁和高效而广泛应用于Web应用程序之间进行数据交换。</li></ul><p><strong>YAML (YAML Ain’t Markup Language)</strong></p><ul><li>YAML设计的目标之一就是让人类更容易阅读。它支持类似JSON的数据序列化，但提供了更多的灵活性，例如缩进来表示数据结构。</li><li>YAML非常适合用来编写配置文件，因为它允许以一种自然的方式组织数据，并且可以包含注释和其他人类可读的元素。</li></ul><p>总结来说，这四种格式都可以用来存储和交换数据，但它们的设计初衷和最佳使用场景有所不同。选择哪种格式取决于具体的应用需求、数据复杂度、性能要求等因素。</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32.png)</p><h4 id="YAML的语法规则"><a href="#YAML的语法规则" class="headerlink" title="YAML的语法规则"></a>YAML的语法规则</h4><p>YAML的语法规则如下：</p><ol><li>数据结构：YAML支持多种数据类型，包括：<ol><li>字符串、数字、布尔值</li><li>数组、list集合</li><li>map键值对   等。</li></ol></li><li>YAML使用<code>一个空格</code>来分隔<code>属性名</code>和<code>属性值</code>，例如：<ol><li><code>properties</code>文件中这样的配置：name&#x3D;jack</li><li><code>yaml</code>文件中需要这样配置：name: jack</li></ol></li><li>YAML用<code>换行+空格</code>来表示层级关系。注意不能使用tab，必须是空格，空格数量无要求，大部分建议2个或4个空格。例如：<ol><li><code>properties</code>文件中这样的配置：myapp.name&#x3D;mall</li><li><code>yaml</code>文件中就需要这样配置：</li></ol></li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">myapp:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mall</span></span><br></pre></td></tr></table></figure><ol start="4"><li>同级元素左对齐。例如：<ol><li><code>properties</code>文件中有这样的配置：</li></ol></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">myapp.name</span>=<span class="string">mall</span></span><br><span class="line"><span class="attr">myapp.count</span>=<span class="string">10</span></span><br></pre></td></tr></table></figure><pre><code>2. `yaml`文件中就应该这样配置：</code></pre><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">myapp:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mall</span></span><br><span class="line">  <span class="attr">count:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><ol start="5"><li>键必须是唯一的：在一个映射中，键必须是唯一的。</li><li>注释：使用<code>#</code>进行注释。</li><li>大小写敏感</li></ol><h4 id="YAML的使用小细节"><a href="#YAML的使用小细节" class="headerlink" title="YAML的使用小细节"></a>YAML的使用小细节</h4><p>第一：普通文本也可以使用单引号或双引号括起来：（当然普通文本也可以不使用单引号和双引号括起来。）</p><ul><li>单引号括起来：单引号内所有的内容都被当做普通文本，不转义（例如字符串中有\n，则\n被当做普通的字符串）</li><li>双引号括起来：双引号中有 \n 则会被转义为换行符</li></ul><p>第二：保留文本格式</p><ul><li><p>|      将文本写到这个符号的下层，会自动保留格式。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">myapp:</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">|</span></span><br><span class="line"><span class="string">  aaaa</span></span><br><span class="line"><span class="string">  bbbb</span></span><br><span class="line"><span class="string">  cccc</span></span><br></pre></td></tr></table></figure></li></ul><p>第三：文档切割</p><ul><li>— 这个符号下面的配置可以认为是一个独立的yaml文件。便于庞大文件的阅读。</li></ul><h3 id="配置文件合并"><a href="#配置文件合并" class="headerlink" title="配置文件合并"></a>配置文件合并</h3><p>一个项目中所有的配置全部编写到<code>application.properties</code>文件中，会导致配置臃肿，不易维护，有时我们会将配置编写到不同的文件中，例如：<code>application-mysql.properties</code>专门配置mysql的信息，<code>application-redis.properties</code>专门配置redis的信息，最终将两个配置文件合并到一个配置文件中。</p><h4 id="properties文件"><a href="#properties文件" class="headerlink" title="properties文件"></a>properties文件</h4><p>配置文件里有中文的话编码格式会变成![image-20250419015101834](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250419015101834.png) ，需要在settings里有个File encoding，</p><p>![image-20250419015258428](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250419015258428.png)</p><p><code>application-mysql.properties</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure><p><code>application-redis.properties</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.data.redis.host</span>=<span class="string">localhost</span></span><br><span class="line"><span class="attr">spring.data.redis.port</span>=<span class="string">6379</span></span><br></pre></td></tr></table></figure><p><code>application.properties</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.config.import</span>=<span class="string">classpath:application-mysql.properties,classpath:application-redis.properties</span></span><br></pre></td></tr></table></figure><p>编写service测试，看看能否拿到配置信息：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spr&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mysqlUsername;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mysqlPassword;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.data.redis.host&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String redisHost;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.data.redis.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String redisPort;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(mysqlUsername + <span class="string">&quot;,&quot;</span> + mysqlPassword + <span class="string">&quot;,&quot;</span> + redisHost + <span class="string">&quot;,&quot;</span> + redisPort);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="yaml文件"><a href="#yaml文件" class="headerlink" title="yaml文件"></a>yaml文件</h4><p><code>application-mysql.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">rootyml</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">123456yml</span></span><br></pre></td></tr></table></figure><p><code>application-redis.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhostyml</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure><p><code>application.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">import:</span></span><br><span class="line">    <span class="comment">#数组或者list集合可以这么写</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">classpath:/config/application-mysql.yml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">classpath:/config/application-redis.yml</span></span><br><span class="line"><span class="comment">#    import: [classpath:/config/application-mysql.yml, classpath:/config/application-redis.yml]</span></span><br></pre></td></tr></table></figure><h3 id="多环境切换"><a href="#多环境切换" class="headerlink" title="多环境切换"></a>多环境切换</h3><p>在Spring Boot中，多环境切换是指在一个应用程序中支持多种运行环境配置的能力。这通常用于区分开发（development）、测试（testing）、预生产（staging）和生产（production）等不同阶段的环境。</p><p>这种功能使得开发者能够在不同的环境中使用不同的配置，比如数据库连接信息、服务器端口、环境变量等，而不需要更改代码。这对于维护一个可移植且易于管理的应用程序非常重要。</p><ol><li>开发环境的配置文件名一般叫做：<code>application-dev.properties</code></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">dev</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">dev123</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/dev</span></span><br></pre></td></tr></table></figure><ol start="2"><li>测试环境的配置文件名一般叫做：<code>application-test.properties</code></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">test</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">test123</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/test</span></span><br></pre></td></tr></table></figure><ol start="3"><li>预生产环境的配置文件名一般叫做：<code>application-preprod.properties</code></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">preprod</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">preprod123</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/preprod</span></span><br></pre></td></tr></table></figure><ol start="4"><li>生产环境的配置文件名一般叫做：<code>application-prod.properties</code></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">prod</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">prod123</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/prod</span></span><br></pre></td></tr></table></figure><p>然后添加下面的东西</p><p>如果你希望该项目使用生产环境的配置，你可以这样做：</p><ul><li>第一种方式：在<code>application.properties</code>文件中添加这个配置：<strong>spring.profiles.active&#x3D;prod</strong>，这个prod就是用来区分环境的，测试环境就换成test</li><li>第二种方式：在命令行参数上添加：<strong>–spring.profiles.active&#x3D;prod</strong></li></ul><h3 id="将配置绑定到bean"><a href="#将配置绑定到bean" class="headerlink" title="将配置绑定到bean"></a>将配置绑定到bean</h3><h4 id="绑定简单bean"><a href="#绑定简单bean" class="headerlink" title="绑定简单bean"></a>绑定简单bean</h4><p>SpringBoot配置文件中的信息除了可以使用<code>@Value注解</code>读取之外，也可以将配置信息一次性赋值给Bean对象的属性。</p><p>例如有这样的配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">myapp:</span></span><br><span class="line">  <span class="attr">a:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">jacksonyml</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">123456yml</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">30</span></span><br><span class="line">    <span class="attr">gender:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将这里的配置信息一次性的绑定到bean对象的属性上。比 @Value 注解好用，方便。</span></span><br><span class="line"><span class="attr">myapp.a.username</span>=<span class="string">jackson</span></span><br><span class="line"><span class="attr">myapp.a.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">myapp.a.age</span>=<span class="string">20</span></span><br><span class="line"><span class="attr">myapp.a.gender</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><p>Bean需要这样定义:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 纳入IoC容器的管理。</span></span><br><span class="line"><span class="comment">//@Component</span></span><br><span class="line"><span class="comment">// 这个注解标注的类一定会被纳入IoC容器的管理，同时这个类也表示是一个配置类。</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// 将配置文件中的属性值一次性的绑定到bean对象的属性上。</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;myapp.a&quot;)</span><span class="comment">//这里给了前缀名，要实现这种一次性的绑定功能，配置文件中的属性名和bean对象的属性名要一致。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Boolean gender;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;AppConfig&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;username=&#x27;&quot;</span> + username + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, password=&#x27;&quot;</span> + password + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, gender=&quot;</span> + gender +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGender</span><span class="params">(Boolean gender)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>被绑定的bean，需要使用<code>@ConfigurationProperties(prefix = &quot;app&quot;)</code>注解进行标注，prefix用来指定前缀，哪个是前缀</li><li>配置文件中的<code>name</code>、<code>age</code>、<code>email</code>要和bean对象的属性名<code>name</code>、<code>age</code>、<code>email</code>对应上。（属性名相同）</li><li>并且bean中的所有属性都提供了<code>setter</code>方法。因为底层是通过<code>setter</code>方法给bean属性赋值的。</li><li>这样的bean需要使用<code>@Component</code>注解进行标注，纳入IoC容器的管理。<code>@Component</code>注解负责创建Bean对象，<code>@ConfigurationProperties(prefix = &quot;app&quot;)</code>注解负责给bean对象的属性赋值。</li><li>bean的属性需要是<code>非static</code>的属性。</li></ol><p>我们把这个Bean对象的类名打印一下看看：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729671124931-0ce60aa3-54bb-4a35-9b99-c846f86ad6b8.png)</p><p>可以发现底层实际上创建了<code>AppBean</code>的代理对象<code>AppBean$$SpringCGLIB</code>。</p><p>生成代理对象会影响效率，这里我们不需要使用代理功能，可以通过以下配置来取消代理机制：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="comment">//setter and getter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="绑定嵌套bean"><a href="#绑定嵌套bean" class="headerlink" title="绑定嵌套bean"></a>绑定嵌套bean</h4><p>当一个Bean中嵌套了一个Bean，这种情况下可以将配置信息绑定到该Bean上吗？当然可以。</p><p>有这样的一个配置：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app:</span></span><br><span class="line">  <span class="attr">xyz:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">lucy_yml</span></span><br><span class="line">    <span class="attr">addr:</span></span><br><span class="line">      <span class="attr">city:</span> <span class="string">TJ</span></span><br><span class="line">      <span class="attr">street:</span> <span class="string">NanKai</span></span><br></pre></td></tr></table></figure><p>需要编写这样的两个Bean：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String street;</span><br><span class="line">省略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app.xyz&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Address addr;<span class="comment">//嵌套bean，被一起加入了ioc容器</span></span><br><span class="line">~~~省略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后执行测试程序</p><h4 id="EnableConfigurationProperties与-ConfigurationPropertiesScan"><a href="#EnableConfigurationProperties与-ConfigurationPropertiesScan" class="headerlink" title="@EnableConfigurationProperties与@ConfigurationPropertiesScan"></a>@EnableConfigurationProperties与@ConfigurationPropertiesScan</h4><p>将<code>AppBean</code>纳入IoC容器的管理，之前我们说了两种方式：第一种是使用<code>@Component</code>，第二种是使用<code>@Configuration</code>。SpringBoot其实还提供了另外两种方式：</p><ul><li>第一种：@EnableConfigurationProperties</li><li>第二种：@<font style="color:#080808;background-color:#ffffff;">ConfigurationPropertiesScan</font></li></ul><p><font style="color:#080808;background-color:#ffffff;">这两个注解都是标注在SpringBoot主入口程序上的：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将配置信息绑定到bean的第三种方式：在主入口程序上添加以下注解。</span></span><br><span class="line"><span class="comment">// 以下注解的作用是：启用将配置信息绑定到bean，以下代码的意思就是将配置信息绑定到User这个bean上。</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;User.class&#125;)</span></span><br><span class="line"><span class="comment">//@EnableConfigurationProperties(&#123;User.class&#125;)//可以添加多个，底层的value是class数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将配置信息绑定到bean的第四种方式：在主入口程序上添加以下注解。</span></span><br><span class="line"><span class="comment">//@ConfigurationPropertiesScan(basePackages = &quot;com.powernode.springboot.bean&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot310ConfigBindToBeanApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Springboot310ConfigBindToBeanApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="将配置赋值到Bean的Map-List-Array属性上"><a href="#将配置赋值到Bean的Map-List-Array属性上" class="headerlink" title="将配置赋值到Bean的Map&#x2F;List&#x2F;Array属性上"></a>将配置赋值到Bean的Map&#x2F;List&#x2F;Array属性上</h4><p>配置信息如下</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app2.abc.names[0]</span>=<span class="string">jack</span></span><br><span class="line"><span class="attr">app2.abc.names[1]</span>=<span class="string">lucy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">app2.abc.addrArray[0].city</span>=<span class="string">BeiJing</span></span><br><span class="line"><span class="attr">app2.abc.addrArray[0].street</span>=<span class="string">ChaoYang</span></span><br><span class="line"><span class="attr">app2.abc.addrArray[1].city</span>=<span class="string">TianJin</span></span><br><span class="line"><span class="attr">app2.abc.addrArray[1].street</span>=<span class="string">NanKai</span></span><br><span class="line"></span><br><span class="line"><span class="attr">app2.abc.addrList[0].city</span>=<span class="string">BeiJing_List</span></span><br><span class="line"><span class="attr">app2.abc.addrList[0].street</span>=<span class="string">ChaoYang_List</span></span><br><span class="line"><span class="attr">app2.abc.addrList[1].city</span>=<span class="string">TianJin_List</span></span><br><span class="line"><span class="attr">app2.abc.addrList[1].street</span>=<span class="string">NanKai_List</span></span><br><span class="line"></span><br><span class="line"><span class="attr">app2.abc.addrs.addr1.city</span>=<span class="string">BeiJing_Map</span></span><br><span class="line"><span class="attr">app2.abc.addrs.addr1.street</span>=<span class="string">ChaoYang_Map</span></span><br><span class="line"><span class="attr">app2.abc.addrs.addr2.city</span>=<span class="string">TianJin_Map</span></span><br><span class="line"><span class="attr">app2.abc.addrs.addr2.street</span>=<span class="string">NanKai_Map</span></span><br></pre></td></tr></table></figure><p>代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Component如果不加这个，就在主入口那边绑定bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app2.abc&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppBean</span> &#123;</span><br><span class="line">    <span class="comment">// 数组：数组中元素是简单类型</span></span><br><span class="line">    <span class="keyword">private</span> String[] names;</span><br><span class="line">    <span class="comment">// 数组：数组中元素是bean</span></span><br><span class="line">    <span class="keyword">private</span> Address[] addrArray;</span><br><span class="line">    <span class="comment">// List集合：集合中的元素是bean</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Address&gt; addrList;</span><br><span class="line">    <span class="comment">// Map集合：String,Bean</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Address&gt; addrs;</span><br><span class="line">    后面就是set方法和toString方法了省略</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>提醒：记得入口程序使用<font style="color:#080808;background-color:#ffffff;">@EnableConfigurationProperties({User.class, AppBean.class})进行标注。</font></p><p>yml配置信息：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app2:</span></span><br><span class="line">  <span class="attr">abc:</span></span><br><span class="line">    <span class="comment"># names: [jack, lucy]可以这样写</span></span><br><span class="line">    <span class="attr">names:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">tom2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">smith2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    addrArray:    yml里面是区分大小写的，但是addrArray可以写成addr-array，在mybatis里有一样的自动解析驼峰</span></span><br><span class="line">    <span class="attr">addr-array:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">city:</span> <span class="string">BeiJing2</span></span><br><span class="line">        <span class="attr">street:</span> <span class="string">ChaoYang2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">city:</span> <span class="string">TianJin2</span></span><br><span class="line">        <span class="attr">street:</span> <span class="string">NanKai2</span></span><br><span class="line">    <span class="comment">#    addrList:</span></span><br><span class="line">    <span class="attr">addr-list:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">city:</span> <span class="string">BeiJing_List2</span></span><br><span class="line">        <span class="attr">street:</span> <span class="string">ChaoYang_List2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">city:</span> <span class="string">TianJin_List2</span></span><br><span class="line">        <span class="attr">street:</span> <span class="string">NanKai_List2</span></span><br><span class="line">    <span class="attr">addrs:</span></span><br><span class="line">      <span class="attr">addr1:</span></span><br><span class="line">        <span class="attr">city:</span> <span class="string">BeiJing_Map2</span></span><br><span class="line">        <span class="attr">street:</span> <span class="string">ChaoYang_Map2</span></span><br><span class="line">      <span class="attr">addr2:</span></span><br><span class="line">        <span class="attr">city:</span> <span class="string">TianJin_Map2</span></span><br><span class="line">        <span class="attr">street:</span> <span class="string">NanKai_Map2</span></span><br></pre></td></tr></table></figure><h4 id="将配置绑定到第三方对象"><a href="#将配置绑定到第三方对象" class="headerlink" title="将配置绑定到第三方对象"></a>将配置绑定到第三方对象</h4><p>将配置文件中的信息绑定到某个Bean对象上，如果这个Bean对象没有源码，是第三方库提供的，怎么办？</p><p>此时可以单独编写一个方法，在方法上使用以下两个注解进行标注：</p><ul><li><strong>@Bean</strong></li><li><strong>@ConfigurationProperties</strong></li></ul><p>比如借用上面的类<code>Address.class</code>,可以写一个方法返回这个类的对象然后纳入ioc容器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定该类是一个配置类。</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 假设Address是第三方库提供的类。我们使用以下方式可以完成配置到bean的属性的绑定。</span></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// 纳入IoC容器的管理</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;other.abc&quot;)</span> <span class="comment">// 将配置文件中凡是以 other.abc 开头的配置数据绑定到Address对象的属性上。</span></span><br><span class="line">    <span class="keyword">public</span> Address <span class="title function_">address</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Address</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="指定数据来源"><a href="#指定数据来源" class="headerlink" title="指定数据来源"></a>指定数据来源</h4><p>之前所讲的内容是将Spring Boot框架默认的配置文件<code>application.properties</code>或<code>application.yml</code>作为数据的来源绑定到Bean上。如果配置信息没有在默认的配置文件中呢？可以使用@PropertySource注解指定配置文件的位置，这个配置文件可以是<code>.properties</code>，也可以是<code>.xml</code>。这里重点掌握<code>.properties</code>即可。</p><p>在<code>resources</code>目录下新建<code>a</code>目录，在<code>a</code>目录下新建<code>b</code>目录，<code>b</code>目录中新建<code>group-info.properties</code>文件，进行如下的配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">group.name</span>=<span class="string">IT</span></span><br><span class="line"><span class="attr">group.leader</span>=<span class="string">LaoDu</span></span><br><span class="line"><span class="attr">group.count</span>=<span class="string">20</span></span><br></pre></td></tr></table></figure><p>定义Java类<code>Group</code>，然后进行注解标注：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;group&quot;)</span></span><br><span class="line"><span class="comment">// 用这个注解来指定数据来源。</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:/a/b/group-info.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Group</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String leader;</span><br><span class="line">    <span class="keyword">private</span> Integer count;</span><br><span class="line">    下面就是set和toSTring方法，省略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以下三个注解分别起到什么作用：</p><ul><li>@Configuration：指定该类为配置类，纳入Spring容器的管理</li><li>@ConfigurationProperties(prefix &#x3D; “group”)：将配置文件中的值赋值给Bean对象的属性</li><li>@PropertySource(“classpath:a&#x2F;b&#x2F;group-info.properties”)：指定额外的配置文件</li></ul><h3 id="ImportResource注解"><a href="#ImportResource注解" class="headerlink" title="@ImportResource注解"></a>@ImportResource注解</h3><p>创建Bean的三种方式总结：</p><ul><li>第一种方式：编写applicationContext.xml文件，在该文件中注册Bean，Spring容器启动时实例化配置文件中的Bean对象。</li><li>第二种方式：@Configuration注解结合@Bean注解。</li><li>第三种方式：@Component、@Service、@Controller、@Repository等注解。</li></ul><p>第二种和第三种我们都已经知道了。针对第一种方式，如果在SpringBoot框架中应该怎么实现呢？使用@ImportResource注解实现</p><p>定义一个普通的Java类：Person</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    下面省略set get tostring</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>resources</code>目录下新建<code>applicationContext.xml</code>配置文件，添加：</p><p>![image-20250420152210414](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250420152210414.png)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.powernode.springboot.bean.Person&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jackson&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在SpringBoot主入口类上添加@ImportResource进行资源导入，这样<code>applicationContext.xml</code>文件中的Bean将会纳入IoC容器的管理：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ImportResource(&quot;classpath:/applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot310ConfigBindToBeanApplication</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h3><p><strong><font style="color:#DF2A3F;">SpringBoot框架在启动的时候会将系统配置，环境信息全部封装到Environment对象中，如果要获取这些环境信息，可以调用&gt;Environment接口的方法</font></strong></p><p>在Spring Boot中，<code>Environment</code>接口提供了访问应用程序环境信息的方法，比如活动配置文件、系统环境变量、命令行参数等。<code>Environment</code>接口由Spring框架提供，Spring Boot应用程序通常会使用Spring提供的实现类<code>AbstractEnvironment</code>及其子类来实现具体的环境功能。</p><p><code>Environment</code>对象封装的主要数据包括：</p><ol><li><strong>Active Profiles</strong>: 当前激活的配置文件列表。Spring Boot允许应用程序定义不同的环境配置文件（如开发环境、测试环境和生产环境），通过激活不同的配置文件来改变应用程序的行为。</li><li><strong>System Properties</strong>: 系统属性，通常是操作系统级别的属性，比如操作系统名称、Java版本等。</li><li><strong>System Environment Variables</strong>: 系统环境变量，这些变量通常是由操作系统提供的，可以在启动应用程序时设置特定的值。</li><li><strong>Command Line Arguments</strong>: 应用程序启动时传递给主方法的命令行参数。</li><li><strong>Property Sources</strong>: <code>Environment</code>还包含了一个<code>PropertySource</code>列表，这个列表包含了从不同来源加载的所有属性。<code>PropertySource</code>可以来自多种地方，比如配置文件、系统属性、环境变量等。</li></ol><p>在Spring Boot中，可以通过注入<code>Environment</code>来获取上述信息。例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SomeBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Environment environment;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSome</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 直接使用这个环境对象，来获取环境信息，配置信息等。</span></span><br><span class="line">        String[] activeProfiles = environment.getActiveProfiles();</span><br><span class="line">        <span class="keyword">for</span> (String activeProfile : activeProfiles) &#123;</span><br><span class="line">            System.out.println(activeProfile);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 也可以获取配置信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">street</span> <span class="operator">=</span> environment.getProperty(<span class="string">&quot;app.xyz.addr.street&quot;</span>);</span><br><span class="line">        System.out.println(street);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过这种方式，你可以根据环境的不同灵活地配置你的应用程序。<code>Environment</code>是一个非常有用的工具，它可以帮助你管理各种类型的配置信息，并根据不同的运行时条件做出相应的调整。</p><h2 id="Spring-Boot中如何进行AOP的开发（需要补习）"><a href="#Spring-Boot中如何进行AOP的开发（需要补习）" class="headerlink" title="Spring Boot中如何进行AOP的开发（需要补习）"></a>Spring Boot中如何进行AOP的开发（需要补习）</h2><h4 id="Spring-Boot-AOP概述"><a href="#Spring-Boot-AOP概述" class="headerlink" title="Spring Boot AOP概述"></a>Spring Boot AOP概述</h4><p>面向切面编程AOP在Spring教程中已经进行了详细讲解，这里不再赘述，如果忘记的同学，可以重新听一下Spring教程中AOP相关的内容。这里仅带着大家在Spring Boot中实现AOP编程。</p><p>Spring Boot的AOP编程和Spring框架中AOP编程的唯一区别是：引入依赖的方式不同。其他内容完全一样。Spring Boot中AOP编程需要引入aop启动器：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--aop启动器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729734178510-707a3d64-caf6-407d-ba2b-9633f218c0ed.png)</p><p>可以看到，当引入<code>aop启动器</code>之后，会引入<code>aop依赖</code>和<code>aspectj依赖</code>。</p><ul><li>aop依赖：如果只有这一个依赖，也可以实现AOP编程，这种方式表示使用了纯Spring AOP实现aop编程。</li><li>aspectj依赖：一个独立的可以完成AOP编程的AOP框架，属于第三方的，不属于Spring框架。（我们通常用它，因为它的功能更加强大）</li></ul><h4 id="Spring-Boot-AOP实现"><a href="#Spring-Boot-AOP实现" class="headerlink" title="Spring Boot AOP实现"></a>Spring Boot AOP实现</h4><p>实现功能：项目中很多service，要求执行<code>任何service中的任何方法之前</code>记录日志。</p><h5 id="创建Spring-Boot项目引入aop启动器"><a href="#创建Spring-Boot项目引入aop启动器" class="headerlink" title="创建Spring Boot项目引入aop启动器"></a>创建Spring Boot项目引入aop启动器</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--aop启动器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="编写service并提供方法"><a href="#编写service并提供方法" class="headerlink" title="编写service并提供方法"></a>编写service并提供方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Long id, String name)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id删除用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 用户id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Long id, String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;正在保存用户信息：&quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;正在删除用户&quot;</span> + id + <span class="string">&quot;信息&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="编写切面"><a href="#编写切面" class="headerlink" title="编写切面"></a>编写切面</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span><span class="comment">//指定它是一个切面</span></span><br><span class="line"><span class="meta">@Component</span><span class="comment">//纳入ioc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 日志记录器，记录日志的工具</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(LoggingAspect.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义切入点，匹配所有以 &quot;service&quot; 结尾的包下的所有方法</span></span><br><span class="line">    <span class="comment">// 切入点表达式</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.powernode.springboot.service..*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">serviceMethods</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在切入点的方法执行前执行此方法</span></span><br><span class="line">    <span class="comment">// 前置通知</span></span><br><span class="line">    <span class="meta">@Before(&quot;serviceMethods()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logBefore</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        logger.info(<span class="string">&quot;方法 [&#123;&#125;] 携带的 [&#123;&#125;] 被调用了.&quot;</span>, methodName, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ConfigurableApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> SpringApplication.run(Springboot311AopApplication.class, args);</span><br><span class="line"></span><br><span class="line">    <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> applicationContext.getBean(UserService.class);</span><br><span class="line">    userService.save(<span class="number">111L</span>, <span class="string">&quot;jackson&quot;</span>);</span><br><span class="line">    userService.deleteById(<span class="number">111L</span>);</span><br><span class="line"></span><br><span class="line">    applicationContext.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="第3章-SSM整合"><a href="#第3章-SSM整合" class="headerlink" title="第3章 SSM整合"></a>第3章 SSM整合</h1><h2 id="整合持久层框架MyBatis"><a href="#整合持久层框架MyBatis" class="headerlink" title="整合持久层框架MyBatis"></a>整合持久层框架MyBatis</h2><h3 id="准备数据库表及数据"><a href="#准备数据库表及数据" class="headerlink" title="准备数据库表及数据"></a>准备数据库表及数据</h3><p>创建数据库：springboot</p><p>使用IDEA工具自带的mysql插件来完成表的创建和数据的准备：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729050185616-731cbd39-267f-45e1-81f3-1f07d621c514.png)</p><p>![image-20250420210717500](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250420210717500.png)</p><p>![image-20250420210729068](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250420210729068.png)</p><p>![image-20250420210733298](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250420210733298.png)</p><p>表创建成功后，为表准备数据，如下：</p><p>![image-20250420210742206](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250420210742206.png)</p><h3 id="创建SpringBoot项目"><a href="#创建SpringBoot项目" class="headerlink" title="创建SpringBoot项目"></a>创建SpringBoot项目</h3><p>引入mysql驱动以及mybatis的启动器</p><p>![image-20250420210817285](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250420210817285.png)</p><p>依赖如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis的启动器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mysql的驱动依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong><font style="color:#DF2A3F;">注意，之前也提到过：</font></strong></p><ul><li><strong><font style="color:#DF2A3F;">Spring Boot官方提供的启动器的名字规则：spring-boot-starter-xxx</font></strong></li><li><strong><font style="color:#DF2A3F;">第三方（非Spring Boot官方）提供的启动器的名字规则：xxx-spring-boot-starter</font></strong></li></ul><h3 id="编写数据源配置"><a href="#编写数据源配置" class="headerlink" title="编写数据源配置"></a>编写数据源配置</h3><p>前面提到过，Spring Boot配置统一可以编写到application.properties中，配置如下：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Spring Boot脚手架自动生成的</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">sb3-05-springboot-mybatis</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># mybatis连接数据库的数据源</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/springboot</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">liuqi3711022</span></span><br></pre></td></tr></table></figure><p>以上的配置属于连接池的配置，连接池使用的是Spring Boot默认的连接池：HikariCP</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据源配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springboot</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br></pre></td></tr></table></figure><h3 id="编写实体类Vip"><a href="#编写实体类Vip" class="headerlink" title="编写实体类Vip"></a>编写实体类Vip</h3><p>表<code>t_vip</code>中的字段分别是：</p><ul><li>id</li><li>name</li><li>card_number</li><li>birth</li></ul><p>对应实体类<code>Vip</code>中的属性名分别是：</p><ul><li>Long id;</li><li>String name;</li><li>String cardNumber;</li><li>String birth;</li></ul><p>创建包<code>bean</code>，在该包下新建Vip类，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Vip</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String cardNumber; <span class="comment">// 数据库字段 card_number</span></span><br><span class="line">    <span class="keyword">private</span> String birth;</span><br><span class="line">    有参无参构造方法，没有id的有参，toSTring，setget</span><br><span class="line">    &#123;&#125;    </span><br></pre></td></tr></table></figure><h3 id="编写Mapper接口"><a href="#编写Mapper接口" class="headerlink" title="编写Mapper接口"></a>编写Mapper接口</h3><p>创建<code>repository</code>包，在该包下新建<code>VipMapper</code>接口，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">VipMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存会员信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> vip 会员信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 1表示保存成功。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(Vip vip)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有会员信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 会员列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Vip&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="编写Mapper接口的XML配置文件"><a href="#编写Mapper接口的XML配置文件" class="headerlink" title="编写Mapper接口的XML配置文件"></a>编写Mapper接口的XML配置文件</h3><p>在<code>resources</code>目录下新建<code>mapper</code>目录，将来的<code>mapper.xml</code>配置文件放在这个目录下。</p><p>安装<code>MyBatisX</code>插件，该插件可以根据我们编写的<code>VipMapper</code>接口自动生成mapper的XML配置文件。</p><p>![image-20250421002452276](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250421002452276.png)</p><p>然后在<code>VipMapper</code>接口上：alt+enter,选择[mybatisx]generate mapper of xml，生成<code>mapper of xml</code>：需要选择一个生成的位置</p><p>![image-20250421002424305](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250421002424305.png)</p><p>![image-20250421003045200](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250421003045200.png)</p><p>接下来，你会看到Mapper接口中方法报错了，可以在错误的位置上使用<code>alt+enter</code>，选择<code>Generate statement</code>：</p><p>![image-20250421013141212](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250421013141212.png)</p><p>这个时候在mapper的xml配置文件中便生成了对应的配置，如下：</p><p>![image-20250421013237683](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250421013237683.png)</p><p>接下来就是编写SQL语句了，最终<code>VipMapper.xml</code>文件的配置如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.springboot.repository.VipMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--就是说下面的这个太长了，可以在配置文件里起别名起，起完别名就可以直接写那个类了，也可以不写，他会自动识别--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;insert id=&quot;insert&quot;parameterType=&quot;com.powernode.springboot.bean.Vip&quot;&gt;&lt;/insert&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span><span class="attr">parameterType</span>=<span class="string">&quot;Vip&quot;</span>&gt;</span></span><br><span class="line">        insert into t_vip(id,name,card_number,birth) values(null,#&#123;name&#125;,#&#123;cardNumber&#125;,#&#123;birth&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;select id=&quot;selectAll&quot; resultType=&quot;com.powernode.springboot.bean.Vip&quot;&gt;&lt;/select&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Vip&quot;</span>&gt;</span></span><br><span class="line">        select * from t_vip</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>配置文件起别名：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mybatis相关配置</span></span><br><span class="line"><span class="comment"># 1. 起别名</span></span><br><span class="line"><span class="attr">mybatis.type-aliases-package</span>=<span class="string">com.powernode.springboot.bean</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mybatis相关配置</span></span><br><span class="line"><span class="comment"># 1. 起别名</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.powernode.springboot.bean</span></span><br></pre></td></tr></table></figure><p>写个VipService接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">VipService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存会员信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> vip  会员信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true表示成功,false表示失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">save</span><span class="params">(Vip vip)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查看会员列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 会员列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Vip&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>写实现类VipServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VipServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">VipService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="comment">//这里报错是因为vipmapper的接口和xml必须要告诉springboot在哪里，就需要在配置文件加上路径后，再在入口程序加个扫描注解</span></span><br><span class="line">    <span class="keyword">private</span> VipMapper vipMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">save</span><span class="params">(Vip vip)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> vipMapper.insert(vip) == <span class="number">1</span>;<span class="comment">//==1表示成功</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Vip&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> vipMapper.selectAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="添加Mapper的扫描"><a href="#添加Mapper的扫描" class="headerlink" title="添加Mapper的扫描"></a>添加Mapper的扫描</h3><p>上面的VipMapper会有红线，是因为springboot不知道在哪里</p><p>在Spring Boot的入口程序上添加如下的注解，来完成<code>VipMapper</code>接口的扫描：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过这个指定去哪里找Mapper接口（配置Mapper的扫描。）</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &#123;&quot;com.powernode.springboot.repository&quot;&#125;)</span></span><br></pre></td></tr></table></figure><h3 id="告诉MyBatis框架MapperXML文件的位置"><a href="#告诉MyBatis框架MapperXML文件的位置" class="headerlink" title="告诉MyBatis框架MapperXML文件的位置"></a>告诉MyBatis框架MapperXML文件的位置</h3><p>在<code>application.properties</code>配置文件中进行如下配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2. 告诉springboot mapper.xml文件在哪里</span></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:/mapper/*.xml</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2. 告诉springboot，mapper配置文件的位置</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/*.xml</span></span><br></pre></td></tr></table></figure><p>测试整合MyBatis是否成功</p><p>在Spring Boot主入口程序中获取Spring上下文对象<code>ApplicationContext</code>，从Spring容器中获取<code>VipMapper</code>对象，然后调用相关方法进行测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过这个指定去哪里找Mapper接口（配置Mapper的扫描。）</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &#123;&quot;com.powernode.springboot.repository&quot;&#125;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot312MybatisApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> SpringApplication.run(Springboot312MybatisApplication.class, args);</span><br><span class="line">        <span class="comment">// 获取service对象</span></span><br><span class="line">        <span class="type">VipService</span> <span class="variable">vipService</span> <span class="operator">=</span> applicationContext.getBean(VipService.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存会员</span></span><br><span class="line">        <span class="type">Vip</span> <span class="variable">vip1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Vip</span>(<span class="string">&quot;jack1&quot;</span>, <span class="string">&quot;1234567892&quot;</span>, <span class="string">&quot;1999-10-11&quot;</span>);</span><br><span class="line">        vipService.save(vip1);</span><br><span class="line">        <span class="comment">// 保存会员</span></span><br><span class="line">        <span class="type">Vip</span> <span class="variable">vip2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Vip</span>(<span class="string">&quot;lucy1&quot;</span>, <span class="string">&quot;1234567893&quot;</span>, <span class="string">&quot;1999-10-12&quot;</span>);</span><br><span class="line">        vipService.save(vip2);</span><br><span class="line">        <span class="comment">// 查看会员列表</span></span><br><span class="line">        vipService.findAll().forEach(System.out::println);<span class="comment">//用了Lambda表达式</span></span><br><span class="line">        <span class="comment">//数据cardnumber为空是因为数据库叫card_number,vip里叫cardNumber，没对应上，可以在xml起别名，也可以启用自动映射数据库表的列名和bean的属性名</span></span><br><span class="line"></span><br><span class="line">        applicationContext.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试结果：</p><p>![image-20250421183815008](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250421183815008.png)</p><p>测试结果中可以看到<code>cardNumber</code>属性没有赋值成功，原因是：表中的字段名叫做<code>card_number</code>，和实体类<code>Vip</code>的属性名<code>cardNumber</code>对应不上。解决办法两个：</p><ul><li><strong>第一种方式：查询语句使用as关键字起别名，让查询结果列名和实体类的属性名对应上。</strong></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Vip&quot;</span>&gt;</span></span><br><span class="line">  select id,name,card_number as cardNumber,bith from t_vip起别名</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><strong>第二种方式：通过配置自动映射</strong></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3. 启用自动映射数据库表的列名和bean的属性名</span></span><br><span class="line"><span class="attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><p>mapper的xml文件中的sql语句仍然使用<code>*</code>的方式：</p><p>map-underscore-to-camel-case 是一个配置项，主要用于处理数据库字段名与Java对象属性名之间的命名差异。在许多数据库中，字段名通常使用下划线（_）分隔单词，例如 first_name 或 last_name。而在Java代码中，变量名通常使用驼峰式命名法（camel case），如 firstName 和 lastName。</p><p>当使用MyBatis作为ORM框架时，默认情况下它会将SQL查询结果映射到Java对象的属性上。如果数据库中的字段名与Java对象的属性名不一致，那么就需要手动为每个字段指定相应的属性名，或者使用某种方式来自动转换这些名称。</p><p>map-underscore-to-camel-case 这个配置项的作用就是在查询结果映射到Java对象时，自动将下划线分隔的字段名转换成驼峰式命名法。这样可以减少手动映射的工作量，并提高代码的可读性和可维护性。</p><h2 id="Lombok库"><a href="#Lombok库" class="headerlink" title="Lombok库"></a>Lombok库</h2><p>Lombok 是一个 Java 库，它可以通过注解的方式减少 Java 代码中的样板代码。Lombok 自动为你生成构造函数、getter、setter、equals、hashCode、toString 方法等，从而避免了手动编写这些重复性的代码。这不仅减少了出错的机会，还让代码看起来更加简洁。</p><p><strong><font style="color:#DF2A3F;">Lombok只是一个编译阶段的库，能够帮我们自动补充代码，在Java程序运行阶段并不起作用。（因此Lombok库并不会影响Java程序的执行效率）</font></strong></p><h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3><p>在 Maven 的 <code>pom.xml</code> 文件中添加 Lombok 依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.34<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="IDEA中安装Lombok插件"><a href="#IDEA中安装Lombok插件" class="headerlink" title="IDEA中安装Lombok插件"></a>IDEA中安装Lombok插件</h3><p>高版本的IntelliJ IDEA工具默认都是绑定Lombok插件的，不需要再额外安装：</p><h3 id="Lombok-的主要注解"><a href="#Lombok-的主要注解" class="headerlink" title="Lombok 的主要注解"></a>Lombok 的主要注解</h3><p><strong>@Data</strong>：</p><ul><li>等价于 <code>@ToString</code>, <code>@EqualsAndHashCode</code>, <code>@Getter</code>，<code>@Setter</code>, <code>@RequiredArgsConstructor</code>.</li><li>用于生成：必要参数的构造方法、getter、setter、toString、equals 和 hashcode 方法。</li></ul><p><strong>@Getter</strong> &#x2F; <strong>@Setter</strong>：</p><ul><li>分别用于生成所有的 getter 和 setter 方法。</li><li>可以作用于整个类，也可以作用于特定的字段。</li></ul><p><strong>@NoArgsConstructor</strong>：</p><ul><li>生成一个无参构造方法。</li></ul><p><strong>@AllArgsConstructor</strong>：</p><ul><li>生成一个包含所有实例变量的构造器。</li></ul><p><strong>@RequiredArgsConstructor</strong>：</p><ul><li>生成包含所有被 <code>final</code> 修饰符修饰的实例变量的构造方法。被final修饰的变量必须在构造方法执行前手动附上值0</li><li><strong><font style="color:#DF2A3F;">如果没有</font></strong><code>final</code><strong><font style="color:#DF2A3F;">的0实例变量，则自动生成无参数构造方法。</font></strong></li></ul><p><strong>@ToString</strong> &#x2F; <strong>@EqualsAndHashCode</strong>：</p><ul><li>用于生成 toString 和 equals&#x2F;hashCode 方法。</li><li><strong><font style="color:#DF2A3F;">这两个注解都有</font></strong><code>exclude</code><strong><font style="color:#DF2A3F;background-color:#ffffff;">属性，通过这个属性可以定制toString、hashCode、equals方法，也就是不包含的意思</font></strong></li></ul><p><strong><font style="color:#DF2A3F;">注：Lombok只能帮助我们生成无参数构造方法和全参数构造方法，其他定制参数的构造方法无法生成。</font></strong></p><h3 id="如何使用-Lombok？"><a href="#如何使用-Lombok？" class="headerlink" title="如何使用 Lombok？"></a>如何使用 Lombok？</h3><p>创建一个普通的Maven模块来快速测试一下Lombok库的使用：</p><p>![image-20250421185352259](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250421185352259.png)</p><p>添加最新依赖</p><p>在 Java 类中使用 Lombok 提供的注解。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">// 无参数构造方法</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="comment">// 全参数构造方法</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编写测试程序：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建User对象</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">111L</span>);</span><br><span class="line">        user.setName(<span class="string">&quot;jackson&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">20</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建User对象</span></span><br><span class="line">        user = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">120L</span>, <span class="string">&quot;lucy&quot;</span>, <span class="number">30</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Lombok的其他常用注解"><a href="#Lombok的其他常用注解" class="headerlink" title="Lombok的其他常用注解"></a>Lombok的其他常用注解</h3><h4 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h4><p>该注解会给所有属性添加<code>final</code>，给所有属性提供<code>getter</code>方法，自动生成<code>toString</code>、<code>hashCode</code>、<code>equals</code></p><p><strong>通过这个注解可以创建不可变对象。</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试程序：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Customer</span>(<span class="string">&quot;jackson&quot;</span>, <span class="number">20</span>);</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以查看一下字节码，你会发现，@Value注解的作用只会生成：全参数构造方法、getter方法、hashCode、equals、toString方法。（没有setter方法。）</p><h4 id="Builder"><a href="#Builder" class="headerlink" title="@Builder"></a>@Builder</h4><h5 id="GoF23种设计模式之一：建造模式"><a href="#GoF23种设计模式之一：建造模式" class="headerlink" title="GoF23种设计模式之一：建造模式"></a>GoF23种设计模式之一：建造模式</h5><p>建造模式（Builder Pattern）属于创建型设计模式。GoF23种设计模式之一。</p><p>用于解决对象创建时参数过多的问题。它通过将对象的构造过程与其表示分离，使得构造过程可以逐步完成，而不是一次性提供所有参数。建造模式的主要目的是让对象的创建过程更加清晰、灵活和可控。</p><p>简而言之，建造模式用于：</p><ol><li><strong>简化构造过程</strong>：通过逐步构造对象，避免构造函数参数过多。</li><li><strong>提高可读性和可维护性</strong>：让构造过程更加清晰和有序。</li><li><strong>增强灵活性</strong>：允许按需配置对象的不同部分。</li></ol><p>这样可以更方便地创建复杂对象，并且使得代码更加易于理解和维护。</p><h5 id="建造模式的代码"><a href="#建造模式的代码" class="headerlink" title="建造模式的代码"></a>建造模式的代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 建造模式。23种设计模式之一。GoF之一。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="comment">// 一般建造模式的bean属性使用final进行修饰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="comment">// 提供一个私有的全参数的构造方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// getter//不用setter</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通过这个公开的静态方法获取建造器对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PersonBuilder <span class="title function_">builder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PersonBuilder</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 静态的内部类：建造者，属性需要和上面的相同</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PersonBuilder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">        <span class="keyword">public</span> PersonBuilder <span class="title function_">name</span><span class="params">(String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;<span class="comment">//先把参数的String name赋给上面的private String name</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;<span class="comment">//这里的this就是当前的PersonBuilder对象</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> PersonBuilder <span class="title function_">age</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> Person <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(name, age);<span class="comment">//通过这个方法给person的nameage附上值</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> Person.builder()</span><br><span class="line">                .name(<span class="string">&quot;jack&quot;</span>)</span><br><span class="line">                .age(<span class="number">30</span>)</span><br><span class="line">                .build();</span><br><span class="line">        System.out.println(person);</span><br><span class="line">        <span class="comment">//流程是通过person的builder方法获取personbuilder对象，然后去调age和name方法赋值，再调用build方法把传进来的参数新建给person对象</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="使用-Builder注解自动生成建造模式的代码"><a href="#使用-Builder注解自动生成建造模式的代码" class="headerlink" title="使用@Builder注解自动生成建造模式的代码"></a>使用@Builder注解自动生成建造模式的代码</h5><p>该注解可以直接帮助我们生成以上的代码。使用<code>@Builder</code>注解改造以上代码。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span> <span class="comment">// 帮助我们这个类生成符合建造模式的代码。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> Person.builder()</span><br><span class="line">                .name(<span class="string">&quot;jack&quot;</span>)</span><br><span class="line">                .age(<span class="number">30</span>)</span><br><span class="line">                .build();</span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Singular"><a href="#Singular" class="headerlink" title="@Singular"></a>@Singular</h4><p>@Singular注解是辅助@Builder注解的。</p><p>当被建造的对象的属性是一个集合，这个集合属性使用@Singular注解进行标注的话，可以连续调用集合属性对应的方法完成多个元素的添加。如果没有这个注解，则无法连续调用方法完成多个元素的添加。代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span> <span class="comment">// 帮助我们这个类生成符合建造模式的代码。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Singular翻译为：单数。表示一条一条添加</span></span><br><span class="line">    <span class="meta">@Singular(&quot;addPhone&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; phones;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//不加注解的话是先创建一个list集合然后一个一个加进去再赋值</span></span><br><span class="line">        <span class="comment">/*List&lt;String&gt; phones = new ArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">        phones.add(&quot;12345678912&quot;);</span></span><br><span class="line"><span class="comment">        phones.add(&quot;12345678913&quot;);</span></span><br><span class="line"><span class="comment">        phones.add(&quot;12345678914&quot;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        Person person = Person.builder()</span></span><br><span class="line"><span class="comment">                .name(&quot;jack&quot;)</span></span><br><span class="line"><span class="comment">                .age(30)</span></span><br><span class="line"><span class="comment">                .phones(phones)</span></span><br><span class="line"><span class="comment">                .build();</span></span><br><span class="line"><span class="comment">        System.out.println(person);*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//直接就加到list集合里</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> Person.builder()</span><br><span class="line">                .name(<span class="string">&quot;jack&quot;</span>)</span><br><span class="line">                .age(<span class="number">30</span>)</span><br><span class="line">                .addPhone(<span class="string">&quot;12345678912&quot;</span>)</span><br><span class="line">                .addPhone(<span class="string">&quot;12345678913&quot;</span>)</span><br><span class="line">                .addPhone(<span class="string">&quot;12345678914&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Slf4j"><a href="#Slf4j" class="headerlink" title="@Slf4j"></a>@Slf4j</h4><p>Lombok 支持多种日志框架的注解，可以根据你使用的日志框架选择合适的注解。以下是 Lombok 提供的**<font style="color:#DF2A3F;">部分日志注解</font>**及其对应的日志框架：</p><ol><li><code>@Log4j</code>：<ul><li>自动生成一个 <code>org.apache.log4j.Logger</code> 对象。</li><li>适用于 Apache Log4j 1.x 版本。</li></ul></li><li><code>@Slf4j</code>：<ul><li>自动生成一个 <code>org.slf4j.Logger</code> 对象。</li><li>适用于 SLF4J（Simple Logging Facade for Java），这是一种日志门面，可以与多种实际的日志框架（如 Logback、Log4j 等）集成。</li></ul></li><li><code>@Log4j2</code>：<ul><li>自动生成一个 <code>org.apache.logging.log4j.Logger</code> 对象。</li><li>适用于 Apache Log4j 2.x 版本。</li></ul></li></ol><h5 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h5><p>假设我们有一个类 <code>UserService</code>，并且我们想要使用 SLF4J 作为日志框架，我们可以这样使用 <code>@Slf4j</code> 注解：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;保存用户信息....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        userService.saveUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这个例子中，<code>log</code> 是一个静态成员变量，表示一个 <code>org.slf4j.Logger</code> 对象。Lombok 自动生成了这个日志对象，并且你可以直接使用它来进行日志记录。</p><h5 id="选择合适的注解"><a href="#选择合适的注解" class="headerlink" title="选择合适的注解"></a>选择合适的注解</h5><p>选择哪个注解取决于你使用的日志框架。例如：</p><ul><li>如果你使用的是 SLF4J，可以选择 <code>@Slf4j</code>。</li><li>如果你使用的是 Log4j 1.x，可以选择 <code>@Log4j</code>。</li><li>如果你使用的是 Log4j 2.x，可以选择 <code>@Log4j2</code>。</li></ul><h5 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h5><p>确保在使用这些注解之前，已经在项目中引入了相应的日志框架依赖。例如，如果你使用 SLF4J，你需要在项目中添加 SLF4J 的依赖，以及一个具体的日志实现（如 Logback）。对于其他日志框架，也需要相应地添加依赖。</p><h5 id="示例依赖"><a href="#示例依赖" class="headerlink" title="示例依赖"></a>示例依赖</h5><p>如果你使用 Maven 项目，并且选择了 SLF4J + Logback 的组合，可以添加以下依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Slf4j日志规范--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Slf4j日志实现：logback--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="MyBatis逆向生成"><a href="#MyBatis逆向生成" class="headerlink" title="MyBatis逆向生成"></a>MyBatis逆向生成</h2><p>MyBatis逆向工程：使用IDEA插件可以根据数据库表的设计逆向生成MyBatis的Mapper接口 与 MapperXML文件。</p><h3 id="安装插件free-mybatis-tools"><a href="#安装插件free-mybatis-tools" class="headerlink" title="安装插件free mybatis tools"></a>安装插件<code>free mybatis tools</code></h3><p>![image-20250423023425918](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250423023425918.png)</p><h3 id="在IDEA中配置数据源数据库"><a href="#在IDEA中配置数据源数据库" class="headerlink" title="在IDEA中配置数据源数据库"></a>在IDEA中配置数据源数据库</h3><p>然后在里面创建好数据</p><p>![image-20250423030158773](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250423030158773.png)</p><p>![image-20250423030250812](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250423030250812.png)</p><h3 id="使用脚手架创建SpringBoot项目"><a href="#使用脚手架创建SpringBoot项目" class="headerlink" title="使用脚手架创建SpringBoot项目"></a>使用脚手架创建SpringBoot项目</h3><p>添加依赖：mybatis依赖、mysql驱动、Lombok库</p><p>![image-20250423030332658](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250423030332658.png)</p><h3 id="生成MyBatis代码放到SpringBoot项目中"><a href="#生成MyBatis代码放到SpringBoot项目中" class="headerlink" title="生成MyBatis代码放到SpringBoot项目中"></a>生成MyBatis代码放到SpringBoot项目中</h3><p>在表上右键：Mybatis-Generator</p><p>![image-20250423030500952](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250423030500952.png)</p><p>![QQ20250423-033015](.&#x2F;images&#x2F;Spring Boot 3&#x2F;QQ20250423-033015.png)</p><p>代码生成后，如果在IDEA中看不到，这样做（重新从硬盘加载）：</p><p>![image-20250423033134517](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250423033134517.png)</p><p><strong><font style="color:#DF2A3F;">注意：生成的</font></strong><code>VipMapper</code><strong><font style="color:#DF2A3F;">接口上自动添加了</font></strong><code>@Repository</code><strong><font style="color:#DF2A3F;">注解，这个注解没用，删除即可。</font></strong></p><hr><h3 id="编写mybatis相关配置"><a href="#编写mybatis相关配置" class="headerlink" title="编写mybatis相关配置"></a>编写mybatis相关配置</h3><p>application.properties属性文件的配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">springboot3-13-mybatis-gennerator</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#还要告诉配置文件的位置</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/springboot</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">liuqi3711022</span></span><br><span class="line"><span class="comment">#这个不配也可以，默认就是这个spring.datasource.type=com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># mybatis相关配置</span></span><br><span class="line"><span class="attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:/mapper/*.xml</span></span><br><span class="line"><span class="attr">mybatis.type-aliases-package</span>=<span class="string">com.powernode.springboot.bean</span></span><br></pre></td></tr></table></figure><h3 id="编写测试程序"><a href="#编写测试程序" class="headerlink" title="编写测试程序"></a>编写测试程序</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//做包扫描</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.powernode.springboot.repository&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot313MybatisGenneratorApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> SpringApplication.run(Springboot313MybatisGenneratorApplication.class, args);</span><br><span class="line">        <span class="type">VipMapper</span> <span class="variable">vipMapper</span> <span class="operator">=</span> applicationContext.getBean(VipMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">Vip</span> <span class="variable">vip</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Vip</span>(<span class="string">&quot;jack&quot;</span>, <span class="string">&quot;1234567899&quot;</span>, <span class="string">&quot;2000-11-10&quot;</span>);</span><br><span class="line">        vipMapper.insert(vip);</span><br><span class="line"></span><br><span class="line">        <span class="type">Vip</span> <span class="variable">vip2</span> <span class="operator">=</span> vipMapper.selectByPrimaryKey(<span class="number">1L</span>);</span><br><span class="line">        System.out.println(vip2);</span><br><span class="line">        applicationContext.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Vip</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">//因为id是主键自增，不需要生成构造方法，就给其他的手动生成</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String cardNumber;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String birth;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Vip</span><span class="params">(String name, String cardNumber, String birth)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.cardNumber = cardNumber;</span><br><span class="line">        <span class="built_in">this</span>.birth = birth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="整合SpringMVC（SSM整合）"><a href="#整合SpringMVC（SSM整合）" class="headerlink" title="整合SpringMVC（SSM整合）"></a>整合SpringMVC（SSM整合）</h2><p>Spring Boot项目本身就是基于Spring框架实现的。因此SSM整合时，只需要在整合MyBatis框架之后，引入<code>web启动器</code>即可完成SSM整合。</p><h3 id="使用脚手架创建SpringBoot项目-1"><a href="#使用脚手架创建SpringBoot项目-1" class="headerlink" title="使用脚手架创建SpringBoot项目"></a>使用脚手架创建SpringBoot项目</h3><p>![image-20250423193335275](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250423193335275.png)</p><p>添加依赖：web启动器、mybatis启动器、mysql驱动依赖、lombok依赖</p><h3 id="使用free-mybatis-tool插件逆向生成MyBatis代码"><a href="#使用free-mybatis-tool插件逆向生成MyBatis代码" class="headerlink" title="使用free mybatis tool插件逆向生成MyBatis代码"></a>使用<code>free mybatis tool</code>插件逆向生成MyBatis代码</h3><p>![image-20250423193624771](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250423193624771.png)</p><h3 id="整合MyBatis"><a href="#整合MyBatis" class="headerlink" title="整合MyBatis"></a>整合MyBatis</h3><p>编写数据源的配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据源</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/springboot</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">liuqi3711022</span></span><br></pre></td></tr></table></figure><p>编写mapper xml配置文件的位置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mybatis配置</span></span><br><span class="line"><span class="attr">mybatis.type-aliases-package</span>=<span class="string">com.powernode.ssm.bean</span></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:/mapper/*.xml</span></span><br><span class="line"><span class="attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><p>在主入口类上添加<code>@MapperScan</code>注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.powernode.ssm.repository&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot314SsmApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Springboot314SsmApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="编写service-1"><a href="#编写service-1" class="headerlink" title="编写service"></a>编写service</h3><p>编写<code>VipService</code>接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">VipService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据会员的卡号查询会员的信息。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cardNumber 会员的卡号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 会员信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Vip <span class="title function_">findByCardNumber</span><span class="params">(String cardNumber)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编写<code>VipServiceImpl</code>实现类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VipServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">VipService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VipMapper vipMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Vip <span class="title function_">findByCardNumber</span><span class="params">(String cardNumber)</span> &#123;</span><br><span class="line">        <span class="comment">//调用vipmapper里的查询方法，把卡号传进去</span></span><br><span class="line">        <span class="keyword">return</span> vipMapper.selectByCardNumber(cardNumber);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="编写controller"><a href="#编写controller" class="headerlink" title="编写controller"></a>编写controller</h3><p>编写<code>VipController</code>，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VipController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VipService vipService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/detail&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Vip <span class="title function_">detail</span><span class="params">(<span class="meta">@RequestParam(&quot;cn&quot;)</span> String cardNumber)</span>&#123;<span class="comment">//地址写上http://localhost:8080/detail?cn=卡号</span></span><br><span class="line">        <span class="keyword">return</span> vipService.findByCardNumber(cardNumber);<span class="comment">//会返回一个vip然后转成json响应在浏览器</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font style="color:#DF2A3F;">提示：这里使用了RESTFul编程风格，这个内容在SpringMVC课程中已经讲过。忘了的同学可以回头观看一下。</font></p><h3 id="启动服务器测试"><a href="#启动服务器测试" class="headerlink" title="启动服务器测试"></a>启动服务器测试</h3><p>执行SpringBoot项目主入口的main方法，启动Tomcat服务器：</p><p>打开浏览器访问：<a href="http://localhost:8080/detail?cn=1234567893">http://localhost:8080/detail?cn=1234567893</a></p><p>到此为止，SSM框架就集成完毕了，通过这个集成也可以感觉到SpringBoot简化了SSM三大框架的集成。</p><h1 id="第4章-Spring-Boot自动配置"><a href="#第4章-Spring-Boot自动配置" class="headerlink" title="第4章 Spring Boot自动配置"></a>第4章 Spring Boot自动配置</h1><h2 id="自动配置概述"><a href="#自动配置概述" class="headerlink" title="自动配置概述"></a>自动配置概述</h2><h3 id="SpringBoot的两大核心"><a href="#SpringBoot的两大核心" class="headerlink" title="SpringBoot的两大核心"></a>SpringBoot的两大核心</h3><p>Spring Boot 框架的两大核心特性可以概括为“启动器”（Starter）和“自动配置”（Auto-configuration）。</p><ol><li><strong>启动器（Starter）</strong>：<br>Spring Boot 提供了一系列的 Starter POMs，它们是一组预定义的依赖关系。</li></ol><p>当你在项目中引入一个 Starter POM 时，它会自动包含所有必要的 Spring 组件以及合理的默认设置。开发者不需要手动管理复杂的依赖关系，也不需要担心版本冲突的问题，减少了配置上的出错可能。</p><ol start="2"><li><strong>自动配置（Auto-Configuration）</strong>：<br>当添加了特定的 Starter POM 后，Spring Boot 会**<font style="color:#DF2A3F;">根据类路径上存在的 jar 包来自动配置 Bean（自动配置相关组件）（比如：SpringBoot发现类路径上存在mybatis相关的类，例如SqlSessionFactory.class，那么SpringBoot将自动配置mybatis相关的所有Bean。）</font>**。</li></ol><p>如果开发者没有显式地提供任何与特定功能相关的配置，Spring Boot 将使用其默认配置来自动设置这些功能。当然，如果需要的话，用户也可以覆盖这些默认设置。</p><p>这两个特性结合在一起，使得使用 Spring Boot 开发应用程序变得更加简单快速，减少了大量的样板代码和重复配置的工作。<strong><font style="color:#DF2A3F;">让程序员专注业务逻辑的开发，在环境方面耗费最少的时间</font></strong>。</p><h3 id="体会自动配置带来的便捷"><a href="#体会自动配置带来的便捷" class="headerlink" title="体会自动配置带来的便捷"></a>体会自动配置带来的便捷</h3><p>拿SpringBoot集成MyBatis为例。</p><p>以前，在没有SpringBoot框架的时候，我们用Spring集成MyBatis框架，需要进行如下的配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 数据源配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp2.BasicDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mydb&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- SqlSessionFactory --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mapper/*.xml&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.example.model&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Mapper 扫描器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.example.mapper&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 事务管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 开启事务注解 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 扫描 service 层的包 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.example.service&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>通过以上的配置可以看到Spring集成MyBatis的时候，需要手动提供<code>BasicDataSource</code>、<code>SqlSessionFactoryBean</code>、<code>MapperScannerConfigurer</code>、<code>DataSourceTransactionManager</code>等Bean的配置。</p><p>使用了Spring Boot框架之后，这些配置都不需要提供了，SpringBoot框架的自动配置机制可以全部按照默认的方式自动化完成。减少了大量的配置，在环境方面耗费很少的时间，让程序员更加专注业务逻辑的处理。我们只需要在<code>application.yml</code>中提供以下的配置即可：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springboot</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br></pre></td></tr></table></figure><p>spring-boot-starter是springboot框架最核心的启动器，做springboot项目时，这个启动器是必须的，如果创建这个项目的时候没有选择任何启动器，这个时候springboot项目最小配置就必须将spring-boot-starter配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--springboot框架建议以继承父工程的方式引入springboot。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--这个启动器是springboot最核心的启动器。这个启动器是必须引入的。--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--引入任何启动的时候，spring-boot-starter都会关联引入。--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--&lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这个就是web启动器，web启动器会关联引入springboot核心启动器，上面的starter就可以不要了--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="引入web启动器都有哪些组件会准备好"><a href="#引入web启动器都有哪些组件会准备好" class="headerlink" title="引入web启动器都有哪些组件会准备好"></a>引入web启动器都有哪些组件会准备好</h3><p>通过以下代码获取spring ioc容器中的所有注册的bean，一个Bean就是一个组件：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot315AutoConfigurationApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> SpringApplication.run(Springboot315AutoConfigurationApplication.class, args);</span><br><span class="line">        <span class="comment">//从ioc容器中查看有多少组件，将组件的id打印出来，这个方法能获取所有组件的id</span></span><br><span class="line">        String[] allBeanNames = applicationContext.getBeanDefinitionNames();</span><br><span class="line">        <span class="keyword">for</span>(String allBeanName : allBeanNames)&#123;</span><br><span class="line">            System.out.println(allBeanName);</span><br><span class="line">        &#125;</span><br><span class="line">        applicationContext.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在springboot没有引入任何启动器的情况下，默认提供了<code>59</code>bean</p><p>引入web启动器可以发现，ioc容器中注册的bean总数量为<code>160</code>个</p><p>也就是说，引入了<code>web启动器</code>后，ioc容器中增加了<code>101</code>个bean对象（<strong><font style="color:#DF2A3F;">加入了101个组件</font></strong>）。这<code>101</code>个bean对象都是为web开发而准备的，例如我们常见的：</p><ul><li>dispatcherServlet：DispatcherServlet 是 Spring MVC 的前端控制器，负责接收所有的 HTTP 请求，并将请求分发给适当的处理器（Controller）</li><li>viewResolver：ViewResolver 是 Spring MVC 中用于将逻辑视图名称解析为实际视图对象的组件。它的主要作用是根据控制器返回的视图名称，找到对应的视图实现（如 JSP、Thymeleaf、Freemarker 等），并返回给 DispatcherServlet 用于渲染视图。</li><li>characterEncodingFilter：字符集过滤器组件，专门处理字符集，解决请求和响应的乱码问题。</li><li>mappingJackson2HttpMessageConverter：负责处理消息转换的组件。它可以将json字符串转换成java对象，也可以将java对象转换为json字符串。</li><li>……</li></ul><p>每一个组件都有它特定的功能。</p><p>没有使用SpringBoot之前，以上的很多组件都是需要手动配置的。</p><h3 id="默认的包扫描规则"><a href="#默认的包扫描规则" class="headerlink" title="默认的包扫描规则"></a>默认的包扫描规则</h3><p>之前我们已经说过并且测试过：springboot默认情况下只扫描<code>主入口类</code>所在包及子包下的类。</p><p>这是因为<code>@SpringBootApplication</code>注解被<code>@ComponentScan</code>标注，代替spring以前的这个配置：<code>&lt;context:component-scan base-packages=&quot;主入口类所在包&quot;/&gt;</code></p><p>当然，我们也可以打破这个规则，通过以下两种方式：</p><ul><li>第一种：@SpringBootApplication(scanBasePackages &#x3D; “com”)</li><li>第二种：@ComponentScan(“com”)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@SpringBootApplication里面集成了这三个注解，componentscan是负责包扫描的，指定这个包下所有的bean可以被加载</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com&quot;)</span></span><br><span class="line"><span class="comment">//@SpringBootApplication(scanBasePackages = &quot;com&quot;)//将扫描包的范围设定为从com包下开始</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot315AutoConfigurationApplication</span> &#123;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="默认配置"><a href="#默认配置" class="headerlink" title="默认配置"></a>默认配置</h3><p>springboot为功能的实现提供了非常多的默认配置.</p><p>例如：tomcat服务器端口号在没有配置的情况下，默认是<code>8080</code></p><p>当然，也可以在<code>application.properties</code>文件中进行重新配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8081</span></span><br></pre></td></tr></table></figure><p>再如，配置thymeleaf的模板引擎时，默认的模板引擎前缀是<code>classpath:/templates/</code>，默认的后缀是<code>.html</code></p><p>当然，也可以重新配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.thymeleaf.prefix</span>=<span class="string">classpath:/templates/</span></span><br><span class="line"><span class="attr">spring.thymeleaf.suffix</span>=<span class="string">.html</span></span><br></pre></td></tr></table></figure><p>通过创建脚手架时引入wen启动器会自动创建static（放置静态资源js图片）和templates（放置thymeleaf模版引擎下的xxx.html）</p><p>这些配置最终都会通过<code>@ConfigurationProperties(prefix=&quot;&quot;)</code>注解绑定到对应的bean的属性上。这个Bean我们一般称为<code>属性类</code>。例如：</p><p><code>ServerProperties</code>：服务器属性类，专门负责配置服务器相关信息。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;server&quot;, ignoreUnknownFields = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerProperties</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p><code>ThymeleafProperties</code>：Thymeleaf属性类，专门负责配置Thymeleaf模板引擎的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.thymeleaf&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThymeleafProperties</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>SpringBoot官方文档当中也有指导，告诉你都有哪些<code>属性类</code>，告诉你在<code>application.properties</code>中都可以配置哪些东西。默认值都是什么：</p><p>![image-20250424141751278](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250424141751278.png)</p><h3 id="自动配置是按需加载的"><a href="#自动配置是按需加载的" class="headerlink" title="自动配置是按需加载的"></a>自动配置是按需加载的</h3><p>SpringBoot提供了非常多的自动配置类，有的是<code>web</code>相关的自动配置，有的是<code>mail</code>相关的自动配置。但是这些自动配置并不是全部生效，它是按需加载的。<strong><font style="color:#DF2A3F;">导入了哪个启动器，则该启动器对应的自动配置类才会被加载</font></strong>。</p><p>这些自动配置类在哪里？</p><p>任何启动器都会关联引入这样一个启动器：<code>spring-boot-starter</code>，它是springboot框架最核心的启动器。</p><p><code>spring-boot-starter</code>又关联引入了<code>spring-boot-autoconfigure</code>。所有的自动配置类都在这里。</p><p>![image-20250424165037627](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250424165037627.png)</p><p>![image-20250424164959922](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250424164959922.png)</p><h3 id="SpringBoot框架提供的条件注解"><a href="#SpringBoot框架提供的条件注解" class="headerlink" title="SpringBoot框架提供的条件注解"></a>SpringBoot框架提供的条件注解</h3><p>如何做到按需加载的，依靠SpringBoot框架中的条件注解来实现的。</p><p>Spring Boot框架中的@ConditionalOnXxx系列注解属于条件注解（Conditional Annotations），它们用于基于某些条件来决定是否应该创建一个或一组Bean。这些注解通常用在自动配置类上，以确保只有在特定条件满足时才会应用相应的配置。</p><p>这里是一些常见的@ConditionalOnXxx注解及其作用：</p><ul><li>@ConditionalOnClass：当指定的类存在时，才创建Bean。</li><li>@ConditionalOnMissingClass：当指定的类不存在时，才创建Bean。</li><li>@ConditionalOnBean：当容器中存在指定的Bean时，才创建Bean。</li><li>@ConditionalOnMissingBean：当容器中不存在指定的Bean时，才创建Bean。</li><li>@ConditionalOnProperty：当配置文件中存在指定的属性时，才创建Bean。也可以设置属性值需要匹配的值。</li><li>@ConditionalOnResource：当指定的资源存在时，才创建Bean。</li><li>@ConditionalOnWebApplication：当应用程序是Web应用时，才创建Bean。</li><li>@ConditionalOnNotWebApplication：当应用程序不是Web应用时，才创建Bean。</li></ul><p>使用这些注解可以帮助开发者根据不同的运行环境或配置来灵活地控制Bean的创建，从而实现更智能、更自动化的配置过程。这对于构建可插拔的模块化系统特别有用，因为可以根据实际需求选择性地启用或禁用某些功能。</p><p>假设我们来实现这样一个功能：如果IoC容器当中**<font style="color:#DF2A3F;">存在ABean</font>**<code>，就创建</code>B&#96;Bean，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> A <span class="title function_">test1</span><span class="params">()</span>&#123;<span class="comment">// 方法的名字作为bean name</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果IoC容器中存在A类型的Bean对象时创建b</span></span><br><span class="line">    <span class="meta">@ConditionalOnBean(A.class)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> B <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">B</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@SpringBootApplication里面集成了这三个注解，componentscan是负责包扫描的，指定这个包下所有的bean可以被加载</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com&quot;)</span></span><br><span class="line"><span class="comment">//@SpringBootApplication(scanBasePackages = &quot;com&quot;)//将扫描包的范围设定为从com包下开始</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot315AutoConfigurationApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> SpringApplication.run(Springboot315AutoConfigurationApplication.class, args);</span><br><span class="line">        <span class="comment">//从ioc容器中查看有多少组件，将组件的id打印出来，这个方法能获取所有组件的id</span></span><br><span class="line">        String[] allBeanNames = applicationContext.getBeanDefinitionNames();</span><br><span class="line">        <span class="keyword">for</span>(String allBeanName : allBeanNames)&#123;</span><br><span class="line">            <span class="comment">//System.out.println(allBeanName);</span></span><br><span class="line">            <span class="comment">/*if(allBeanName.equals(&quot;appBean&quot;))&#123;</span></span><br><span class="line"><span class="comment">                System.out.println(allBeanName);</span></span><br><span class="line"><span class="comment">            &#125;*/</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;test1&quot;</span>.equals(allBeanName))&#123;</span><br><span class="line">                System.out.println(allBeanName);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;test2&quot;</span>.equals(allBeanName)) &#123;</span><br><span class="line">                System.out.println(allBeanName);<span class="comment">//输出test1 test2</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        applicationContext.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果IoC容器当中**<font style="color:#DF2A3F;">不存在Bean</font>**<code>，就创建</code>B&#96;Bean，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> A <span class="title function_">a</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(A.class)</span><span class="comment">//输出test1，因为存在所以不创建</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> B <span class="title function_">b</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">B</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当类路径当中存在<code>DispatcherServlet</code>类，则启用配置，反之则不启用配置，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当类路径中存在DispatcherServlet这个类时配置生效</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(name = &#123;&quot;org.springframework.web.servlet.DispatcherServlet&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> A <span class="title function_">getA</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上程序自行测试！</p><h2 id="自动配置实现原理"><a href="#自动配置实现原理" class="headerlink" title="自动配置实现原理"></a>自动配置实现原理</h2><p>我们来深入的分析一个问题：为什么导入<code>web启动器</code>，web开发相关的自动配置就会生效？</p><h3 id="在程序没有开始执行之前都导入了哪些依赖"><a href="#在程序没有开始执行之前都导入了哪些依赖" class="headerlink" title="在程序没有开始执行之前都导入了哪些依赖"></a>在程序没有开始执行之前都导入了哪些依赖</h3><p>在程序没有开始运行之前，我们先来分析一下，当导入<code>web启动器</code>之后，底层都一连串的导入了哪些依赖！</p><ol><li>从这里开始：导入了<code>spring-boot-starter-web</code>【web启动器】</li><li>然后关联导入了<code>spring-boot-starter</code>、<code>spring-boot-starter-json</code>、<code>spring-boot-starter-tomcat</code>、<code>spring-web</code>、<code>spring-webmvc</code><ol><li>注意：<code>spring-boot-starter</code>是springboot核心启动器，任何启动器在导入时，都会关联导入springboot核心启动器。</li></ol></li><li>核心启动器导入之后，关联导入了一个jar包：<code>spring-boot-autoconfigure</code>。<ol><li>注意：这个jar包中存放的是springboot框架**<font style="color:#DF2A3F;">官方支持的自动配置类</font>**。如下图：</li></ol></li></ol><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731120167649-5b43660e-d911-4af1-b609-7ba357483cbb.png)</p><ol start="2"><li>官方支持的自动配置类有多少个呢，可以通过下图位置查看：</li></ol><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731120316690-38e92299-860c-4f52-8e90-93773af32190.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731120338604-18c536ab-a98f-4ba7-adf3-10f47f02056d.png)</p><p>得知<code>springboot3.3.5</code>这个版本共<code>152</code>个自动配置类。自动配置类的命名规则是<code>XxxxAutoConfiguration</code>。</p><p><strong><font style="color:#DF2A3F;">提示：哪个自动配置类生效，就代表哪个配置文件生效，那么对应的技术就完成了整合，就可以进行对应技术的开发。</font></strong></p><h3 id="从main方法开始执行之后都发生了什么"><a href="#从main方法开始执行之后都发生了什么" class="headerlink" title="从main方法开始执行之后都发生了什么"></a>从main方法开始执行之后都发生了什么</h3><p>以上分析的是在项目结构上已经完成了相关依赖的导入，这些自动配置了导入到了项目当中，那么在运行时哪些自动配置类会被加载？哪些自动配置类会生效呢？我们接下来进行程序运行阶段的分析：</p><ol><li><p>程序从main方法进入执行，主入口类上使用<code>@SpringBootApplication</code>进行了标注。</p></li><li><p><code>@SpringBootApplication</code>注解是复合注解，代表以下三个注解的功能：</p><ol><li><code>@SpringBootConfiguration</code>：它被<code>@Configuration</code>标注，说明主入口类就是一个配置类，此时该配置开始加载。</li><li><code>@ComponentScan</code>：默认扫描的是主入口所在包以及子包。因此<code>spring-boot-autoconfigure</code>包是扫描不到的，按说<code>XxxAutoConfiguration</code>自动配置类是无法加载的！！！那么这些自动配置类又是如何加载和生效的呢？</li><li><code>@EnableAutoConfiguration</code>：自动配置类的加载和生效全靠它了。该注解被翻译为：启用自动配置。如果后面加上(excludeName&#x3D; {“A”, “B”})，就会排除这些不去自动配置</li></ol></li><li><p><code>@EnableAutoConfiguration</code>被<code>@Import(AutoConfigurationImportSelector.class)</code>标注</p><ol><li><code>@Import(AutoConfigurationImportSelector.class)</code>的作用是：将<code>AutoConfigurationImportSelector</code>作为一个Bean加载到IoC容器中。</li><li>这个Bean的作用是：负责收集和选择所有符合条件的自动配置类。</li></ol></li><li><p>添加断点，跟踪<code>AutoConfigurationImportSelector</code>源码：</p><p>![image-20250426163012567](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250426163012567.png)</p><p>通过跟踪得知，这<code>152</code>个自动配置类的<strong>类名</strong>都会被加载到IoC容器中。<strong><font style="color:#DF2A3F;">注意：加载了152，并不是152个全部生效</font></strong>。</p><p>如果给</p></li><li><p>这<code>152</code>个自动配置类底层是怎么查找的？</p><p>点击这里</p><p>![image-20250426163734714](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250426163734714.png)</p><p>![image-20250426163759149](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250426163759149.png)</p><p>这里的load返回一个list集合，然后这个方法把这个集合return，点进去load方法</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250426164956281.png)</p><p>这里可以看到后面是一个class类，也就是上面的AutoConfiguration.class</p><p>通过以上源码跟踪，得知，是从下图位置加载的：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731120316690-38e92299-860c-4f52-8e90-93773af32190-1745657467970-10.png)</p><p>最先获取到<code>152</code>个，经过上图的一层一层的过滤（<strong>条件注解</strong>），<strong><font style="color:#DF2A3F;">最终筛选了</font></strong><code>26</code><strong><font style="color:#DF2A3F;">个自动配置类，为什么这么少，因为你只引入了</font></strong><code>web starter</code><strong><font style="color:#DF2A3F;">。这26个配置就是做web开发需要的最少配置</font></strong></p></li></ol><p><strong>具体怎么排除的，请看以下解释：</strong></p><ul><li>configurations &#x3D; removeDuplicates(configurations);</li></ul><p>   去重：移除 configurations 列表中的重复项，确保每个配置类只出现一次。</p><ul><li>Set<String> exclusions &#x3D; getExclusions(annotationMetadata, attributes);</li></ul><p>   获取排除列表：从注解元数据和属性中获取需要排除的配置类名称集合。因为<code>@EnableAutoConfiguration</code>注解还能这么用：<code>@EnableAutoConfiguration(exclude = {排除列表}, excludeName = {排除列表})</code></p><ul><li>checkExcludedClasses(configurations, exclusions);</li></ul><p>   检查排除：验证 configurations 中是否有被排除的类，如果有，可能会抛出异常或记录警告。</p><ul><li>configurations.removeAll(exclusions);</li></ul><p>   移除排除项：从 configurations 列表中移除所有在 exclusions 集合中的配置类。</p><ul><li>configurations &#x3D; getConfigurationClassFilter().filter(configurations);</li></ul><p>   过滤配置类：使用 ConfigurationClassFilter 对 configurations 进行进一步过滤。<strong>这一行通过条件注解进行判断</strong>，例如 @ConditionalOnClass、@ConditionalOnMissingBean 等。</p><ul><li>fireAutoConfigurationImportEvents(configurations, exclusions);</li></ul><p>   触发事件：触发自动配置导入事件，通知其他组件或监听器关于最终确定的配置类和排除的类。</p><h3 id="自动配置类都干了啥"><a href="#自动配置类都干了啥" class="headerlink" title="自动配置类都干了啥"></a>自动配置类都干了啥</h3><p><strong><font style="color:#DF2A3F;">自动配置类导入了一堆相关的组件（一个组件一个功能），而每个组件获取配置时都是从属性类中获取，而属性类恰好又和配置文件绑定。</font></strong></p><p>以<code>DispatcherServletAutoConfiguration</code>自动配置类为例，这个自动配置类主要是配置了SpringMVC中的前端控制器。</p><p>请看源码：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731133277010-5db32db6-3577-48c2-8238-4f845b273a46.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1745658496978-14.png)</p><p>通过以上源码得知，<code>DispatcherServletConfiguration</code>组件的配置信息来源于<code>WebMvcProperties</code>属性类。<code>WebMvcProperties</code>类源码如下：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731133562874-9017d21b-32e6-488d-a4c8-6726fa7b0a89.png)</p><p>通过以上源码又得知，要对<code>DispatcherServletConfiguration</code>进行配置的话，应该在<code>application.properties</code>中使用这样的前缀配置：<code>spring.mvc....</code></p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1745658496978-14.png)</p><p>再来看<code>嵌入式Web服务器工厂自定义程序自动配置</code>：<code>EmbeddedWebServerFactoryCustomizerAutoConfiguration</code>，通俗讲：通过它可以配置web服务器。</p><p>请看源码：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731134006487-d1331ac9-1145-4d52-aed3-e9b60cdc810e.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1745658496978-14.png)</p><p>只要加了@EnableConfigurationProperties()就会在ioc容器中创建serverProperties对象，这个bean就有了，然后把application.Properties的配置信息绑定到serverProperties对象，在application文件中有很多配置，以什么前缀的配置绑定这个对象属性上呢？</p><p>![image-20250426185717384](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250426185717384.png)</p><p>就是以server开头的，比如server.port&#x3D;8081,8081就会赋给port</p><p>通过以上源码得知，这个自动配置类中也有很多组件，有tomcat组件，有jetty组件。单独看Tomcat，要配置Tomcat服务器，需要参照<code>ServerProperties</code>属性类，打开源码看看：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731134070889-7a8b5378-c3bf-4b3f-8fb4-0b70a37e4938.png)</p><p>因此配置Tomcat服务器需要在<code>application.properties</code>文件中使用这样的前缀配置：<code>server.</code></p><h3 id="总结自动配置原理"><a href="#总结自动配置原理" class="headerlink" title="总结自动配置原理"></a>总结自动配置原理</h3><ol><li>运行环境准备阶段<ol><li>引入web启动器</li><li>最终传递引入了自动配置的jar包</li><li>自动配置的jar包中有152个自动配置类，到此运行环境准备完毕。</li></ol></li><li>运行阶段<ol><li>@EnableAutoConfiguration 启用自动配置，将152个自动配置类全部加载到IoC容器中，然后根据开发场景筛选出必须的自动配置类。</li><li>自动配置类加载了一堆组件。</li><li>每个组件需要的数据来自属性类。</li><li>属性类又和配置文件绑定在一起。</li></ol></li><li>因此，最终一句话：导入启动器，修改配置文件，就可以完成对应功能的开发。</li></ol><h1 id="第5章-Spring-Boot的web开发"><a href="#第5章-Spring-Boot的web开发" class="headerlink" title="第5章 Spring Boot的web开发"></a>第5章 Spring Boot的web开发</h1><h2 id="SpringBoot的web自动配置"><a href="#SpringBoot的web自动配置" class="headerlink" title="SpringBoot的web自动配置"></a>SpringBoot的web自动配置</h2><p>http请求协议：browser—&gt;Server，http相应协议Server—&gt;browser</p><p>新建项目<code>sb3-09-web</code>：添加web启动器，添加Lombok依赖。</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729842528256-345582ac-9fbe-464f-9d1a-3ee7800bea8a.png)</p><h3 id="web自动配置的依赖是如何传递的（这一部分视频没讲解，随便看看）"><a href="#web自动配置的依赖是如何传递的（这一部分视频没讲解，随便看看）" class="headerlink" title="web自动配置的依赖是如何传递的（这一部分视频没讲解，随便看看）"></a>web自动配置的依赖是如何传递的（这一部分视频没讲解，随便看看）</h3><ol><li>首先引入了<code>web启动器</code>，如下：</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li><code>web启动器</code>传递引入了<code>spring-boot-starter</code>，如下：</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1745860695540-1.png)</p><ol start="3"><li><code>spring-boot-starter</code>会传递引入一个<code>spring-boot-autoconfigure</code>包，如下：</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729843303324-6c665ade-1fc3-465c-b11b-0ac167c5bd4c.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1745860695540-1.png)</p><ol start="4"><li>在<code>spring-boot-autoconfigure</code>包中的<code>.imports</code>文件中罗列的需要导入的自动配置类，如下图：</li></ol><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729843518728-be8a441f-d6cc-4781-8f0e-a3c67a05b697.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1745860695540-1.png)</p><h4 id="web自动配置的实现原理"><a href="#web自动配置的实现原理" class="headerlink" title="web自动配置的实现原理"></a>web自动配置的实现原理</h4><ol><li>从入口程序开始：</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.sb309web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sb309WebApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Sb309WebApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1745860695540-1.png)</p><p>入口程序被<code>@SpringBootApplication</code>注解标注。</p><ol start="2"><li><code>@SpringBootApplication</code>注解被<code>@EnableAutoConfiguration</code><font style="color:#080808;background-color:#ffffff;">注解标注。表示启用自动配置。</font></li><li><code>@EnableAutoConfiguration</code><font style="color:#080808;background-color:#ffffff;">注解被</font><code>@Import({AutoConfigurationImportSelector.class})</code><font style="color:#080808;background-color:#ffffff;">注解标注。</font></li><li><font style="color:#080808;background-color:#ffffff;">因此</font><code>AutoConfigurationImportSelector</code><font style="color:#080808;background-color:#ffffff;">决定哪些自动配置类是需要导入的。</font></li><li><code>&lt;font style=&quot;color:#080808;background-color:#ffffff;&quot;&gt;AutoConfigurationImportSelector&lt;/font&gt;</code><font style="color:#080808;background-color:#ffffff;">底层实现步骤具体如下：</font></li></ol><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729845866175-609a5c89-9342-4d96-b624-fcc5a7dc2434.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729845887890-372b80d6-2e7c-4d7e-8c5c-40cc3402da91.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1745860695540-1.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729845909271-f6640224-ae46-4d74-bea2-ff00fa4e95d7.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729845939380-9158c6fe-9ac2-43e3-8b4a-fb9b568eefd3.png)</p><p>最终找的文件是：<code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code></p><p><strong>注意：任何jar包，包括第三方的依赖，自动配置类所在的路径以及文件名都是完全相同的，都是</strong><code>**META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports**</code></p><p>例如mybatis的自动配置类的列表文件也是这样，如下图：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729846670846-84850d75-8a0f-418c-8c64-f48f00f3e738.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1745860695540-1.png)</p><h4 id="通过web自动配置类逆推web配置的prefix"><a href="#通过web自动配置类逆推web配置的prefix" class="headerlink" title="通过web自动配置类逆推web配置的prefix"></a>通过web自动配置类逆推web配置的prefix</h4><p>在自动配置列表中找到web自动配置相关的类：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729846834747-246f3a88-f822-46bc-a00c-7770d52c5c26.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1745860695540-1.png)</p><p>以下就是web自动配置类列表：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration</span><br></pre></td></tr></table></figure><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1745860695540-1.png)</p><p>通过web自动配置类的源码可以逆推web配置的prefix：</p><ol><li>WebMvcAutoConfiguration</li></ol><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729847170017-0f711f67-f266-4ac2-a25a-c239475b38fe.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729847235858-7cab9d78-465f-4289-be9c-9b399570e8d3.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729847268539-715a377a-ecb9-48fc-ad58-9194d23b7cdf.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1745860695540-1.png)</p><ol start="2"><li>MultipartAutoConfiguration</li></ol><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729847417032-2abad318-a48b-49a7-a2dc-26abd0f4d8e5.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729847475254-4f486638-6132-40c0-baee-25c4c3091f49.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1745860695540-1.png)</p><ol start="3"><li>HttpEncodingAutoConfiguration</li></ol><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729847580938-8114e69c-ba29-4305-ba80-3b0d277be2e1.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1729847644668-2d8aa37a-699d-4009-92c7-3c9a60efcb49.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1745860695540-1.png)</p><ol start="4"><li>ErrorMvcAutoConfiguration</li><li>ServletWebServerFactoryAutoConfiguration</li><li>DispatcherServletAutoConfiguration</li><li>EmbeddedWebServerFactoryCustomizerAutoConfiguration</li><li>RestTemplateAutoConfiguration</li></ol><p>通过查看源码，得知，web开发时，在<code>application.properties</code>配置文件中可以配置的前缀是：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SpringMVC相关配置</span></span><br><span class="line"><span class="attr">spring.mvc.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># web开发通用配置</span></span><br><span class="line"><span class="attr">spring.web.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 文件上传配置</span></span><br><span class="line"><span class="attr">spring.servlet.multipart.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 服务器配置</span></span><br><span class="line"><span class="attr">server.</span></span><br></pre></td></tr></table></figure><h3 id="Web自动配置都默认配置了什么"><a href="#Web自动配置都默认配置了什么" class="headerlink" title="Web自动配置都默认配置了什么"></a>Web自动配置都默认配置了什么</h3><p>查看官方文档：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731383415638-90d102e9-1fd0-4f31-9736-9e3bef3936d3.png)</p><p><strong>翻译如下：</strong></p><p>Spring Boot 为 Spring MVC 提供了自动配置，这在大多数应用程序中都能很好地工作。除了已经实现了 Spring MVC 的默认功能外，自动配置还提供了以下特性：</p><ul><li>包括 <code>ContentNegotiatingViewResolver</code> 和 <code>BeanNameViewResolver</code> 的 Bean。<ul><li><code>ContentNegotiatingViewResolver</code> 自动根据HTTP请求头中Accept字段来选择合适的视图技术渲染响应。</li><li><code>&lt;font style=&quot;color:rgb(44, 44, 54);&quot;&gt;BeanNameViewResolver&lt;/font&gt;</code><font style="color:rgb(44, 44, 54);"> 的作用是根据视图名称找到视图View对象。</font></li></ul></li><li>支持提供静态资源，包括对 WebJars的支持。<ul><li>静态资源路径默认已经配置好了。默认会去static目录下找。</li></ul></li><li>自动注册 <code>Converter</code>、<code>GenericConverter</code> 和 <code>Formatter</code> 的 Bean。<ul><li><code>Converter</code>：转换器，做类型转换的，例如表单提交了用户数据，将表单数据转换成User对象。</li><li><code>Formatter</code>：格式化器，做数据格式化的，例如将Java中的<code>日期类型对象</code>格式化为<code>特定格式的日期字符串</code>。或者将用户提交的日期字符串，转换为Java中的日期对象。</li></ul></li><li>支持 <code>HttpMessageConverters</code>。<ul><li>内置了很多的HTTP消息转换器。例如：<code>MappingJackson2HttpMessageConverter</code>可以将json转换成java对象，也可以将java对象转换为json字符串。</li></ul></li><li>自动注册 <code>MessageCodesResolver</code>。<ul><li>SpringBoot会自动注册一个默认的<code>消息代码解析器</code></li><li>帮助你在表单验证出错时生成一些特殊的代码。这些代码让你能够更精确地定位问题，并提供更友好的错误提示。</li></ul></li><li>静态 <code>index.html</code> 文件支持。<ul><li>Spring Boot 会自动处理位于项目静态资源目录下的 index.html 文件，使其成为应用程序的默认主页</li></ul></li><li>自动使用 <code>ConfigurableWebBindingInitializer</code> Bean。<ul><li>用它来指定默认使用哪个转换器，默认使用哪个格式化器。在这个类当中都已经配好了。</li></ul></li></ul><p>如果您不想使用自动配置并希望完全控制 Spring MVC，可以添加您自己的带有 <code>**&lt;font style=&quot;color:#DF2A3F;&quot;&gt;@EnableWebMvc&lt;/font&gt;**</code> 注解的 <code>@Configuration</code>。</p><p>如果您希望保留这些 Spring Boot MVC 定制化设置并进行更多的 MVC 定制化（如拦截器、格式化程序、视图控制器等其他功能），可以添加您自己的类型为 <code>WebMvcConfigurer</code> 的 <code>@Configuration</code> 类。<strong><font style="color:#DF2A3F;">但不能使用</font></strong><code>@EnableWebMvc</code><strong><font style="color:#DF2A3F;">注解</font></strong>。</p><h3 id="WebMvcAutoConfiguration原理"><a href="#WebMvcAutoConfiguration原理" class="headerlink" title="WebMvcAutoConfiguration原理"></a><font style="color:#080808;background-color:#ffffff;">WebMvcAutoConfiguration原理</font></h3><p>通过源码分析的方式，学习WebMvc的自动配置原理。</p><h4 id="WebMvc自动配置是否生效的条件"><a href="#WebMvc自动配置是否生效的条件" class="headerlink" title="WebMvc自动配置是否生效的条件"></a>WebMvc自动配置是否生效的条件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration(after = &#123; DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">ValidationAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span></span><br><span class="line"><span class="meta">@ImportRuntimeHints(WebResourcesRuntimeHints.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> &#123;&#125;</span><br></pre></td></tr></table></figure><ul><li>@AutoConfiguration(after &#x3D; { DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,ValidationAutoConfiguration.class })<ul><li><strong>WebMvcAutoConfiguration自动配置类</strong>加载顺序在以上自动配置类加载后加载。</li></ul></li><li>@ConditionalOnWebApplication(type &#x3D; Type.SERVLET)<ul><li><strong>WebMvcAutoConfiguration自动配置类</strong>只在servlet环境中生效。</li></ul></li><li>@ConditionalOnClass({ Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class })<ul><li>类路径中必须存在<code>Servlet.class``DispatcherServlet.class``WebMvcConfigurer.class</code>，<strong>WebMvcAutoConfiguration自动配置类才会生效。</strong></li></ul></li><li>@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)<ul><li>类路径中不存在<code>WebMvcConfigurationSupport.class</code>时<strong>WebMvcAutoConfiguration自动配置类才会生效。</strong></li><li>注意：当使用@EnableWebMvc注解后，类路径中就会注册一个WebMvcConfigurationSupport这样的bean。</li></ul></li><li>@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10) <strong>不重要</strong><ul><li>指定<strong>WebMvcAutoConfiguration自动配置类</strong>的加载顺序</li></ul></li><li>@ImportRuntimeHints(WebResourcesRuntimeHints.class) <strong>不重要</strong><ul><li>运行时引入<strong>WebResourcesRuntimeHints</strong>这个类，这个类的作用是给JVM或者其他组件提示信息的，提示一下系统应该如何处理类和资源。</li></ul></li></ul><p>总结来说，WebMvcAutoConfiguration类将在以下条件下生效：</p><ol><li>应用程序是一个Servlet类型的Web应用；</li><li>环境中有Servlet、DispatcherServlet和WebMvcConfigurer类；</li><li>容器中没有WebMvcConfigurationSupport的bean。</li></ol><p>如果这些条件都满足的话，那么这个自动配置类就会被激活，并进行相应的自动配置工作。</p><h4 id="WebMvc自动配置生效后引入了两个Filter-Bean"><a href="#WebMvc自动配置生效后引入了两个Filter-Bean" class="headerlink" title="WebMvc自动配置生效后引入了两个Filter Bean"></a>WebMvc自动配置生效后引入了两个Filter Bean</h4><h5 id="引入了HiddenHttpMethodFilter-Bean"><a href="#引入了HiddenHttpMethodFilter-Bean" class="headerlink" title="引入了HiddenHttpMethodFilter Bean"></a>引入了<font style="color:#080808;background-color:#ffffff;">HiddenHttpMethodFilter Bean</font></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(HiddenHttpMethodFilter.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc.hiddenmethod.filter&quot;, name = &quot;enabled&quot;)</span></span><br><span class="line"><span class="keyword">public</span> OrderedHiddenHttpMethodFilter <span class="title function_">hiddenHttpMethodFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderedHiddenHttpMethodFilter</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个过滤器是专门处理Rest请求的。GET POST PUT DELETE请求。</p><h5 id="引入了FormContentFilter-Bean"><a href="#引入了FormContentFilter-Bean" class="headerlink" title="引入了FormContentFilter Bean"></a>引入了<font style="color:#080808;background-color:#ffffff;">FormContentFilter Bean</font></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(FormContentFilter.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc.formcontent.filter&quot;, name = &quot;enabled&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">public</span> OrderedFormContentFilter <span class="title function_">formContentFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderedFormContentFilter</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>OrderedFormContentFilter 是 Spring Boot 中用于处理 HTTP 请求的一个过滤器，特别是针对 PUT 和 DELETE 请求。这个过滤器的主要作用是在处理 PUT 和 DELETE 请求时，确保如果请求体中有表单格式的数据，这些数据会被正确解析并可用。</p><p>比如get请求是在请求行上提交数据，post请求正常在请求体中提交数据，put和delete如果请求体当中有form表单数据提交</p><h4 id="WebMvc自动配置生效后引入了WebMvcConfigurer接口的实现类"><a href="#WebMvc自动配置生效后引入了WebMvcConfigurer接口的实现类" class="headerlink" title="WebMvc自动配置生效后引入了WebMvcConfigurer接口的实现类"></a>WebMvc自动配置生效后引入了WebMvcConfigurer接口的实现类</h4><p>在SpringBoot框架的<code>WebMvcAutoConfiguration</code>类中提供了一个内部类：<code>WebMvcAutoConfigurationAdapter</code></p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730345630650-62e11666-3e95-4c64-9787-c0b18d083c91.png)</p><p>SpringBoot在这个类<code>WebMvcAutoConfigurationAdapter</code>中进行了一系列的Spring MVC相关配置。</p><p><strong><font style="color:#DF2A3F;">我们开发中要对Spring MVC的相关配置进行修改，可以编写一个类继承</font></strong><code>WebMvcAutoConfigurationAdatper</code><strong><font style="color:#DF2A3F;">，然后重写对应的方法即可。</font></strong></p><p><strong><font style="color:#DF2A3F;">因此，通过对</font></strong><code>WebMvcAutoConfigurationAdapter&lt;/font&gt;</code><strong><font style="color:#DF2A3F;">类中的方法进行重写来</font></strong><font style="color:#74B602;">修改</font><font style="color:#DF2A3F;"><strong>Web MVC的默认配置。</strong></font></p><p>![image-20250430153936545](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250430153936545.png)</p><h5 id="关于WebMvcConfigurer接口"><a href="#关于WebMvcConfigurer接口" class="headerlink" title="关于WebMvcConfigurer接口"></a>关于<code>WebMvcConfigurer</code>接口</h5><p>这个接口不是SpringBoot框架提供的，是Spring MVC提供的，在Spring框架4.3版本中引入的。这个接口的作用主要是<strong>允许开发者通过实现这个接口来定制Spring MVC的行为</strong>。</p><p>在这个接口中提供了很多方法，需要改变Spring MVC的哪个行为，则重写对应的方法即可，下面是这个接口中所有的方法，以及每个方法对应的Spring MVC行为的解释：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="comment">// 用于定制 Spring MVC 如何匹配请求路径到控制器</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 用于定制 Spring MVC 的内容协商策略，以确定如何根据请求的内容类型来选择合适的处理方法或返回数据格式</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer configurer)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 用于定制 Spring MVC 处理异步请求的方式</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">configureAsyncSupport</span><span class="params">(AsyncSupportConfigurer configurer)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 用于定制是否将某些静态资源请求转发WEB容器默认的Servlet处理</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 用于定制 Spring MVC 解析视图的方式，以确定如何将控制器返回的视图名称转换为实际的视图资源。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">configureViewResolvers</span><span class="params">(ViewResolverRegistry registry)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 用于定制 Spring MVC 如何处理 HTTP 请求和响应的数据格式，包括 JSON、XML 等内容类型的转换</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 用于定制 Spring MVC 如何处理控制器方法中发生的异常，并提供相应的错误处理逻辑。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">configureHandlerExceptionResolvers</span><span class="params">(List&lt;HandlerExceptionResolver&gt; resolvers)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用于定制 Spring MVC 如何处理数据的格式化和解析，例如日期、数值等类型的对象的输入和输出格式。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">addFormatters</span><span class="params">(FormatterRegistry registry)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 用于定制 Spring MVC 如何使用拦截器来处理请求和响应，包括在请求进入控制器之前和之后执行特定的操作。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 用于定制 Spring MVC 如何处理静态资源（如 CSS、JavaScript、图片等文件）的请求。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 用于定制 Spring MVC 如何处理跨域请求，确保应用程序可以正确地响应来自不同域名的 AJAX 请求或其他跨域请求。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 用于快速定义简单的 URL 到视图的映射，而无需编写完整的控制器类和方法。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 用于定制 Spring MVC 如何解析控制器方法中的参数，包括如何从请求中获取并转换参数值。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">addArgumentResolvers</span><span class="params">(List&lt;HandlerMethodArgumentResolver&gt; resolvers)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 用于定制 Spring MVC 如何处理控制器方法的返回值，包括如何将返回值转换为实际的 HTTP 响应。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">addReturnValueHandlers</span><span class="params">(List&lt;HandlerMethodReturnValueHandler&gt; handlers)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用于定制 Spring MVC 如何处理 HTTP 请求和响应的数据格式，允许你添加或调整默认的消息转换器，以支持特定的数据格式。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 用于定制 Spring MVC 如何处理控制器方法中抛出的异常，允许你添加额外的异常处理逻辑。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">extendHandlerExceptionResolvers</span><span class="params">(List&lt;HandlerExceptionResolver&gt; resolvers)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1746000464694-3.png)</p><h5 id="WebMvcConfigurer接口的实现类WebMvcAutoConfigurationAdapter"><a href="#WebMvcConfigurer接口的实现类WebMvcAutoConfigurationAdapter" class="headerlink" title="WebMvcConfigurer接口的实现类WebMvcAutoConfigurationAdapter"></a><code>WebMvcConfigurer</code>接口的实现类<code>WebMvcAutoConfigurationAdapter</code></h5><p><code>WebMvcAutoConfigurationAdapter</code>是Spring Boot框架提供的，实现了Spring MVC中的<code>WebMvcConfigurer</code>接口，对Spring MVC的所有行为进行了默认的配置。</p><p>如果想要改变这些默认配置，应该怎么办呢？看源码：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730353008999-076f3b3f-2a0b-4936-a9f2-5d6cfe88b346.png)</p><p>可以看到，该类上有一个注解<code>@EnableConfigurationProperties({ WebMvcProperties.class, WebProperties.class })</code>，该注解负责启用配置属性。会将配置文件<code>application.properties</code>或<code>application.yml</code>中的配置传递到该类中。因此可以通过<code>application.properties</code>或<code>application.yml</code>配置文件来改变Spring Boot对SpringMVC的默认配置。<code>WebMvcProperties</code>和<code>WebProperties</code>源码如下： </p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730354494823-2adf83a4-aa2a-4fed-a5df-66b156de15c5.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730354507221-6424a72a-0728-478b-92eb-e52d3d5a6f38.png)</p><p>通过以上源码得知要改变SpringBoot对SpringMVC的默认配置，需要在配置文件中使用以下前缀的配置：</p><ul><li>spring.mvc：<font style="color:rgb(44, 44, 54);">主要用于配置 Spring MVC 的相关行为，例如路径匹配、视图解析、静态资源处理等</font></li><li>spring.web：通常用于配置一些通用的 Web 层设置，如资源处理、安全性配置等。</li></ul><h3 id="自动配置中的静态资源处理"><a href="#自动配置中的静态资源处理" class="headerlink" title="自动配置中的静态资源处理"></a>自动配置中的静态资源处理</h3><p>web站点中的静态资源指的是：js、css、图片等。</p><h4 id="静态资源处理源码分析"><a href="#静态资源处理源码分析" class="headerlink" title="静态资源处理源码分析"></a>静态资源处理源码分析</h4><p>关于<strong>SpringBoot对静态资源处理的默认配置</strong>，查看<code>WebMvcAutoConfigurationAdapter</code>源码，核心源码如下：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730356581883-80169fed-c487-4b68-a1f2-70ef95d6c9a6.png)</p><p>对以上源码进行解释：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查 resourceProperties 中的 addMappings 属性是否为 false。如果为 false，则表示不启用默认的静态资源映射处理。</span></span><br><span class="line">    <span class="comment">// 在application.properties配置文件中进行`spring.web.resources.add-mappings=false`配置，可以将其设置为false。</span></span><br><span class="line">    <span class="comment">// 当然，如果没有配置的话，默认值是true。</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置 WebJars 的静态资源处理。</span></span><br><span class="line">    <span class="comment">// this.mvcProperties.getWebjarsPathPattern()的执行结果是：/webjars/**</span></span><br><span class="line">    <span class="comment">// 也就是说，如果请求路径是 http://localhost:8080/webjars/** ，则自动去类路径下的 /META-INF/resources/webjars/ 目录中找静态资源。</span></span><br><span class="line">    <span class="comment">// 如果要改变这个默认的配置，需要在application.properties文件中进行这样的配置：`spring.mvc.webjars-path-pattern=...`</span></span><br><span class="line">    addResourceHandler(registry, <span class="built_in">this</span>.mvcProperties.getWebjarsPathPattern(),</span><br><span class="line">            <span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置普通静态资源处理</span></span><br><span class="line">    <span class="comment">// this.mvcProperties.getStaticPathPattern()的执行结果是：/**</span></span><br><span class="line">    <span class="comment">// this.resourceProperties.getStaticLocations()的执行结果是：&#123; &quot;classpath:/META-INF/resources/&quot;,&quot;classpath:/resources/&quot;, &quot;classpath:/static/&quot;, &quot;classpath:/public/&quot; &#125;</span></span><br><span class="line">    <span class="comment">// 也就是说，如果请求路径是：http://localhost:8080/**，根据控制器方法优先原则，会先去找合适的控制器方法，如果没有合适的控制器方法，静态资源处理才会生效，则自动去类路径下的/META-INF/resources/、/resources/、/static/、/public/ 4个位置找。</span></span><br><span class="line">    <span class="comment">// 如果要改变这个默认的配置，需要在application.properties中进行如下的两个配置：</span></span><br><span class="line">    <span class="comment">// 配置URL：spring.mvc.static-path-pattern=...</span></span><br><span class="line">    <span class="comment">// 配置物理路径：spring.web.resources.static-locations=...,...,...,...</span></span><br><span class="line">    addResourceHandler(registry, <span class="built_in">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;</span><br><span class="line">        registration.addResourceLocations(<span class="built_in">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.servletContext != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">ServletContextResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextResource</span>(<span class="built_in">this</span>.servletContext, SERVLET_LOCATION);</span><br><span class="line">            registration.addResourceLocations(resource);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 让springboot的静态资源处理失效</span></span><br><span class="line"><span class="comment">#spring.web.resources.add-mappings=false</span></span><br><span class="line"><span class="comment">#spring.web.resources.add-mappings=true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置静态资源webjars的path pattern</span></span><br><span class="line"><span class="comment">#spring.mvc.webjars-path-pattern=/webjars/**</span></span><br><span class="line"><span class="attr">spring.mvc.webjars-path-pattern</span>=<span class="string">/wjs/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置普通静态资源的path pattern</span></span><br><span class="line"><span class="comment">#spring.mvc.static-path-pattern=/**</span></span><br><span class="line"><span class="comment">#spring.mvc.static-path-pattern=/static/**</span></span><br><span class="line"><span class="comment"># 配置普通静态资源文件存储位置</span></span><br><span class="line"><span class="comment">#spring.web.resources.static-locations=classpath:/META-INF/resources/,classpath:/resources/,classpath:/static/,classpath:/public/</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置普通静态资源的path pattern</span></span><br><span class="line"><span class="comment">#spring.mvc.static-path-pattern=/abc/**</span></span><br><span class="line"><span class="comment"># 配置普通静态资源文件存储位置</span></span><br><span class="line"><span class="comment">#spring.web.resources.static-locations=classpath:/static1/,classpath:/static2/</span></span><br></pre></td></tr></table></figure><h4 id="关于WebJars静态资源处理"><a href="#关于WebJars静态资源处理" class="headerlink" title="关于WebJars静态资源处理"></a>关于WebJars静态资源处理</h4><p>默认规则是：当请求路径是<code>/webjars/**</code>，则会去<code>classpath:/META-INF/resources/webjars/</code>找。前面的路径可以更改，后面的是固定的无法更改</p><p><strong>WebJars介绍</strong></p><p><font style="color:rgb(44, 44, 54);">WebJars 是一种将常用的前端库（如 jQuery、Bootstrap、Font Awesome 等）打包成 JAR 文件的形式，方便在 Java 应用程序中使用。WebJars 提供了一种标准化的方式来管理前端库，使其更容易集成到 Java 项目中，并且可以利用 Maven 的依赖管理功能。</font></p><p><font style="color:rgb(44, 44, 54);"></font></p><p><strong><font style="color:rgb(44, 44, 54);">WebJars在SpringBoot中的使用</font></strong></p><p><font style="color:rgb(44, 44, 54);">WebJars官网：</font><a href="https://www.webjars.org/">https://www.webjars.org/</a></p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730364165294-a000b7b4-9fdb-4c40-99f5-c47f2f25ad9e.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1746088949741-11.png)</p><p>在官网上可以找到某个webjars的maven依赖，将依赖加入到SpringBoot项目中，例如我们添加vue的依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--webjars：将前端库打成jar包，方便在java项目中引入，也可以使用maven进行依赖管理。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars.npm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>vue<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如下图表示加入成功：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730364253405-dc6801f0-6122-49eb-9e77-36ef92668f5b.png)</p><p>在jar包列表中也可以看到：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730364333436-43d60b44-fb7b-454d-b586-f948930ea146.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1746088949741-11.png)</p><p>在SpringBoot中，对WebJars的默认访问规则是：当请求路径是<code>/webjars/**</code>，则会去<code>classpath:/META-INF/resources/webjars/</code>找。</p><p>因此我们要想访问上图的<code>index.js</code>，则应该发送这样的请求路径：<code>http://localhost:8080/webjars/vue/3.5.12/index.js</code></p><p>启动服务器，打开浏览器，访问，测试结果如下：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730364535656-fd9fb574-ce9d-4278-96a4-7d71207e1446.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1746088949741-11.png)</p><p>和IDEA中的文件对比一下，完全一样则表示测试成功：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730364567084-7ac48323-e220-4e10-a4b6-dc5a30ab6955.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1746088949741-11.png)</p><h4 id="关于普通静态资源处理"><a href="#关于普通静态资源处理" class="headerlink" title="关于普通静态资源处理"></a>关于普通静态资源处理</h4><p>SpringBoot对普通静态资源处理的规则是：</p><p>当请求路径是<a href="http://localhost:8080/**">http://localhost:8080/**</a>，根据控制器方法优先原则，会先去找合适的控制器方法，如果没有合适的控制器方法，静态资源处理才会生效，则自动去类路径下的以下4个位置查找：</p><ul><li>classpath:&#x2F;META-INF&#x2F;resources&#x2F;</li><li>classpath:&#x2F;resources&#x2F;</li><li>classpath:&#x2F;static&#x2F;</li><li>classpath:&#x2F;public&#x2F;</li></ul><p>我们可以在项目中分别创建以上4个目录，在4个目录当中放入静态资源，例如4张图片：</p><p>![image-20250502145100506](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250502145100506.png)</p><p>![image-20250502145102928](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250502145102928.png)</p><p>然后启动服务器，打开浏览器，访问，测试是否可以正常访问图片：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730365066712-a89265e6-eb88-4306-b95b-bc85d2e72f9d.png)</p><h4 id="关于静态资源缓存处理"><a href="#关于静态资源缓存处理" class="headerlink" title="关于静态资源缓存处理"></a>关于静态资源缓存处理</h4><p>不管是webjars的静态资源还是普通静态资源，统一都会执行以下这个方法，这个方法最后几行代码就是关于静态资源的缓存处理方式。</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730362324912-ff074309-5a29-4ee9-84df-804311a07314.png)</p><p><strong>什么是静态资源缓存，谁缓存，有什么用？</strong></p><p>静态资源缓存指的是浏览器的缓存行为，浏览器可以将静态资源（js、css、图片、声音、视频）缓存到浏览器中，只要下一次用户访问同样的静态资源直接从缓存中取，不再从服务器中获取，可以降低服务器的压力，提高用户的体验。而这个缓存策略可以在服务器端程序中进行设置，SpringBoot对静态资源缓存的默认策略就是以下这三行代码：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730365697951-98a6687d-dc95-49fe-bf63-6afac28ac62b.png)</p><p>以上三行代码的解释如下：</p><ul><li>registration.setCachePeriod(getSeconds(this.resourceProperties.getCache().getPeriod()));<ul><li>设置缓存的过期时间（如果没有指定单位，默认单位是秒）</li><li>浏览器会<strong>根据响应头中的缓存控制信息</strong>决定是否从本地缓存中加载资源，而不是每次都从服务器重新请求。这有助于减少网络流量和提高页面加载速度。</li><li>假设你配置了静态资源缓存过期时间为 1 小时（3600 秒），那么浏览器在首次请求某个静态资源后，会在接下来的一小时内从本地缓存加载该资源，而不是重新请求服务器。</li><li>可以通过<code>application.properties</code>的来修改默认的过期时间，例如：<code>spring.web.resources.cache.period=3600</code><font style="color:rgb(51, 51, 51);">或者</font><code>spring.web.resources.cache.period=1h</code></li></ul></li><li>registration.setCacheControl(this.resourceProperties.getCache().getCachecontrol().toHttpCacheControl());<ul><li>设置静态资源的 Cache-Control HTTP 响应头，告诉浏览器如何去缓存这些资源。</li><li><code>Cache-Control</code><font style="color:rgb(44, 44, 54);"> HTTP 响应头   是HTTP响应协议的一部分内容。如下图响应协议的响应头信息中即可看到</font><code>Cache-Control</code><font style="color:rgb(44, 44, 54);">的字样：</font></li></ul></li></ul><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730367060571-fb49d8ba-39d5-4a04-9c6b-cbce0add9283.png)</p><pre><code>常见的 Cache-Control 指令包括：    * max-age=&lt;seconds&gt;：表示响应在多少秒内有效。    * public：表示响应可以被任何缓存机制（如代理服务器）缓存。    * private：表示响应只能被用户的浏览器缓存    * no-cache：表示在使用缓存的资源之前必须重新发送一次请求进行验证。    * no-store：表示不缓存任何响应的资源。- 例如：max-age=3600, public：表示响应在 3600 秒内有效，并且可以被任何缓存机制缓存。- 可以通过`spring.web.resources.cache.cachecontrol.max-age=3600`以及`spring.web.resources.cache.cachecontrol.cache-public=true`进行重新配置。</code></pre><ul><li>registration.setUseLastModified(this.resourceProperties.getCache().isUseLastModified());<ul><li>设置静态资源在响应时，是否在响应头中添加资源的最后一次修改时间。SpringBoot默认配置的是：在响应头中添加响应资源的最后一次修改时间。</li><li>浏览器发送请求时，会将缓存中的资源的最后修改时间和服务器端资源的最后一次修改时间进行比对，如果没有变化，仍然从缓存中获取。</li><li>可以通过<code>spring.web.resources.cache.use-last-modified=false</code>来进行重新配置。</li></ul></li></ul><h4 id="静态资源缓存测试"><a href="#静态资源缓存测试" class="headerlink" title="静态资源缓存测试"></a>静态资源缓存测试</h4><p>根据之前源码分析，得知<code>静态资源缓存</code>相关的配置应该使用<code>spring.web.resources.cache</code>：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730429586708-40337969-1725-4459-879b-2299ab2a4405.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730429704722-ad0a5409-038f-48f1-9986-809c24f82369.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1746172740747-15.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730429724705-e10888fe-f2aa-4b87-9581-e2641c3e30fd.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730429747795-51fcc7b3-9dc6-49e3-8cbf-647cfff03b09.png)</p><p>在<code>application.properties</code>文件中对缓存进行如下的配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 静态资源缓存设置</span></span><br><span class="line"><span class="comment"># 1. 缓存有效期</span></span><br><span class="line"><span class="comment">#spring.web.resources.cache.period=3600</span></span><br><span class="line"><span class="attr">spring.web.resources.cache.period</span>=<span class="string">100</span></span><br><span class="line"><span class="comment"># 2. 缓存控制（cachecontrol配置的话，period会被覆盖失效）</span></span><br><span class="line"><span class="attr">spring.web.resources.cache.cachecontrol.max-age</span>=<span class="string">20</span></span><br><span class="line"><span class="comment"># 3. 是否使用缓存的最后修改时间（默认是：使用）</span></span><br><span class="line"><span class="attr">spring.web.resources.cache.use-last-modified</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># 4. 是否开启静态资源默认处理方式（默认是：开启）</span></span><br><span class="line"><span class="attr">spring.web.resources.add-mappings</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><p>注意：<code>cachecontrol.max-age</code>配置的话，<code>period</code>会被覆盖。</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730430084806-2086f0b6-646a-4e6a-a39c-8fa8dba74be0-1746172755878-26.png)</p><p>启动服务器测试：看看是否在20秒内走缓存，20秒之后是不是就不走缓存了！！！</p><p>第一次访问：请求服务器</p><p>![image-20250502160244349](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250502160244349.png)</p><p>第二次访问：20秒内开启一个新的浏览器窗口，再次访问，发现走了缓存</p><p>![image-20250502160251111](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250502160251111.png)</p><p>第三次访问：20秒后开启一个新的浏览器窗口，再次访问，发现重新请求服务器</p><p>![image-20250502160257426](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250502160257426.png)</p><p>提示，为什么显示<code>304</code>，这是因为这个配置：<code>spring.web.resources.cache.use-last-modified=true</code>要去和最后一次修改作对比</p><h4 id="web应用的欢迎页面"><a href="#web应用的欢迎页面" class="headerlink" title="web应用的欢迎页面"></a>web应用的欢迎页面</h4><h5 id="欢迎页测试"><a href="#欢迎页测试" class="headerlink" title="欢迎页测试"></a>欢迎页测试</h5><p>先说结论：只要在静态资源路径下提供<code>index.html</code>，默认被当做欢迎页面。静态资源路径指的是之前的4个路径：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;classpath:/META-INF/resources/&quot;, &quot;classpath:/resources/&quot;, &quot;classpath:/static/&quot;, &quot;classpath:/public/&quot; &#125;</span><br></pre></td></tr></table></figure><p>测试一下，在<code>classpath:/static/</code>目录下新建<code>index.html</code>页面：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730422047114-993504b3-e8b2-4570-a789-53d1427bb0be.png)</p><p>启动服务器，测试结果如下：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730422096295-c5fedb9e-df71-4cac-9a24-f2d6da9b071f.png)</p><p>如果同时在4个静态资源路径下都提供<code>index.html</code>，哪个页面会被当做欢迎页呢？</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730422239619-ba967027-498c-4f90-a139-c1565c91328d.png)</p><p>启动服务器，测试结果如下：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730422275754-3b1e145f-f34b-4eac-ae6f-0187eb852282.png)</p><p>原因是什么呢？这是因为<code>classpath:/META-INF/resources/</code>是数组的首元素，因此先从这个路径下找欢迎页。</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730422431137-93db3613-613e-434b-b7b8-c9f1af68636c.png)</p><h5 id="欢迎页源码分析"><a href="#欢迎页源码分析" class="headerlink" title="欢迎页源码分析"></a>欢迎页源码分析</h5><p>在<code>WebMvcAutoConfiguration</code>类中有一个内部类<code>EnableWebMvcConfiguration</code>，这个类中有这样一段代码：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730424626175-06c18960-d1bc-4ea7-a9f2-84079dd105ca.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730424702185-b359161c-2221-4106-837c-1a6a4bb16683.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730424718260-3d97f911-f050-42a6-b2c3-78a739d39f2d.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730424745404-720c4fe8-118e-4133-9514-efab29e7e39e.png)</p><p>通过以上源码追踪，得出结论：只要请求路径是<code>/**</code>的，会依次去<code>{ &quot;classpath:/META-INF/resources/&quot;, &quot;classpath:/resources/&quot;, &quot;classpath:/static/&quot;, &quot;classpath:/public/&quot; }</code>这四个位置找<code>index.html</code>页面作为欢迎页。</p><h5 id="一个小小的疑惑"><a href="#一个小小的疑惑" class="headerlink" title="一个小小的疑惑"></a>一个小小的疑惑</h5><p>我们来看一下<code>WebMvcAutoConfiguration</code>的生效条件：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730424986145-0d76b7da-06c5-4942-a5f2-3e55f0249c89.png)</p><p>上图红框内表示，要求Spring容器中缺失<code>WebMvcConfigurationSupport</code>这个Bean，<code>WebMvcAutoConfiguration</code>才会生效。</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1746178039575-48.png)</p><p>但是我们来看一下<code>EnableWebMvcConfiguration</code>的继承结构：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730425120392-dda2febe-d932-452c-9599-6df5859a2062.png)</p><p>![image-20250502203407401](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250502203407401.png)</p><p>很明显，<code>EnableWebMvcConfiguration</code>就是一个<code>WebMvcConfigurationSupport</code>这样的Bean。</p><p>那疑问就有了：既然容器中存在<code>WebMvcConfigurationSupport</code>这样的Bean，<code>WebMvcAutoConfiguration</code>为什么还会生效呢？</p><p>原因是因为：<code>EnableWebMvcConfiguration</code>是<code>WebMvcAutoConfiguration</code>类的内部类。在<code>WebMvcAutoConfiguration</code>进行加载的时候，<code>EnableWebMvcConfiguration</code>这个内部类还没有加载。因此这个时候在容器中还不存在<code>WebMvcConfigurationSupport</code>的Bean，所以<code>WebMvcAutoConfiguration</code>仍然会生效。</p><p><strong><font style="color:#DF2A3F;">以上所说的</font></strong><code>WebMvcAutoConfiguration</code><strong><font style="color:#DF2A3F;">类中的内部类</font></strong><code>EnableWebMvcConfiguration</code><strong><font style="color:#DF2A3F;">，是用来启用Web MVC默认配置的。</font></strong></p><p><strong><font style="color:#DF2A3F;">注意区分：WebMvcAutoConfiguration的两个内部类：</font></strong></p><ul><li><code>WebMvcAutoConfigurationAdapter</code>作用是用来：修改配置的</li><li><code>EnableWebMvcConfiguration</code>作用是用来：启用配置的</li></ul><h5 id="favorite-icon（小图标）"><a href="#favorite-icon（小图标）" class="headerlink" title="favorite icon（小图标）"></a>favorite icon（小图标）</h5><p>favicon（也称为“收藏夹图标”或“网站图标”）是大多数现代网页浏览器的默认行为之一。当用户访问一个网站时，浏览器通常会尝试从该网站的根目录下载名为 favicon.ico 的文件，并将其用作标签页的图标。</p><p>如果网站没有提供 favicon.ico 文件，浏览器可能会显示一个默认图标，或者根本不显示任何图标。为了确保良好的用户体验，网站开发者通常会在网站的根目录下放置一个 favicon.ico 文件。</p><p>与其他静态资源一样，Spring Boot 会在配置的静态内容位置检查是否存在 <code>favicon.ico</code>文件。如果存在这样的文件，它将自动作为应用程序的 favicon 使用。</p><p>以上官方说明的：将<code>favicon.ico</code>文件放到静态资源路径下即可。</p><p>web站点没有提供<code>favicon.ico</code>时：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730427725460-6c4062dc-df53-495c-8709-431dd38f2337.png)</p><p>我们在<a href="https://www.iconfont.cn/">https://www.iconfont.cn/</a> （阿里巴巴提供的图标库）上随便找一个图标，然后将图片名字命名为<code>favicon.ico</code>，然后将其放到SpringBoot项目的静态资源路径下：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730427919469-60975be4-d0d3-43ba-8435-98d9da427282.png)</p><p>启动服务器测试：记住（ctrl + F5强行刷新一下，避免影响测试效果）</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730428251364-894a09fe-92fb-408c-89d0-42d8e27b222b.png)</p><h2 id="SpringBoot的web手动配置-静态资源处理"><a href="#SpringBoot的web手动配置-静态资源处理" class="headerlink" title="SpringBoot的web手动配置(静态资源处理)"></a>SpringBoot的web手动配置(静态资源处理)</h2><p>如果你对SpringBoot默认的静态资源处理方式不满意。可以通过两种方式来改变这些默认的配置：</p><ul><li><p>如果你对SpringBoot默认的静态资源处理方式不满意。可以通过两种方式来改变这些默认的配置：</p><ul><li>第一种：配置文件方式<ul><li>通过修改<code>application.properties</code>或<code>application.yml</code></li><li>添加<code>spring.mvc</code>和<code>spring.web</code>相关的配置。</li></ul></li></ul><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730431752471-f806b5a3-924c-4b84-9c13-6999dad0493b-1746261760607-7.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730431765824-5d3ec11d-aad5-44c8-a32e-dd255bec24ea-1746261760607-9.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730431775131-4bec5477-fd86-4ab2-afa1-4b1927b2aafc-1746261760607-11.png)</p><ul><li>第二种：编写代码方式<ul><li>SpringMVC框架为我们提供了<code>WebMvcConfigurer</code>接口，需要改变默认的行为，可以<code>编写一个类</code>实现<code>WebMvcConfigurer</code>接口，并<code>对应重写</code>接口中的方法即可改变默认的配置行为。</li></ul></li></ul></li></ul><h3 id="配置文件方式"><a href="#配置文件方式" class="headerlink" title="配置文件方式"></a>配置文件方式</h3><p>要修改<code>访问静态资源URL的前缀</code>，这样配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 让springboot的静态资源处理失效,这个不影响META-INF</span></span><br><span class="line"><span class="comment">#spring.web.resources.add-mappings=true</span></span><br><span class="line"><span class="comment"># Spring MVC的相关配置</span></span><br><span class="line"><span class="comment"># 1. 设置webjars静态资源的请求路径的前缀</span></span><br><span class="line"><span class="attr">spring.mvc.webjars-path-pattern</span>=<span class="string">/wjs/**</span></span><br><span class="line"><span class="comment"># 2. 设置普通静态资源的请求路径的前缀(path-pattern)，也就是浏览器的链接</span></span><br><span class="line"><span class="attr">spring.mvc.static-path-pattern</span>=<span class="string">/abc/**</span></span><br></pre></td></tr></table></figure><p>要修改<code>静态资源的存放位置</code>，这样配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.web.resources.static-locations</span>=<span class="string">classpath:/static1/,classpath:/static2/</span></span><br></pre></td></tr></table></figure><p>进行以上配置之后：</p><ol><li>访问webjars的请求路径应该是这样的：<a href="http://localhost:8080/wjs/">http://localhost:8080/wjs/</a>….</li><li>访问普通静态资源的请求路径应该是这样的：<a href="http://localhost:8080/static/">http://localhost:8080/static/</a>….</li><li>普通静态资源的存放位置也应该放到<code>classpath:/static1/,classpath:/static2/</code>下面，其他位置无效。</li></ol><p><strong>访问webjars测试结果如下：</strong></p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730433063487-fe214e35-a43c-4ad0-9760-742f6bfcdcf6.png)</p><p><strong>访问普通静态资源测试结果如下：</strong></p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730433000967-37e76b55-5715-4387-a135-5daacd53a755.png)</p><p>![image-20250503164646779](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250503164646779.png)</p><p>如果访问<code>dog2.jpg</code>，就无法访问了：</p><p>![image-20250503170828711](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250503170828711.png)</p><p>但是，存储在<code>classpath:/META-INF/resources/</code>目录下的<code>dog1.jpg</code>仍然是可以访问的：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730433537233-e7fe1330-22d3-4b36-8c43-bbdc9a578f99.png)</p><p>因此，存储在<code>classpath:/META-INF/resources/</code>位置的静态资源会被默认加载，不受手动配置的影响。</p><h3 id="编写代码方式"><a href="#编写代码方式" class="headerlink" title="编写代码方式"></a>编写代码方式</h3><p>我们在前面提到过，想要定制Spring MVC的行为，也可以编写类实现Spring MVC框架提供的一个接口<code>WebMvcConfigurer</code>，想定制哪个行为就重写哪个方法即可。</p><p>编写的类只要纳入IoC容器的管理。因此有以下两种实现方式：</p><ul><li>第一种：编写类实现<code>WebMvcConfigurer</code>接口，重写对应的方法。</li><li>第二种：以组件的形式存在：编写一个方法，用<code>@Bean</code>注解标注。</li></ul><h4 id="第一种方式"><a href="#第一种方式" class="headerlink" title="第一种方式"></a>第一种方式</h4><p>编写配置类，对于<code>web</code>开发来说，配置类一般起名为：<code>WebConfig</code>。配置类一般存放到<code>config</code>包下，因此在SpringBoot主入口程序同级目录下新建<code>config</code>包，在<code>config</code>包下新建<code>WebConfig</code>类</p><p>![image-20250504032848114](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250504032848114.png)</p><p>重写使用快捷键ctrl+o然后搜addResourceHandlers</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里的这种配置：在springboot默认的自动配置基础之上进行扩展配置。也就是说springboot之前的配置仍然生效。</span></span><br><span class="line"><span class="comment">// 使用该注解标注，表示该类为配置类。</span></span><br><span class="line"><span class="comment">//@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 静态资源处理，需要重写的方法是：addResourceHandlers</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用注册器 registry 绑定path pattern以及真实的静态资源文件存储路径</span></span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/abc/**&quot;</span>) <span class="comment">// 配置路径访问模式</span></span><br><span class="line">                .addResourceLocations(<span class="string">&quot;classpath:/static1/&quot;</span>, <span class="string">&quot;classpath:/static2/&quot;</span>); <span class="comment">// 配置静态资源路径</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：将<code>application.properties</code>文件中之前的所有配置全部注释掉。让其恢复到最原始的默认配置。</p><p>![image-20250504033257856](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250504033257856.png)</p><p>启动服务器进行测试：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730444208880-ca582b52-a68f-4918-9ead-f342c5ebbf38.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730444226844-d1e40613-8c6c-43a5-95a1-1c0d34d101bb.png)</p><p>通过测试，我们的配置是生效的。</p><p>我们再来看看，默认的配置是否还生效？</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730444289901-3304e315-67e2-4d6c-93b8-0db5f48a24a7.png)</p><p>我们可以看到，Spring Boot对Spring MVC的默认自动配置是生效的。</p><p><strong><font style="color:#DF2A3F;">因此，以上的方式只是在Spring MVC默认行为之外扩展行为。</font></strong></p><p>如果你不想再继续使用SpringBoot提供的默认行为，可以使用<code>@EnableWebMvc</code>进行标注。例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加这个注解之后，表示不在使用springboot的提供的默认的自动配置。</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="comment">// 以下配置完全使用自己的，不在基于springboot的配置进行扩展。</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 静态资源处理，需要重写的方法是：addResourceHandlers</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用注册器 registry 绑定path pattern以及真实的静态资源文件存储路径</span></span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/abc/**&quot;</span>) <span class="comment">// 配置路径访问模式</span></span><br><span class="line">                .addResourceLocations(<span class="string">&quot;classpath:/static1/&quot;</span>, <span class="string">&quot;classpath:/static2/&quot;</span>); <span class="comment">// 配置静态资源路径</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试结果：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730444605358-87fe9bc0-edfb-4fff-9bc0-ae4a97b50042.png)</p><p>可以看到，默认配置已经不再生效。</p><p>再来看看，我们自己的配置是否仍然生效：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730444650423-57b49f40-b595-4c27-935e-1c6361f20ba4.png)</p><p>仍然生效。</p><h4 id="第二种方式"><a href="#第二种方式" class="headerlink" title="第二种方式"></a>第二种方式</h4><p>采用<code>@Bean</code>注解提供一个<code>WebMvcConfigurer</code>组件，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">aaa</span><span class="params">()</span>&#123;<span class="comment">//方法名随意</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">                registry.addResourceHandler(<span class="string">&quot;/xyz/**&quot;</span>)</span><br><span class="line">                        .addResourceLocations(<span class="string">&quot;classpath:/static1/&quot;</span>, <span class="string">&quot;classpath:/static2/&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试结果如下：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730444971338-0aca22a6-ff00-4644-9e21-2d08765b62e4.png)</p><p>通过了测试，并且以上代码也是在原有配置基础上进行扩展。</p><p>如果要弃用默认配置，仍然使用<code>@EnableWebMvc</code>注解进行标注。自行测试！</p><h4 id="其他配置也这样做即可"><a href="#其他配置也这样做即可" class="headerlink" title="其他配置也这样做即可"></a>其他配置也这样做即可</h4><p>以上对<code>静态资源处理</code>进行了手动配置，也可以做其他配置，例如拦截器：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="comment">//@EnableWebMvc</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig2</span> &#123;</span><br><span class="line">    <span class="comment">//拦截器配置</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">bbb</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">                registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">HandlerInterceptor</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;拦截器的preHandle&quot;</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;拦截器的postHandle&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;拦截器的afterCompletion&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>启动服务器，打开浏览器，发送请求<a href="http://localhost:8080/static/dog5.jpg">http://localhost:8080/static/dog5.jpg</a>，后台执行结果如下：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730445490551-7c8fbe3f-a792-4307-8c46-21a365e0b25d.png)</p><p>这说明拦截器生效。</p><h4 id="为什么只要容器中有WebMvcConfigurer组件即可呢"><a href="#为什么只要容器中有WebMvcConfigurer组件即可呢" class="headerlink" title="为什么只要容器中有WebMvcConfigurer组件即可呢"></a>为什么只要容器中有<code>WebMvcConfigurer</code>组件即可呢</h4><p>源码分析：</p><p><code>WebMvcAutoConfiguration</code>部分源码：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730446108216-7ff9fb75-c9dd-4ba3-8b59-23f6c78d0b1a.png)</p><p><code>WebMvcAutoConfiguration</code>类的内部类<code>EnableWebMvcConfiguration</code>，这个类继承了<code>DelegatingWebMvcConfiguration</code>（Delegating是委派的意思。）</p><p><code>DelegatingWebMvcConfiguration</code>中的<code>setConfigurers()</code>方法用来设置配置。而配置参数是一个List集合，这个List集合中存放的是<code>WebMvcConfigurer</code>接口的实例，并且可以看到这个方法上面使用了<code>@Autowired</code>进行了自动注入，这也就是说为什么只要是IoC容器中的组件就能生效的原因。</p><p>我们再次进入到<code>this.configurers.addWebMvcConfigurers(configurers);</code>方法中进一步查看源码：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730446847673-e2758f97-fcc9-4c72-bc9c-ea4463afe751.png)</p><p>对于<code>WebMvcConfigurerComposite</code>类的代码来说，它是一个非常典型的<code>**&lt;font style=&quot;color:#DF2A3F;&quot;&gt;组合模式&lt;/font&gt;**</code>。</p><p>组合模式的关键点：</p><ol><li>组合多个 WebMvcConfigurer 实例：WebMvcConfigurerComposite 通过 delegates 列表组合了多个 WebMvcConfigurer 实例。</li><li>统一接口：WebMvcConfigurerComposite 实现了 WebMvcConfigurer 接口，因此可以像一个单一的 WebMvcConfigurer 一样被使用。</li><li>代理调用：在实现 WebMvcConfigurer 接口的方法时，WebMvcConfigurerComposite 会遍历 delegates 列表，调用每个 WebMvcConfigurer 实例的相应方法。</li></ol><p>总结：WebMvcConfigurerComposite 主要采用了组合模式的思想，将多个 WebMvcConfigurer 实例组合在一起，形成一个整体。</p><p>注意：组合模式是GoF 23种设计模式中的结构型设计模式。</p><h2 id="web请求的路径匹配"><a href="#web请求的路径匹配" class="headerlink" title="web请求的路径匹配"></a>web请求的路径匹配</h2><p>我们在学习SpringMVC的时候，路径匹配规则中学习了<code>Ant</code>风格的路径匹配规则。大家可以翻看一下之前的Spring MVC视频。</p><p>在<code>Spring Boot3</code>中，对web请求的路径匹配提供了两种规则：</p><ul><li>第一种：AntPathMatcher（Ant风格）【<strong><font style="color:#DF2A3F;">较旧</font></strong>】</li><li>第二种：PathPatternParser（从Spring5.3中引入的。在SpringBoot2.4中引入的。）【<strong><font style="color:#DF2A3F;">较新：效率高</font></strong>】<ul><li><strong><font style="color:#DF2A3F;">效率比Ant高，一般新项目中使用</font></strong></li></ul></li></ul><p>SpringBoot3中默认使用的是<code>PathPatternParser</code>，不需要任何配置。如果要使用<code>AntPathMatcher</code>，就需要进行如下的配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.mvc.pathmatch.matching-strategy</span>=<span class="string">ant_path_matcher</span></span><br></pre></td></tr></table></figure><h3 id="AntPathMatcher"><a href="#AntPathMatcher" class="headerlink" title="AntPathMatcher"></a>AntPathMatcher</h3><p>Ant风格的路径匹配规则回顾：</p><p><strong><font style="color:#DF2A3F;">*</font></strong>匹配任意长度的任意字符序列（不包括路径分隔符）。示例：&#x2F;foo&#x2F;*.html 匹配 &#x2F;foo&#x2F;bar.html 和 &#x2F;foo&#x2F;baz.html。</p><p><font style="color:#DF2A3F;">******</font>匹配任意数量的目录层级。示例：&#x2F;foo&#x2F;** 匹配 &#x2F;foo&#x2F;bar、&#x2F;foo&#x2F;bar&#x2F;baz 和 &#x2F;foo&#x2F;bar&#x2F;baz&#x2F;qux。</p><p><strong><font style="color:#DF2A3F;">?</font></strong><strong>匹配</strong>任意单个字符**。示例：&#x2F;foo?bar 匹配 &#x2F;foobar 和 &#x2F;fooxbar。</p><p><strong><font style="color:#DF2A3F;">[]</font></strong>匹配指定范围内的单个字符。示例：&#x2F;foo[a-z]bar 匹配 &#x2F;fooabar、&#x2F;foobbar 等。</p><p><strong><font style="color:#DF2A3F;">{}</font></strong>路径变量，用于提取路径的一部分作为参数。示例：&#x2F;users&#x2F;{userId} 匹配 &#x2F;users&#x2F;123，提取 userId&#x3D;123。</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1746344666214-9.png)</p><p>如果在SpringBoot3中启用Ant风格，记得配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.mvc.pathmatch.matching-strategy</span>=<span class="string">ant_path_matcher</span></span><br></pre></td></tr></table></figure><p>如下代码：请分析以下路径匹配的是什么样的路径。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//+代表1-n个字符，如果去掉就是任意一个字符。</span></span><br><span class="line">    <span class="comment">//？一个字符</span></span><br><span class="line">    <span class="comment">//**任意层级</span></span><br><span class="line">    <span class="comment">//最后必须是.do结尾</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;path:[a-z]+&#125;/a?/**/*.do&quot;)</span></span><br><span class="line">    <span class="comment">//HttpServletRequest是请求对象，后面是拿到用户传进来的path</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testPath</span><span class="params">(HttpServletRequest request, <span class="meta">@PathVariable</span> String path)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">requsetURI</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">        <span class="keyword">return</span> requsetURI + <span class="string">&quot;path = &quot;</span> + path;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>启动服务器并测试路径：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730472107928-af151fcc-d9b2-439a-825e-660f87f2c952.png)</p><h3 id="PathPatternParser"><a href="#PathPatternParser" class="headerlink" title="PathPatternParser"></a>PathPatternParser</h3><p>项目中不做配置，或者按照以下方式配置，都是<code>PathPatternParser</code>：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.mvc.pathmatch.matching-strategy</span>=<span class="string">path_pattern_parser</span></span><br></pre></td></tr></table></figure><p><code>PathPatternParser</code>风格是兼容Ant风格的。只有一个地方<code>PathPatternParser</code>不支持，Ant支持。在Ant风格中，<code>**</code>可以出现在任意位置。在<code>PathPatternParser</code>中只允许<code>**</code>出现在路径的末尾。</p><p>可以测试一下，将配置文件中的Ant风格注释掉，采用<code>PathPatternParser</code>风格。然后控制器代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.springboot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PathController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;path:[a-z]+&#125;/a?/**/*.do&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">path</span><span class="params">(HttpServletRequest request, <span class="meta">@PathVariable</span> String path)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request.getRequestURI() + <span class="string">&quot;,&quot;</span> + path;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动服务器报错：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730472557923-8f34cf00-6454-465b-b5e8-562520bbf095.png)</p><p>提示你，如果在路径当中出现了<code>**</code>，需要将路径匹配规则替换为Ant风格。因此路径当中如果出现<code>**</code>，那么必须使用Ant风格。除此之外，<code>PathPatternParser</code>均可用。</p><p>我们再来测试一下，<code>**</code>放到末尾，对于<code>PathPatternParser</code>是否可用？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;path:[a-z]+&#125;/a?/*.do/**&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">path</span><span class="params">(HttpServletRequest request, <span class="meta">@PathVariable</span> String path)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request.getRequestURI() + <span class="string">&quot;,&quot;</span> + path;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动服务器测试，可用：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730472772231-d18e628f-1b62-4757-9299-eaa604344ce6.png)</p><h3 id="路径匹配相关源码"><a href="#路径匹配相关源码" class="headerlink" title="路径匹配相关源码"></a>路径匹配相关源码</h3><p>底层选择路径匹配规则的源码是：</p><p>![image-20250505170404560](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250505170404560.png)</p><h2 id="内容协商"><a href="#内容协商" class="headerlink" title="内容协商"></a>内容协商</h2><p>内容协商机制是Spring MVC框架提供的，接下来主要是学习在SpringBoot中是如何支持SpringMVC内容协商机制的。</p><h3 id="对内容协商的理解"><a href="#对内容协商的理解" class="headerlink" title="对内容协商的理解"></a>对内容协商的理解</h3><p>内容协商机制是指服务器根据客户端的请求来决定返回资源的最佳表示形式。</p><p>白话文描述：客户端要什么格式的数据，咱后端就应该返回什么格式的数据。</p><ul><li>客户端要JSON，咱就响应JSON。</li><li>客户端要XML，咱就响应XML。</li><li>客户端要YAML，咱就响应YAML。</li></ul><p>你可能会有疑问：客户端接收数据时统一采用一种格式，例如JSON，不就行了吗。哪那么多事儿呀！！！</p><p>但在实际的开发中，不是这样的，例如：</p><ul><li>遗留的老客户端系统，仍然处理的是XML格式的数据。</li><li>要求处理速度快的这种客户端系统，一般要求返回JSON格式的数据。</li><li>要求安全性高的客户端系统，一般要求返回XML格式的数据。</li></ul><p>因此，在现代的开发中，不同的客户端可能需要后端系统返回不同格式的数据。总之后端应该满足这种多样化的需求。</p><h3 id="实现内容协商的两种方式"><a href="#实现内容协商的两种方式" class="headerlink" title="实现内容协商的两种方式"></a>实现内容协商的两种方式</h3><p>通常通过HTTP请求头（如 Accept）或请求参数（如 format）来指定客户端偏好接收的内容类型（如JSON、XML等）。服务器会根据这些信息选择最合适的格式进行响应。</p><h4 id="通过HTTP请求头（如-Accept）"><a href="#通过HTTP请求头（如-Accept）" class="headerlink" title="通过HTTP请求头（如 Accept）"></a>通过HTTP请求头（如 Accept）</h4><p>SpringBoot框架中，在程序员不做任何配置的情况下，优先考虑的是这种方式。</p><p>服务器会根据客户端发送请求时提交的请求头中的”Accept: application&#x2F;json” 或 “Accept: application&#x2F;xml” 或 “Accept: text&#x2F;html”来决定响应什么格式的数据。</p><p>客户端发送请求给服务器的时候，如何设置请求头的<code>Accept</code>？有以下几种常见实现方式：</p><ul><li>写代码<ul><li>fetch API</li><li>ajax的XMLHttpRequest</li><li>axios库</li><li>jQuery库……</li></ul></li><li>用工具<ul><li>接口测试工具，例如：Postman、Apifox等。</li><li>命令行工具：curl</li></ul></li></ul><p>对于我们编写的以下Controller来说：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span> <span class="comment">// 相当于@Controller + @ResponseBody ，默认是将数据转换成json字符串进行响应。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/detail&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">detail</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findUserById();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们使用了<code>@RestController</code>，也就是使用了<code>@ResponseBody</code>。因此默认支持的是返回JSON数据。怎么才能支持返回XML格式的数据呢？需要做以下两步：</p><p>第一步：引入一个依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第二步：在实体类上添加一个注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JacksonXmlRootElement</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后是接口的实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    User <span class="title function_">findUserById</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;jackson&quot;</span>, <span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>遇到问题：实际参数列表和形式参数列表长度不同、java: 无法将类xxx中的构造器xxx应用到给定类型| lombok相关</p><p>idea运行maven项目时，报错这个（如标题）<br>解决方案记录：<br>找到了之前的、能运行成功不报错的 maven项目。参考其pom.<a href="https://so.csdn.net/so/search?q=xml%E6%96%87%E4%BB%B6&spm=1001.2101.3001.7020">xml文件</a>中lombok相关部分，将<code>&lt;path&gt;</code>标签下的<a href="https://so.csdn.net/so/search?q=lombok&spm=1001.2101.3001.7020">lombok</a>加个版本号，就运行成功了：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.36<span class="tag">&lt;/<span class="name">version</span>&gt;</span>   // 添加了这行</span><br><span class="line"><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br></pre></td></tr></table></figure><p>接下来，我们使用<code>curl</code>命令行工具，来模拟发送请求，并在请求头中设置<code>Accept</code>：</p><p>![image-20250505173456946](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250505173456946.png)</p><p>可以很清楚的看到，服务器根据不同的请求头返回了不同格式的数据。</p><ul><li><code>Accept: application/xml</code>则返回XML格式的数据</li><li><code>Accept: application/json</code>则返回JSON格式的数据</li></ul><h4 id="通过请求参数（如-format）"><a href="#通过请求参数（如-format）" class="headerlink" title="通过请求参数（如 format）"></a>通过请求参数（如 format<font style="color:rgb(44, 44, 54);">）</font></h4><p>接下来我们使用请求参数的方式，来测试一下服务器的响应，注意：默认的请求参数名为<code>format</code>。</p><p>我们仍然使用<code>curl</code>命令行工具进行测试：</p><p>![image-20250507032900090](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250507032900090.png)</p><p>我们可以看到，并没有达到我们想要的效果，这是因为<code>SpringBoot优先考虑的不是通过请求参数format方式</code>。如何优先考虑使用<code>format</code>方式呢？做如下配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 采用format方式实现内容协商，如果没有配置这个选项，默认采用的是Accept字段方式实现内容协商。</span></span><br><span class="line"><span class="comment"># 注意format参数方式，参数名固定是 format</span></span><br><span class="line"><span class="attr">spring.mvc.contentnegotiation.favor-parameter</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><p>再次测试：</p><p>![image-20250507194814197](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250507194814197.png)</p><p>可以看到，现在SpringBoot已经优先考虑使用<code>请求参数format</code>方式了。</p><p>当然，请求参数的名字可以不使用<code>format</code>吗？支持定制化吗？答案是支持的，例如你希望请求参数的名字为<code>type</code>，可以做如下配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 内容协商时，设置请求参数的名字，默认为format</span></span><br><span class="line"><span class="attr">spring.mvc.contentnegotiation.parameter-name</span>=<span class="string">type</span></span><br></pre></td></tr></table></figure><p>再次使用<code>curl</code>工具进行测试：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730517197351-b400c853-b45b-474b-9380-53d4d901d697.png)</p><h3 id="HttpMessageConverter接口"><a href="#HttpMessageConverter接口" class="headerlink" title="HttpMessageConverter接口"></a>HttpMessageConverter接口</h3><h4 id="HttpMessageConverter的理解"><a href="#HttpMessageConverter的理解" class="headerlink" title="HttpMessageConverter的理解"></a>HttpMessageConverter的理解</h4><p><code>HttpMessageConverter</code>接口被翻译为：<code>Http消息转换器</code>。它起到转换<code>Http消息</code>的作用。</p><p>什么是<code>Http消息</code>？所谓的<code>Http消息</code>本质上就是浏览器向服务器发送请求时提交的数据，或者服务器向浏览器响应的数据。</p><p>而<code>HttpMessageConverter</code>接口就是负责完成<code>请求/响应</code>时的数据格式转换的。</p><p>在Spring MVC中提供了很多<code>HttpMessageConverter</code>接口的实现类，不同的<code>Http消息转换器</code>具有不同的转换效果，有的负责将Java对象转换为JSON格式的字符串，有的负责将Java对象转换成XML格式的字符串。</p><h4 id="常见的HttpMessageConverter"><a href="#常见的HttpMessageConverter" class="headerlink" title="常见的HttpMessageConverter"></a>常见的HttpMessageConverter</h4><p>内置的常见的<code>HttpMessageConverter</code>的实现类包括：</p><ul><li><font style="color:#DF2A3F;">【请求】提交的表单（form）数据转换成Java对象的主要任务是由 FormHttpMessageConverter 消息转换器完成的</font></li><li><font style="color:#DF2A3F;">【请求】提交的JSON数据转换成Java对象的主要任务是由 MappingJackson2HttpMessageConverter 消息转换器完成的。（我们通常使用的</font><code>&lt;font style=&quot;color:#DF2A3F;&quot;&gt;@RequestBody&lt;/font&gt;</code><font style="color:#DF2A3F;">注解）</font></li><li>【响应】将Java对象转换成JSON格式的数据，并将其写入HTTP响应体的任务是由 MappingJackson2HttpMessageConverter 消息转换器完成。（我们通常使用的<code>@ResponseBody</code>注解)</li><li>【响应】将Java对象转换成XML格式的数据，并将其写入HTTP响应体的任务通常由 Jaxb2RootElementHttpMessageConverter 消息转换器完成。</li><li>【响应】将 String 直接写入到响应体的任务是由 StringHttpMessageConverter 消息转换器完成。</li><li>……</li></ul><h4 id="请求时通过哪些条件确定使用哪个转换器"><a href="#请求时通过哪些条件确定使用哪个转换器" class="headerlink" title="请求时通过哪些条件确定使用哪个转换器"></a>请求时通过哪些条件确定使用哪个转换器</h4><p>请求时通常根据以下条件来确定使用哪个消息转换器：</p><ol><li>请求的 Content-Type 字段：</li></ol><p>Spring MVC 会检查请求的 Content-Type 字段，以确定请求体的数据格式（例如 application&#x2F;json、application&#x2F;x-www-form-urlencoded、application&#x2F;xml 等）。</p><ol start="2"><li>方法参数类型：</li></ol><p>控制器方法中接收请求体的参数类型（例如 @RequestBody）。</p><p>![image-20250515190721635](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250515190721635.png)</p><h4 id="响应时通过哪些条件确定使用哪个转换器"><a href="#响应时通过哪些条件确定使用哪个转换器" class="headerlink" title="响应时通过哪些条件确定使用哪个转换器"></a>响应时通过哪些条件确定使用哪个转换器</h4><p>响应时通常根据以下条件来确定使用哪个消息转换器：</p><ol><li>请求提交时，请求头上的Accept字段 ：</li></ol><p>Spring MVC 会检查客户端请求的 Accept 字段，以确定客户端期望的响应格式（例如 application&#x2F;json、application&#x2F;xml 等）。</p><ol start="2"><li>方法返回值类型：</li></ol><p>控制器方法的返回值类型（例如 @ResponseBody）。</p><p>例如1：@ResponseBody + 控制器方法的返回值是String，例如public String name(){}，则使用StringHttpMessageConverter转换器。（将字符串直接写入响应体）</p><p>例如2：@ResponseBody + 控制器方法的返回值是User，例如public User name(){}，则使用MappingJackson2HttpMessageConverter转换器。（将java对象转换成json格式的字符串写入到响应体）</p><p>![image-20250515190726743](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250515190726743.png)</p><h4 id="系统默认提供了哪些HttpMessageConverter"><a href="#系统默认提供了哪些HttpMessageConverter" class="headerlink" title="系统默认提供了哪些HttpMessageConverter"></a>系统默认提供了哪些HttpMessageConverter</h4><p>查看源码：</p><p>WebMvcAutoConfiguration.EnableWebMvcConfiguration extends DelegatingWebMvcConfiguration extends WebMvcConfigurationSupport</p><p><code>WebMvcAutoConfiguration</code>内部类<code>EnableWebMvcConfiguration</code></p><p><code>EnableWebMvcConfiguration</code>继承了<code>DelegatingWebMvcConfiguration</code></p><p><code>DelegatingWebMvcConfiguration</code>继承了<code>WebMvcConfigurationSupport</code></p><p>在<code>WebMvcConfigurationSupport</code>类中有这样一个方法：<code>addDefaultHttpMessageConverters()</code> 用来添加默认的<code>HttpMessageConverter</code>对象。</p><p>通过断点调试，可以发现默认支持6个HttpMessageConverter，如下：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730774897755-ad87ddc8-4700-40e4-baee-a28d94000e7a.png)</p><p>这6个<code>HttpMessageConverter</code>作用如下：</p><ol><li><strong>ByteArrayHttpMessageConverter:</strong></li></ol><p>用于将字节数组(byte[])与HTTP消息体之间进行转换。这通常用于处理二进制数据，如图片或文件。</p><ol start="2"><li><strong>StringHttpMessageConverter:</strong></li></ol><p>用于将字符串(String)与HTTP消息体之间进行转换。它支持多种字符集编码，能够处理纯文本内容。</p><ol start="3"><li><strong>ResourceHttpMessageConverter:</strong></li></ol><p>用于将Spring的Resource对象与HTTP消息体之间进行转换。Resource是Spring中表示资源的接口，可以读取文件等资源。这个转换器对于下载文件或发送静态资源有用。</p><ol start="4"><li><strong>ResourceRegionHttpMessageConverter:</strong></li></ol><p>用于处理资源的部分内容（即“Range”请求），特别是当客户端请求大文件的一部分时。这对于实现视频流媒体等功能很有用。</p><ol start="5"><li><strong>AllEncompassingFormHttpMessageConverter:</strong></li></ol><p>用于处理表单，是一个比较全面的form消息转换器。处理标准的application&#x2F;x-www-form-urlencoded格式的数据，以及包含文件上传的multipart&#x2F;form-data格式的数据。</p><ol start="6"><li><strong>MappingJackson2HttpMessageConverter:</strong></li></ol><p>使用Jackson库来序列化和反序列化JSON数据。可以将Java对象转换为JSON格式的字符串，反之亦然。</p><p>另外，通过以下源码，也可以看到SpringBoot是根据类路径中是否存在某个类，而决定是否添加对应的消息转换器的：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730775823305-dfc2b0c5-6ca1-4e8f-902b-506e3d86246d.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730775878229-960b3144-1727-4467-899a-6bd16f6bc965.png)</p><p>因此，我们只要引入相关的依赖，让类路径存在某个类，则对应的消息转换器就会被加载。</p><h3 id="定义自己的HttpMessageConverter"><a href="#定义自己的HttpMessageConverter" class="headerlink" title="定义自己的HttpMessageConverter"></a>定义自己的HttpMessageConverter</h3><p>可以看到以上6个消息转换器中没有yaml相关的消息转换器，可见，如果要实现yaml格式的内容协商，yaml格式的消息转换器就需要我们自定义了。</p><h4 id="第一步：引入能够处理yaml格式的依赖"><a href="#第一步：引入能够处理yaml格式的依赖" class="headerlink" title="第一步：引入能够处理yaml格式的依赖"></a>第一步：引入能够处理yaml格式的依赖</h4><p>任何一个能够处理yaml格式数据的库都可以，这里选择使用<code>jackson</code>的库，因为它既可以处理json，xml，又可以处理yaml。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--这个依赖也是jackson家族提供的，可以将java对象转换成yaml格式的字符串。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-yaml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>编写测试程序，简单测试一下这个库的用法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这只是一个测试程序，测试jackson家族提供的将对象转换成yaml格式字符串的api</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestYAMLApi</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建yamlfactory对象，输出--- username: &quot;jackson&quot; age: 30，这三个横是yaml文档里单独的文档标记，意思是独立文档</span></span><br><span class="line">        <span class="comment">//YAMLFactory yamlFactory = new YAMLFactory();</span></span><br><span class="line">        <span class="comment">//去掉这三个横的方式：disable是使失效的意思，把 写文档开始头 的给禁用</span></span><br><span class="line">        <span class="type">YAMLFactory</span> <span class="variable">yamlFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">YAMLFactory</span>().disable(YAMLGenerator.Feature.WRITE_DOC_START_MARKER);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建 对象映射器 对象，把yaml传进去就是专门做的一个yaml一个转换</span></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>(yamlFactory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 准备一个java对象</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;jackson&quot;</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将java对象转换成字符串</span></span><br><span class="line">        <span class="comment">// 到底转成什么格式取决于这个objectmapper传的工厂是什么</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> objectMapper.writeValueAsString(user);</span><br><span class="line">        System.out.println(str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果如下：</p><p>![image-20250523171507850](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250523171507850.png)</p><h4 id="第二步：新增一种媒体类型yaml"><a href="#第二步：新增一种媒体类型yaml" class="headerlink" title="第二步：新增一种媒体类型yaml"></a>第二步：新增一种媒体类型yaml</h4><p>默认支持xml和json两种媒体类型，并没有支持yaml，如果要支持yaml格式的，需要新增一个yaml媒体类型，在springboot的配置文件中进行如下配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新增一种媒体类型yaml</span></span><br><span class="line"><span class="comment"># 媒体类型的名字可以自定义。不一定叫做yaml。具体的媒体类型值也是可以修改的，不一定是 text/yaml</span></span><br><span class="line"><span class="comment"># 以下配置中媒体类型的名字是：yaml，媒体类型的值是：text/yaml</span></span><br><span class="line"><span class="comment">#在这里配置内容协商，后面的.yaml是类型，等号后面是媒体类型的名字，这个名字是随便写的，text是父媒体类型，yaml是子媒体类型</span></span><br><span class="line"><span class="comment"># http://localhost:8080?format=yaml</span></span><br><span class="line"><span class="attr">spring.mvc.contentnegotiation.media-types.yaml</span>=<span class="string">text/yaml</span></span><br></pre></td></tr></table></figure><p>注意，以上<code>types</code>后面的<code>yaml</code>是媒体类型的名字，名字随意，如果媒体类型起名为<code>xyz</code>，那么发送请求时的路径应该是这样的：<a href="http://localhost:8080/detail?format=xyz">http://localhost:8080/detail?format=xyz</a></p><h4 id="第三步：自定义HttpMessageConverter"><a href="#第三步：自定义HttpMessageConverter" class="headerlink" title="第三步：自定义HttpMessageConverter"></a>第三步：自定义HttpMessageConverter</h4><p>编写类<code>YamlHttpMessageConverter</code>继承<code>AbstractHttpMessageConverter</code>，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是一个消息转换器，专门处理yaml格式数据的。</span></span><br><span class="line"><span class="comment">// 注意，所有的消息转换器必须实现 HttpMessageConverter接口，或者继承AbstractHttpMessageConverter抽象类。并实现/重写方法。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">YamlHttpMessageConverter</span> <span class="keyword">extends</span> <span class="title class_">AbstractHttpMessageConverter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//对象映射器，定义成属性，给下面的将java对象转换成yaml格式的字符串用，new yamlFactory返回的也是yamlFactory</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>(<span class="keyword">new</span> <span class="title class_">YAMLFactory</span>().disable(YAMLGenerator.Feature.WRITE_DOC_START_MARKER));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 非常重要的一步：要将媒体类型 text/yaml 和 消息转换器进行绑定。通过构造方法，前面写媒体主类型，后面写媒体子类型，在配置文件里，Charset.forName是指定字符集</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">YamlHttpMessageConverter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="keyword">new</span> <span class="title class_">MediaType</span>(<span class="string">&quot;text&quot;</span>, <span class="string">&quot;yaml&quot;</span>, Charset.forName(<span class="string">&quot;UTF-8&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这个方法用来指定此消息转换器只适合于哪些类型的对象。</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Class clazz)</span> &#123;</span><br><span class="line">        <span class="comment">// 表示只有User类型的对象才能够使用该消息转换器进行转换。</span></span><br><span class="line">        <span class="keyword">return</span> User.class.isAnnotationPresent(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这个是将yaml格式的字符串转换成java对象</span></span><br><span class="line">    <span class="comment">// @RequestBody</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">readInternal</span><span class="params">(Class clazz, HttpInputMessage inputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotReadableException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将java对象转换成yaml格式的字符串</span></span><br><span class="line">    <span class="comment">// @ResponseBody</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">writeInternal</span><span class="params">(Object o, HttpOutputMessage outputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotWritableException &#123;</span><br><span class="line">        <span class="comment">// 要转换的话需要拿到一个ObjectMapper对象，就需要在上面创建一个对象映射器，通过这个去写</span></span><br><span class="line">        <span class="comment">// ObjectMapper对象，outputMessage.getBody()的执行结果是输出流，o是个java对象，传入这两个objectMapper就可以把这个对象转换成yaml格式的字符串</span></span><br><span class="line">        objectMapper.writeValue(outputMessage.getBody(), o);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="第四步：配置消息转换器"><a href="#第四步：配置消息转换器" class="headerlink" title="第四步：配置消息转换器"></a>第四步：配置消息转换器</h4><p>addefaultHttpjMessageConverters这个方法默认往整个容器当中添加httpmessage转换器，默认是加了六个转换器，现在往里面再配一个新的转换器，也就是配进去</p><p>重写<code>WebMvcConfigurer</code>接口的<code>configureMessageCongnverters</code>方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置的意思</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">webConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">        <span class="comment">// 将新的消息转换器进行配置，上面方法前面的list集合是消息转换器的集合，去调用这个converters</span></span><br><span class="line">        converters.add(<span class="keyword">new</span> <span class="title class_">YamlHttpMessageConverter</span>());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SpringBoot整合Thymeleaf"><a href="#SpringBoot整合Thymeleaf" class="headerlink" title="SpringBoot整合Thymeleaf"></a>SpringBoot整合Thymeleaf</h2><h3 id="传统web应用和前后端分离"><a href="#传统web应用和前后端分离" class="headerlink" title="传统web应用和前后端分离"></a>传统web应用和前后端分离</h3><p>如果你是做前后端分离的项目，这一章节的内容将用不上。</p><p>现代开发大部分应用都会采用前后端分离的方式进行开发，前端是一个独立的系统，后端也是一个独立的系统，后端系统只给前端系统提供数据（JSON数据），不需要后端解析模板页面，前端系统拿到后端提供的数据之后，前端负责填充数据即可。因此这一章节内容作为了解。</p><p>传统的WEB应用（非前后端分离）：浏览器页面上展示成什么效果，后端服务器说了算，这是传统web应用最大的特点。</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730789733440-1dc2d749-19c5-4363-b35d-bf6e6008265c.png)</p><p>前后端分离的应用：前端是一个独立的系统，后端也是一个独立的系统，后端系统不再负责页面的渲染，后端系统只负责给前端系统提供开放的API接口，后端系统只负责数据的收集，然后将数据以JSON&#x2F;XML等格式响应给前端系统。前端系统拿到接口返回的数据后，将数据填充到页面上。</p><p>![image-20250526035425532](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250526035425532.png)</p><p>前后端分离的好处：</p><ul><li>职责清晰：前端专注于用户界面和用户体验，后端专注于业务逻辑和数据处理。</li><li>开发效率高：前后端可以并行开发，互不影响，提高开发速度。</li><li>可维护性强：代码结构更清晰，便于维护和扩展。</li><li>技术栈灵活：前后端可以独立选择最适合的技术栈。</li><li>响应式设计：前端可以更好地处理不同设备和屏幕尺寸。</li><li>性能优化：前后端可以独立优化，提升整体性能。</li><li>易于测试：前后端接口明确，便于单元测试和集成测试。</li></ul><h3 id="SpringBoot整合Thymeleaf-1"><a href="#SpringBoot整合Thymeleaf-1" class="headerlink" title="SpringBoot整合Thymeleaf"></a>SpringBoot整合Thymeleaf</h3><p>Java的模板技术有很多，SpringBoot支持以下的模板技术：</p><ol><li><strong>Thymeleaf</strong>：<ul><li><strong>特点</strong>：Thymeleaf 是一个现代的服务器端Java模板引擎，它支持HTML5，XML，TEXT，JAVASCRIPT，CSS等多种模板类型。它能够在浏览器中预览，这使得前端开发更加便捷。Thymeleaf 提供了一套强大的表达式语言，可以轻松地处理数据绑定、条件判断、循环等。</li><li><strong>优势</strong>：<strong><font style="color:#DF2A3F;">与Spring框架集成良好，也是SpringBoot官方推荐的</font></strong>。</li></ul></li><li><strong>FreeMarker</strong>：<ul><li><strong>特点</strong>：FreeMarker 是一个用Java编写的模板引擎，主要用来生成文本输出，如HTML网页、邮件、配置文件等。它不依赖于Servlet容器，可以在任何环境中运行。</li><li><strong>优势</strong>：模板语法丰富，灵活性高，支持宏和函数定义，非常适合需要大量定制化的项目。</li></ul></li><li><strong>Velocity</strong>：<ul><li><strong>特点</strong>：Velocity 是另一个强大的模板引擎，最初设计用于与Java一起工作，但也可以与其他技术结合使用。它提供了简洁的模板语言，易于学习和使用。</li><li><strong>优势</strong>：轻量级，性能优秀，特别适合需要快速生成静态内容的应用。</li></ul></li><li><strong>Mustache</strong>：<ul><li><strong>特点</strong>：Mustache 是一种逻辑无感知的模板语言，可以用于多种编程语言，包括Java。它的设计理念是让模板保持简单，避免模板中出现复杂的逻辑。</li><li><strong>优势</strong>：逻辑无感知，确保模板的简洁性和可维护性，易于与前后端开发人员协作。</li></ul></li><li><strong>Groovy Templates</strong>：<ul><li><strong>特点</strong>：Groovy 是一种基于JVM的动态语言，它可以作为模板引擎使用。Groovy Templates 提供了非常灵活的模板编写方式，可以直接嵌入Groovy代码。</li><li><strong>优势</strong>：对于熟悉Groovy语言的开发者来说，使用起来非常方便，可以快速实现复杂逻辑。</li></ul></li></ol><p>这些模板技术各有千秋，选择哪一种取决于项目的具体需求和个人偏好。Spring Boot 对这些模板引擎都提供了良好的支持，通常只需要在项目中添加相应的依赖，然后按照官方文档配置即可开始使用。</p><p><font style="color:#DF2A3F;">提醒：SpringBoot内嵌了Servlet容器（例如：Tomcat、Jetty等），使用SpringBoot不太适合使用JSP模板技术，因为SpringBoot项目最终打成jar包之后，放在jar包中的jsp文件不能被Servlet容器解析。</font></p><p>要在SpringBoot中整合Thymeleaf，按照以下步骤操作：</p><p>第一步：引入thymeleaf启动器</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第二步：编写配置文件，指定前缀和后缀（<strong><font style="color:#DF2A3F;">默认不配置就是以下配置</font></strong>）</p><p>这个是给视图解析器使用的，方法里会有个返回值用于返回逻辑视图名称，如果返回的是一个hello，这时后端的视图解析器就起作用，把下面的前缀加在hello的前面，后缀加后面，变成classpath:&#x2F;templates&#x2F;hello.html，但这个不是html文件而是thymeleaf模板文件，这个就成了物理视图名称。引入web启动器的时候会在resources下自动生成这个文件目录</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.thymeleaf.prefix</span>=<span class="string">classpath:/templates/</span></span><br><span class="line"><span class="attr">spring.thymeleaf.suffix</span>=<span class="string">.html</span></span><br></pre></td></tr></table></figure><p>第三步：编写控制器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.springboot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不能使用 @RestController，这个是返回json，我们不能返回json，我们是跳页面</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/h&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">helloThymeleaf</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span> String name, Model model)</span> &#123;</span><br><span class="line">        <span class="comment">// 将接收到的name数据存储到域对象中</span></span><br><span class="line">        model.addAttribute(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">        <span class="comment">// 逻辑视图名</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>; <span class="comment">// 最终的物理视图名：classpath:/templates/hello.html</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第四步：编写thymeleaf模板页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>hello, thymeleaf<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello,<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>启动服务器，测试地址为：<a href="http://localhost:8080/hello?name=jackson">http://localhost:8080/hello?name=jackson</a></p><p>![image-20250526231739354](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250526231739354.png)</p><h3 id="Thymeleaf的自动配置"><a href="#Thymeleaf的自动配置" class="headerlink" title="Thymeleaf的自动配置"></a>Thymeleaf的自动配置</h3><p>Thymeleaf的自动配置类：<code>ThymeleafAutoConfiguration.java</code></p><p>@EnableConfigurationProperties这个注解可以把配置文件里的配置绑定到thymeleaf属性对象上，</p><p>![image-20250526232140913](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250526232140913.png)</p><p>我们通过查看上图中红框中的类，可以找到thymeleaf的相关配置：也就是以spring.thymeleaf前缀开头的配置信息绑定到属性类对象上</p><p>![image-20250526232506026](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250526232506026.png)</p><p>与thymeleaf相关的配置统一使用<code>spring.thymeleaf</code>即可。并且通过源码可以进一步了解到默认的前缀和后缀：</p><p>![image-20250526232938532](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250526232938532.png)</p><p>也就是说，默认情况下，只要放在<code>classpath:/templates/</code>目录下的<code>xxx.html</code>会被自动当做为thymeleaf的模板文件被thymeleaf模板引擎解析。因此放在<code>classpath:/templates/</code>目录下的<code>html</code>文件不是静态页面，而是动态的thymeleaf模板页面。</p><p>自定义的话修改配置文件</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.thymeleaf.prefix</span>=<span class="string">classpath:/t/</span></span><br><span class="line"><span class="attr">spring.thymeleaf.suffix</span>=<span class="string">.thymeleaf</span></span><br></pre></td></tr></table></figure><p>然后创建对应的文件</p><p>![image-20250526234327526](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250526234327526.png)</p><p>这时之前的hello.html就失效了</p><h3 id="Thymeleaf核心语法"><a href="#Thymeleaf核心语法" class="headerlink" title="Thymeleaf核心语法"></a>Thymeleaf核心语法</h3><h4 id="th-text与th-utext-替换标签体内容"><a href="#th-text与th-utext-替换标签体内容" class="headerlink" title="th:text与th:utext 替换标签体内容"></a>th:text与th:utext 替换标签体内容</h4><p><code>th:text</code>与th:utext都是用来替换标签体内容的，例如：如果什么都不写的效果是</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello,<span class="tag">&lt;<span class="name">span</span> &gt;</span>这里是标签体<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>![image-20250526234928844](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250526234928844.png)</p><p>注意：在根标签<html>中引入 xmlns:th&#x3D;”<a href="http://www.thymeleaf.org"/">http://www.thymeleaf.org&quot;</a>，在编写<code>th:</code>语法时有智能提示。</p><p>加上后就可以替换，运行效果为hello,jackson</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello,<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;name&#125;&quot;</span>&gt;</span>这里是标签体<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello,<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:utext</span>=<span class="string">&quot;$&#123;name&#125;&quot;</span>&gt;</span>这里是标签体<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试结果：![image-20250527001115509](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250527001115509.png)</p><p>提示：标签体中的内容即使是一段HTML代码，也只是会被当做普通文本对待。例如我们让存储在域中的文本内容是一段HTML代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span> String name, Model model)</span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">        <span class="comment">// 向域对象当中绑定一段html代码</span></span><br><span class="line">        model.addAttribute(<span class="string">&quot;htmlCode&quot;</span>,<span class="string">&quot;&lt;a href=&#x27;http://www.bjpowernode.com&#x27;&gt;动力节点&lt;/a&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;htmlCode&#125;&quot;</span>&gt;</span>我是一个DIV<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试结果：![image-20250527000813168](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250527000813168.png)</p><p><code>th:utext</code>会将内容当做一段HTML代码解析并替换。将以上测试代码修改为：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:utext</span>=<span class="string">&quot;$&#123;htmlCode&#125;&quot;</span>&gt;</span>我是一个DIV<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试结果：![image-20250527000930037](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250527000930037.png)</p><h4 id="th-任意属性名-动态替换该属性的值"><a href="#th-任意属性名-动态替换该属性的值" class="headerlink" title="th:任意属性名 动态替换该属性的值"></a>th:任意属性名 动态替换该属性的值</h4><p>分开设置：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 向域对象当中绑定公司名和公司地址</span></span><br><span class="line">model.addAttribute(<span class="string">&quot;company&quot;</span>, <span class="string">&quot;动力节点&quot;</span>);</span><br><span class="line">model.addAttribute(<span class="string">&quot;companyUrl&quot;</span>, <span class="string">&quot;http://www.bjpowernode.com&quot;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;companyUrl&#125;&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://www.baidu.com&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;company&#125;&quot;</span>&gt;</span>百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试结果：由![image-20250527002116948](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250527002133005.png)</p><p>也就是说th后面加了href就可以动态替换链接，加了text就可以替换文本</p><h4 id="th-attr-属性合并设置"><a href="#th-attr-属性合并设置" class="headerlink" title="th:attr 属性合并设置"></a>th:attr 属性合并设置</h4><p>分开设置：</p><p>合并设置：使用<code>th:attr</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 向域对象中存储一个样式</span></span><br><span class="line">model.addAttribute(<span class="string">&quot;style&quot;</span>, <span class="string">&quot;color:red&quot;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;companyUrl&#125;&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://www.baidu.com&quot;</span> <span class="attr">th:style</span>=<span class="string">&quot;$&#123;style&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color:green&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;company&#125;&quot;</span>&gt;</span>百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--属性合并--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:attr</span>=<span class="string">&quot;href=$&#123;companyUrl&#125;,style=$&#123;style&#125;&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://www.baidu.com&quot;</span>  <span class="attr">style</span>=<span class="string">&quot;color:green&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;company&#125;&quot;</span>&gt;</span>百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试结果：![image-20250527003204961](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250527003204961.png)</p><h4 id="th-指令"><a href="#th-指令" class="headerlink" title="th:指令"></a>th:指令</h4><p>指令非常多，具有代表性的例如：<code>th:if</code>，该指令用来控制元素<code>隐藏</code>和<code>显示</code>。true就是显示，flase就是不显示</p><p>在<code>static</code>静态资源目录下存放一张图片：dog1.jpg![image-20250527192830398](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250527192830398.png)</p><p>然后编写这样的模板代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--默认会去static去找这个文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;dog1.jpg&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试结果，图片是显示的：![image-20250527193044240](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250527193044240.png)</p><p>如果<code>th:if</code>的值修改为<code>false</code>，我们会发现隐藏了。</p><p>也可以通过网址参数进行控制，在hellocontroller里添加代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span> String name, Model model, <span class="meta">@RequestParam(&quot;flag&quot;)</span> Integer flag)</span>&#123;</span><br><span class="line">     <span class="comment">// 根据flag向域对象当中存储数据</span></span><br><span class="line">        <span class="comment">//可以通过</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="number">1</span> == flag)&#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;display&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == flag)&#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;display&quot;</span>, <span class="string">&quot;false&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--修改代码--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/Spring Boot 3/dog1.jpg&quot;</span>&gt;</span> </span><br><span class="line">~~~</span><br><span class="line"></span><br><span class="line">这时候访问图片就需要在http://localhost:8080/dog1.jpg里加上/myweb，如果需要@&#123;&#125;来进行维护，自动添加这些，代码是</span><br><span class="line"></span><br><span class="line">~~~html</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;$&#123;imgUrl&#125;&#125;&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;display&#125;&quot;</span>/&gt;</span></span><br><span class="line">~~~</span><br><span class="line"></span><br><span class="line">#### thymeleaf的内置工具</span><br><span class="line"></span><br><span class="line">内置工具很多，可以参考官方文档：[https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html#strings](</span><br><span class="line"></span><br><span class="line">![image-20250529014408038](./images/Spring Boot 3/image-20250529014408038.png)</span><br><span class="line"></span><br><span class="line">例如我们要完成这样一个效果，用户提交用户名时，如果名字中含有`jack`则显示`狗狗图片`，否则不显示。</span><br><span class="line"></span><br><span class="line">模板代码如下：</span><br><span class="line"></span><br><span class="line">```html</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;$&#123;imgUrl&#125;&#125;&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#strings.contains(name,&#x27;jack&#x27;)&#125;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试结果1：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730798493853-7e6e9545-f7dd-43b3-b157-7c853fb2da66.png)</p><p>测试结果2</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730798509202-cb67e7fe-f8ab-487e-ba9e-470ab50dcfbf.png)</p><h4 id="thymeleaf也支持运算符"><a href="#thymeleaf也支持运算符" class="headerlink" title="thymeleaf也支持运算符"></a>thymeleaf也支持运算符</h4><p>例如<code>&gt;</code>运算符，我们实现这样一个功能，如果提供的用户名长度大于6，则显示狗狗图片：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--名字长度大于6就为true--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;name&#125;&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#strings.length(name) &gt; 6&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试结果1：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730798722013-6be35719-74db-4349-86d9-d5c8b99f0d5b.png)</p><p>另外thymeleaf也支持三目运算符：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 向域对象当中存储一个性别</span></span><br><span class="line">model.addAttribute(<span class="string">&quot;gender&quot;</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p>如果性别是true，则显示男，false，则显示女。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--传进来的如果是true就是男，否则是女--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;gender ? &#x27;男&#x27; : &#x27;女&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="thymeleaf的字符串拼接"><a href="#thymeleaf的字符串拼接" class="headerlink" title="thymeleaf的字符串拼接"></a>thymeleaf的字符串拼接</h4><p>加单引号就是字符串，不加就是一个对象</p><p>第一种方式：使用加号 <code>+</code>，然后访问<a href="http://localhost:8080/hello?name=jackson&flag=1">http://localhost:8080/hello?name=jackson&amp;flag=1</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--strings.toUpperCase(name)是变大写--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello,<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;&#x27;姓名：&#x27; + #strings.toUpperCase(name) + &#x27;。&#x27;&#125;&quot;</span>&gt;</span>这里是标签体<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>![image-20250529021028901](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250529021028901.png)</p><p>第二种方式：使用竖线 <code>||</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello,<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;|姓名：$&#123;#strings.toUpperCase(name)&#125;。|&quot;</span>&gt;</span>这里是标签体<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>![image-20250529021241021](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250529021241021.png)</p><h4 id="循环遍历"><a href="#循环遍历" class="headerlink" title="循环遍历"></a>循环遍历</h4><p>创建bean包，user类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line">   <span class="keyword">private</span> Integer age;</span><br><span class="line">   <span class="keyword">private</span> Boolean gender;</span><br><span class="line">   <span class="keyword">private</span> String desc;</span><br><span class="line">   <span class="keyword">private</span> String location;</span><br></pre></td></tr></table></figure><p>创建service包，Userservice类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">getAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再创建impl，userserviceimpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 创建集合对象</span></span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;jackson&quot;</span>, <span class="number">20</span>, <span class="literal">true</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;BEIJING&quot;</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;lucy&quot;</span>, <span class="number">21</span>, <span class="literal">false</span>, <span class="string">&quot;my name is lucy&quot;</span>, <span class="string">&quot;TIANJIN&quot;</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;tom&quot;</span>, <span class="number">22</span>, <span class="literal">false</span>, <span class="string">&quot;my name is tom&quot;</span>, <span class="string">&quot;SHANGHAI&quot;</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;smith&quot;</span>, <span class="number">23</span>, <span class="literal">true</span>, <span class="string">&quot;my name is smith&quot;</span>, <span class="string">&quot;SHENZHEN&quot;</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;ford&quot;</span>, <span class="number">24</span>, <span class="literal">true</span>, <span class="string">&quot;my name is ford&quot;</span>, <span class="string">&quot;WUHAN&quot;</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;king&quot;</span>, <span class="number">24</span>, <span class="literal">true</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再在controller包下新建UserController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">list</span><span class="params">(Model model)</span>&#123;</span><br><span class="line">        <span class="comment">// 获取数据</span></span><br><span class="line">        List&lt;User&gt; users = userService.getAll();</span><br><span class="line">        <span class="comment">// 绑定到域对象中</span></span><br><span class="line">        model.addAttribute(<span class="string">&quot;user&quot;</span>, users);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;List&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后由ai生成了js和css样式，这里就不再复制</p><p>在templates里新建一个list.html</p><p>说明：</p><ul><li>${users}：代表集合</li><li>user：代表集合中的每个元素</li><li>${user.name}：元素的name属性值</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>动态表格示例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;&#x27;/style.css&#x27;&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>动态表格<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;add-row-form&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;姓名&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;电子邮件&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>添加行<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>序号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>简介<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>居住地<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>状态信息<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">id</span>=<span class="string">&quot;table-body&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--这里的user对应的是下面的user名称，都不是固定的，user是集合中的元素，在后面加个逗号可以传过来一个state状态对象，名字随便写--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 状态对象是保存循环过程中的一个状态信息的--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;user,state : $&#123;users&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.name&#125;&quot;</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.age&#125;&quot;</span>&gt;</span>30<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.gender ? &#x27;男&#x27; : &#x27;女&#x27;&#125;&quot;</span>&gt;</span>男<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.desc&#125;&quot;</span>&gt;</span>我是一个很棒的人<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--行内写法[[]]和[()]都可以，一样的效果--&gt;</span></span><br><span class="line">                状态信息：内联表达式<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                下标：[[$&#123;state.index&#125;]]<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                序号：[($&#123;state.count&#125;)]<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                当前对象：[($&#123;state.current&#125;)]<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                元素总数：[($&#123;state.size&#125;)]<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                是否为偶数行：[($&#123;state.even&#125;)]<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                是否为奇数行：[($&#123;state.odd&#125;)]<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                是否是第一个元素：[($&#123;state.first&#125;)]<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                是否是最后一个元素：[($&#123;state.last&#125;)]<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure><p>访问网址：<a href="http://localhost:8080/list">http://localhost:8080/list</a></p><p>![image-20250529033645437](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250529033645437.png)</p><p>注意：以上<code>[[${state.index}]]</code>这种语法属于thymeleaf中的<code>内联表达式</code>写法。也可以写成：<code>[(${state.index})]</code></p><p>另外，状态对象<code>state</code>的属性包括：</p><ul><li>index：下标</li><li>count：序号</li><li>current：当前对象</li><li>size：元素总数</li><li>even：是否为偶数行</li><li>odd：是否为奇数行</li><li>first：是否为第一个元素</li><li>last：是否为最后一个元素</li></ul><h4 id="条件判断th-if"><a href="#条件判断th-if" class="headerlink" title="条件判断th:if"></a>条件判断th:if</h4><p>th:if 语法用来决定元素是否显示：true显示。false隐藏。</p><div th:if="true">我是一个div元素</div>，则显示该div<div th:if="false">我也是一个div元素</div>，则隐藏该div<p>实现这样一个功能：用户如果没有留下简介，则显示<code>你比较懒没有留下任何介绍信息</code>，如果留下了简介，则显示具体的简介信息。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这两种写法都可以&lt;td th:if=&quot;为空&quot;&gt;你这个人很懒&lt;/td&gt;，为空就很懒，不为空就显示简介--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#strings.isEmpty(user.desc)&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;你这个人很懒&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #strings.isEmpty(user.desc)&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.desc&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="条件判断th-switch"><a href="#条件判断th-switch" class="headerlink" title="条件判断th:switch"></a>条件判断th:switch</h4><p>实现一个这样的功能：如果城市是beijing，就显示汉字北京，以此类推，其他值显示未知。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">th:switch</span>=<span class="string">&quot;$&#123;user.location&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:case</span>=<span class="string">&quot;BEIJING&quot;</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:case</span>=<span class="string">&quot;SHANGHAI&quot;</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:case</span>=<span class="string">&quot;TIANJIN&quot;</span>&gt;</span>天津<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:case</span>=<span class="string">&quot;WUHAN&quot;</span>&gt;</span>武汉<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:case</span>=<span class="string">&quot;SHENZHEN&quot;</span>&gt;</span>深圳<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:case</span>=<span class="string">&quot;*&quot;</span>&gt;</span>未知<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure><p>![image-20250529181805712](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250529181805712.png)</p><h4 id="thymeleaf属性优先级"><a href="#thymeleaf属性优先级" class="headerlink" title="thymeleaf属性优先级"></a>thymeleaf属性优先级</h4><p>thymeleaf的属性优先级非常重要，因为它直接决定了模板的解析和执行顺序。</p><p>以下是Thymeleaf属性的优先级从高到低的列表，以表格形式展示：</p><table><thead><tr><th>优先级</th><th>属性</th><th>描述</th></tr></thead><tbody><tr><td>1</td><td><code>th:if</code></td><td>如果条件为真，则渲染该元素。</td></tr><tr><td>2</td><td><code>th:unless</code></td><td>如果条件为假，则渲染该元素。</td></tr><tr><td>3</td><td><code>th:with</code></td><td>定义局部变量。</td></tr><tr><td>4</td><td><code>th:switch</code></td><td>开始一个 switch 语句。</td></tr><tr><td>5</td><td><code>th:case</code></td><td>定义 switch 语句中的 case 分支。</td></tr><tr><td>6</td><td><code>th:each</code></td><td>遍历列表，用于循环。</td></tr><tr><td>7</td><td><code>th:remove</code></td><td>移除元素或其属性。</td></tr><tr><td>8</td><td><code>th:attr</code></td><td>设置或修改元素的属性。</td></tr><tr><td>9</td><td><code>th:classappend</code></td><td>追加 CSS 类。</td></tr><tr><td>10</td><td><code>th:styleappend</code></td><td>追加内联样式。</td></tr><tr><td>11</td><td><code>th:src</code></td><td>设置元素的 <code>src</code> 属性。</td></tr><tr><td>12</td><td><code>th:href</code></td><td>设置元素的 <code>href</code> 属性。</td></tr><tr><td>13</td><td><code>th:value</code></td><td>设置元素的 <code>value</code> 属性。</td></tr><tr><td>14</td><td><code>th:text</code></td><td>设置元素的文本内容。</td></tr><tr><td>15</td><td><code>th:utext</code></td><td>设置元素的未转义文本内容。</td></tr><tr><td>16</td><td><code>th:html</code></td><td>设置元素的 HTML 内容。</td></tr><tr><td>17</td><td><code>th:fragment</code></td><td>定义模板片段。</td></tr><tr><td>18</td><td><code>th:insert</code></td><td>插入一个模板片段。</td></tr><tr><td>19</td><td><code>th:replace</code></td><td>替换当前元素为一个模板片段。</td></tr><tr><td>20</td><td><code>th:include</code></td><td>包含一个模板片段的内容。</td></tr><tr><td>21</td><td><code>th:block</code></td><td>用于逻辑分组，不产生任何HTML输出。</td></tr></tbody></table><p>对于thymeleaf属性优先级，我总结了以下一段话，把它记住即可：</p><p><strong>“先控制，再遍历，后操作，末内容。”</strong></p><p>具体来说：</p><ol><li><strong>先控制</strong>：<code>th:if</code> 和 <code>th:unless</code> 用于条件控制，决定是否渲染元素。</li><li><strong>再遍历</strong>：<code>th:each</code> 用于遍历列表，生成多个元素。</li><li><strong>后操作</strong>：<code>th:with</code>、<code>th:switch</code>、<code>th:case</code>、<code>th:remove</code>、<code>th:attr</code> 等用于局部变量定义、条件分支、属性操作等。</li><li><strong>末内容</strong>：<code>th:text</code>、<code>th:utext</code>、<code>th:html</code> 等用于设置元素的内容。</li></ol><h4 id="…-表达式"><a href="#…-表达式" class="headerlink" title="*{…} 表达式"></a>*{…} 表达式</h4><p><code>*{...}</code> 主要用于在上下文中访问对象的属性。这种表达式通常在表单处理和对象绑定场景中使用。</p><p><strong>语法</strong>：<code>*{property}</code>：访问当前**<font style="color:#DF2A3F;">上下文</font>**对象的某个属性。</p><p><strong>使用场景</strong></p><ul><li>表单绑定：在表单中绑定对象的属性。</li><li>对象属性访问：在模板中访问对象的属性，特别是当对象是当前上下文的一部分时。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--&lt;tr th:each=&quot;user,state : $&#123;users&#125;&quot;&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--将每一次循环的user对象作为tr上下文对象绑定，这样下面的user.就不用写了，外面的$改为*--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;user,state : $&#123;users&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;td th:text=&quot;$&#123;user.name&#125;&quot;&gt;张三&lt;/td&gt;</span></span><br><span class="line"><span class="comment">         &lt;td th:text=&quot;$&#123;user.age&#125;&quot;&gt;30&lt;/td&gt;--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;name&#125;&quot;</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;age&#125;&quot;</span>&gt;</span>30<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>示例</strong></p><ol><li><strong>表单绑定</strong></li></ol><p>假设你有一个 <code>User</code> 对象，包含 <code>name</code> 和 <code>age</code> 属性，你可以在表单中使用 <code>*{...}</code> 表达式来绑定这些属性：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/submit&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span>Name:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;name&#125;&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;age&quot;</span>&gt;</span>Age:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">id</span>=<span class="string">&quot;age&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;age&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在这个例子中：</p><ul><li><code>th:object=&quot;${user}&quot;</code> 将 <code>user</code> 对象设置为当前上下文对象。</li><li><code>th:field=&quot;*{name}&quot;</code> 和 <code>th:field=&quot;*{age}&quot;</code> 分别绑定到 <code>user</code> 对象的 <code>name</code> 和 <code>age</code> 属性。</li></ul><ol start="2"><li><strong>对象属性访问</strong></li></ol><p>假设你有一个 <code>User</code> 对象，包含 <code>name</code> 和 <code>age</code> 属性，你可以在模板中使用 <code>*{...}</code> 表达式来访问这些属性：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Name: <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;name&#125;&quot;</span>&gt;</span>Default Name<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Age: <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;age&#125;&quot;</span>&gt;</span>Default Age<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在这个例子中：</p><ul><li><code>th:object=&quot;${user}&quot;</code> 将 <code>user</code> 对象设置为当前上下文对象。</li><li><code>*{name}</code> 和 <code>*{age}</code> 分别访问 <code>user</code> 对象的 <code>name</code> 和 <code>age</code> 属性。</li></ul><p>**与 **<code>${...}</code> 的区别</p><ul><li><code>${...}</code>：标准表达式，用于访问模型中的变量和执行简单的表达式。</li><li><code>*{...}</code>：属性选择表达式，用于在上下文中访问对象的属性，通常与 <code>th:object</code> 一起使用。</li></ul><h4 id="代码片段共享"><a href="#代码片段共享" class="headerlink" title="代码片段共享"></a>代码片段共享</h4><p>片段是Thymeleaf中用于代码复用的基本机制。你可以将共享的部分提取到单独的HTML文件中，然后在其他模板中引用这些片段。</p><p>页面中公共的header.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--th:fragment的作用是把这段代码起个名叫h，方面以后用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span> <span class="attr">th:fragment</span>=<span class="string">&quot;h&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">nav</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--@&#123;/a&#125;的作用是绑定一个路径--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/a&#125;&quot;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/b&#125;&quot;</span>&gt;</span>About<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br></pre></td></tr></table></figure><p>页面中公共的footer.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">th:fragment</span>=<span class="string">&quot;f&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="symbol">&amp;copy;</span> 2024 北京动力节点<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在<code>a.html</code>中包含以上两个公共部分：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>主页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ~&#123;&#125;是专门用来做代码共享的，里面的header是文件名，引用在这，然后是h是代码片段的名字 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;~&#123;header :: h&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎来到主页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是主页的主要内容.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;~&#123;footer :: f&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在<code>b.html</code>中包含以上两个公共部分：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>关于我们<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;~&#123;header :: h&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>关于我们<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>动力节点专注IT培训16年.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;~&#123;footer :: f&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后在UserController里加上</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只编写一个控制器方法，不做任何业务逻辑，只是为了跳转视图。</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/a&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">a</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/b&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">b</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;b&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>效果图：![image-20250530171447529](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250530171447529.png)</p><p>主要作用是代码复用。实现此功能的主要代码：</p><ul><li><p>在公共代码部分使用<code>th:fragment=&quot;片段名称&quot;</code>来声明公共代码片段的名字。</p></li><li><p>在需要引入的地方使用<code>th:replace=&quot;~{文件名去掉后缀 :: 片段名称}&quot;</code>来引入。</p></li></ul><p><strong><font style="color:#DF2A3F;">小插曲：在springboot中如何实现：直接将请求路径映射到特定的视图，而不需要编写controller？</font></strong></p><p>以前是在springmvc配置文件中配置一个viewName对应的控制器，现在新建：</p><p>![image-20250530172345613](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250530172345613.png)</p><p>使用<code>ViewControllerRegistry</code>进行视图与控制器的注册</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基于springboot的自动配置扩展配置</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// 添加 视图控制器 与 视图名称 的映射关系</span></span><br><span class="line">        <span class="comment">// /a是视图控制器，a是视图名字，这样就不用在UserController里写方法了</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/a&quot;</span>).setViewName(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/b&quot;</span>).setViewName(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="thymeleaf页面修改如何立即生效"><a href="#thymeleaf页面修改如何立即生效" class="headerlink" title="thymeleaf页面修改如何立即生效"></a>thymeleaf页面修改如何立即生效</h3><p>第一步：引入springboot提供的<code>dev tools</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第二步：关闭应用重启功能，如果不关闭会导致每一次修改java代码后立即重启应用，不建议。我们现在只希望做到的功能是，修改thymeleaf模板文件后立即生效。</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#关闭应用重启功能</span></span><br><span class="line"><span class="attr">spring.devtools.restart.enabled</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure><p>第三步：修改代码后在IDEA中按组合键<code>ctrl+f9</code></p><p>以上三步配合即可。</p><h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><p><strong>在controller层如果程序出现了异常，并且这个异常未被捕获，springboot提供的异常处理机制将生效。</strong></p><p>Spring Boot 提供异常处理机制主要是为了提高应用的健壮性和用户体验。它的好处包括：</p><ol><li><strong>统一错误响应</strong>：可以定义全局异常处理器来统一处理各种异常，确保返回给客户端的错误信息格式一致，便于前端解析。</li><li><strong>提升用户体验</strong>：能够优雅地处理异常情况，避免直接将技术性错误信息暴露给用户，而是显示更加友好的提示信息。</li><li><strong>简化代码</strong>：开发者不需要在每个可能抛出异常的方法中重复编写异常处理逻辑，减少冗余代码，使业务代码更加清晰简洁。</li><li><strong>增强安全性</strong>：通过控制异常信息的输出，防止敏感信息泄露，增加系统的安全性。</li></ol><h3 id="自适应的错误处理机制"><a href="#自适应的错误处理机制" class="headerlink" title="自适应的错误处理机制"></a>自适应的错误处理机制</h3><p>springboot会根据请求头的Accept字段来决定错误的响应格式。</p><p>这种机制的好处就是：客户端设备自适应，提高用户的体验。</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731424148788-8a9c52cc-7683-479a-a8b8-9075d779bc4e.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1748680254183-2.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731424190201-4c9b9781-08ae-48f7-8b4a-9956b3b700d7.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1730804471502-31c64115-c49a-4d76-92e0-90e9ae543b32-1748680254183-2.png)</p><h3 id="SpringMVC的错误处理方案"><a href="#SpringMVC的错误处理方案" class="headerlink" title="SpringMVC的错误处理方案"></a>SpringMVC的错误处理方案</h3><p><strong><font style="color:#DF2A3F;">重点：如果程序员使用了SpringMVC的错误处理方案，SpringBoot的错误处理方案不生效。</font></strong></p><h4 id="局部控制-ExceptionHandler"><a href="#局部控制-ExceptionHandler" class="headerlink" title="局部控制 @ExceptionHandler"></a>局部控制 @ExceptionHandler</h4><p>在控制器当中编写一个方法，方法使用@ExceptionHandler注解进行标注，凡是<strong>这个控制器</strong>当中出现了<strong>对应的异常</strong>，则走这个方法来进行异常的处理。局部生效。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span><span class="comment">//响应json，相当于下面两个注解</span></span><br><span class="line"><span class="comment">/*@Controller</span></span><br><span class="line"><span class="comment">@ResponseBody*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// RESTFul风格</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/resource/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//被@ResponseBody标注了返回的如果是user对象，消息转换器返回的是json，这里已经是String了就会转换成String</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getResource</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;<span class="comment">//上面的id通过路径的方式传到这里的id</span></span><br><span class="line">        <span class="comment">// 通过http://localhost:8080/resource/2来正常运行，但如果改为1就会捕捉异常</span></span><br><span class="line">        <span class="keyword">if</span> (id == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">// IllegalArgumentException是lang包下的叫无效参数异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;无效ID：&quot;</span> + id);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span><span class="string">&quot;ID = &quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    下面的加这里</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="http://localhost:8080/resource/2%EF%BC%9A![image-20250531164616038]">http://localhost:8080/resource/2：![image-20250531164616038]</a>(.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250531164616038.png)</p><p><a href="http://localhost:8080/resource/1%EF%BC%9A%E8%BF%99%E6%98%AFspringboot%E8%87%AA%E5%B8%A6%E7%9A%84%E5%BC%82%E5%B8%B8">http://localhost:8080/resource/1：这是springboot自带的异常</a></p><p>![image-20250531164633636](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250531164633636.png)</p><p>用mvc局部方式，接着添加：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// springmvc中的异常处理方案：局部方式。</span></span><br><span class="line"><span class="comment">// 只有在UserController中发生 IllegalArgumentException 异常时，会走下面这个方法进行异常处理。</span></span><br><span class="line"><span class="comment">// 把异常类型传给这个注解，这句话的意思是只要当前这个控制器出现了异常，就会走这个方法</span></span><br><span class="line"><span class="comment">// 会把上面new的异常内存地址传到带有这个注解的方法参数上</span></span><br><span class="line"><span class="meta">@ExceptionHandler(IllegalArgumentException.class)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">handlerIllegalArgumentException</span><span class="params">(IllegalArgumentException e)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;错误信息：&quot;</span> + e.getMessage();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>![image-20250531170439631](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250531170439631.png)</p><p>可以再编写一个OtherController，让它也发生<code>IllegalArgumentException</code>异常，看看它会不会走局部的错误处理机制。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OtherController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/other/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getResource</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(id == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;无效ID：&quot;</span> + id);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ID = &quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="http://localhost:8080/other/1%EF%BC%8C%E4%BB%85%E5%B1%80%E9%83%A8%E7%94%9F%E6%95%88![image-20250531170706304]">http://localhost:8080/other/1，仅局部生效![image-20250531170706304]</a>(.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250531170706304.png)</p><h4 id="全局控制-ControllerAdvice-ExceptionHandler"><a href="#全局控制-ControllerAdvice-ExceptionHandler" class="headerlink" title="全局控制 @ControllerAdvice + @ExceptionHandler"></a>全局控制 @ControllerAdvice + @ExceptionHandler</h4><p>也可以把以上局部生效的方法单独放到一个类当中，这个类使用@ControllerAdvice注解标注，凡是<strong>任何控制器</strong>当中出现了<strong>对应的异常</strong>，则走这个方法来进行异常的处理。全局生效。</p><p>(弹幕里看到说有什么异常的话记得加上thymeleaf插件)</p><p>将之前的局部处理方案的代码注释掉。使用全局处理方式，编写以下类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @ControllerAdvice + @ExceptionHandler 可以用来定义全局异常处理器。</span></span><br><span class="line"><span class="comment">// 针对于所有的控制器都有效。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice</span><span class="comment">//注释掉表示springmvc不再管理这个异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(IllegalArgumentException.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span><span class="comment">//为什么之前在otherController不用加？因为使用了@RestController</span></span><br><span class="line">    <span class="comment">//不加就会认为下面return的是一个逻辑视图名字</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handlerIllegalArgumentException</span><span class="params">(IllegalArgumentException e)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;错误信息：&quot;</span> + e.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SpringBoot的错误处理方案"><a href="#SpringBoot的错误处理方案" class="headerlink" title="SpringBoot的错误处理方案"></a>SpringBoot的错误处理方案</h3><p><strong><font style="color:#DF2A3F;">重点：如果SpringMVC没有对应的处理方案，会开启SpringBoot默认的错误处理方案。</font></strong></p><p>SpringBoot默认的错误处理方案如下：</p><ol><li>如果客户端要的是json，则直接响应json格式的错误信息。</li><li>如果客户端要的是html页面，则按照下面方案：</li></ol><ul><li><p>第一步（精确错误码文件）：去<code>classpath:/templates/error/</code>目录下找<code>404.html``500.html</code>等<code>精确错误码.html</code>文件。如果找不到，则去静态资源目录下的&#x2F;error目录下找。如果还是找不到，才会进入下一步。</p></li><li><p>第二步（模糊错误码文件）：去<code>classpath:/templates/error/</code>目录下找<code>4xx.html``5xx.html</code>等<code>模糊错误码.html</code>文件。如果找不到，则去静态资源目录下的&#x2F;error目录下找。如果还是找不到，才会进入下一步。</p></li><li><p>第三步（通用错误页面）：去找<code>classpath:/templates/error.html</code>如果找不到则进入下一步。</p></li><li><p>第四步（默认错误处理）：如果上述所有步骤都未能找到合适的错误页面，Spring Boot 会使用内置的默认错误处理机制，即 <code>/error</code> 端点。</p></li></ul><p>比如随便输入一个没有任何html的文件网址，就会走第四步显示error错误</p><p>在文件下有这样的网页![image-20250531185737696](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250531185737696.png)</p><p>优先去templates找，但如果把这个404改成404a，精确查找找不到了就会桉顺序去找static下的404，直到四个路径都找不到了再进行模糊错误码查找</p><p>如果以上都没有了，就会去这里找，这是一个通用的错误</p><p>![image-20250531190534893](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250531190534893.png)</p><h3 id="如何在错误页获取错误信息"><a href="#如何在错误页获取错误信息" class="headerlink" title="如何在错误页获取错误信息"></a>如何在错误页获取错误信息</h3><p>Spring Boot 默认会在模型Model中放置以下信息：</p><ul><li>timestamp: 错误发生的时间戳</li><li>status: HTTP 状态码</li><li>error: 错误类型（如 “Not Found”）</li><li>exception: 异常类名</li><li>message: 错误消息</li><li>trace: 堆栈跟踪</li></ul><p>在thymeleaf中使用 <code>${message}</code>即可取出信息。</p><p>注意：**<font style="color:#DF2A3F;">springboot3.3.5</font>**版本默认只向Model对象中绑定了<code>timestamp``status``error</code>。如果要保存<code>exception``message``trace</code>，需要开启以下三个配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.error.include-stacktrace=always</span><br><span class="line">server.error.include-exception=true</span><br><span class="line">server.error.include-message=always</span><br></pre></td></tr></table></figure><p>在error里写上代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>error<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>error通用错误<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">异常发生时间：<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;timestamp&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">HTTP状态码：<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;status&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">错误类型：<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;error&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">异常类名：<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;exception&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">错误信息：<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;message&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">堆栈跟踪：<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;trace&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>![image-20250531191142990](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250531191142990.png)</p><p>配置后：</p><p>![image-20250531191222271](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250531191222271.png)</p><h3 id="前后端分离项目的错误处理方案"><a href="#前后端分离项目的错误处理方案" class="headerlink" title="前后端分离项目的错误处理方案"></a>前后端分离项目的错误处理方案</h3><p>统一使用SpringMVC的错误处理方案，定义全局的异常处理机制：@ControllerAdvice + @ExceptionHandler</p><p>返回json格式的错误信息，其它的就不需要管了，因为前端接收到错误信息怎么处理是他自己的事儿。</p><h3 id="服务器端负责页面渲染的项目错误处理方案"><a href="#服务器端负责页面渲染的项目错误处理方案" class="headerlink" title="服务器端负责页面渲染的项目错误处理方案"></a>服务器端负责页面渲染的项目错误处理方案</h3><p>建议使用SpringBoot的错误处理方案：</p><ol><li>如果发生的异常是HTTP错误状态码：<ol><li>建议常见的错误码给定<code>精确错误码.html</code></li><li>建议不常见的错误码给定<code>模糊错误码.html</code></li></ol></li><li>如果发生的异常不是HTTP错误状态码，而是业务相关异常：<ol><li>在程序中处理具体的业务异常，自己通过程序来决定跳转到哪个错误页面。</li></ol></li><li>建议提供<code>classpath:/templates/error.html</code>来处理通用错误。</li></ol><h2 id="国际化（了解）"><a href="#国际化（了解）" class="headerlink" title="国际化（了解）"></a>国际化（了解）</h2><p>在Spring Boot中实现国际化（i18n）(i到n之间有18个字母）是一个常见的需求，它允许应用程序根据用户的语言和地区偏好显示不同的文本。</p><h3 id="实现国际化"><a href="#实现国际化" class="headerlink" title="实现国际化"></a>实现国际化</h3><h4 id="第一步：创建资源文件"><a href="#第一步：创建资源文件" class="headerlink" title="第一步：创建资源文件"></a>第一步：创建资源文件</h4><p>创建包含不同语言版本的消息文件。这些文件通常放在<code>src/main/resources</code>目录下，并且以<code>.properties</code>为扩展名。例如：</p><ul><li><code>messages.properties</code> (默认语言，如英语)</li><li><code>messages_zh_CN.properties</code> (简体中文)</li><li><code>messages_fr.properties</code> (法语)</li></ul><p>注意这个zh_CN或者fr是固定的不能动，messages可以动</p><p>每个文件都应包含相同的消息键，但值应对应于相应的语言。例如：</p><p><strong>messages.properties</strong>:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">welcome.message</span>=<span class="string">Welcome to our application!</span></span><br></pre></td></tr></table></figure><p><strong>messages_zh_CN.properties</strong>:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">welcome.message</span>=<span class="string">欢迎来到我们的应用！</span></span><br></pre></td></tr></table></figure><p><strong>messages_fr.properties</strong>:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">welcome.message</span>=<span class="string">Bienvenue dans notre application !</span></span><br></pre></td></tr></table></figure><p>修改好后需要在settings里找到file encodings把字符设置成utf-8</p><h4 id="第二步：在模板文件中取出消息"><a href="#第二步：在模板文件中取出消息" class="headerlink" title="第二步：在模板文件中取出消息"></a>第二步：在模板文件中取出消息</h4><p>语法格式为：#{welcome.message}井号是资源文件当中的key</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>welcome<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--把配置文件中的前面那里拿过来--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;welcome.message&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>要跳转到这个页面还需要写个控制器</p><p>![image-20250601024131104](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250601024131104.png)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/welcome&quot;</span>).setViewName(<span class="string">&quot;welcome&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="http://localhost:8080/welcome![image-20250601024201624]">http://localhost:8080/welcome![image-20250601024201624]</a>(.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250601024201624.png)</p><p>如果将浏览器默认语言环境修改为法文</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731512808484-d61096e2-4d1d-446c-a26f-33c1505d76e4.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731512824927-f649b549-0add-4450-9dc3-9e2a4331c025.png)</p><h3 id="国际化实现原理"><a href="#国际化实现原理" class="headerlink" title="国际化实现原理"></a>国际化实现原理</h3><p>做国际化的自动配置类是：<code>MessageSourceAutoConfiguration</code></p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731513242246-ac4e59e3-a1e9-45c3-a346-41ae1b41f658.png)</p><p>通过以上源码得知，国际化对应的配置前缀是：<code>spring.message</code>，只要是这个开头的都会绑定到MessageSourceProperties上，这个文件的默认值就是message，但也可以修改</p><p>例如在<code>application.properties</code>中进行如下配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置国际化文件命名的基础名称</span></span><br><span class="line"><span class="attr">spring.messages.basename</span>=<span class="string">messages</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 指定国际化信息的字符编码方式</span></span><br><span class="line"><span class="attr">spring.messages.encoding</span>=<span class="string">UTF-8</span></span><br></pre></td></tr></table></figure><p>注意：标准标识符：en_US 和 zh_CN 这样的标识符是固定的，不能更改。可以设置的是basename。</p><h3 id="在程序当中如何获取国际化信息"><a href="#在程序当中如何获取国际化信息" class="headerlink" title="在程序当中如何获取国际化信息"></a>在程序当中如何获取国际化信息</h3><p>也就是通过java程序获取properties里面后面的那个welcome.message的配置信息</p><p>在国际化自动配置类中可以看到这样一个Bean：MessageSource，它是专门用来处理国际化的。我们可以将它注入到我们的程序中，然后调用相关方法在程序中获取国际化信息。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在java程序当中获取属性资源文件中的配置信息。</span></span><br><span class="line"><span class="comment">// 获取国际化的信息。</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MessageSource messageSource;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSource</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        <span class="comment">// 第一个是属性资源文件中的key（配置文件中的welcome.message就是key），第二个传个空，第三个传语言环境（通过浏览器发送请求，请求协议的请求头当中肯定有语言环境）</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> messageSource.getMessage(<span class="string">&quot;welcome.message&quot;</span>, <span class="literal">null</span>, request.getLocale());</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="定制web容器"><a href="#定制web容器" class="headerlink" title="定制web容器"></a>定制web容器</h2><h3 id="web服务器切换为jetty"><a href="#web服务器切换为jetty" class="headerlink" title="web服务器切换为jetty"></a>web服务器切换为jetty</h3><p>pringboot默认嵌入的web服务器是Tomcat，如何切换到jetty服务器？</p><p>实现方式：排除Tomcat，添加Jetty依赖</p><p>切换前：![image-20250601174925674](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250601174925674.png)</p><p>**修改 **<code>pom.xml</code> 文件：在 <code>pom.xml</code> 中，确保你使用 <code>spring-boot-starter-web</code> 并排除 Tomcat，然后添加 Jetty 依赖。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 排除 Tomcat --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 添加 Jetty 依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>再次重启就变成这样：![image-20250601175200907](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250601175200907.png)</p><h3 id="web服务器切换原理"><a href="#web服务器切换原理" class="headerlink" title="web服务器切换原理"></a>web服务器切换原理</h3><p>从哪里可以看出springboot是直接将tomcat服务器嵌入到应用中的呢？看这个类：<code>ServletWebServerFactoryAutoConfiguration</code></p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731572949358-481582b6-0e79-4f4c-b556-b1ec3c13882c.png)</p><p>以上代码显示嵌入的是3个服务器。但并不是都生效，我们来看一下生效条件：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731573044414-b1cb4767-de21-4897-9d38-36e6382a8581.png)</p><p>生效条件是，看类路径当中是否有对应服务器相关的类，如果有则生效。<code>spring-boot-web-starter</code>这个web启动器引入的时候，大家都知道，它间接引入的是tomcat服务器的jar包。因此默认Tomcat服务器被嵌入。如果想要切换web服务器，将tomcat相关jar包排除掉，引入jetty的jar包之后，jetty服务器就会生效，这就是切换web服务器的原理。</p><h3 id="web服务器优化"><a href="#web服务器优化" class="headerlink" title="web服务器优化"></a>web服务器优化</h3><p>通过以下源码得知，web服务器的相关配置和<code>ServerProperties</code>有关系：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731573299936-414ae5c8-87a8-4810-b448-ac1b67f3cfb2.png)</p><p>查看<code>ServerProperties</code>源码：</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731573337370-7d40853c-9c5a-4750-a40d-cf00d1528fb4.png)</p><p>得知web服务器的配置都是以<code>server</code>开头的。</p><p>那么如果要配置tomcat服务器怎么办？要配置jetty服务器怎么办？请看一下源码</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731573416792-229c5dbb-4a42-4037-934d-bd004bc46a7d.png)</p><p>![](.&#x2F;images&#x2F;Spring Boot 3&#x2F;1731573452454-a150e6b1-6fa0-411c-b2a5-063f5b03be6b.png)</p><p>通过以上源码得知，如果要对tomcat服务器进行配置，前缀为：<code>server.tomcat</code></p><p>如果要对jetty服务器进行配置，前缀为：<code>server.jetty</code>。</p><p>在以后的开发中关于tomcat服务器的常见优化配置有：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这个参数决定了 Tomcat 在接收请求时，如果在指定的时间内没有收到完整的请求数据，将会关闭连接。这个超时时间是从客户端发送请求开始计算的。</span></span><br><span class="line"><span class="comment"># 防止长时间占用资源：如果客户端发送请求后，长时间没有发送完所有数据，Tomcat 会在这个超时时间内关闭连接，从而释放资源，避免资源被长时间占用。</span></span><br><span class="line"><span class="attr">server.tomcat.connection-timeout</span>=<span class="string">20000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 设置 Tomcat 服务器处理请求的最大线程数为 200。</span></span><br><span class="line"><span class="comment"># 如果超过这个数量的请求同时到达，Tomcat 会将多余的请求放入一个等待队列中。</span></span><br><span class="line"><span class="comment"># 如果等待队列也满了（由 server.tomcat.accept-count 配置），新的请求将被拒绝，通常会返回一个“503 Service Unavailable”错误。</span></span><br><span class="line"><span class="attr">server.tomcat.max-threads</span>=<span class="string">200</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 用来设置等待队列的最大容量，也就是301时会返回一个503错误</span></span><br><span class="line"><span class="attr">server.tomcat.accept-count</span>=<span class="string">100</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 设置 Tomcat 服务器在空闲时至少保持 10 个线程处于活动状态，以便快速响应新的请求。</span></span><br><span class="line"><span class="attr">server.tomcat.min-spare-threads</span>=<span class="string">10</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 允许 Tomcat 服务器在关闭后立即重新绑定相同的地址和端口，即使该端口还在 TIME_WAIT 状态</span></span><br><span class="line"><span class="comment"># 当一个网络连接关闭时，操作系统会将该连接的端口保持在 TIME_WAIT 状态一段时间（通常是 2-4 分钟），以确保所有未完成的数据包都能被正确处理。在这段时间内，该端口不能被其他进程绑定。</span></span><br><span class="line"><span class="attr">server.tomcat.address-reuse-enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 设置 Tomcat 服务器绑定到所有可用的网络接口，使其可以从任何网络地址访问。</span></span><br><span class="line"><span class="attr">server.tomcat.bind-address</span>=<span class="string">0.0.0.0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 设置 Tomcat 服务器使用 HTTP/1.1 协议处理请求。</span></span><br><span class="line"><span class="attr">server.tomcat.protocol</span>=<span class="string">HTTP/1.1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 设置 Tomcat 服务器的会话(session)超时时间为 30 分钟。具体来说，如果用户在 30 分钟内没有与应用进行任何交互，其会话将被自动注销。</span></span><br><span class="line"><span class="attr">server.tomcat.session-timeout</span>=<span class="string">30</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 设置 Tomcat 服务器的静态资源缓存时间为 3600 秒（即 1 小时），这意味着浏览器会在 1 小时内缓存这些静态资源，减少重复请求。</span></span><br><span class="line"><span class="attr">server.tomcat.resource-cache-period</span>=<span class="string">3600</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 解决get请求乱码。对请求行url进行编码。</span></span><br><span class="line"><span class="attr">server.tomcat.uri-encoding</span>=<span class="string">UTF-8</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 设置 Tomcat 服务器的基础目录为当前工作目录（. 表示当前目录）。这个配置指定了 Tomcat 服务器的工作目录，包括日志文件、临时文件和其他运行时生成的文件的存放位置。 生产环境中可能需要重新配置。</span></span><br><span class="line"><span class="attr">server.tomcat.basedir</span>=<span class="string">.</span></span><br></pre></td></tr></table></figure><h1 id="第6章-SpringBoot实用技术整合"><a href="#第6章-SpringBoot实用技术整合" class="headerlink" title="第6章 SpringBoot实用技术整合"></a>第6章 SpringBoot实用技术整合</h1><h2 id="logo设置"><a href="#logo设置" class="headerlink" title="logo设置"></a>logo设置</h2><h3 id="关闭logo图标"><a href="#关闭logo图标" class="headerlink" title="关闭logo图标"></a>关闭logo图标</h3><p>就是这个东西![image-20250601180758039](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250601180758039.png)</p><h4 id="配置方式"><a href="#配置方式" class="headerlink" title="配置方式"></a>配置方式</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.main.banner-mode</span>=<span class="string">off</span></span><br><span class="line"><span class="comment">#默认是console打印到控制台上</span></span><br><span class="line"><span class="comment">#off是关闭，log是打印到日志文件上</span></span><br></pre></td></tr></table></figure><h4 id="代码方式"><a href="#代码方式" class="headerlink" title="代码方式"></a>代码方式</h4><p>第一种代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot322WebServerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//SpringApplication.run(Springboot322WebServerApplication.class, args);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭logo使用代码方式实现（第一种</span></span><br><span class="line">        <span class="type">SpringApplication</span> <span class="variable">springApplication</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringApplication</span>(Springboot322WebServerApplication.class);</span><br><span class="line">        springApplication.setBannerMode(Banner.Mode.OFF);</span><br><span class="line">        springApplication.run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第二种代码：流式编程&#x2F;链式编程</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot322WebServerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//SpringApplication.run(Springboot322WebServerApplication.class, args);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 流式编程/链式编程（第二种</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>()</span><br><span class="line">                .sources(Springboot322WebServerApplication.class)</span><br><span class="line">                .bannerMode(Banner.Mode.OFF)</span><br><span class="line">                .run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="修改logo图标"><a href="#修改logo图标" class="headerlink" title="修改logo图标"></a>修改logo图标</h3><p>在<code>src/main/resources</code>目录下存放一个<code>banner.txt</code>文件。文件名固定。</p><p>利用一些网站生成图标：</p><p><a href="https://www.bootschool.net/ascii">https://www.bootschool.net/ascii</a> （支持中文、英文）</p><p><a href="http://patorjk.com/software/taag/">http://patorjk.com/software/taag/</a> （只支持英文）</p><p><a href="https://www.degraeve.com/img2txt.php">https://www.degraeve.com/img2txt.php</a> （只支持图片）</p><p>获取图标粘贴到<code>banner.txt</code>文件中运行程序即可。</p><h2 id="PageHelper整合"><a href="#PageHelper整合" class="headerlink" title="PageHelper整合"></a>PageHelper整合</h2><p>官网地址：<a href="https://pagehelper.github.io/">https://pagehelper.github.io/</a></p><h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VipController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VipService vipService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list/&#123;pageNo&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> PageInfo&lt;Vip&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@PathVariable(&quot;pageNo&quot;)</span> Integer pageNo)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.设置当前页码和每页显示的记录条数</span></span><br><span class="line">        PageHelper.startPage(pageNo, Constant.PAGE_SIZE);</span><br><span class="line">        <span class="comment">// 2.获取数据（PageHelper会自动给SQL语句添加limit）</span></span><br><span class="line">        List&lt;Vip&gt; vips = vipService.findAll();</span><br><span class="line">        <span class="comment">// 3.将分页数据封装到PageInfo</span></span><br><span class="line">        PageInfo&lt;Vip&gt; vipPageInfo = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(vips);</span><br><span class="line">        <span class="keyword">return</span> vipPageInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>新建项目引入![image-20250601182848347](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250601182848347.png)</p><p>然后用mybatis工程逆向生成，右击数据库的表选择![image-20250601182926687](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250601182926687.png)</p><p>生成了以下这些文件：![image-20250602030329716](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250602030329716.png)</p><p>然后把这些文件都重新写一下</p><p>Vipmapper.java:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">VipMapper</span> &#123;</span><br><span class="line">  List&lt;Vip&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>VipMapper.xml:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.ph.repository.VipMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.powernode.ph.bean.Vip&quot;</span>&gt;</span></span><br><span class="line">    select * from t_vip</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>application.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">springboot3-23-ph</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 数据源配置</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">liuqi3711022</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/springboot</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># mybatis配置(说确保表里的cardnumber与bean的vip里的cardnumber对应上</span></span><br><span class="line"><span class="attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># 这个是mapper配置文件</span></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:/mapper/*.xml</span></span><br></pre></td></tr></table></figure><p>然后主入口程序：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这样可以扫描到vipmapper</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.powernode.ph.repository&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot323PhApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Springboot323PhApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>包的路径复制可以使用以下操作：右击文件夹然后选择copypath</p><p>![image-20250602025817341](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250602025817341.png)</p><p>![image-20250602025833119](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250602025833119.png)</p><p>然后创建以下：![image-20250602030943496](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250602030943496.png)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">VipService</span> &#123;</span><br><span class="line">    List&lt;Vip&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VipServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">VipService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VipMapper vipMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Vip&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> vipMapper.selectAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后新建Controller包和VipController类，引入时可以设置每页显示的数量为一个常数，新建util包和Constant类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 系统常量类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Constant</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 每页显示3条记录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">PAGE_SIZE</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VipController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VipService vipService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// RESTFul编程风格</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/List/&#123;pageNo&#125;&quot;)</span><span class="comment">//这个括号会传进来页码</span></span><br><span class="line">    <span class="keyword">public</span> PageInfo&lt;Vip&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">int</span> pageNo)</span>&#123;</span><br><span class="line">        <span class="comment">// 1.设置当前页码和每页显示的记录条数</span></span><br><span class="line">        <span class="comment">// 这条语句执行时PageHelper会自动为查询语句添加limit ，再执行下面的findAll，虽然查询语句是*，但不会全查</span></span><br><span class="line">        PageHelper.startPage(pageNo, Constant.PAGE_SIZE);</span><br><span class="line">        <span class="comment">// 2.查询数据</span></span><br><span class="line">        List&lt;Vip&gt; vips = vipService.findAll();</span><br><span class="line">        <span class="comment">// 3.将数据封装到PageInfo对象当中即可</span></span><br><span class="line">        PageInfo&lt;Vip&gt; vipPageInfo = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(vips);</span><br><span class="line">        <span class="keyword">return</span> vipPageInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后访问<a href="http://localhost:8080/list/1">http://localhost:8080/list/1</a></p><h2 id="web层响应结果封装"><a href="#web层响应结果封装" class="headerlink" title="web层响应结果封装"></a>web层响应结果封装</h2><p>web层其实就是Controller层，对于前后端分离的系统来说，为了降低沟通成本，我们有必要给前端系统开发人员返回统一格式的JSON数据。多数开发团队一般都会封装一个<code>R</code>对象来解决统一响应格式的问题。</p><h3 id="封装R对象"><a href="#封装R对象" class="headerlink" title="封装R对象"></a>封装R对象</h3><p>在上面的代码继续新建result包，新建一个类R</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统一的WEB层返回数据。统一格式，降低前后端沟通成本。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">// 响应的状态码: 200、500、404</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="comment">// 响应的消息描述：成功，失败，删除失败，修改失败，添加失败</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="comment">// 响应的对象：支持任意类型的对象</span></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为了方便返回数据，一般这里的方法都是静态方法。</span></span><br><span class="line">    <span class="comment">// 方法一般包括两大类：一类是成功，一类是失败。（重载）</span></span><br><span class="line">    <span class="comment">// 响应成功的消息，但是不携带任何数据，因为不一定每次返回R对象都会有数据data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">OK</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">                .code(<span class="number">200</span>)</span><br><span class="line">                .msg(<span class="string">&quot;成功&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 响应成功的消息，携带数据data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">OK</span><span class="params">(T data)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">                .code(<span class="number">200</span>)</span><br><span class="line">                .msg(<span class="string">&quot;成功&quot;</span>)</span><br><span class="line">                .data(data)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 响应失败的消息。默认的code是400，失败的消息：失败</span></span><br><span class="line">    <span class="comment">// 失败是不可能携带数据。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">FAIL</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">                .code(<span class="number">400</span>)</span><br><span class="line">                .msg(<span class="string">&quot;失败&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 响应失败的消息，controller层的程序员可以通过此方法指定特定的code和特定的消息。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">FAIL</span><span class="params">(<span class="type">int</span> code, String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">                .code(code)</span><br><span class="line">                .msg(msg)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果出现了builder错误，就看<a href="https://blog.csdn.net/weixin_69669164/article/details/146015501?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1-146015501-blog-134867178.235%5Ev43%5Epc_blog_bottom_relevance_base3&spm=1001.2101.3001.4242.2&utm_relevant_index=3">https://blog.csdn.net/weixin_69669164/article/details/146015501?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1-146015501-blog-134867178.235^v43^pc_blog_bottom_relevance_base3&amp;spm=1001.2101.3001.4242.2&amp;utm_relevant_index=3</a></p><p>测试数据</p><p>再新建个bean的User</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后vipController添加</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/detail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;User&gt; <span class="title function_">detail</span><span class="params">()</span>&#123;<span class="comment">// 是下面return返回的</span></span><br><span class="line">    <span class="comment">// 这个数据是service返回的数据</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;jackson&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    <span class="comment">// 相应给前端</span></span><br><span class="line">    <span class="comment">//return R.OK(user);</span></span><br><span class="line">    <span class="comment">//return R.OK();// 不携带数据</span></span><br><span class="line">    <span class="comment">//return R.FAIL();</span></span><br><span class="line">    <span class="keyword">return</span> R.FAIL(<span class="number">404</span>, <span class="string">&quot;资源找不到&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="改进R对象"><a href="#改进R对象" class="headerlink" title="改进R对象"></a>改进R对象</h3><p>以上<code>R</code>对象存在的问题是，难以维护，项目中可能会出现很多这样的代码：R.FAIL(400, “修改失败”)。</p><p>引入枚举类型进行改进：创建enums包和codeEnum类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 专门维护code+msg的一个枚举类型</span></span><br><span class="line"><span class="comment">//@Data 不能用data，就需要手动添加setter getter注解或者方法</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="comment">//@Setter这里也不能添加</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">CodeEnum</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ;</span></span><br><span class="line">    <span class="comment">//这地方没有写枚举值，那么由于后面有其他代码，这里至少要写一个“;”</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//这些会传到下面的字段上，统一去维护</span></span><br><span class="line">    OK(<span class="number">200</span>, <span class="string">&quot;成功&quot;</span>),</span><br><span class="line">    FAIL(<span class="number">400</span>, <span class="string">&quot;失败&quot;</span>),</span><br><span class="line">    BAD_REQUEST(<span class="number">400</span>, <span class="string">&quot;请求错误&quot;</span>),</span><br><span class="line">    NOT_FOUND(<span class="number">404</span>, <span class="string">&quot;Not Found&quot;</span>),</span><br><span class="line">    INTERNAL_ERROR(<span class="number">500</span>, <span class="string">&quot;内部服务器错误&quot;</span>),</span><br><span class="line">    MODIFICATION_FAILED(<span class="number">400</span>, <span class="string">&quot;修改失败&quot;</span>),</span><br><span class="line">    DELETION_FAILED(<span class="number">400</span>, <span class="string">&quot;删除失败&quot;</span>),</span><br><span class="line">    CREATION_FAILED(<span class="number">400</span>, <span class="string">&quot;创建失败&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// javase当中详细讲过枚举类型</span></span><br><span class="line">    <span class="comment">// 枚举类型当中可以有属性</span></span><br><span class="line">    <span class="comment">// 枚举类型当中可以有构造方法</span></span><br><span class="line">    <span class="comment">// 枚举类型当中可以有setter和getter方法。</span></span><br><span class="line">    <span class="comment">// 在枚举类型当中有一个语法要求，枚举的大括号一开始的位置必须编写枚举值。</span></span><br><span class="line">    <span class="comment">// 每一个枚举值就是一个枚举类型的实例。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Setter</span><span class="comment">// 只能加在字段上</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Season</span> &#123;</span><br><span class="line">    <span class="comment">// 这些就是枚举值</span></span><br><span class="line">    <span class="comment">// 其中每一个枚举值都是 Season类型的对象/实例。</span></span><br><span class="line">    SPRING, SUMMER, AUTUMN, WINTER;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 枚举值下面如果没有代码，枚举值列表最后的那个“;”可以省略。</span></span><br><span class="line">    <span class="comment">// 枚举值下面如果有代码，则枚举值列表最后的&quot;;&quot;是不能省略的。</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>改进R：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span> <span class="comment">// 建造模式</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">// 响应的状态码: 200、500、404</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="comment">// 响应的消息描述：成功，失败，删除失败，修改失败，添加失败</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="comment">// 响应的对象：支持任意类型的对象</span></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为了方便返回数据，一般这里的方法都是静态方法。</span></span><br><span class="line">    <span class="comment">// 方法一般包括两大类：一类是成功，一类是失败。（重载）</span></span><br><span class="line">    <span class="comment">// 响应成功的消息，但是不携带任何数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">OK</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">                .code(CodeEnum.OK.getCode())</span><br><span class="line">                .msg(CodeEnum.OK.getMsg())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 响应成功的消息，携带数据data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">OK</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">                .code(CodeEnum.OK.getCode())</span><br><span class="line">                .msg(CodeEnum.OK.getMsg())</span><br><span class="line">                .data(data)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 响应失败的消息。默认的code是400，失败的消息：失败</span></span><br><span class="line">    <span class="comment">// 失败是不可能携带数据。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">FAIL</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">                .code(CodeEnum.FAIL.getCode())</span><br><span class="line">                .msg(CodeEnum.FAIL.getMsg())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 响应失败的消息，controller层的程序员可以通过此方法指定特定的code和特定的消息。</span></span><br><span class="line">    <span class="comment">/*public static &lt;T&gt; R&lt;T&gt; FAIL(int code, String msg) &#123;</span></span><br><span class="line"><span class="comment">        return R.&lt;T&gt;builder()</span></span><br><span class="line"><span class="comment">                .code(code)</span></span><br><span class="line"><span class="comment">                .msg(msg)</span></span><br><span class="line"><span class="comment">                .build();</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 改成了传入一个codeEnum对象，然后调用里面的方法，获得code和msg</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">FAIL</span><span class="params">(CodeEnum codeEnum)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.&lt;T&gt;builder()</span><br><span class="line">                .code(codeEnum.getCode())</span><br><span class="line">                .msg(codeEnum.getMsg())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改VipController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/detail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;User&gt; <span class="title function_">detail</span><span class="params">()</span>&#123;<span class="comment">// 是下面return返回的</span></span><br><span class="line">    <span class="comment">// 这个数据是service返回的数据</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;jackson&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    <span class="comment">// 相应给前端</span></span><br><span class="line">    <span class="comment">//return R.OK(user);</span></span><br><span class="line">    <span class="comment">//return R.OK();// 不携带数据</span></span><br><span class="line">    <span class="comment">//return R.FAIL();</span></span><br><span class="line">    <span class="comment">//return R.FAIL(404, &quot;资源找不到&quot;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//改进后的写法：这样就传过去了一个codeEnum对象到Rjava里的方法上</span></span><br><span class="line">    <span class="keyword">return</span> R.FAIL(CodeEnum.NOT_FOUND);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h2><p>SpringBoot中的事务管理仍然使用的Spring框架中的事务管理机制，在代码实现上更为简单了。不需要手动配置事务管理器，SpringBoot自动配置完成了。我们只需要使用<code>@Transactional</code>注解标注需要控制事务的方法即可。另外事务的特性等仍然延用Spring框架。大家可以在老杜发布的Spring视频教程中详细学习事务管理机制。以下代码是在SpringBoot框架中进行的事务控制：</p><p>创建bean包account类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String actNo; <span class="comment">// 数据库字段名 act_no</span></span><br><span class="line">    <span class="keyword">private</span> Double balance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建repository包AccountMapper类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据账号获取账户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> actNo 账号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 账户对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Account <span class="title function_">selectByActNo</span><span class="params">(String actNo)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新账户信息，注意账号不能更新，其他字段都可以更新。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> account 账户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 1表示更新成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Account account)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后使用mybatis插件生成mapper文件![image-20250603015727039](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250603015727039.png)</p><p>生成到resources的mapper文件</p><p>然后挨个生成查询语句</p><p>![image-20250603015909182](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250603015909182.png)</p><p>AccountMapper.xml:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.powernode.transaction.repository.AccountMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">        update t_act set balance = #&#123;balance&#125; where act_no = #&#123;actNo&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByActNo&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Account&quot;</span>&gt;</span></span><br><span class="line">        select * from t_act where act_no = #&#123;actNo&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>入口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//扫描</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.powernode.transaction.repository&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Spingboot324TransactionApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Spingboot324TransactionApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置文件：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据源</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">liuqi3711022</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/springboot</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># mybatis</span></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:/mapper/*.xml</span></span><br><span class="line"><span class="attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">mybatis.type-aliases-package</span>=<span class="string">com.powernode.transaction.bean</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.error.include-message</span>=<span class="string">always</span></span><br></pre></td></tr></table></figure><p>在service下新建AccountService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 转账的业务方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fromActNo 转出账号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> toActNo 转入账号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money 转账金额</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String fromActNo, String toActNo, <span class="type">double</span> money)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>实现接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class, propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String fromActNo, String toActNo, <span class="type">double</span> money)</span> &#123;</span><br><span class="line">        <span class="comment">// 转账的业务逻辑</span></span><br><span class="line">        <span class="comment">// 判断转出账户的余额是否足够</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">fromAct</span> <span class="operator">=</span> accountMapper.selectByActNo(fromActNo);</span><br><span class="line">        <span class="keyword">if</span>(fromAct.getBalance() &lt; money)&#123;</span><br><span class="line">            <span class="comment">//钱少于余额时报错</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TransferException</span>(<span class="string">&quot;余额不足&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 执行到这说明余额充足</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">toAct</span> <span class="operator">=</span> accountMapper.selectByActNo(toActNo);</span><br><span class="line"></span><br><span class="line">        fromAct.setBalance(fromAct.getBalance() - money);</span><br><span class="line">        toAct.setBalance(toAct.getBalance() + money);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更新数据库</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> accountMapper.update(fromAct);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模拟异常</span></span><br><span class="line">        <span class="comment">/*if(1 == 1)&#123;</span></span><br><span class="line"><span class="comment">            throw new TransferException(&quot;转账失败&quot;);</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line"></span><br><span class="line">        count += accountMapper.update(toAct);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果上面更新的count是两条就说明成功了，否则失败</span></span><br><span class="line">        <span class="keyword">if</span>(count != <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TransferException</span>(<span class="string">&quot;转账失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>新建自定义异常，在exception包下建TransferException类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转账异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransferException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TransferException</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TransferException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后是控制层</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountService accountService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/transfer&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">transfer</span><span class="params">(String fromActNo, String toActNo, <span class="type">double</span> money)</span> &#123;</span><br><span class="line">        <span class="comment">// 如果出现异常，springmvc没有对这个异常进行处理的话，springboot就会接管这个异常处理</span></span><br><span class="line">        accountService.transfer(fromActNo, toActNo, money);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后再resources的templates里弄三个html，error index success</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>fail<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--使用message时需要在配置文件里配置server.error.include-message=always--&gt;</span></span><br><span class="line">[[$&#123;message&#125;]]</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/transfer&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    转出账号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fromActNo&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    转入账号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;toActNo&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    转账金额：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;money&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;转账&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>success<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>转账成功<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后需要为index配置东西，建config包webconfig类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/index&quot;</span>).setViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后访问<a href="http://localhost:8080/index">http://localhost:8080/index</a></p><p>![image-20250603031017672](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250603031017672.png)</p><h2 id="SpringBoot打war包"><a href="#SpringBoot打war包" class="headerlink" title="SpringBoot打war包"></a>SpringBoot打war包</h2><p>第一步：将打包方式设置为war</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure><p>![image-20250603175623666](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250603175623666.png)</p><p>第二步：排除内嵌tomcat</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--内嵌的tomcat服务器排除掉--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第三步：添加servlet api依赖（引入tomcat，但scope设置为provided，这样这个tomcat服务器就不会打入war包了）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--额外添加一个tomcat服务器，实际上是为了添加servlet api。scope设置为provided表示这个不会被打入war包当中。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第四步：修改主类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.powernode.transaction.repository&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot324TransactionApplication</span> <span class="keyword">extends</span> <span class="title class_">SpringBootServletInitializer</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> SpringApplicationBuilder <span class="title function_">configure</span><span class="params">(SpringApplicationBuilder application)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> application.sources(Springboot324TransactionApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Springboot324TransactionApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第五步：把target文件删掉，![image-20250603180308269](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250603180308269.png)执行clean和package命令打war包</p><p>生成在这里![image-20250603180458371](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250603180458371.png)</p><p>第六步：配置tomcat环境，将war包放入到webapps目录下，启动tomcat服务器，并访问。</p><p>现在不叫javaee了叫JakarataEE 9</p><p><a href="https://tomcat.apache.org/%E9%80%89tomcat10%E7%84%B6%E5%90%8E![image-20250603181306099]">https://tomcat.apache.org/选tomcat10然后![image-20250603181306099]</a>(.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250603181306099.png)</p><p>然后解压配置环境</p><p>![image-20250603182415314](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250603182415314.png)</p><p>![image-20250603181829786](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250603181829786.png)</p><p>![image-20250603182457572](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250603182457572.png)</p><p>然后以管理员身份运行</p><p>![image-20250603183104661](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250603183104661.png)</p><p>如果乱码了需要去conf文件下的logging.properties配置，把所有utf-8改成gbk编码</p><p>![image-20250603183429762](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250603183429762.png)</p><p>然后关闭窗口，把之前的war包扔到tomcat的webapps文件夹里，然后再次启动startup.bat就开始自动部署，然后访问<a href="http://localhost:8080/springboot3-24-transaction-0.0.1-SNAPSHOT/index">http://localhost:8080/springboot3-24-transaction-0.0.1-SNAPSHOT/index</a></p><p>![image-20250603183751064](.&#x2F;images&#x2F;Spring Boot 3&#x2F;image-20250603183751064.png)</p><h2 id="SpringBoot的日志处理"><a href="#SpringBoot的日志处理" class="headerlink" title="SpringBoot的日志处理"></a>SpringBoot的日志处理</h2><h3 id="日志概述"><a href="#日志概述" class="headerlink" title="日志概述"></a>日志概述</h3><p>用system.out.println输出到控制台没有隐私等问题，其他的等后面再看吧</p><h3 id="日志框架包括抽象层面的和具体层面的"><a href="#日志框架包括抽象层面的和具体层面的" class="headerlink" title="日志框架包括抽象层面的和具体层面的"></a>日志框架包括抽象层面的和具体层面的</h3><p>抽象方面的：SFL4J，Commons logging</p><p>具体方面的：log4j，log4j2，logback（SpringBoot默认集成的），JUL</p><h3 id="日志级别概述："><a href="#日志级别概述：" class="headerlink" title="日志级别概述："></a>日志级别概述：</h3><p>不同日志级别反应的严重程度不一样</p><p>1.TRACE:这是最低级别的日志信息，用于记录最详细的信息，通常是在调用应用时使用</p><p>2.DEBUG：用于记录程序运行时的详细信息，比如变量的值，进入或退出某个方法等，主要用于开发阶段的调试</p><p>3.INFO：记录应用程序的一般信息，如系统启动、服务初始化完成等，表示程序运行正常</p><p>4.WARN：警告信息，表示可能存在问题或者异常的情况，但是还不至于导致应用停止工作</p><p>5.ERROR：错误信息，表示发生了一个错误事件，该错误可能会导致某些功能无法正常工作</p><p>在生产环境中，我们可能会将日志级别设置为INFO或更高级别，以避免输出过多的调试信息。这也是SpringBoot默认的日志级别</p><p>在开发或测试环境中，降低为DEBUG甚至TRACE，便于进行详细的错误追踪和调试</p><p>日志级别从低到高是1-5.级别越低打印的日志信息就越多</p><h3 id="更改日志级别："><a href="#更改日志级别：" class="headerlink" title="更改日志级别："></a>更改日志级别：</h3><p>新建工程然后引用web和lombok，在入口程序这样写</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span> <span class="comment">// 这是lombok的一个注解，这个注解的作用是：为我们维护一个日志对象 log</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot325LogApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(Springboot325LogApplication.class, args);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接使用lombok的日志对象 log 记录日志</span></span><br><span class="line"><span class="comment">// 只能输出下面三个是因为默认是info，所以最多输出到info不能再多了</span></span><br><span class="line">log.trace(<span class="string">&quot;trace级别日志&quot;</span>);</span><br><span class="line">log.debug(<span class="string">&quot;debug级别日志&quot;</span>);</span><br><span class="line">log.info(<span class="string">&quot;info级别日志&quot;</span>);</span><br><span class="line">log.warn(<span class="string">&quot;warn级别日志&quot;</span>);</span><br><span class="line">log.error(<span class="string">&quot;error级别日志&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>配置级别：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置日志级别</span></span><br><span class="line"><span class="attr">logging.level.root</span>=<span class="string">DEBUG</span></span><br></pre></td></tr></table></figure><h3 id="丰富启动日志"><a href="#丰富启动日志" class="headerlink" title="丰富启动日志"></a>丰富启动日志</h3><p>SpringBoot项目启动过程中的日志的丰富，启动完成后，项目进入正常运行阶段，这两个配置没用</p><p>这两个配置不会对我们程序员手动记录的日志起作用</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">trace</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">debug</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><p>trace&#x3D;true:启动SpringBoot的启动跟踪，生成包含启动信息的详细跟踪文件，内容是包含debug&#x3D;true输出的内容</p><p>debug&#x3D;true：启动SpringBoot的调用模式，增加启动日志的详细程度并显示自动配置报告</p><h3 id="日志的粗细粒度"><a href="#日志的粗细粒度" class="headerlink" title="日志的粗细粒度"></a>日志的粗细粒度</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试日志控制的粗细粒度</span></span><br><span class="line"><span class="comment"># 全局的日志级别设置为ERROR</span></span><br><span class="line"><span class="attr">logging.level.root</span>=<span class="string">ERROR</span></span><br><span class="line"><span class="comment"># 设置某个包下的所有类的日志级别为INFO</span></span><br><span class="line"><span class="attr">logging.level.com.powernode.springboot.controller</span>=<span class="string">INFO</span></span><br><span class="line"><span class="comment"># 设置某个类的日志级别为TRACE</span></span><br><span class="line"><span class="attr">logging.level.com.powernode.springboot.service.impl</span>=<span class="string">TRACE</span></span><br></pre></td></tr></table></figure><p>怎么在项目中打印sql语句？默认级别是info，不会显示sql，但想降低级别又不应用到全局，只sql相关的使用debug</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#全局的日志级别</span></span><br><span class="line"><span class="attr">logging.level.root</span>=<span class="string">INFO</span></span><br><span class="line"><span class="comment"># mapper相关的日志界别（xxx是文件路径</span></span><br><span class="line"><span class="attr">logging.level.com.powernode.xxx.repository</span>=<span class="string">DEBUG</span></span><br></pre></td></tr></table></figure><h3 id="日志输出到文件"><a href="#日志输出到文件" class="headerlink" title="日志输出到文件"></a>日志输出到文件</h3><p>这两种方式不可共存</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以下的两种实现方式不可共存，其实是SpringBoot框架设计的一个小bug，可以在github提交一下</span></span><br><span class="line"><span class="comment">#将日志输出到文件，第一种配置方式：使用path</span></span><br><span class="line"><span class="comment"># 自动在指定的目录下生成一个固定不变的文件：spring.log，名字不可配置</span></span><br><span class="line"><span class="comment">#路径可以随便配置，可以是硬盘上的任意有权限的路径</span></span><br><span class="line"><span class="attr">logging.file.path</span>=<span class="string">./log/</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#将日志输出到文件，第二种配置方式：使用name</span></span><br><span class="line"><span class="comment"># name 和 path 的配置同时存在的话，name生效path无效（path和name不能同时使用）</span></span><br><span class="line"><span class="comment"># 这种方式只能设置日志文件的名字，无法设置日志文件存储的位置</span></span><br><span class="line"><span class="comment"># 日志文件生成到项目的根路径下</span></span><br><span class="line"><span class="attr">logging.file.name</span>=<span class="string">my.log</span></span><br></pre></td></tr></table></figure><h3 id="滚动日志"><a href="#滚动日志" class="headerlink" title="滚动日志"></a>滚动日志</h3><p>滚动日志是一种日志管理机制，用于防止日志文件无线增长，通过将日志文件分割成多个文件，每个文件只包含一定时间段或大小的日志记录，滚动日志可以帮助你更好地管理和维护日志文件，避免单个日志文件过大导致难以处理</p><p>但这个滚动策略只适合于logback框架，如果使用log4j2就需要单独在log4j2.xml里配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#滚动日志配置</span></span><br><span class="line"><span class="comment"># 日志文件达到多大时进行归档，也就是达到100kb就不再增长然后自动打一个压缩包</span></span><br><span class="line"><span class="attr">logging.logback.rollingpolicy.max-file-size</span>=<span class="string">100KB</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 所有的归档日志文件总共达到多大时进行删除，默认是0b表示不删除</span></span><br><span class="line"><span class="attr">logging.logback.rollingpolicy.total-size-cap</span>=<span class="string">50GB</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 归档日志文件最多保留几天</span></span><br><span class="line"><span class="attr">logging.logback.rollingpolicy.max-history</span>=<span class="string">60</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 启动项目时是否要清理归档日志文件</span></span><br><span class="line"><span class="attr">logging.logback.rollingpolicy.clean-history-on-start</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 归档日志文件的格式，第一个$取的是spring.log那个文件名放在这，然后年月日，gz是linux中的压缩包扩展名</span></span><br><span class="line"><span class="attr">logging.logback.rollingpolicy.file-name-pattern</span>=<span class="string">$&#123;LOG_FILE&#125;.$d&#123;yyyy-MM-dd&#125;.%i.gz</span></span><br></pre></td></tr></table></figure><h3 id="日志框架切换"><a href="#日志框架切换" class="headerlink" title="日志框架切换"></a>日志框架切换</h3><p>也就是排除logback的依赖然后添加别的</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--排除默认的日志依赖--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--使用log4j2日志依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意：一旦切换log4j2的日志框架，对于之前的配置来说，只有logback的滚动日志不再生效，其他配置仍然生效，如果要在log4j2中进行滚动日志，需要编写log4j2相关的xml配置文件，比较麻烦</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSM </tag>
            
            <tag> Java </tag>
            
            <tag> boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>idea笔记</title>
      <link href="/posts/aa9df247.html"/>
      <url>/posts/aa9df247.html</url>
      
        <content type="html"><![CDATA[<h1 id="常用快捷键："><a href="#常用快捷键：" class="headerlink" title="常用快捷键："></a>常用快捷键：</h1><p><img src="/./images/idea%E7%AC%94%E8%AE%B0/image-20250330031925003.png" alt="image-20250330031925003"></p><p><img src="/./images/idea%E7%AC%94%E8%AE%B0/image-20250330031938417.png" alt="image-20250330031938417"></p><h1 id="内置的模板："><a href="#内置的模板：" class="headerlink" title="内置的模板："></a>内置的模板：</h1><p><img src="/./images/idea%E7%AC%94%E8%AE%B0/image-20250330032216181.png" alt="image-20250330032216181"></p><p><img src="/./images/idea%E7%AC%94%E8%AE%B0/image-20250330032234776.png" alt="image-20250330032234776"></p><p><img src="/./images/idea%E7%AC%94%E8%AE%B0/image-20250330032244657.png" alt="image-20250330032244657"></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> idea </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring</title>
      <link href="/posts/6c92115f.html"/>
      <url>/posts/6c92115f.html</url>
      
        <content type="html"><![CDATA[<h1 id="十五、面向切面编程AOP"><a href="#十五、面向切面编程AOP" class="headerlink" title="十五、面向切面编程AOP"></a>十五、面向切面编程AOP</h1><p>IoC使软件组件松耦合。AOP让你能够捕捉系统中经常使用的功能，把它转化成组件。<br>AOP（Aspect Oriented Programming）：面向切面编程，面向方面编程。（AOP是一种编程技术）<br>AOP是对OOP的补充延伸。<br>AOP底层使用的就是动态代理来实现的。<br>Spring的AOP使用的动态代理是：JDK动态代理 + CGLIB动态代理技术。Spring在这两种动态代理中灵活切换，如果是代理接口，会默认使用JDK动态代理，如果要代理某个类，这个类没有实现接口，就会切换使用CGLIB。当然，你也可以强制通过一些配置让Spring只使用CGLIB。</p><h2 id="15-1-AOP介绍"><a href="#15-1-AOP介绍" class="headerlink" title="15.1 AOP介绍"></a>15.1 AOP介绍</h2><p>一般一个系统当中都会有一些系统服务，例如：日志、事务管理、安全等。这些系统服务被称为：<strong>交叉业务</strong><br>这些<strong>交叉业务</strong>几乎是通用的，不管你是做银行账户转账，还是删除用户数据。日志、事务管理、安全，这些都是需要做的。<br>如果在每一个业务处理过程当中，都掺杂这些交叉业务代码进去的话，存在两方面问题：</p><ul><li>第一：交叉业务代码在多个业务流程中反复出现，显然这个交叉业务代码没有得到复用。并且修改这些交叉业务代码的话，需要修改多处。</li><li>第二：程序员无法专注核心业务代码的编写，在编写核心业务代码的同时还需要处理这些交叉业务。</li></ul><p>使用AOP可以很轻松的解决以上问题。<br>请看下图，可以帮助你快速理解AOP的思想：</p><p><img src="/./images/spring/1665732609757-d8ae52ba-915e-49cf-9ef4-c7bcada0d601.png#averageHue=#f5f1dc&clientId=u71f508e1-87c2-4&from=paste&height=472&id=uef8a4f68&originHeight=472&originWidth=872&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23630&status=done&style=shadow&taskId=u986fcc80-b6e4-46d8-a79e-2c5855dd6ad&title=&width=872" alt="image.png"></p><p>**用一句话总结AOP：将与核心业务无关的代码独立的抽取出来，形成一个独立的组件，然后以横向交叉的方式应用到业务流程当中的过程被称为AOP。<br>**AOP的优点：</p><ul><li><strong>第一：代码复用性增强。</strong></li><li><strong>第二：代码易维护。</strong></li><li><strong>第三：使开发者更关注业务逻辑。</strong></li></ul><h2 id="15-2-AOP的七大术语"><a href="#15-2-AOP的七大术语" class="headerlink" title="15.2 AOP的七大术语"></a>15.2 AOP的七大术语</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">do1</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;do 1&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">do2</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;do 2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">do3</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;do 3&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">do4</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;do 4&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">do5</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;do 5&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 核心业务方法，do4不是切点，因为不在这里面</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//Joinpoint连接点</span></span><br><span class="line">        do1();<span class="comment">//Pointcut切点</span></span><br><span class="line">        do2();</span><br><span class="line">        do3();</span><br><span class="line">        do5();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">1.</span>连接点描述的是位置</span><br><span class="line"><span class="number">2.</span>切点本质上就是方法（真正织入切面的那个方法叫做切点</span><br><span class="line"><span class="number">3.</span>通知，通知又叫做增强，就是具体增强的那个代码</span><br><span class="line">    例如：具体的事务代码，日志代码，安全代码，统计时长的代码，</span><br><span class="line">    具体的这个代码是通知</span><br><span class="line">    通知描述的是代码</span><br></pre></td></tr></table></figure><ul><li><strong>连接点 Joinpoint</strong><ul><li>在程序的整个执行流程中，<strong>可以织入</strong>切面的位置。方法的执行前后，异常抛出之后等位置。</li></ul></li><li><strong>切点 Pointcut</strong><ul><li>在程序执行流程中，<strong>真正织入</strong>切面的方法。（一个切点对应多个连接点）</li></ul></li><li><strong>通知 Advice</strong><ul><li>通知又叫增强，就是具体你要织入的代码。</li><li>通知包括：<ul><li>前置通知，放到方法前</li><li>后置通知，放到方法后</li><li>环绕通知，前后都有</li><li>异常通知，放在catch中</li><li>最终通知，放在finally中</li></ul></li></ul></li><li><strong>切面 Aspect</strong><ul><li><strong>切点 + 通知就是切面。</strong></li></ul></li><li>织入 Weaving<ul><li>把通知应用到目标对象上的过程。</li></ul></li><li>代理对象 Proxy<ul><li>一个目标对象被织入通知后产生的新对象。</li></ul></li><li>目标对象 Target<ul><li>被织入通知的对象。</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSM </tag>
            
            <tag> Java </tag>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spirng速成</title>
      <link href="/posts/7d713e54.html"/>
      <url>/posts/7d713e54.html</url>
      
        <content type="html"><![CDATA[<p><img src="/./images/Spring%E9%80%9F%E6%88%90/image-20250417152319400.png" alt="image-20250417152319400"></p><p>给分成了三层，后面的mapper就是mybatis的，如果要获取其他对象就需要在这里面创建类，比如BookService2 b &#x3D; new BookService2这样，但只要一改名字，就需要把所有的对象名字都改，这样耦合度太高。就需要用到spring容器来进行统一管理</p><p>ioc就是控制反转的意思，把创建对象的权利交给spring容器</p><p><img src="/./images/Spring%E9%80%9F%E6%88%90/image-20250417154946468.png" alt="image-20250417154946468"></p><p>会有一个配置文件叫applicationcontext.xml，里面存放了bean这个，id就是名字，class是类型，然后他自动通过反射机制创建对象，然后放到spring容器里，这个容器可以理解成一个筐，苹果放一个筐梨放一个筐，然后再从这个容器里读取到java程序</p><p><img src="/./images/Spring%E9%80%9F%E6%88%90/image-20250417163056544.png" alt="image-20250417163056544"></p><p><img src="/./images/Spring%E9%80%9F%E6%88%90/image-20250417162954540.png" alt="image-20250417162954540"></p><p><img src="/./images/Spring%E9%80%9F%E6%88%90/image-20250417191936410.png" alt="image-20250417191936410"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> = <span class="string">&quot;b&quot;</span> <span class="attr">class</span> = <span class="string">&#x27;com.msb.pojo.Book&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;项目驱动零起点&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果对应的set方法里是setId1，那么上面的name&#x3D;id就要改成id1，只跟这个set方法有关，跟属性名无关</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId1</span><span class="params">(<span class="type">int</span> id)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>构造注入</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> = <span class="string">&quot;b2&quot;</span> <span class="attr">class</span> = <span class="string">&#x27;com.msb.pojo.Book&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;id2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;项目驱动零起点&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里的id名就和构造方法里的参数有关了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">Book</span><span class="params">(<span class="type">int</span> id2, String name2)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.id=id2;</span><br><span class="line">    <span class="built_in">this</span>.name=name2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Spring属性注入的方式："><a href="#Spring属性注入的方式：" class="headerlink" title="Spring属性注入的方式："></a>Spring属性注入的方式：</h1><p>设置属性的值：</p><p>方式一：value：简单数据类型（基本数据类型+String）直接设置；</p><p>方式二：ref：需要引用另一个bean的id，也就是说这个参数是一个类类型，且这个类的对象也被spring容器管理</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> = <span class="string">&quot;boy&quot;</span> <span class="attr">class</span> = <span class="string">&#x27;com.msb.pojo.Book&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;22&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小明&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> = <span class="string">&quot;girl&quot;</span> <span class="attr">class</span> = <span class="string">&#x27;com.msb.pojo.Book&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;19&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;露露&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;boyfriend&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;boy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span>//这里要注意</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test3</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="comment">//创建spring容器</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContest</span>(<span class="string">&quot;application.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//获取对象,后面是ben取的名字，前面是一个具体的女孩Girl</span></span><br><span class="line">        <span class="type">Girl</span> <span class="variable">g</span> <span class="operator">=</span> (Girl)context.getBean(<span class="string">&quot;girl&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="注解的引入："><a href="#注解的引入：" class="headerlink" title="注解的引入："></a>注解的引入：</h1><p><img src="/./images/Spring%E9%80%9F%E6%88%90/image-20250418013350961.png" alt="image-20250418013350961"></p><p>前面的几个都是一样的作用，分别用于不同的层，这样可以区分，直接写@Component也可以</p><h2 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h2><p>在要创建对象的类中加入@Component注解，对象名字默认为：类名首字母变小写<br>注解要在哪个包下？要想找到这些注解，需要将注解所在的包进行扫描：设置需要扫描的包，并且需要在applicationContext.xml中添加context命名空间<br>加到某个类上，他识别到就自动创建具体的对象</p><p><img src="/./images/Spring%E9%80%9F%E6%88%90/image-20250418014003535.png" alt="image-20250418014003535"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">xsi:scheamLocation=&quot;</span><br><span class="line">http://www.springframework.org/schema/context</span><br><span class="line">https://www.springframework.org/schema/context/spring-context.xsd&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.msb.pojo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span>#这个包名要和自己的对应，这就是要扫描的包</span><br></pre></td></tr></table></figure><h2 id="value"><a href="#value" class="headerlink" title="@value"></a>@value</h2><p><img src="/./images/Spring%E9%80%9F%E6%88%90/image-20250418015049329.png" alt="image-20250418015049329"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Conponent</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Girl</span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;18&quot;)</span><span class="comment">//可以直接给age复制，并且调用时不需要set方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="meta">@Value(&quot;丽丽&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Autowired</span><span class="comment">//会把boy的值自动注入到这里面来</span></span><br><span class="line">    <span class="keyword">private</span> Boy boyfriend;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Conponent</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Boy</span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;21&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSM </tag>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一小时速成Maven</title>
      <link href="/posts/f285b25.html"/>
      <url>/posts/f285b25.html</url>
      
        <content type="html"><![CDATA[<h1 id="maven简介"><a href="#maven简介" class="headerlink" title="maven简介"></a>maven简介</h1><p><a href="https://www.bilibili.com/video/BV1uApMeWErY?spm_id_from=333.788.videopod.sections&vd_source=b0128143be22d1783a42f5fbf34d9d25">https://www.bilibili.com/video/BV1uApMeWErY?spm_id_from=333.788.videopod.sections&amp;vd_source=b0128143be22d1783a42f5fbf34d9d25</a></p><h2 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h2><p><img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6%E9%80%9F%E6%88%90Maven/image-20250413165827744.png" alt="image-20250413165827744"></p><p>定义了项目的配置、依赖、插件、以及构建的过程</p><h2 id="Maven仓库"><a href="#Maven仓库" class="headerlink" title="Maven仓库"></a>Maven仓库</h2><p>就是存放jiar包的地方，按照作用范围可以分为</p><ol><li><p>本地仓库</p><ul><li><p>就是电脑上的本地目录，默认在<img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6%E9%80%9F%E6%88%90Maven/image-20250413170307522.png" alt="image-20250413170307522"> </p><p>一定要是一个没有中文的路径下。</p></li></ul></li><li><p>远程仓库</p><ul><li>一般是一个公司或者组织内部搭建的一个仓库，用来给内部的项目提供统一的依赖管理，避免jar包的重复下载</li><li>也可以通过中央仓库下载，是Maven官方维护的一个仓库 ，开源jar包都可以在这里找到</li></ul></li><li><p>私服</p></li></ol><h2 id="maven安装和下载"><a href="#maven安装和下载" class="headerlink" title="maven安装和下载"></a>maven安装和下载</h2><p>Maven官网：<a href="https://maven.apache.org/">https://maven.apache.org/</a></p><p>Maven下载地址：<a href="https://maven.apache.org/download.cgi">https://maven.apache.org/download.cgi</a></p><p>Nexus下载地址：<a href="https://help.sonatype.com/en/download.html">https://help.sonatype.com/en/download.html</a></p><p>环境变量：<img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6%E9%80%9F%E6%88%90Maven/image-20250413171625778.png" alt="image-20250413171625778"></p><p>再在path里添加%MAVEN_HOME%\bin</p><p>在cmd里输入mvn -v出现就成功</p><p><img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6%E9%80%9F%E6%88%90Maven/image-20250413171717573.png" alt="image-20250413171717573"></p><p>然后找到<img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6%E9%80%9F%E6%88%90Maven/image-20250413171820128.png" alt="image-20250413171820128"> </p><h3 id="配置本地仓库"><a href="#配置本地仓库" class="headerlink" title="配置本地仓库"></a>配置本地仓库</h3><p>这个是maven的配置文件，先找到localRepository也就是本地仓库这个标签</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- localRepository</span></span><br><span class="line"><span class="comment">   | The path to the local repository maven will use to store artifacts.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: $&#123;user.home&#125;/.m2/repository(这个是默认的路径)</span></span><br><span class="line"><span class="comment">  &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;（要把这行复制到注释外面才生效）</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>D:\Java\LocalMavenRepository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="配置中央仓库"><a href="#配置中央仓库" class="headerlink" title="配置中央仓库"></a>配置中央仓库</h3><p>由于中央仓库的镜像都是在国外，所以需要一个国内的镜像加速下载</p><p>找到</mirrors>结束标签，将以下代码贴在其前面。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-default-http-blocker<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>external:http:*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>Pseudo repository to mirror external repositories initially using HTTP.<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://0.0.0.0/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">blocked</span>&gt;</span>true<span class="tag">&lt;/<span class="name">blocked</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置阿里远程仓库--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span>        </span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="配置JDK属性"><a href="#配置JDK属性" class="headerlink" title="配置JDK属性"></a>配置JDK属性</h3><p>在<profiles>标签中进行配置，一定要小心，找到</profiles>结束标签，在其前面配置以下代码。因为在<profiles></profiles>标签中全部是注释，粘到哪里都在注释中，只有找到结束标签</profiles>前才是注释外的，配置才会生效。</p><p>21就全改成21</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk17<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>17<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="初识Maven"><a href="#初识Maven" class="headerlink" title="初识Maven"></a>初识Maven</h1><p>这是一个官方提供的快速开始模板创建指令</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate -DgroupId=com.mycompany.app -DartifactId=my-app -DarchetypeArtifactId=maven-archetype-quickstart -DarchetypeVersion=<span class="number">1</span>.<span class="number">5</span> -DinteractiveMode=false</span><br></pre></td></tr></table></figure><p>DgroupId:项目的组织id，一般是一个公司或者组织的唯一标识，比较常用的是域名反过来写</p><p>DartifactId:是项目的唯一标识，一般是项目的工程名字</p><p>DarchetypeArtifactId：maven为我们提供的各种不同类型的项目结构，保持默认就行</p><p>windows这几个配置信息需要加双引号，否则可能会报错</p><h1 id="在idea中使用maven"><a href="#在idea中使用maven" class="headerlink" title="在idea中使用maven"></a>在idea中使用maven</h1><p>打开idea2023,具体步骤如下：</p><ol><li>File—&gt;settings—&gt;Build,Execution,Depolyment—&gt;Build Tools—&gt;Maven</li></ol><p> Maven home path(Maven工具所在的目录,bin的上一级目录):   D:\apache-maven-3.9.6</p><p>勾选Override选项<br>User settings file(Maven工具的核心配置文件):  D:\apache-maven-3.9.2\conf\settings.xml<br>Local repository(本地仓库,antlr的上一级目录):  D:\repository（只要在settings.xml里面写上了本地的路径，就会自动配置）</p><ol start="2"><li>Maven—&gt;Importing—&gt;配置JDK的版本</li><li>Runner</li></ol><p>VM Options:-DarchetypeCatalog&#x3D;internal  (在新建模块时使用本地模板)<br>JRE: 17</p><ol start="4"><li>Repositories(刷新本地仓库的索引):  选中本地仓库,点Update</li></ol><h1 id="生命周期和插件"><a href="#生命周期和插件" class="headerlink" title="生命周期和插件"></a>生命周期和插件</h1><p>在右侧可以打开maven界面，在lifecycle里就是生命周期的插件</p><ul><li>双击<strong>clean</strong>可以清理一些东西</li><li>validate：用来验证项目是否正确，并且所有必要信息是可用的，如果有问题就会报错</li><li>compile：用来编译原项目的代码，也就是把java的源码文件编译成字节码文件</li><li>test就是单元测试，把单元测试用例都执行一遍</li><li>package的作用是打包项目和其他的资源文件，生成一个jar包或者war包，但也会先编译执行一下看看有没有问题</li><li>verify是用来验证打包的结果，也就是检查生成的jar包是否正确，不常用</li><li>install把项目打包后生成的jar包或者war安装到本地仓库中，也就是配置文件里的那个路径</li><li>site是用来生成项目的站点文档，生成一个静态网站</li><li>deploy的作用是把打包的jar上传到远程仓库里，一般是发布到公司内部的私服仓库</li></ul><h1 id="maven的坐标和本地仓库的存储位置"><a href="#maven的坐标和本地仓库的存储位置" class="headerlink" title="maven的坐标和本地仓库的存储位置"></a>maven的坐标和本地仓库的存储位置</h1><p>maven的坐标是唯一标识，由三部分组成</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;goupId&gt;junit&lt;/goupId&gt;公司组织唯一标识</span><br><span class="line">&lt;artifactId&gt;junit&lt;/artifactId&gt;项目唯一标识</span><br><span class="line">&lt;version&gt;3.8.1&lt;/version&gt;项目的版本号</span><br><span class="line">&lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">版本号也会分为SNAPSHOT和RELEASE两种，也就是快照版和正式版，快照版是开发过程中不稳定的版本，正式版是一个稳定的发行版本</span><br></pre></td></tr></table></figure><p>找到本地仓库的位置，然后会有junit，里面找到版本，再找到jar包，通过有个网站叫mvnrepository，里面收录了几乎所有的jar包，搜索想要的jar包，里面会有很多的版本，选择稳定的版本，在下方就可以看到jar包的坐标，点击一下就可以复制，然后粘贴到dependency标签里就可以了，如果爆红了就说明本地仓库没有这个jar包，只需要下载到这里就可以，方法是点击右上Maven的刷新按钮就可以了</p><h1 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理"></a>依赖管理</h1><h2 id="依赖范围"><a href="#依赖范围" class="headerlink" title="依赖范围"></a>依赖范围</h2><p>scope标签可以 指定依赖的范围，常见的范围有compile，provided，runtime，test等等</p><ol><li><p>compile就是指这个依赖是编译和运行时都需要的，也是默认范围可以省略不写，比如jdbc</p></li><li><p>provided是指定这个依赖是编译时需要但是运行时不需要的，比如经常使用的lombok</p></li><li><p>runtime是指定这个依赖是运行时需要的但编译时不需要，比如jdbc驱动的jar包</p></li><li><p>test指在测试的时候需要，在正式的业务代码中并不需要，也无法使用相关的类和方法，不会被打包到最终的jar包中，比如junit的测试框架</p></li><li><p>还有一个system的依赖范围是表示这个依赖是在本地的文件系统中提供的，如果依赖范围指定为system的话，必须要同时提供一个systempath的标签，用来指定这个依赖的具体位置，这个不推荐使用因为可移植性差</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;scope&gt;system&lt;/scope&gt;</span><br><span class="line">&lt;systemPath&gt;$&#123;basedir&#125;/lib/junit-3.8.1.jar&lt;/systemPath&gt;</span><br><span class="line">lib目录专门存放本地的jar包，然后加上junit这个包的文件全名</span><br></pre></td></tr></table></figure></li><li><p>import范围，一般是在dependdencyManagement中使用，作用是导入其他pom文件中的依赖，但是并不会实际引入依赖，只是用来管理依赖的版本号</p></li></ol><h2 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h2><p>在mvnrepository这个网站上搜索并找到这些依赖的坐标，再添加到pom.xml就可以了</p><h2 id="依赖传递"><a href="#依赖传递" class="headerlink" title="依赖传递"></a>依赖传递</h2><p>直接写在pom.xml文件中的依赖叫做直接依赖，而当这个直接依赖又依赖了其他的jar包的时候，这些依赖的jar包被叫做间接依赖</p><p>maven会自动解析这些依赖关系，并下载相关jar包，只需要告诉maven直接依赖是什么，他会自动下载间接依赖，这就是依赖传递</p><p>另外只有依赖范围是compile的依赖才会被传递，其他的依赖范围是不会传递的</p><h2 id="依赖冲突"><a href="#依赖冲突" class="headerlink" title="依赖冲突"></a>依赖冲突</h2><p>依赖传递是非常方便的，但也会有个问题是依赖冲突，比如在项目里面添加了两个不同的依赖，它们又依赖了不同版本的同一个jar包的话，就会出现依赖冲突的问题，也就是到底应该使用哪一个版本的jar包的问题。</p><p>Maven会根据一定的规则来解决这个冲突</p><ol><li>第一个规则是最短路径优先，也就是当依赖中出现相同的资源时，路径最短的那个依赖会被优先使用</li><li>第二个规则是先声明优先，也就是当路径层级相同时，在pom.xml里面配置顺序靠前的依赖，就会被优先使用</li></ol><h1 id="父子工程"><a href="#父子工程" class="headerlink" title="父子工程"></a>父子工程</h1><p>新建一个maven，在pom.xml找到</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;packaging&gt;jar&lt;/packaging&gt;</span><br></pre></td></tr></table></figure><p>这也就是打包方式，可以是jar、war、pom，jar打包java，war打包web，pom不会生成jar和war包，而是用来管理其他子工程的</p><p>我们创建一个module文件，发现里面多了一个</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.example&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;maven_parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br></pre></td></tr></table></figure><p>这个标签就是指定了它的父工程坐标</p><p>在<img src="/./images/%E4%B8%80%E5%B0%8F%E6%97%B6%E9%80%9F%E6%88%90Maven/image-20250414163219089.png" alt="image-20250414163219089"> </p><p>点击可以直接定位到父工程坐标，在父工程的pom里也多了一些这个，里面列出了所有子模块，我们叫做聚合，通过聚合的方式管理多个子模块，通过父工程一次性管理子模块，也可以点击父工程的m去定位到子模块</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;modules&gt;</span><br><span class="line">  &lt;module&gt;child-a&lt;/module&gt;</span><br><span class="line">&lt;/modules&gt;</span><br></pre></td></tr></table></figure><h1 id="手动解决依赖冲突"><a href="#手动解决依赖冲突" class="headerlink" title="手动解决依赖冲突"></a>手动解决依赖冲突</h1><p>大概意思是不同的模块去使用相同的jar但版本号不一样，通过最短路径和先声明原则会被使用其中一个，而我们就想用不一样的版本就需要手动解决</p><p>第一种是在模块a里排除模块b的依赖，在模块a的pom.xml文件里面找到模块b的依赖，添加</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;exclusions&gt;</span><br><span class="line">&lt;exclusion&gt;//这里面是指定要排除的那个依赖的坐标</span><br><span class="line">&lt;groupId&gt;xxx&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;xxx&lt;/artifactId&gt;排除的时候不需要版本号，是把这个jar包所有的版本都排除</span><br><span class="line">&lt;/exclusion&gt;</span><br><span class="line">&lt;/exclusions&gt;</span><br></pre></td></tr></table></figure><p>添加完后再重启一下看看</p><p>第二种是在模块b的pom文件里面找到那个jar包比如jdbc的依赖位置，添加</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;3.8.1&lt;/version&gt;</span><br><span class="line">           &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">           &lt;optional&gt;true&lt;/optional&gt;表示这个是可选的</span><br><span class="line">   &lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="依赖继承"><a href="#依赖继承" class="headerlink" title="依赖继承"></a>依赖继承</h1><p>在父工程添加一下公共依赖，这样子模块不需要添加依赖就可以继承，并且不会被依赖范围是compile以外的选项影响，就是不管怎么样都会被继承</p><p>但在实际开发中很少这样做，因为耦合性太高，就可以在父模块用依赖管理标签，这样子模块不会自动继承父模块的依赖了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencyManggement&gt;</span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">xxxx</span><br><span class="line">&lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManggement&gt;</span><br></pre></td></tr></table></figure><p>然后再去子模块添加想要用的依赖</p><p>properties标签可以定义一些公共的属性，比如版本号，需要后续修改的话也是修改这里</p><p>然后在对应版本的位置写${spring.version}就可以使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">&lt;spring.version&gt;6.1.11&lt;/spring.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h1 id="nexus私服仓"><a href="#nexus私服仓" class="headerlink" title="nexus私服仓"></a>nexus私服仓</h1>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSM </tag>
            
            <tag> Java </tag>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maven</title>
      <link href="/posts/7273cdc.html"/>
      <url>/posts/7273cdc.html</url>
      
        <content type="html"><![CDATA[<h1 id="什么是Maven"><a href="#什么是Maven" class="headerlink" title="什么是Maven"></a>什么是Maven</h1><h2 id="Maven的概念"><a href="#Maven的概念" class="headerlink" title="Maven的概念"></a>Maven的概念</h2><p>Maven 是 Apache 软件基金会组织维护的一款自动化构建工具，专注服务于 Java 平台的项目构建和依赖管理。Maven 这个单词的本意是：专家，内行。</p><p>它是一个一键式的自动化的构建工具.首先,Maven可以自动的帮助我们下载jar包.其次可以进行多个项目同时的编译运行.还有在开发的过程中需要进行测试运行,Maven提供了自动化的测试插件帮助我们进行项目测试功能的运行.最后项目是需要进行资源文件,配置文件的整合,来进行打包和部署,Maven可以轻松搞定.</p><h2 id="为什么要使用Maven"><a href="#为什么要使用Maven" class="headerlink" title="为什么要使用Maven"></a>为什么要使用Maven</h2><p>我们知道，项目开发不仅仅是写写代码而已，期间会伴随着各种必不可少的事情要做，例如：</p><ol><li>我们需要引用各种 jar 包，尤其是比较大的工程，引用的 jar 包往往有几十个乃至上百个，每个都要到不同的官网去下载，而且每次用到的 jar 包，都需要手动引入工程目录，而且经常遇到各种让人抓狂的 jar 包冲突，版本冲突，Maven可以自动下载jar包及依赖包添加到项目中，大大减轻了工作负担。</li><li>我们开发的 Java 文件，都是需要将它编译成二进制字节码文件。好在这项工作可以由各种集成开发工具帮我们完成，Eclipse、IDEA 等都可以将代码即时编译。但有时候我们需要多个模块同时编译，就必须要借助于Maven工具了。</li><li>每个项目或模块开发过程中都会有 bug，因此写完了代码，我们还要写一些单元测试，然后一个个的运行来检验代码质量，Maven提供了专门的测试插件来实施测试。</li><li>再优雅的代码也是要出来卖的。我们后面还需要把代码与各种配置文件、资源整合到一起，定型打包，如果是 web项目，还需要将之发布到服务器进行调用，这些都可以通过Maven轻松搞定。</li></ol><p>总之，Maven是项目开发必须不可少的工具。</p><p>类似自动化构建工具还有：Gant,  Gradle。</p><h2 id="项目构建过程"><a href="#项目构建过程" class="headerlink" title="项目构建过程"></a>项目构建过程</h2><p>构建(build)是面向过程的(从开始到结尾的多个步骤)，涉及到多个环节的协同工作。</p><p><img src="/./images/Maven/image-20250413164435709.png" alt="image-20250413164435709"></p><p>构建过程的几个主要环节</p><ol><li>清理:将上次编译的结果删除,为下一次编译做准备.  有些时候修改配置文件或者.xml之类的，程序会无法作用上，就可以辅助完成</li><li>编译:将.java的文件编译生成.class的文件.</li><li>测试:针对项目中的关键点进行测试,确保项目在迭代开发的过程中关键点的正确性.</li><li>报告:在每一次测试后以标签的格式记录和展示测试结果.</li><li>打包:将项目生成jar包或war包.</li><li>安装:将jar包安装到本地仓库.</li><li>部署:将jar包部署到私服上.</li></ol><h2 id="Maven的两大核心功能（重点）"><a href="#Maven的两大核心功能（重点）" class="headerlink" title="Maven的两大核心功能（重点）"></a>Maven的两大核心功能（重点）</h2><h3 id="项目构建"><a href="#项目构建" class="headerlink" title="项目构建"></a>项目构建</h3><p>对项目进行编译，测试，打包，部署等构建。</p><h3 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理"></a>依赖管理</h3><p>对jar包的统一管理，Maven提供中央仓库，私服，本地仓库解决jar包的依赖和相关依赖的下载。<br>如下图所示：包括蓝、黄两个部分分别对应着<a href="https://www.zhihu.com/search?q=%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2811089619%7D"><strong>依赖关系</strong></a><strong>和项目构建</strong>两大核心功能。</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSM </tag>
            
            <tag> Java </tag>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDBC</title>
      <link href="/posts/8fe47ff4.html"/>
      <url>/posts/8fe47ff4.html</url>
      
        <content type="html"><![CDATA[<h1 id="第01章-JDBC概述"><a href="#第01章-JDBC概述" class="headerlink" title="第01章 JDBC概述"></a>第01章 JDBC概述</h1><h2 id="什么是JDBC"><a href="#什么是JDBC" class="headerlink" title="什么是JDBC"></a>什么是JDBC</h2><p>JDBC（Java DataBase Connectivity）就是Java数据库连接，说白了就是用Java语言来操作数据库。原来我们操作数据库是在控制台使用SQL语句来操作数据库，JDBC是用Java语言向数据库发送SQL语句。</p><p><img src="/./images/JDBC/image-20250402164726818.png" alt="image-20250402164726818"></p><p>JDBC是一套连接数据库的api，什么是APi？就是平时所说的一套类库，通常包括三项：</p><ul><li>API字节码（String.class）</li><li>API源码（String.java）</li><li>API帮助文档（String类的帮助文档）</li></ul><p>但是要注意查阅的版本要一致。</p><h2 id="JDBC原理"><a href="#JDBC原理" class="headerlink" title="JDBC原理"></a>JDBC原理</h2><p>早期SUN公司的天才们想编写一套可以连接天下所有数据库的API，但是当他们刚刚开始时就发现这是不可完成的任务，因为各个厂商的数据库服务器差异太大了。后来SUN开始与数据库厂商们讨论，最终得出的结论是，由SUN提供一套访问数据库的规范（就是一组接口），并提供连接数据库的协议标准，然后各个数据库厂商会遵循SUN的规范提供一套访问自己公司数据库服务器的API。SUN提供的规范命名为JDBC，而各个厂商提供的，遵循了JDBC规范的，可以访问自己数据库的API被称之为驱动！</p><p><img src="/./images/JDBC/image-20250402170344437.png" alt="image-20250402170344437"></p><p>JDBC是接口，而JDBC驱动才是接口的实现，没有驱动无法完成数据库连接！每个数据库厂商都有自己的驱动，用来连接自己公司的数据库。<br>当然还有第三方公司专门为某一数据库提供驱动，这样的驱动往往不是开源免费的！</p><p>jdbc的本质：</p><p><img src="/./images/JDBC/JDBC%E7%9A%84%E6%9C%AC%E8%B4%A8.png" alt="JDBC的本质"></p><h2 id="模拟JDBC接口"><a href="#模拟JDBC接口" class="headerlink" title="模拟JDBC接口"></a>模拟JDBC接口</h2><h3 id="模拟JDBC接口-1"><a href="#模拟JDBC接口-1" class="headerlink" title="模拟JDBC接口"></a>模拟JDBC接口</h3><p>Java中接口的作用主要有以下几个方面：</p><ol><li>定义标准：接口可以用于定义标准，规范应该如何完成某个任务或应该具有哪些属性、方法等。 </li><li>隐藏实现：接口隔离了类的实现和外界的逻辑使用，使得外部无论是访问接口的常量或是接口的方法都不需要关心接口的实现。 </li><li>实现多态：一个类实现多个接口，在实现接口的过程中，类便会具有接口中的所有方法。这样我们就可以在实际应用中方便的实现多态的效果。 </li><li>扩展性和灵活性：通过接口可以为项目提供更好的扩展性和灵活性，接口定义了一个共同的标准，使得新的类可以很容易地加入到已有的系统中，而且不需要修改现有的代码。</li></ol><p>总的来说，Java中的接口可以让我们通过规范来编写更加标准和灵活的代码，使得代码易于维护和扩展，并通过多态的特性来提高代码的重用性和可读性。**Java接口在使用场景中，一定是存在两个角色的，一个是接口的调用者，一个是接口的实现者，接口的出现让调用者和实现者解耦合了</p><h3 id="编写程序模拟JDBC接口"><a href="#编写程序模拟JDBC接口" class="headerlink" title="编写程序模拟JDBC接口"></a>编写程序模拟JDBC接口</h3><p><strong>接口的制定者</strong>：SUN公司负责制定的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SUN公司负责制定JDBC接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">JDBC</span> &#123;</span><br><span class="line">    <span class="comment">// 负责连接数据库的方法</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">getConnection</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>接口的实现者</strong>：各大数据库厂商分别对JDBC接口进行实现，实现类被称为<strong>驱动</strong><br>MySQL数据库厂商对JDBC接口的实现：MySQL驱动</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySQLDriver</span> <span class="keyword">implements</span> <span class="title class_">JDBC</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getConnection</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;与MySQL数据库连接建立成功，您正在操作MySQL数据库&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Oracle数据库厂商对JDBC接口的实现：Oracle驱动</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OracleDriver</span> <span class="keyword">implements</span> <span class="title class_">JDBC</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getConnection</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;与Oracle数据库连接建立成功，您正在操作Oracle数据库&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>接口的调用者</strong>：要操作数据库的Java程序员（我们）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">JDBC</span> <span class="variable">jdbc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MySQLDriver</span>();</span><br><span class="line">        <span class="type">JDBC</span> <span class="variable">jdbc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OracleDriver</span>();<span class="comment">//换成Oracle数据库</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 只需要面向接口编程即可，不需要关心具体的实现，不需要关心具体是哪个厂商的数据库</span></span><br><span class="line">        jdbc.getConnection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可能你会说，最终还是修改了java代码，不符合OCP原则呀，如果你想达到OCP，那可以将创建对象的任务交给反射机制，将类名配置到文件中，例如：<br>配置文件如下：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span>=<span class="string">MySQLDriver</span></span><br></pre></td></tr></table></figure><p>Java代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ResourceBundle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">javaProgrammer</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//读取jdbc.properties文件</span></span><br><span class="line">        <span class="comment">//ResourceBundle是资源绑定器，getString是获取key</span></span><br><span class="line">        <span class="type">ResourceBundle</span> <span class="variable">bundle</span> <span class="operator">=</span> ResourceBundle.getBundle(<span class="string">&quot;jdbc&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">driverClassName</span> <span class="operator">=</span> bundle.getString(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        <span class="comment">//String driverClassName = ResourceBundle.getBundle(&quot;jdbc&quot;).getString(&quot;driver&quot;);</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//通过反射机制创建对象</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(driverClassName);</span><br><span class="line">        <span class="type">JDBC</span> <span class="variable">jdbc</span> <span class="operator">=</span> (JDBC)c.newInstance();<span class="comment">//不用泛型返回的是object，向下转型</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 只需要面向接口编程即可，不需要关心具体的实现，不需要关心具体是哪个厂商的数据库</span></span><br><span class="line">        jdbc.getConnection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JDBC的本质：它就是一套接口。</p><h2 id="配置CLASSPATH"><a href="#配置CLASSPATH" class="headerlink" title="配置CLASSPATH"></a>配置CLASSPATH</h2><h3 id="JDBC接口在哪"><a href="#JDBC接口在哪" class="headerlink" title="JDBC接口在哪"></a>JDBC接口在哪</h3><p>JDBC接口在JDK中。对应的包是：<strong>java.sql.*;</strong><br>JDBC API帮助文档就在JDK的帮助文档当中。</p><p><img src="/./images/JDBC/image-20250402192546822.png" alt="image-20250402192546822"></p><p><img src="/./images/JDBC/image-20250402192551502.png" alt="image-20250402192551502"></p><p><img src="/./images/JDBC/image-20250402192556358.png" alt="image-20250402192556358"></p><h3 id="驱动在哪"><a href="#驱动在哪" class="headerlink" title="驱动在哪"></a>驱动在哪</h3><p>打开页面：<a href="https://dev.mysql.com/downloads/connector/j/">https://dev.mysql.com/downloads/connector/j/</a></p><p><img src="/./images/JDBC/image-20250402192624404.png" alt="image-20250402192624404"></p><p>解压：上图中的“mysql-connector-j-8.2.0.jar”就是mysql数据库的驱动，可以使用解压工具打开这个jar包</p><p><img src="/./images/JDBC/image-20250402202217940.png" alt="image-20250402202217940"></p><p>可以看到这个jar包中都是xxx.class文件，这就是JDBC接口的实现类。这个jar包就是连接mysql数据库的驱动。如果是oracle的驱动就需要去oracle的官网下载了。这里不再赘述。</p><h3 id="如果使用文本编辑器开发"><a href="#如果使用文本编辑器开发" class="headerlink" title="如果使用文本编辑器开发"></a>如果使用文本编辑器开发</h3><p>如果使用文本编辑器开发，不使用集成开发环境的话，以上的jar包就需要手动配置到环境变量CLASSPATH当中，配置如下：<br>如果jar包放在这里：</p><p><img src="/./images/JDBC/image-20250402202245669.png" alt="image-20250402202245669"></p><p>就需要这样配置环境变量CLASSPATH：</p><p><img src="/./images/JDBC/image-20250402202257902.png" alt="image-20250402202257902"></p><p>注意：配置了这个目录路径就说明class文件会从这个jar包路径运行，如果默认的话是当前路径，就需要区分，用.来设置当前路径，用;来分开路径</p><h3 id="如果使用IDEA工具开发"><a href="#如果使用IDEA工具开发" class="headerlink" title="如果使用IDEA工具开发"></a>如果使用IDEA工具开发</h3><p>如果是采用集成开发工具，例如IDEA，就不需要手动配置CLASSPATH了，只需要将jar包放到IDEA中（实际上放到IDEA工具中的过程就是等同于在配置CLASSPATH）</p><p>第一步：创建lib目录，将jar包拷贝到lib目录</p><p><img src="/./images/JDBC/image-20250402203157934.png" alt="image-20250402203157934"></p><p>第二步：把lib包引入项目环境</p><p><img src="/./images/JDBC/image-20250402203201699.png" alt="image-20250402203201699"></p><p><img src="/./images/JDBC/image-20250402203206669.png" alt="image-20250402203206669"></p><h1 id="第02章-JDBC的新增修改删除"><a href="#第02章-JDBC的新增修改删除" class="headerlink" title="第02章 JDBC的新增修改删除"></a>第02章 JDBC的新增修改删除</h1><h2 id="JDBC编程六步"><a href="#JDBC编程六步" class="headerlink" title="JDBC编程六步"></a>JDBC编程六步</h2><p>JDBC编程的步骤是很固定的，通常包含以下六步：</p><ul><li>第一步：注册驱动<ul><li>作用一：将 JDBC 驱动程序从硬盘上的文件系统中加载到内存中。</li><li>作用二：使得 DriverManager 可以通过一个统一的接口来管理该驱动程序的所有连接操作。</li></ul></li><li>第二步：获取数据库连接<ul><li>获取java.sql.Connection对象，该对象的创建标志着mysql进程和jvm进程之间的通道打开了。</li></ul></li><li>第三步：获取数据库操作对象<ul><li>获取java.sql.Statement对象，该对象负责将SQL语句发送给数据库，数据库负责执行该SQL语句。</li></ul></li><li>第四步：执行SQL语句<ul><li>执行具体的SQL语句，例如：insert delete update select等。</li></ul></li><li>第五步：处理查询结果集<ul><li>如果之前的操作是DQL查询语句，才会有处理查询结果集这一步。</li><li>执行DQL语句通常会返回查询结果集对象：java.sql.ResultSet。</li><li>对于ResultSet查询结果集来说，通常的操作是针对查询结果集进行结果集的遍历。</li></ul></li><li>第六步：释放资源<ul><li>释放资源可以避免资源的浪费。在 JDBC 编程中，每次使用完 Connection、Statement、ResultSet 等资源后，都需要显式地调用对应的 close() 方法来释放资源，避免资源的浪费。（有关闭顺序，从后往前关</li><li>释放资源可以避免出现内存泄露问题。在 Java 中，当一个对象不再被引用时，会被 JVM 的垃圾回收机制进行回收。但是在 JDBC 编程中，如果不显式地释放资源，那么这些资源就不会被 JVM 的垃圾回收机制自动回收，从而导致内存泄露问题。</li></ul></li></ul><h2 id="数据的准备"><a href="#数据的准备" class="headerlink" title="数据的准备"></a>数据的准备</h2><p>使用PowerDesigner设计用户表t_user。<br>使用Navicat for MySQL创建数据库，创建表，插入数据。</p><h3 id="PowerDesigner与Navicat-for-MySQL的区别"><a href="#PowerDesigner与Navicat-for-MySQL的区别" class="headerlink" title="PowerDesigner与Navicat for MySQL的区别"></a>PowerDesigner与Navicat for MySQL的区别</h3><p>Navicat for MySQL 是一款常用的 MySQL 数据库管理工具，提供了丰富的数据库管理和开发工具，可以方便地进行数据库的连接、查询、管理、模型设计等操作，是 MySQL 开发和管理的效率工具。</p><p>而 PowerDesigner 工具则是一款专业的建模工具，它支持多种数据库和操作系统，可以完成数据库设计、数据建模、过程建模、企业业务建模等工作。PowerDesigner 可以帮助开发人员在数据库设计和开发过程中更好地理解和管理数据，便于协同开发和项目管理。各种数据库技术的建模形式都可以实现，有单个数据库建模到多个数据库建模和业务建模等高级功能，<strong>非常适用于大型项目中的数据库设计和建模</strong>。同时，PowerDesigner 还支持 UML，Java 等编程语言的建模，可以与开发语言无缝整合。</p><p>因此，Navicat for MySQL 和 PowerDesigner 的功能是不同的，可以根据实际需要来选用。如果只是针对 MySQL 的数据库连接、查询、管理等操作，可以使用 Navicat for MySQL 工具，而如果需要进行更复杂的数据库设计、建模和整合等工作，可以使用 PowerDesigner 工具来实现。<strong>如果使用 MySQL 数据库进行开发，使用 Navicat for MySQL 和 PowerDesigner 这两个工具相互配合，可以提高开发效率和数据管理质量</strong>。</p><h3 id="PowerDesigner工具的安装"><a href="#PowerDesigner工具的安装" class="headerlink" title="PowerDesigner工具的安装"></a>PowerDesigner工具的安装</h3><p>来这里下载该工具：链接：<a href="https://pan.baidu.com/s/1lRWC069K8GE-8rxr259ArQ?pwd=2009">https://pan.baidu.com/s/1lRWC069K8GE-8rxr259ArQ?pwd=2009</a> 提取码：2009<br>双击安装包，选择香港，以及接受，替换文件，完成</p><p><img src="/./images/JDBC/image-20250404161430643.png" alt="image-20250404161430643"></p><h3 id="使用PowerDesigner进行物理数据建模"><a href="#使用PowerDesigner进行物理数据建模" class="headerlink" title="使用PowerDesigner进行物理数据建模"></a>使用PowerDesigner进行物理数据建模</h3><p><strong>什么是物理数据模型PDM？</strong><br>&#96;物理数据模型（Physical Data Model，PDM）是数据管理领域中表示数据库逻辑设计后，通过物理设计最终转化为实际数据结构的过程，即在逻辑模型的基础上，进行数据存储结构的设计。</p><p>注意：</p><ol><li>Name：用来设置显示的表名</li><li>Code：用来设置数据库中真实创建的表名</li><li>Comment：对表的注释说明</li></ol><p><img src="/./images/JDBC/image-20250404163131959.png" alt="image-20250404163131959"></p><p>从前往后是名字，真实表名，类型，长度，不知道，主键，不知道，是否为空。</p><p>双击这个1·会打开一个窗口，在comment里可以写注释，在preview里保存sql文件，打开数据库，新建数据库然后执行sql文件，就可以添加数据了</p><h2 id="JDBC完成新增操作"><a href="#JDBC完成新增操作" class="headerlink" title="JDBC完成新增操作"></a>JDBC完成新增操作</h2><p>新增操作就是让数据库执行insert语句。通过这个操作来学习一下JDBC编程的每一步。刚开始编写JDBC代码的时候，建议使用文本编辑器，先不借助任何IDE。</p><h3 id="JDBC编程第一步：注册驱动"><a href="#JDBC编程第一步：注册驱动" class="headerlink" title="JDBC编程第一步：注册驱动"></a>JDBC编程第一步：注册驱动</h3><p>注册驱动有两个作用：</p><ol><li>将 JDBC 驱动程序从硬盘上的文件系统中加载到内存。</li><li>让 DriverManager 可以通过一个统一的接口来管理该驱动程序的所有连接操作。</li></ol><p>API帮助文档：</p><p><img src="/./images/JDBC/image-20250404171020290.png" alt="image-20250404171020290"></p><p>代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.Driver;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCTest01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 注册驱动</span></span><br><span class="line">            <span class="comment">// driver是继承了java.sql.Driver</span></span><br><span class="line">            <span class="comment">// com.mysql.cj.jdbc.Driver是mysql驱动最核心的类</span></span><br><span class="line"></span><br><span class="line">            <span class="type">Driver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.mysql.cj.jdbc.Driver(); <span class="comment">// 创建MySQL驱动对象</span></span><br><span class="line">            <span class="comment">//第二种写法：java.sql.Driver driver = new com.mysql.cj.jdbc.Driver();</span></span><br><span class="line">            <span class="comment">//第三种写法：java.sql.Driver drive = new Driver();import com.mysql.cj.jdbc.Driver;</span></span><br><span class="line">            DriverManager.registerDriver(driver); <span class="comment">// 完成驱动注册，也可以和上面的合并</span></span><br><span class="line">             <span class="comment">// 2. 获取连接，代码看后面的</span></span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span>(SQLException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JDBC编程第二步：获取连接"><a href="#JDBC编程第二步：获取连接" class="headerlink" title="JDBC编程第二步：获取连接"></a>JDBC编程第二步：获取连接</h3><p>获取java.sql.Connection对象，该对象的创建标志着mysql进程和jvm进程之间的通道打开了。</p><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 获取连接</span></span><br><span class="line">           <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/jdbc&quot;</span>;<span class="comment">//jdbc:mysql是协议，localhost是ip，3306是端口，jdbc是数据库</span></span><br><span class="line">           <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">           <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">           <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line"><span class="comment">//返回的Connection是个接口，运行后的结果是com.mysql.cj.jdbc.ConnectionImpl@489115ef</span></span><br><span class="line"><span class="comment">//解释：com.mysql.cj.jdbc.ConnectionImpl是Mysql数据库厂家对java.sql.Connection接口的实现</span></span><br><span class="line"><span class="comment">//java.sql.Connection是sun制定的接口，com.mysql.cj.jdbc.ConnectionImpl是该接口的实现类</span></span><br><span class="line"><span class="comment">//注意：不需要关心具体的实现类是谁，我们只需要面向JDBC接口编写代码即可</span></span><br><span class="line"></span><br><span class="line">           System.out.println(<span class="string">&quot;连接对象：&quot;</span> + conn);</span><br></pre></td></tr></table></figure><h3 id="JDBC编程第三步：获取数据库操作对象"><a href="#JDBC编程第三步：获取数据库操作对象" class="headerlink" title="JDBC编程第三步：获取数据库操作对象"></a>JDBC编程第三步：获取数据库操作对象</h3><p>数据库操作对象是这个接口：java.sql.Statement。这个对象负责将SQL语句发送给数据库服务器，服务器接收到SQL后进行编译，然后执行SQL。</p><p>获取数据库操作对象代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.Statement; </span><br><span class="line"><span class="comment">// 3. 获取数据库操作对象</span></span><br><span class="line">            <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">            System.out.println(<span class="string">&quot;数据库操作对象stmt = &quot;</span> + stmt);</span><br><span class="line"></span><br><span class="line"><span class="type">Statement</span> <span class="variable">stmt2</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">            System.out.println(<span class="string">&quot;数据库操作对象stmt = &quot;</span> + stmt);<span class="comment">//可以创建多个对象</span></span><br></pre></td></tr></table></figure><p>执行结果如下：</p><p><img src="/./images/JDBC/image-20250405030709305.png" alt="image-20250405030709305"></p><p>同样可以看到：java.sql.Statement接口在MySQL驱动中的实现类是：com.mysql.cj.jdbc.StatementImpl。不过我们同样是不需要关心这个具体的实现类。因为后续的代码仍然是面向Statement接口写代码的。</p><h3 id="JDBC编程第四步：执行SQL"><a href="#JDBC编程第四步：执行SQL" class="headerlink" title="JDBC编程第四步：执行SQL"></a>JDBC编程第四步：执行SQL</h3><p>当获取到Statement对象后，调用这个接口中的相关方法即可执行SQL语句。通过execute(String sql)返回布尔值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4. 执行SQL语句</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_user(name,password,realname,gender,tel) values(&#x27;tangsanzang&#x27;,&#x27;123&#x27;,&#x27;唐三藏&#x27;,&#x27;男&#x27;,&#x27;12566568956&#x27;);&quot;</span>; <span class="comment">// sql语句最后的分号&#x27;;&#x27;可以不写。</span></span><br><span class="line"><span class="comment">//返回值的含义：当sql语句是一个DQL语句的时候，并且查询到了结果，返回true</span></span><br><span class="line"><span class="comment">//当sql语句是dml语句或者没有查询到任何结果的时候，返回false。这个方法功能比较广泛（不够专业），适合所有的sql语句，很少用</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> stmt.execute(sql);</span><br><span class="line">            System.out.println(isSuccess ? <span class="string">&quot;插入失败&quot;</span> : <span class="string">&quot;插入成功&quot;</span>);</span><br></pre></td></tr></table></figure><p>API帮助文档如下：</p><p><img src="/./images/JDBC/image-20250405032249566.png" alt="image-20250405032249566"></p><p>返回1表示1条数据插入成功，返回2表示2条数据插入成功，以此类推。如果一条也没有插入，则返回0。</p><p>该方法适合执行的SQL语句是DML，包括：insert delete update。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4. 执行SQL语句</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_user(name,password,realname,gender,tel) values(&#x27;tangsanzang&#x27;,&#x27;123&#x27;,&#x27;唐三藏&#x27;,&#x27;男&#x27;,&#x27;12566568956&#x27;)&quot;</span>; <span class="comment">// sql语句最后的分号&#x27;;&#x27;可以不写。</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> stmt.executeUpdate(sql);</span><br><span class="line">            System.out.println(<span class="string">&quot;插入了&quot;</span> + count + <span class="string">&quot;条记录&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="JDBC编程第六步：释放资源"><a href="#JDBC编程第六步：释放资源" class="headerlink" title="JDBC编程第六步：释放资源"></a>JDBC编程第六步：释放资源</h3><p>第五步去哪里了？第五步是处理查询结果集，以上操作不是select语句，所以第五步直接跳过，直接先看一下第六步释放资源。【后面学习查询语句的时候，再详细看第五步】</p><h4 id="为什么要释放资源"><a href="#为什么要释放资源" class="headerlink" title="为什么要释放资源"></a>为什么要释放资源</h4><p>在 JDBC 编程中，建立数据库连接、创建 Statement 对象等操作都需要申请系统资源，例如打开网络端口、申请内存等。为了避免占用过多的系统资源和避免出现内存泄漏等问题，我们需要在使用完资源后及时释放它们。</p><h4 id="释放资源的原则"><a href="#释放资源的原则" class="headerlink" title="释放资源的原则"></a>释放资源的原则</h4><p>原则1：在finally语句块中释放</p><ul><li>建议在finally语句块中释放，因为程序执行过程中如果出现了异常，finally语句块中的代码是一定会执行的。也就是说：我们需要保证程序在执行过程中，不管是否出现了异常，最后的关闭是一定要执行的。当然了，也可以使用Java7的新特性：Try-with-resources。Try-with-resources 是 Java 7 引入的新特性。它简化了资源管理的代码实现，可以自动释放资源，减少了代码出错的可能性，同时也可以提供更好的代码可读性和可维护性。</li></ul><p>原则2：释放有顺序</p><ul><li>从小到大依次释放，创建的时候，先创建Connection，再创建Statement。那么关闭的时候，先关闭Statement，再关闭Connection。</li></ul><p>原则3：分别进行try…catch…</p><ul><li>关闭的时候调用close()方法，该方法有异常需要处理，建议分别对齐try…catch…进行异常捕获。如果只编写一个try…catch…进行一块捕获，在关闭过程中，如果某个关闭失败，会影响下一个资源的关闭。</li></ul><h4 id="代码如何实现"><a href="#代码如何实现" class="headerlink" title="代码如何实现"></a>代码如何实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#125; <span class="keyword">catch</span>(SQLException e)&#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           <span class="comment">// 6. 释放资源</span></span><br><span class="line">    <span class="comment">// 原则：从小到大按照这个顺序关闭</span></span><br><span class="line">    <span class="comment">// 关闭前最好判断一下是否为空</span></span><br><span class="line">    <span class="comment">// 分别对其进行try...catch</span></span><br><span class="line">           <span class="keyword">if</span>(stmt != <span class="literal">null</span>)&#123;</span><br><span class="line">               <span class="keyword">try</span>&#123;</span><br><span class="line">                   stmt.close();<span class="comment">//注意stmt是局部变量要改一下</span></span><br><span class="line">               &#125;<span class="keyword">catch</span>(SQLException e)&#123;</span><br><span class="line">                   e.printStackTrace();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span>(conn != <span class="literal">null</span>)&#123;</span><br><span class="line">               <span class="keyword">try</span>&#123;</span><br><span class="line">                   conn.close();</span><br><span class="line">               &#125;<span class="keyword">catch</span>(SQLException e)&#123;</span><br><span class="line">                   e.printStackTrace();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><h3 id="什么是URL"><a href="#什么是URL" class="headerlink" title="什么是URL"></a>什么是URL</h3><p>URL 是统一资源定位符 (Uniform Resource Locator) 的缩写，是互联网上标识、定位、访问资源的字符串。它可以用来指定互联网上各种类型的资源的位置，如网页、图片、视频等。</p><p>URL 通常由协议、服务器名、服务器端口、路径和查询字符串组成。其中：</p><ul><li>协议是规定了访问资源所采用的通信协议，例如 HTTP、HTTPS、FTP 等；</li><li>服务器名是资源所在的服务器主机名或 IP 地址，可以是域名或 IP 地址；</li><li>服务器端口是资源所在的服务器的端口号；</li><li>路径是资源所在的服务器上的路径、文件名等信息；</li><li>查询字符串是向服务器提交的参数信息，用来定位更具体的资源。</li></ul><p>URL 在互联网中广泛应用，比如在浏览器中输入 URL 来访问网页或下载文件，在网站开发中使用 URL 来访问 API 接口或文件，在移动应用和桌面应用中使用 URL 来访问应用内部的页面或功能，在搜索引擎中使用 URL 来爬取网页内容等等。</p><p>总之，URL 是互联网上所有资源的唯一识别标识，是互联网通信的基础和核心技术之一。<br><img src="/./images/JDBC/1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg"></p><h3 id="JDBC连接MySQL时的URL格式"><a href="#JDBC连接MySQL时的URL格式" class="headerlink" title="JDBC连接MySQL时的URL格式"></a>JDBC连接MySQL时的URL格式</h3><p>JDBC URL 是在使用 JDBC 连接数据库时的一个 URL 字符串，它用来标识要连接的数据库的位置、认证信息和其他配置参数等。JDBC URL 的格式可以因数据库类型而异，但通常包括以下几个部分：</p><ul><li>协议：表示要使用的数据库管理系统（DBMS）的类型，如 <code>jdbc:mysql</code> 表示要使用 MySQL 数据库，<code>jdbc:postgresql</code> 表示要使用 PostgreSQL 数据库。</li><li>主机地址和端口号：表示要连接的数据库所在的服务器的 IP 地址或域名，以及数据库所在服务器监听的端口号。</li><li>数据库名称：表示要连接的数据库的名称。</li><li>其他可选参数：这些参数包括连接的超时时间、使用的字符集、连接池相关配置等。</li></ul><p>例如，连接 MySQL 数据库的 JDBC URL 的格式一般如下：可以在?后面加用户名密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc:mysql://&lt;host&gt;:&lt;port&gt;/&lt;database_name&gt;?&lt;connection_parameters&gt;</span><br></pre></td></tr></table></figure><p>其中：</p><ul><li><code>&lt;host&gt;</code> 是 MySQL 数据库服务器的主机名或 IP 地址；</li><li><code>&lt;port&gt;</code> 是 MySQL 服务器的端口号（默认为 3306）；</li><li><code>&lt;database_name&gt;</code> 是要连接的数据库名称；</li><li><code>&lt;connection_parameters&gt;</code> 包括连接的额外参数，例如用户名、密码、字符集等。</li></ul><p>JDBC URL 是连接数据库的关键，通过 JDBC URL，应用程序可以通过特定的 JDBC 驱动程序与数据库服务器进行通信，从而实现与数据库的交互。在开发 Web 应用和桌面应用时，使用 JDBC URL 可以轻松地连接和操作各种类型的数据库，例如 MySQL、PostgreSQL、Oracle 等。</p><p>以下是一个常见的JDBC MySQL URL：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc:mysql://localhost:3306/jdbc</span><br></pre></td></tr></table></figure><p><code>jdbc:mysql://</code>是协议<br><code>localhost</code>表示连接本地主机的MySQL数据库，也可以写作<code>127.0.0.1</code><br><code>3306</code>是MySQL数据库的端口号<br><code>jdbc</code>是数据库实例名</p><h3 id="MySQL-URL中的其它常用配置"><a href="#MySQL-URL中的其它常用配置" class="headerlink" title="MySQL URL中的其它常用配置"></a>MySQL URL中的其它常用配置</h3><p>在 JDBC MySQL URL 中，常用的配置参数有：</p><ul><li><code>serverTimezone</code>：MySQL 服务器时区，默认为 UTC，可以通过该参数来指定客户端和服务器的时区；</li></ul><p>在 JDBC URL 中设置 <code>serverTimezone</code> 的作用是指定数据库服务器的时区。这个时区信息会影响 JDBC 驱动在处理日期时间相关数据类型时如何将其映射到服务器上的日期时间值。<br><strong>如果不设置 <code>serverTimezone</code>，则 JDBC 驱动程序默认将使用本地时区，也就是客户端机器上的系统时区，来处理日期时间数据</strong>。在这种情况下，如果服务器的时区和客户端机器的时区不同，那么处理日期时间数据时可能会出现问题，从而导致数据错误或不一致。<br>例如，假设服务器位于美国加州，而客户端位于中国上海，如果不设置 <code>serverTimezone</code> 参数，在客户端执行类似下面的查询：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> order_date <span class="operator">=</span> <span class="string">&#x27;2022-11-11&#x27;</span>;</span><br></pre></td></tr></table></figure><p>由于客户端和服务器使用了不同的时区，默认使用的是客户端本地的时区，那么实际查询的时间就是客户端本地时间对应的时间，而不是服务器的时间。这可能会导致查询结果不正确，因为服务器上的时间可能是比客户端慢或者快了多个小时。<br>通过在 JDBC URL 中设置 <code>serverTimezone</code> 参数，可以明确告诉 JDBC 驱动程序使用哪个时区来处理日期时间值，从而避免这种问题。在上述例子中，如果把时区设置为 <code>America/Los_Angeles</code>（即加州的时区）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc:mysql://localhost:3306/mydatabase?user=myusername&amp;password=mypassword&amp;serverTimezone=America/Los_Angeles</span><br></pre></td></tr></table></figure><p>那么上面的查询就会在数据库服务器上以加州的时间来执行，结果更加准确。</p><ul><li><code>useSSL</code>：是否使用 SSL 进行连接，默认为 true；</li></ul><p><code>useSSL</code> 参数用于配置是否使用 SSL（Secure Sockets Layer）安全传输协议来加密 JDBC 和 MySQL 数据库服务器之间的通信。其设置为 <code>true</code> 表示使用 SSL 连接，设置为 <code>false</code> 表示不使用 SSL 连接。其区别如下：</p><p>当设置为 <code>true</code> 时，JDBC 驱动程序将使用 SSL <strong>加密协议来保障客户端和服务器之间的通信安全</strong>。这种方式下，所有数据都会使用 SSL 加密后再传输，可以有效防止数据在传输过程中被窃听、篡改等安全问题出现。当然，也要求服务器端必须支持 SSL，否则会连接失败。</p><p>当设置为 <code>false</code> 时，JDBC 驱动程序会以明文方式传输数据，这种方式下，虽然数据传输的速度会更快，但也会存在被恶意攻击者截获和窃听数据的风险。因此，在不安全的网络环境下，或是要求数据传输安全性较高的情况下，建议使用 SSL 加密连接。</p><p>需要注意的是，使用 **SSL 连接会对系统资源和性能消耗有一定的影响，特别是当连接数较多时，对 CPU 和内存压力都比较大。**因此，在性能和安全之间需要权衡，根据实际应用场景合理设置 <code>useSSL</code> 参数。</p><ul><li>useUnicode：是否使用Unicode编码进行数据传输，默认是true启用</li></ul><p><code>useUnicode</code>是 JDBC 驱动程序连接数据库时的一个参数，用于告诉驱动程序在传输数据时是否使用 Unicode 编码。主要是为了跨平台</p><p>具体地说，如果设置 <code>useUnicode=true</code>，JDBC 驱动程序会在传输数据时使用 Unicode 编码。这意味着，无论数据源中使用的是什么编码方案，都会先将数据转换为 Unicode 编码进行传输，确保数据能够跨平台、跨数据库正确传输。当从数据库中获取数据时，驱动程序会根据 <code>characterEncoding</code> 参数指定的字符集编码将数据转换为指定编码格式，以便应用程序正确处理数据。</p><p>需要注意的是，如果设置 <code>useUnicode=false</code>，则表示使用当前平台默认的字符集进行数据传输。这可能会导致在跨平台或跨数据库时出现字符编码不一致的问题，因此通常建议在进行数据传输时启用 Unicode 编码。</p><ul><li><code>characterEncoding</code>：连接使用的字符编码，默认为 UTF-8；</li></ul><p><code>characterEncoding</code> 参数用于设置 MySQL 服务器和 JDBC 驱动程序之间进行字符集转换时使用的字符集编码。其设置为 <code>UTF-8</code> 表示使用 UTF-8 编码进行字符集转换，设置为 <code>GBK</code> 表示使用 GBK 编码进行字符集转换。其区别如下：<br>UTF-8 编码是一种可变长度的编码方式，可以表示世界上的所有字符，包括 ASCII、Unicode 和不间断空格等字符，是一种通用的编码方式。UTF-8 编码在国际化应用中被广泛使用，并且其使用的字节数较少，有利于提高数据传输的效率和节约存储空间。</p><p><strong>注意：useUnicode和characterEncoding有什么区别？</strong></p><ul><li><strong>useUnicode设置的是数据在传输过程中是否使用Unicode编码方式。</strong></li><li><strong>characterEncoding设置的是数据被传输到服务器之后，服务器采用哪一种字符集进行编码。</strong></li></ul><p>例如，连接 MySQL 数据库的 JDBC URL 可以如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc:mysql://localhost:3306/jdbc?useUnicode=true&amp;serverTimezone=Asia/Shanghai&amp;useSSL=true&amp;characterEncoding=utf-8</span><br></pre></td></tr></table></figure><p>这里演示的是使用本地 MySQL 数据库，使用Unicode编码进行数据传输，服务器时区为 Asia&#x2F;Shanghai，启用 SSL 连接，服务器接收到数据后使用 UTF-8 编码。</p><h2 id="注册驱动的常用方式"><a href="#注册驱动的常用方式" class="headerlink" title="注册驱动的常用方式"></a>注册驱动的常用方式</h2><p>上面在注册驱动的时候，执行了这样的代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java.sql.<span class="type">Driver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.mysql.cj.jdbc.Driver();</span><br><span class="line">java.sql.DriverManager.registerDriver(driver);</span><br></pre></td></tr></table></figure><p>这种方式是自己new驱动对象，然后调用DriverManager的registerDriver()方法来完成驱动注册，还有另一种方式，并且这种方式是常用的：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br></pre></td></tr></table></figure><p>为什么这种方式常用？</p><ul><li>第一：代码少了很多。</li><li>第二：这种方式可以很方便的将<code>com.mysql.cj.jdbc.Driver</code>类名配置到属性文件当中。</li></ul><p>实现原理是什么？找一下<code>com.mysql.cj.jdbc.Driver</code>的源码：</p><p><img src="/./images/JDBC/image-20250406151334165.png" alt="image-20250406151334165"></p><p><img src="/./images/JDBC/image-20250406151348702.png" alt="image-20250406151348702"></p><p>在<code>com.mysql.cj.jdbc.Driver</code>类中有一个静态代码块，在这个静态代码块中调用了<code>java.sql.DriverManager.registerDriver(new Driver());</code>完成了驱动的注册。而<code>Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;);</code>代码的作用就是让<code>com.mysql.cj.jdbc.Driver</code>类完成加载，执行它的静态代码块。</p><p>这样写也主要是为了方便在配置文件里改动，而不是写死在代码里</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">注册驱动的第二种方式：常用的。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCTest04</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"><span class="comment">// 注册驱动</span></span><br><span class="line"><span class="comment">// 第一种方式</span></span><br><span class="line"><span class="comment">//Driver driver = new com.mysql.cj.jdbc.Driver();</span></span><br><span class="line"><span class="comment">//DriverManager.registerDriver(driver);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种方式</span></span><br><span class="line"><span class="comment">// 本质上和第一种方式还是相同的。</span></span><br><span class="line"><span class="comment">// 因为以下代码在执行的时候，会将com.mysql.cj.jdbc.Driver进行类加载。</span></span><br><span class="line"><span class="comment">// 类加载的时候会执行 com.mysql.cj.jdbc.Driver 类中的静态代码块。</span></span><br><span class="line"><span class="comment">//Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取连接</span></span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/jdbc?useUnicode=true&amp;serverTimezone=Asia/Shanghai&amp;useSSL=true&amp;characterEncoding=utf-8&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;1234&quot;</span>;</span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line">System.out.println(conn);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个com.mysql.cj.jdbc.Driver类中的静态代码块如下：</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    static &#123;</span></span><br><span class="line"><span class="comment">        try &#123;</span></span><br><span class="line"><span class="comment">            java.sql.DriverManager.registerDriver(new Driver());</span></span><br><span class="line"><span class="comment">        &#125; catch (SQLException E) &#123;</span></span><br><span class="line"><span class="comment">            throw new RuntimeException(&quot;Can&#x27;t register driver!&quot;);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="JDBC-4-0后不用手动注册驱动（了解）"><a href="#JDBC-4-0后不用手动注册驱动（了解）" class="headerlink" title="JDBC 4.0后不用手动注册驱动（了解）"></a>JDBC 4.0后不用手动注册驱动（了解）</h2><p>从JDBC 4.0（<strong>也就是Java6</strong>）版本开始，驱动的注册不需要再手动完成，由系统自动完成。</p><p>也就是第一步可以不用写了。</p><p><strong>注意：虽然大部分情况下不需要进行手动注册驱动了，但在实际的开发中有些数据库驱动程序不支持自动发现功能，仍然需要手动注册。所以建议大家还是别省略了。</strong></p><h2 id="IDEA创建JDBK"><a href="#IDEA创建JDBK" class="headerlink" title="IDEA创建JDBK"></a>IDEA创建JDBK</h2><p>先新建一个project，然后点file里的<img src="/./images/JDBC/image-20250406184622739.png" alt="image-20250406184622739">设置一下jdk版本为21</p><p>然后新建一个目录<img src="/./images/JDBC/image-20250406184952984.png" alt="image-20250406184952984">，写上lib，然后把jdbc的jar包复制，选中lib粘贴就进去了，选中这个jar包右击有个add as library就添加进去了</p><h2 id="动态配置连接数据库的信息"><a href="#动态配置连接数据库的信息" class="headerlink" title="动态配置连接数据库的信息"></a>动态配置连接数据库的信息</h2><p>为了程序的通用性，为了切换数据库的时候不需要修改Java程序，为了符合OCP开闭原则，建议将连接数据库的信息配置到属性文件中，例如：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/jdbc?useUnicode=true&amp;serverTimezone=Asia/Shanghai&amp;useSSL=true&amp;characterEncoding=utf-8</span></span><br><span class="line"><span class="attr">user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure><p>然后使用IO流读取属性文件，动态获取连接数据库的信息：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCTest01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//读取属性配置文件，获取连接数据库信息</span></span><br><span class="line">        <span class="type">ResourceBundle</span> <span class="variable">bundle</span> <span class="operator">=</span> ResourceBundle.getBundle(<span class="string">&quot;com.powernode.jdbc.jdbc01&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> bundle.getString(<span class="string">&quot;driver&quot;</span>);<span class="comment">//这些是读取配置</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> bundle.getString(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> bundle.getString(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> bundle.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.注册驱动</span></span><br><span class="line">            Class.forName(driver);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.获取连接</span></span><br><span class="line">            conn = DriverManager.getConnection(url, user, password);<span class="comment">//这个是发送读取到的信息</span></span><br><span class="line">            System.out.println(conn);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (conn != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="获取连接的其他方式（了解）"><a href="#获取连接的其他方式（了解）" class="headerlink" title="获取连接的其他方式（了解）"></a>获取连接的其他方式（了解）</h2><p>上面我们讲到了第一种获取连接的方式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br></pre></td></tr></table></figure><h3 id="getConnection-String-url"><a href="#getConnection-String-url" class="headerlink" title="getConnection(String url)"></a>getConnection(String url)</h3><p>这种方式参数只有一个url，那用户名和密码放在哪里呢？可以放到url当中，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// getConnection(url)</span></span><br><span class="line">      Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/jdbc?user=root&amp;password=liuqi3711022&amp;useUnicode=true&amp;serverTimezone=Asia/Shanghai&amp;useSSL=true&amp;characterEncoding=utf-8&quot;</span>;</span><br><span class="line">      <span class="comment">//jdbc?user=root&amp;password=liuqi3711022密码写到这里面了</span></span><br><span class="line">      <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url);</span><br><span class="line">      System.out.println(conn);</span><br></pre></td></tr></table></figure><h3 id="getConnection-String-url-Properties-info"><a href="#getConnection-String-url-Properties-info" class="headerlink" title="getConnection(String url, Properties info)"></a>getConnection(String url, Properties info)</h3><p>这种方式有两个参数，一个是url，一个是Properties对象。</p><ul><li>url：可以单纯提供一个url地址</li><li>info：可以将url的参数存放到该对象中</li></ul><p>代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// getConnection(url, info)</span></span><br><span class="line">       Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">       <span class="comment">// url</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/jdbc&quot;</span>;</span><br><span class="line">       <span class="comment">// info</span></span><br><span class="line">       <span class="type">Properties</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">       info.setProperty(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">       info.setProperty(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;1234&quot;</span>);</span><br><span class="line">       info.setProperty(<span class="string">&quot;useUnicode&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">       info.setProperty(<span class="string">&quot;serverTimezone&quot;</span>, <span class="string">&quot;Asia/Shanghai&quot;</span>);</span><br><span class="line">       info.setProperty(<span class="string">&quot;useSSL&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">       info.setProperty(<span class="string">&quot;characterEncoding&quot;</span>, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, info);</span><br><span class="line">       System.out.println(<span class="string">&quot;====&gt;&quot;</span> + conn);</span><br></pre></td></tr></table></figure><h1 id="第03章-JDBC的查询"><a href="#第03章-JDBC的查询" class="headerlink" title="第03章 JDBC的查询"></a>第03章 JDBC的查询</h1><h2 id="JDBC的查询操作"><a href="#JDBC的查询操作" class="headerlink" title="JDBC的查询操作"></a>JDBC的查询操作</h2><p>ResultSet 是 JDBC （Java 数据库连接） API 提供的接口，它用于表示 SQL 查询的结果集。ResultSet 对象中包含了查询结果的所有行，可以通过 next() 方法逐行地获取并处理每一行的数据。它最常用于执行 SELECT 语句查询出来的结果集。</p><p>ResultSet 的遍历是基于 JDBC 的流式处理机制的，即一行一行地获取结果，避免将所有结果全部取出后再进行处理导致内存溢出问题。</p><p>在使用完 ResultSet 对象之后，需要及时关闭它，有正确关闭它们的话，可能会导致数据库连接过多，从而影响系统的稳定性和性能。</p><h3 id="通过列索引获取数据（以String类型获取）"><a href="#通过列索引获取数据（以String类型获取）" class="headerlink" title="通过列索引获取数据（以String类型获取）"></a>通过列索引获取数据（以String类型获取）</h3><p>代码：jdbcTest03’</p><p>执行insert delete update语句的时候，调用Statement接口的executeUpdate()方法。<br>执行select语句的时候，<strong>调用Statement接口的executeQuery()方法</strong>。执行select语句后返回结果集对象：ResultSet。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.执行sql</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select realname,id,name,password from t_user&quot;</span>;</span><br><span class="line">        rs = stmt.executeQuery(sql);<span class="comment">//query是查询的意思</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5.处理查询结果集</span></span><br><span class="line">        <span class="comment">//这里的处理方式是直接打印输出</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        +----------+----+----------+----------+</span></span><br><span class="line"><span class="comment">        | realname | id | name     | password |</span></span><br><span class="line"><span class="comment">        +----------+----+----------+----------+</span></span><br><span class="line"><span class="comment">        | 张三     |  1 | zhangsan | 123      |</span></span><br><span class="line"><span class="comment">        | 管理员   |  2 | admin    | admin123 |</span></span><br><span class="line"><span class="comment">        +----------+----+----------+----------+</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">         </span><br><span class="line">          <span class="comment">//写成循环</span></span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">            <span class="comment">// 取出当前光标指向的这一行的数据</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> rs.getString(<span class="number">1</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> rs.getString(<span class="number">2</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> rs.getString(<span class="number">3</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> rs.getString(<span class="number">4</span>);</span><br><span class="line">            System.out.println(s1 + <span class="string">&quot;\t&quot;</span> + s2 + <span class="string">&quot;\t&quot;</span> + s3 + <span class="string">&quot;\t&quot;</span> + s4);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><ul><li><p><strong>rs.next() 将游标移动到下一行，如果移动后指向的这一行有数据则返回true，没有数据则返回false。</strong></p></li><li><p><strong>while循环体当中的代码是处理当前游标指向的这一行的数据。（注意：是处理的一行数据）</strong></p></li><li><p><strong>rs.getString(int columnIndex) 其中 int columnIndex 是查询结果的列下标，列下标从1开始，以1递增。</strong></p></li><li><p>rs.getString(…) 方法在执行时，不管底层数据库中的数据类型是什么，统一以字符串String类型来获取。</p></li></ul><p>ResultSet最终也是需要关闭的。<strong>先关闭ResultSet，再关闭Statement，最后关闭Connection</strong>。</p><h3 id="通过列名获取数据（以String类型获取）"><a href="#通过列名获取数据（以String类型获取）" class="headerlink" title="通过列名获取数据（以String类型获取）"></a>通过列名获取数据（以String类型获取）</h3><p>获取当前行的数据，不仅可以通过列下标获取，还可以通过查询结果的列名来获取，通常这种方式是被推荐的，因为可读性好。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询所有员工信息</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql3</span> <span class="operator">=</span> <span class="string">&quot;select empno a, ename b, sal c from emp&quot;</span>;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            +------+--------+---------+</span></span><br><span class="line"><span class="comment">            | a    | b      | c       |</span></span><br><span class="line"><span class="comment">            +------+--------+---------+</span></span><br><span class="line"><span class="comment">            | 7369 | SMITH  |  800.00 |</span></span><br><span class="line"><span class="comment">            | 7499 | ALLEN  | 1600.00 |</span></span><br><span class="line"><span class="comment">            | 7521 | WARD   | 1250.00 |</span></span><br><span class="line"><span class="comment">                  */</span></span><br><span class="line">rs = stmt.executeQuery(sql3);</span><br><span class="line">            <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">empno</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">                <span class="comment">// 报错，原因：这是因为查询结果集中没有empno这个列。只有a这个列。</span></span><br><span class="line">                <span class="comment">// 要以最终的查询结果的那个列为准，不是表格中字段的名字</span></span><br><span class="line">                <span class="comment">//int empno = rs.getInt(&quot;empno&quot;);</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">ename</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">sal</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">                System.out.println(empno + <span class="string">&quot;,&quot;</span> + ename + <span class="string">&quot;,&quot;</span> + sal);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>注意：是根据查询结果的列名，而不是表中的列名。以上查询的时候将字段起别名abc了，所以要根据abc来获取，而不能再根据以前的来获取了。</p><h3 id="以指定的类型获取数据"><a href="#以指定的类型获取数据" class="headerlink" title="以指定的类型获取数据"></a>以指定的类型获取数据</h3><p>前面的程序可以看到，不管数据库表中是什么数据类型，都以String类型返回。当然，也能以指定类型返回。</p><p>使用PowerDesigner再设计一张商品表：t_product，使用Navicat for MySQL工具准备数据如下：</p><p><img src="/./images/JDBC/image-20250408173045702.png" alt="image-20250408173045702"></p><p><img src="/./images/JDBC/image-20250408173051223.png" alt="image-20250408173051223"></p><p>id以long类型获取，name以String类型获取，price以double类型获取，create_time以java.sql.Date类型获取，代码如下：</p><p>createTime.getTime()是获取到毫秒级</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.执行sql语句</span></span><br><span class="line">           <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select id,name,price,create_time from t_product&quot;</span>;</span><br><span class="line">           rs = stmt.executeQuery(sql);</span><br><span class="line">           <span class="comment">// 5.处理查询结果集</span></span><br><span class="line">           <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy年MM月dd日&quot;</span>);</span><br><span class="line">           <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">               <span class="comment">// 以特定的类型获取数据</span></span><br><span class="line">               <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> rs.getLong(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">               <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">               <span class="type">double</span> <span class="variable">price</span> <span class="operator">=</span> rs.getDouble(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">               <span class="comment">// 注意：从mysql数据库当中获取的日期类型的数据对应的java类型是：java.sql.Date。不是java.util.Date。</span></span><br><span class="line">               <span class="type">Date</span> <span class="variable">createTime</span> <span class="operator">=</span> rs.getDate(<span class="string">&quot;create_time&quot;</span>);</span><br><span class="line">               System.out.println(id + <span class="string">&quot;,&quot;</span> + name + <span class="string">&quot;,&quot;</span> + price + <span class="string">&quot;,&quot;</span> + createTime);</span><br><span class="line">               <span class="comment">// 将java.sql.Date 转换成 java.util.Date（通过构造方法来完成转换。）</span></span><br><span class="line">               java.util.<span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">java</span>.util.Date(createTime.getTime());<span class="comment">//这里的getTime获取的是毫秒级，然后通过构造方法封装成utildate</span></span><br><span class="line">               <span class="comment">// 进行格式化显示</span></span><br><span class="line">               <span class="type">String</span> <span class="variable">strDate</span> <span class="operator">=</span> sdf.format(date);</span><br><span class="line">               System.out.println(strDate);</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure><h3 id="获取结果集的元数据信息（了解）"><a href="#获取结果集的元数据信息（了解）" class="headerlink" title="获取结果集的元数据信息（了解）"></a>获取结果集的元数据信息（了解）</h3><p><img src="/./images/JDBC/image-20250408181241113.png" alt="image-20250408181241113"></p><p><strong>这组数据整个叫ResultSet对象，而id的那一行数据叫做结果集元数据对象ResultSetMetaData</strong><br>ResultSetMetaData 是一个接口，用于描述 ResultSet 中的元数据信息，即查询结果集的结构信息，例如查询结果集中包含了哪些列，每个列的数据类型、长度、标识符等。</p><p>ResultSetMetaData 可以通过 ResultSet 接口的 getMetaData() 方法获取，一般在对 ResultSet 进行元数据信息处理时使用。</p><ul><li>ResultSetMetaData rsmd &#x3D; rs.getMetaData();&#x2F;&#x2F;返回的是ResultSetMetaData</li><li>rsmd.getColumnCount();&#x2F;&#x2F;获取列的数量</li><li>rsmd.getColumnName(i);&#x2F;&#x2F; 获取列的名字</li><li>rsmd.getColumnTypeName(i);  &#x2F;&#x2F; 获取列的数据类型</li><li>rsmd.getColumnDisplaySize(i);  &#x2F;&#x2F; 获取列的长度</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.执行sql语句</span></span><br><span class="line">          <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from t_product&quot;</span>;</span><br><span class="line">          rs = stmt.executeQuery(sql);</span><br><span class="line">          <span class="comment">// 5.处理查询结果集</span></span><br><span class="line">          <span class="comment">// 通过结果集ResultSet来获取结果集元数据ResultSetMetaData</span></span><br><span class="line">          <span class="comment">// 通过结果集元数据可以获取列的信息，例如：列名，列的数据类型，列的长度...</span></span><br><span class="line">          <span class="type">ResultSetMetaData</span> <span class="variable">rsmd</span> <span class="operator">=</span> rs.getMetaData();<span class="comment">//返回的是ResultSetMetaData</span></span><br><span class="line">          <span class="type">int</span> <span class="variable">columnCount</span> <span class="operator">=</span> rsmd.getColumnCount();<span class="comment">//获取列的数量</span></span><br><span class="line">          System.out.println(<span class="string">&quot;共&quot;</span> + columnCount + <span class="string">&quot;列&quot;</span>);</span><br><span class="line">          <span class="comment">// 遍历每一列</span></span><br><span class="line">          <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; columnCount; i++) &#123;<span class="comment">// 1,2,3,4</span></span><br><span class="line">              <span class="comment">// i是列的下标。（注意：JDBC中所有的下标都是从1开始。）</span></span><br><span class="line">              <span class="comment">// 获取列的名字</span></span><br><span class="line">              <span class="type">String</span> <span class="variable">columnName</span> <span class="operator">=</span> rsmd.getColumnName(i);</span><br><span class="line">              System.out.println(<span class="string">&quot;第&quot;</span> + i + <span class="string">&quot;列的列名&quot;</span> + columnName);</span><br><span class="line">              <span class="comment">// 获取列的数据类型</span></span><br><span class="line">              <span class="type">String</span> <span class="variable">columnTypeName</span> <span class="operator">=</span> rsmd.getColumnTypeName(i);</span><br><span class="line">              System.out.println(<span class="string">&quot;第&quot;</span> + i + <span class="string">&quot;列的类型是&quot;</span> + columnTypeName);</span><br><span class="line">              <span class="comment">// 获取列的长度</span></span><br><span class="line">              <span class="type">int</span> <span class="variable">columnDisplaySize</span> <span class="operator">=</span> rsmd.getColumnDisplaySize(i);</span><br><span class="line">              System.out.println(<span class="string">&quot;第&quot;</span> + i + <span class="string">&quot;列的长度&quot;</span> + columnDisplaySize);</span><br><span class="line"></span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure><p>在上面的代码中，我们首先创建了一个 Statement 对象，然后执行了一条 SQL 查询语句，生成了一个 ResultSet 对象。接下来，我们通过 ResultSet 对象的 getMetaData() 方法获取了 ResultSetMetaData 对象，进而获取了查询结果中列的信息并进行输出。需要注意的是，在进行列信息的获取时，列的编号从 1 开始计算。该示例代码将获取查询结果集中所有列名、数据类型以及长度等信息。</p><h3 id="获取新增行的主键值"><a href="#获取新增行的主键值" class="headerlink" title="获取新增行的主键值"></a>获取新增行的主键值</h3><p>有很多表的主键字段值都是自增的，在某些特殊的业务环境下，当我们插入了新数据后，希望能够获取到这条新数据的主键值，应该如何获取呢？<br>在 JDBC 中，如果要获取插入数据后的主键值，可以使用 Statement 接口的 executeUpdate() 方法的重载版本，该方法接受一个额外的参数，用于指定是否需要获取自动生成的主键值。然后，通过以下两个步骤获取插入数据后的主键值：</p><ol><li>在执行 executeUpdate() 方法时指定一个标志位，表示需要返回插入的主键值。</li><li>调用 Statement 对象的 getGeneratedKeys() 方法，返回一个包含插入的主键值的 ResultSet 对象。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.执行sql语句</span></span><br><span class="line">           <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_product(name,price,create_time) values(&#x27;小米su7&#x27;, 1.0, &#x27;2024-02-23&#x27;)&quot;</span>;</span><br><span class="line">           <span class="comment">// 注意：第二个参数是标志位，用来表示是否将新插入的数据行的主键值返回</span></span><br><span class="line">           <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> stmt.executeUpdate(sql, Statement.RETURN_GENERATED_KEYS);<span class="comment">//后面也可以写成1，但最好是写常量</span></span><br><span class="line">           System.out.println(<span class="string">&quot;插入了&quot;</span> + count + <span class="string">&quot;条记录&quot;</span>);</span><br><span class="line">           <span class="comment">// 获取这个新增行的主键值</span></span><br><span class="line">           <span class="comment">// 返回的这个rs结果集中就包含了新增行的主键值</span></span><br><span class="line">           rs = stmt.getGeneratedKeys();</span><br><span class="line">           <span class="comment">// 通过结果集取主键值</span></span><br><span class="line">           <span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">               <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> rs.getLong(<span class="number">1</span>);<span class="comment">//第一列</span></span><br><span class="line">               System.out.println(<span class="string">&quot;新增行的主键值：&quot;</span> + id);</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure><h2 id="使用IDEA工具类-DbUtils-编写JDBC程序"><a href="#使用IDEA工具类-DbUtils-编写JDBC程序" class="headerlink" title="使用IDEA工具类(DbUtils)编写JDBC程序"></a>使用IDEA工具类(DbUtils)编写JDBC程序</h2><p>工具类的构造方法一般都是私有化的，因为工具类中的一般都是静态的，工具类就是为了方便编程，所以工具类中的方法都是直接采用“类名.”，的方式访问，因此不需要new对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.jdbc.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ResourceBundle;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ClassName: DbUtils</span></span><br><span class="line"><span class="comment"> * Description: JDBC工具类</span></span><br><span class="line"><span class="comment"> * Datetime: 2024/4/11 16:04</span></span><br><span class="line"><span class="comment"> * Author: 老杜@动力节点</span></span><br><span class="line"><span class="comment"> * Version: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DbUtils</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 工具类的构造方法一般都是私有化的，因为工具类中的一般都是静态的，</span></span><br><span class="line"><span class="comment">     * 工具类就是为了方便编程，所以工具类中的方法都是直接采用“类名.”</span></span><br><span class="line"><span class="comment">     * 的方式访问，因此不需要new对象。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">DbUtils</span><span class="params">()</span>&#123;&#125;<span class="comment">//工具类的构造方法私有化</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 静态变量，因为这些将来要在下面的静态代码块和构造方法里用，所以定义成静态变量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String user;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 静态代码块</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// 在这里读取属性配置文件，给静态变量赋值</span></span><br><span class="line">        <span class="type">ResourceBundle</span> <span class="variable">bundle</span> <span class="operator">=</span> ResourceBundle.getBundle(<span class="string">&quot;com.powernode.jdbc.jdbc01&quot;</span>);</span><br><span class="line">        driver = bundle.getString(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = bundle.getString(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = bundle.getString(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        password = bundle.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 想要让注册驱动只执行一次</span></span><br><span class="line">        <span class="comment">// 在类加载的时候，注册驱动，对于整个应用程序来说，注册驱动只需要做一次即可。所以选择静态代码块。</span></span><br><span class="line">        <span class="comment">// 静态代码块在类加载时执行，并且只执行一次。</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(driver);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取数据库连接对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 连接对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 释放资源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> conn 连接对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> stmt 数据库操作对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rs 结果集对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(Connection conn, Statement stmt, ResultSet rs)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (rs != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (stmt != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                stmt.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (conn != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="第04章-SQL注入"><a href="#第04章-SQL注入" class="headerlink" title="第04章 SQL注入"></a>第04章 SQL注入</h1><h2 id="SQL注入问题"><a href="#SQL注入问题" class="headerlink" title="SQL注入问题"></a>SQL注入问题</h2><p>SQL注入问题说的是：用户输入的信息中含有SQL语句关键字，和程序中的SQL语句进行字符串拼接，导致程序中的SQL语句改变了原意。（SQL注入问题是一种系统安全问题）</p><p>业务描述：系统启动后，给出登录页面，用户可以输入用户名和密码，用户名和密码全部正确，则登录成功，反之，则登录失败。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCTest08</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="comment">// 初始化界面</span></span><br><span class="line">        System.out.println(<span class="string">&quot;欢迎使用用户管理系统，请登录！&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;用户名：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">loginName</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">        System.out.println(<span class="string">&quot;密码：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">loginPwd</span> <span class="operator">=</span> scanner.next();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 链接数据库，验证用户名和密码是否正确</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">loginSuccess</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">realname</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取链接</span></span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="comment">// 获取数据库操作对象</span></span><br><span class="line">            stmt = conn.createStatement();</span><br><span class="line">            <span class="comment">// 执行SQL语句</span></span><br><span class="line">            <span class="comment">// name和password都是varchar字符串类型，在sql是要用单引号括起来的，然后用双引号双加号链接</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from t_user where name = &#x27;&quot;</span>+loginName+<span class="string">&quot;&#x27; and password = &#x27;&quot;</span>+loginPwd+<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            System.out.println(sql);</span><br><span class="line">            rs = stmt.executeQuery(sql);</span><br><span class="line">            <span class="comment">// 处理结果集（结果集中有数据，表示登录成功，反之表示登录失败）</span></span><br><span class="line">            <span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">                <span class="comment">// 登录成功</span></span><br><span class="line">                loginSuccess = <span class="literal">true</span>;</span><br><span class="line">                <span class="comment">// 获取真实的名字放到下面的输出信息里</span></span><br><span class="line">                realname = rs.getString(<span class="string">&quot;realname&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.close(conn, stmt, rs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(loginSuccess ? <span class="string">&quot;登录成功，欢迎&quot;</span> + realname : <span class="string">&quot;登录失败，您的用户名不存在或者密码错误！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后把String loginName &#x3D; scanner.next();改为String loginName &#x3D; scanner.nextLine();每次读一行</p><p>用户提供的信息中如果还有sql语句的关键字，作为字符串的形式和java程序中的sql语句进行了字符串的拼接，可能会导致原sql语句的含义被扭曲</p><p>比如输入以下这样的信息<img src="/./images/JDBC/image-20250409041612076.png" alt="image-20250409041612076"></p><p>就会输出登录成功，欢迎张三，sql语句是select * from t_user where name &#x3D; ‘fdsa’ and password &#x3D; ‘gfds’ or ‘a’ &#x3D; ‘a’</p><p>这种现象就叫做：SQL注入。导致这个现象的根本原因是：先进行了sql语句的字符串拼接，然后再进行sql语句的编译。</p><h2 id="解决SQL注入问题"><a href="#解决SQL注入问题" class="headerlink" title="解决SQL注入问题"></a>解决SQL注入问题</h2><p>最根本的原因是：Statement造成的。</p><p>Statement执行原理是：先进行字符串的拼接，将拼接好的SQL语句发送给数据库服务器，数据库服务器进行SQL语句的编译，然后执行。因此用户提供的信息中如果含有SQL语句的关键字，那么这些关键字正好参加了SQL语句的编译，所以导致原SQL语句被扭曲。</p><p>因此，JDBC为了解决这个问题，引入了一个新的接口：PreparedStatement，我们称为：预编译的数据库操作对象。PreparedStatement是Statement接口的子接口。它俩是继承关系。</p><p>PreparedStatement执行原理是：先对SQL语句进行预先的编译，然后再向SQL语句指定的位置传值，也就是说：用户提供的信息中即使含有SQL语句的关键字，那么这个信息也只会被当做一个值传递给SQL语句，用户提供的信息不再参与SQL语句的编译了，这样就解决了SQL注入问题。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">这个程序在实现了基本的登录功能的同时，演示了SQL注入的现象。</span><br><span class="line"> 导致SQL注入现象的根本原因是什么？</span><br><span class="line">      第一：用户提供的信息中含有SQL语句的关键字了。</span><br><span class="line">      第二：这些用户提供的信息中的关键字参与了SQL语句的编译。</span><br><span class="line"></span><br><span class="line"> SQL注入是一种安全隐患。黑客通常使用SQL注入来攻击你的系统。</span><br><span class="line"> 怎么避免SQL注入现象呢？</span><br><span class="line">      java.sql.Statement 是存在SQL注入现象的，因为它的原理是：先拼接SQL语句字符串，然后再进行编译，所以它必然存在SQL注入的问题。</span><br><span class="line">      为了避免SQL注入的发生，JDBC API中为Statement接口提供了一个子接口：java.sql.PreparedStatement，被称为预编译的数据库操作对象。</span><br><span class="line">      java.sql.PreparedStatement可以解决SQL注入问题。</span><br><span class="line">      具体怎么解决的？PreparedStatement可以对SQL语句进行预先编译，然后给编译好的SQL语句占位符传值，通过这种方式来解决SQL注入问题。</span><br><span class="line">      最本质的解决方法是：用户虽然提供了SQL语句关键字，但是这些关键字不再参与SQL语句的编译了。因此解决了SQL注入的问题。</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 连接数据库，验证用户名和密码是否正确。</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">loginSuccess</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">realname</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 获取连接</span></span><br><span class="line">    conn = DbUtils.getConnection();</span><br><span class="line">    <span class="comment">// 获取预编译的数据库操作对象</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from t_user where name = ? and password = ?&quot;</span>;</span><br><span class="line">    ps = conn.prepareStatement(sql);</span><br><span class="line">    <span class="comment">// 给 ? 占位符 传值</span></span><br><span class="line">    <span class="comment">// 再次强调：在JDBC当中，所有的下标都是从1开始。不是从0开始。</span></span><br><span class="line">    <span class="comment">// 以下代码的含义是：给第1个占位符 ? 传值，传入的是&#x27;name&#x27;</span></span><br><span class="line">    ps.setString(<span class="number">1</span>, loginName);</span><br><span class="line">    <span class="comment">// 以下代码的含义是：给第2个占位符 ? 传值，如果是传int类型就写setInt,传入100没有单引号</span></span><br><span class="line">    ps.setString(<span class="number">2</span>, loginPwd);</span><br><span class="line">    <span class="comment">// 执行SQL语句，ps里已经包含了sql语句所以不需要写</span></span><br><span class="line">    rs = ps.executeQuery();</span><br><span class="line">    <span class="comment">// 处理结果集（结果集中有数据，表示登录成功，反之表示登录失败）</span></span><br><span class="line">    <span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">        <span class="comment">// 登录成功</span></span><br><span class="line">        loginSuccess = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// 获取真实的名字</span></span><br><span class="line">        realname = rs.getString(<span class="string">&quot;realname&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>PreparedStatement原理：</strong></p><ul><li>第一步：先对SQL语句进行预先编译</li><li>第二步：给SQL语句中占位符传值</li></ul><p>解决SQL注入的本质是：先将带有占位符的SQL语句进行预先编译，然后给占位符传值。</p><p>即使用户提供的信息中含有SQL语句关键字，但是这些关键字不会参与SQL语句的编译，自然不会扭曲SQL语句的原意。</p><p><strong>关于使用PreparedStatement要注意的是：</strong></p><ul><li>带有占位符 ? 的SQL语句我们称为：预处理SQL语句。</li><li>占位符 ? 不能使用单引号或双引号包裹。如果包裹，占位符则不再是占位符，是一个普通的问号字符。</li><li>在执行SQL语句前，必须给每一个占位符 ? 传值。</li><li>如何给占位符 ? 传值，通过以下的方法：<ul><li>pstmt.setXxx(第几个占位符, 传什么值)</li><li>“第几个占位符”：从1开始。第1个占位符则是1，第2个占位符则是2，以此类推。</li><li>“传什么值”：具体要看调用的什么方法？<ul><li>如果调用pstmt.setString方法，则传的值必须是一个字符串。</li><li>如果调用pstmt.setInt方法，则传的值必须是一个整数。</li><li>以此类推……</li></ul></li></ul></li></ul><p><strong>PreparedStatement和Statement都是用于执行SQL语句的接口，它们的主要区别在于：</strong></p><p>Statement：是先拼接字符串然后再编译，这里的查询语句的变量会发生变化，发生变化会导致sql语句跟之前的不一样，就需要重新编译，所以效率会低一点点，而PreparedStatement是编译1次执行n次，都是在ps &#x3D; conn.prepareStatement(sql);这里执行</p><ul><li>PreparedStatement预编译SQL语句，Statement直接提交SQL语句；</li><li>PreparedStatement执行速度更快，可以避免SQL注入攻击；(PreparedStatement对于同一条SQL语句来说，编译一次，执行N次。而Statement是每次都要进行编译的。因此PreparedStatement效率略微高一些。)</li><li>PreparedStatement会做类型检查，是类型安全的；</li></ul><h2 id="PreparedStatement的使用"><a href="#PreparedStatement的使用" class="headerlink" title="PreparedStatement的使用"></a>PreparedStatement的使用</h2><h3 id="新增操作"><a href="#新增操作" class="headerlink" title="新增操作"></a>新增操作</h3><p>需求：向 emp 表中插入这样一条记录：<br>empno：8888<br>ename：张三<br>job：销售员<br>mgr：7369<br>hiredate：2024-01-01<br>sal：1000.0<br>comm：500.0<br>deptno：10</p><p>怎么把字符串转换成需要的sql date？<br>LocalDate localDate &#x3D; LocalDate.parse(“2024-01-01”);&#x2F;&#x2F;parse是解析，将其转换成LocalDate这个类型<br>ps.setDate(5, java.sql.Date.valueOf(localDate));&#x2F;&#x2F;java.sql.Date的valueOf里面传入一个LocalDate就可以获取了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 因为是插入，不涉及结果集所以不写resultSet</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.注册驱动（因为我们使用了DbUtils，因此这一步不需要写）</span></span><br><span class="line">            <span class="comment">// 2.获取连接</span></span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="comment">// 3.获取预编译的数据库操作对象</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into emp(empno,ename,job,mgr,hiredate,sal,comm,deptno) values(?,?,?,?,?,?,?,?)&quot;</span>;</span><br><span class="line">            <span class="comment">// 程序执行到这里，会对“预处理的SQL语句”进行预编译操作</span></span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            <span class="comment">// 给 ? 占位符传值</span></span><br><span class="line">            ps.setInt(<span class="number">1</span>, <span class="number">8888</span>);</span><br><span class="line">            ps.setString(<span class="number">2</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">            ps.setString(<span class="number">3</span>, <span class="string">&quot;销售员&quot;</span>);</span><br><span class="line">            ps.setInt(<span class="number">4</span>, <span class="number">7369</span>);</span><br><span class="line">            <span class="comment">// 怎么把字符串转换成需要的sql date</span></span><br><span class="line">            <span class="type">LocalDate</span> <span class="variable">localDate</span> <span class="operator">=</span> LocalDate.parse(<span class="string">&quot;2024-01-01&quot;</span>);<span class="comment">//parse是解析，将其转换成LocalDate这个类型</span></span><br><span class="line">            ps.setDate(<span class="number">5</span>, java.sql.Date.valueOf(localDate));<span class="comment">//java.sql.Date的valueOf里面传入一个LocalDate就可以获取了</span></span><br><span class="line">            ps.setDouble(<span class="number">6</span>, <span class="number">1000.0</span>);</span><br><span class="line">            ps.setDouble(<span class="number">7</span>, <span class="number">500.0</span>);</span><br><span class="line">            ps.setInt(<span class="number">8</span>, <span class="number">10</span>);</span><br><span class="line">            <span class="comment">// 4.执行SQL语句</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> ps.executeUpdate();</span><br><span class="line">            System.out.println(<span class="string">&quot;插入了&quot;</span> + count + <span class="string">&quot;条记录&quot;</span>);</span><br><span class="line">            <span class="comment">// 5.处理查询结果集（因为现在是执行insert操作，所以这一步没有）</span></span><br></pre></td></tr></table></figure><h3 id="修改操作"><a href="#修改操作" class="headerlink" title="修改操作"></a>修改操作</h3><p>需求：将员工编号为8888的员工，姓名修改为李四，岗位修改为产品经理，月薪修改为5000.0，其他不变。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update emp set ename=?, job=?, sal=? where empno=?&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            ps.setString(<span class="number">1</span>, <span class="string">&quot;李四&quot;</span>);</span><br><span class="line">            ps.setString(<span class="number">2</span>, <span class="string">&quot;产品经理&quot;</span>);</span><br><span class="line">            ps.setDouble(<span class="number">3</span>, <span class="number">5000.0</span>);</span><br><span class="line">            ps.setInt(<span class="number">4</span>, <span class="number">8888</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> ps.executeUpdate();</span><br><span class="line">            System.out.println(<span class="string">&quot;更新了&quot;</span> + count + <span class="string">&quot;条数据&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.close(conn,ps,<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><h3 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h3><p>需求：将员工编号为8888的删除。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      需求：将员工编号为8888的删除。</span></span><br><span class="line"><span class="comment">      使用 try-with-resources 语法。(Java7的新特性)</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span>  <span class="string">&quot;delete from emp where empno = ?&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span>(<span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DbUtils.getConnection();</span><br><span class="line">          <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(sql)) &#123;</span><br><span class="line">          ps.setInt(<span class="number">1</span>, <span class="number">8888</span>);</span><br><span class="line">          <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> ps.executeUpdate();</span><br><span class="line">          System.out.println(<span class="string">&quot;删除了&quot;</span> + count + <span class="string">&quot;条记录&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br></pre></td></tr></table></figure><h3 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h3><p>需求：查询员工名字中第二个字母是 O 的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">       需求：查询员工名字中第二个字母是 O 的。</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           conn = DbUtils.getConnection();</span><br><span class="line">           <span class="comment">// 这样是错误的，占位符不能加引号</span></span><br><span class="line">           <span class="comment">//String sql = &quot;select ename from emp where ename like &#x27;_?%&#x27;&quot;;</span></span><br><span class="line">           <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select ename from emp where ename like ?&quot;</span>;</span><br><span class="line"></span><br><span class="line">           ps = conn.prepareStatement(sql);</span><br><span class="line">           ps.setString(<span class="number">1</span>, <span class="string">&quot;_O%&quot;</span>);</span><br><span class="line"></span><br><span class="line">           <span class="comment">// 这样是错误的</span></span><br><span class="line">           <span class="comment">//ps.setString(1, &quot;O&quot;);</span></span><br><span class="line"></span><br><span class="line">           rs = ps.executeQuery();</span><br><span class="line">           <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">               <span class="type">String</span> <span class="variable">ename</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;ename&quot;</span>);</span><br><span class="line">               System.out.println(ename);</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure><h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><p>对于MySQL来说，通用的分页SQL语句：<br>假设每页显示3条记录：pageSize &#x3D; 3<br>第1页：limit 0, 3<br>第2页：limit 3, 3<br>第3页：limit 6, 3<br>*<em>第pageNo页：limit (pageNo - 1)<em>pageSize, pageSize</em></em><br>需求：查询所有员工姓名，每页显示3条(pageSize)，显示第2页(pageNo)。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">       需求：查询所有员工姓名，每页显示3条(pageSize)，显示第2页(pageNo)。</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="comment">// 每页现实的记录条数</span></span><br><span class="line">       <span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">       <span class="comment">// 显示第几页（页码）</span></span><br><span class="line">       <span class="type">int</span> <span class="variable">pageNo</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">       <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           conn = DbUtils.getConnection();</span><br><span class="line">           <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select ename from emp limit ?,?&quot;</span>;</span><br><span class="line">           ps = conn.prepareStatement(sql);</span><br><span class="line">           ps.setInt(<span class="number">1</span>, (pageNo - <span class="number">1</span>) * pageSize);</span><br><span class="line">           ps.setInt(<span class="number">2</span>, pageSize);</span><br><span class="line">           rs = ps.executeQuery();</span><br><span class="line">           <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">               <span class="type">String</span> <span class="variable">ename</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;ename&quot;</span>);</span><br><span class="line">               System.out.println(ename);</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure><h3 id="blob数据的插入和读取"><a href="#blob数据的插入和读取" class="headerlink" title="blob数据的插入和读取"></a>blob数据的插入和读取</h3><p>blob类型的全称是binary large object，二进制大对象，用来接受图片这种，底层运行原理是这样的，用io流从硬盘读取到内存，然后再输出到数据库里，但是executeUpdate()底层会自动输出，所以这个输出流是看不见的。</p><p><img src="/./images/JDBC/image-20250410194604716.png" alt="image-20250410194604716"></p><p>准备一张表：t_img，三个字段，一个id主键，一个图片名字name，一个img。<br>建表语句如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> `t_img` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  `img` <span class="type">blob</span></span><br><span class="line">) engine<span class="operator">=</span>innodb;</span><br></pre></td></tr></table></figure><p>需求1：向t_img 表中插入一张图片。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      <span class="type">FileInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          conn = DbUtils.getConnection();</span><br><span class="line">          <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_img(name, img) values(?, ?)&quot;</span>;</span><br><span class="line">          ps = conn.prepareStatement(sql);</span><br><span class="line">          <span class="comment">// 给 ? 传值</span></span><br><span class="line">          ps.setString(<span class="number">1</span>, <span class="string">&quot;狗狗的图片&quot;</span>);</span><br><span class="line">          in = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;F:\\动力节点全套资料\\07-JDBC教程,jdbc从零到精通,动力节点JDBC,老杜jdbc\\resources\\dog.jpg&quot;</span>);</span><br><span class="line">          ps.setBlob(<span class="number">2</span>, in);</span><br><span class="line">          <span class="comment">// 执行sql</span></span><br><span class="line">          <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> ps.executeUpdate();</span><br><span class="line">          System.out.println(<span class="string">&quot;插入了&quot;</span> + count + <span class="string">&quot;条记录&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">      &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">         <span class="keyword">if</span>(in != <span class="literal">null</span>)&#123;</span><br><span class="line">             <span class="keyword">try</span> &#123;</span><br><span class="line">                 in.close();</span><br><span class="line">             &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">          DbUtils.close(conn, ps, <span class="literal">null</span>);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><p>需求2：从t_img 表中读取一张图片。（从数据库中读取一张图片保存到本地。）</p><p>需要输入流是因为要从数据库读取到内存里，然后再从内存输出到电脑硬盘上</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           conn = DbUtils.getConnection();</span><br><span class="line">           <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select img from t_img where name = ?&quot;</span>;</span><br><span class="line">           ps = conn.prepareStatement(sql);</span><br><span class="line">           ps.setString(<span class="number">1</span>, <span class="string">&quot;狗狗的图片&quot;</span>);</span><br><span class="line">           rs = ps.executeQuery();</span><br><span class="line">           <span class="keyword">if</span> (rs.next())&#123;</span><br><span class="line">               <span class="comment">// 注意：图片就在结果集ResultSet对象当中。</span></span><br><span class="line">               <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> rs.getBinaryStream(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">               <span class="type">OutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;E:/dog.jpg&quot;</span>);</span><br><span class="line">               <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">               <span class="type">int</span> <span class="variable">readCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">               <span class="keyword">while</span>((readCount = in.read(bytes)) != -<span class="number">1</span>)&#123;</span><br><span class="line">                   out.write(bytes, <span class="number">0</span>, readCount);</span><br><span class="line">               &#125;</span><br><span class="line">               out.flush();</span><br><span class="line">               in.close();</span><br><span class="line">               out.close();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">       &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">           DbUtils.close(conn, ps, rs);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><h2 id="JDBC批处理（插入）操作"><a href="#JDBC批处理（插入）操作" class="headerlink" title="JDBC批处理（插入）操作"></a>JDBC批处理（插入）操作</h2><p>准备一张商品表：t_product<br>建表语句如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_product(</span><br><span class="line">  id <span class="type">bigint</span> <span class="keyword">primary key</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="不使用批处理"><a href="#不使用批处理" class="headerlink" title="不使用批处理"></a>不使用批处理</h3><p>不使用批处理，向 t_product 表中插入一万条商品信息，并记录耗时！</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_batch(id,name) values(?,?)&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">                ps.setLong(<span class="number">1</span>, i);</span><br><span class="line">                ps.setString(<span class="number">2</span>, <span class="string">&quot;batch&quot;</span> + i);</span><br><span class="line">                count += ps.executeUpdate();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;插入了&quot;</span> + count + <span class="string">&quot;条记录&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.close(conn, ps, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;总耗时&quot;</span> + (end - begin) + <span class="string">&quot;毫秒&quot;</span>); <span class="comment">// 总耗时特别久</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="使用批处理"><a href="#使用批处理" class="headerlink" title="使用批处理"></a>使用批处理</h3><p>使用批处理，向 t_product 表中插入一万条商品信息，并记录耗时！<br><strong>注意：启用批处理需要在URL后面添加这个的参数：rewriteBatchedStatements&#x3D;true</strong></p><p>ps.addBatch();&#x2F;&#x2F; 打包<br>executeBatch会批量执行处理一次，返回值是个int数组<br>executeBatch().length返回的是数组的长度</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_batch(id,name) values(?,?)&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">                ps.setLong(<span class="number">1</span>, i);</span><br><span class="line">                ps.setString(<span class="number">2</span>, <span class="string">&quot;batch&quot;</span> + i);</span><br><span class="line">                <span class="comment">// 打包</span></span><br><span class="line">                ps.addBatch();</span><br><span class="line">                <span class="comment">// 如果打包够500个，则执行一次（则磁盘IO一次）</span></span><br><span class="line">                <span class="comment">// 这500个可以测试其他数，看看哪个效率高就用哪个</span></span><br><span class="line">                <span class="comment">// executeBatch会批量执行处理一次，返回值是个int数组，executeBatch().length返回的是数组的长度</span></span><br><span class="line">                <span class="keyword">if</span>(i % <span class="number">500</span> == <span class="number">0</span>)&#123;</span><br><span class="line">                    count += ps.executeBatch().length;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 循环结束之后，再次执行批处理，防止数据丢失。</span></span><br><span class="line">            <span class="comment">// 怕实际上是501条，会漏一条</span></span><br><span class="line">            count += ps.executeBatch().length;</span><br><span class="line">            System.out.println(<span class="string">&quot;插入了&quot;</span> + count + <span class="string">&quot;条记录&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.close(conn, ps, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;总耗时&quot;</span> + (end - begin) + <span class="string">&quot;毫秒&quot;</span>);</span><br></pre></td></tr></table></figure><p>插入了9999条记录<br>总耗时3617毫秒</p><p>在进行大数据量插入时，批处理为什么可以提高程序的执行效率？</p><ol><li>减少了网络通信次数：JDBC 批处理会将多个 SQL 语句一次性发送给服务器，减少了客户端和服务器之间的通信次数，从而提高了数据写入的速度，特别是对于远程服务器而言，优化效果更为显著。 </li><li>减少了数据库操作次数：JDBC 批处理会将多个 SQL 语句合并成一条 SQL 语句进行执行，从而减少了数据库操作的次数，减轻了数据库的负担，大大提高了数据写入的速度。</li></ol><h1 id="第05章-JDBC事务"><a href="#第05章-JDBC事务" class="headerlink" title="第05章 JDBC事务"></a>第05章 JDBC事务</h1><h2 id="什么是事务"><a href="#什么是事务" class="headerlink" title="什么是事务"></a>什么是事务</h2><p>事务是一个完整的业务，在这个业务中需要多条DML语句共同联合才能完成，而事务可以保证多条DML语句同时成功或者同时失败，从而保证数据的安全。例如A账户向B账户转账一万，A账户减去一万(update)和B账户加上一万(update)，必须同时成功或者同时失败，才能保证数据是正确的。</p><p>另请参见老杜发布的2024版MySQL教学视频。在本套教程中详细讲解了数据库事务机制。</p><p><img src="/./images/JDBC/image-20250411004704852.png" alt="image-20250411004704852"></p><h2 id="使用转账案例演示事务"><a href="#使用转账案例演示事务" class="headerlink" title="使用转账案例演示事务"></a>使用转账案例演示事务</h2><h3 id="表和数据的准备"><a href="#表和数据的准备" class="headerlink" title="表和数据的准备"></a>表和数据的准备</h3><p>t_act表</p><p><img src="/./images/JDBC/image-20250411004750039.png" alt="image-20250411004750039"></p><p><img src="/./images/JDBC/image-20250411004802647.png" alt="image-20250411004802647"></p><h3 id="实现转账功能"><a href="#实现转账功能" class="headerlink" title="实现转账功能"></a>实现转账功能</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCTest19</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 转账金额</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">money</span> <span class="operator">=</span> <span class="number">10000.0</span>;</span><br><span class="line">        <span class="comment">// 实现转账功能</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps1</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps2</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将 act-001 账户的余额减去一万</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql1</span> <span class="operator">=</span> <span class="string">&quot;update t_act set balance = balance - ? where actno = ?&quot;</span>;</span><br><span class="line">            ps1 = conn.prepareStatement(sql1);</span><br><span class="line">            ps1.setDouble(<span class="number">1</span>, money);</span><br><span class="line">            ps1.setString(<span class="number">2</span>, <span class="string">&quot;act-001&quot;</span>);</span><br><span class="line">            <span class="type">int</span> count1= ps1.executeUpdate();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将 act-002 账户的余额加上一万</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql2</span> <span class="operator">=</span> <span class="string">&quot;update t_act set balance = balance + ? where actno = ?&quot;</span>;</span><br><span class="line">            ps2 = conn.prepareStatement(sql2);</span><br><span class="line">            ps2.setDouble(<span class="number">1</span>, money);</span><br><span class="line">            ps2.setString(<span class="number">2</span>, <span class="string">&quot;act-002&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">count2</span> <span class="operator">=</span> ps2.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 先关闭ps1 ps1再关闭conn</span></span><br><span class="line">            DbUtils.close(<span class="literal">null</span>, ps1, <span class="literal">null</span>);</span><br><span class="line">            DbUtils.close(<span class="literal">null</span>, ps2, <span class="literal">null</span>);</span><br><span class="line">            DbUtils.close(conn, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JDBC事务默认是自动提交的"><a href="#JDBC事务默认是自动提交的" class="headerlink" title="JDBC事务默认是自动提交的"></a>JDBC事务默认是自动提交的</h3><p>DBC事务默认情况下是自动提交的，所谓的自动提交是指：只要执行一条DML语句则自动提交一次。测试一下，在以下代码位置添加断点：</p><p><img src="/./images/JDBC/image-20250411152725401.png" alt="image-20250411152725401"></p><p>让代码执行到断点处看看数据库表中的数据是否发生变化：</p><p><img src="/./images/JDBC/image-20250411152747646.png" alt="image-20250411152747646"></p><p>因为JDBC事务默认情况下是自动提交，只要执行一条DML语句则自动提交一次。这种自动提交是极其危险的。如果在此时程序发生了异常，act-002账户的余额未成功更新，则钱会丢失一万。</p><h3 id="添加事务控制"><a href="#添加事务控制" class="headerlink" title="添加事务控制"></a>添加事务控制</h3><p>如何解决以上问题，分三步：<br>第一步：将JDBC事务的自动提交机制修改为手动提交（即开启事务）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn.setAutoCommit(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p>第二步：当整个业务完整结束后，手动提交事务（即提交事务，事务结束）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn.commit();</span><br></pre></td></tr></table></figure><p>第三步：在处理业务过程中，如果发生异常，则进入catch语句块进行异常处理，手动回滚事务（即回滚事务，失败的事务提交后结束）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn.rollback();</span><br></pre></td></tr></table></figure><p>代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 第一步：开启事务（将JDBC事务的自动提交机制修改为手动提交）</span></span><br><span class="line">            conn.setAutoCommit(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将 act-001 账户的余额减去一万</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql1</span> <span class="operator">=</span> <span class="string">&quot;update t_act set balance = balance - ? where actno = ?&quot;</span>;</span><br><span class="line">            ps1 = conn.prepareStatement(sql1);</span><br><span class="line">            ps1.setDouble(<span class="number">1</span>, money);</span><br><span class="line">            ps1.setString(<span class="number">2</span>, <span class="string">&quot;act-001&quot;</span>);</span><br><span class="line">            <span class="type">int</span> count1= ps1.executeUpdate();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将 act-002 账户的余额加上一万</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql2</span> <span class="operator">=</span> <span class="string">&quot;update t_act set balance = balance + ? where actno = ?&quot;</span>;</span><br><span class="line">            ps2 = conn.prepareStatement(sql2);</span><br><span class="line">            ps2.setDouble(<span class="number">1</span>, money);</span><br><span class="line">            ps2.setString(<span class="number">2</span>, <span class="string">&quot;act-002&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">count2</span> <span class="operator">=</span> ps2.executeUpdate();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 第二步：当整个业务流程成功的完整的结束了，提交事务（事务结束）</span></span><br><span class="line">            conn.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// 第三步：只要有任何一个异常发生，则回滚事务（事务结束）</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.rollback();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 先关闭ps1 ps1再关闭conn</span></span><br><span class="line">            DbUtils.close(<span class="literal">null</span>, ps1, <span class="literal">null</span>);</span><br><span class="line">            DbUtils.close(<span class="literal">null</span>, ps2, <span class="literal">null</span>);</span><br><span class="line">            DbUtils.close(conn, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h2 id="设置JDBC事务隔离级别"><a href="#设置JDBC事务隔离级别" class="headerlink" title="设置JDBC事务隔离级别"></a>设置JDBC事务隔离级别</h2><p>关于事务隔离级别相关内容另请参见：老杜发布的2024版MySQL教程</p><p>设置事务的隔离级别也是比较重要的，在JDBC程序中应该如何设置事务的隔离级别呢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn.setTransactionIsolation<span class="comment">//里面传的参数是int，也就是Connection这个类里面的一些常量</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCTest20</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置当前事务的事务隔离级别</span></span><br><span class="line">            conn.setTransactionIsolation(Connection.TRANSACTION_REPEATABLE_READ);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.close(conn, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="第06章-JDBC调用存储过程"><a href="#第06章-JDBC调用存储过程" class="headerlink" title="第06章 JDBC调用存储过程"></a>第06章 JDBC调用存储过程</h1><h2 id="在MySQL中创建存储过程"><a href="#在MySQL中创建存储过程" class="headerlink" title="在MySQL中创建存储过程"></a>在MySQL中创建存储过程</h2><p>这是一个计算0-100之间所有偶数和的sql语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> mypro(<span class="keyword">in</span> n <span class="type">int</span>, <span class="keyword">out</span> sum <span class="type">int</span>)<span class="operator">/</span><span class="operator">/</span>一个入参一个出参</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line"><span class="keyword">set</span> sum :<span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">repeat </span><br><span class="line">if n <span class="operator">%</span> <span class="number">2</span> <span class="operator">=</span> <span class="number">0</span> <span class="keyword">then</span> </span><br><span class="line">  <span class="keyword">set</span> sum :<span class="operator">=</span> sum <span class="operator">+</span> n;</span><br><span class="line"><span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">set</span> n :<span class="operator">=</span> n <span class="operator">-</span> <span class="number">1</span>;</span><br><span class="line">until n <span class="operator">&lt;=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span> repeat;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><h2 id="使用JDBC代码调用存储过程"><a href="#使用JDBC代码调用存储过程" class="headerlink" title="使用JDBC代码调用存储过程"></a>使用JDBC代码调用存储过程</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCTest21</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// 专门执行存储过程的。（CallableStatement 继承了 PreparedStatement）</span></span><br><span class="line">        <span class="type">CallableStatement</span> <span class="variable">cs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 调用存储过程的SQL语句</span></span><br><span class="line">            <span class="comment">// 注意：外边有一个大括号。</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;&#123; call mypro(?,?) &#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 对以上的SQL语句进行预编译</span></span><br><span class="line">            cs = conn.prepareCall(sql);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 给占位符 ? 传值</span></span><br><span class="line">            cs.setInt(<span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将第二个占位符 ? 注册为出参</span></span><br><span class="line">            <span class="comment">// 并且出参的数据类型是整数型</span></span><br><span class="line">            cs.registerOutParameter(<span class="number">2</span>, Types.INTEGER);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 调用存储过程</span></span><br><span class="line">            cs.execute();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取执行结果，执行结果在出参上。获取出参的值</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> cs.getInt(<span class="number">2</span>);</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.close(conn, cs, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="第07章-JDBC实现员工管理"><a href="#第07章-JDBC实现员工管理" class="headerlink" title="第07章 JDBC实现员工管理"></a>第07章 JDBC实现员工管理</h1><h2 id="数据库表的准备"><a href="#数据库表的准备" class="headerlink" title="数据库表的准备"></a>数据库表的准备</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.powernode.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.powernode.jdbc.utils.DbUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ClassName: JDBCTest22</span></span><br><span class="line"><span class="comment"> * Description: 使用JDBC实现员工信息管理</span></span><br><span class="line"><span class="comment"> * Datetime: 2024/4/14 22:11</span></span><br><span class="line"><span class="comment"> * Author: 老杜@动力节点</span></span><br><span class="line"><span class="comment"> * Version: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCTest22</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;欢迎使用员工信息管理，请认真阅读使用说明：&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;本系统的功能主要包括：查看员工列表、查看某个员工详细信息、新增员工、修改员工、删除员工&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入对应的功能编号选择功能：&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;[1]查看员工列表&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;[2]查看某个员工详细信息&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;[3]新增员工&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;[4]修改员工&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;[5]删除员工&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;[0]退出系统&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请输入功能编号：&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">no</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            <span class="keyword">if</span>(<span class="number">1</span> == no)&#123;</span><br><span class="line">                <span class="comment">// 查看员工列表</span></span><br><span class="line">                System.out.println(<span class="string">&quot;员工信息列表如下：&quot;</span>);</span><br><span class="line">                doList();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">2</span> == no)&#123;</span><br><span class="line">                <span class="comment">// 查看某个员工的详细信息</span></span><br><span class="line">                doList();<span class="comment">//可以显示员工列表</span></span><br><span class="line">                System.out.print(<span class="string">&quot;请输入员工的id：&quot;</span>);</span><br><span class="line">                <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> scanner.nextLong();</span><br><span class="line">                System.out.println(<span class="string">&quot;员工[&quot;</span> + id + <span class="string">&quot;]的详细信息如下：&quot;</span>);</span><br><span class="line">                doDetail(id);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">3</span> == no)&#123;</span><br><span class="line">                <span class="comment">// 接收员工的信息</span></span><br><span class="line">                System.out.print(<span class="string">&quot;请输入员工姓名：&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">                System.out.print(<span class="string">&quot;请输入员工岗位：&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">job</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">                System.out.print(<span class="string">&quot;请输入员工月薪：&quot;</span>);</span><br><span class="line">                <span class="type">Double</span> <span class="variable">salary</span> <span class="operator">=</span> scanner.nextDouble();</span><br><span class="line">                System.out.print(<span class="string">&quot;请输入员工入职日期：&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">hiredate</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">                System.out.print(<span class="string">&quot;请输入员工住址：&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">address</span> <span class="operator">=</span> scanner.next();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 新增员工</span></span><br><span class="line">                doSave(name, job, salary, hiredate, address);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">4</span> == no)&#123;</span><br><span class="line">                <span class="comment">// 显示员工列表</span></span><br><span class="line">                doList();</span><br><span class="line">                <span class="comment">// 显示员工详细信息</span></span><br><span class="line">                System.out.print(<span class="string">&quot;请输入您要修改的员工id：&quot;</span>);</span><br><span class="line">                <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> scanner.nextLong();</span><br><span class="line">                doDetail(id);</span><br><span class="line">                <span class="comment">// 接收新的信息（注意：修改员工时，id不能修改）</span></span><br><span class="line">                System.out.print(<span class="string">&quot;请输入员工姓名：&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">                System.out.print(<span class="string">&quot;请输入员工岗位：&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">job</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">                System.out.print(<span class="string">&quot;请输入员工月薪：&quot;</span>);</span><br><span class="line">                <span class="type">Double</span> <span class="variable">salary</span> <span class="operator">=</span> scanner.nextDouble();</span><br><span class="line">                System.out.print(<span class="string">&quot;请输入员工入职日期：&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">hiredate</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">                System.out.print(<span class="string">&quot;请输入员工住址：&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">address</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 修改员工</span></span><br><span class="line">                doModify(id, name, job, salary, hiredate, address);</span><br><span class="line">                System.out.println(<span class="string">&quot;员工[&quot;</span> + id + <span class="string">&quot;]的信息更新成功!!!!&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">5</span> == no)&#123;</span><br><span class="line">                doList();</span><br><span class="line">                System.out.print(<span class="string">&quot;请输入要删除的员工id：&quot;</span>);</span><br><span class="line">                <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> scanner.nextLong();</span><br><span class="line">                <span class="comment">// 删除员工</span></span><br><span class="line">                doDel(id);</span><br><span class="line">                System.out.println(<span class="string">&quot;删除员工[&quot;</span> + id + <span class="string">&quot;]成功了！&quot;</span>);</span><br><span class="line">                doList();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == no)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;下次再见！&quot;</span>);</span><br><span class="line">                System.exit(<span class="number">0</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;对不起，您输入的功能暂不支持！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doDel</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from t_employee where id = ?&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            ps.setLong(<span class="number">1</span>, id);</span><br><span class="line">            <span class="comment">// 执行删除SQL</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> ps.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.close(conn, ps, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doModify</span><span class="params">(<span class="type">long</span> id, String name, String job, Double salary, String hiredate, String address)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span>  <span class="string">&quot;update t_employee set name=?, job=?, salary=?, hiredate=?, address=? where id=?&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            <span class="comment">// 给 ? 传值</span></span><br><span class="line">            ps.setString(<span class="number">1</span>, name);</span><br><span class="line">            ps.setString(<span class="number">2</span>, job);</span><br><span class="line">            ps.setDouble(<span class="number">3</span>, salary);</span><br><span class="line">            ps.setString(<span class="number">4</span>, hiredate);</span><br><span class="line">            ps.setString(<span class="number">5</span>, address);</span><br><span class="line">            ps.setLong(<span class="number">6</span>, id);</span><br><span class="line">            <span class="comment">// 执行更新SQL</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> ps.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.close(conn, ps, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doSave</span><span class="params">(String name, String job, Double salary, String hiredate, String address)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span>  <span class="string">&quot;insert into t_employee(name,job,salary,hiredate,address) values(?,?,?,?,?)&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            <span class="comment">// 给 ? 传值</span></span><br><span class="line">            ps.setString(<span class="number">1</span>, name);</span><br><span class="line">            ps.setString(<span class="number">2</span>, job);</span><br><span class="line">            ps.setDouble(<span class="number">3</span>, salary);</span><br><span class="line">            ps.setString(<span class="number">4</span>, hiredate);</span><br><span class="line">            ps.setString(<span class="number">5</span>, address);</span><br><span class="line">            <span class="comment">// 执行保存SQL</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> ps.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.close(conn, ps, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doDetail</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from t_employee where id = ?&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            ps.setLong(<span class="number">1</span>, id);</span><br><span class="line">            rs = ps.executeQuery();</span><br><span class="line">           <span class="keyword">if</span> (rs.next())&#123;</span><br><span class="line">               <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">               <span class="type">String</span> <span class="variable">job</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;job&quot;</span>);</span><br><span class="line">               <span class="type">String</span> <span class="variable">hiredate</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;hiredate&quot;</span>);</span><br><span class="line">               <span class="type">Double</span> <span class="variable">salary</span> <span class="operator">=</span> rs.getDouble(<span class="string">&quot;salary&quot;</span>);</span><br><span class="line">               <span class="type">String</span> <span class="variable">address</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;address&quot;</span>);</span><br><span class="line">               System.out.println(<span class="string">&quot;id = &quot;</span> + id);</span><br><span class="line">               System.out.println(<span class="string">&quot;姓名 = &quot;</span> + name);</span><br><span class="line">               System.out.println(<span class="string">&quot;岗位 = &quot;</span> + job);</span><br><span class="line">               System.out.println(<span class="string">&quot;入职日期 = &quot;</span> + hiredate);</span><br><span class="line">               System.out.println(<span class="string">&quot;月薪 = &quot;</span> + salary);</span><br><span class="line">               System.out.println(<span class="string">&quot;住址 = &quot;</span> + address);</span><br><span class="line">           &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.close(conn, ps, rs);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 编写JDBC代码，连接数据库，查询所有的员工信息，展示</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select id,name,job from t_employee&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            rs = ps.executeQuery();</span><br><span class="line">            <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">                <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> rs.getLong(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">job</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;job&quot;</span>);</span><br><span class="line">                System.out.println(id + <span class="string">&quot;\t&quot;</span> + name + <span class="string">&quot;\t&quot;</span> + job);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.close(conn, ps, rs);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="第08章-DAO"><a href="#第08章-DAO" class="headerlink" title="第08章 DAO"></a>第08章 DAO</h1><h2 id="什么是DAO"><a href="#什么是DAO" class="headerlink" title="什么是DAO"></a>什么是DAO</h2><p>DAO是：Data Access Object，翻译为：数据访问对象。<br>一种JavaEE的设计模式，专门用来做数据增删改查的类。<br>在实际的开发中，通常我们会将数据库的操作封装为一个单独的DAO去完成，这样做的目的是：提高代码的复用性，另外也可以降低程序的耦合度，提高扩展力。<br>例如：操作用户数据的叫做UserDao，操作员工数据的叫做EmployeeDao，操作产品数据的叫做ProductDao，操作订单数据的叫做OrderDao等。</p><h2 id="使用DAO改造员工信息管理"><a href="#使用DAO改造员工信息管理" class="headerlink" title="使用DAO改造员工信息管理"></a>使用DAO改造员工信息管理</h2><h3 id="定义Employee封装数据"><a href="#定义Employee封装数据" class="headerlink" title="定义Employee封装数据"></a>定义Employee封装数据</h3><p>Employee类是一个Java Bean，这个类被称为bean，或者pojo类，专门用来封装员工的信息：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DbUtils</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 工具类的构造方法一般都是私有化的，因为工具类中的一般都是静态的，</span></span><br><span class="line"><span class="comment">     * 工具类就是为了方便编程，所以工具类中的方法都是直接采用“类名.”</span></span><br><span class="line"><span class="comment">     * 的方式访问，因此不需要new对象。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">DbUtils</span><span class="params">()</span>&#123;&#125;<span class="comment">//工具类的构造方法私有化</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 静态变量，因为这些将来要在下面的静态代码块和构造方法里用，所以定义成静态变量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String user;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 静态代码块</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// 在这里读取属性配置文件，给静态变量赋值</span></span><br><span class="line">        <span class="type">ResourceBundle</span> <span class="variable">bundle</span> <span class="operator">=</span> ResourceBundle.getBundle(<span class="string">&quot;com.powernode.jdbc.jdbc01&quot;</span>);</span><br><span class="line">        driver = bundle.getString(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = bundle.getString(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = bundle.getString(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        password = bundle.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 想要让注册驱动只执行一次</span></span><br><span class="line">        <span class="comment">// 在类加载的时候，注册驱动，对于整个应用程序来说，注册驱动只需要做一次即可。所以选择静态代码块。</span></span><br><span class="line">        <span class="comment">// 静态代码块在类加载时执行，并且只执行一次。</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(driver);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取数据库连接对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 连接对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 释放资源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> conn 连接对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> stmt 数据库操作对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rs 结果集对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(Connection conn, Statement stmt, ResultSet rs)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (rs != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (stmt != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                stmt.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (conn != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="定义EmployeeDao"><a href="#定义EmployeeDao" class="headerlink" title="定义EmployeeDao"></a>定义EmployeeDao</h3><p>定义五个方法，分别完成五个功能：新增，修改，删除，查看一个，查看所有。增删改查也被简称为：CRUD。C:Create 增,R:Read 查，U:Update 改，D:Delete 删</p><p>注意：</p><ul><li>DAO不负责任何业务逻辑的处理。只负责CRUD操作。</li><li>DAO是JavaEE的设计模式之一。</li><li>DAO中方法名起名也有讲究，一般都是以：insert delete update select开头。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeDao</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增员工</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee 员工数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 1表示新增了1条记录。返回其他值表示新增失败。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insert</span><span class="params">(Employee employee)</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_employee(name,job,salary,hiredate,address) values(?,?,?,?,?)&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            ps.setString(<span class="number">1</span>, employee.getName());</span><br><span class="line">            ps.setString(<span class="number">2</span>, employee.getJob());</span><br><span class="line">            ps.setDouble(<span class="number">3</span>, employee.getSalary());</span><br><span class="line">            ps.setString(<span class="number">4</span>, employee.getHiredate());</span><br><span class="line">            ps.setString(<span class="number">5</span>, employee.getAddress());</span><br><span class="line">            count = ps.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id删除员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 员工id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 1表示删除成功，其他值表示删除失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteByid</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from t_employee where id = ?&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            ps.setLong(<span class="number">1</span>, id);</span><br><span class="line">            count = ps.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.close(conn, ps, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newEmployee 新的员工信息（注意：新的员工信息和旧的员工信息id是不变的。）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 1表示修改成功，其他值表示修改失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Employee newEmployee)</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update t_employee set name=?, job=?, salary=?, hiredate=?, address=? where id=?&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            ps.setString(<span class="number">1</span>, newEmployee.getName());</span><br><span class="line">            ps.setString(<span class="number">2</span>, newEmployee.getJob());</span><br><span class="line">            ps.setDouble(<span class="number">3</span>, newEmployee.getSalary());</span><br><span class="line">            ps.setString(<span class="number">4</span>, newEmployee.getHiredate());</span><br><span class="line">            ps.setString(<span class="number">5</span>, newEmployee.getAddress());</span><br><span class="line">            ps.setLong(<span class="number">6</span>, newEmployee.getId());</span><br><span class="line">            count = ps.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.close(conn, ps, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id获取员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 员工id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 员工信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Employee <span class="title function_">selectById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select name,job,salary,hiredate,address from t_employee where id = ?&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            ps.setLong(<span class="number">1</span>, id);</span><br><span class="line">            rs = ps.executeQuery();</span><br><span class="line">            <span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">                <span class="comment">// 完成数据的封装，将数据库表查询出来的数据封装成员工对象。</span></span><br><span class="line">                <span class="comment">//有数据就需要返回个对象，new出来然后赋值</span></span><br><span class="line">                employee = <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">                employee.setId(id);</span><br><span class="line">                employee.setName(rs.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">                employee.setJob(rs.getString(<span class="string">&quot;job&quot;</span>));</span><br><span class="line">                employee.setSalary(rs.getDouble(<span class="string">&quot;salary&quot;</span>));</span><br><span class="line">                employee.setHiredate(rs.getString(<span class="string">&quot;hiredate&quot;</span>));</span><br><span class="line">                employee.setAddress(rs.getString(<span class="string">&quot;address&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.close(conn, ps, rs);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> employee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 员工列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">selectAll</span><span class="params">()</span>&#123;<span class="comment">//一次性全返回</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        List&lt;Employee&gt; employeeList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select id,name,job,salary,hiredate,address from t_employee&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            rs = ps.executeQuery();</span><br><span class="line">            <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">                <span class="comment">// 完成数据的封装，将数据库表查询出来的数据封装成员工对象。</span></span><br><span class="line">                <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">                employee.setId(rs.getLong(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">                employee.setName(rs.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">                employee.setJob(rs.getString(<span class="string">&quot;job&quot;</span>));</span><br><span class="line">                employee.setSalary(rs.getDouble(<span class="string">&quot;salary&quot;</span>));</span><br><span class="line">                employee.setHiredate(rs.getString(<span class="string">&quot;hiredate&quot;</span>));</span><br><span class="line">                employee.setAddress(rs.getString(<span class="string">&quot;address&quot;</span>));</span><br><span class="line">                <span class="comment">// 将员工对象添加到List集合中</span></span><br><span class="line">                employeeList.add(employee);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.close(conn, ps, rs);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> employeeList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用dao优化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">EmployeeDao</span> <span class="variable">employeeDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmployeeDao</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doDel</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">            employeeDao.deleteByid(id);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doModify</span><span class="params">(<span class="type">long</span> id, String name, String job, Double salary, String hiredate, String address)</span> &#123;</span><br><span class="line">            <span class="comment">// update需要传入一个employee对象</span></span><br><span class="line">            <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(id, name, job, salary, hiredate, address);</span><br><span class="line">            employeeDao.update(employee);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doSave</span><span class="params">(String name, String job, Double salary, String hiredate, String address)</span> &#123;</span><br><span class="line">            <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(name, job, salary, hiredate, address);</span><br><span class="line">            employeeDao.insert(employee);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doDetail</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">            <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeDao.selectById(id);</span><br><span class="line">            System.out.println(<span class="string">&quot;id = &quot;</span> + employee.getId());</span><br><span class="line">            System.out.println(<span class="string">&quot;姓名 = &quot;</span> + employee.getName());</span><br><span class="line">            System.out.println(<span class="string">&quot;岗位 = &quot;</span> + employee.getJob());</span><br><span class="line">            System.out.println(<span class="string">&quot;入职日期 = &quot;</span> + employee.getHiredate());</span><br><span class="line">            System.out.println(<span class="string">&quot;月薪 = &quot;</span> + employee.getSalary());</span><br><span class="line">            System.out.println(<span class="string">&quot;住址 = &quot;</span> + employee.getAddress());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doList</span><span class="params">()</span> &#123;</span><br><span class="line">            List&lt;Employee&gt; employees = employeeDao.selectAll();</span><br><span class="line">            System.out.println(<span class="string">&quot;id\tname\tjob&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;----------------------------&quot;</span>);</span><br><span class="line">            <span class="comment">// 遍历List集合</span></span><br><span class="line">            <span class="keyword">for</span> (Employee e : employees) &#123;</span><br><span class="line">                System.out.println(e.getId() + <span class="string">&quot;\t&quot;</span> + e.getName() + <span class="string">&quot;\t&quot;</span> + e.getJob());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="BaseDao的封装"><a href="#BaseDao的封装" class="headerlink" title="BaseDao的封装"></a>BaseDao的封装</h2><p>可以写一个basedao，然后让EmployeeDao继承basedao，调用里面的方法，方法一个是查询，一个是增删改</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 这是一个通用的执行insert delete update语句的方法。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">//这里应该传一个sql语句，而？的参数有可能是一个也可能是多个，用可变长参数</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">executeUpdate</span><span class="params">(String sql, Object... params)</span>&#123;</span><br><span class="line">      <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          conn = DbUtils.getConnection();</span><br><span class="line">          ps = conn.prepareStatement(sql);</span><br><span class="line">          <span class="comment">// 给 ? 占位符传值，因为可能是没有参数的</span></span><br><span class="line">          <span class="keyword">if</span>(params != <span class="literal">null</span> &amp;&amp; params.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">              <span class="comment">// 有占位符 ?</span></span><br><span class="line">              <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; params.length; i++) &#123;</span><br><span class="line">                  ps.setObject(i + <span class="number">1</span>,params[i]);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// 执行SQL语句</span></span><br><span class="line">          count = ps.executeUpdate();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">      &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">          DbUtils.close(conn, ps, <span class="literal">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> count;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>之前的EmployeeDao就改成</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeDao</span> <span class="keyword">extends</span> <span class="title class_">BaseDao</span>&#123;</span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增员工</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee 员工数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 1表示新增了1条记录。返回其他值表示新增失败。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insert</span><span class="params">(Employee employee)</span>&#123;</span><br><span class="line">         <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_employee(name,job,salary,hiredate,address) values(?,?,?,?,?)&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> executeUpdate(sql, employee.getName(), employee.getJob(), employee.getSalary(), employee.getHiredate(), employee.getAddress());</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id删除员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 员工id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 1表示删除成功，其他值表示删除失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteByid</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from t_employee where id = ?&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> executeUpdate(sql, id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newEmployee 新的员工信息（注意：新的员工信息和旧的员工信息id是不变的。）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 1表示修改成功，其他值表示修改失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Employee newEmployee)</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update t_employee set name=?, job=?, salary=?, hiredate=?, address=? where id=?&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> executeUpdate(sql, newEmployee.getName(), newEmployee.getJob(), newEmployee.getSalary(), newEmployee.getHiredate(), newEmployee.getAddress(),newEmployee.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>而查询里的数组是需要创建对象的，但这个对象每次传入的都不一样，比如userDao extends BaseDao，需要传入的就是List<User>，这里就需要使用泛型了，而泛型获取对象是通过反射机制也就是class clazz，clazz.newInstance();</p><p>另外只返回一个也可以当做list集合对待<br>可变长参数必须是最后一个</p><h1 id="第09章-连接池"><a href="#第09章-连接池" class="headerlink" title="第09章 连接池"></a>第09章 连接池</h1><h2 id="连接池的理解"><a href="#连接池的理解" class="headerlink" title="连接池的理解"></a>连接池的理解</h2><h3 id="不使用连接池有啥问题"><a href="#不使用连接池有啥问题" class="headerlink" title="不使用连接池有啥问题"></a>不使用连接池有啥问题</h3><p>Connection对象是重量级对象，创建Connection对象就是建立两个进程之间的通信，非常耗费资源。一次完整的数据库操作，大部分时间都耗费在连接对象的创建。<br>第一个问题：每一次请求都创建一个Connection连接对象，效率较低。<br>第二个问题：连接对象的数量无法限制。如果连接对象的数量过高，会导致mysql数据库服务器崩溃。</p><h3 id="使用连接池来解决什么问题"><a href="#使用连接池来解决什么问题" class="headerlink" title="使用连接池来解决什么问题"></a>使用连接池来解决什么问题</h3><p>提前创建好N个连接对象，将其存放到一个集合中（这个集合就是一个缓存）。<br>用户请求时，需要连接对象直接从连接池中获取，不需要创建连接对象，因此效率较高。<br>另外，连接对象只能从连接池中获取，如果没有空闲的连接对象，只能等待，这样连接对象创建的数量就得到了控制。<br>从连接池拿到的conn对象也要调用close，但是并不是关闭连接，而是归还到连接池里并设置状态为null</p><h3 id="javax-sql-DataSource"><a href="#javax-sql-DataSource" class="headerlink" title="javax.sql.DataSource"></a>javax.sql.DataSource</h3><p>连接池有很多，不过所有的连接池都实现了 javax.sql.DataSource 接口。也就是说我们程序员在使用连接池的时候，不管使用哪家的连接池产品，只要面向javax.sql.DataSource接口调用方法即可。</p><p>另外，实际上我们也可以自定义属于我们自己的连接池。只要实现DataSource接口即可。</p><p>连接池也可以叫做数据源</p><h3 id="连接池的属性"><a href="#连接池的属性" class="headerlink" title="连接池的属性"></a>连接池的属性</h3><p>对于一个基本的连接池来说，一般都包含以下几个常见的属性：</p><ol><li>初始化连接数（initialSize）：连接池初始化时创建的连接数。 </li><li>最大连接数（maxActive）：连接池中最大的连接数，也就是连接池所能容纳的最大连接数量，当连接池中的连接数量达到此值时，后续请求会被阻塞并等待连接池中有连接被释放后再处理。 </li><li>最小空闲连接数量（minIdle）： 指连接池中最小的空闲连接数，也就是即使当前没有请求，连接池中至少也要保持一定数量的空闲连接，以便应对高并发请求或突发连接请求的情况。</li><li>最大空闲连接数量（maxIdle）： 指连接池中最大的空闲连接数，也就是连接池中最多允许保持的空闲连接数量。当连接池中的空闲连接数量达到了maxIdle设定的值后，多余的空闲连接将会被连接池释放掉。</li><li>最大等待时间（maxWait）：当连接池中的连接数量达到最大值时，后续请求需要等待的最大时间，如果超过这个时间，则会抛出异常。 </li><li>连接有效性检查（testOnBorrow、testOnReturn）：为了确保连接池中只有可用的连接，一些连接池会定期对连接进行有效性检查，这里的属性就是配置这些检查的选项。 </li><li>连接的driver、url、user、password等。</li></ol><p>以上这些属性是连接池中较为常见的一些属性，不同的连接池在实现时可能还会有其他的一些属性，不过大多数连接池都包含了以上几个属性，对于使用者来说需要根据自己的需要进行灵活配置。</p><h2 id="常用的连接池"><a href="#常用的连接池" class="headerlink" title="常用的连接池"></a>常用的连接池</h2><p>市面上常用的数据库连接池有许多，以下是其中几种：</p><ol><li>DBCP（不用了）<ol><li>2001年诞生，最早的连接池。</li><li>Apache Software Foundation的一个开源项目。</li><li>DBCP的设计初衷是为了满足Tomcat服务器对连接池管理的需求。</li></ol></li><li>c3p0（不用了）<ol><li>2004年诞生</li><li>c3p0是由Steve Waldman于2004年推出的，它是一个高性能、高可靠性、易配置的数据库连接池。c3p0能够提供连接池的容错能力、自动重连等功能，适用于高并发场景和数据量大的应用。</li></ol></li><li>Druid（多功能豪华版）<ol><li>2012年诞生</li><li>Druid连接池由阿里巴巴集团开发，于2011年底开始对外公开，2012年正式发布。Druid是一个具有高性能、高可靠性、丰富功能的数据库连接池，不仅可以做连接池，还能做监控、分析和管理数据库，支持SQL防火墙、统计分析、缓存和访问控制等功能。</li></ol></li><li>HikariCP（专精的非豪华版<ol><li>2012年诞生</li><li>HikariCP是由Brett Wooldridge于2012年创建的开源项目，它被认为是Java语言下最快的连接池之一，具有快速启动、低延迟、低资源消耗等优点。HikariCP连接池适用于高并发场景和云端应用。</li><li>很单纯的一个连接池，这个产品只做连接池应该做的，其他的不做。所以性能是极致的。相对于Druid来说，它更加轻量级。</li><li>Druid连接池在连接管理之外提供了更多的功能，例如SQL防火墙、统计分析、缓存、访问控制等，适用于在数据库访问过程中，需要进行细粒度控制的场景</li><li>HikariCP则更侧重于性能方面的优化，对各种数据库的兼容性也更好</li></ol></li><li>BoneCP<ol><li>2015年诞生</li><li>BoneCP是一款Java语言下的高性能连接池，于2015年由Dominik Gruntz在GitHub上发布。BoneCP具有分布式事务、连接空闲检查、SQL语句跟踪和性能分析、特定类型的连接池等特点。BoneCP连接池适用于大型应用系统和高并发的负载场景</li></ol></li></ol><h2 id="连接池的使用"><a href="#连接池的使用" class="headerlink" title="连接池的使用"></a>连接池的使用</h2><h3 id="Druid的使用"><a href="#Druid的使用" class="headerlink" title="Druid的使用"></a>Druid的使用</h3><p>第一步：引入Druid的jar包<br><img src="/./images/JDBC/1713164785681-0fdb049c-2a06-40e4-83cd-bfc876d8b696.png#averageHue=#fdfcfb&clientId=u80e8c903-6055-4&from=paste&height=66&id=u7fa2aef7&originHeight=66&originWidth=180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1594&status=done&style=shadow&taskId=u1da80432-7b19-4905-a407-56e3e288d88&title=&width=180" alt="image.png"><br>第二步：配置文件<br>在类的根路径下创建一个属性资源文件：jdbc.properties，也可以在JDBC_study目录下建立一个文件夹叫resources，然后右击选择<img src="/./images/JDBC/image-20250413145501319.png" alt="image-20250413145501319">等同于放在src根目录下面</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/jdbc</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">1234</span></span><br><span class="line"><span class="attr">driverClassName</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">initialSize</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">minIdle</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">maxActive</span>=<span class="string">20</span></span><br></pre></td></tr></table></figure><p>第三步：编写代码，从连接池中获取连接对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;<span class="comment">//注意导包不要导错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取一个输入流，指向一个属性资源文件</span></span><br><span class="line"><span class="comment">//当前线程的类加载器，去累的根路径下加载资源，并以流的方式返回</span></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span>Thread.currentThread().getContextClassLoader().getResourceAsStream(<span class="string">&quot;jdbc.properties&quot;</span>);</span><br><span class="line"><span class="comment">// 创建属性类对象</span></span><br><span class="line"><span class="type">Properties</span> <span class="variable">prop</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"><span class="comment">// 将属性配置文件的资源加载到属性类对象当中</span></span><br><span class="line">prop.load(in);</span><br><span class="line"><span class="comment">// 获取连接池对象，德鲁伊数据来源工厂，里面传入一个properties对象</span></span><br><span class="line"><span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> DruidDataSourceFactory.createDataSource(prop);</span><br><span class="line"><span class="comment">// 通过连接池获取连接对象</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">System.out.println(conn);</span><br><span class="line"><span class="comment">// CRUD操作....</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭资源（这个不是真正的关闭，只是将连接池中的连接对象状态修改为空闲）</span></span><br><span class="line">conn.close();</span><br></pre></td></tr></table></figure><p>第四步：关闭连接<br>仍然调用Connection的close()方法，但是这个close()方法并不是真正的关闭连接，只是将连接归还到连接池，让其称为空闲连接对象。这样其他线程可以继续使用该空闲连接。</p><h3 id="DbUtils的升级改造"><a href="#DbUtils的升级改造" class="headerlink" title="DbUtils的升级改造"></a>DbUtils的升级改造</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DbUtils2</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">DbUtils2</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DataSource dataSource;<span class="comment">//在类加载的静态代码块里被赋值</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader().getResourceAsStream(<span class="string">&quot;jdbc.properties&quot;</span>);</span><br><span class="line">            <span class="type">Properties</span> <span class="variable">prop</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">            prop.load(in);</span><br><span class="line">            dataSource = DruidDataSourceFactory.createDataSource(prop);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取数据库连接对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 连接对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">return</span> dataSource.getConnection();<span class="comment">//返回的是conn</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 释放资源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> conn 连接对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> stmt 数据库操作对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rs 结果集对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(Connection conn, Statement stmt, ResultSet rs)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (rs != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (stmt != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                stmt.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (conn != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HikariCP的使用"><a href="#HikariCP的使用" class="headerlink" title="HikariCP的使用"></a>HikariCP的使用</h3><p>第一步：引入jar包</p><p><img src="/./images/JDBC/image-20250413152910785.png" alt="image-20250413152910785"> </p><p>第二步：编写配置文件<br>在类的根路径下创建一个属性资源文件：jdbc2.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbcUrl</span>=<span class="string">jdbc:mysql://localhost:3306/jdbc</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">1234</span></span><br><span class="line"><span class="attr">driverClassName</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">minimumIdle</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">maximumPoolSize</span>=<span class="string">20</span></span><br></pre></td></tr></table></figure><p>第三步：编写代码，从连接池中获取连接</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCTest26</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader().getResourceAsStream(<span class="string">&quot;jdbc2.properties&quot;</span>);</span><br><span class="line">        <span class="comment">// 创建属性类对象</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        properties.load(in);</span><br><span class="line">        <span class="comment">// 创建配置信息对象</span></span><br><span class="line">        <span class="type">HikariConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariConfig</span>(properties);</span><br><span class="line">        <span class="comment">// 获取连接池</span></span><br><span class="line">        <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>(config);</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">        System.out.println(conn);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//....</span></span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第四步：关闭连接（调用conn.close()，将连接归还到连接池，连接对象为空闲状态。）</p><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="-1"><a href="#-1" class="headerlink" title=""></a></h1>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> jdbc </tag>
            
            <tag> sql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据库</title>
      <link href="/posts/14ea6df7.html"/>
      <url>/posts/14ea6df7.html</url>
      
        <content type="html"><![CDATA[<h1 id="数据库概述"><a href="#数据库概述" class="headerlink" title="数据库概述"></a>数据库概述</h1><h2 id="什么是数据库"><a href="#什么是数据库" class="headerlink" title="什么是数据库"></a>什么是数据库</h2><ul><li>数据库对应的英文单词是DataBase，简称DB</li><li>java的端口号：8080，mysql的3306</li></ul><h2 id="数据库类型"><a href="#数据库类型" class="headerlink" title="数据库类型"></a>数据库类型</h2><ul><li>关系型数据库<ul><li>关系型数据库是依据关系模型来创建的数据库。所谓关系模型就是“一对一、一对多、多对多”等关系模型</li></ul></li><li>非关系型数据库（NoSQL）</li></ul><h2 id="数据库管理系统"><a href="#数据库管理系统" class="headerlink" title="数据库管理系统"></a>数据库管理系统</h2><ul><li>数据库管理系统（Database Management System，简称DBMS）是为管理数据库而设计的电脑软件系统，一般具有存储、截取、安全保障、备份等基础功能。</li><li>数据库管理系统是数据库系统的核心组成部分，主要完成对数据库的操作与管理功能，实现数据库对象的创建、数据库存储数据的查询、添加、修改与删除操作和数据库的用户管理、权限管理等。</li><li>常见的数据库管理系统有：MySQL、Oracle、DB2、MS SQL Server、SQLite、PostgreSQL、Sybase等。</li></ul><h2 id="什么是SQL"><a href="#什么是SQL" class="headerlink" title="什么是SQL"></a>什么是SQL</h2><ul><li>结构化查询语言（Structured Query Language）简称SQL，是一种特殊目的的编程语言，是一种数据库查询和程序设计语言，用于存取数据以及查询、更新和管理关系数据库系统。</li><li>DBMS（软件）-&gt; SQL（语言）-&gt; DB（文件）</li><li>SQL的分类<ul><li>DQL（最重要 ）<ul><li>数据查询语言（Data Query Language, DQL）是SQL语言中，负责进行数据查询而不会对数据本身进行修改的语句，这是最基本的SQL语句。保留字<strong>SELECT</strong>是DQL（也是所有SQL）用得最多的动词，其他DQL常用的保留字有FROM，WHERE，GROUP BY，HAVING和ORDER BY。这些DQL保留字常与其他类型的SQL语句一起使用。</li></ul></li><li>DDL（对表结构进行操作）<ul><li>数据定义语言 (Data Definition Language, DDL) 是SQL语言集中，负责数据结构定义与数据库对象定义的语言，由CREATE、ALTER与DROP三个语法所组成，最早是由 Codasyl (Conference on Data Systems Languages) 数据模型开始，现在被纳入 SQL 指令中作为其中一个子集。</li></ul></li><li>DML<ul><li>数据操纵语言（Data Manipulation Language, DML）是SQL语言中，负责对数据库对象运行数据访问工作的指令集，以<strong>INSERT、UPDATE、DELETE</strong>三种指令为核心，分别代表插入、更新与删除。</li></ul></li><li>DCL<ul><li>数据控制语言 (Data Control Language) 在SQL语言中，是一种可对数据访问权进行控制的指令，它可以控制特定用户账户对数据表、查看表、预存程序、用户自定义函数等数据库对象的控制权。由 GRANT 和 REVOKE 两个指令组成。DCL以控制用户的访问权限为主，GRANT为<strong>授权</strong>语句，对应的REVOKE是<strong>撤销授权</strong>语句。</li></ul></li></ul></li></ul><h1 id="登录MySQL"><a href="#登录MySQL" class="headerlink" title="登录MySQL"></a>登录MySQL</h1><p>修改MySQL的root账户密码：ALTER USER ‘root‘@’localhost’ IDENTIFIED WITH mysql_native_password BY ‘新密码’;</p><h2 id="本地登录"><a href="#本地登录" class="headerlink" title="本地登录"></a>本地登录</h2><ul><li>如果mysql的服务是启动的，打开dos命令窗口，输入：mysql -uroot -p，回车，然后输入root账户的密码</li></ul><p>![(image-20250315165831211.png)</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250315165940960.png" alt="image-20250315165940960"></p><p>解释“mysql -uroot -p”：<br>mysql是一个命令，在bin目录下，对应的命令文件是mysql.exe，如果将bin目录配置到环境<br>变量path中，才可以在以上位置使用该命令。<br>-uroot 表示登录的用户是root，u实际上是user单词的首字母。<br>-p 表示登录时使用密码，p实际上是password单词的首字母。</p><ul><li>也可以将密码以明文的形式写到-p后面，这样做可能会导致你的密码泄露</li></ul><h2 id="远程登录"><a href="#远程登录" class="headerlink" title="远程登录"></a>远程登录</h2><p>假设mysql安装在A机器上，现在你要在B机器上连接mysql数据库，此时需要使用远程登录，远程登录时加上远程机器的ip地址即可</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250315170219114.png" alt="image-20250315170219114"></p><p>-h中的h实际上是host单词的首字母。在-h后面的是远程计算机的ip地址。<br>127.0.0.1是计算机默认的本机IP地址。<br>127.0.0.1又可以写作：localhost，他们是等效的。<br>注意：mysql默认情况下root账户是不支持远程登录的，其实这是一种安全策略，<br>为了保护root账户的安全。如果希望root账户支持远程登录，这是需要进行设置的。</p><ul><li><p>mysql8 开放root账户远程登录权限（危险动作）</p><p>第一步：现在本地使用root账户登录mysql</p><p>第二步：use mysql;</p><p>第三步：update user set host &#x3D; ‘%’ where user &#x3D; ‘root’;</p><p>第四步：flush privileges;</p></li></ul><h1 id="第03章-初始化数据"><a href="#第03章-初始化数据" class="headerlink" title="第03章 初始化数据"></a>第03章 初始化数据</h1><h2 id="MySQL命令行基本命令"><a href="#MySQL命令行基本命令" class="headerlink" title="MySQL命令行基本命令"></a>MySQL命令行基本命令</h2><ol><li>列出当前数据库管理系统中有哪些数据库。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316030921110.png" alt="image-20250316030921110"></p><ol start="2"><li>创建数据库，起名bjpowernode。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database bjpowernode;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316030952423.png" alt="image-20250316030952423"></p><ol start="3"><li>使用bjpowernode数据库。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use bjpowernode;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316031003365.png"></p><ol start="4"><li>查看当前用的是哪个数据库。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> database();</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316031023848.png" alt="image-20250316031023848"></p><ol start="5"><li>查看当前数据库中有哪些表。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> tables;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/1620402397890-84d73980-1046-4e83-b6cb-bdcc68ba7b57.png#averageHue=#151210&height=53&id=qqu40&originHeight=53&originWidth=207&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2593&status=done&style=shadow&title=&width=207" alt="image.png"></p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316031042985.png" alt="image-20250316031042985"></p><ol start="6"><li>删除数据库bjpowernode。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> database bjpowernode;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316031107016.png" alt="image-20250316031107016"></p><ol start="7"><li>退出mysql<ol><li>exit</li><li>quit</li><li>ctrl + c</li></ol></li><li>查看当前mysql版本</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> version();</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316031121447.png" alt="image-20250316031121447"></p><p>还可以使用mysql.exe命令来查看版本信息（在没有登录mysql之前使用）：mysql –version</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316031137820.png" alt="image-20250316031137820"></p><h2 id="数据库表的概述"><a href="#数据库表的概述" class="headerlink" title="数据库表的概述"></a>数据库表的概述</h2><table><thead><tr><th>name</th><th>age</th><th>gender</th></tr></thead><tbody><tr><td>张三</td><td>20</td><td>男</td></tr><tr><td>李四</td><td>22</td><td>女</td></tr></tbody></table><p>行是row，列是column</p><ul><li>任何一张表都有行和列：<ul><li>行：记录（一行就是一条数据）</li><li>列：字段（name字段、age字段、gender字段）</li></ul></li><li>每个字段包含以下属性：<ul><li>字段名：name、age、gender都是字段的名字</li><li>字段的数据类型：每个字段都有数据类型，比如：字符类型、数字类型、日期类型</li><li>字段的数据长度：每个字段有可能会有长度的限制</li><li>字段的约束：比如某些字段要求该字段下的数据不能重复、不能为空等，用来保证表格中数据合法有效</li></ul></li></ul><h2 id="初始化测试数据"><a href="#初始化测试数据" class="headerlink" title="初始化测试数据"></a>初始化测试数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> EMP;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> DEPT;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> SALGRADE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> DEPT(DEPTNO <span class="type">int</span>(<span class="number">2</span>) <span class="keyword">not null</span> ,</span><br><span class="line">DNAME <span class="type">VARCHAR</span>(<span class="number">14</span>) ,</span><br><span class="line">LOC <span class="type">VARCHAR</span>(<span class="number">13</span>),</span><br><span class="line"><span class="keyword">primary key</span> (DEPTNO)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE TABLE</span> EMP(EMPNO <span class="type">int</span>(<span class="number">4</span>)  <span class="keyword">not null</span> ,</span><br><span class="line">ENAME <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">JOB <span class="type">VARCHAR</span>(<span class="number">9</span>),</span><br><span class="line">MGR <span class="type">INT</span>(<span class="number">4</span>),</span><br><span class="line">HIREDATE <span class="type">DATE</span>  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">SAL <span class="keyword">DOUBLE</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line">COMM <span class="keyword">DOUBLE</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"><span class="keyword">primary key</span> (EMPNO),</span><br><span class="line">DEPTNO <span class="type">INT</span>(<span class="number">2</span>) </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> SALGRADE( GRADE <span class="type">INT</span>,</span><br><span class="line">LOSAL <span class="type">INT</span>,</span><br><span class="line">HISAL <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> DEPT ( DEPTNO, DNAME, LOC ) <span class="keyword">VALUES</span> ( <span class="number">10</span>, <span class="string">&#x27;ACCOUNTING&#x27;</span>, <span class="string">&#x27;NEW YORK&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> DEPT ( DEPTNO, DNAME, LOC ) <span class="keyword">VALUES</span> ( <span class="number">20</span>, <span class="string">&#x27;RESEARCH&#x27;</span>, <span class="string">&#x27;DALLAS&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> DEPT ( DEPTNO, DNAME, LOC ) <span class="keyword">VALUES</span> ( <span class="number">30</span>, <span class="string">&#x27;SALES&#x27;</span>, <span class="string">&#x27;CHICAGO&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> DEPT ( DEPTNO, DNAME, LOC ) <span class="keyword">VALUES</span> ( <span class="number">40</span>, <span class="string">&#x27;OPERATIONS&#x27;</span>, <span class="string">&#x27;BOSTON&#x27;</span>); </span><br><span class="line"> </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7369</span>, <span class="string">&#x27;SMITH&#x27;</span>, <span class="string">&#x27;CLERK&#x27;</span>, <span class="number">7902</span>,  <span class="string">&#x27;1980-12-17&#x27;</span>, <span class="number">800</span>, <span class="keyword">NULL</span>, <span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7499</span>, <span class="string">&#x27;ALLEN&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>, <span class="number">7698</span>,  <span class="string">&#x27;1981-02-20&#x27;</span>, <span class="number">1600</span>, <span class="number">300</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7521</span>, <span class="string">&#x27;WARD&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>, <span class="number">7698</span>,  <span class="string">&#x27;1981-02-22&#x27;</span>, <span class="number">1250</span>, <span class="number">500</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7566</span>, <span class="string">&#x27;JONES&#x27;</span>, <span class="string">&#x27;MANAGER&#x27;</span>, <span class="number">7839</span>,  <span class="string">&#x27;1981-04-02&#x27;</span>, <span class="number">2975</span>, <span class="keyword">NULL</span>, <span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7654</span>, <span class="string">&#x27;MARTIN&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>, <span class="number">7698</span>,  <span class="string">&#x27;1981-09-28&#x27;</span>, <span class="number">1250</span>, <span class="number">1400</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7698</span>, <span class="string">&#x27;BLAKE&#x27;</span>, <span class="string">&#x27;MANAGER&#x27;</span>, <span class="number">7839</span>,  <span class="string">&#x27;1981-05-01&#x27;</span>, <span class="number">2850</span>, <span class="keyword">NULL</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7782</span>, <span class="string">&#x27;CLARK&#x27;</span>, <span class="string">&#x27;MANAGER&#x27;</span>, <span class="number">7839</span>,  <span class="string">&#x27;1981-06-09&#x27;</span>, <span class="number">2450</span>, <span class="keyword">NULL</span>, <span class="number">10</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7788</span>, <span class="string">&#x27;SCOTT&#x27;</span>, <span class="string">&#x27;ANALYST&#x27;</span>, <span class="number">7566</span>,  <span class="string">&#x27;1987-04-19&#x27;</span>, <span class="number">3000</span>, <span class="keyword">NULL</span>, <span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7839</span>, <span class="string">&#x27;KING&#x27;</span>, <span class="string">&#x27;PRESIDENT&#x27;</span>, <span class="keyword">NULL</span>,  <span class="string">&#x27;1981-11-17&#x27;</span>, <span class="number">5000</span>, <span class="keyword">NULL</span>, <span class="number">10</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7844</span>, <span class="string">&#x27;TURNER&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>, <span class="number">7698</span>,  <span class="string">&#x27;1981-09-08&#x27;</span>, <span class="number">1500</span>, <span class="number">0</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7876</span>, <span class="string">&#x27;ADAMS&#x27;</span>, <span class="string">&#x27;CLERK&#x27;</span>, <span class="number">7788</span>,  <span class="string">&#x27;1987-05-23&#x27;</span>, <span class="number">1100</span>, <span class="keyword">NULL</span>, <span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7900</span>, <span class="string">&#x27;JAMES&#x27;</span>, <span class="string">&#x27;CLERK&#x27;</span>, <span class="number">7698</span>,  <span class="string">&#x27;1981-12-03&#x27;</span>, <span class="number">950</span>, <span class="keyword">NULL</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7902</span>, <span class="string">&#x27;FORD&#x27;</span>, <span class="string">&#x27;ANALYST&#x27;</span>, <span class="number">7566</span>,  <span class="string">&#x27;1981-12-03&#x27;</span>, <span class="number">3000</span>, <span class="keyword">NULL</span>, <span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,DEPTNO ) <span class="keyword">VALUES</span> ( <span class="number">7934</span>, <span class="string">&#x27;MILLER&#x27;</span>, <span class="string">&#x27;CLERK&#x27;</span>, <span class="number">7782</span>,  <span class="string">&#x27;1982-01-23&#x27;</span>, <span class="number">1300</span>, <span class="keyword">NULL</span>, <span class="number">10</span>); </span><br><span class="line"> </span><br><span class="line"><span class="keyword">INSERT INTO</span> SALGRADE ( GRADE, LOSAL, HISAL ) <span class="keyword">VALUES</span> ( <span class="number">1</span>, <span class="number">700</span>, <span class="number">1200</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> SALGRADE ( GRADE, LOSAL, HISAL ) <span class="keyword">VALUES</span> ( <span class="number">2</span>, <span class="number">1201</span>, <span class="number">1400</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> SALGRADE ( GRADE, LOSAL, HISAL ) <span class="keyword">VALUES</span> ( <span class="number">3</span>, <span class="number">1401</span>, <span class="number">2000</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> SALGRADE ( GRADE, LOSAL, HISAL ) <span class="keyword">VALUES</span> ( <span class="number">4</span>, <span class="number">2001</span>, <span class="number">3000</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> SALGRADE ( GRADE, LOSAL, HISAL ) <span class="keyword">VALUES</span> ( <span class="number">5</span>, <span class="number">3001</span>, <span class="number">9999</span>); </span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure><ul><li><p>什么是sql脚本：文件名是.sql，并且该文件中编写了大量的SQL语句，执行sql脚本程序就相当于批量执行SQL语句。</p></li><li><p>创建文件：bjpowernode.sql，把以上SQL语句全部复制到sql脚本文件中。</p></li><li><p>执行SQL脚本文件，初始化数据库</p><ul><li>第一步：命令窗口登录mysql</li><li>第二步：创建数据库bjpowernode（如果之前已经创建就不需要再创建了）：create database bjpowernode;</li><li>第三步：使用数据库bjpowernode：use bjpowernode;</li><li>第四步：source命令执行sql脚本，注意：source命令后面是sql脚本文件的绝对路径。</li><li>第五步：查看是否初始化成功，执行：show tables;</li></ul></li><li><p>使用其他的mysql客户端工具也可以执行sql脚本，比如navicat。使用source命令执行sql脚本的优点：<strong>可支持大文件</strong>。</p></li></ul><h2 id="熟悉测试数据"><a href="#熟悉测试数据" class="headerlink" title="熟悉测试数据"></a>熟悉测试数据</h2><p>查看表结构：desc或describe，语法格式：desc（简写）或describe +表名</p><h1 id="第04章-查询DQL专题"><a href="#第04章-查询DQL专题" class="headerlink" title="第04章 查询DQL专题"></a>第04章 查询DQL专题</h1><h2 id="简单查询"><a href="#简单查询" class="headerlink" title="简单查询"></a>简单查询</h2><h3 id="查一个字段"><a href="#查一个字段" class="headerlink" title="查一个字段"></a>查一个字段</h3><p>查询一个字段说的是：一个表有多列，查询其中的一列。<br>语法格式：select 字段名 from 表名;</p><ul><li>select和from是关键字，不能随便写</li><li><strong>一条SQL语句必须以“;”结尾</strong></li><li>如果需要关键字做标识符创建，需要加上`关键字&#96;</li><li><strong>对于SQL语句来说，大小写都可以</strong></li><li>字段名和表名属于标识符（起名字的），按照表的实际情况填写，不知道字段名的，可以使用desc命令查看表结构</li></ul><p>案例1：查询公司中所有员工编号</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno <span class="keyword">from</span> emp; </span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316034706352.png" alt="image-20250316034706352"></p><p>在mysql命令行客户端中，sql语句没有分号是不会执行的：末尾加上“;”就执行了：</p><p>假设一个SQL语句在书写过程中出错了，<strong>怎么终止这条SQL呢？\c</strong></p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316034836435.png" alt="image-20250316034836435"></p><h3 id="查多个字段"><a href="#查多个字段" class="headerlink" title="查多个字段"></a>查多个字段</h3><p>查询多个字段时，在字段名和字段名之间添加“,”即可。<br>语法格式：select 字段名1,字段名2,字段名3 from 表名;<br>案例1：查询员工编号以及员工姓名。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno, ename <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><h3 id="查所有字段"><a href="#查所有字段" class="headerlink" title="查所有字段"></a>查所有字段</h3><p>查询所有字段的可以将每个字段都列出来查询，也可以采用“*”来代表所有字段<br>案例1：查询员工的所有信息</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><h4 id="查询时字段可参与数学运算"><a href="#查询时字段可参与数学运算" class="headerlink" title="查询时字段可参与数学运算"></a>查询时字段可参与数学运算</h4><p>在进行查询操作的时候，字段是可以参与数学运算的，例如加减乘除等。<br>案例1：查询每个员工的月薪</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename, sal <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p>案例2：查询每个员工的年薪（月薪 * 12）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename, sal <span class="operator">*</span> <span class="number">12</span> <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><ul><li><input disabled="" type="checkbox"> 任务：查询每个员工月薪加1000之后的年薪</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename, (sal <span class="operator">+</span> <span class="number">1000</span>)<span class="operator">*</span><span class="number">12</span> <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><h3 id="查询时字段可起别名"><a href="#查询时字段可起别名" class="headerlink" title="查询时字段可起别名"></a>查询时字段可起别名</h3><p>as可以省略，但是名字里不能有空格，需要<strong>有空格</strong>的情况就要加单引号</p><p>查询<strong>日期</strong>之类的也需要单引号</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename, (sal <span class="operator">+</span> <span class="number">1000</span>)<span class="operator">*</span><span class="number">12</span> <span class="keyword">as</span> yearsal <span class="keyword">from</span> emp;<span class="operator">/</span><span class="operator">/</span><span class="keyword">as</span>可以省略，但是名字里不能有空格，需要有空格的情况就要加单引号</span><br><span class="line"><span class="keyword">select</span> empno 员工编号,ename 员工姓名 <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><table><thead><tr><th><strong>条件</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>&#x3D;</td><td>等于</td></tr><tr><td>&lt;&gt;或!&#x3D;</td><td>不等于</td></tr><tr><td>&gt;&#x3D;</td><td>大于等于</td></tr><tr><td>&lt;&#x3D;</td><td>小于等于</td></tr><tr><td>&gt;</td><td>大于</td></tr><tr><td>&lt;</td><td>小于</td></tr><tr><td>between…and…</td><td>等同于 &gt;&#x3D; and &lt;&#x3D;</td></tr><tr><td>is null</td><td>为空</td></tr><tr><td>is not null</td><td>不为空</td></tr><tr><td>&lt;&#x3D;&gt;</td><td>安全等于（可读性差，很少使用了）。</td></tr><tr><td>and 或 &amp;&amp;</td><td>并且</td></tr><tr><td>or 或 &#124;&#124;</td><td>或者</td></tr><tr><td>in</td><td>在指定的值当中</td></tr><tr><td>not in</td><td>不在指定的值当中</td></tr><tr><td>exists</td><td></td></tr><tr><td>not exists</td><td></td></tr><tr><td>like</td><td>模糊查询</td></tr></tbody></table><h3 id="条件查询语法格式"><a href="#条件查询语法格式" class="headerlink" title="条件查询语法格式"></a>条件查询语法格式</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  过滤条件;</span><br><span class="line">  比如</span><br><span class="line">  <span class="keyword">select</span> job,sal <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="operator">=</span> <span class="string">&#x27;FORD&#x27;</span>;</span><br></pre></td></tr></table></figure><p>过滤条件放在where子句当中，以上语句的执行顺序是：<br>    第一步：先执行from<br>    第二步：再通过where条件过滤<br>    第三步：最后执行select，查询并将结果展示到控制台;</p><h3 id="等于"><a href="#等于" class="headerlink" title="等于 &#x3D;"></a>等于 &#x3D;</h3><p>判断等量关系，支持多种数据类型，比如：数字、字符串、日期等。<br>案例1：查询月薪3000的员工编号及姓名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">  empno,ename</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  sal <span class="operator">=</span> <span class="number">3000</span>;</span><br></pre></td></tr></table></figure><h3 id="安全等于（简单了解）"><a href="#安全等于（简单了解）" class="headerlink" title="安全等于（简单了解）"></a>安全等于（简单了解）</h3><p>&lt;&#x3D;&gt;安全等于，用的很少，可读性差</p><p>&lt;&#x3D;&gt;安全等于可作为普通运算符&#x3D;</p><h3 id="不等于-或"><a href="#不等于-或" class="headerlink" title="不等于 &lt;&gt; 或 !&#x3D;"></a>不等于 &lt;&gt; 或 !&#x3D;</h3><p>案例1：查询工资不是3000的员工编号、姓名、薪资</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  empno,ename,sal</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  sal <span class="operator">&lt;&gt;</span> <span class="number">3000</span>;</span><br></pre></td></tr></table></figure><h3 id="大于-、大于等于-、小于"><a href="#大于-、大于等于-、小于" class="headerlink" title="大于 &gt;、大于等于 &gt;&#x3D;、小于 &lt;、小于等于 &lt;&#x3D;、and、or"></a>大于 &gt;、大于等于 &gt;&#x3D;、小于 &lt;、小于等于 &lt;&#x3D;、and、or</h3><p>案例：找出薪资大于3000的员工姓名、薪资</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">  ename, sal</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  sal <span class="operator">&gt;</span> <span class="number">3000</span>;</span><br></pre></td></tr></table></figure><p>and表示并且，还有另一种写法：&amp;&amp;<br>案例：找出薪资大于等于3000并且小于等于5000的员工姓名、薪资。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  ename,sal</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  sal <span class="operator">&gt;=</span> <span class="number">3000</span> <span class="keyword">and</span> sal <span class="operator">&lt;=</span> <span class="number">5000</span>;</span><br></pre></td></tr></table></figure><p>or表示或者，还有另一种写法：||<br>案例：找出工作岗位是MANAGER和SALESMAN的员工姓名、工作岗位</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">  ename, job</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span> <span class="keyword">or</span> job <span class="operator">=</span> <span class="string">&#x27;SALESMAN&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="and和or的优先级问题"><a href="#and和or的优先级问题" class="headerlink" title="and和or的优先级问题"></a>and和or的优先级问题</h3><p>and和or同时出现时，and优先级较高，会先执行，如果希望or先执行，这个时候需要给or条件添加小括号。另外，以后遇到不确定的优先级时，可以通过添加小括号的方式来解决。对于优先级问题没必要记忆。<br>案例：找出薪资小于1500，并且部门编号是20或30的员工姓名、薪资、部门编号。<br>先来看一下错误写法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal,deptno <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&lt;</span><span class="number">1500</span> <span class="keyword">and</span> deptno <span class="operator">=</span> <span class="number">20</span> <span class="keyword">or</span> deptno <span class="operator">=</span> <span class="number">30</span>;</span><br></pre></td></tr></table></figure><p>这里的意思是找出薪资小于1500并且编号是20的，再或者编号30的，就会输出一些大于1500的人</p><p>正确写法如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  ename,sal,deptno</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  sal <span class="operator">&lt;</span> <span class="number">1500</span> <span class="keyword">and</span> (deptno <span class="operator">=</span> <span class="number">20</span> <span class="keyword">or</span> deptno <span class="operator">=</span> <span class="number">30</span>);</span><br></pre></td></tr></table></figure><h3 id="between…and…"><a href="#between…and…" class="headerlink" title="between…and…"></a>between…and…</h3><p>between…and…等同于 &gt;&#x3D; and &lt;&#x3D;<br>做区间判断的，包含左右两个边界值。<br>它支持数字、日期、字符串等数据类型。<br>between…and…在使用时一定是**左小右大**。左大右小时无法查询到数据。<br>between…and… 和 &gt;&#x3D; and &lt;&#x3D;只是在写法结构上有区别，执行原理和效率方面没有区别。<br>案例：找出薪资在1600到3000的员工姓名、薪资</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;=</span> <span class="number">1600</span> <span class="keyword">and</span> sal <span class="operator">&lt;=</span> <span class="number">3000</span>;</span><br><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal bwtween <span class="number">1600</span> <span class="keyword">and</span> <span class="number">3000</span>;<span class="operator">/</span><span class="operator">/</span>使用后</span><br></pre></td></tr></table></figure><ul><li><input disabled="" type="checkbox"> 任务：查询在1982-01-23到1987-04-19之间入职的员工</li></ul><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316234331751.png" alt="image-20250316234331751"></p><p>注意：以上SQL语句中日期需要加上单引号。</p><h3 id="is-null、is-not-null"><a href="#is-null、is-not-null" class="headerlink" title="is null、is not null"></a>is null、is not null</h3><p>判断某个数据是否为null，不能使用等号，只能使用 is null<br>判断某个数据是否不为null，不能使用不等号，只能使用 is not null<br>在数据库中null不是一个值，不能用等号和不等号衡量，null代表什么也没有，没有数据，没有值</p><h4 id="is-null"><a href="#is-null" class="headerlink" title="is null"></a>is null</h4><p>案例1：找出津贴为空的员工姓名、薪资、津贴。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  ename,sal,comm</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  comm <span class="keyword">is</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316235330328.png" alt="image-20250316235330328"></p><h4 id="is-not-null"><a href="#is-not-null" class="headerlink" title="is not null"></a>is not null</h4><p>案例2：找出津贴不为空的员工姓名、薪资、津贴</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  ename,sal,comm</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  comm <span class="keyword">is</span> <span class="keyword">not null</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250316235403630.png" alt="image-20250316235403630"></p><h3 id="in、not-in"><a href="#in、not-in" class="headerlink" title="in、not in"></a>in、not in</h3><h4 id="in"><a href="#in" class="headerlink" title="in"></a>in</h4><p>job in(‘MANAGER’,’SALESMAN’,’CLERK’) 等同于 job &#x3D; ‘MANAGER’ or job &#x3D; ‘SALESMAN’ or job &#x3D; ‘CLERK’<br>sal in(1600, 3000, 5000) 等同于 sal &#x3D; 1600 or sal &#x3D; 3000 or sal &#x3D; 5000<br>in后面有一个小括号，小括号当中有多个值，值和值之间采用逗号隔开<br>sal in(1500, 5000)，需要注意的是：这个并不是说薪资在1500到5000之间，in不代表区间，表示sal是1500的和sal是5000的<br>案例1：找出工作岗位是MANAGER和SALESMAN的员工姓名、薪资、工作岗位<br>第一种：使用or</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  ename,sal,job</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span> <span class="keyword">or</span> job <span class="operator">=</span> <span class="string">&#x27;SALESMAN&#x27;</span>;</span><br></pre></td></tr></table></figure><p>第二种：使用in</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  ename,sal,job</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  job <span class="keyword">in</span>(<span class="string">&#x27;MANAGER&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>);</span><br></pre></td></tr></table></figure><p>任务：找出部门编号是10和20的员工编号、姓名。（要求使用两种方案）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp <span class="keyword">where</span> deptno<span class="operator">=</span><span class="number">10</span> <span class="keyword">or</span> deptno<span class="operator">=</span><span class="number">20</span>;</span><br><span class="line"><span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp <span class="keyword">where</span> deptno <span class="keyword">in</span>(<span class="number">10</span>,<span class="number">20</span>);</span><br></pre></td></tr></table></figure><h4 id="not-in"><a href="#not-in" class="headerlink" title="not in"></a>not in</h4><p>job not in(‘MANAGER’,’SALESMAN’) 等同于 job &lt;&gt; ‘MANAGER’ and job &lt;&gt; ‘SALESMAN’<br>sal not in(1600, 5000) 等同于 sal &lt;&gt; 1600 and sal &lt;&gt; 5000<br>案例：找出工作岗位不是MANAGER和SALESMAN的员工姓名、工作岗位<br>第一种：使用and</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">  ename,job</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  job <span class="operator">&lt;&gt;</span> <span class="string">&#x27;MANAGER&#x27;</span> <span class="keyword">and</span> job <span class="operator">&lt;&gt;</span> <span class="string">&#x27;SALESMAN&#x27;</span>;</span><br></pre></td></tr></table></figure><p>第二种：使用not in</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">  ename,job</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  emp</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  job <span class="keyword">not</span> <span class="keyword">in</span>(<span class="string">&#x27;MANAGER&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>);</span><br></pre></td></tr></table></figure><h4 id="in、not-in-与-NULL"><a href="#in、not-in-与-NULL" class="headerlink" title="in、not in 与 NULL"></a>in、not in 与 NULL</h4><p>写这样一条SQL语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> comm <span class="keyword">in</span>(<span class="keyword">NULL</span>, <span class="number">300</span>);</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317001626810.png" alt="image-20250317001626810"></p><p>为什么以上执行结果只有一条记录呢？分析一下：</p><p>首先你要知道in的执行原理实际上是采用&#x3D;和or的方式，也就是说，以上SQL语句实际上是：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> comm <span class="operator">=</span> <span class="keyword">NULL</span> <span class="keyword">or</span> comm <span class="operator">=</span> <span class="number">300</span>;</span><br></pre></td></tr></table></figure><p>其中NULL不能用等号&#x3D;进行判断，所以comm &#x3D; NULL结果是false，然而中间使用的是or，所以comm &#x3D; NULL被忽略了。所以查询结果就以上一条数据。<br>通过以上的测试得知：<strong>in是自动忽略NULL的</strong>。</p><p>再写这样一条SQL语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> comm <span class="keyword">not</span> <span class="keyword">in</span>(<span class="keyword">NULL</span>, <span class="number">300</span>);</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317145658980.png" alt="image-20250317145658980"></p><p>以上的执行结果奇怪了，为什么没有查到任何数据呢？我们分析一下：<br>首先你要知道not in的执行原理实际上是采用&lt;&gt;和and的方式，也就是说，以上SQL语句实际上是：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> comm <span class="operator">&lt;&gt;</span> <span class="keyword">NULL</span> <span class="keyword">and</span> comm <span class="operator">&lt;&gt;</span> <span class="number">300</span>;</span><br></pre></td></tr></table></figure><p>其中NULL的判断不能使用&lt;&gt;，<strong>所以comm &lt;&gt; NULL结果是false，由于后面是and，and表示并且，comm &lt;&gt; NULL已经是false了，所以and右边的就没必要运算了</strong>，comm &lt;&gt; NULL and comm &lt;&gt; 300的整体运算结果就是false。所以查询不到任何数据。<br>通过以上测试得知，<strong>not in是不会自动忽略NULL的</strong>，所以在使用not in的时候一定要提前过滤掉NULL。</p><h3 id="模糊查询like"><a href="#模糊查询like" class="headerlink" title="模糊查询like"></a>模糊查询like</h3><p>模糊查询又被称为模糊匹配，在实际开发中使用较多，比如：查询公司中所有姓张的，查询岗位中带有经理两个字的职位等等，这些都需要使用模糊查询。<br>模糊查询的语法格式如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> .. <span class="keyword">from</span> .. <span class="keyword">where</span> 字段 <span class="keyword">like</span> <span class="string">&#x27;通配符表达式&#x27;</span>;</span><br></pre></td></tr></table></figure><p>在模糊查询中，通配符主要包括两个：一个是%，一个是下划线_。<br>其中%代表任意多个字符。下划线_代表任意一个字符。</p><p>案例1：查询员工名字以’S’开始的员工姓名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;S%&#x27;</span>;s后面有多个字符</span><br></pre></td></tr></table></figure><p>案例2：查询员工名字以’T’结尾的员工姓名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;%T&#x27;</span>;</span><br></pre></td></tr></table></figure><p>案例3：查询员工名字中含有’O’的员工姓名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;%O%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>案例4：查询员工名字中第二个字母是’A’的员工姓名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;_A%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>案例5：查询学员名字中含有下划线的。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%_%&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317150731785.png" alt="image-20250317150731785"></p><p>查询结果不是我们想要的，之所以将所有数据全部显示，因为下划线代表任意单个字符，如果想让这个下划线变成一个普通的下划线字符，就要使用转义字符了，在mysql当中转义字符是“\”，这个和java语言中的转义字符是一样的：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%\_%&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317150810743.png" alt="image-20250317150810743"></p><h2 id="排序操作"><a href="#排序操作" class="headerlink" title="排序操作"></a>排序操作</h2><p>排序的SQL语法：order by是通过，通过字段排序，asc升序desc降序</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> .. <span class="keyword">from</span> .. <span class="keyword">order</span> <span class="keyword">by</span> 字段 <span class="keyword">asc</span><span class="operator">/</span><span class="keyword">desc</span></span><br></pre></td></tr></table></figure><h3 id="单一字段升序"><a href="#单一字段升序" class="headerlink" title="单一字段升序"></a>单一字段升序</h3><p>查询员工的编号、姓名、薪资，按照薪资升序排列。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">asc</span>;</span><br></pre></td></tr></table></figure><h3 id="单一字段降序"><a href="#单一字段降序" class="headerlink" title="单一字段降序"></a>单一字段降序</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure><h3 id="默认采用升序"><a href="#默认采用升序" class="headerlink" title="默认采用升序"></a>默认采用升序</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> sal;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317151546227.png" alt="image-20250317151546227"></p><p>查询员工的编号、姓名，按照姓名升序排列。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> ename;</span><br></pre></td></tr></table></figure><h3 id="多个字段排序"><a href="#多个字段排序" class="headerlink" title="多个字段排序"></a>多个字段排序</h3><p>查询员工的编号、姓名、薪资，按照薪资升序排列，如果薪资相同的，再按照姓名升序排列。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">asc</span>, ename <span class="keyword">asc</span>;</span><br><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span> <span class="keyword">asc</span>, <span class="number">2</span> <span class="keyword">asc</span>;<span class="operator">/</span><span class="operator">/</span>可读性差，数字表示第几列的意思</span><br></pre></td></tr></table></figure><p><strong>逗号靠前的起主导作用，只有相同的才会执行逗号后面的排序语句</strong></p><h3 id="where和order-by的位置"><a href="#where和order-by的位置" class="headerlink" title="where和order by的位置"></a>where和order by的位置</h3><p>找出岗位是MANAGER和salesman的员工姓名、工作和年薪，按照薪资降序排列。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,job,sal<span class="operator">*</span><span class="number">12</span> <span class="keyword">as</span> yearsal <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="keyword">in</span>(<span class="string">&#x27;manager&#x27;</span>,<span class="string">&#x27;salesman&#x27;</span>) <span class="keyword">order</span> <span class="keyword">by</span> yearsal <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure><p><strong>目前学习过的顺序：先from，再where，再select，再order by</strong></p><h2 id="distinct去重"><a href="#distinct去重" class="headerlink" title="distinct去重"></a>distinct去重</h2><p>去除重复记录，只是显示的时候去重，不影响数据库，在字段前添加distinct关键字。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> job <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p>接下来测试一下，在distinct关键字前添加其它字段是否可以？</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename, <span class="keyword">distinct</span> job <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317153208747.png" alt="image-20250317153208747"></p><p>报错了，通过测试得知，distinct只能出现在所有字段的最前面。</p><p><strong>当distinct出现后，后面多个字段一定是联合去重的</strong>，我们来做两个练习就知道了：</p><p>练习1：找出公司中所有的工作岗位</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317153250811.png" alt="image-20250317153250811"></p><p>练习2：找出公司中不同部门的不同工作岗位。</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250317153457101.png" alt="image-20250317153457101"></p><h2 id="数据处理函数（单行处理函数）"><a href="#数据处理函数（单行处理函数）" class="headerlink" title="数据处理函数（单行处理函数）"></a>数据处理函数（单行处理函数）</h2><p>关于select语句，我们之前都是这样写：select 字段名 from 表名; 这里的字段名可以看做“变量”，也可以看做常量</p><h3 id="字符串相关"><a href="#字符串相关" class="headerlink" title="字符串相关"></a>字符串相关</h3><h4 id="转大写upper和ucase"><a href="#转大写upper和ucase" class="headerlink" title="转大写upper和ucase"></a>转大写upper和ucase</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 查询所有员工名字，以大写形式展现</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">upper</span>(ename) <span class="keyword">as</span> ename <span class="keyword">from</span> emp;</span><br><span class="line"># 查询所有员工姓名，以大写形式展现</span><br><span class="line"><span class="keyword">select</span> ucase(ename) <span class="keyword">as</span> ename <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318010721109.png" alt="image-20250318010721109"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查询员工smith的岗位、薪资（假如你不知道数据库表中的人名是大写、小写还是大小写混合）</span><br><span class="line"><span class="keyword">select</span> ename, job, sal <span class="keyword">from</span> emp <span class="keyword">where</span> <span class="built_in">upper</span>(ename) <span class="operator">=</span> <span class="string">&#x27;SMITH&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318011115152.png" alt="image-20250318011115152"></p><h4 id="转小写lower和lcase"><a href="#转小写lower和lcase" class="headerlink" title="转小写lower和lcase"></a>转小写lower和lcase</h4><p><strong>很简单，不再赘述，直接上代码：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 查询员工姓名，以小写形式展现</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">lower</span>(ename) <span class="keyword">as</span> ename <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">select</span> lcase(ename) <span class="keyword">as</span> ename <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><h4 id="截取字符串substr"><a href="#截取字符串substr" class="headerlink" title="截取字符串substr"></a>截取字符串substr</h4><p>语法：substr(‘被截取的字符串’, 起始下标, 截取长度)</p><p>有两种写法：<br>第一种：substr(‘被截取的字符串’, 起始下标, 截取长度)<br>第二种：substr(‘被截取的字符串’, 起始下标)，当第三个参数“截取长度”缺失时，截取到字符串末尾<br>注意：起始下标从1开始，不是从0开始。（1表示从左侧开始的第一个位置，-1表示从右侧开始的第一个位置。）</p><p>练习：找出员工名字中第二个字母是A的</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;_A%&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> substr(ename, <span class="number">2</span>, <span class="number">1</span>) <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318011938360.png" alt="image-20250318011938360"></p><h4 id="获取字符串长度length"><a href="#获取字符串长度length" class="headerlink" title="获取字符串长度length"></a>获取字符串长度length</h4><p>统计字节的数量，一个汉字是两个字节</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318012128010.png" alt="image-20250318012128010"></p><h4 id="获取字符的个数char-length"><a href="#获取字符的个数char-length" class="headerlink" title="获取字符的个数char_length"></a>获取字符的个数char_length</h4><p>统计字符的数量</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318012205421.png" alt="image-20250318012205421"></p><h4 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h4><p>语法：concat(‘字符串1’, ‘字符串2’, ‘字符串3’….)<br>拼接的字符串数量没有限制。</p><p>注意：在mysql8之前，双竖线||也是可以完成字符串拼接的。但在mysql8之后，||只作为逻辑运算符，不能再进行字符串拼接了。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;abc&#x27;</span> <span class="operator">||</span> <span class="string">&#x27;def&#x27;</span> <span class="operator">||</span> <span class="string">&#x27;xyz&#x27;</span>;</span><br></pre></td></tr></table></figure><p>mysql8之后，|| 只作为“或者”运算符，例如：找出工资高于3000或者低于900的员工姓名和薪资：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename, sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">3000</span> <span class="operator">||</span> sal <span class="operator">&lt;</span> <span class="number">900</span>;</span><br></pre></td></tr></table></figure><h4 id="去除字符串前后空白trim"><a href="#去除字符串前后空白trim" class="headerlink" title="去除字符串前后空白trim"></a>去除字符串前后空白trim</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> concat(<span class="built_in">trim</span>(<span class="string">&#x27;    abc    &#x27;</span>), <span class="string">&#x27;def&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318013135401.png" alt="image-20250318013135401"></p><p>默认是去除前后空白，也可以去除指定的前缀后缀，例如：<br>去除前置0</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">trim</span>(<span class="keyword">leading</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">from</span> <span class="string">&#x27;000111000&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318013446513.png" alt="image-20250318013446513"></p><p>去除后置0</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">trim</span>(<span class="keyword">trailing</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">from</span> <span class="string">&#x27;000111000&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318013530180.png" alt="image-20250318013530180"></p><p>前置0和后置0全部去除</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">trim</span>(<span class="keyword">both</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">from</span> <span class="string">&#x27;000111000&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318013626310.png" alt="image-20250318013626310"></p><h3 id="数字相关"><a href="#数字相关" class="headerlink" title="数字相关"></a>数字相关</h3><h4 id="rand-和rand-x"><a href="#rand-和rand-x" class="headerlink" title="rand()和rand(x)"></a>rand()和rand(x)</h4><p>rand()生成0到1的随机浮点数。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> rand();</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318013920466.png" alt="image-20250318013920466"></p><p>rand(x)生成0到1的随机浮点数，通过指定整数x来确定每次获取到相同的浮点值。<br>也就是给一个固定的值可以永远拿到一个固定随机数</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318014033448.png" alt="image-20250318014033448"></p><h4 id="round-x-和round-x-y-四舍五入"><a href="#round-x-和round-x-y-四舍五入" class="headerlink" title="round(x)和round(x,y)四舍五入"></a>round(x)和round(x,y)四舍五入</h4><p>round(x) 四舍五入，保留整数位，舍去所有小数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round(<span class="number">3.54</span>);#返回<span class="number">4</span></span><br></pre></td></tr></table></figure><p>round(x,y) 四舍五入，保留y位小数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round(<span class="number">3.55</span>,<span class="number">1</span>);#返回<span class="number">3.6</span></span><br></pre></td></tr></table></figure><h4 id="truncate-x-y-舍去"><a href="#truncate-x-y-舍去" class="headerlink" title="truncate(x, y)舍去"></a>truncate(x, y)舍去</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">truncate</span>(<span class="number">9.999</span>,<span class="number">2</span>);#返回<span class="number">9.99</span></span><br></pre></td></tr></table></figure><p>以上SQL表示保留两位小数，剩下的全部舍去。</p><h4 id="ceil与floor"><a href="#ceil与floor" class="headerlink" title="ceil与floor"></a>ceil与floor</h4><p>数字处理函数除了以上的之外，还有ceil和floor函数：</p><ul><li>ceil函数：返回大于或等于数值x的最小整数</li><li>floor函数：返回小于或等于数值x的最大整数</li></ul><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318015708126.png" alt="image-20250318015708126"></p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318015737077.png" alt="image-20250318015737077"></p><h3 id="空处理"><a href="#空处理" class="headerlink" title="空处理"></a>空处理</h3><p>null与任何数进行运算的结果都为null</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318021636300.png" alt="image-20250318021636300"></p><p>ifnull(x, y)，空处理函数，当x为NULL时，将x当做y处理。</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318021725200.png" alt="image-20250318021725200"></p><p>看这样一个需求：查询每个员工的年薪。（年薪 &#x3D; (月薪 + 津贴) * 12个月。注意：有的员工津贴comm是NULL。）</p><p>下面这样就可以把null转换成0，就可以正常显示</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal,((sal <span class="operator">+</span> ifnull(comm,<span class="number">0</span>)) <span class="operator">*</span> <span class="number">12</span>) <span class="keyword">as</span> yearsal <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318022223413.png" alt="image-20250318022223413"></p><h3 id="日期和时间相关函数"><a href="#日期和时间相关函数" class="headerlink" title="日期和时间相关函数"></a>日期和时间相关函数</h3><h4 id="获取当前日期和时间"><a href="#获取当前日期和时间" class="headerlink" title="获取当前日期和时间"></a>获取当前日期和时间</h4><p>now()和sysdate()的区别：</p><ul><li>now()：获取的是执行select语句的时刻。（select now()的这个select）</li><li>sysdate()：获取的是执行sysdate()函数的时刻。</li></ul><h4 id="获取当前日期"><a href="#获取当前日期" class="headerlink" title="获取当前日期"></a>获取当前日期</h4><p>获取当前日期有三种写法，掌握任意一种即可：</p><ul><li>curdate()</li><li>current_date()</li><li>current_date</li></ul><h4 id="获取当前时间"><a href="#获取当前时间" class="headerlink" title="获取当前时间"></a>获取当前时间</h4><p>获取档期时间有三种写法，掌握其中一种即可：</p><ul><li>curtime()</li><li>current_time()</li><li>current_time</li></ul><h4 id="获取单独的年、月、日、时、分、秒"><a href="#获取单独的年、月、日、时、分、秒" class="headerlink" title="获取单独的年、月、日、时、分、秒"></a>获取单独的年、月、日、时、分、秒</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">year</span>(now());</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">month</span>(now());</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">day</span>(now());</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">hour</span>(now());</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">minute</span>(now());</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">second</span>(now());</span><br></pre></td></tr></table></figure><p>注意：这些函数在使用的时候，需要传递一个日期参数给它，它可以获取到你给定的这个日期相关的年、月、日、时、分、秒的信息。<br>一次性提取一个给定日期的“年月日”部分，可以使用date()函数，例如：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318023616736.png" alt="image-20250318023616736"></p><p>一次性提取一个给定日期的“时分秒”部分，可以使用time()函数，例如：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318023628620.png" alt="image-20250318023628620"></p><h4 id="date-add函数"><a href="#date-add函数" class="headerlink" title="date_add函数"></a>date_add函数</h4><p>date_add函数的作用：给指定的日期添加间隔的时间，从而得到一个新的日期。<br>date_add函数的语法格式：date_add(日期, interval expr 单位)，例如：</p><p>以’2023-01-03’为基准，间隔3天之后的日期：’2023-01-06’</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318024025267.png" alt="image-20250318024025267"></p><p>以’2023-01-03’为基准，间隔3个月之后的日期：’2023-04-03’<br>详细解释一下这个函数的相关参数：</p><ul><li>日期：一个日期类型的数据</li><li>interval：关键字，翻译为“间隔”，固定写法</li><li>expr：指定具体的间隔量，一般是一个数字。<strong>也可以为负数，如果为负数，效果和date_sub函数相同</strong>。就是减多少天的意思</li><li>单位：<ul><li>year：年</li><li>month：月</li><li>day：日</li><li>hour：时</li><li>minute：分</li><li>second：秒</li><li>microsecond：微秒（1秒等于1000毫秒，1毫秒等于1000微秒）</li><li>week：周</li><li>quarter：季度</li></ul></li></ul><p>另外，单位也可以采用复合型单位，例如：</p><ul><li>SECOND_MICROSECOND</li><li>MINUTE_MICROSECOND</li><li>MINUTE_SECOND：几分几秒之后</li><li>HOUR_MICROSECOND</li><li>HOUR_SECOND</li><li>HOUR_MINUTE：几小时几分之后</li><li>DAY_MICROSECOND</li><li>DAY_SECOND</li><li>DAY_MINUTE</li><li>DAY_HOUR：几天几小时之后</li><li>YEAR_MONTH：几年几个月之后</li></ul><p>如果单位采用复合型的话，expr该怎么写呢？假设要表示3年2月之后</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318025104375.png" alt="image-20250318025104375"></p><h4 id="date-format日期格式化函数"><a href="#date-format日期格式化函数" class="headerlink" title="date_format日期格式化函数"></a>date_format日期格式化函数</h4><p>将日期转换成具有某种格式的日期字符串，通常用在查询操作当中。（date类型转换成char类型）<br>语法格式：date_format(日期, ‘日期格式’)<br>该函数有两个参数：</p><ul><li>第一个参数：日期。这个参数就是即将要被格式化的日期。类型是date类型。</li><li>第二个参数：指定要格式化的格式字符串。<ul><li>%Y：四位年份</li><li>%y：两位年份</li><li>%m：月份（1..12）</li><li>%d：日（1..30）</li><li>%H：小时（0..23）</li><li>%i：分（0..59）</li><li>%s：秒（0..59）</li></ul></li></ul><p>例如：获取当前系统时间，让其以这个格式展示：2000-10-11 20:15:30</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318160626788.png" alt="image-20250318160626788"></p><p>注意：在mysql当中，默认的日期格式就是：%Y-%m-%d %H:%i:%s，所以当你直接输出日期数据的时候， 底层会自动转换成该格式的字符串：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318160645554.png" alt="image-20250318160645554"></p><p>如果是需要展示两位年份，年月日之间用&#x2F;隔开：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal,date_format(hiredate,<span class="string">&#x27;%y/%m/%d&#x27;</span>) <span class="keyword">as</span> hiredate <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318161124364.png" alt="image-20250318161124364"></p><h4 id="str-to-date函数"><a href="#str-to-date函数" class="headerlink" title="str_to_date函数"></a>str_to_date函数</h4><p>该函数的作用是将char类型的日期字符串转换成日期类型date，常使用在插入和修改操作当中。（char类型转换成date类型）</p><p>我们要给表插入一条数据：姓名zhangsan，生日85年10月1日，执行以下insert语句：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318161819328.png" alt="image-20250318161819328"></p><p>错误原因：日期值不正确。意思是：birth字段需要一个日期，你给的这个字符串’10&#x2F;01&#x2F;1985’我识别不了。这种情况下，我们就可以使用str_to_date函数进行类型转换：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318161902772.png" alt="image-20250318161902772"></p><p>当然，如果你提供的日期字符串格式能够被mysql解析，str_to_date函数是可以省略的，底层会自动调用该函数进行类型转换：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318161919794.png" alt="image-20250318161919794"></p><h4 id="dayofweek、dayofmonth、dayofyear函数"><a href="#dayofweek、dayofmonth、dayofyear函数" class="headerlink" title="dayofweek、dayofmonth、dayofyear函数"></a>dayofweek、dayofmonth、dayofyear函数</h4><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318162215181.png" alt="image-20250318162215181"></p><p>意思是现在的周二是一周的第三天（周日是第一天）</p><p>dayofweek：一周中的第几天（1<del>7），周日是1，周六是7。<br>dayofmonth：一个月中的第几天（1</del>31）<br>dayofyear：一年中的第几天（1~366）</p><h4 id="last-day函数"><a href="#last-day函数" class="headerlink" title="last_day函数"></a>last_day函数</h4><p>获取给定日期所在月的最后一天的日期：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318162509858.png" alt="image-20250318162509858"></p><h4 id="datediff函数"><a href="#datediff函数" class="headerlink" title="datediff函数"></a>datediff函数</h4><p>计算两个日期之间所差天数：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318162616711.png" alt="image-20250318162616711"></p><h4 id="timediff函数"><a href="#timediff函数" class="headerlink" title="timediff函数"></a>timediff函数</h4><p>计算两个日期所差时间，例如日期1和日期2所差10:20:30，表示差10小时20分钟30秒。</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318162654964.png" alt="image-20250318162654964"></p><h3 id="if函数"><a href="#if函数" class="headerlink" title="if函数"></a>if函数</h3><p>如果条件为TRUE则返回“YES”，如果条件为FALSE则返回“NO”：类似三目运算符</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IF(<span class="number">500</span><span class="operator">&lt;</span><span class="number">1000</span>, &quot;YES&quot;, &quot;NO&quot;);</span><br></pre></td></tr></table></figure><p>例如：如果工资高于3000，则输出1，反之则输出0</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal,if(sal<span class="operator">&gt;</span><span class="number">3000</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="keyword">as</span> <span class="keyword">result</span> <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p>再例如：如果名字是SMITH的，工资上调10%，其他员工工资正常显示。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,if(ename<span class="operator">=</span><span class="string">&#x27;smith&#x27;</span>, sal <span class="operator">*</span> <span class="number">1.1</span>, sal) <span class="keyword">as</span> sal <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p>再例如：工作岗位是MANAGER的工资上调10%，是SALESMAN的工资上调20%，其他岗位工资正常。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal,job,if(job<span class="operator">=</span><span class="string">&#x27;manager&#x27;</span>, sal<span class="operator">*</span><span class="number">1.1</span>,if(job<span class="operator">=</span><span class="string">&#x27;salesman&#x27;</span>, sal<span class="operator">*</span><span class="number">1.2</span>, sal)) <span class="keyword">as</span> newsal <span class="keyword">from</span> emp;#如果前面的不是manager，后面的if就会执行，去看看是不是salesman，其他的正常</span><br></pre></td></tr></table></figure><p>上面这个需求也可以使用：case.. when.. then.. when.. then.. else.. end来完成：类似于Switch</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318171137283.png" alt="image-20250318171137283"></p><h3 id="cast函数"><a href="#cast函数" class="headerlink" title="cast函数"></a>cast函数</h3><p>cast函数用于将值从一种数据类型转换为表达式中指定的另一种数据类型<br>语法：cast(值 as 数据类型)<br>例如：cast(‘2020-10-11’ as date)，表示将字符串’2020-10-11’转换成日期date类型。<br>在使用cast函数时，可用的数据类型包括：</p><ul><li>date：日期类型</li><li>time：时间类型</li><li>datetime：日期时间类型</li><li>signed：有符号的int类型（有符号指的是正数负数）</li><li>char：定长字符串类型（varchar是可变长字符串）</li><li>decimal：浮点型</li></ul><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318184912102.png" alt="image-20250318184912102"></p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318184918594.png" alt="image-20250318184918594"></p><p>保留5位有效数字且有一个小数位，有效数字是不包含0的</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250318213501887.png" alt="image-20250318213501887"></p><h3 id="加密函数"><a href="#加密函数" class="headerlink" title="加密函数"></a>加密函数</h3><p>md5函数，可以将给定的字符串经过md5算法进行加密处理，字符串经过加密之后会生成一个固定长度32位的字符串，md5加密之后的密文通常是不能解密的：</p><h3 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h3><p>具体可以看企业真题</p><p>MySQL 8.0及以上版本中支持如下常用的窗口函数：</p><ol><li><p>ROW_NUMBER()：排名函数，返回当前结果集中每个行的行号；</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">asc</span>)</span><br></pre></td></tr></table></figure></li><li><p>RANK()：排名函数，计算分组结果中的排名，相同的行排名相同且没有空缺，下一个行排名跳过空缺；</p></li><li><p>DENSE_RANK()：排名函数，计算分组结果中的排名，相同的行排名相同，排名连续，没有空缺；</p></li><li><p>NTILE()：将分组结果等分为指定的组数，计算每组的大小；</p></li><li><p>LAG()：返回分组内前一行的值；</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">lag</span>(指定字段) ovar(排序规则)</span><br><span class="line"></span><br><span class="line">例如：<span class="built_in">lag</span>(sal) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">asc</span>)</span><br></pre></td></tr></table></figure></li><li><p>LEAD()：返回分组内后一行的值；</p><p>语法同上</p></li><li><p>FIRST_VALUE()：返回分组内第一个值；</p></li><li><p>LAST_VALUE()：返回分组内最后一个值；</p></li><li><p>AVG()、SUM()、COUNT()、MIN()、MAX()：聚合函数，可以配合OVER()进行窗口操作。</p></li></ol><p>需要注意的是，MySQL的窗口</p><h2 id="分组函数"><a href="#分组函数" class="headerlink" title="分组函数"></a>分组函数</h2><p><strong>分组函数的执行原则：先分组，然后对每一组数据执行分组函数。如果没有分组语句group by的话，整张表的数据自成一组。</strong></p><p>前面提到的数据处理函数是单行处理函数，输入一条就输出一条。</p><p>分组函数包括五个：（不能用在where后面）</p><ul><li>max：最大值</li><li>min：最小值</li><li>avg：平均值</li><li>sum：求和</li><li>count：计数</li></ul><h3 id="max"><a href="#max" class="headerlink" title="max"></a>max</h3><p><strong>找出员工的最高薪资</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(sal) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><h3 id="min"><a href="#min" class="headerlink" title="min"></a>min</h3><p><strong>找出员工的最低工资</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(sal) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><h3 id="avg"><a href="#avg" class="headerlink" title="avg"></a>avg</h3><p><strong>计算员工的平均薪资</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><h3 id="sum"><a href="#sum" class="headerlink" title="sum"></a>sum</h3><p><strong>计算员工的工资和</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><h4 id="计算员工的津贴之和"><a href="#计算员工的津贴之和" class="headerlink" title="计算员工的津贴之和"></a><strong>计算员工的津贴之和</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(comm) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p>重点：所有的分组函数都是自动忽略NULL的。</p><h3 id="count"><a href="#count" class="headerlink" title="count"></a>count</h3><p><strong>统计员工人数</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(ename) <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p>count(*)和count(1)的效果一样，统计该组中总记录行数。<br>count(ename)统计的是这个ename字段中不为NULL个数总和。<br>count (*)记录的是所有的数一共有多少行，不会忽略null<br>例如：count(comm) 结果是 4，而不是14</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(comm) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p><strong>统计岗位数量</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> job) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><h3 id="分组函数组合使用"><a href="#分组函数组合使用" class="headerlink" title="分组函数组合使用"></a>分组函数组合使用</h3><p>select count(*),max(sal),min(sal),avg(sal),sum(sal) from emp;</p><h3 id="分组函数注意事项"><a href="#分组函数注意事项" class="headerlink" title="分组函数注意事项"></a>分组函数注意事项</h3><p><strong>分组函数不能直接使用在where子句当中</strong></p><p>select ename,job from emp where sal &gt; avg(sal); 这个会报错的<br>原因：分组的行为是在where执行之后才开始的。</p><h2 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h2><h3 id="group-by"><a href="#group-by" class="headerlink" title="group by"></a>group by</h3><p>按照某个字段分组，或者按照某些字段联合分组。注意：group by的执行是在where之后执行。<br>语法：<br>group by 字段<br>group by 字段1,字段2,字段3….<br><strong>找出每个岗位的平均薪资</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> job, <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> job;</span><br></pre></td></tr></table></figure><p><strong>找出每个部门最高工资</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno,<span class="built_in">max</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno;</span><br></pre></td></tr></table></figure><p><strong>找出每个部门不同岗位的平均薪资</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno,job,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno,job;</span><br></pre></td></tr></table></figure><p><strong>当select语句中有group by的话，select后面只能跟分组函数或参加分组的字段</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,deptno,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno; <span class="operator">/</span><span class="operator">/</span> 这个<span class="keyword">SQL</span>多了个ename，执行后会报错。</span><br></pre></td></tr></table></figure><h3 id="having"><a href="#having" class="headerlink" title="having"></a>having</h3><p>having写在group by的后面，如果不合group by一起用会报错，当你对分组之后的数据不满意，可以继续通过<strong>having对分组之后的数据进行过滤</strong>。<br><strong>where的过滤是在分组前进行过滤。</strong><br><strong>使用原则：尽量在where中过滤，实在不行，再使用having。越早过滤效率越高。</strong></p><p>*<em>找出除20部分之外，其它部门的平均薪资。</em></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">where</span> deptno<span class="operator">&lt;&gt;</span><span class="number">20</span> <span class="keyword">group</span> <span class="keyword">by</span> deptno; <span class="operator">/</span><span class="operator">/</span> 建议</span><br><span class="line"><span class="keyword">select</span> deptno,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno <span class="keyword">having</span> deptno <span class="operator">&lt;&gt;</span> <span class="number">20</span>; <span class="operator">/</span><span class="operator">/</span> 不建议</span><br></pre></td></tr></table></figure><p><strong>查询每个部门平均薪资，找出平均薪资高于2000的。</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno <span class="keyword">having</span> <span class="built_in">avg</span>(sal) <span class="operator">&gt;</span> <span class="number">2000</span>;</span><br></pre></td></tr></table></figure><h3 id="组内排序"><a href="#组内排序" class="headerlink" title="组内排序"></a>组内排序</h3><p>案例：找出每个工作岗位的工资排名在前两名的。<br>substring_index函数的使用：也就是截到点出现的第几次</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319030731267.png" alt="image-20250319030731267"></p><p>group_concat函数的使用：字符串拼接，分组后对每一组的empno进行拼接</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319031020846.png" alt="image-20250319031020846"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> substring_index(group_concat(empno <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span>), <span class="string">&#x27;,&#x27;</span>, <span class="number">2</span>) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> job;</span><br></pre></td></tr></table></figure><h3 id="MySQL行转列"><a href="#MySQL行转列" class="headerlink" title="MySQL行转列"></a>MySQL行转列</h3><p>MySQL行转列又叫做<strong>数据透视</strong>。什么叫做行转列？将原本横向排列的数据透视成纵向排列的数据，进而进行计算、分析、展示等操作。</p><p>使用case when+group by完成</p><p>例子可以看企业真题</p><h2 id="总结单表的DQL语句"><a href="#总结单表的DQL语句" class="headerlink" title="总结单表的DQL语句"></a>总结单表的DQL语句</h2><p>select …5<br>from …1<br>where …2<br>group by …3<br>having …4<br>order by …6<br>重点掌握一个完整的DQL语句执行顺序。</p><h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><h3 id="什么是连接查询"><a href="#什么是连接查询" class="headerlink" title="什么是连接查询"></a>什么是连接查询</h3><ol><li>从一张表中查询数据称为单表查询。</li><li>从两张或更多张表中联合查询数据称为多表查询，又叫做连接查询。</li><li>什么时候需要使用连接查询？<ol><li>比如这样的需求：员工表中有员工姓名，部门表中有部门名字，要求查询每个员工所在的部门名字，这个时候就需要连接查询。</li></ol></li></ol><h3 id="连接查询的分类"><a href="#连接查询的分类" class="headerlink" title="连接查询的分类"></a>连接查询的分类</h3><ol><li>根据语法出现的年代进行分类：<ol><li>SQL92（这种语法很少用，可以不用学。）</li><li>SQL99（我们主要学习这种语法。）</li></ol></li><li>根据连接方式的不同进行分类：<ol><li>内连接<ol><li>等值连接</li><li>非等值连接</li><li>自连接</li></ol></li><li>外连接<ol><li>左外连接（左连接）</li><li>右外连接（右连接）</li></ol></li><li>全连接</li></ol></li></ol><h3 id="笛卡尔积现象"><a href="#笛卡尔积现象" class="headerlink" title="笛卡尔积现象"></a>笛卡尔积现象</h3><ol><li>当两张表进行连接查询时，如果没有任何条件进行过滤，最终的查询结果条数是两张表条数的乘积。为了避免笛卡尔积现象的发生，需要添加条件进行筛选过滤。</li><li>需要注意：添加条件之后，虽然避免了笛卡尔积现象，但是匹配的次数没有减少。</li><li>为了SQL语句的可读性，为了执行效率，建议给表起别名。</li></ol><p>例子：拿员工姓名和部门名称做连接</p><p>emp e是给emp表起个别名叫e，然后e的ename</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319160438060.png" alt="image-20250319160438060"></p><p>只能拿员工名字与四个部门名挨个匹配，员工14个与部门4个不能直接去连</p><h3 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h3><h4 id="什么叫内连接"><a href="#什么叫内连接" class="headerlink" title="什么叫内连接"></a>什么叫内连接</h4><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319164759300.png" alt="image-20250319164759300"></p><p>满足条件的记录才会出现在结果集中。</p><h4 id="内连接之等值连接"><a href="#内连接之等值连接" class="headerlink" title="内连接之等值连接"></a>内连接之等值连接</h4><p>连接时，条件为等量关系。<br>案例：查询每个员工所在的部门名称，要求显示员工名、部门名。</p><p>emp取名e，dept取名d，join是连接，on加条件</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">e.ename,d.dname</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">emp e</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span></span><br><span class="line">dept d</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">e.deptno <span class="operator">=</span> d.deptno;</span><br><span class="line">如果要找工资大于<span class="number">2000</span>的在后面加上<span class="keyword">where</span>就可以</span><br><span class="line"><span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">2000</span>;</span><br></pre></td></tr></table></figure><p>注意：inner可以省略。</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319170439319.png">‘</p><h4 id="内连接之非等值连接"><a href="#内连接之非等值连接" class="headerlink" title="内连接之非等值连接"></a>内连接之非等值连接</h4><p>连接时，条件是非等量关系。<br>案例：查询每个员工的工资等级，要求显示员工名、工资、工资等级。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">e.ename,e.sal,s.grade</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">emp e</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">salgrade s</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">e.sal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;</span><br><span class="line">#e的工资介于s的最高和最低之间的,注意小的要在前面</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319171435310.png" alt="image-20250319171435310"></p><h4 id="内连接之自连接"><a href="#内连接之自连接" class="headerlink" title="内连接之自连接"></a>内连接之自连接</h4><p>连接时，一张表看做两张表，自己和自己进行连接。<br>案例：找出每个员工的直属领导，要求显示员工名、领导名。</p><p>必须把等量关系先思考清楚：员工.领导编号 &#x3D; 领导.员工编号，分成两个表，等于就把他们放在一起</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.ename 员工, l.ename 领导 <span class="keyword">from</span> emp e <span class="keyword">join</span> emp l <span class="keyword">on</span> e.mgr <span class="operator">=</span> l.empno;</span><br></pre></td></tr></table></figure><h3 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h3><h4 id="什么叫外连接"><a href="#什么叫外连接" class="headerlink" title="什么叫外连接"></a>什么叫外连接</h4><p>内连接是满足条件的记录查询出来。也就是两张表的交集。<br>外连接是除了满足条件的记录查询出来，再将其中一张表的记录全部查询出来，另一张表如果没有与之匹配的记录，自动模拟出NULL与其匹配。<br>左外连接：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319233111561.png" alt="image-20250319233111561"></p><p>右外连接：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250319233118741.png" alt="image-20250319233118741"></p><h4 id="外连接之左外连接（左连接）"><a href="#外连接之左外连接（左连接）" class="headerlink" title="外连接之左外连接（左连接）"></a>外连接之左外连接（左连接）</h4><p>案例：查询所有部门信息，并且找出每个部门下的员工。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.ename,d.dname <span class="keyword">from</span> emp e <span class="keyword">join</span> dept d <span class="keyword">on</span> e.deptno <span class="operator">=</span> d.deptno;</span><br><span class="line">#这是内连接</span><br><span class="line">#把ename和dname改成<span class="operator">*</span>就可以显示所有信息</span><br><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>,d.<span class="operator">*</span> <span class="keyword">from</span> emp e <span class="keyword">join</span> dept d <span class="keyword">on</span> e.deptno <span class="operator">=</span> d.deptno;</span><br></pre></td></tr></table></figure><p>如果要把inner join右边的全显示就是右外连接</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>,d.<span class="operator">*</span> <span class="keyword">from</span> emp e <span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> dept d <span class="keyword">on</span> e.deptno <span class="operator">=</span> d.deptno;</span><br></pre></td></tr></table></figure><p>如果把上面的改成左外连接</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>,d.<span class="operator">*</span> <span class="keyword">from</span> dept d <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> emp e <span class="keyword">on</span> e.deptno <span class="operator">=</span> d.deptno;</span><br></pre></td></tr></table></figure><p>注意：outer可以省略。<br>任何一个左连接都可以写作右连接。</p><p>案例：找出所有员工的上级领导，要求显示员工名和领导名。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.ename 员工,l.ename 领导 <span class="keyword">from</span> emp e <span class="keyword">left</span> <span class="keyword">join</span> emp l <span class="keyword">on</span> e.mgr<span class="operator">=</span>l.empno;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250320000335238.png" alt="image-20250320000335238"></p><h4 id="外连接之右外连接（右连接）"><a href="#外连接之右外连接（右连接）" class="headerlink" title="外连接之右外连接（右连接）"></a>外连接之右外连接（右连接）</h4><p>看上面</p><h3 id="全连接"><a href="#全连接" class="headerlink" title="全连接"></a>全连接</h3><p>什么是全连接？<br>MySQL不支持full join。oracle数据库支持。</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250320002801394.png" alt="image-20250320002801394"></p><h3 id="多张表连接"><a href="#多张表连接" class="headerlink" title="多张表连接"></a>多张表连接</h3><p>三张表甚至更多张表如何进行表连接<br>案例：找出每个员工的部门，并且要求显示每个员工的薪资等级。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line"> e.ename,d.dname,s.grade </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line"> emp e </span><br><span class="line"><span class="keyword">join</span>#上下两张表关联 </span><br><span class="line"> dept d </span><br><span class="line"><span class="keyword">on</span> #关联条件</span><br><span class="line"> e.deptno <span class="operator">=</span> d.deptno </span><br><span class="line"><span class="keyword">join</span> #继续关联</span><br><span class="line"> salgrade s </span><br><span class="line"><span class="keyword">on</span> </span><br><span class="line"> e.sal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;</span><br></pre></td></tr></table></figure><h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><h3 id="什么是子查询"><a href="#什么是子查询" class="headerlink" title="什么是子查询"></a>什么是子查询</h3><ol><li>select语句中嵌套select语句就叫做子查询。</li><li>select语句可以嵌套在哪里？<ol><li>where后面、from后面、select后面都是可以的。</li></ol></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ..(<span class="keyword">select</span>)..</span><br><span class="line"><span class="keyword">from</span> ..(<span class="keyword">select</span>)..</span><br><span class="line"><span class="keyword">where</span> ..(<span class="keyword">select</span>)..</span><br></pre></td></tr></table></figure><h3 id="where后面使用子查询"><a href="#where后面使用子查询" class="headerlink" title="where后面使用子查询"></a>where后面使用子查询</h3><p>案例：找出高于平均薪资的员工姓名和薪资。<br>错误的示范：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="built_in">avg</span>(sal);</span><br></pre></td></tr></table></figure><p>错误原因：where后面不能直接使用分组函数。<br>可以使用子查询：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#第一步：找出平均薪资</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp;#返回了<span class="number">2073.214286</span></span><br><span class="line">#第二步：找出高于平均薪资的员工</span><br><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">2073.214286</span>;</span><br><span class="line">#两个结合起来就可以了，后面的平均薪资替换上</span><br><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> (<span class="keyword">select</span> <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp);</span><br></pre></td></tr></table></figure><h3 id="from后面使用子查询"><a href="#from后面使用子查询" class="headerlink" title="from后面使用子查询"></a>from后面使用子查询</h3><p>小窍门：from后面的子查询可以看做一张临时表。<br>案例：找出每个部门的平均工资的等级。<br>第一步：先找出每个部门平均工资。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno, <span class="built_in">avg</span>(sal) avgsal <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250320013321290.png" alt="image-20250320013321290"></p><p>第二步：将以上查询结果当做临时表t，t表和salgrade表进行连接查询。条件：t.avgsal between s.losal and s.hisal</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> salgrade;#是salgrade表</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> t.<span class="operator">*</span>,s.grade <span class="keyword">from</span> t <span class="keyword">join</span> salgrade s <span class="keyword">on</span> t.avgsal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;#把salgrade当做s表，然后t的avgsal去进行对比，不过这里会报错，因为没有表t，就直接把上面的代码复制进去就行</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> t.<span class="operator">*</span>,s.grade <span class="keyword">from</span> (<span class="keyword">select</span> deptno, <span class="built_in">avg</span>(sal) avgsal <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno) t <span class="keyword">join</span> salgrade s <span class="keyword">on</span> t.avgsal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;</span><br></pre></td></tr></table></figure><h3 id="select后面使用子查询"><a href="#select后面使用子查询" class="headerlink" title="select后面使用子查询"></a>select后面使用子查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.ename,(<span class="keyword">select</span> d.dname <span class="keyword">from</span> dept d <span class="keyword">where</span> e.deptno <span class="operator">=</span> d.deptno) <span class="keyword">as</span> dname <span class="keyword">from</span> emp e;</span><br></pre></td></tr></table></figure><h3 id="exists、not-exists"><a href="#exists、not-exists" class="headerlink" title="exists、not exists"></a>exists、not exists</h3><p>在 MySQL 数据库中，EXISTS（存在）用于检查子查询的查询结果行数是否大于0。如果子查询的查询结果行数大于0，则 EXISTS 条件为真。（即存在查询结果则是true。）</p><p>主要应用场景：</p><ul><li>EXISTS 可以与 SELECT、UPDATE、DELETE 一起使用，用于检查另一个查询是否返回任何行；</li><li>EXISTS 可以用于验证条件子句中的表达式是否存在；</li><li>EXISTS 常用于子查询条件过滤，例如查询有订单的用户等。</li></ul><p>在另一个文档里给出了创建数据库的代码。</p><p>现在我们来看一个简单的案例，假设我们要查询先前有过订单的顾客，而订单信息保存在 t_order 表中，顾客信息保存在 t_customer 表中。我们可以使用以下 sql 语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#用<span class="keyword">in</span>去实现</span><br><span class="line"><span class="keyword">select</span> customer_id <span class="keyword">from</span> t_order;#是查询顾客里订单的id</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> custome_id <span class="keyword">from</span> t_order;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> customer_id <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> customer_id <span class="keyword">from</span> t_order);</span><br><span class="line"></span><br><span class="line">#用<span class="keyword">exists</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer c <span class="keyword">where</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_order o <span class="keyword">where</span> o.customer_id<span class="operator">=</span>c.customer_id);</span><br><span class="line"></span><br><span class="line">#用<span class="keyword">not</span> <span class="keyword">exists</span>这里就会返回为<span class="literal">false</span>的，也就是不相等的结果</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer c <span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_order o <span class="keyword">where</span> o.customer_id<span class="operator">=</span>c.customer_id);</span><br></pre></td></tr></table></figure><p>exists后面的子查询如果是为true，就可以去查询符合条件的</p><h3 id="in和exists区别（可能面试）"><a href="#in和exists区别（可能面试）" class="headerlink" title="in和exists区别（可能面试）"></a>in和exists区别（可能面试）</h3><p>IN 和 EXISTS 都是用于关系型数据库查询的操作符。不同之处在于：</p><ol><li>IN 操作符是根据指定列表中的值来判断是否满足条件，而 EXISTS 操作符则是根据子查询的结果是否有返回记录集来判断。 </li><li>in的前面有字段名，然后会把小括号里的值一个一个进行判断，exists前面没有字段名，根据整个结果的返回值判断</li><li>EXISTS 操作符通常比 IN 操作符更快，尤其是在子查询返回记录数很大的情况下。因为 EXISTS 只需要判断是否存在符合条件的记录，而 IN 操作符需要比对整个列表，因此执行效率相对较低。 </li><li>IN 操作符可同时匹配多个<strong>值</strong>，而 EXISTS 只能匹配一组<strong>条件</strong>。</li></ol><h2 id="union-union-all"><a href="#union-union-all" class="headerlink" title="union&amp;union all"></a>union&amp;union all</h2><p>不管是union还是union all都可以将两个查询结果集进行合并。<br>union会对合并之后的查询结果集进行去重操作。<br>union all是直接将查询结果集合并，不进行去重操作。（union all和union都可以完成的话，优先选择union all，union all因为不需要去重，所以效率高一些。）</p><p>案例：查询工作岗位是MANAGER和SALESMAN的员工。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> job<span class="operator">=</span><span class="string">&#x27;MANAGER&#x27;</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> job<span class="operator">=</span><span class="string">&#x27;SALESMAN&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>以上案例采用or也可以完成，那or和union all有什么区别？考虑走索引优化之类的选择union all，其它选择or。</strong></p><p>两个结果集合并时，列数量要相同：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250320024021757.png" alt="image-20250320024021757"></p><h2 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h2><ol><li>limit作用：查询第几条到第几条的记录。通常是因为表中数据量太大，需要分页显示。</li><li>limit语法格式：<ol><li>limit 开始下标, 长度</li></ol></li><li>案例：查询员工表前5条记录</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp limit <span class="number">0</span>, <span class="number">5</span>;</span><br></pre></td></tr></table></figure><p>如果下标是从0开始，可以简写为：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp limit <span class="number">5</span>;</span><br></pre></td></tr></table></figure><ol start="4"><li>查询工资排名在前5名的员工（limit是在order by执行之后才会执行的）</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span> limit <span class="number">5</span>;</span><br></pre></td></tr></table></figure><ol start="5"><li>通用的分页sql</li></ol><p>假设每页显示3条记录：pageSize &#x3D; 3<br>第1页：limit 0, 3<br>第2页：limit 3, 3<br>第3页：limit 6, 3<br>第pageNo页：limit (pageNo - 1)*pageSize, pageSize</p><p>pageNo就是当前页，-1获得上一页，然后乘页需要的数量</p><h2 id="35个DQL练手题"><a href="#35个DQL练手题" class="headerlink" title="35个DQL练手题"></a>35个DQL练手题</h2><h1 id="第05章-表相关"><a href="#第05章-表相关" class="headerlink" title="第05章 表相关"></a>第05章 表相关</h1><h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><p>语法格式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> 表名(</span><br><span class="line">  字段名<span class="number">1</span> 数据类型,</span><br><span class="line">  字段名<span class="number">2</span> 数据类型,</span><br><span class="line">  字段名<span class="number">3</span> 数据类型,</span><br><span class="line">  ......</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>例如：创建学生表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_student(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">10</span>),</span><br><span class="line">  gender <span class="type">char</span>(<span class="number">1</span>) <span class="keyword">default</span> <span class="string">&#x27;男&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h2><p>语法格式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> 表名(字段名<span class="number">1</span>, 字段名<span class="number">2</span>, 字段名<span class="number">3</span>,......) <span class="keyword">values</span> (值<span class="number">1</span>,值<span class="number">2</span>,值<span class="number">3</span>,......);</span><br></pre></td></tr></table></figure><p>字段名和值要一一对应。类型要一一对应，数量要一一对应。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> t_user(<span class="keyword">no</span>,name,gender) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;男&#x27;</span>);</span><br></pre></td></tr></table></figure><p>只要插入成功就会让数据多一行</p><p>字段名也可以省略，如果字段名省略就表示把所有字段名都写上去了，并且顺序和建表时的顺序相同。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> t_user <span class="keyword">values</span>(<span class="number">6</span>,<span class="string">&#x27;zhaoliu&#x27;</span>,<span class="string">&#x27;男&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h2><p>语法格式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> 表名;</span><br></pre></td></tr></table></figure><p>判断是否存在这个表，如果存在则删除。避免不存在时的报错。</p><h2 id="MySQL数据类型"><a href="#MySQL数据类型" class="headerlink" title="MySQL数据类型"></a>MySQL数据类型</h2><p>MySQL 的数据类型可以分为整数类型、浮点数类型、定点数类型、日期和时间类型、字符串类型、二进制类型等。</p><h3 id="整数类型"><a href="#整数类型" class="headerlink" title="整数类型"></a>整数类型</h3><p>tinyint：1个字节（微小整数）<br>smallint：2个字节（小整数）<br>mediumint：3个字节（中等大小的整数）<br><strong>int（integer）：4个字节（普通大小整数）</strong><br><strong>bigint：8个字节（大整数）</strong></p><h3 id="浮点数类型"><a href="#浮点数类型" class="headerlink" title="浮点数类型"></a>浮点数类型</h3><p>float：4个字节，单精度（最多5位小数）<br><strong>double：8个字节，双精度（最多16位小数）</strong></p><h3 id="定点数类型"><a href="#定点数类型" class="headerlink" title="定点数类型"></a>定点数类型</h3><p>decimal：定点数类型。底层实际上采用字符串的形式存储数字。<br>语法：decimal(m, d)<br>例如：decimal(3, 2) 表示3个有效数字，2个小数。（有效数字最多65个，小数位最多30个）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#比如在创表的时候写上a <span class="type">decimal</span>(<span class="number">3</span>,<span class="number">2</span>)</span><br><span class="line">#然后插入数据</span><br><span class="line"><span class="keyword">insert into</span> xxx(a) <span class="keyword">values</span>(<span class="number">10</span>);#<span class="number">10</span>要是保存就是<span class="number">10.00</span>，会超出<span class="number">3</span>有效数字</span><br><span class="line"><span class="keyword">insert into</span> xxx(a) <span class="keyword">values</span>(<span class="number">1.123456789</span>);#这里的小数会四舍五入<span class="number">1.12</span></span><br></pre></td></tr></table></figure><h3 id="日期和时间类型"><a href="#日期和时间类型" class="headerlink" title="日期和时间类型"></a>日期和时间类型</h3><p>year：1个字节，只存储年，格式YYYY<br>time：3个字节，只存储时间，格式HH:MM:SS &#x2F; HHMMSS<br>date：3个字节，只存储年月日，格式：YYYY-MM-DD<br>datetime：8个字节，存储年月日+时分秒，格式：YYYY-MM-DD HH:MM:SS（从公元1000年<del>公元9999年）<br>timestamp：4个字节，存储年月日+时分秒，格式：YYYY-MM-DD HH:MM:SS（从公元1980年</del>公元2040年）或者格式为 YYYYMMDDHHMMSS（采用这种格式不需要使用单引号，当然你使用单引号也可以）</p><h3 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h3><h4 id="char"><a href="#char" class="headerlink" title="char"></a>char</h4><p>**char(m)：**m长度是0~255个字符</p><p>固定长度字符串，在定义时指定字符串列长。当保存时，在右侧填充空格以达到指定的长度。插入的字符长度大于给定的就会报错</p><h4 id="varchar"><a href="#varchar" class="headerlink" title="varchar"></a>varchar</h4><p>**varchar(m)：**m长度是0~16383个字符<br>长度可变的字符串。varchar 的最大实际长度由最长的行的大小和使用的字符集确定，而实际占用的空间为字符串的实际长度加 1。</p><p>例如，varchar(50) 定义了一个最大长度为 50 的字符串，如果插入的字符串只有 10 个字符，<strong>则实际存储的字符串为 10 个字符和一个字符串结束字符</strong>。varchar在值保存和检索时尾部的空格仍保留。</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250320162314858.png" alt="image-20250320162314858"></p><h4 id="text"><a href="#text" class="headerlink" title="text"></a>text</h4><p><strong>text类型：</strong></p><ul><li>tinytext 表示长度为 255字符的 TEXT 列。</li><li>text 表示长度为 65535字符的 TEXT 列。</li><li>mediumtext 表示长度为 16777215字符的 TEXT 列。</li><li>longtext 表示长度为 4294967295 或 4GB 字符的 TEXT 列。</li></ul><h4 id="enum"><a href="#enum" class="headerlink" title="enum"></a>enum</h4><p>这个和下面的set都是输入的值只能是规定的那几个</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_data_type08(</span><br><span class="line">season enum(<span class="string">&#x27;spring&#x27;</span>,<span class="string">&#x27;summer&#x27;</span>)#插入时就只能插其中的一个</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><strong>enum类型：</strong></p><ul><li>语法：&lt;字段名&gt; enum(‘值1’,’值2’,…)</li><li>该字段插入值时，只能是指定的枚举值。</li></ul><h4 id="set"><a href="#set" class="headerlink" title="set"></a>set</h4><p><strong>set类型：</strong></p><ul><li>语法：&lt;字段名&gt; set(‘值1’,’值2’,’值3’,…)   注意：值不可重复。</li><li>该字段插入值时，只能是指定的值。</li></ul><h3 id="二进制类型"><a href="#二进制类型" class="headerlink" title="二进制类型"></a>二进制类型</h3><p>BLOB类型：二进制大对象，可以存储图片、声音、视频等文件。</p><ul><li>blob：小的，最大长度65535个字节</li><li>mediumblob：中等的，最大长度16777215个字节</li><li>longblob：大的，最大长度4GB的字节</li></ul><h2 id="增删改表结构DDL"><a href="#增删改表结构DDL" class="headerlink" title="增删改表结构DDL"></a>增删改表结构DDL</h2><h3 id="创建一个学生表"><a href="#创建一个学生表" class="headerlink" title="创建一个学生表"></a>创建一个学生表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_student(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">bigint</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  age <span class="type">int</span> comment <span class="string">&#x27;年龄&#x27;</span>#comment是注释的意思</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="查看建表语句"><a href="#查看建表语句" class="headerlink" title="查看建表语句"></a>查看建表语句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create table</span> 表名;</span><br></pre></td></tr></table></figure><h3 id="修改表名"><a href="#修改表名" class="headerlink" title="修改表名"></a>修改表名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 rename 新表名;</span><br></pre></td></tr></table></figure><h3 id="新增字段"><a href="#新增字段" class="headerlink" title="新增字段"></a>新增字段</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 <span class="keyword">add</span> 字段名 数据类型;</span><br></pre></td></tr></table></figure><h3 id="修改字段名"><a href="#修改字段名" class="headerlink" title="修改字段名"></a>修改字段名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 change 旧字段名 新字段名 数据类型;</span><br></pre></td></tr></table></figure><h3 id="修改字段数据类型"><a href="#修改字段数据类型" class="headerlink" title="修改字段数据类型"></a>修改字段数据类型</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 modify <span class="keyword">column</span> 字段名 数据类型;</span><br></pre></td></tr></table></figure><h3 id="删除字段"><a href="#删除字段" class="headerlink" title="删除字段"></a>删除字段</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 <span class="keyword">drop</span> 字段名;</span><br></pre></td></tr></table></figure><h2 id="DML语句"><a href="#DML语句" class="headerlink" title="DML语句"></a>DML语句</h2><p>当我们对表中的数据进行增删改的时候，称它为DML语句。（数据操纵语言），主要包括：insert、delete、update</p><h3 id="insert-增"><a href="#insert-增" class="headerlink" title="insert 增"></a>insert 增</h3><p>语法格式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> 表名(字段名<span class="number">1</span>,字段名<span class="number">2</span>,字段名<span class="number">3</span>,...) <span class="keyword">values</span>(值<span class="number">1</span>,值<span class="number">2</span>,值<span class="number">3</span>,...);</span><br></pre></td></tr></table></figure><p>表名后面的小括号当中的字段名如果省略掉，表示自动将所有字段都列出来了，并且字段的顺序和建表时的顺序一致。<br>一般为了可读性强，建议把字段名写上。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> 表名 <span class="keyword">values</span>(值<span class="number">1</span>,值<span class="number">2</span>,值<span class="number">3</span>,...);</span><br></pre></td></tr></table></figure><p>一次可以插入多条记录：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> t_stu(<span class="keyword">no</span>,name,age) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;jack&#x27;</span>,<span class="number">20</span>),(<span class="number">2</span>,<span class="string">&#x27;lucy&#x27;</span>,<span class="number">30</span>);</span><br></pre></td></tr></table></figure><h3 id="delete-删"><a href="#delete-删" class="headerlink" title="delete 删"></a>delete 删</h3><p>语法格式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 将所有记录全部删除</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名;</span><br><span class="line"></span><br><span class="line"># 删除符合条件的记录</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件;</span><br></pre></td></tr></table></figure><p>以上的删除属于DML的方式删除，这种删除的数据是可以通过事务回滚的方式重新恢复的，但是删除的效率较低。（这种删除是支持事务的。）<br>另外还有一种删除表中数据的方式，但是这种方式不支持事务，不可以回滚，删了之后数据是永远也找不回来了。这种删除叫做：表被截断。<br>注意：这个语句删除效率非常高，巨大的表，瞬间干掉所有数据。但不可恢复。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#这种删除不属于dml操作</span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></table></figure><h3 id="update-改"><a href="#update-改" class="headerlink" title="update 改"></a>update 改</h3><p>语法格式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> 表名 <span class="keyword">set</span> 字段名<span class="number">1</span><span class="operator">=</span>值<span class="number">1</span>, 字段名<span class="number">2</span><span class="operator">=</span>值<span class="number">2</span>, 字段名<span class="number">3</span><span class="operator">=</span>值<span class="number">3</span> <span class="keyword">where</span> 条件;</span><br></pre></td></tr></table></figure><p>如果没有更新条件的话，所有记录全部更新。</p><h2 id="约束constraint"><a href="#约束constraint" class="headerlink" title="约束constraint"></a>约束constraint</h2><p>创建表时，可以给表的字段添加约束，可以保证数据的完整性、有效性。比如大家上网注册用户时常见的：用户名不能为空。对不起，用户名已存在。等提示信息。<br>约束通常包括：</p><ul><li>非空约束：not null</li><li>检查约束：check</li><li>唯一性约束：unique</li><li>主键约束：primary key</li><li>外键约束：foreign key</li></ul><h3 id="非空约束"><a href="#非空约束" class="headerlink" title="非空约束"></a>非空约束</h3><p>语法格式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_stu(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">not null</span>,</span><br><span class="line">  age <span class="type">int</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>name字段不能为空。插入数据时如果没有给name指定值，则报错。</p><h3 id="检查约束"><a href="#检查约束" class="headerlink" title="检查约束"></a>检查约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_stu(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  age <span class="type">int</span>,</span><br><span class="line">  <span class="keyword">check</span>(age <span class="operator">&gt;</span> <span class="number">18</span>)#大于<span class="number">18</span>岁的才可以插入</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="唯一性约束"><a href="#唯一性约束" class="headerlink" title="唯一性约束"></a>唯一性约束</h3><p>语法格式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_stu(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  email <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">unique</span>#如果里面有重复的就不能插入了</span><br><span class="line">  email <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">unique</span> <span class="keyword">not null</span>#就是不能重复也不能为空</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>email字段设置为唯一性，唯一性的字段值是可以为NULL的。但不能重复。以上在字段后面添加的约束，叫做列级约束。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_stu(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  email <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  <span class="keyword">unique</span>(email)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>使用表级约束可以为多个字段添加联合唯一。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_stu(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  email <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  <span class="keyword">unique</span>(name,email)#如果name和email都一样就不行，任意一个一样可以</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>创建约束时也可以给约束起名字，将来可以通过约束的名字来删除约束：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_stu(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  email <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  <span class="keyword">constraint</span> t_stu_name_email_unique <span class="keyword">unique</span>(name,email)#<span class="keyword">constraint</span>后面的就是约束名字</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>所有的约束都存储在一个系统表当中：table_constraints。这个系统表在这个数据库当中：information_schema</p><h3 id="主键约束"><a href="#主键约束" class="headerlink" title="主键约束"></a>主键约束</h3><ol><li><p>主键：primary key，简称PK</p></li><li><p>主键约束的字段不能为NULL，并且不能重复。</p></li><li><p>任何一张表都应该有主键，没有主键的表可以视为无效表。</p></li><li><p>主键值是这行记录的身份证号，是唯一标识。在数据库表中即使两条数据一模一样，但由于主键值不同，我们也会认为是两条完全的不同的数据。</p></li><li><p>主键分类：</p><ol><li>根据字段数量分类：<ol><li>单一主键（1个字段作为主键）&#x3D;&#x3D;&gt;建议的</li><li>复合主键（2个或2个以上的字段作为主键）</li></ol></li><li>根据业务分类：<ol><li>自然主键（主键和任何业务都无关，只是一个单纯的自然数据）&#x3D;&#x3D;&#x3D;&gt;建议的</li><li>业务主键（主键和业务挂钩，例如：银行卡账号作为主键）</li></ol></li></ol></li><li><p>单一主键（建议使用这种方式）</p></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_student(</span><br><span class="line">  id <span class="type">bigint</span> <span class="keyword">primary key</span>,</span><br><span class="line">  sno <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">unique</span>,</span><br><span class="line">  sname <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">not null</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><ol start="7"><li>复合主键（很少用，了解）</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_user(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  age <span class="type">int</span>,</span><br><span class="line">  <span class="keyword">primary key</span>(<span class="keyword">no</span>,name)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ol start="8"><li>主键自增：既然主键值是一个自然的数字，mysql为主键值提供了一种自增机制，不需要我们程序员维护，mysql自动维护该字段</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_vip(</span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h3><ol><li>有这样一个需求：要求设计表，能够存储学生以及学校信息。<ol><li>第一种方案：一张表</li></ol></li></ol><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250320232608142.png" alt="image-20250320232608142"></p><p>这种方式会导致数据冗余，浪费空间。</p><pre><code>  2. 第二种方案：两张表：一张存储学生，一张存储学校</code></pre><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/1679198814824-520944e2-5b83-49ba-97e7-b8830286127a.png#averageHue=#c9d481&clientId=uf7a0608d-b7a1-4&from=paste&height=85&id=ud1ad0346&originHeight=85&originWidth=471&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2397&status=done&style=shadow&taskId=u76cd09e9-9753-41f7-81d7-729db7c551a&title=&width=471" alt="image.png"></p><p>t_student 表</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250320232823743.png" alt="image-20250320232823743"></p><p>如果采用以上两张表存储数据，对于学生表来说，sno这个字段的值是不能随便填的，这个sno是学校编号，必须要求这个字段中的值来自学校表的sno。<br>为了达到要求，此时就必须要给t_student表的sno字段添加外键约束了。</p><ol start="2"><li><p>外键约束：foreign key，简称FK。</p></li><li><p>添加了外键约束的字段中的数据必须来自其他字段，不能随便填。</p></li><li><p>假设给a字段添加了外键约束，要求student字段中的数据必须来自b字段，school字段<strong>不一定是主键，但至少要有唯一性</strong>。</p></li><li><p>外键约束可以给单个字段添加，叫做单一外键。也可以给多个字段联合添加，叫做复合外键。复合外键很少用。</p></li><li><p>建表是有顺序的，a表如果引用b表中的数据，可以把b表叫做父表(student)，把a表叫做子表。</p><ol><li>创建表时，先创建父表，再创建子表。</li><li>插入数据时，先插入父表，在插入子表。</li><li>删除数据时，先删除子表，再删除父表。</li><li>删除表时，先删除子表，再删除父表。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#先创建父表</span><br><span class="line"><span class="keyword">create table</span> t_school(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>  sno <span class="type">int</span> <span class="keyword">primary key</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>  sname <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> );</span><br><span class="line">#插入数据</span><br><span class="line"><span class="keyword">insert into</span> t_school <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;北京二中&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_school <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;南开大学附属中学&#x27;</span>);</span><br><span class="line"></span><br><span class="line">#创建子表</span><br><span class="line"><span class="keyword">create table</span> t_student(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>  id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>  age <span class="type">int</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>  school_no <span class="type">int</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>  <span class="keyword">constraint</span> t_student_school_no_fk <span class="keyword">foreign key</span>(school_no) <span class="keyword">references</span> t_school(sno)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> );#<span class="keyword">constraint</span>给约束起名，<span class="keyword">foreign key</span>是指定外键，<span class="keyword">references</span>是引用表里唯一的东西</span><br><span class="line">    </span><br><span class="line">#插入多条数据（略</span><br><span class="line"><span class="keyword">insert into</span> t_student(name,age,school_no) <span class="keyword">values</span>(<span class="string">&#x27;jack&#x27;</span>,<span class="number">20</span>,<span class="number">1</span>);#如果<span class="number">1</span>改成<span class="number">3</span>，就会报错，因为school只有<span class="number">1</span>和<span class="number">2</span></span><br></pre></td></tr></table></figure></li><li><p>如何添加外键：</p></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_school( </span><br><span class="line">  sno <span class="type">int</span> <span class="keyword">primary key</span>, </span><br><span class="line">  sname <span class="type">varchar</span>(<span class="number">255</span>) </span><br><span class="line">); </span><br><span class="line"><span class="keyword">create table</span> t_student( </span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span> <span class="keyword">primary key</span>, </span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>), </span><br><span class="line">  age <span class="type">int</span>, </span><br><span class="line">  sno <span class="type">int</span>, </span><br><span class="line">  <span class="keyword">constraint</span> t_school_sno_fk <span class="keyword">foreign key</span>(sno) <span class="keyword">references</span> t_school(sno) </span><br><span class="line">);</span><br></pre></td></tr></table></figure><ol start="8"><li>级联删除</li></ol><p>创建子表时，外键可以添加：on delete cascade，这样在删除父表数据时，子表会级联删除。谨慎使用。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#继续上面的信息，删掉约束</span><br><span class="line"><span class="keyword">alter table</span> t_student <span class="keyword">drop</span> <span class="keyword">constraint</span> t_student_school_no_fk;</span><br><span class="line">###添加约束，和下面的一样</span><br><span class="line">alert <span class="keyword">table</span> t_student <span class="keyword">add constraint</span> t_student_sno_fk <span class="keyword">foreign key</span>(school_no) <span class="keyword">references</span> t_school(sno) <span class="keyword">on</span> <span class="keyword">delete</span> cascade;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_student( </span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span> <span class="keyword">primary key</span>, </span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>), </span><br><span class="line">  age <span class="type">int</span>, </span><br><span class="line">  sno <span class="type">int</span>, </span><br><span class="line">  <span class="keyword">constraint</span> t_school_sno_fk <span class="keyword">foreign key</span>(sno) <span class="keyword">references</span> t_school(sno) <span class="keyword">on</span> <span class="keyword">delete</span> cascade </span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">###删除约束</span><br><span class="line">alert <span class="keyword">table</span> t_student <span class="keyword">drop</span> <span class="keyword">foreign key</span> t_student_sno_fk;</span><br><span class="line">###添加约束</span><br><span class="line">alert <span class="keyword">table</span> t_student <span class="keyword">add constraint</span> t_student_sno_fk <span class="keyword">foreign key</span>(sno) <span class="keyword">references</span> t_school(sno) <span class="keyword">on</span> <span class="keyword">delete</span> cascade;</span><br></pre></td></tr></table></figure><ol start="9"><li>级联更新 ：父改了的时候子也会改</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_student( </span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span> <span class="keyword">primary key</span>, </span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>), </span><br><span class="line">  age <span class="type">int</span>, </span><br><span class="line">  sno <span class="type">int</span>, </span><br><span class="line">  <span class="keyword">constraint</span> t_school_sno_fk <span class="keyword">foreign key</span>(sno) <span class="keyword">references</span> t_school(sno) <span class="keyword">on</span> <span class="keyword">update</span> cascade </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#接着最上面的表，然后约束删掉再加上<span class="keyword">on</span> <span class="keyword">update</span> cascade</span><br><span class="line"><span class="keyword">alter table</span> t_student <span class="keyword">add constraint</span> t_student_school_no_fk <span class="keyword">foreign key</span>(school_no) <span class="keyword">references</span> t_school(sno) <span class="keyword">on</span> <span class="keyword">update</span> cascade;</span><br><span class="line">#更新数据</span><br><span class="line"><span class="keyword">update</span> t_school <span class="keyword">set</span> sno<span class="operator">=</span><span class="number">332</span> <span class="keyword">where</span> sname<span class="operator">=</span><span class="string">&#x27;北京二中&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321152205319.png" alt="image-20250321152205319"></p><ol start="10"><li>级联置空</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_student( </span><br><span class="line">  <span class="keyword">no</span> <span class="type">int</span> <span class="keyword">primary key</span>, </span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>), </span><br><span class="line">  age <span class="type">int</span>, </span><br><span class="line">  sno <span class="type">int</span>, </span><br><span class="line">  <span class="keyword">constraint</span> t_school_sno_fk <span class="keyword">foreign key</span>(sno) <span class="keyword">references</span> t_school(sno) <span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">set</span> <span class="keyword">null</span> </span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>把school删掉，student表的school_no会是null</p><h1 id="第06章-三范式"><a href="#第06章-三范式" class="headerlink" title="第06章 三范式"></a>第06章 三范式</h1><h2 id="什么是数据库设计三范式"><a href="#什么是数据库设计三范式" class="headerlink" title="什么是数据库设计三范式"></a>什么是数据库设计三范式</h2><p>数据库表设计的原则。教你怎么设计数据库表有效，并且节省空间。</p><p>这些毕竟是理论，在实际开发中为了满足客户需求，有时候会拿空间或者冗余去换取速度</p><h2 id="三范式（背）"><a href="#三范式（背）" class="headerlink" title="三范式（背）"></a>三范式（背）</h2><ol><li>第一范式：任何一张表都应该有主键，每个字段是原子性的不能再分<ol><li>以下表的设计不符合第一范式：无主键，并且联系方式可拆分。</li></ol></li></ol><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321160005233.png" alt="image-20250321160005233"></p><pre><code>  2. 应该这样设计：</code></pre><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321160012762.png" alt="image-20250321160012762"></p><ol start="2"><li>第二范式：建立在第一范式基础上的，另外要求所有非主键字段完全依赖主键，不能产生部分依赖<ol><li>以下表存储了学生和老师的信息</li></ol></li></ol><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321160020806.png" alt="image-20250321160020806"><br>虽然符合第一范式，但是违背了第二范式，学生姓名、老师姓名都产生了部分依赖。导致数据冗余。</p><pre><code>  2. 以下这种设计方式就是符合第二范式的：</code></pre><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321160029954.png" alt="image-20250321160029954"></p><ol start="3"><li>第三范式：建立在第二范式基础上的，非主键字段不能传递依赖于主键字段<ol><li>以下设计方式就是违背第三范式的</li></ol></li></ol><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321160038070.png" alt="image-20250321160038070"><br>以上因为产生了传递依赖，导致班级名称冗余。</p><pre><code>  2. 以下这种方式就是符合第三范式的：</code></pre><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321160043270.png" alt="image-20250321160043270"></p><h2 id="一对多怎么设计"><a href="#一对多怎么设计" class="headerlink" title="一对多怎么设计"></a>一对多怎么设计</h2><p>口诀：一对多两张表，多的表加外键。</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321162808995.png" alt="image-20250321162808995"></p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321162813387.png" alt="image-20250321162813387"></p><h2 id="多对多怎么设计"><a href="#多对多怎么设计" class="headerlink" title="多对多怎么设计"></a>多对多怎么设计</h2><p>多对多三张表，关系表添加外键。</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321162826769.png" alt="image-20250321162826769"></p><h2 id="一对一怎么设计"><a href="#一对一怎么设计" class="headerlink" title="一对一怎么设计"></a>一对一怎么设计</h2><p>两种方案：</p><ol><li>第一种：主键共享</li></ol><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321162839731.png" alt="image-20250321162839731"></p><ol start="2"><li>第二种：外键唯一</li></ol><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321162846618.png" alt="image-20250321162846618"></p><h2 id="最终的设计"><a href="#最终的设计" class="headerlink" title="最终的设计"></a>最终的设计</h2><p>最终以满足客户需求为原则，有的时候会拿空间换速度。</p><h1 id="第07章-视图"><a href="#第07章-视图" class="headerlink" title="第07章 视图"></a>第07章 视图</h1><p>就是如果多处都需要使用同一条sql语句，可以把这个语句创建成视图，这样不管增删改查，只要对这个视图进行操作，其他的地方就会同步。</p><ol><li><p>只能将select语句创建为视图。</p></li><li><p>创建视图</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> myview01 <span class="keyword">as</span> <span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp;#<span class="keyword">as</span>后面的是DQL语句，以视图方式创建</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> myview01 <span class="keyword">as</span> <span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp;#前面的是创建或替换的意思，如果有myview01这个视图了就会替换成新的</span><br></pre></td></tr></table></figure></li><li><p>视图作用</p><ol><li><p>如果开发中有一条非常复杂的SQL，而这个SQL在多处使用，会给开发和维护带来成本。使用视图可以降低开发和维护的成本。</p></li><li><p>视图可以隐藏表的字段名。</p></li></ol></li><li><p>修改视图</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> myview01 <span class="keyword">set</span> ename<span class="operator">=</span><span class="string">&#x27;老板&#x27;</span> <span class="keyword">where</span> empno<span class="operator">=</span><span class="number">7839</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250321183526829.png" alt="image-20250321183526829"></p></li><li><p>删除视图</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> myview01 <span class="keyword">where</span> empno<span class="operator">=</span><span class="number">7839</span>;#删除视图里的一个数据</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> myview01;#删除视图</span><br></pre></td></tr></table></figure></li><li><p>对视图增删改（DML：insert delete update）可以影响到原表数据。</p></li></ol><h1 id="第08章-事务transaction"><a href="#第08章-事务transaction" class="headerlink" title="第08章 事务transaction"></a>第08章 事务transaction</h1><h2 id="事务概述"><a href="#事务概述" class="headerlink" title="事务概述"></a>事务概述</h2><ol><li>事务是一个最小的工作单元。在数据库当中，事务表示一件完整的事儿。</li><li>一个业务的完成可能需要多条DML语句共同配合才能完成，例如转账业务，需要执行两条DML语句，先更新张三账户的余额，再更新李四账户的余额，为了保证转账业务不出现问题，就必须保证要么同时成功，要么同时失败，怎么保证同时成功或者同时失败呢？就需要使用事务机制。</li><li>也就是说用了事务机制之后，在同一个事务当中，多条DML语句会同时成功，或者同时失败，不会出现一部分成功，一部分失败的现象。</li><li>事务只针对DML语句有效：因为只有这三个语句是改变表中数据的。<ol><li>insert</li><li>delete</li><li>update</li></ol></li></ol><h2 id="事务四大特性：ACID"><a href="#事务四大特性：ACID" class="headerlink" title="事务四大特性：ACID"></a>事务四大特性：ACID</h2><ol><li>原子性（Atomicity）：是指事务包含的所有操作要么全部成功，要么同时失败。原子性也是最小的事务，不可再分</li><li>一致性（Consistency）：是指事务开始前，和事务完成后，数据应该是一致的。例如张三和李四的钱加起来是5000，中间不管进行过多少次的转账操作(update)，总量5000是不会变的。这就是事务的一致性。</li><li>隔离性（Isolation）：隔离性是当多个⽤户并发访问数据库时，⽐如操作同⼀张表时，数据库为每⼀个⽤户开启的事务，不能被其他事务的操作所⼲扰，多个并发事务之间要相互隔离。</li><li>持久性（Durability）：持久性是指⼀个事务⼀旦被提交了，那么对数据库中的数据的改变就是永久性的，即便是在数据库系统遇到故障的情况下也不会丢失提交事务的操作。</li></ol><h2 id="演示MySQL事务"><a href="#演示MySQL事务" class="headerlink" title="演示MySQL事务"></a>演示MySQL事务</h2><p>在sql里，是自动提交事务的，如果需要关闭，在dos命令窗口中开启MySQL事务：start transaction; 或者：begin;开启手动提交<br>回滚事务：rollback;<br>提交事务：commit;<br>只要执行以上的rollback或者commit，事务都会结束。commit是成功事务，硬盘上的文件内容会被彻底改变，rollback是把之前的历史记录全部清空，当做没有发生<br>MySQL默认情况下采用的事务机制是：自动提交。所谓自动提交就是只要执行一条DML语句则提交一次。每次提交完都要再开启一次。</p><h2 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h2><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322015111236.png" alt="image-20250322015111236"></p><p><strong>隔离级别从低到高排序：读未提交 &lt; 读提交 &lt; 可重复读 &lt; 串行化**<br>**不同隔离级别会存在不同的现象，现象按照严重性从高到低排序：脏读 &gt; 不可重复读 &gt; 幻读</strong></p><p>读未提交：读到没有提交的数据<br>读提交：同上<br>可重复读：读到了一条数据，读完之后当前的事物只要不结束，这条数据就会永远不变，可以重复读，不被影响<br>串行化：不支持事物并发，事物a和事物b必须排队执行</p><h3 id="查看与设置隔离级别"><a href="#查看与设置隔离级别" class="headerlink" title="查看与设置隔离级别"></a>查看与设置隔离级别</h3><p>mysql默认的隔离级别：可重复读（REPEATABLE READ）。oracle默认是读提交</p><ul><li>查看当前会话（窗口）的隔离级别：select @@transaction_isolation;</li><li>查看全局的隔离级别：select @@gobal.transaction_isolation;</li></ul><p>设置事务隔离级别：</p><ul><li>会话级：set session transaction isolation level read committed;</li><li>全局级：set global transaction isolation level read committed;</li></ul><h3 id="不同现象"><a href="#不同现象" class="headerlink" title="不同现象"></a>不同现象</h3><h4 id="脏读"><a href="#脏读" class="headerlink" title="脏读"></a>脏读</h4><p><strong>指的是一个事务读取了另一个事务尚未提交的数据</strong>，即读取了另一个事务中的脏数据（Dirty Data）。在此情况下，如果另一个事务回滚了或者修改了这些数据，那么读取这些脏数据的事务所处理的数据就是不准确的。</p><h4 id="不可重复读"><a href="#不可重复读" class="headerlink" title="不可重复读"></a>不可重复读</h4><p>指在一个事务内，多次读取同一个数据行，得到的结果可能是不一样的。这是由于其他事务对数据行做出了修改操作，导致数据的不一致性。</p><h4 id="幻读"><a href="#幻读" class="headerlink" title="幻读"></a>幻读</h4><p>指在事务执行过程中，前后两次相同的查询条件得到的结果集不一致，可能会变多或变少。<br>比如a在进行查询语句，本来要查3条，结果b执行了一条插入，就变成了查四条</p><h3 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h3><h4 id="读未提交（READ-UNCOMMITTED）"><a href="#读未提交（READ-UNCOMMITTED）" class="headerlink" title="读未提交（READ UNCOMMITTED）"></a>读未提交（READ UNCOMMITTED）</h4><p>A事务与B事务，A事务可以读取到B事务未提交的数据。这是最低的隔离级别。几乎两个事务之间没有隔离。这种隔离级别是一种理论层面的，在实际的数据库产品中，没有从这个级别起步的。<br>当事务隔离级别是读未提交时，三种现象都存在：脏读，不可重复读，幻读。<br>我们可以开启两个DOS命令窗口，模拟两个事务，演示一下这种隔离级别。三种现象中最严重的是脏读，我们只需要演示脏读问题即可，因为存在脏读的话，就一定存在不可重复读和幻读问题。</p><p>将全局事务隔离级别设置为：READ UNCOMMITTED</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level read uncommitted;</span><br></pre></td></tr></table></figure><p>开启两个DOS命令窗口来模拟两个事务：A事务与B事务。</p><table><thead><tr><th><strong>A事务</strong></th><th><strong>B事务</strong></th></tr></thead><tbody><tr><td>mysql&gt; use powernode</td><td></td></tr><tr><td></td><td>mysql&gt; use powernode</td></tr><tr><td>mysql&gt; start transaction;</td><td></td></tr><tr><td></td><td>mysql&gt; start transaction;</td></tr><tr><td>mysql&gt; select * from a;</td><td></td></tr><tr><td><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322021702025.png" alt="image-20250322021702025"></td><td></td></tr><tr><td></td><td>mysql&gt; insert into a values(4);</td></tr><tr><td>mysql&gt; select * from a;</td><td></td></tr><tr><td><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322021709540.png" alt="image-20250322021709540"></td><td></td></tr></tbody></table><p>通过以上测试，可以看到，A事务读取到了B事务还没有提交的数据。这种现象就是脏读。</p><h4 id="读提交（READ-COMMITTED）"><a href="#读提交（READ-COMMITTED）" class="headerlink" title="读提交（READ COMMITTED）"></a>读提交（READ COMMITTED）</h4><p>A事务与B事务，A事务可以读取到B事务提交之后的数据。Oracle数据库默认的就是这种隔离级别。</p><p>将数据库的全局事务隔离级别设置为读提交：READ COMMITTED</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level read committed;</span><br></pre></td></tr></table></figure><p>还是上面图表的内容，但是b表必须要commit提交后a表才可以读到，但a表依旧不可重复读，而且b表插入时a表可以显示</p><h4 id="可重复读（REPEATABLE-READ）"><a href="#可重复读（REPEATABLE-READ）" class="headerlink" title="可重复读（REPEATABLE READ）"></a>可重复读（REPEATABLE READ）</h4><p>这个隔离级别是MySQL数据库默认的。<br>A事务和B事务，A事务开启后，读取了某一条记录，然后B事务对这条记录进行修改并提交，A事务读取到的还是修改前的数据。这种隔离级别称为可重复读。</p><p>将数据库全局隔离级别修改为可重复读：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level repeatable read;</span><br></pre></td></tr></table></figure><p>但是<strong>当事务隔离级别设置为可重复读，MySQL会尽最大努力避免幻读问题，但这种隔离级别无法完全避免幻读问题。</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_school;#快照读</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_school <span class="keyword">for</span> <span class="keyword">update</span>;#当前读，会出现幻读问题</span><br></pre></td></tr></table></figure><h4 id="串行化（SERIALIZABLE）"><a href="#串行化（SERIALIZABLE）" class="headerlink" title="串行化（SERIALIZABLE）"></a>串行化（SERIALIZABLE）</h4><p>种隔离级别最高，避免了所有的问题，缺点是效率低，因为这种隔离级别会导致事务排队处理，不支持并发。</p><p>设置数据库全局隔离级别为串行化：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level serializable;</span><br></pre></td></tr></table></figure><h3 id="可重复读的幻读问题"><a href="#可重复读的幻读问题" class="headerlink" title="可重复读的幻读问题"></a>可重复读的幻读问题</h3><p>在上面讲解过程中我提到，MySQL默认的隔离级别可重复读，在很大程度上避免了幻读问题（并不能完全解决），那么它是如何解决幻读问题的呢，解决方案包括两种：</p><ul><li>针对<strong>快照读</strong>（普通 select 语句），是<strong>通过 MVCC 方式解决了幻读</strong>，因为可重复读隔离级别下，事务执行过程中看到的数据，一直跟这个事务启动时看到的数据是一致的，即使中途有其他事务插入了一条数据，是查询不出来这条数据的，所以就很好的避免了幻读问题。</li><li>针对<strong>当前读</strong>（select … for update 等语句，<strong>在delete、insert、update操作时会自动调用一次当前读获取最新的数据</strong>），是<strong>通过 next-key lock（记录锁+间隙锁）方式解决了幻读</strong>，因为当执行 select … for update 语句的时候，会加上 next-key lock，如果有其他事务在 next-key lock 锁范围内插入了一条记录，那么这个插入语句就会被阻塞，无法成功插入，所以就很好的避免了幻读问题。</li><li>记录锁：在另一个事务中删数据会删不掉，必须a事务结束才可以</li><li>间隙锁：如果选择的范围在2-4之间，而数据只有2和4，b表想插个3就无法被插入，因为会有间隙锁给锁住</li></ul><h4 id="快照读是如何解决幻读的"><a href="#快照读是如何解决幻读的" class="headerlink" title="快照读是如何解决幻读的"></a>快照读是如何解决幻读的</h4><p>快照类似于缓存，第一次读的时候把数据留在了缓存里，第二次读直接是读缓存里的那个数据而不是最新的，要么两次都是快照读，要么两次都是当前读，如果一次快照一次当前就会出现幻读问题</p><ul><li>底层由 MVCC（多版本并发控制）实现，实现的方式是开始事务后，在执行第一个查询语句后，会创建一个 Read View，后续的查询语句利用这个 Read View，通过这个 Read View 就可以在 undo log 版本链找到事务开始时的数据，所以事务过程中每次查询的数据都是一样的，即使中途有其他事务插入了新纪录，是查询不出来这条数据的，所以就很好的避免了幻读问题。</li><li>多版本并发的多版本是：当前数据库表中的数据的版本是1.0，每执行一次insert&#x2F;delete&#x2F;update这些dml操作，则版本更新一次，insert1.1,delete1.2,update1.3</li><li>undo是撤销，redo是重做</li></ul><h4 id="当前读是如何解决幻读的"><a href="#当前读是如何解决幻读的" class="headerlink" title="当前读是如何解决幻读的"></a>当前读是如何解决幻读的</h4><p>当前读，顾名思义：每一次都读取最新的数据。当前读包括：update、delete、insert、select…for update。这个很好理解，因为增删改的时候都要基于最新的数据进行增删改。<br>而select…for update原理是：对查询范围内的数据进行加锁，不允许其它事务对这个范围内的数据进行增删改。也就是说这个select语句范围内的数据是不允许并发的，只能排队执行，从而避免幻读问题。<br>select…for update加的锁叫做：next-key lock。我们可以称其为：间隙锁 + 记录锁。间隙锁用来保证在锁定的范围内不允许insert操作。记录锁用来保证在锁定的范围内不允许delete和update操作。</p><p>假如有这样的数据：<br><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322024846882.png" alt="image-20250322024846882"><br>SQL语句是这样写的：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> a <span class="keyword">where</span> id <span class="keyword">between</span> <span class="number">2</span> <span class="keyword">and</span> <span class="number">4</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure><p>那么id在[2-4]区间的所有记录行被锁定，不能插入3是通过间隙锁来搞定的。不能修改或删除2和4是通过记录锁来搞定的。</p><h4 id="出现幻读的两种情况"><a href="#出现幻读的两种情况" class="headerlink" title="出现幻读的两种情况"></a>出现幻读的两种情况</h4><p>在同一个事务处理过程中，如果前后两次都采用快照读，或者都采用当前读，则不会出现幻读问题。如果第一次使用快照读，后面使用了当前读，则会出现幻读问题。</p><h5 id="第一种产生幻读的场景"><a href="#第一种产生幻读的场景" class="headerlink" title="第一种产生幻读的场景"></a>第一种产生幻读的场景</h5><p>A事务与B事务。在A事务中第一次查询使用快照读，B事务插入数据。然后在A事务中第二次查询使用当前读。则会产生幻读现象。</p><h5 id="第二种产生幻读的场景"><a href="#第二种产生幻读的场景" class="headerlink" title="第二种产生幻读的场景"></a>第二种产生幻读的场景</h5><p>事务A与事务B，在事务A中第一次查询使用<strong>快照读</strong>，在事务B中插入一条数据，然后在事务A中<strong>更新</strong>（底层自动当前读）事务B插入的那条记录，最后在事务A中再次使用<strong>快照读</strong>。则会发生幻读现象。</p><h4 id="总结可重复读的幻读问题"><a href="#总结可重复读的幻读问题" class="headerlink" title="总结可重复读的幻读问题"></a>总结可重复读的幻读问题</h4><p>MySQL的可重复读隔离级别（默认隔离级），根据不同的查询方式，分别提出了避免幻读的方案：</p><ul><li>针对快照读（普通 select 语句），是通过 MVCC 方式解决了幻读。</li><li>针对当前读（select … for update 等语句），是通过 next-key lock（记录锁+间隙锁）方式解决了幻读。</li></ul><p>我举例了两个发生幻读场景的例子。</p><ul><li>第一个例子：对于快照读， MVCC 并不能完全避免幻读现象。因为当事务 A 更新了一条事务 B 插入的记录，那么事务 A 前后两次查询的记录条目就不一样了，所以就发生幻读。</li><li>第二个例子：对于当前读，如果事务开启后，并没有执行当前读，而是先快照读，然后这期间如果其他事务插入了一条记录，那么事务后续使用当前读进行查询的时候，就会发现两次查询的记录条目就不一样了，所以就发生幻读。</li></ul><p>所以，MySQL 可重复读隔离级别并没有彻底解决幻读，只是很大程度上避免了幻读现象的发生。<br>要避免这类特殊场景下发生幻读的现象的话，就是尽量在开启事务之后，马上执行 select … for update 这类当前读的语句，因为它会对记录加 next-key lock，从而避免其他事务插入一条新记录。</p><h1 id="第09章-DBA命令"><a href="#第09章-DBA命令" class="headerlink" title="第09章 DBA命令"></a>第09章 DBA命令</h1><p>数据库管理员</p><h2 id="新建用户"><a href="#新建用户" class="headerlink" title="新建用户"></a>新建用户</h2><p>使用自带的数据库</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br></pre></td></tr></table></figure><p>有个系统表保存着系统用户</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> tables <span class="keyword">like</span> <span class="string">&#x27;user&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322180559107.png" alt="image-20250322180559107"></p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322180737605.png" alt="image-20250322180737605"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>,host <span class="keyword">from</span> <span class="keyword">user</span>;#里面的localhost是本地用户</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322180906745.png" alt="image-20250322180906745"></p><p>创建一个用户名为java1，密码设置为123的本地用户：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;java1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure><p>创建一个用户名为java2，密码设置为123的外网用户：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;java2&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure><p>采用以上方式新建的用户没有任何权限：系统表也只能看到以下两个<br><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250322182422523.png" alt="image-20250322182422523"><br>使用root用户查看系统中当前用户有哪些？</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>,host <span class="keyword">from</span> mysql.user;</span><br></pre></td></tr></table></figure><h2 id="给用户授权"><a href="#给用户授权" class="headerlink" title="给用户授权"></a>给用户授权</h2><p>授权语法：grant [权限1，权限2…] on 库名.表名 to ‘用户名‘@’主机名&#x2F;IP地址’;<br>（意思是：给后面的这个用户授前面的权限，但是只能作用在这个单独的表上）<br>给本地用户授权：grant [权限1，权限2…] on 库名.表名 to ‘用户名‘@’localhost’;<br>给外网用户授权：grant [权限1，权限2…] on 库名.表名 to ‘用户名‘@’%’;<br>所有权限：all privileges<br>细粒度权限：select、insert、delete、update、alter、create、drop、index(索引)、usage(登录权限)……<br>库名可以使用 * ，它代表所有数据库<br>表名可以采用 * ，它代表所有表<br>也可以提供具体的数据库和表，例如：powernode.emp （powernode数据库的emp表）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 将所有库所有表的查询权限赋予本地用户java1</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">delete</span>,<span class="keyword">update</span>,<span class="keyword">create</span> <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;java1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">flush privileges;#要记得这步，不然不起作用</span><br><span class="line"></span><br><span class="line"># 将powernode库中所有表的所有权限赋予本地用户java1</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> powernode.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;java1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure><p>授权后必须刷新权限，才能生效：flush privileges<br>查看某个用户拥有哪些权限？<br>show grants for ‘java1‘@’localhost’<br>show grants for ‘java2‘@’%’</p><p>with grant option：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">with</span> <span class="keyword">grant</span> option的作用是：java2用户也可以给其他用户授权（自己的权限）了。</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">delete</span>,<span class="keyword">update</span> <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;java2&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">with</span> <span class="keyword">grant</span> option;</span><br></pre></td></tr></table></figure><h2 id="撤销用户权限"><a href="#撤销用户权限" class="headerlink" title="撤销用户权限"></a>撤销用户权限</h2><p>revoke 权限 on 数据库名.表名 from ‘用户‘@’IP地址’;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 撤销本地用户java1的<span class="keyword">insert</span>、<span class="keyword">update</span>、<span class="keyword">delete</span>权限</span><br><span class="line"><span class="keyword">revoke</span> <span class="keyword">insert</span>, <span class="keyword">update</span>, <span class="keyword">delete</span> <span class="keyword">on</span> powernode.<span class="operator">*</span> <span class="keyword">from</span> <span class="string">&#x27;java1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line"></span><br><span class="line"># 撤销外网用户java2的<span class="keyword">insert</span>权限</span><br><span class="line"><span class="keyword">revoke</span> <span class="keyword">insert</span> <span class="keyword">on</span> powernode.<span class="operator">*</span> <span class="keyword">from</span> <span class="string">&#x27;java2&#x27;</span>@<span class="string">&#x27;%&#x27;</span></span><br></pre></td></tr></table></figure><p>撤销权限后也需要刷新权限：flush privileges</p><p>注意：撤销权限时 “数据库名.表名” 不能随便写，要求和授权语句时的 “数据库名.表名” 一致。</p><h2 id="修改用户的密码"><a href="#修改用户的密码" class="headerlink" title="修改用户的密码"></a>修改用户的密码</h2><p>具有管理用户权限的用户才能修改密码，例如root账户可以修改其他账户的密码：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 本地用户修改密码</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;java1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;456&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 外网用户修改密码</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;java2&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;456&#x27;</span>;</span><br></pre></td></tr></table></figure><p>修改密码后，也需要刷新权限才能生效：flush privileges<br>以上是MySQL8版本以后修改用户密码的方式。</p><h2 id="修改用户名"><a href="#修改用户名" class="headerlink" title="修改用户名"></a>修改用户名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rename <span class="keyword">user</span> <span class="string">&#x27;原始用户名&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">to</span> <span class="string">&#x27;新用户名&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">rename <span class="keyword">user</span> <span class="string">&#x27;原始用户名&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">to</span> <span class="string">&#x27;新用户名&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">rename <span class="keyword">user</span> <span class="string">&#x27;java1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">to</span> <span class="string">&#x27;java11&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">rename <span class="keyword">user</span> <span class="string">&#x27;java11&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">to</span> <span class="string">&#x27;java123&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>flush privileges;</p><h2 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;java123&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;java2&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>flush privileges;</p><h2 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h2><ul><li>导出数据（请在登录mysql数据库之前进行）</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 导出powernode这个数据库中所有的表</span><br><span class="line"># 指令 需要导出的表 到 什么路径 用户名 密码 导出时采用的字符编码</span><br><span class="line">mysqldump powernode <span class="operator">&gt;</span> e:<span class="operator">/</span>powernode.sql <span class="operator">-</span>uroot <span class="operator">-</span>p1234 <span class="comment">--default-character-set=utf8</span></span><br><span class="line"></span><br><span class="line"># 导出powernode中emp表的数据</span><br><span class="line">mysqldump powernode emp <span class="operator">&gt;</span> e:<span class="operator">/</span>powernode.sql <span class="operator">-</span>uroot <span class="operator">-</span>p1234 <span class="comment">--default-character-set=utf8</span></span><br></pre></td></tr></table></figure><ul><li>导入数据第一种方式：（请在登录mysql之前进行）</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 现在登录mysql状态下新建一个数据库</span><br><span class="line"><span class="keyword">create</span> database powernode;</span><br><span class="line"># 在登录mysql之前执行以下命令</span><br><span class="line">mysql powernode <span class="operator">&lt;</span> e:<span class="operator">/</span>powernode.sql <span class="operator">-</span>uroot <span class="operator">-</span>p1234 <span class="comment">--default-character-set=utf8</span></span><br></pre></td></tr></table></figure><ul><li>导入数据第二种方式：（请在登录mysql之后操作）</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span>  database powernode;</span><br><span class="line">use powernode;</span><br><span class="line">source d:<span class="operator">/</span>powernode.sql</span><br></pre></td></tr></table></figure><h1 id="第10章-MySQL客户端工具"><a href="#第10章-MySQL客户端工具" class="headerlink" title="第10章 MySQL客户端工具"></a>第10章 MySQL客户端工具</h1><p>注释：&#x2F;* *&#x2F;</p><p>创建数据库的字符集一般是utf8mb4（不是必须），排序规则utf8mb4_general_ci</p><p>放大字体：按住ctrl+滚轮</p><h1 id="第11章-企业真题"><a href="#第11章-企业真题" class="headerlink" title="第11章 企业真题"></a>第11章 企业真题</h1><p>看文件</p><h1 id="第12章-存储过程"><a href="#第12章-存储过程" class="headerlink" title="第12章 存储过程"></a>第12章 存储过程</h1><h2 id="什么是存储过程？"><a href="#什么是存储过程？" class="headerlink" title="什么是存储过程？"></a>什么是存储过程？</h2><p>存储过程可称为过程化SQL语言，是在普通SQL语句的基础上增加了编程语言的特点，把数据操作语句(DML)和查询语句(DQL)组织在过程化代码中，通过逻辑判断、循环等操作实现复杂计算的程序语言。<br>换句话说，存储过程其实就是数据库内置的一种编程语言，这种编程语言也有自己的变量、if语句、循环语句等。在一个存储过程中可以将多条SQL语句以逻辑代码的方式将其串联起来，执行这个存储过程就是将这些SQL语句按照一定的逻辑去执行，所以一个存储过程也可以看做是一组为了完成特定功能的SQL 语句集。<br>每一个存储过程都是一个数据库对象，就像table和view一样，存储在数据库当中，一次编译永久有效。并且每一个存储过程都有自己的名字。客户端程序通过存储过程的名字来调用存储过程。<br>在数据量特别庞大的情况下利用存储过程能达到倍速的效率提升。 </p><h2 id="存储过程的优点和缺点？"><a href="#存储过程的优点和缺点？" class="headerlink" title="存储过程的优点和缺点？"></a>存储过程的优点和缺点？</h2><p>优点：速度快。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">缺点：移植性差。编写难度大。维护性差。</span><br></pre></td></tr></table></figure><p>缺点：移植性差。编写难度大。维护性差。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- 每一个数据库都有自己的存储过程的语法规则，这种语法规则不是通用的。一旦使用了存储过程，则数据库产品很难更换，例如：编写了mysql的存储过程，这段代码只能在mysql中运行，无法在oracle数据库中运行。</span><br><span class="line">- 对于数据库存储过程这种语法来说，没有专业的IDE工具（集成开发环境），所以编码速度较低。自然维护的成本也会较高。</span><br></pre></td></tr></table></figure><h2 id="第一个存储过程"><a href="#第一个存储过程" class="headerlink" title="第一个存储过程"></a>第一个存储过程</h2><h3 id="存储过程的创建"><a href="#存储过程的创建" class="headerlink" title="存储过程的创建"></a>存储过程的创建</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create procedure p1()</span><br><span class="line">begin</span><br><span class="line">select empno,ename from emp;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure><h3 id="存储过程的调用"><a href="#存储过程的调用" class="headerlink" title="存储过程的调用"></a>存储过程的调用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call p1();</span><br></pre></td></tr></table></figure><p><strong>如果使用dos可能会出现分号就执行的情况， 这时候delimiter命令可以把执行语句给更改</strong></p><h3 id="存储过程的查看"><a href="#存储过程的查看" class="headerlink" title="存储过程的查看"></a>存储过程的查看</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">查看建表过程的语句</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create table</span> emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">查看创建存储过程的语句</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">procedure</span> p1;</span><br></pre></td></tr></table></figure><p>通过系统表information_schema.ROUTINES查看存储过程的详细信息：</p><p>在mysql当中，只要创建一个存储过程对象，在information_schema.ROUTINES系统表当中就会增加一条记录，这条记录是专门描述该存储过程对象状态的<br>information_schema.ROUTINES 是 MySQL 数据库中一个系统表，存储了所有存储过程、函数、触发器的详细信息，包括名称、返回值类型、参数、创建时间、修改时间等。</p><p>information_schema.ROUTINES 表中的一些重要的列包括：</p><ul><li>SPECIFIC_NAME：存储过程的具体名称，包括该存储过程的名字，参数列表。</li><li>ROUTINE_SCHEMA：存储过程所在的数据库名称。</li><li>ROUTINE_NAME：存储过程的名称。</li><li>ROUTINE_TYPE：PROCEDURE表示是一个存储过程，FUNCTION表示是一个函数。</li><li>ROUTINE_DEFINITION：存储过程的定义语句。</li><li>CREATED：存储过程的创建时间。</li><li>LAST_ALTERED：存储过程的最后修改时间。</li><li>DATA_TYPE：存储过程的返回值类型、参数类型等。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#查询表结构</span><br><span class="line"><span class="keyword">desc</span> information_schema.ROUTINES;</span><br><span class="line"></span><br><span class="line">#然后查系统表的结构</span><br><span class="line"><span class="keyword">select</span> SPECIFIC_NAME <span class="keyword">from</span> information_schema.ROUTINES <span class="keyword">where</span> ROUTINE_NAME<span class="operator">=</span><span class="string">&#x27;p1&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="存储过程的删除"><a href="#存储过程的删除" class="headerlink" title="存储过程的删除"></a>存储过程的删除</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop procedure if exists p1;</span><br></pre></td></tr></table></figure><h3 id="delimiter命令"><a href="#delimiter命令" class="headerlink" title="delimiter命令"></a>delimiter命令</h3><p>在 MySQL 中，<code>delimiter</code> 命令用于改变 MySQL 解释语句的定界符。MySQL 默认使用分号 <code>;</code> 作为语句的定界符。而使用 <code>delimiter</code> 命令可以将分号 <code>;</code> 更改为其他字符，从而可以在 SQL 语句中使用分号 <code>;</code>。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delimiter <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">这样就可以把;执行改为<span class="operator">/</span><span class="operator">/</span>执行</span><br></pre></td></tr></table></figure><h2 id="MySQL的变量"><a href="#MySQL的变量" class="headerlink" title="MySQL的变量"></a>MySQL的变量</h2><p>mysql中的变量包括：系统变量、用户变量、局部变量。</p><h3 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h3><p>MySQL 系统变量是指在 MySQL 服务器运行时控制其行为的参数。这些变量可以被设置为特定的值来改变服务器的默认设置，以满足不同的需求。比如想把dml的自动提交给改成手动提交，就可以用系统变量。<br>MySQL 系统变量可以具有全局（global）或会话（session）作用域。</p><ul><li>全局作用域是指对所有连接和所有数据库都适用；</li><li>会话作用域是指只对当前连接和当前数据库适用。</li></ul><p>查看系统变量：variables是变量的意思</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> [<span class="keyword">global</span><span class="operator">|</span>session] variables;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> [<span class="keyword">global</span><span class="operator">|</span>session] variables <span class="keyword">like</span> <span class="string">&#x27;&#x27;</span>;模糊查找</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> @@[<span class="keyword">global</span><span class="operator">|</span>session.]系统变量名;</span><br></pre></td></tr></table></figure><p>注意：没有指定session或global时，默认是session。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">查看所有的系统变量</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">show</span> variables;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> variables;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">隐约知道某个系统变量的名字，但是不知道具体的全名，可以使用like进行模糊查找</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%char%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">当知道具体的系统变量名的时候，也可以使用以下方式来查看系统变量的值</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@global</span>.autocommit;</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@session</span>.autocommit;</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@autocommit</span>;默认是session会话级</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">在这里，当前会话的自动提交机制还没有关闭，是支持自动提交的</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">insert into</span> dept(deptno,dname,loc) <span class="keyword">values</span> (<span class="number">50</span>,<span class="string">&#x27;销售部&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">将当前会话的自动提交机制关闭</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">set</span> session autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">set</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">在这里，当前会话的自动提交机制关闭了</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">insert into</span> dept(deptno,dname,loc) <span class="keyword">values</span>(<span class="number">60</span>,<span class="string">&#x27;研发部&#x27;</span>,<span class="string">&#x27;上海&#x27;</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*修改全局作用域的自动提交机制，将其关闭*/</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>设置系统变量</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> [<span class="keyword">global</span> <span class="operator">|</span> session] 系统变量名 <span class="operator">=</span> 值;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> @@[<span class="keyword">global</span> <span class="operator">|</span> session.]系统变量名 <span class="operator">=</span> 值;一般不用这个</span><br></pre></td></tr></table></figure><p>注意：无论是全局设置还是会话设置，当mysql服务（就是彻底停止）重启之后，之前配置都会失效。可以通过修改MySQL根目录下的my.ini配置文件达到永久修改的效果。（my.ini是MySQL数据库默认的系统级配置文件，默认是不存在的，需要新建，并参考一些资料进行配置。）<br>windows系统是my.ini<br>linux系统是my.cnf<br>my.ini文件通常放在mysql安装的根目录下，如下图：<br><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250325184842189.png" alt="image-20250325184842189"><br>这个文件通常是不存在的，可以新建，新建后例如提供以下配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">autocommit=0</span><br></pre></td></tr></table></figure><p>这种配置就表示永久性关闭自动提交机制。（不建议这样做。）</p><h3 id="用户变量"><a href="#用户变量" class="headerlink" title="用户变量"></a>用户变量</h3><p>用户自定义的变量。只在<strong>当前会话</strong>有效。所有的用户变量‘@’开始。</p><p>给用户变量赋值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="variable">@name</span> <span class="operator">=</span> <span class="string">&#x27;jackson&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@age</span> :<span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@gender</span> :<span class="operator">=</span> <span class="string">&#x27;男&#x27;</span>, <span class="variable">@addr</span> :<span class="operator">=</span> <span class="string">&#x27;北京大兴区&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@email</span> :<span class="operator">=</span> <span class="string">&#x27;jackson@123.com&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> sal <span class="keyword">into</span> <span class="variable">@sal</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="operator">=</span><span class="string">&#x27;SMITH&#x27;</span>;</span><br><span class="line">#这个就是把查询名字为史密斯的工资赋值给<span class="variable">@sal</span></span><br></pre></td></tr></table></figure><p>读取用户变量的值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="variable">@name</span>, <span class="variable">@age</span>, <span class="variable">@gender</span>, <span class="variable">@addr</span>, <span class="variable">@email</span>, <span class="variable">@sal</span>;</span><br></pre></td></tr></table></figure><p>注意：mysql中变量不需要声明。直接赋值就行。如果没有声明变量，直接读取该变量，<strong>返回null</strong></p><h3 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h3><h2 id="局部变量-1"><a href="#局部变量-1" class="headerlink" title="局部变量"></a>局部变量</h2><p>在存储过程中可以使用局部变量。使用declare声明。在begin和end之间有效。</p><p>变量的声明</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> 变量名 数据类型 [<span class="keyword">default</span> ...];#默认值可以不加</span><br></pre></td></tr></table></figure><p>变量的数据类型就是表字段的数据类型，例如：int、bigint、char、varchar、date、time、datetime等。<br><strong>注意：declare通常出现在begin end之间的开始部分。</strong></p><p>变量的赋值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> 变量名 <span class="operator">=</span> 值;</span><br><span class="line"><span class="keyword">set</span> 变量名 :<span class="operator">=</span> 值;不加冒号也可以</span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">into</span> 变量名 <span class="keyword">from</span> 表名 ...;</span><br></pre></td></tr></table></figure><p>例如：以下程序演示局部变量的声明、赋值、读取：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> p3();#如果存在p3则删除</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">PROCEDURE</span> p2()</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line"><span class="comment">/*声明变量*/</span></span><br><span class="line"><span class="keyword">declare</span> emp_count <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">/*声明变量*/</span></span><br><span class="line"><span class="keyword">declare</span> sal <span class="keyword">double</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">default</span> <span class="number">0.0</span>;</span><br><span class="line"><span class="comment">/*给变量赋值*/</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">into</span> emp_count <span class="keyword">from</span> emp;</span><br><span class="line"><span class="comment">/*给变量赋值*/</span></span><br><span class="line"><span class="keyword">set</span> sal :<span class="operator">=</span> <span class="number">5000.0</span>;#不加冒号也可以</span><br><span class="line"><span class="comment">/*读取变量的值*/</span></span><br><span class="line"><span class="keyword">select</span> emp_count;</span><br><span class="line"><span class="comment">/*读取变量的值*/</span></span><br><span class="line"><span class="keyword">select</span> sal;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> p2();</span><br><span class="line"><span class="keyword">select</span> emp_count,sal;#会报错，因为这个变量只是在存储过程里的局部变量，在外面无法访问</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@emp_count</span>,<span class="variable">@sal</span>;#这个可以访问，但访问的是用户变量，没有赋值的为<span class="keyword">null</span></span><br></pre></td></tr></table></figure><h2 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a>if语句</h2><p>语法格式：和java比，elseif中间会有个空格</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if 条件 <span class="keyword">then</span></span><br><span class="line">......</span><br><span class="line">elseif 条件 <span class="keyword">then</span></span><br><span class="line">......</span><br><span class="line">elseif 条件 <span class="keyword">then</span></span><br><span class="line">......</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">......</span><br><span class="line"><span class="keyword">end</span> if;</span><br></pre></td></tr></table></figure><p>案例：员工月薪sal，超过10000的属于“高收入”，6000到10000的属于“中收入”，少于6000的属于“低收入”。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> p4;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p4()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 声明一个局部变量，用来存储月薪 */</span></span><br><span class="line"><span class="keyword">declare</span> sal <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 声明一个局部变量，用来存储等级 */</span></span><br><span class="line"><span class="keyword">declare</span> grade <span class="type">varchar</span>(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 给局部变量sal赋值 */</span></span><br><span class="line"><span class="keyword">set</span> sal <span class="operator">=</span> <span class="number">7000</span>;</span><br><span class="line">if sal<span class="operator">&gt;</span><span class="number">10000</span> <span class="keyword">then</span> <span class="keyword">set</span> grade <span class="operator">=</span> <span class="string">&#x27;高收入&#x27;</span>;</span><br><span class="line">elseif sal <span class="operator">&gt;</span><span class="number">6000</span> <span class="keyword">then</span> <span class="keyword">set</span> grade <span class="operator">=</span><span class="string">&#x27;中收入&#x27;</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">set</span> grade<span class="operator">=</span><span class="string">&#x27;低收入&#x27;</span>;</span><br><span class="line"><span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">select</span> grade;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">/* 调用存储过程 */</span></span><br><span class="line"><span class="keyword">call</span> p4();</span><br></pre></td></tr></table></figure><h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><p>存储过程的参数包括三种形式：</p><ul><li>in：入参（未指定时，默认是in），用来接收调用者传过来的数据</li><li>out：出参，用来保存整个存储过程的执行结果</li><li>inout：既是入参，又是出参</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="comment">//定义方法</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>&#123;<span class="comment">//这个a和b就是入参，被传的参数</span></span><br><span class="line">       <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> a+b ;</span><br><span class="line">       <span class="keyword">return</span> c;<span class="comment">//c就是出参</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>案例：员工月薪sal，超过10000的属于“高收入”，6000到10000的属于“中收入”，少于6000的属于“低收入”。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> p5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p5(<span class="keyword">in</span> sal <span class="type">int</span>,<span class="keyword">out</span> grade <span class="type">varchar</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">if sal<span class="operator">&gt;</span><span class="number">10000</span> <span class="keyword">then</span> <span class="keyword">set</span> grade <span class="operator">=</span> <span class="string">&#x27;高收入&#x27;</span>;</span><br><span class="line">elseif sal <span class="operator">&gt;</span><span class="number">6000</span> <span class="keyword">then</span> <span class="keyword">set</span> grade <span class="operator">=</span><span class="string">&#x27;中收入&#x27;</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">set</span> grade<span class="operator">=</span><span class="string">&#x27;低收入&#x27;</span>;</span><br><span class="line"><span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><p>在这里怎么获取到这个存储过程的执行结果呢？在存储过程外面只能访问到用户变量，而上面的grade是局部变量，就需要在call里写一个用于接收out出来的变量，怎么起名字都可以</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> p5(<span class="number">7000</span>,<span class="variable">@salgrade</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@salgrade</span>;</span><br></pre></td></tr></table></figure><h2 id="case语句"><a href="#case语句" class="headerlink" title="case语句"></a>case语句</h2><p>语法格式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> 值</span><br><span class="line"><span class="keyword">when</span> 值<span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">......</span><br><span class="line"><span class="keyword">when</span> 值<span class="number">2</span> <span class="keyword">then</span></span><br><span class="line">......</span><br><span class="line"><span class="keyword">when</span> 值<span class="number">3</span> <span class="keyword">then</span></span><br><span class="line">......</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">......</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">case</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span>#不加值的话<span class="keyword">when</span>后边就是个布尔语句</span><br><span class="line"><span class="keyword">when</span> 条件<span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">......</span><br><span class="line"><span class="keyword">when</span> 条件<span class="number">2</span> <span class="keyword">then</span></span><br><span class="line">......</span><br><span class="line"><span class="keyword">when</span> 条件<span class="number">3</span> <span class="keyword">then</span></span><br><span class="line">......</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">......</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">case</span>;</span><br></pre></td></tr></table></figure><p>案例：根据不同月份，输出不同的季节。3 4 5月份春季。6 7 8月份夏季。9 10 11月份秋季。12 1 2 冬季。其他非法。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> p8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p8(<span class="keyword">in</span> <span class="keyword">month</span> <span class="type">int</span>, <span class="keyword">out</span> season <span class="type">varchar</span>(<span class="number">100</span>))</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line"><span class="keyword">case</span> <span class="keyword">month</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">3</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;春季&#x27;</span>;</span><br><span class="line"><span class="keyword">when</span> <span class="number">4</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;春季&#x27;</span>;</span><br><span class="line"><span class="keyword">when</span> <span class="number">5</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;春季&#x27;</span>;</span><br><span class="line"><span class="keyword">when</span> <span class="number">6</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;夏季&#x27;</span>;</span><br><span class="line"><span class="keyword">when</span> <span class="number">7</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;夏季&#x27;</span>;</span><br><span class="line"><span class="keyword">when</span> <span class="number">8</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;夏季&#x27;</span>;</span><br><span class="line"><span class="keyword">when</span> <span class="number">9</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;秋季&#x27;</span>;</span><br><span class="line"><span class="keyword">when</span> <span class="number">10</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;秋季&#x27;</span>;</span><br><span class="line"><span class="keyword">when</span> <span class="number">11</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;秋季&#x27;</span>;</span><br><span class="line"><span class="keyword">when</span> <span class="number">12</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;冬季&#x27;</span>;</span><br><span class="line"><span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;冬季&#x27;</span>;</span><br><span class="line"><span class="keyword">when</span> <span class="number">2</span> <span class="keyword">then</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;冬季&#x27;</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;非法月份&#x27;</span>;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">case</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* case的第二周语法格式*/</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p8(<span class="keyword">in</span> <span class="keyword">month</span> <span class="type">int</span>, <span class="keyword">out</span> season <span class="type">varchar</span>(<span class="number">100</span>))</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line"><span class="keyword">case</span> </span><br><span class="line"><span class="keyword">when</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">3</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">4</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">5</span> <span class="keyword">then</span> </span><br><span class="line"><span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;春季&#x27;</span>;</span><br><span class="line"><span class="keyword">when</span>  <span class="keyword">month</span> <span class="operator">=</span> <span class="number">6</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">7</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">8</span>  <span class="keyword">then</span> </span><br><span class="line"><span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;夏季&#x27;</span>;</span><br><span class="line"><span class="keyword">when</span>  <span class="keyword">month</span> <span class="operator">=</span> <span class="number">9</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">10</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">11</span>  <span class="keyword">then</span> </span><br><span class="line"><span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;秋季&#x27;</span>;</span><br><span class="line"><span class="keyword">when</span>  <span class="keyword">month</span> <span class="operator">=</span> <span class="number">12</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">1</span> <span class="keyword">or</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="number">2</span>  <span class="keyword">then</span> </span><br><span class="line"><span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;冬季&#x27;</span>;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line"><span class="keyword">set</span> season :<span class="operator">=</span> <span class="string">&#x27;非法月份&#x27;</span>;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">case</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> p8(<span class="number">9</span>, <span class="variable">@season</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@season</span>;</span><br></pre></td></tr></table></figure><h2 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h2><p>语法格式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">while 条件 do</span><br><span class="line">循环体;</span><br><span class="line"><span class="keyword">end</span> while;</span><br></pre></td></tr></table></figure><p>案例：传入一个数字n，计算1~n中所有偶数的和。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p9(<span class="keyword">in</span> n <span class="type">int</span>,<span class="keyword">out</span> sum <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">ser sum <span class="operator">=</span> <span class="number">0</span>;j </span><br><span class="line">while n <span class="operator">&gt;</span> <span class="number">0</span> do#确定不为<span class="number">0</span></span><br><span class="line">  if n <span class="operator">%</span> <span class="number">2</span> <span class="operator">=</span> <span class="number">0</span> <span class="keyword">then</span>#嵌套if语句</span><br><span class="line">    <span class="keyword">set</span> sum :<span class="operator">=</span> sum <span class="operator">+</span> n;</span><br><span class="line">  <span class="keyword">end</span> if;</span><br><span class="line">  <span class="keyword">set</span> n :<span class="operator">=</span> n <span class="operator">-</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span> while;#这里结束循环</span><br><span class="line"><span class="keyword">select</span> sum;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> mypro(<span class="number">10</span>);</span><br></pre></td></tr></table></figure><h2 id="repeat循环"><a href="#repeat循环" class="headerlink" title="repeat循环"></a>repeat循环</h2><p>语法格式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">repeat</span><br><span class="line">循环体;</span><br><span class="line">until 条件</span><br><span class="line"><span class="keyword">end</span> repeat;</span><br></pre></td></tr></table></figure><p>注意：和while的区别是repeat条件成立时结束循环。</p><p>案例：传入一个数字n，计算1~n中所有偶数的和。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p10(<span class="keyword">in</span> n <span class="type">int</span>, <span class="keyword">out</span> sum <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line"><span class="keyword">set</span> sum :<span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">repeat </span><br><span class="line">if n <span class="operator">%</span> <span class="number">2</span> <span class="operator">=</span> <span class="number">0</span> <span class="keyword">then</span> </span><br><span class="line">  <span class="keyword">set</span> sum :<span class="operator">=</span> sum <span class="operator">+</span> n;</span><br><span class="line"><span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">set</span> n :<span class="operator">=</span> n <span class="operator">-</span> <span class="number">1</span>;</span><br><span class="line">until n <span class="operator">&lt;=</span> <span class="number">0</span>    #结束条件</span><br><span class="line"><span class="keyword">end</span> repeat;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> p10(<span class="number">10</span>, <span class="variable">@sum</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@sum</span>;</span><br></pre></td></tr></table></figure><h2 id="loop循环"><a href="#loop循环" class="headerlink" title="loop循环"></a>loop循环</h2><p>语法格式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> mypro()</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line"><span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">  mylp:loop #开始，mylp是起的名字</span><br><span class="line"><span class="keyword">set</span> i :<span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">if i <span class="operator">=</span> <span class="number">5</span> <span class="keyword">then</span> </span><br><span class="line">leave mylp;#这是结束循环体,相当于break，不加就是死循环</span><br><span class="line"><span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">select</span> i;</span><br><span class="line"><span class="keyword">end</span> loop; #结束</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> mypro()</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line"><span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">  mylp:loop </span><br><span class="line"><span class="keyword">set</span> i :<span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">if i <span class="operator">=</span> <span class="number">5</span> <span class="keyword">then</span> </span><br><span class="line">iterate mylp;#相当于java的continue，结束本次循环，执行下一次循环</span><br><span class="line"><span class="keyword">end</span> if;</span><br><span class="line">if i <span class="operator">=</span> <span class="number">10</span> <span class="keyword">then</span> </span><br><span class="line">  leave mylp;</span><br><span class="line"><span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">select</span> i;</span><br><span class="line"><span class="keyword">end</span> loop;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><p>案例：输出1-5，然后又添加新的需求：输出1234 6789</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> p11;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p11()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">myloop:loop</span><br><span class="line"><span class="keyword">set</span> i <span class="operator">=</span> i <span class="operator">+</span><span class="number">1</span>;#这里就无限增长</span><br><span class="line"><span class="comment">/*if i = 6 then leave myloop;是1-5*/</span></span><br><span class="line">if i <span class="operator">=</span> <span class="number">5</span> <span class="keyword">then</span></span><br><span class="line">iterate myloop;#i为<span class="number">5</span>就跳过这次循环到下一次</span><br><span class="line"><span class="keyword">end</span> if;</span><br><span class="line"></span><br><span class="line">if i <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">leave myloop;#为<span class="number">10</span>就停止</span><br><span class="line"><span class="keyword">end</span> if;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> i;</span><br><span class="line"><span class="keyword">end</span> loop;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">call</span> p11;</span><br></pre></td></tr></table></figure><h2 id="游标cursor"><a href="#游标cursor" class="headerlink" title="游标cursor"></a>游标cursor</h2><p>游标（cursor）可以理解为一个指向结果集中某条记录的指针，允许程序逐一访问结果集中的每条记录，并对其进行逐行操作和处理。</p><p>声明游标的语法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> 游标名称 <span class="keyword">cursor</span> <span class="keyword">for</span> 查询语句;</span><br></pre></td></tr></table></figure><p>打开游标的语法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> 游标名称;</span><br></pre></td></tr></table></figure><p>通过游标取数据的语法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fetch</span> 游标名称 <span class="keyword">into</span> 变量[,变量,变量......]</span><br></pre></td></tr></table></figure><p>关闭游标的语法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">close</span> 游标名称;</span><br></pre></td></tr></table></figure><p>案例：从dept表查询部门编号和部门名，创建一张新表dept2，将查询结果插入到新表中。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> p12;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p12()</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line"><span class="comment">/*声明变量*/</span></span><br><span class="line"><span class="keyword">declare</span> dept_no <span class="type">int</span>;</span><br><span class="line"><span class="keyword">declare</span> dept_name <span class="type">varchar</span>(<span class="number">255</span>);</span><br><span class="line"><span class="comment">/*声明游标*/</span></span><br><span class="line"><span class="keyword">declare</span> dept_cursor <span class="keyword">cursor</span> <span class="keyword">for</span> <span class="keyword">select</span> deptno,dname <span class="keyword">from</span> dept;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*创建新表*/</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> dept2;</span><br><span class="line"><span class="keyword">create table</span> dept2(</span><br><span class="line">deptno <span class="type">int</span>,</span><br><span class="line">dname <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*打开游标*/</span></span><br><span class="line"><span class="keyword">open</span> dept_cursor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*通过游标取数据*/</span></span><br><span class="line"><span class="comment">/*fetch dept_cursor into dept_no,dept_name;*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*查看以下变量的值*/</span></span><br><span class="line"><span class="comment">/*select dept_no,dept_name;*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*使用循环从游标中取数据*/</span></span><br><span class="line">while <span class="literal">true</span> do</span><br><span class="line"><span class="keyword">fetch</span> dept_cursor <span class="keyword">into</span> dept_no,dept_name;</span><br><span class="line"><span class="comment">/*插入到新表*/</span></span><br><span class="line"><span class="keyword">insert into</span> dept2(deptno,name) <span class="keyword">values</span>(dept_no,dept_name);</span><br><span class="line"><span class="keyword">end</span> while;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*关闭游标*/</span></span><br><span class="line"><span class="keyword">close</span> dept_cursor;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> mypro();</span><br></pre></td></tr></table></figure><h2 id="捕捉异常并处理"><a href="#捕捉异常并处理" class="headerlink" title="捕捉异常并处理"></a>捕捉异常并处理</h2><p>语法格式：这里要填三个空，DECLARE (1) HANDLER FOR   (2)(3)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DECLARE handler_name HANDLER FOR condition_value action_statement</span><br></pre></td></tr></table></figure><ol><li>handler_name 表示异常处理程序的名称，重要取值包括：<ol><li>CONTINUE：发生异常后，程序不会终止，会正常执行后续的过程。(捕捉)</li><li>EXIT：发生异常后，终止存储过程的执行。（上抛）</li></ol></li><li>condition_value 是指捕获的异常，重要取值包括：<ol><li>SQLSTATE sqlstate_value，可以自定义，例如：SQLSTATE ‘02000’</li><li>SQLWARNING，代表所有01开头的SQLSTATE</li><li>NOT FOUND，代表所有02开头的SQLSTATE</li><li>SQLEXCEPTION，代表除了01和02开头的所有SQLSTATE</li></ol></li><li>action_statement 是指异常发生时执行的语句，例如：CLOSE cursor_name</li></ol><p>给之前的游标添加异常处理机制：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*存储过程中的异常处理机制。异常的捕捉和处理</span></span><br><span class="line"><span class="comment">实现的功能：以上的p12存储过程中有异常发生了，我们要处理一下，如果发生的异常是notfound，则关闭游标，并且退出存储过程*/</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> p12;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p12()</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line"><span class="keyword">declare</span> dept_no <span class="type">int</span>;</span><br><span class="line"><span class="keyword">declare</span> dept_name <span class="type">varchar</span>(<span class="number">255</span>);</span><br><span class="line"><span class="keyword">declare</span> dept_cursor <span class="keyword">cursor</span> <span class="keyword">for</span> <span class="keyword">select</span> deptno,dname <span class="keyword">from</span> dept;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*通常在这个位置进行异常的处理*/</span></span><br><span class="line"><span class="keyword">declare</span> exit handler <span class="keyword">for</span> <span class="keyword">not</span> found <span class="keyword">close</span> dept_cursor;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> dept2;</span><br><span class="line"><span class="keyword">create table</span> dept2(</span><br><span class="line">deptno <span class="type">int</span>,</span><br><span class="line">dname <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> dept_cursor;</span><br><span class="line"></span><br><span class="line">while <span class="literal">true</span> do</span><br><span class="line"><span class="keyword">fetch</span> dept_cursor <span class="keyword">into</span> dept_no,dept_name;</span><br><span class="line"><span class="keyword">insert into</span> dept2(deptno,name) <span class="keyword">values</span>(dept_no,dept_name);</span><br><span class="line"><span class="keyword">end</span> while;</span><br><span class="line"><span class="keyword">close</span> dept_cursor;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> mypro();</span><br></pre></td></tr></table></figure><h2 id="存储函数"><a href="#存储函数" class="headerlink" title="存储函数"></a>存储函数</h2><p>存储函数：带返回值的存储过程。参数只允许是in（但不能写显示的写in）。没有out，也没有inout。<br>语法格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION 存储函数名称(参数列表) RETURNS 数据类型 [特征]</span><br><span class="line">BEGIN</span><br><span class="line">--函数体</span><br><span class="line">RETURN ...;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure><p>“特征”的可取重要值如下：</p><ul><li>deterministic：用该特征标记该函数为确定性函数（什么是确定性函数？每次调用函数时传同一个参数的时候，返回值都是固定的，比如传100返回120，第二次如果为123就不是确定性的）。这是一种优化策略，这种情况下整个函数体的执行就会省略了，直接返回之前缓存的结果，来提高函数的执行效率。</li><li>no sql：用该特征标记该函数执行过程中不会查询数据库，如果确实没有查询语句建议使用。告诉 MySQL 优化器不需要考虑使用查询缓存和优化器缓存来优化这个函数，这样就可以避免不必要的查询消耗产生，从而提高性能。</li><li>reads sql data：用该特征标记该函数会进行查询操作，告诉 MySQL 优化器这个函数需要查询数据库的数据，可以使用查询缓存来缓存结果，从而提高查询性能；同时 MySQL 还会针对该函数的查询进行优化器缓存处理。</li></ul><p>案例：计算1~n的所有偶数之和</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">存储函数</span></span><br><span class="line"><span class="comment">案例：计算1-n的所有偶数之和</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> if <span class="keyword">exists</span> sum_fun;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> sum_fun(n <span class="type">int</span>) <span class="keyword">returns</span> <span class="type">int</span> <span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">result</span> <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">while n<span class="operator">&gt;</span><span class="number">0</span> do</span><br><span class="line">if n<span class="operator">%</span><span class="number">2</span> <span class="operator">=</span> <span class="number">0</span> <span class="keyword">then</span> </span><br><span class="line"><span class="keyword">set</span> <span class="keyword">result</span> <span class="operator">=</span> <span class="keyword">result</span> <span class="operator">+</span>n;</span><br><span class="line"><span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">set</span> n <span class="operator">=</span> n <span class="operator">-</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span> while;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">result</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*调用存储函数*/</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@result</span> <span class="operator">=</span> sum_fun(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@result</span>;</span><br></pre></td></tr></table></figure><h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p>MySQL 触发器是一种数据库对象，它是与表相关联的特殊程序。它可以在特定的数据操作（例如插入（INSERT）、更新（UPDATE）或删除（DELETE））触发时自动执行。MySQL 触发器使数据库开发人员能够在数据的不同状态之间维护一致性和完整性，并且可以为特定的数据库表自动执行操作。</p><p>触发器的作用主要有以下几个方面：</p><ol><li>强制实施业务规则：触发器可以帮助确保数据表中的业务规则得到强制执行，例如检查插入或更新的数据是否符合某些规则。 </li><li>数据审计：触发器可以声明在执行数据修改时自动记日志或审计数据变化的操作，使数据对数据库管理员和 SQL 审计人员更易于追踪和审计。 </li><li>执行特定业务操作：触发器可以自动执行特定的业务操作，例如计算数据行的总数、计算平均值或总和等。</li></ol><p>MySQL 触发器分为两种类型: BEFORE 和 AFTER。BEFORE 触发器在执行 INSERT、UPDATE、DELETE 语句之前执行，而 AFTER 触发器在执行 INSERT、UPDATE、DELETE 语句之后执行。</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg"></p><p>创建触发器的语法如下：FOR EACH ROW是解释一下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TRIGGER trigger_name</span><br><span class="line">BEFORE/AFTER INSERT/UPDATE/DELETE ON table_name FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">-- 触发器执行的 SQL 语句</span><br><span class="line">END;</span><br></pre></td></tr></table></figure><p>其中：</p><ul><li>trigger_name：触发器的名称</li><li>BEFORE&#x2F;AFTER：触发器的类型，可以是 BEFORE 或者 AFTER</li><li>INSERT&#x2F;UPDATE&#x2F;DELETE：触发器所监控的 DML 调用类型</li><li>table_name：触发器所绑定的表名</li><li>FOR EACH ROW：表示触发器在每行受到 DML 的影响之后都会执行</li><li>触发器执行的 SQL 语句：该语句会在触发器被触发时执行</li></ul><p>需要注意的是，触发器是一种高级的数据库功能，只有在必要的情况下才应该使用，例如在需要实施强制性业务规则时。过多的触发器和复杂的触发器逻辑可能会影响查询性能和扩展性。</p><p><strong>关于触发器的NEW和OLD关键字：</strong><br>在 MySQL 触发器中，<strong>NEW</strong> 和 <strong>OLD</strong> 是两个特殊的关键字，用于引用在触发器中受到修改的行的新值和旧值。具体而言：</p><ul><li>NEW：在触发 INSERT 或 UPDATE 操作期间，NEW 用于引用将要插入或更新到表中的新行的值。</li><li>OLD：在触发 UPDATE 或 DELETE 操作期间，OLD 用于引用更新或删除之前在表中的旧行的值。</li></ul><p>通俗的讲，NEW 是指触发器执行的操作所要插入或更新到当前行中的新数据；而 OLD 则是指当前行在触发器执行前原本的数据。</p><p>案例：当我们对dept表中的数据进行insert delete update的时候，请将这些操作记录到日志表当中，日志表如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> oper_log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> oper_log(</span><br><span class="line">  id <span class="type">bigint</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">  table_name <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">not null</span> comment <span class="string">&#x27;操作的哪张表&#x27;</span>,</span><br><span class="line">  oper_type <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">not null</span> comment <span class="string">&#x27;操作类型包括insert delete update&#x27;</span>,</span><br><span class="line">  oper_time datetime <span class="keyword">not null</span> comment <span class="string">&#x27;操作时间&#x27;</span>,</span><br><span class="line">  oper_id <span class="type">bigint</span> <span class="keyword">not null</span> comment <span class="string">&#x27;操作的那行记录的id&#x27;</span>,</span><br><span class="line">  oper_desc text comment <span class="string">&#x27;操作描述&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>触发器需求：当向dept表当中insert插入数据之后（after），在oper_log表中记录日志</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> if <span class="keyword">exists</span> trigger_dept_insert;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trigger_dept_insert</span><br><span class="line"><span class="comment">/* 触发规则 插入一次触发一次*/</span></span><br><span class="line">after <span class="keyword">insert</span> <span class="keyword">on</span> dept <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="comment">/*一但触发之后要执行的sql语句</span></span><br><span class="line"><span class="comment">id是自增的，后面的concat连接字符串*/</span></span><br><span class="line"><span class="keyword">insert into</span> oper_log(id, table_name,oper_type,oper_time,oper_id,oper_desc) <span class="keyword">values</span> </span><br><span class="line">(<span class="keyword">null</span>,<span class="string">&#x27;dept&#x27;</span>,<span class="string">&#x27;insert&#x27;</span>,now(),new.deptno,concat(<span class="string">&#x27;插入数据:deptno=&#x27;</span>,new.deptno,<span class="string">&#x27;dname=&#x27;</span>,new.dname,<span class="string">&#x27;,loc=&#x27;</span>,new.loc));</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><p>触发器需求：更新dept表之后，在oper_log中记录日志</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> if <span class="keyword">exists</span> trigger_dept_update;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trigger_dept_update after <span class="keyword">update</span> <span class="keyword">on</span> dept <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">insert into</span> oper_log(id,table_name,oper_type,oper_time,oper_id,oper_desc) <span class="keyword">values</span> </span><br><span class="line">(<span class="keyword">null</span>,<span class="string">&#x27;dept&#x27;</span>,<span class="string">&#x27;update&#x27;</span>,now(),new.deptno,</span><br><span class="line">concat(<span class="string">&#x27;更新数据，更新前:deptno=&#x27;</span>,old.deptno,<span class="string">&#x27;,dname=&#x27;</span>,old.dname,<span class="string">&#x27;loc=&#x27;</span>,old.loc,<span class="string">&#x27;,更新后：deptno=&#x27;</span>,new.deptno,<span class="string">&#x27;dname=&#x27;</span>,new.dname,<span class="string">&#x27;,loc=&#x27;</span>,new.loc));</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><h1 id="第13章-存储引擎"><a href="#第13章-存储引擎" class="headerlink" title="第13章 存储引擎"></a>第13章 存储引擎</h1><h2 id="存储引擎概述"><a href="#存储引擎概述" class="headerlink" title="存储引擎概述"></a>存储引擎概述</h2><p>MySQL存储引擎决定了数据在磁盘上的存储方式和访问方式。不同的存储引擎实现了不同的存储和检索算法，因此它们在处理和管理数据的方式上存在差异。</p><p>MySQL常见的存储引擎包括InnoDB、MyISAM、Memory、Archive等。每个存储引擎都有自己的特点和适用场景。</p><p>例如，</p><ul><li>InnoDB引擎支持事务和行级锁定，适用于需要高并发读写的应用；</li><li>MyISAM引擎不支持事务，但适用于读操作较多的应用；</li><li>Memory引擎数据全部存储在内存中，适用于对读写速度要求很高的应用等等。</li></ul><p>选择适合的存储引擎可以提高MySQL的性能和效率，并且根据应用需求来合理选择存储引擎可以提供更好的数据管理和查询功能。</p><h2 id="MySQL支持哪些存储引擎"><a href="#MySQL支持哪些存储引擎" class="headerlink" title="MySQL支持哪些存储引擎"></a>MySQL支持哪些存储引擎</h2><p>使用<code>show engines \G;</code>命令可以查看所有的存储引擎：比如</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">      Engine: MEMORY</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: Hash based, stored <span class="keyword">in</span> memory, useful <span class="keyword">for</span> temporary tables</span><br><span class="line">Transactions: <span class="keyword">NO</span></span><br><span class="line">          XA: <span class="keyword">NO</span></span><br><span class="line">  Savepoints: <span class="keyword">NO</span></span><br></pre></td></tr></table></figure><p><code>Support</code>是<code>Yes</code>的表示支持该存储引擎。当前MySQL的版本是<code>8.0.33</code><br>MySQL默认的存储引擎是：<code>InnoDB</code></p><h2 id="指定和修改存储引擎"><a href="#指定和修改存储引擎" class="headerlink" title="指定和修改存储引擎"></a>指定和修改存储引擎</h2><h3 id="指定存储引擎"><a href="#指定存储引擎" class="headerlink" title="指定存储引擎"></a>指定存储引擎</h3><p>在MySQL中，你可以在创建表时指定使用的存储引擎。通过在CREATE TABLE语句中使用ENGINE关键字，你可以指定要使用的存储引擎。</p><p>以下是指定存储引擎的示例：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> my_table (column1 <span class="type">INT</span>, column2 <span class="type">VARCHAR</span>(<span class="number">50</span>)) ENGINE <span class="operator">=</span> InnoDB;</span><br></pre></td></tr></table></figure><p>如果你不显式指定存储引擎，MySQL将使用默认的存储引擎。默认情况下，MySQL 8的默认存储引擎是InnoDB。</p><h3 id="修改存储引擎"><a href="#修改存储引擎" class="headerlink" title="修改存储引擎"></a>修改存储引擎</h3><p>在MySQL中，你可以通过ALTER TABLE语句修改表的存储引擎。下面是修改存储引擎的示例：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> my_table ENGINE <span class="operator">=</span> MyISAM;</span><br></pre></td></tr></table></figure><p>在这个例子中，我们使用ALTER TABLE语句将my_table表的存储引擎修改为MyISAM。</p><p>请注意，在修改存储引擎之前，你需要考虑以下几点：</p><ol><li>修改存储引擎可能需要执行复制表的操作，因此可能会造成数据的丢失或不可用。确保在执行修改之前备份你的数据。 </li><li>不是所有的存储引擎都支持相同的功能。要确保你选择的新存储引擎支持你应用程序所需的功能。 </li><li>修改表的存储引擎可能会影响到现有的应用程序和查询。确保在修改之前评估和测试所有的影响。 </li><li>ALTER TABLE语句可能需要适当的权限才能执行。确保你拥有足够的权限来执行修改存储引擎的操作。</li></ol><p>总而言之，修改存储引擎需要谨慎进行，且需要考虑到可能的影响和风险。建议在进行修改之前进行适当的测试和备份。</p><h2 id="常用的存储引擎及适用场景"><a href="#常用的存储引擎及适用场景" class="headerlink" title="常用的存储引擎及适用场景"></a>常用的存储引擎及适用场景</h2><p>在实际开发中，以下存储引擎是比较常用的：</p><ol><li>InnoDB：<ol><li>MySQL默认的事务型存储引擎</li><li>支持ACID事务</li><li>具有较好的并发性能和数据完整性</li><li>支持行级锁定。</li><li>适用于大多数应用场景，尤其是需要事务支持的应用。</li></ol></li><li>MyISAM：<ol><li>是MySQL早期版本中常用的存储引擎</li><li>支持全文索引和表级锁定</li><li>不支持事务</li><li>由于其简单性和高性能，在某些特定的应用场景中会得到广泛应用，如<strong>读密集</strong>的应用。</li></ol></li><li>MEMORY：<ol><li>称为HEAP，是将表<strong>存储在内存</strong>中的存储引擎</li><li>具有非常高的读写性能，但数据会在服务器重启时丢失。</li><li>适用于需要快速读写的临时数据集、缓存和临时表等场景。</li></ol></li><li>CSV：<ol><li>将数据以<strong>纯文本</strong>格式存储的存储引擎</li><li>适用于需要处理和导入&#x2F;导出CSV格式数据的场景。</li></ol></li><li>ARCHIVE：<ol><li>将数据高效地进行<strong>压缩</strong>和存储的存储引擎</li><li>适用于需要长期存储大量历史数据且不经常查询的场景。</li></ol></li></ol><h1 id="第14章-索引"><a href="#第14章-索引" class="headerlink" title="第14章 索引"></a>第14章 索引</h1><h2 id="什么是索引（index）"><a href="#什么是索引（index）" class="headerlink" title="什么是索引（index）"></a>什么是索引（index）</h2><p>索引是一种能够提高检索（查询）效率的提前排好序的数据结构。例如：书的目录就是一种索引机制。索引是解决SQL慢查询的一种方式。</p><h2 id="索引的创建和删除"><a href="#索引的创建和删除" class="headerlink" title="索引的创建和删除"></a>索引的创建和删除</h2><h3 id="主键会自动添加索引"><a href="#主键会自动添加索引" class="headerlink" title="主键会自动添加索引"></a>主键会自动添加索引</h3><p>主键字段会自动添加索引，不需要程序员干涉，主键字段上的索引被称为<code>主键索引</code></p><h3 id="unique约束的字段自动添加索引"><a href="#unique约束的字段自动添加索引" class="headerlink" title="unique约束的字段自动添加索引"></a>unique约束的字段自动添加索引</h3><p>unique约束的字段也会自动添加索引，不需要程序员干涉，这种字段上添加的索引称为<code>唯一索引</code></p><h3 id="给指定的字段添加索引"><a href="#给指定的字段添加索引" class="headerlink" title="给指定的字段添加索引"></a>给指定的字段添加索引</h3><p>建表时添加索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> emp (</span><br><span class="line">    ...</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    ...</span><br><span class="line">    INDEX idx_name (name)</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如果表已经创建好了，后期给字段添加索引</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> emp <span class="keyword">ADD</span> INDEX idx_name (name);</span><br></pre></td></tr></table></figure><p>也可以这样添加索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_name <span class="keyword">on</span> emp(name);</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg"></p><h3 id="删除指定字段上的索引"><a href="#删除指定字段上的索引" class="headerlink" title="删除指定字段上的索引"></a>删除指定字段上的索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> emp <span class="keyword">DROP</span> INDEX idx_name;</span><br></pre></td></tr></table></figure><h3 id="查看某张表上添加了哪些索引"><a href="#查看某张表上添加了哪些索引" class="headerlink" title="查看某张表上添加了哪些索引"></a>查看某张表上添加了哪些索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure><h2 id="索引的分类"><a href="#索引的分类" class="headerlink" title="索引的分类"></a>索引的分类</h2><p>不同的<code>存储引擎</code>有不同的索引类型和实现：</p><ul><li>按照数据结构分类：<ul><li>B+树 索引（mysql的InnoDB存储引擎采用的就是这种索引）采用 B+树  的数据结构</li><li>Hash 索引（仅 <code>memory</code> 存储引擎支持）：采用  哈希表  的数据结构</li></ul></li><li>按照物理存储分类：<ul><li>聚集索引：索引和表中数据在一起，数据存储的时候就是按照索引顺序存储的。一张表只能有一个聚集索引。</li><li>非聚集索引：索引和表中数据是分开的，索引是独立于表空间的，一张表可以有多个非聚集索引。</li></ul></li><li>按照字段特性分类：<ul><li>主键索引（primary key）</li><li>唯一索引（unique）</li><li>普通索引（index）</li><li>全文索引（fulltext：仅 <code>InnoDB和MyISAM</code> 存储引擎支持）</li></ul></li><li>按照字段个数分类：<ul><li>单列索引、联合索引（也叫复合索引、组合索引）</li></ul></li></ul><h2 id="MySQL索引采用了B-树数据结构"><a href="#MySQL索引采用了B-树数据结构" class="headerlink" title="MySQL索引采用了B+树数据结构"></a>MySQL索引采用了B+树数据结构</h2><p>常见的树相关的数据结构包括：</p><ul><li>二叉树</li><li>红黑树</li><li>B树</li><li>B+树</li></ul><p>区别：树的高度不同。树的高度越低，性能越高。这是因为每一个节点都是一次I&#x2F;O</p><h3 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h3><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329173213108.png" alt="image-20250329173213108"></p><p>如果不给id字段添加索引，默认进行全表扫描，那至少要进行10次磁盘IO。可以给id字段添加索引，假设该索引使用了二叉树这种数据结构，这个二叉树是这样的</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329173357068.png" alt="image-20250329173357068"></p><p>如果这个时候要找id&#x3D;10的数据，需要的IO次数是？4次。效率显著提升了。</p><p>但是MySQL并没有直接使用这种普通的二叉树，这种普通二叉树在<code>数据极端</code>的情况下，效率较低。比如下面的数据</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329173419549.png" alt="image-20250329173419549"></p><p>如果给id字段添加索引，并且该索引底层使用了普通二叉树，这棵树会是这样的：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329173438375.png" alt="image-20250329173438375"></p><p>你虽然使用了二叉树，但这更像一个链表。查找效率等同于链表查询O(n)【<strong>查找算法的时间复杂度是线性的</strong>】。查找效率极低。<br>因此对于MySQL来说，它并没有选择这种数据结构作为索引。</p><h3 id="红黑树（自平衡二叉树）"><a href="#红黑树（自平衡二叉树）" class="headerlink" title="红黑树（自平衡二叉树）"></a>红黑树（自平衡二叉树）</h3><p>通过自旋平衡规则进行旋转，子节点会自动分叉为2个分支，从而减少树的高度，当数据有序插入时比二叉树数据检索性能更好。</p><p>给id字段添加索引，并且该索引使用了<code>红黑树</code>数据结构，那么会是这样：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329173501132.png" alt="image-20250329173501132"></p><p>如果查找id&#x3D;10的数据，磁盘IO次数为：5次。效率比普通二叉树要高一些。</p><p>但是如果数据量庞大，例如500万条数据，也会导致树的高度很高，磁盘IO次数仍然很多，查询效率也会比较低。</p><p>因此MySQL并没有使用红黑树这种数据结构作为索引。</p><h3 id="B-Trees（B树）"><a href="#B-Trees（B树）" class="headerlink" title="B Trees（B树）"></a>B Trees（B树）</h3><p>B Trees首先是一个<code>自平衡</code>的。<br>B Trees每个节点下的子节点数量 &gt; 2。<br>B Trees每个节点中也不是存储单个数据，可以存储多个数据。<br>B Trees又称为<code>平衡多路查找树</code>。</p><p>B Trees分支的数量不是2，是大于2，具体是多少个分支，由<code>阶</code>决定。例如：</p><ul><li>3阶的B Trees，一个节点下最多有3个子节点，每个节点中最多有2个数据。</li><li>4阶的B Trees，一个节点下最多有4个子节点，每个节点中最多有3个数据。</li><li>5阶（5, 4）</li><li>6阶（6, 5）</li><li>….</li><li>16阶（16, 15）【MySQL采用了16阶】</li></ul><p>采用B Trees，你会发现相同的数据量，<strong>B Tree 树的高度更低</strong>。磁盘IO次数更少。</p><p>更加详细的存储是这样的，请看下图</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329174543637.png" alt="image-20250329174543637"></p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329174546953.png" alt="image-20250329174546953"></p><p>在B Trees中，每个节点不仅存储了<code>索引值</code>，还存储该索引值对应的<code>数据行</code>。<br>并且每个节点中的p1 p2 p3是指向下一个节点的指针。</p><p>B Trees数据结构存在的缺点是：不适合做区间查找，对于区间查找效率较低。假设要查id在[3~7]之间的，需要查找的是3,4,5,6,7。那么查这每个索引值都需要从头(根）节点开始向下找。<br>因此MySQL使用了B+ Trees解决了这个问题。</p><h3 id="B-Trees（B-树）"><a href="#B-Trees（B-树）" class="headerlink" title="B+ Trees（B+ 树）"></a>B+ Trees（B+ 树）</h3><p>B+ Trees 相较于 B Trees改进了哪些？</p><ul><li>B+树将数据都存储在叶子节点中。并且叶子节点之间使用链表连接，这样很适合范围查询。</li><li>B+树的非叶子节点上只有索引值，没有数据，所以非叶子节点可以存储更多的索引值，这样让B+树更矮更胖，提高检索效率。</li></ul><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329183545137.png" alt="image-20250329183545137"></p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250329183548087.png" alt="image-20250329183548087"></p><p>**经典面试题：**mysql为什么选择B+树作为索引的数据结构，而不是B树？</p><ol><li>非叶子节点上可以存储更多的键值，阶数可以更大，更矮更胖，磁盘IO次数少，数据查询效率高。</li><li>所有数据都是有序存储在叶子节点上，让范围查找，分组查找效率更高。</li><li>数据页之间、数据记录之间采用链表链接，让升序降序更加方便操作。</li></ol><p>**经典面试题：**如果一张表没有主键索引，那还会创建B+树吗？<br>当一张表没有主键索引时，默认会使用一个隐藏的内置的聚集索引（clustered index）。这个聚集索引是基于表的物理存储顺序构建的，通常是使用B+树来实现的。</p><p>（老杜说如果没有主键索引之类的，会有一个看不见的row_id列，这个采用的也是b+树</p><h2 id="其他索引及相关调优"><a href="#其他索引及相关调优" class="headerlink" title="其他索引及相关调优"></a>其他索引及相关调优</h2><h3 id="Hash索引"><a href="#Hash索引" class="headerlink" title="Hash索引"></a>Hash索引</h3><p>支持Hash索引的存储引擎有：</p><ul><li>InnoDB（不支持手动创建Hash索引，系统会自动维护一个<code>自适应的Hash索引</code>）<ul><li>对于InnoDB来说，即使手动指定了某字段采用Hash索引，最终<code>show index from 表名</code>的时候，还是<code>BTREE</code>。</li></ul></li><li>Memory（支持Hash索引）</li></ul><p>Hash索引底层的数据结构就是哈希表。一个数组，数组中每个元素是链表。和java中HashMap一样。哈希表中每个元素都是key value结构。key存储<code>索引值</code>，value存储<code>行指针</code>。</p><p>原理如下：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330031102099.png" alt="image-20250330031102099"></p><p>如果name字段上添加了Hash索引idx_name</p><p>Hash索引长这个样子：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330031111481.png" alt="image-20250330031111481"></p><p>Hash索引优缺点：</p><ul><li>优点：只能用在等值比较中，效率很高。例如：name&#x3D;’孙悟空’</li><li>缺点：不支持排序，不支持范围查找。</li></ul><h3 id="聚集索引和非聚集索引"><a href="#聚集索引和非聚集索引" class="headerlink" title="聚集索引和非聚集索引"></a>聚集索引和非聚集索引</h3><p>按照数据的物理存储方式不同，可以将索引分为聚集索引（聚簇索引）和非聚集索引（非聚簇索引）。</p><p>存储引擎是InnoDB的，主键上的索引属于聚集索引。<br>存储引擎是MyISAM的，任意字段上的索引都是非聚集索引。</p><p>InnoDB的物理存储方式：当创建一张表t_user，并使用InnoDB存储引擎时，会在硬盘上生成这样一个文件：</p><ul><li>t_user.ibd （InnoDB data表索引 + 数据）</li><li>t_user.frm （存储表结构信息）</li></ul><p>MyISAM的物理存储方式：当创建一张表t_user，并使用MyISAM存储引擎时，会在硬盘上生成这样一个文件：</p><ul><li>t_user.MYD （表数据）</li><li>t_user.MYI （表索引）</li><li>t_user.frm （表结构）</li></ul><p><strong>注意：从MySQL8.0开始，不再生成frm文件了，引入了数据字典，用数据字典来统一存储表结构信息，例如：</strong></p><ul><li><strong>information_schema.TABLES （表包含了数据库中所有表的信息，例如表名、数据库名、引擎类型等）</strong></li><li><strong>information_schema.COLUMNS（表包含了数据库中所有表的列信息，例如列名、数据类型、默认值等）</strong></li></ul><p>聚集索引的原理图：（B+树，叶子节点上存储了索引值 + 数据）</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330031250867.png" alt="image-20250330031250867"></p><p>非聚集索引的原理图：（B+树，叶子节点上存储了索引值 + 行指针）</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330031257831.png" alt="image-20250330031257831"></p><p>聚集索引的优点和缺点：</p><ol><li>优点：聚集索引将数据存储在索引树的叶子节点上。可以减少一次查询，因为查询索引树的同时可以获取数据。</li><li>缺点：对数据进行修改或删除时需要更新索引树，会增加系统的开销。</li></ol><h3 id="二级索引"><a href="#二级索引" class="headerlink" title="二级索引"></a>二级索引</h3><p>二级索引也属于非聚集索引。也有人把二级索引称为辅助索引。<br>有表t_user，id是主键。age是非主键。在age字段上添加的索引称为二级索引。（所有非主键索引都是二级索引）</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330153957615.png" alt="image-20250330153957615"></p><p>二级索引的数据结构：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330154004773.png" alt="image-20250330154004773"></p><p>二级索引的查询原理：<br>假设查询语句为：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> age <span class="operator">=</span> <span class="number">30</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330154020322.png" alt="image-20250330154020322"></p><p>为什么会“回表”？因为使用了<code>select *</code>，查到了age&#x3D;30后会得到主键&#x3D;2，然后底层执行查主键&#x3D;2的数据再返回。<br>避免“回表【回到原数据表】”是提高SQL执行效率的手段。例如：select id from t_user where age &#x3D; 30; 这样的SQL语句是不需要回表的。</p><h3 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h3><p>覆盖索引（Covering Index），顾名思义，是指某个查询语句可以通过索引的覆盖来完成，而不需要回表查询真实数据。其中的覆盖指的是在执行查询语句时，查询需要的所有列都可以从索引中提取到，而不需要再去查询实际数据行获取查询所需数据。<br>当使用覆盖索引时，MySQL可以直接通过索引，也就是索引上的数据来获取所需的结果，而不必再去查找表中的数据。这样可以显著提高查询性能。</p><p>假设有一个用户表（user）包含以下列：id, username, email, age。</p><p>常见的查询是根据用户名查询用户的邮箱。如果为了提高这个查询的性能，可以创建一个覆盖索引，包含（username, email）这两列。</p><p>创建覆盖索引的SQL语句可以如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_username_email <span class="keyword">ON</span> <span class="keyword">user</span> (username, email);</span><br></pre></td></tr></table></figure><p>当执行以下查询时：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> email <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;lucy&#x27;</span>;</span><br></pre></td></tr></table></figure><p>MySQL可以直接使用覆盖索引（idx_user_username_email）来获取查询结果，而不必再去查找用户表中的数据。这样可以减少磁盘I&#x2F;O并提高查询效率。而如果没有覆盖索引，MySQL会先使用索引（username）来找到匹配的行，然后再回表查询获取邮箱，这个过程会增加更多的磁盘I&#x2F;O和查询时间。</p><h3 id="索引下推"><a href="#索引下推" class="headerlink" title="索引下推"></a>索引下推</h3><p>索引下推（Index Condition Pushdown）是一种 MySQL 中的优化方法，它可以将查询中的过滤条件下推到索引层级中处理，从而减少回表次数，优化查询性能。</p><p>具体来说，在使用索引下推时，MySQL 会在索引的叶节点层级执行查询的过滤条件，过滤掉无用的索引记录，仅返回符合条件的记录的主键，这样就可以避免查询时回表读取表格的数据行，从而缩短了整个查询过程的时间。</p><p>假设有以下表结构：</p><p>表名：users</p><table><thead><tr><th>id</th><th>name</th><th>age</th><th>city</th></tr></thead><tbody><tr><td>1</td><td>John</td><td>25</td><td>New York</td></tr><tr><td>2</td><td>Alice</td><td>30</td><td>London</td></tr><tr><td>3</td><td>Bob</td><td>40</td><td>Paris</td></tr><tr><td>4</td><td>Olivia</td><td>35</td><td>Berlin</td></tr><tr><td>5</td><td>Michael</td><td>28</td><td>Sydney</td></tr></tbody></table><p>现在我们创建了一个多列索引：（索引下推通常是基于多列索引的。）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE users ADD INDEX idx_name_city_age (name, city, age);</span><br></pre></td></tr></table></figure><p>假设我们要查询年龄大于30岁，并且所在城市是”London”的用户，假设只给age字段添加了索引，它就不会使用索引下推。传统的查询优化器会将所有满足年龄大于30岁的记录读入内存，然后再根据城市进行筛选。</p><p>使用索引下推优化后，在索引范围扫描的过程中，优化器会判断只有在城市列为”London”的情况下，才会将满足年龄大于30岁的记录加载到内存中。这样就可以避免不必要的IO和数据传输，提高查询性能。</p><p>具体的查询语句可以是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE age &gt; 30 AND city = &#x27;London&#x27;;</span><br></pre></td></tr></table></figure><p>在执行这个查询时，优化器会使用索引下推技术，先根据索引范围扫描找到所有满足条件的记录，然后再回到原数据表中获取完整的行数据，最终返回结果。</p><h3 id="单列索引（单一索引）"><a href="#单列索引（单一索引）" class="headerlink" title="单列索引（单一索引）"></a>单列索引（单一索引）</h3><p>单列索引是指对数据库表中的某一列或属性进行索引创建，对该列进行快速查找和排序操作。单列索引可以加快查询速度，提高数据库的性能。</p><p>举个例子，假设我们有一个学生表（student），其中有以下几个列：学生编号（student_id）、姓名（name）、年龄（age）和性别（gender）。</p><p>如果我们针对学生表的学生编号（student_id）列创建了单列索引，那么可以快速地根据学生编号进行查询或排序操作。例如，我们可以使用以下SQL语句查询学生编号为123456的学生信息：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student_id <span class="operator">=</span> <span class="number">123456</span>;</span><br></pre></td></tr></table></figure><p>由于我们对学生编号列建立了单列索引，所以数据库可以直接通过索引快速定位到具有学生编号123456的那一行记录，从而加快查询速度。</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg"></p><h3 id="复合索引（组合索引）"><a href="#复合索引（组合索引）" class="headerlink" title="复合索引（组合索引）"></a>复合索引（组合索引）</h3><p>复合索引（Compound Index）也称为多列索引（Multi-Column Index），是指对数据库表中多个列进行索引创建。</p><p>与单列索引不同，复合索引可以包含多个列。这样可以将多个列的值组合起来作为索引的键，以提高多列条件查询的效率。</p><p>举个例子，假设我们有一个订单表（Order），其中包含以下几个列：订单编号（OrderID）、客户编号（CustomerID）、订单日期（OrderDate）和订单金额（OrderAmount）。</p><p>如果我们为订单表的客户编号和订单日期这两列创建复合索引（CustomerID, OrderDate），那么可以在查询时同时根据客户编号和订单日期来快速定位到匹配的记录。</p><p>例如，我们可以使用以下SQL语句查询客户编号为123456且订单日期为2021-01-01的订单信息：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">Order</span> <span class="keyword">WHERE</span> CustomerID <span class="operator">=</span> <span class="number">123456</span> <span class="keyword">AND</span> OrderDate <span class="operator">=</span> <span class="string">&#x27;2021-01-01&#x27;</span>;</span><br></pre></td></tr></table></figure><p>由于我们为客户编号和订单日期创建了复合索引，数据库可以使用这个索引来快速定位到符合条件的记录，从而加快查询速度。复合索引的使用能够提高多列条件查询的效率，但需要注意的是，复合索引的创建和维护可能会增加索引的存储空间和对于写操作的影响。</p><p><strong>相对于单列索引，复合索引有以下几个优势：</strong></p><ol><li>减少索引的数量：复合索引可以包含多个列，因此可以减少索引的数量，减少索引的存储空间和维护成本。</li><li>提高查询性能：当查询条件中涉及到复合索引的多个列时，数据库可以使用复合索引进行快速定位和过滤，从而提高查询性能。</li><li>覆盖查询：如果复合索引包含了所有查询需要的列，那么数据库可以直接使用索引中的数据，而不需要再进行表的读取，从而提高查询性能。</li><li>排序和分组：由于复合索引包含多个列，因此可以用于排序和分组操作，从而提高排序和分组的性能。</li></ol><h2 id="索引的优缺点"><a href="#索引的优缺点" class="headerlink" title="索引的优缺点"></a>索引的优缺点</h2><p>索引是数据库中一种重要的数据结构，用于加速数据的检索和查询操作。它的优点和缺点如下：</p><p>优点：</p><ol><li>提高查询性能：通过创建索引，可以大大减少数据库查询的数据量，从而提升查询的速度。</li><li>加速排序：当查询需要按照某个字段进行排序时，索引可以加速排序的过程，提高排序的效率。</li><li>减少磁盘IO：索引可以减少磁盘IO的次数，这对于磁盘读写速度较低的场景，尤其重要。</li></ol><p>缺点：</p><ol><li>占据额外的存储空间：索引需要占据额外的存储空间，特别是在大型数据库系统中，索引可能占据较大的空间。</li><li>增删改操作的性能损耗：每次对数据表进行插入、更新、删除等操作时，需要更新索引，会导致操作的性能降低。</li><li>资源消耗较大：索引需要占用内存和CPU资源，特别是在大规模并发访问的情况下，可能对系统的性能产生影响。</li></ol><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg"></p><h2 id="何时用索引"><a href="#何时用索引" class="headerlink" title="何时用索引"></a>何时用索引</h2><p>在以下情况下建议使用索引：</p><ol><li>频繁执行查询操作的字段：如果这些字段经常被查询，使用索引可以提高查询的性能，减少查询的时间。 </li><li>大表：当表的数据量较大时，使用索引可以快速定位到所需的数据，提高查询效率。 </li><li>需要排序或者分组的字段：在对字段进行排序或者分组操作时，索引可以减少排序或者分组的时间。 </li><li>外键关联的字段：在进行表之间的关联查询时，使用索引可以加快关联查询的速度。</li></ol><p>在以下情况下不建议使用索引：</p><ol><li>频繁执行更新操作的表：如果表经常被更新数据，使用索引可能会降低更新操作的性能，因为每次更新都需要维护索引。 </li><li>小表：对于数据量较小的表，使用索引可能并不会带来明显的性能提升，反而会占用额外的存储空间。 </li><li>对于唯一性很差的字段（重复字段），一般不建议添加索引。当一个字段的唯一性很差时，查询操作基本上需要扫描整个表的大部分数据。如果为这样的字段创建索引，索引的大小可能会比数据本身还大，导致索引的存储空间占用过高，同时也会导致查询操作的性能下降。</li></ol><p>总之，索引需要根据具体情况进行使用和权衡，需要考虑到表的大小、查询频率、更新频率以及业务需求等因素。</p><h1 id="第15章-mysql优化"><a href="#第15章-mysql优化" class="headerlink" title="第15章 mysql优化"></a>第15章 mysql优化</h1><h2 id="MySQL优化手段"><a href="#MySQL优化手段" class="headerlink" title="MySQL优化手段"></a>MySQL优化手段</h2><p>MySQL数据库的优化手段通常包括但不限于：</p><ul><li>SQL查询优化：这是最低成本的优化手段，通过优化查询语句、适当添加索引等方式进行。并且效果显著。</li><li>库表结构优化：通过规范化设计、优化索引和数据类型等方式进行库表结构优化，需要对数据库结构进行调整和改进</li><li>系统配置优化：根据硬件和操作系统的特点，调整最大连接数、内存管理、IO调度等参数</li><li>硬件优化：升级硬盘、增加内存容量、升级处理器等硬件方面的投入，需要购买和替换硬件设备，成本较高</li></ul><p>我们主要掌握：SQL查询优化</p><h2 id="SQL性能分析工具"><a href="#SQL性能分析工具" class="headerlink" title="SQL性能分析工具"></a>SQL性能分析工具</h2><h3 id="查看数据库整体情况"><a href="#查看数据库整体情况" class="headerlink" title="查看数据库整体情况"></a>查看数据库整体情况</h3><p>通过以下命令可以查看当前数据库在SQL语句执行方面的整体情况：status状态</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;Com_select&#x27;</span>;<span class="operator">/</span><span class="operator">/</span>会显示查询的次数，以此类推</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;Com_insert&#x27;</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;Com_delete&#x27;</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;Com_update&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;Com_______&#x27;</span>;<span class="operator">/</span><span class="operator">/</span><span class="number">7</span>个</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330194023692.png" alt="image-20250330194023692"></p><p>这些结果反映了从 MySQL 服务器启动到当前时刻，所有的 SELECT 查询总数。对于 MySQL 性能优化来说，通过查看 <code>Com_select</code> 的值可以了解 SELECT 查询在整个 MySQL 服务期间所占比例的情况：</p><ul><li>如果 <code>Com_select</code> 次数过高，可能说明查询表中的每条记录都会返回过多的字段。</li><li>如果 <code>Com_select</code> 次数很少，同时insert或delete或update的次数很高，可能说明服务器运行的应用程序过于依赖写入操作和少量读取操作。</li></ul><p>总之，通过查看 <code>Com_select</code> 的值，可以了解 MySQL 服务器的长期执行情况，并在优化查询性能时，帮助我们了解 MySQL 的性能瓶颈。</p><h3 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h3><p>慢查询日志文件可以将查询较慢的DQL语句记录下来（比如select超过三秒），便于我们定位需要调优的select语句。<br>通过以下命令查看慢查询日志功能是否开启：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">慢查询日志</span></span><br><span class="line"><span class="comment">1. 默认情况下，慢查询日志功能是关闭的。查看慢查询日志功能是否开启</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> variables <span class="keyword">like</span> <span class="string">&#x27;slow_query_log&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330194423350.png" alt="image-20250330194423350"></p><p>慢查询日志功能默认是关闭的。请修改my.ini文件来开启慢查询日志功能，在my.ini的[mysqld]后面添加如下配置：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330194430602.png" alt="image-20250330194430602"></p><p>注意：slow_query_log&#x3D;1表示开启慢查询日志功能，long_query_time&#x3D;3表示：只要SELECT语句的执行耗时超过3秒则将其记录到慢查询日志中。<br>重启mysql服务。再次查看是否开启慢查询日志功能：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330194447327.png" alt="image-20250330194447327"></p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330194450970.png" alt="image-20250330194450970"></p><p>尝试执行一条时长超过3秒的select语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sleep(<span class="number">4</span>) <span class="keyword">from</span> emp <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;smith&#x27;</span>;</span><br></pre></td></tr></table></figure><p>慢查询日志文件默认存储在：C:\dev\mysql-8.0.36-winx64\data 目录下，默认的名字是：计算机名-slow.log<br>通过该文件可以清晰的看到哪些DQL语句属于慢查询：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330194516704.png" alt="image-20250330194516704"></p><h3 id="show-profiles"><a href="#show-profiles" class="headerlink" title="show profiles"></a>show profiles</h3><p>通过show profiles可以查看一个SQL语句在执行过程中具体的耗时情况。帮助我们更好的定位问题所在。</p><p>查看当前数据库是否支持 profile操作：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @<span class="variable">@have_profiling</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330213227972.png" alt="image-20250330213227972"></p><p>查看 profiling 开关是否打开：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> profiling <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330213239524.png" alt="image-20250330213239524"></p><p>可以执行多条DQL语句，然后使用 show profiles; 来查看当前数据库中执行过的每个SELECT语句的耗时情况。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp <span class="keyword">where</span> empno<span class="operator">=</span><span class="number">7369</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">show</span> profiles;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330213249496.png" alt="image-20250330213249496"></p><p>查看某个SQL语句语句在执行过程中，每个阶段的耗时情况：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> profile <span class="keyword">for</span> query <span class="number">4</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330213301032.png" alt="image-20250330213301032"></p><p>想查看执行过程中cpu的情况，可以执行以下命令：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> profile cpu <span class="keyword">for</span> query <span class="number">4</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250330213313870.png" alt="image-20250330213313870"></p><h3 id="explain"><a href="#explain" class="headerlink" title="explain"></a>explain</h3><p>explain命令可以查看一个DQL语句的执行计划，根据执行计划可以做出相应的优化措施。提高执行效率。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> empno<span class="operator">=</span><span class="number">7369</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331032419259.png" alt="image-20250331032419259"></p><h4 id="id"><a href="#id" class="headerlink" title="id"></a>id</h4><p>id反映出一条select语句执行顺序，id越大优先级越高。id相同则按照自上而下的顺序执行。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> e.ename,d.dname <span class="keyword">from</span> emp e <span class="keyword">join</span> dept d <span class="keyword">on</span> e.deptno<span class="operator">=</span>d.deptno <span class="keyword">join</span> salgrade s <span class="keyword">on</span> e.sal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331032443025.png" alt="image-20250331032443025"></p><p>由于id相同，反映出三张表在执行顺序上属于平等关系，执行时采用，先d，再e，最后s。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> e.ename,d.dname <span class="keyword">from</span> emp e <span class="keyword">join</span> dept d <span class="keyword">on</span> e.deptno<span class="operator">=</span>d.deptno <span class="keyword">where</span> e.sal<span class="operator">=</span>(<span class="keyword">select</span> sal <span class="keyword">from</span> emp <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;ford&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331032502180.png" alt="image-20250331032502180"></p><p>反映出，先执行子查询，然后让e和d做表连接。</p><h4 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h4><p>反映了mysql查询语句的类型。常用值包括：</p><ul><li>SIMPLE：表示查询中不包含子查询或UNION操作。这种查询通常包括一个表或是最多一个联接（JOIN）</li><li>PRIMARY：表示当前查询是一个主查询。（主要的查询）</li><li>UNION：表示查询中包含UNION操作</li><li>SUBQUERY：子查询</li><li>DERIVED：派生表（表示查询语句出现在from后面）</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">找出每个部门平均工资的工资等级</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">explain <span class="keyword">select</span> s.grade,t.<span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> deptno,<span class="built_in">avg</span>(sal) <span class="keyword">as</span> avgsal <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno) t <span class="keyword">join</span> salgrade s <span class="keyword">on</span> t.avgsal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span><span class="keyword">from</span>后面的这个查询语句就是派生表</span><br></pre></td></tr></table></figure><h4 id="table"><a href="#table" class="headerlink" title="table"></a>table</h4><p>反映了这个查询操作的是哪个表。</p><h4 id="type"><a href="#type" class="headerlink" title="type"></a>type</h4><p>反映了查询表中数据时的访问类型，常见的值：</p><ol><li>NULL：效率最高，一般不可能优化到这个级别，只有查询时没有查询表的时候，访问类型是NULL。例如：select 1;</li><li>system：通常访问系统表的时候，访问类型是system。一般也很难优化到这个程序。</li><li>const：根据主键或者唯一性索引查询，索引值是常量值时。explain select * from emp where empno&#x3D;7369;</li><li>eq_ref：根据主键或者唯一性索引查询。索引值不是常量值。</li><li>ref：使用了非唯一的索引进行查询。</li><li>range：使用了索引，扫描了索引树的一部分。</li><li>index：表示用了索引，但是也需要遍历整个索引树。</li><li>all：全表扫描</li></ol><p>效率最高的是NULL，效率最低的是all，从上到下，从高到低。</p><p>优化就是从下往上优化</p><h4 id="possible-keys"><a href="#possible-keys" class="headerlink" title="possible_keys"></a>possible_keys</h4><p>这个查询可能会用到的索引</p><h4 id="key"><a href="#key" class="headerlink" title="key"></a>key</h4><p>实际用到的索引</p><h4 id="key-len"><a href="#key-len" class="headerlink" title="key_len"></a>key_len</h4><p>反映索引中在查询中使用的列所占的总字节数。</p><h4 id="rows"><a href="#rows" class="headerlink" title="rows"></a>rows</h4><p>查询扫描的预估计行数。</p><h4 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h4><p>给出了与查询相关的额外信息和说明。这些额外信息可以帮助我们更好地理解查询执行的过程。</p><h2 id="索引优化"><a href="#索引优化" class="headerlink" title="索引优化"></a>索引优化</h2><h3 id="加索引-vs-不加索引"><a href="#加索引-vs-不加索引" class="headerlink" title="加索引 vs 不加索引"></a>加索引 vs 不加索引</h3><p>将这个sql脚本初始化到数据库中（初始化100W条记录）：t_vip.sql<br>根据id查询（id是主键，有索引）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_vip <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">900000</span>;#<span class="number">0</span>s</span><br></pre></td></tr></table></figure><p>根据name查询（name上没有索引）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_vip <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;4c6494cb&#x27;</span>;#<span class="number">0.157</span>s</span><br></pre></td></tr></table></figure><p>给name字段添加索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_t_user_name <span class="keyword">on</span> t_vip(name);</span><br></pre></td></tr></table></figure><p>再次根据name查询（此时name上已经有索引了） ：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_vip <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;4c6494cb&#x27;</span>;# <span class="number">0</span>s</span><br></pre></td></tr></table></figure><h3 id="最左前缀原则"><a href="#最左前缀原则" class="headerlink" title="最左前缀原则"></a>最左前缀原则</h3><p>假设有这样一张表：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> t_customer(</span><br><span class="line">id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">age <span class="type">int</span>,</span><br><span class="line">gender <span class="type">char</span>(<span class="number">1</span>),</span><br><span class="line">email <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>添加了这些数据：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> t_customer <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;zhangsan&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;zhangsan@123.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_customer <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;lisi&#x27;</span>, <span class="number">22</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;lisi@123.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_customer <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;wangwu&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;wangwu@123.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_customer <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;zhaoliu&#x27;</span>, <span class="number">22</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;zhaoliu@123.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_customer <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;jack&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;jack@123.com&#x27;</span>);</span><br></pre></td></tr></table></figure><p>添加了这样的复合索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_name_age_gender <span class="keyword">on</span> t_customer(name,age,gender);</span><br></pre></td></tr></table></figure><p><strong>最左前缀原则：当查询语句条件中包含了这个复合索引最左边的列 name 时，此时索引才会起作用。</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> age<span class="operator">=</span><span class="number">20</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span>;<span class="comment">/* 完全使用了索引，索引长度1033个字节 */</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> age<span class="operator">=</span><span class="number">20</span>; <span class="comment">/* 部分使用了索引，索引长度1028 ，说明gender在索引当中占用5个字节的长度 */</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span>; <span class="comment">/* 部分使用了索引，索引长度1023，说明age在索引当中占用5个字节的长度 */</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> age<span class="operator">=</span><span class="number">20</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span> <span class="keyword">and</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span>; <span class="comment">/* 完全使用了索引，索引长度1033个字节，这里顺序不一样也不影响*/</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span> <span class="keyword">and</span> age<span class="operator">=</span><span class="number">20</span>; <span class="comment">/* 因为条件不符合最左前缀原则，没有name条件出现，所以不会使用索引，进行全表扫描 */</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span>; <span class="comment">/* 部分使用了索引，只有name字段使用索引，因为中间断开了，导致gender没有使用索引，就会有性能折损*/</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span> <span class="keyword">and</span> age<span class="operator">=</span><span class="number">20</span>; <span class="comment">/* 完全使用了索引 */</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> age<span class="operator">&gt;</span><span class="number">20</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span>; <span class="comment">/* 当使用范围查找的时候，范围条件右侧的列不会使用索引。 */</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> age<span class="operator">&gt;=</span><span class="number">20</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span>; <span class="comment">/* 建议范围条件中添加等号，这样可以让索引完全生效 */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>范围查询时，在“范围条件”右侧的列索引会失效：</strong></p><p>验证：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> age<span class="operator">&gt;</span><span class="number">20</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span>;</span><br></pre></td></tr></table></figure><p>验证结果：name和age列索引生效。gender列索引无效。</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331170050738.png" alt="image-20250331170050738"></p><p>怎么解决？建议范围查找时带上“&#x3D;”</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">and</span> age<span class="operator">&gt;=</span><span class="number">20</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;M&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331170055665.png" alt="image-20250331170055665"></p><h3 id="索引失效情况"><a href="#索引失效情况" class="headerlink" title="索引失效情况"></a>索引失效情况</h3><h4 id="索引列参加了运算，索引失效"><a href="#索引列参加了运算，索引失效" class="headerlink" title="索引列参加了运算，索引失效"></a>索引列参加了运算，索引失效</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">5000</span>;#可以</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> sal<span class="operator">*</span><span class="number">10</span> <span class="operator">&gt;</span> <span class="number">50000</span>;#不行</span><br></pre></td></tr></table></figure><h4 id="索引列进行模糊查询时以-开始的，索引失效"><a href="#索引列进行模糊查询时以-开始的，索引失效" class="headerlink" title="索引列进行模糊查询时以 % 开始的，索引失效"></a>索引列进行模糊查询时以 % 开始的，索引失效</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;张%&#x27;</span>;#可以</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%飞&#x27;</span>;#不行</span><br></pre></td></tr></table></figure><h4 id="索引列是字符串类型，但查询时省略了单引号，索引失效"><a href="#索引列是字符串类型，但查询时省略了单引号，索引失效" class="headerlink" title="索引列是字符串类型，但查询时省略了单引号，索引失效"></a>索引列是字符串类型，但查询时省略了单引号，索引失效</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> age<span class="operator">=</span><span class="string">&#x27;20&#x27;</span>;#可以</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> age<span class="operator">=</span><span class="number">20</span>;#不行</span><br></pre></td></tr></table></figure><h4 id="查询条件中有or，只要有未添加索引的字段，索引失效"><a href="#查询条件中有or，只要有未添加索引的字段，索引失效" class="headerlink" title="查询条件中有or，只要有未添加索引的字段，索引失效"></a>查询条件中有or，只要有未添加索引的字段，索引失效</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;张三&#x27;</span> <span class="keyword">or</span> sal<span class="operator">=</span><span class="number">5000</span>;#可以</span><br></pre></td></tr></table></figure><p>将t_emp表sal字段上的索引删除：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> t_emp <span class="keyword">drop</span> index idx_t_emp_sal;</span><br></pre></td></tr></table></figure><p>再次验证：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;张三&#x27;</span> <span class="keyword">or</span> sal<span class="operator">=</span><span class="number">5000</span>;</span><br></pre></td></tr></table></figure><p>验证结果：索引失效</p><h4 id="当查询的符合条件的记录在表中占比较大，索引失效"><a href="#当查询的符合条件的记录在表中占比较大，索引失效" class="headerlink" title="当查询的符合条件的记录在表中占比较大，索引失效"></a>当查询的符合条件的记录在表中占比较大，索引失效</h4><p>就是符合条件的记录占了比如百分之八十，和全表扫描没什么区别了，不用是有可能比全表扫描效率还低，会可能有个回表操作</p><p>复制一张新表：emp2</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> emp2 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p>给sal添加索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> emp2 <span class="keyword">add</span> index idx_emp2_sal(sal);</span><br></pre></td></tr></table></figure><p>验证：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp2 <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">800</span>;#不走索引</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp2 <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">1000</span>;#不走索引</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp2 <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">2000</span>;#走索引</span><br></pre></td></tr></table></figure><h4 id="关于is-null和is-not-null的索引失效问题"><a href="#关于is-null和is-not-null的索引失效问题" class="headerlink" title="关于is null和is not null的索引失效问题"></a>关于is null和is not null的索引失效问题</h4><p>其实就是null在表里占得比例大就全表扫描，占得比例小就使用索引</p><p>给emp2的comm字段添加一个索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_emp2_comm <span class="keyword">on</span> emp2(comm);</span><br></pre></td></tr></table></figure><p>将emp2表的comm字段值全部更新为NULL：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> emp2 <span class="keyword">set</span> comm<span class="operator">=</span><span class="keyword">null</span>;</span><br></pre></td></tr></table></figure><p>验证此时条件使用is null是否走索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp2 <span class="keyword">where</span> comm <span class="keyword">is</span> <span class="keyword">null</span>;#不走索引</span><br></pre></td></tr></table></figure><p>将emp2表的comm字段全部更新为非NULL：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> emp2 <span class="keyword">set</span> comm<span class="operator">=</span><span class="number">100</span>;</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp2 <span class="keyword">where</span> comm <span class="keyword">is</span> <span class="keyword">null</span>;#走索引</span><br></pre></td></tr></table></figure><h3 id="指定索引"><a href="#指定索引" class="headerlink" title="指定索引"></a>指定索引</h3><p>当一个字段上既有单列索引，又有复合索引时，我们可以通过以下的SQL提示来要求该SQL语句执行时采用哪个索引：</p><ul><li>use index(索引名称)：建议使用该索引，只是建议，底层mysql会根据实际效率来考虑是否使用你推荐的索引。</li><li>ignore index(索引名称)：忽略该索引</li><li>force index(索引名称)：强行使用该索引</li></ul><p>查看 t_customer 表上的索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> t_customer;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331233407477.png" alt="image-20250331233407477"><br>可以看到name age gender三列添加了一个复合索引。<br>现在给name字段添加一个单列索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_name <span class="keyword">on</span> t_customer(name);</span><br></pre></td></tr></table></figure><p>看看以下的语句默认使用了哪个索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331233445008.png" alt="image-20250331233445008">通过测试得知，默认使用了联合索引。</p><p>如何建议使用单列索引idx_name：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer use index(idx_name) <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/1709695922746-7c298082-197e-49a9-be41-68a80eb1d8cd.png#averageHue=#eeedec&clientId=u832e6504-1b74-4&from=paste&height=61&id=uacfb4dc3&originHeight=61&originWidth=1347&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5173&status=done&style=shadow&taskId=uc2f18419-fc69-4dab-9b1e-6fb98a1a3a9&title=&width=1347" alt="image.png"></p><p>如何忽略使用符合索引 idx_name_age_gender：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer ignore index(idx_name_age_gender) <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/1709695945125-1fdb373d-e99d-40ff-ba0c-116f323de32a.png#averageHue=#f1f0f0&clientId=u832e6504-1b74-4&from=paste&height=77&id=u2059b06f&originHeight=77&originWidth=1346&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5375&status=done&style=shadow&taskId=u66156ea8-68db-4846-82dd-0108c69e814&title=&width=1346" alt="image.png"></p><p>如何强行使用单列索引idx_name：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_customer force index(idx_name) <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331233511064.png" alt="image-20250331233511064"></p><h3 id="覆盖索引-1"><a href="#覆盖索引-1" class="headerlink" title="覆盖索引"></a>覆盖索引</h3><p>覆盖索引我们在讲解索引的时候已经提到过了，覆盖索引强调的是：在select后面写字段的时候，这些字段尽可能是索引所覆盖的字段，这样可以避免回表查询。尽可能避免使用 select *，因为select * 很容易导致回表查询。（本质就是：能在索引上检索的，就不要再次回表查询了。）</p><p>例如：有一张表 emp3，其中 ename,job添加了联合索引：idx_emp3_ename_job，以下这个select语句就不会回表：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> emp3;#删除emp3</span><br><span class="line"><span class="keyword">create table</span> emp3 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;#从emp创建emp3</span><br><span class="line"><span class="keyword">alter table</span> emp3 <span class="keyword">add constraint</span> emp3_pk <span class="keyword">primary key</span>(empno);#为emp3的empno添加主键</span><br><span class="line"><span class="keyword">create</span> index idx_emp3_ename_job <span class="keyword">on</span> emp3(ename,job);#添加联合索引</span><br><span class="line">explain <span class="keyword">select</span> empno,ename,job <span class="keyword">from</span> emp3 <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;KING&#x27;</span>;#符合最左原则，都被索引覆盖，不会回表</span><br><span class="line">explain <span class="keyword">select</span> empno,ename,job,sal <span class="keyword">from</span> emp3 <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;KING&#x27;</span>;#sal不在索引中，会回表</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250331234421249.png" alt="image-20250331234421249"></p><p><strong>面试题：t_user表字段如下：id,name,password,realname,birth,email。表中数据量500万条，请针对以下SQL语句给出优化方案：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,name,realname <span class="keyword">from</span> t_user <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;鲁智深&#x27;</span>;</span><br></pre></td></tr></table></figure><p>这里会想到给name添加索引，如果只给name添加索引，realname并不在索引覆盖范围内，底层会进行大量的回表查询，效率较低，建议给name和realname两个字段添加联合索引，这样大大减少回表操作，提高查询效率。</p><h3 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a>前缀索引</h3><p>如果一个字段类型是varchar或text字段，字段中存储的是文本或者大文本，直接对这种长文本创建索引，会让索引体积很大，怎么优化呢？可以将字符串的前几个字符截取下来当做索引来创建。这种索引被称为前缀索引，例如：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> emp4;</span><br><span class="line"><span class="keyword">create table</span> emp4 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">create</span> index idx_emp4_ename_2 <span class="keyword">on</span> emp4(ename(<span class="number">2</span>));#把ename的前两个字符作为索引</span><br></pre></td></tr></table></figure><p>**知识储备：**对于索引来说，当索引值越唯一，唯一性就越好，性能越高</p><p>使用前缀索引时，需要通过以下公式来确定使用前几个字符作为索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="built_in">substring</span>(ename,<span class="number">1</span>,前几个字符)) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> emp4;#把ename从<span class="number">1</span>开始到几结束，除行数</span><br></pre></td></tr></table></figure><p>以上查询结果越接近1，表示索引的效果越好。（原理：做索引值的话，索引值越具有唯一性效率越高），ename，前几个字符和emp4是可以更改的</p><h3 id="单列索引和复合索引怎么选择"><a href="#单列索引和复合索引怎么选择" class="headerlink" title="单列索引和复合索引怎么选择"></a>单列索引和复合索引怎么选择</h3><p>当查询语句的条件中有多个条件，建议将这几个列创建为复合索引，因为创建单列索引很容易回表查询。<br>例如分别给emp5表ename，job添加两个单列索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> emp5 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">alter table</span> emp5 <span class="keyword">add constraint</span> emp5_pk <span class="keyword">primary key</span>(empno);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> index idx_emp5_ename <span class="keyword">on</span> emp5(ename);</span><br><span class="line"><span class="keyword">create</span> index idx_emp5_job <span class="keyword">on</span> emp5(job);</span><br></pre></td></tr></table></figure><p>执行以下查询语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> empno,ename,job <span class="keyword">from</span> emp5 <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;SMITH&#x27;</span> <span class="keyword">and</span> job<span class="operator">=</span><span class="string">&#x27;CLERK&#x27;</span>;#这里推荐使用两个，但实际只使用了ename索引，如果extra为useing index才是使用索引，<span class="keyword">where</span>是回表</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401003556913.png" alt="image-20250401003556913"></p><p>ename和job都出现在查询条件中，可以给emp6表的ename和job创建一个复合索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> emp6 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">alter table</span> emp6 <span class="keyword">add constraint</span> emp6_pk <span class="keyword">primary key</span>(empno);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> index idx_emp6_ename_job <span class="keyword">on</span> emp6(ename,job);</span><br><span class="line">explain <span class="keyword">select</span> empno,ename,job <span class="keyword">from</span> emp6 <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;SMITH&#x27;</span> <span class="keyword">and</span> job<span class="operator">=</span><span class="string">&#x27;CLERK&#x27;</span>;</span><br></pre></td></tr></table></figure><p>对于以上查询语句，使用复合索引避免了回表，因此这种情况下还是建议使用复合索引。</p><p>注意：创建索引时应考虑最左前缀原则，主字段并且具有很强唯一性的字段建议排在第一位</p><p>由于ename是主字段，并且ename具有很好的唯一性，建议将ename列放在最左边。因此这两种创建复合索引的方式</p><h3 id="索引创建原则"><a href="#索引创建原则" class="headerlink" title="索引创建原则"></a>索引创建原则</h3><ol><li>表数据量庞大，通常超过百万条数据。</li><li>经常出现在where，order by，group by后面的字段建议添加索引。</li><li>创建索引的字段尽量具有很强的唯一性。</li><li>如果字段存储文本，内容较大，一定要创建前缀索引。</li><li>尽量使用复合索引，使用单列索引容易回表查询。</li><li>如果一个字段中的数据不会为NULL，建议建表时添加not null约束，这样优化器就知道使用哪个索引列更加有效。</li><li>不要创建太多索引，当对数据进行增删改的时候，索引需要重新重新排序。</li><li>如果很少的查询，经常的增删改不建议加索引。</li></ol><h2 id="SQL优化"><a href="#SQL优化" class="headerlink" title="SQL优化"></a>SQL优化</h2><h3 id="order-by的优化"><a href="#order-by的优化" class="headerlink" title="order by的优化"></a>order by的优化</h3><p>explain查看一个带有order by的语句时，Extra列会显示：using index 或者 using filesort，区别是什么？</p><ul><li>using index:  表示使用索引，因为索引是提前排好序的。效率很高。</li><li>using filesort：表示使用文件排序，这就表示没有走索引，对表中数据进行排序，排序时将硬盘的数据读取到内存当中，在内存当中排好序。这个效率是低的，应避免。</li></ul><p>准备数据：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> workers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> workers(</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  age <span class="type">int</span>,</span><br><span class="line">  sal <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert into</span> workers <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;孙悟空&#x27;</span>, <span class="number">500</span>, <span class="number">50000</span>);</span><br><span class="line"><span class="keyword">insert into</span> workers <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;猪八戒&#x27;</span>, <span class="number">300</span>, <span class="number">40000</span>);</span><br><span class="line"><span class="keyword">insert into</span> workers <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;沙和尚&#x27;</span>, <span class="number">600</span>, <span class="number">40000</span>);</span><br><span class="line"><span class="keyword">insert into</span> workers <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;白骨精&#x27;</span>, <span class="number">600</span>, <span class="number">10000</span>);</span><br></pre></td></tr></table></figure><p>此时name没有添加索引，如果根据name进行排序的话这种方式效率较低：</p><p>给name添加索引再根据name排序：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_workers_name <span class="keyword">on</span> workers(name);</span><br><span class="line">explain <span class="keyword">select</span> id,name <span class="keyword">from</span> workers <span class="keyword">order</span> <span class="keyword">by</span> name;</span><br></pre></td></tr></table></figure><p>这样效率则提升了。</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401152706372.png" alt="image-20250401152706372"></p><p>如果要通过age和sal两个字段进行排序，最好给age和sal两个字段添加复合索引，不添加复合索引时：<br>按照age升序排，如果age相同则按照sal升序</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> id,age,sal <span class="keyword">from</span> workers <span class="keyword">order</span> <span class="keyword">by</span> age,sal;</span><br></pre></td></tr></table></figure><p>这样效率是低的。<br>给age和sal添加复合索引再按照age升序排，如果age相同则按照sal升序：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_workers_age_sal <span class="keyword">on</span> workers(age, sal);</span><br><span class="line">explain <span class="keyword">select</span> id,age,sal <span class="keyword">from</span> workers <span class="keyword">order</span> <span class="keyword">by</span> age,sal;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401152756420.png" alt="image-20250401152756420"></p><p>这样效率提升了</p><p>在B+树上叶子结点上的所有数据默认是按照升序排列的，如果按照age降序，如果age相同则按照sal降序，也会走索引，因为B+树叶子结点之间采用的是双向指针。可以从左向右（升序），也可以从右向左（降序），效率一样高</p><p>如果一个升序，一个降序会怎样呢？</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> id,age,sal <span class="keyword">from</span> workers <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">asc</span>, sal <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401153620490.png" alt="image-20250401153620490"></p><p>可见age使用了索引，但是sal没有使用索引。怎么办呢？可以针对这种排序情况创建对应的索引来解决：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_workers_ageasc_saldesc <span class="keyword">on</span> workers(age <span class="keyword">asc</span>, sal <span class="keyword">desc</span>);</span><br></pre></td></tr></table></figure><p>创建的索引如下：A表示升序，D表示降序</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401153640816.png" alt="image-20250401153640816"></p><p>再次执行：</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401153704215.png" alt="image-20250401153704215"></p><p>通过测试得知，order by也遵循最左前缀法则。</p><p>order by 优化原则总结：</p><ol><li>排序也要遵循最左前缀法则。</li><li>使用覆盖索引。</li><li>针对不同的排序规则，创建不同索引。（如果所有字段都是升序，或者所有字段都是降序，则不需要创建新的索引）</li><li>如果无法避免filesort，要注意排序缓存的大小，默认缓存大小256KB，可以修改系统变量 sort_buffer_size ：</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;sort_buffer_size&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="group-by优化"><a href="#group-by优化" class="headerlink" title="group by优化"></a>group by优化</h3><p>创建empx表，job字段上没有索引，根据job进行分组，查看每个工作岗位有多少人：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> job,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> empx <span class="keyword">group</span> <span class="keyword">by</span> job;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401155159854.png" alt="image-20250401155159854"></p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401155206753.png" alt="image-20250401155206753"></p><p>使用了临时表，效率较低。</p><p>给job添加索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_empx_job <span class="keyword">on</span> empx(job);</span><br><span class="line">explain <span class="keyword">select</span> job,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> empx <span class="keyword">group</span> <span class="keyword">by</span> job;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401155226558.png" alt="image-20250401155226558"></p><p>效率提升了。group by也同样遵循最左前缀法则。</p><p>我们再来测试一下，如果将部门编号deptno（复合索引的最左列）添加到where条件中，效率会不会提升：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> sal, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> empx <span class="keyword">where</span> deptno<span class="operator">=</span><span class="number">10</span> <span class="keyword">group</span> <span class="keyword">by</span> sal;</span><br></pre></td></tr></table></figure><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401155332353.png" alt="image-20250401155332353"></p><p>效率有提升的，这说明了，group by确实也遵循最左前缀法则。（where中使用了最左列）</p><h3 id="limit优化"><a href="#limit优化" class="headerlink" title="limit优化"></a>limit优化</h3><p>数据量特别庞大时，取数据时，越往后效率越低，怎么提升？mysql官方给出的解决方案是：使用覆盖索引+子查询的形式来提升效率。这是分别从一百万五百万九百万中取两条数据的速度</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401155736208.png" alt="image-20250401155736208"></p><p>怎么解决？使用覆盖索引，加子查询<br>使用覆盖索引：速度有所提升</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401155819304.png" alt="image-20250401155819304"></p><p>然后把这个表看做表t，通过id和进行表连接，使用子查询形式取其他列的数据</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401155847938.png" alt="image-20250401155847938"></p><p>通过测试，这种方式整体效率有所提升。</p><h3 id="主键优化"><a href="#主键优化" class="headerlink" title="主键优化"></a>主键优化</h3><p>主键设计原则：</p><ol><li>主键值不要太长，二级索引叶子结点上存储的是主键值，主键值太长，容易导致索引占用空间较大。</li><li>尽量使用auto_increment生成主键。尽量不要使用uuid做主键，因为uuid不是顺序插入。</li><li>最好不要使用业务主键，因为业务的变化会导致主键值的频繁修改，主键值不建议修改，因为主键值修改，聚集索引一定会重新排序。</li><li>在插入数据时，主键值最好是顺序插入，不要乱序插入，因为乱序插入可能会导致B+树叶子结点频繁的进行页分裂与页合并操作，效率较低。<ol><li>主键值对应聚集索引，插入主键值如果是乱序的，B+树叶子结点需要不断的重新排序，重排过程中还会频繁涉及到<strong>页分裂和页合并</strong>（可以看老杜的视频有讲解）的操作，效率较低。</li><li>B+树上的每个节点都存储在页（page）中。一个页面中存储一个节点。</li><li>MySQL的InnoDB存储引擎一个页可以存储16KB的数据。</li><li>如果主键值不是顺序插入的话，会导致频繁的页分裂和页合并。在一个B+树中，页分裂和页合并是树的自动调整机制的一部分。当一个页已经满了，再插入一个新的关键字时就会触发页分裂操作，将页中的关键字分配到两个新的页中，同时调整树的结构。相反，当一个页中的关键字数量下降到一个阈值以下时，就会触发页合并操作，将两个相邻的页合并成一个新的页。如果主键值是随机的、不是顺序插入的，那么页的利用率会降低，页分裂和页合并的次数就会增加。由于页的分裂和合并是比较耗时的操作，频繁的分裂和合并会降低数据库系统的性能。因此，为了优化B+树的性能，可以将主键值设计成顺序插入的，这样可以减少页的分裂和合并的次数，提高B+树的性能。在实际应用中，如果对主键值的顺序性能要求不是特别高，也可以采用一些技术手段来减少页分裂和合并，例如B+树分裂时采用“延迟分裂”技术，或者通过调整页的大小和节点的大小等方式来优化B+树的性能。</li></ol></li></ol><h3 id="insert优化"><a href="#insert优化" class="headerlink" title="insert优化"></a>insert优化</h3><p>insert优化原则：</p><ul><li>批量插入：数据量较大时，不要一条一条插入，可以批量插入，当然，建议一次插入数据不超过1000条</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> t_user(id,name,age) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">&#x27;jack&#x27;</span>,<span class="number">20</span>),(<span class="number">2</span>,<span class="string">&#x27;lucy&#x27;</span>,<span class="number">30</span>),(<span class="number">3</span>,<span class="string">&#x27;timi&#x27;</span>,<span class="number">22</span>);</span><br></pre></td></tr></table></figure><ul><li>mysql默认是自动提交事务，只要执行一条DML语句就自动提交一次，因此，当插入大量数据时，建议手动开启事务和手动提交事务。不建议使用数据库事务自动提交机制。</li><li>主键值建议采用顺序插入，顺序插入比乱序插入效率高。</li><li>超大数据量插入可以考虑使用mysql提供的load指令，load指令可以将csv文件中的数据批量导入到数据库表当中，并且效率很高，过程如下：<ul><li>第一步：登录mysql时指定参数</li></ul></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="comment">--local-infile -uroot -p1234</span></span><br></pre></td></tr></table></figure><ul><li>第二步：开启local_infile功能</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> local_infile <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>第三步：执行load指令</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">use powernode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> t_temp(</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary key</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  password <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">  birth <span class="type">char</span>(<span class="number">10</span>),</span><br><span class="line">  email <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">load data <span class="keyword">local</span> infile <span class="string">&#x27;E:\\powernode\\05-MySQL高级\\resources\\t_temp-100W.csv&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> t_temp fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> lines terminated <span class="keyword">by</span> <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="count-优化"><a href="#count-优化" class="headerlink" title="count(*)优化"></a>count(*)优化</h3><p>分组函数count的使用方式：</p><ul><li>count(主键)<ul><li>原理：将每个主键值取出，累加</li></ul></li><li>count(常量值)<ul><li>原理：获取到每个常量值，累加</li></ul></li><li>count(字段)<ul><li>原理：取出字段的每个值，判断是否为NULL，不为NULL则累加。</li></ul></li><li>count(*)<ul><li>原理：不用取值，底层mysql做了优化，直接统计总行数，效率最高。</li></ul></li></ul><p>结论：如果你要统计一张表中数据的总行数，建议使用 count(*)</p><p>注意：</p><ul><li>对于InnoDB存储引擎来说，count计数的实现原理就是将表中每一条记录取出，然后累加。如果你想真正提高效率，可以自己使用额外的其他程序来实现，例如每向表中插入一条记录时，在redis数据库中维护一个总行数，这样获取总行数的时候，直接从redis中获取即可，这样效率是最高的。</li><li>对于MyISAM存储引擎来说，当一个select语句没有where条件时，获取总行数效率是极高的，不需要统计，因为MyISAM存储引擎维护了一个单独的总行数。</li></ul><h3 id="update优化"><a href="#update优化" class="headerlink" title="update优化"></a>update优化</h3><p>当存储引擎是InnoDB时，表的行级锁是针对索引添加的锁，如果索引失效了，或者不是索引列时，会提升为表级锁。<br>什么是行级锁？就是两个表要修改同一行的数据时，a表没有结束之前b表的事务会被卡主，当a表提交结束后b表才会继续执行。</p><p>当然，如果更新的不是同一行数据，事务A和事务B可以并发：</p><p>行级锁是对索引列加锁，以上更新语句的where条件是id，id是主键，当然有索引，所以使用了行级锁，如果索引失效，或者字段上没有索引，则会升级为表级锁，表级锁就是更改同一张表的比如下面</p><p><img src="/./images/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/image-20250401162345198.png" alt="image-20250401162345198"></p><p>因此，为了更新的效率，建议update语句中where条件中的字段是添加索引的。</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> sql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sql题目</title>
      <link href="/posts/4fe508cd.html"/>
      <url>/posts/4fe508cd.html</url>
      
        <content type="html"><![CDATA[<h1 id="第一题"><a href="#第一题" class="headerlink" title="第一题"></a>第一题</h1><p>![1.jpg](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680103320228-5ed4903b-6a54-4ce8-81c6-e3f1738eac95.jpeg#averageHue&#x3D;%2385868b&amp;clientId&#x3D;uaa2e6f21-7481-4&amp;from&#x3D;paste&amp;height&#x3D;960&amp;id&#x3D;u7e7ddb69&amp;originHeight&#x3D;960&amp;originWidth&#x3D;541&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;33263&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u7351acee-03a5-4cf0-9f72-98dcc8c9a08&amp;title&#x3D;&amp;width&#x3D;541)</p><p>第一题：<br>用一条sql语句，查询出每门课程都大于80分的学生姓名</p><p>建表语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_student;</span><br><span class="line"><span class="keyword">create table</span> t_student(</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">kecheng <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">fenshu <span class="keyword">double</span>(<span class="number">3</span>,<span class="number">1</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> t_student <span class="keyword">values</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;语文&#x27;</span>, <span class="number">81</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_student <span class="keyword">values</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="number">75</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_student <span class="keyword">values</span>(<span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>, <span class="number">90</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_student;</span><br></pre></td></tr></table></figure><p>思路：查询出小于80分的所欲学生姓名（去重），然后使用not in，不去重会有多个少于80分的重复名字</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 第一步：找小于等于<span class="number">80</span>分的学员姓名</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> name <span class="keyword">from</span> t_student <span class="keyword">where</span> fenshu <span class="operator">&lt;=</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"># 第二步：<span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> name <span class="keyword">from</span> t_student <span class="keyword">where</span> name <span class="keyword">not</span> <span class="keyword">in</span>(<span class="keyword">select</span> <span class="keyword">distinct</span> name <span class="keyword">from</span> t_student <span class="keyword">where</span> fenshu <span class="operator">&lt;=</span> <span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>![](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg?x-oss-process&#x3D;image%2Fresize%2Cw_1177%2Climit_0%2Finterlace%2C1%2Finterlace%2C1#averageHue&#x3D;%23f9f8f8&amp;from&#x3D;url&amp;id&#x3D;hEKZG&amp;originHeight&#x3D;66&amp;originWidth&#x3D;1177&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;title&#x3D;)</p><h1 id="第二题"><a href="#第二题" class="headerlink" title="第二题"></a>第二题</h1><p>![2.jpg](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680103877015-ca07133d-716e-4cce-82f3-52118ff4c9ad.jpeg#averageHue&#x3D;%2389857c&amp;clientId&#x3D;uaa2e6f21-7481-4&amp;from&#x3D;paste&amp;height&#x3D;461&amp;id&#x3D;u0043cb44&amp;originHeight&#x3D;461&amp;originWidth&#x3D;615&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;35758&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u25d031eb-03ec-419c-8119-34b901a3a42&amp;title&#x3D;&amp;width&#x3D;615)<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680104265213-8afaf5de-a962-47c6-a1cd-72aefe28f616.png#averageHue&#x3D;%23dbe3e9&amp;clientId&#x3D;uaa2e6f21-7481-4&amp;from&#x3D;paste&amp;height&#x3D;342&amp;id&#x3D;uc0c3fef4&amp;originHeight&#x3D;342&amp;originWidth&#x3D;750&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;9419&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u12d9f5f8-e531-4fd6-99b6-10f4ed7a039&amp;title&#x3D;&amp;width&#x3D;750)<br>其中，两个表的关联字段为申请单号。<br>1）查询身份证号为440401430103082的申请日期。<br>2）查询同一个身份证号码有两条以上记录的身份证号码及记录个数。<br>3）将身份证号码为440401430103082的记录在两个表中的申请状态均改为07。<br>4）删除g_cardapplydetail表中所有姓李的记录。<br>模拟数据：考试做这种题目最重要的是要冷静下来，只有静下来SQL才能写好。要模拟数据。看到数据SQL就好写了。<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680105543048-1dd227b9-f2e8-4daf-8b1b-155db36db813.png#averageHue&#x3D;%23e4eaef&amp;clientId&#x3D;uaa2e6f21-7481-4&amp;from&#x3D;paste&amp;height&#x3D;434&amp;id&#x3D;uc9094a08&amp;originHeight&#x3D;434&amp;originWidth&#x3D;1027&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;10053&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u69af6e14-873e-4d37-bf9f-8090081fc11&amp;title&#x3D;&amp;width&#x3D;1027)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> g_cardapply;</span><br><span class="line"><span class="keyword">create table</span> g_cardapply(</span><br><span class="line">g_applyno <span class="type">varchar</span>(<span class="number">8</span>) <span class="keyword">primary key</span>,</span><br><span class="line">g_applydate <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">g_state <span class="type">varchar</span>(<span class="number">2</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert into</span> g_cardapply <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;2008-08-08&#x27;</span>, <span class="string">&#x27;01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> g_cardapply <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;2022-10-11&#x27;</span>, <span class="string">&#x27;01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> g_cardapply <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;2023-03-23&#x27;</span>, <span class="string">&#x27;01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> g_cardapply <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;2007-12-12&#x27;</span>, <span class="string">&#x27;02&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> g_cardapply <span class="keyword">values</span>(<span class="number">5</span>,<span class="string">&#x27;2009-12-11&#x27;</span>, <span class="string">&#x27;02&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> g_cardapply;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> g_cardapplydetail;</span><br><span class="line"><span class="keyword">create table</span> g_cardapplydetail(</span><br><span class="line">g_applyno <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line">g_name <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line">g_idcard <span class="type">varchar</span>(<span class="number">30</span>),</span><br><span class="line">g_state <span class="type">varchar</span>(<span class="number">2</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> g_cardapplydetail <span class="keyword">values</span>(<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;440401430103082&#x27;</span>,<span class="string">&#x27;01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> g_cardapplydetail <span class="keyword">values</span>(<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;440401430103082&#x27;</span>,<span class="string">&#x27;01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> g_cardapplydetail <span class="keyword">values</span>(<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;440401430103082&#x27;</span>,<span class="string">&#x27;01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> g_cardapplydetail <span class="keyword">values</span>(<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;440401430111111&#x27;</span>,<span class="string">&#x27;02&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> g_cardapplydetail <span class="keyword">values</span>(<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;王五&#x27;</span>,<span class="string">&#x27;440401430122222&#x27;</span>,<span class="string">&#x27;02&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> g_cardapplydetail;</span><br></pre></td></tr></table></figure><p>1)查询身份证号为440401430103082的申请日期。<br>bigint转date，可以使用from_unixtime函数。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.g_applydate <span class="keyword">from</span> g_cardapply a <span class="keyword">join</span> g_cardapplydetail b <span class="keyword">on</span> a.g_applyno <span class="operator">=</span> b.g_applyno <span class="keyword">where</span> b.g_idcard <span class="operator">=</span> <span class="string">&#x27;440401430103082&#x27;</span></span><br></pre></td></tr></table></figure><p>2）查询同一个身份证号码有两条以上记录的身份证号码及记录个数。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(g_idcard),g_idcard <span class="keyword">from</span> g_cardapplydetail <span class="keyword">group</span> <span class="keyword">by</span> g_idcard <span class="keyword">having</span> <span class="built_in">count</span>(g_idcard) <span class="operator">&gt;=</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><p>3）将身份证号码为440401430103082的记录在两个表中的申请状态均改为07。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> </span><br><span class="line">g_cardapply</span><br><span class="line"><span class="keyword">JOIN</span> </span><br><span class="line">g_cardapplydetail </span><br><span class="line"><span class="keyword">ON</span> </span><br><span class="line">g_cardapply.g_applyno <span class="operator">=</span> g_cardapplydetail.g_applyno </span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">g_cardapplydetail.g_idcard <span class="operator">=</span> <span class="string">&#x27;440401430103082&#x27;</span></span><br><span class="line"><span class="keyword">SET</span> g_cardapply.g_state <span class="operator">=</span> <span class="string">&#x27;07&#x27;</span>,</span><br><span class="line">g_cardapplydetail.g_state <span class="operator">=</span> <span class="string">&#x27;07&#x27;</span></span><br></pre></td></tr></table></figure><p>4）删除g_cardapplydetail表中所有姓李的记录。</p><p>要注意a表符合姓李的相关日期记录也需要删除</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> t1,t2 <span class="keyword">from</span> g_cardapply t1 <span class="keyword">join</span> g_cardapplydetail t2 <span class="keyword">on</span> t1.g_applyno<span class="operator">=</span>t2.g_applyno <span class="keyword">where</span> t2.g_name <span class="keyword">like</span> <span class="string">&#x27;李%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>![](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg?x-oss-process&#x3D;image%2Fresize%2Cw_1177%2Climit_0%2Finterlace%2C1%2Finterlace%2C1#averageHue&#x3D;%23f9f8f8&amp;from&#x3D;url&amp;id&#x3D;fFC65&amp;originHeight&#x3D;66&amp;originWidth&#x3D;1177&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;title&#x3D;)</p><h1 id="第三题"><a href="#第三题" class="headerlink" title="第三题"></a>第三题</h1><p>![面试题3.jpg](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680142491993-8e350bec-9af7-4304-b7d6-92f2f313997e.jpeg#averageHue&#x3D;%23a59f9a&amp;clientId&#x3D;uc0287a15-0bb5-4&amp;from&#x3D;paste&amp;height&#x3D;1136&amp;id&#x3D;u22aaff9c&amp;originHeight&#x3D;1136&amp;originWidth&#x3D;852&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;71883&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u55012cef-437e-448d-8cc9-d45d69e6cbe&amp;title&#x3D;&amp;width&#x3D;852)<br>![面试题5.jpg](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680142491981-3d90f70c-a859-4937-bdb7-60988985ea54.jpeg#averageHue&#x3D;%239c9691&amp;clientId&#x3D;uc0287a15-0bb5-4&amp;from&#x3D;paste&amp;height&#x3D;1136&amp;id&#x3D;SqUCT&amp;originHeight&#x3D;1136&amp;originWidth&#x3D;852&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;66386&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u1d4c868e-fd06-437f-b678-0dc4870d944&amp;title&#x3D;&amp;width&#x3D;852)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> stuscore;</span><br><span class="line"><span class="keyword">create table</span> stuscore(</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">subject <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">score <span class="type">int</span>,</span><br><span class="line">stuid <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> stuscore <span class="keyword">values</span>(<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;数学&#x27;</span>,<span class="number">89</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert into</span> stuscore <span class="keyword">values</span>(<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;语文&#x27;</span>,<span class="number">80</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert into</span> stuscore <span class="keyword">values</span>(<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;英语&#x27;</span>,<span class="number">70</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert into</span> stuscore <span class="keyword">values</span>(<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;数学&#x27;</span>,<span class="number">90</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert into</span> stuscore <span class="keyword">values</span>(<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;语文&#x27;</span>,<span class="number">70</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert into</span> stuscore <span class="keyword">values</span>(<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;英语&#x27;</span>,<span class="number">80</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> stuscore;</span><br></pre></td></tr></table></figure><p>表名：stuscore<br>1)统计如下：课程不及格[0<del>59]的多少个，良[60</del>80]多少个，优[81-100]多少个。<br>多种方式：可以采用union实现，也可以采用case when then when then else and实现<br>case把符合的都转换成了字符串，后续可以再用group by进行分组<br>then是加上条件，as是起名字，count来统计条数，然后再分组</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">case</span> </span><br><span class="line"><span class="keyword">when</span> score<span class="operator">&gt;=</span><span class="number">0</span> <span class="keyword">and</span> score<span class="operator">&lt;=</span><span class="number">59</span> <span class="keyword">then</span> <span class="string">&#x27;0-59&#x27;</span></span><br><span class="line"><span class="keyword">when</span> score<span class="operator">&gt;=</span><span class="number">60</span> <span class="keyword">and</span> score<span class="operator">&lt;=</span> <span class="number">80</span> <span class="keyword">then</span> <span class="string">&#x27;60-80&#x27;</span></span><br><span class="line"><span class="keyword">when</span> score<span class="operator">&gt;=</span><span class="number">81</span> <span class="keyword">and</span> score<span class="operator">&lt;=</span><span class="number">100</span> <span class="keyword">then</span> <span class="string">&#x27;81-100&#x27;</span></span><br><span class="line"><span class="keyword">else</span> <span class="string">&#x27;其他&#x27;</span> <span class="keyword">end</span> <span class="keyword">as</span> score_range, <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">from</span> stuscore <span class="keyword">group</span> <span class="keyword">by</span> score_range;</span><br></pre></td></tr></table></figure><p>2)计算科科及格的人的平均成绩。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">select</span> name,<span class="built_in">avg</span>(score) <span class="keyword">as</span> avgscore</span><br><span class="line"><span class="keyword">from</span> stuscore </span><br><span class="line"><span class="keyword">where</span></span><br><span class="line"> name <span class="keyword">not</span> <span class="keyword">in</span>(<span class="keyword">select</span> name <span class="keyword">from</span> stuscore <span class="keyword">where</span> score<span class="operator">&lt;</span><span class="number">60</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> name;</span><br></pre></td></tr></table></figure><p>![](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg?x-oss-process&#x3D;image%2Fresize%2Cw_1177%2Climit_0%2Finterlace%2C1%2Finterlace%2C1#averageHue&#x3D;%23f9f8f8&amp;from&#x3D;url&amp;id&#x3D;f1E8i&amp;originHeight&#x3D;66&amp;originWidth&#x3D;1177&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;title&#x3D;)</p><h1 id="第四题"><a href="#第四题" class="headerlink" title="第四题"></a>第四题</h1><p>![QQ图片20151126234632.jpg](.&#x2F;images&#x2F;第11章 企业真题&#x2F;auto-orient,1#averageHue&#x3D;%23c1c3be&amp;clientId&#x3D;uc0287a15-0bb5-4&amp;from&#x3D;paste&amp;height&#x3D;1136&amp;id&#x3D;u9a38f7f2&amp;originHeight&#x3D;1136&amp;originWidth&#x3D;852&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;80491&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;udaf33971-93f4-47eb-aaf8-2c246beec8b&amp;title&#x3D;&amp;width&#x3D;852)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> WCMEmploy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> WCMEmploy(</span><br><span class="line"><span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">dname <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">job <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">sal <span class="keyword">double</span>(<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;钳工&#x27;</span>, <span class="number">1500</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">2</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;钳工&#x27;</span>, <span class="number">2800</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">3</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;油漆工&#x27;</span>, <span class="number">3000</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">4</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;水电工&#x27;</span>, <span class="number">4500</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">5</span>, <span class="string">&#x27;钱七&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;钳工&#x27;</span>, <span class="number">1800</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">6</span>, <span class="string">&#x27;小毛&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;钳工&#x27;</span>, <span class="number">2600</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">7</span>, <span class="string">&#x27;小明&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;油漆工&#x27;</span>, <span class="number">2800</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">8</span>, <span class="string">&#x27;小刚&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;水电工&#x27;</span>, <span class="number">5000</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">9</span>, <span class="string">&#x27;孙悟空&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;油漆工&#x27;</span>, <span class="number">6000</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">10</span>, <span class="string">&#x27;猪八戒&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;钳工&#x27;</span>, <span class="number">2000</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">11</span>, <span class="string">&#x27;沙和尚&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;水电工&#x27;</span>, <span class="number">5000</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">12</span>, <span class="string">&#x27;武松&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;钳工&#x27;</span>, <span class="number">2000</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">13</span>, <span class="string">&#x27;阮小七&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;水电工&#x27;</span>, <span class="number">5000</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">14</span>, <span class="string">&#x27;哪吒&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;油漆工&#x27;</span>, <span class="number">2500</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">15</span>, <span class="string">&#x27;三太子&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;钳工&#x27;</span>, <span class="number">3000</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">16</span>, <span class="string">&#x27;龙王&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;钳工&#x27;</span>, <span class="number">4000</span>);</span><br><span class="line"><span class="keyword">insert into</span> WCMEmploy <span class="keyword">values</span>(<span class="number">17</span>, <span class="string">&#x27;露西&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;钳工&#x27;</span>, <span class="number">3300</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> WCMEmploy;</span><br></pre></td></tr></table></figure><p>1)请用一条SQL语句查询出不同部门中担任“钳工”的职工平均工资。</p><p>先筛选钳工，再分组，分组可以用dname和job的联合分组</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dname,job,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> WCMEmploy <span class="keyword">where</span> job<span class="operator">=</span><span class="string">&#x27;钳工&#x27;</span> <span class="keyword">group</span> <span class="keyword">by</span> dname,job;</span><br></pre></td></tr></table></figure><p>2)请用一条SQL语句查询出不同部门中担任“钳工”的职工平均工资高于2000的部门。</p><p>使用having可以对分组结果再过滤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dname,job,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> WCMEmploy <span class="keyword">where</span> job<span class="operator">=</span><span class="string">&#x27;钳工&#x27;</span> <span class="keyword">group</span> <span class="keyword">by</span> dname,job <span class="keyword">having</span> <span class="built_in">avg</span>(sal)<span class="operator">&gt;</span><span class="number">2000</span>;</span><br></pre></td></tr></table></figure><p>![](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg?x-oss-process&#x3D;image%2Fresize%2Cw_1177%2Climit_0%2Finterlace%2C1%2Finterlace%2C1#averageHue&#x3D;%23f9f8f8&amp;from&#x3D;url&amp;id&#x3D;dWqMk&amp;originHeight&#x3D;66&amp;originWidth&#x3D;1177&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;title&#x3D;)</p><h1 id="第五题"><a href="#第五题" class="headerlink" title="第五题"></a>第五题</h1><p>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680398222140-816dc325-2887-46aa-96ba-57b6f1c52c25.png#averageHue&#x3D;%238b8f8e&amp;clientId&#x3D;u170b2320-f065-4&amp;from&#x3D;paste&amp;height&#x3D;460&amp;id&#x3D;ucad96633&amp;originHeight&#x3D;460&amp;originWidth&#x3D;1221&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;226374&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;uc063bf61-cb24-4b98-ad3d-ddb2222fa62&amp;title&#x3D;&amp;width&#x3D;1221)<br>Employee是雇员信息表：<br>雇员姓名（主键）：person-name<br>街道：street<br>城市：city<br>Company是公司信息表：<br>公司名称（主键）：company-name<br>城市：city<br>Works是雇员工作信息表：<br>雇员姓名（主键）：person-name<br>公司名称：company-name<br>年薪：salary<br>Manages是雇员工作关系表：<br>雇员姓名（主键）：person-name<br>经理姓名：manager-name<br>模拟数据：<br>员工表：employee<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680402378306-a5369a92-0751-468b-8ef2-2e65aee24d31.png#averageHue&#x3D;%23f6f4f3&amp;clientId&#x3D;u170b2320-f065-4&amp;from&#x3D;paste&amp;height&#x3D;266&amp;id&#x3D;ufe13588e&amp;originHeight&#x3D;266&amp;originWidth&#x3D;333&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;13936&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;uf127c7fa-aa8a-48cb-b32c-eb68c2e0d1f&amp;title&#x3D;&amp;width&#x3D;333)<br>公司表：company<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680402457539-3684d5f1-8e7e-470b-95f7-56b3d48e4cee.png#averageHue&#x3D;%23dab674&amp;clientId&#x3D;u170b2320-f065-4&amp;from&#x3D;paste&amp;height&#x3D;112&amp;id&#x3D;u3dddee1e&amp;originHeight&#x3D;112&amp;originWidth&#x3D;349&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;4687&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u91f1036e-127c-4b16-a5b1-b79ca7a55cb&amp;title&#x3D;&amp;width&#x3D;349)<br>雇员工作信息表：Works<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680402493037-5384139c-9959-4e34-8ce8-d0be11ea4563.png#averageHue&#x3D;%23f8f7f5&amp;clientId&#x3D;u170b2320-f065-4&amp;from&#x3D;paste&amp;height&#x3D;274&amp;id&#x3D;u49603cde&amp;originHeight&#x3D;274&amp;originWidth&#x3D;440&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;13746&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u536e509d-d220-49d9-afe8-e8c265f9aa8&amp;title&#x3D;&amp;width&#x3D;440)<br>雇员工作关系表：Manages<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680402526039-fe04bfb3-e33b-4cbb-bc94-f680f0ae2a8e.png#averageHue&#x3D;%23f9f9f8&amp;clientId&#x3D;u170b2320-f065-4&amp;from&#x3D;paste&amp;height&#x3D;265&amp;id&#x3D;uf9a3f0d7&amp;originHeight&#x3D;265&amp;originWidth&#x3D;311&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;8183&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u487349a5-5eeb-43e5-8753-1e37c60eca7&amp;title&#x3D;&amp;width&#x3D;311)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> Employee;</span><br><span class="line"><span class="keyword">create table</span> Employee(</span><br><span class="line">`person<span class="operator">-</span>name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">primary key</span>,</span><br><span class="line">street <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">city <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> Employee <span class="keyword">values</span>(<span class="string">&#x27;bob&#x27;</span>,<span class="string">&#x27;街道1&#x27;</span>,<span class="string">&#x27;天津&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Employee <span class="keyword">values</span>(<span class="string">&#x27;frank&#x27;</span>,<span class="string">&#x27;街道2&#x27;</span>,<span class="string">&#x27;天津&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Employee <span class="keyword">values</span>(<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;街道3&#x27;</span>,<span class="string">&#x27;天津&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Employee <span class="keyword">values</span>(<span class="string">&#x27;lucy&#x27;</span>,<span class="string">&#x27;街道4&#x27;</span>,<span class="string">&#x27;天津&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Employee <span class="keyword">values</span>(<span class="string">&#x27;周二&#x27;</span>,<span class="string">&#x27;街道5&#x27;</span>,<span class="string">&#x27;石家庄&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Employee <span class="keyword">values</span>(<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;街道6&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Employee <span class="keyword">values</span>(<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;街道7&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Employee <span class="keyword">values</span>(<span class="string">&#x27;王五&#x27;</span>,<span class="string">&#x27;街道8&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Employee <span class="keyword">values</span>(<span class="string">&#x27;赵六&#x27;</span>,<span class="string">&#x27;街道9&#x27;</span>,<span class="string">&#x27;石家庄&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Employee <span class="keyword">values</span>(<span class="string">&#x27;钱七&#x27;</span>,<span class="string">&#x27;街道10&#x27;</span>,<span class="string">&#x27;石家庄&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> Company;</span><br><span class="line"><span class="keyword">create table</span> Company(</span><br><span class="line">`company<span class="operator">-</span>name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">primary key</span>,</span><br><span class="line">city <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> Company <span class="keyword">values</span>(<span class="string">&#x27;Small Bank Corporation&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Company <span class="keyword">values</span>(<span class="string">&#x27;公司B&#x27;</span>, <span class="string">&#x27;石家庄&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Company <span class="keyword">values</span>(<span class="string">&#x27;公司C&#x27;</span>, <span class="string">&#x27;天津&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Company;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> Works;</span><br><span class="line"><span class="keyword">create table</span> Works(</span><br><span class="line">`person<span class="operator">-</span>name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">primary key</span>,</span><br><span class="line">`company<span class="operator">-</span>name` <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">salary <span class="keyword">double</span>(<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> Works <span class="keyword">values</span>(<span class="string">&#x27;bob&#x27;</span>,<span class="string">&#x27;公司C&#x27;</span>, <span class="number">22000</span>);</span><br><span class="line"><span class="keyword">insert into</span> Works <span class="keyword">values</span>(<span class="string">&#x27;frank&#x27;</span>,<span class="string">&#x27;公司C&#x27;</span>, <span class="number">99999</span>);</span><br><span class="line"><span class="keyword">insert into</span> Works <span class="keyword">values</span>(<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;公司C&#x27;</span>, <span class="number">6000</span>);</span><br><span class="line"><span class="keyword">insert into</span> Works <span class="keyword">values</span>(<span class="string">&#x27;lucy&#x27;</span>,<span class="string">&#x27;公司C&#x27;</span>, <span class="number">11000</span>);</span><br><span class="line"><span class="keyword">insert into</span> Works <span class="keyword">values</span>(<span class="string">&#x27;周二&#x27;</span>,<span class="string">&#x27;公司B&#x27;</span>, <span class="number">31000</span>);</span><br><span class="line"><span class="keyword">insert into</span> Works <span class="keyword">values</span>(<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;Small Bank Corporation&#x27;</span>, <span class="number">11000</span>);</span><br><span class="line"><span class="keyword">insert into</span> Works <span class="keyword">values</span>(<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;Small Bank Corporation&#x27;</span>, <span class="number">5000</span>);</span><br><span class="line"><span class="keyword">insert into</span> Works <span class="keyword">values</span>(<span class="string">&#x27;王五&#x27;</span>,<span class="string">&#x27;Small Bank Corporation&#x27;</span>, <span class="number">8000</span>);</span><br><span class="line"><span class="keyword">insert into</span> Works <span class="keyword">values</span>(<span class="string">&#x27;赵六&#x27;</span>,<span class="string">&#x27;公司B&#x27;</span>, <span class="number">12000</span>);</span><br><span class="line"><span class="keyword">insert into</span> Works <span class="keyword">values</span>(<span class="string">&#x27;钱七&#x27;</span>,<span class="string">&#x27;公司B&#x27;</span>, <span class="number">21000</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Works;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> Manages;</span><br><span class="line"><span class="keyword">create table</span> Manages(</span><br><span class="line">`person<span class="operator">-</span>name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">primary key</span>,</span><br><span class="line">`manager<span class="operator">-</span>name` <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> Manages <span class="keyword">values</span>(<span class="string">&#x27;bob&#x27;</span>,<span class="string">&#x27;frank&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Manages <span class="keyword">values</span>(<span class="string">&#x27;frank&#x27;</span>,<span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">insert into</span> Manages <span class="keyword">values</span>(<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;lucy&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Manages <span class="keyword">values</span>(<span class="string">&#x27;lucy&#x27;</span>,<span class="string">&#x27;bob&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Manages <span class="keyword">values</span>(<span class="string">&#x27;周二&#x27;</span>,<span class="string">&#x27;jack&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Manages <span class="keyword">values</span>(<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;李四&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Manages <span class="keyword">values</span>(<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;王五&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Manages <span class="keyword">values</span>(<span class="string">&#x27;王五&#x27;</span>,<span class="string">&#x27;赵六&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Manages <span class="keyword">values</span>(<span class="string">&#x27;赵六&#x27;</span>,<span class="string">&#x27;钱七&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Manages <span class="keyword">values</span>(<span class="string">&#x27;钱七&#x27;</span>,<span class="string">&#x27;周二&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Manages;</span><br></pre></td></tr></table></figure><p>请给出下面每一个查询的SQL语句：</p><ol><li><p>找出所有居住地与工作的公司在同一城市的员工的姓名。</p><p>employee e<br>company c<br>works w<br>将以上三张表进行连接，连接条件：<br>e join w on e.<code>person-name</code>&#x3D;w.<code>person-name</code>员工表和工作表连接<br>join c on w.<code>company-name</code>&#x3D;c.<code>company-name</code><br>select可以先不写 ，用where进行过滤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.`person<span class="operator">-</span>name`</span><br><span class="line"><span class="keyword">from</span> employee e </span><br><span class="line"><span class="keyword">join</span> works w <span class="keyword">on</span> e.`person<span class="operator">-</span>name`<span class="operator">=</span>w.`person<span class="operator">-</span>name` </span><br><span class="line"><span class="keyword">join</span> company c <span class="keyword">on</span> w.`company<span class="operator">-</span>name`<span class="operator">=</span>c.`company<span class="operator">-</span>name`</span><br><span class="line"><span class="keyword">where</span> e.city<span class="operator">=</span>c.city;</span><br></pre></td></tr></table></figure></li><li><p>找出比Small Bank Corporation的所有员工收入都高的所有员工的姓名。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> `person<span class="operator">-</span>name` <span class="keyword">from</span> works <span class="keyword">where</span> salary<span class="operator">&gt;</span>(<span class="keyword">select</span> <span class="built_in">max</span>(salary) <span class="keyword">as</span> maxsal <span class="keyword">from</span> works <span class="keyword">where</span> `company<span class="operator">-</span>name`<span class="operator">=</span><span class="string">&#x27;Small Bank Corporation&#x27;</span>);</span><br></pre></td></tr></table></figure></li><li><p>找出平均年薪在10000美元以上的公司及其平均年薪。</p><p>思路：按照公司进行分组，对年薪求平均值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(salary) avgsal,`company<span class="operator">-</span>name` <span class="keyword">from</span> works <span class="keyword">group</span> <span class="keyword">by</span> `company<span class="operator">-</span>name` <span class="keyword">having</span> avgsal<span class="operator">&gt;</span><span class="number">10000</span>;</span><br></pre></td></tr></table></figure></li></ol><p>![](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg?x-oss-process&#x3D;image%2Fresize%2Cw_1177%2Climit_0%2Finterlace%2C1%2Finterlace%2C1#averageHue&#x3D;%23f9f8f8&amp;from&#x3D;url&amp;id&#x3D;VQuap&amp;originHeight&#x3D;66&amp;originWidth&#x3D;1177&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;title&#x3D;)</p><h1 id="第六题"><a href="#第六题" class="headerlink" title="第六题"></a>第六题</h1><p>![IMG_1621.JPG](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680399293094-1a4ca298-63ad-48db-9e8b-27ce4a6846a2.jpeg#averageHue&#x3D;%2388868c&amp;clientId&#x3D;u170b2320-f065-4&amp;from&#x3D;paste&amp;height&#x3D;768&amp;id&#x3D;u5a98a01b&amp;originHeight&#x3D;768&amp;originWidth&#x3D;1280&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;41934&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u2b8b1cba-0a2f-487e-966a-9ddd6d32e5b&amp;title&#x3D;&amp;width&#x3D;1280)<br>客户表Client<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680399899003-07e5e8a6-78d4-4939-b914-bf9280dcc3eb.png#averageHue&#x3D;%23f2f0ee&amp;clientId&#x3D;u170b2320-f065-4&amp;from&#x3D;paste&amp;height&#x3D;185&amp;id&#x3D;u038cbc02&amp;originHeight&#x3D;185&amp;originWidth&#x3D;389&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;13762&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;ud65f66b7-4ffc-4fdf-af31-a7e7ea4e872&amp;title&#x3D;&amp;width&#x3D;389)<br>订单表Order<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680400992647-08ba0bcf-1ff6-45c7-a82e-3918a9f9e950.png#averageHue&#x3D;%23fbfaf9&amp;clientId&#x3D;u170b2320-f065-4&amp;from&#x3D;paste&amp;height&#x3D;208&amp;id&#x3D;uab01aaf9&amp;originHeight&#x3D;208&amp;originWidth&#x3D;244&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;4140&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;ue1ebe17e-18ee-4fc4-b5a4-f6193b774b9&amp;title&#x3D;&amp;width&#x3D;244)<br>客户订单表ClientOrder<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680400979869-ea2a1837-751b-4744-98a5-e04c9808b568.png#averageHue&#x3D;%23fbfaf9&amp;clientId&#x3D;u170b2320-f065-4&amp;from&#x3D;paste&amp;height&#x3D;211&amp;id&#x3D;ud9ab36c4&amp;originHeight&#x3D;211&amp;originWidth&#x3D;223&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;3731&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;ub22f900e-39a8-459b-9e78-cb15fa4fed4&amp;title&#x3D;&amp;width&#x3D;223)<br>图书表Book<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680401007501-200e3826-48ed-4638-8095-7be52757bdf1.png#averageHue&#x3D;%23f5f3f1&amp;clientId&#x3D;u170b2320-f065-4&amp;from&#x3D;paste&amp;height&#x3D;131&amp;id&#x3D;u364c289b&amp;originHeight&#x3D;131&amp;originWidth&#x3D;320&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;7145&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u790fb5ee-03be-4efd-aa17-6f70cf09106&amp;title&#x3D;&amp;width&#x3D;320)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> Client;</span><br><span class="line"><span class="keyword">create table</span> Client(</span><br><span class="line">client_id <span class="type">int</span>,</span><br><span class="line">client_name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">phone <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">address <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> Client <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;Zhao&#x27;</span>, <span class="number">12522542470</span>, <span class="string">&#x27;海淀区&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Client <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;Wang&#x27;</span>, <span class="number">12522542471</span>, <span class="string">&#x27;朝阳区&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Client <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;Sun&#x27;</span>, <span class="number">12522542472</span>, <span class="string">&#x27;大兴区&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Client <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;Li&#x27;</span>, <span class="number">12522542473</span>, <span class="string">&#x27;东城区&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> `<span class="keyword">Order</span>`;</span><br><span class="line"><span class="keyword">create table</span> `<span class="keyword">Order</span>`(</span><br><span class="line">order_id <span class="type">int</span>,</span><br><span class="line">book_id <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> `<span class="keyword">Order</span>` <span class="keyword">values</span>(<span class="number">11</span>,<span class="number">21</span>);</span><br><span class="line"><span class="keyword">insert into</span> `<span class="keyword">Order</span>` <span class="keyword">values</span>(<span class="number">12</span>,<span class="number">22</span>);</span><br><span class="line"><span class="keyword">insert into</span> `<span class="keyword">Order</span>` <span class="keyword">values</span>(<span class="number">13</span>,<span class="number">23</span>);</span><br><span class="line"><span class="keyword">insert into</span> `<span class="keyword">Order</span>` <span class="keyword">values</span>(<span class="number">14</span>,<span class="number">24</span>);</span><br><span class="line"><span class="keyword">insert into</span> `<span class="keyword">Order</span>` <span class="keyword">values</span>(<span class="number">15</span>,<span class="number">21</span>);</span><br><span class="line"><span class="keyword">insert into</span> `<span class="keyword">Order</span>` <span class="keyword">values</span>(<span class="number">16</span>,<span class="number">22</span>);</span><br><span class="line"><span class="keyword">insert into</span> `<span class="keyword">Order</span>` <span class="keyword">values</span>(<span class="number">17</span>,<span class="number">23</span>);</span><br><span class="line"><span class="keyword">insert into</span> `<span class="keyword">Order</span>` <span class="keyword">values</span>(<span class="number">18</span>,<span class="number">24</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `<span class="keyword">Order</span>`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> ClientOrder;</span><br><span class="line"><span class="keyword">create table</span> ClientOrder(</span><br><span class="line">client_id <span class="type">int</span>,</span><br><span class="line">order_id <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> ClientOrder <span class="keyword">values</span>(<span class="number">1</span>,<span class="number">11</span>);</span><br><span class="line"><span class="keyword">insert into</span> ClientOrder <span class="keyword">values</span>(<span class="number">1</span>,<span class="number">12</span>);</span><br><span class="line"><span class="keyword">insert into</span> ClientOrder <span class="keyword">values</span>(<span class="number">2</span>,<span class="number">13</span>);</span><br><span class="line"><span class="keyword">insert into</span> ClientOrder <span class="keyword">values</span>(<span class="number">2</span>,<span class="number">14</span>);</span><br><span class="line"><span class="keyword">insert into</span> ClientOrder <span class="keyword">values</span>(<span class="number">3</span>,<span class="number">15</span>);</span><br><span class="line"><span class="keyword">insert into</span> ClientOrder <span class="keyword">values</span>(<span class="number">3</span>,<span class="number">16</span>);</span><br><span class="line"><span class="keyword">insert into</span> ClientOrder <span class="keyword">values</span>(<span class="number">4</span>,<span class="number">17</span>);</span><br><span class="line"><span class="keyword">insert into</span> ClientOrder <span class="keyword">values</span>(<span class="number">4</span>,<span class="number">18</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> ClientOrder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> Book;</span><br><span class="line"><span class="keyword">create table</span> Book(</span><br><span class="line">book_id <span class="type">int</span>,</span><br><span class="line">book_name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">price <span class="keyword">double</span>(<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> Book <span class="keyword">values</span>(<span class="number">21</span>, <span class="string">&#x27;管理学&#x27;</span>, <span class="number">30</span>);</span><br><span class="line"><span class="keyword">insert into</span> Book <span class="keyword">values</span>(<span class="number">22</span>, <span class="string">&#x27;计算机网络&#x27;</span>, <span class="number">50</span>);</span><br><span class="line"><span class="keyword">insert into</span> Book <span class="keyword">values</span>(<span class="number">23</span>, <span class="string">&#x27;国家地理杂志&#x27;</span>, <span class="number">90</span>);</span><br><span class="line"><span class="keyword">insert into</span> Book <span class="keyword">values</span>(<span class="number">24</span>, <span class="string">&#x27;西游记&#x27;</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Book;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p>请写出一条SQL语句，查询出每个客户的所有订单并按照地址排序，要求输出格式为：address client_name phone order_id</p><p>分成client c<br>clientorder co<br>c.client_id&#x3D;co.client_id </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> c.address,c.client_name,c.phone,co.order_id <span class="keyword">from</span> client c <span class="keyword">join</span> clientorder co <span class="keyword">on</span> c.client_id<span class="operator">=</span>co.client_id <span class="keyword">order</span> <span class="keyword">by</span> c.address;</span><br></pre></td></tr></table></figure></li><li><p>请写出一条SQL语句，查询出每个客户订购的图书总价。要求输出格式为：client_name total_price</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> c.client_name,<span class="built_in">sum</span>(b.price) <span class="keyword">as</span> total_price </span><br><span class="line"><span class="keyword">from</span> client c <span class="keyword">join</span> clientorder co <span class="keyword">on</span> c.client_id<span class="operator">=</span>co.client_id </span><br><span class="line"><span class="keyword">join</span> `<span class="keyword">order</span>` o <span class="keyword">on</span> co.order_id<span class="operator">=</span>o.order_id </span><br><span class="line"><span class="keyword">join</span> book b <span class="keyword">on</span> o.book_id<span class="operator">=</span>b.book_id </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> c.client_name;</span><br></pre></td></tr></table></figure></li><li><p>如果要求每个订单可以包含多种图书，应该如何修改Order表的主键？为了保证每个订单只被一个客户拥有，应该在ClientOrder表上增加怎样的约束？</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#把<span class="keyword">order</span>表的order_id和book_id做复合主键</span><br><span class="line">#加上唯一性约束：<span class="keyword">unique</span></span><br></pre></td></tr></table></figure></li></ol><p>![](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg?x-oss-process&#x3D;image%2Fresize%2Cw_1177%2Climit_0%2Finterlace%2C1%2Finterlace%2C1#averageHue&#x3D;%23f9f8f8&amp;from&#x3D;url&amp;id&#x3D;oCFYf&amp;originHeight&#x3D;66&amp;originWidth&#x3D;1177&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;title&#x3D;)</p><h1 id="第七题"><a href="#第七题" class="headerlink" title="第七题"></a>第七题</h1><p>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680403317776-7cd6d3bc-b547-4d94-9521-186a89ab67df.png#averageHue&#x3D;%23afafa9&amp;clientId&#x3D;u170b2320-f065-4&amp;from&#x3D;paste&amp;height&#x3D;505&amp;id&#x3D;uc9118435&amp;originHeight&#x3D;505&amp;originWidth&#x3D;665&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;207077&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;uc5e6c887-ea47-4872-a5f6-b36d3aa2b8b&amp;title&#x3D;&amp;width&#x3D;665)<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680403354657-0faf25ca-bb17-44ea-ade0-8a4e386756f3.png#averageHue&#x3D;%23cfcec7&amp;clientId&#x3D;u170b2320-f065-4&amp;from&#x3D;paste&amp;height&#x3D;367&amp;id&#x3D;u9dbd6b45&amp;originHeight&#x3D;367&amp;originWidth&#x3D;744&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;108642&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u9ec2ce66-95d7-4dce-a926-f781ad60236&amp;title&#x3D;&amp;width&#x3D;744)<br>模拟数据：<br>学生表：student<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680405687756-49b16a32-1f8b-42b5-b4a3-cd8c231e79f0.png#averageHue&#x3D;%23f6f5f4&amp;clientId&#x3D;ucbeccebf-714c-4&amp;from&#x3D;paste&amp;height&#x3D;128&amp;id&#x3D;uf6f677b4&amp;originHeight&#x3D;128&amp;originWidth&#x3D;323&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;5058&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u94b42f3c-0e0a-431b-a8dd-5f00291873a&amp;title&#x3D;&amp;width&#x3D;323)<br>课程表：course<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680405700061-a86b3354-1d10-4be5-96fe-63ba01c8d7b4.png#averageHue&#x3D;%23f9f8f7&amp;clientId&#x3D;ucbeccebf-714c-4&amp;from&#x3D;paste&amp;height&#x3D;124&amp;id&#x3D;udbbec214&amp;originHeight&#x3D;124&amp;originWidth&#x3D;268&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;4188&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u0c263cf1-ed36-4356-bbed-7a7af2c520a&amp;title&#x3D;&amp;width&#x3D;268)<br>成绩表：sc<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680405996312-907e4929-7d55-4d62-9e8d-1281bdafe91a.png#averageHue&#x3D;%23fbfbfa&amp;clientId&#x3D;ucbeccebf-714c-4&amp;from&#x3D;paste&amp;height&#x3D;337&amp;id&#x3D;uf86bf234&amp;originHeight&#x3D;337&amp;originWidth&#x3D;291&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;7772&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u704f40c5-1d25-4641-8565-6d3da624398&amp;title&#x3D;&amp;width&#x3D;291)<br>教师表：teacher<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680406005728-731d61b6-02a6-448d-8a66-000b0aa3a9e6.png#averageHue&#x3D;%23d8b571&amp;clientId&#x3D;ucbeccebf-714c-4&amp;from&#x3D;paste&amp;height&#x3D;92&amp;id&#x3D;u506eaf98&amp;originHeight&#x3D;92&amp;originWidth&#x3D;197&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;1920&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u357535c2-7d55-4cb7-b7c7-95439dea833&amp;title&#x3D;&amp;width&#x3D;197)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> student;</span><br><span class="line"><span class="keyword">create table</span> student(</span><br><span class="line">`s#` <span class="type">int</span>,</span><br><span class="line">sname <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">sage <span class="type">int</span>,</span><br><span class="line">ssex <span class="type">char</span>(<span class="number">1</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;学生1&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;男&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;学生2&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;男&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;学生3&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;男&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;学生4&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;男&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> course;</span><br><span class="line"><span class="keyword">create table</span> course(</span><br><span class="line">`c#` <span class="type">int</span>,</span><br><span class="line">cname <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">`t#` <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;数学&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;语文&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;英语&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;政治&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> course;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> sc;</span><br><span class="line"><span class="keyword">create table</span> sc(</span><br><span class="line">`s#` <span class="type">int</span>,</span><br><span class="line">`c#` <span class="type">int</span>,</span><br><span class="line">score <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> sc <span class="keyword">values</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">65</span>);</span><br><span class="line"><span class="keyword">insert into</span> sc <span class="keyword">values</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">66</span>);</span><br><span class="line"><span class="keyword">insert into</span> sc <span class="keyword">values</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">66</span>);</span><br><span class="line"><span class="keyword">insert into</span> sc <span class="keyword">values</span>(<span class="number">1</span>,<span class="number">4</span>,<span class="number">69</span>);</span><br><span class="line"><span class="keyword">insert into</span> sc <span class="keyword">values</span>(<span class="number">2</span>,<span class="number">1</span>,<span class="number">55</span>);</span><br><span class="line"><span class="keyword">insert into</span> sc <span class="keyword">values</span>(<span class="number">2</span>,<span class="number">2</span>,<span class="number">66</span>);</span><br><span class="line"><span class="keyword">insert into</span> sc <span class="keyword">values</span>(<span class="number">2</span>,<span class="number">3</span>,<span class="number">75</span>);</span><br><span class="line"><span class="keyword">insert into</span> sc <span class="keyword">values</span>(<span class="number">2</span>,<span class="number">4</span>,<span class="number">86</span>);</span><br><span class="line"><span class="keyword">insert into</span> sc <span class="keyword">values</span>(<span class="number">3</span>,<span class="number">1</span>,<span class="number">96</span>);</span><br><span class="line"><span class="keyword">insert into</span> sc <span class="keyword">values</span>(<span class="number">3</span>,<span class="number">2</span>,<span class="number">99</span>);</span><br><span class="line"><span class="keyword">insert into</span> sc <span class="keyword">values</span>(<span class="number">3</span>,<span class="number">3</span>,<span class="number">70</span>);</span><br><span class="line"><span class="keyword">insert into</span> sc <span class="keyword">values</span>(<span class="number">3</span>,<span class="number">4</span>,<span class="number">60</span>);</span><br><span class="line"><span class="keyword">insert into</span> sc <span class="keyword">values</span>(<span class="number">4</span>,<span class="number">3</span>,<span class="number">65</span>);</span><br><span class="line"><span class="keyword">insert into</span> sc <span class="keyword">values</span>(<span class="number">4</span>,<span class="number">4</span>,<span class="number">99</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> teacher;</span><br><span class="line"><span class="keyword">create table</span> teacher(</span><br><span class="line">`t#` <span class="type">int</span>,</span><br><span class="line">tname <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> teacher <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;叶平&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teacher <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;李白&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher;</span><br></pre></td></tr></table></figure><ol><li><p>查询1号课比2号课成绩高的所有学生学号。</p><p>主要是c#，查询出1号和2号课的学生后，要确定两表的s#是一样的，才是同一个人，然后去对比<br>select * from sc where <code>c#</code>&#x3D;1;<br>select * from sc where <code>c#</code>&#x3D;2;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.`s#` </span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sc <span class="keyword">where</span> `c#`<span class="operator">=</span><span class="number">1</span>) a </span><br><span class="line"><span class="keyword">join</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sc <span class="keyword">where</span> `c#`<span class="operator">=</span><span class="number">2</span>) b </span><br><span class="line"><span class="keyword">on</span> a.`s#`<span class="operator">=</span>b.`s#` <span class="keyword">where</span> a.score<span class="operator">&gt;</span>b.score;</span><br></pre></td></tr></table></figure></li><li><p>查询平均成绩大于60分的学号和平均成绩。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> `s#`,<span class="built_in">avg</span>(score) <span class="keyword">from</span> sc <span class="keyword">group</span> <span class="keyword">by</span> `s#` <span class="keyword">having</span> <span class="built_in">avg</span>(score) <span class="operator">&gt;</span> <span class="number">60</span>;</span><br></pre></td></tr></table></figure></li><li><p>查询所有学生学号、姓名、选课数、总成绩。</p><p>求选课数就是count，总成绩sum，联合分组后才可以一起显示学号姓名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  s.`s#`,s.sname,<span class="built_in">count</span>(sc.`c#`),<span class="built_in">sum</span>(sc.score)</span><br><span class="line"><span class="keyword">from</span> student s <span class="keyword">join</span> sc <span class="keyword">on</span> s.`s#`<span class="operator">=</span>sc.`s#` <span class="keyword">group</span> <span class="keyword">by</span> s.`s#`,s.sname;</span><br></pre></td></tr></table></figure></li><li><p>查询姓“李”的老师的个数。</p><p>count(tname)记录不为null的个数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(tname) <span class="keyword">from</span> teacher <span class="keyword">where</span> tname <span class="keyword">like</span> <span class="string">&#x27;李%&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><p>查询没学过“叶平”老师课的学号、姓名。</p><p>select <code>t#</code> from teacher where tname&#x3D;’叶平’这是叶平老师的编号<br>select <code>c#</code> from course where <code>t#</code>&#x3D;(上面)这是查叶平老师的课的编号<br>select distinct <code>s#</code> from sc where <code>c#</code> in(上面)，c#是查询的字段，in就是要查询的内容</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> `s#` <span class="keyword">not</span> <span class="keyword">in</span>(<span class="keyword">select</span> <span class="keyword">distinct</span> `s#` <span class="keyword">from</span> sc <span class="keyword">where</span> `c#` <span class="keyword">in</span>(<span class="keyword">select</span> `c#` <span class="keyword">from</span> course <span class="keyword">where</span> `t#`<span class="operator">=</span>(<span class="keyword">select</span> `t#` <span class="keyword">from</span> teacher <span class="keyword">where</span> tname<span class="operator">=</span><span class="string">&#x27;叶平&#x27;</span>)));</span><br></pre></td></tr></table></figure></li></ol><p>![](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg?x-oss-process&#x3D;image%2Fresize%2Cw_1177%2Climit_0%2Finterlace%2C1%2Finterlace%2C1#averageHue&#x3D;%23f9f8f8&amp;from&#x3D;url&amp;id&#x3D;c1vSE&amp;originHeight&#x3D;66&amp;originWidth&#x3D;1177&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;title&#x3D;)</p><h1 id="第八题"><a href="#第八题" class="headerlink" title="第八题"></a>第八题</h1><p>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680403650729-b44beed8-c599-4077-8f43-8f862b94bfcd.png#averageHue&#x3D;%239c9b98&amp;clientId&#x3D;u170b2320-f065-4&amp;from&#x3D;paste&amp;height&#x3D;591&amp;id&#x3D;DrAUb&amp;originHeight&#x3D;591&amp;originWidth&#x3D;603&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;153164&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;uc128e8d0-6f55-4639-ac54-76e70d093f6&amp;title&#x3D;&amp;width&#x3D;603)<br>学生表：student<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680406785079-9ec12300-6db8-48b8-ad77-7d64ebcf4292.png#averageHue&#x3D;%23f7f6f5&amp;clientId&#x3D;ucbeccebf-714c-4&amp;from&#x3D;paste&amp;height&#x3D;130&amp;id&#x3D;uf5187384&amp;originHeight&#x3D;130&amp;originWidth&#x3D;195&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;3024&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;uc537588f-10dd-49d1-a430-9d7acff4a7d&amp;title&#x3D;&amp;width&#x3D;195)<br>课程表：class<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680406801984-082cd575-80cc-432e-9c19-c247c194fa40.png#averageHue&#x3D;%23faf9f8&amp;clientId&#x3D;ucbeccebf-714c-4&amp;from&#x3D;paste&amp;height&#x3D;116&amp;id&#x3D;ub01fb31c&amp;originHeight&#x3D;116&amp;originWidth&#x3D;220&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;2858&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u459c368e-0955-44ae-9c9f-d5d651392ae&amp;title&#x3D;&amp;width&#x3D;220)<br>选课表：chosen_class<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680406813282-256975bc-ab6c-49f9-8d83-e5f60d2a00ed.png#averageHue&#x3D;%23faf9f8&amp;clientId&#x3D;ucbeccebf-714c-4&amp;from&#x3D;paste&amp;height&#x3D;200&amp;id&#x3D;u4ba72e6a&amp;originHeight&#x3D;200&amp;originWidth&#x3D;340&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;5464&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u9afb016e-e693-452b-966b-4e45c9b7191&amp;title&#x3D;&amp;width&#x3D;340)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p>没有选修课程编号为C1的学生姓名</p><p>select s_id from chosen_class where c_id&#x3D;’c1’;选择了的<br>select s_id from chosen_class where s_id not in(没选择的</p></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sname <span class="keyword">from</span> student <span class="keyword">where</span> s_id <span class="keyword">in</span>(<span class="keyword">select</span> s_id <span class="keyword">from</span> chosen_class <span class="keyword">where</span> s_id <span class="keyword">not</span> <span class="keyword">in</span>(<span class="keyword">select</span> s_id <span class="keyword">from</span> chosen_class <span class="keyword">where</span> c_id<span class="operator">=</span><span class="string">&#x27;c1&#x27;</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li><p>列出每门课程名称和平均成绩，并按照成绩排序</p><p>class c<br>chosen_class cc<br>c.c_id&#x3D;cc.c_id </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> c.c_name,<span class="built_in">avg</span>(cc.grade) <span class="keyword">as</span> avgscore  <span class="keyword">from</span> `class` c <span class="keyword">join</span> chosen_class cc <span class="keyword">on</span> c.c_id<span class="operator">=</span>cc.c_id <span class="keyword">group</span> <span class="keyword">by</span> c.c_name <span class="keyword">order</span> <span class="keyword">by</span> avgscore;</span><br></pre></td></tr></table></figure></li><li><p>选了2门课以上的学生姓名。</p><p>思路：按照学生姓名分组，计数<br>student s<br>chosen_class cc<br>条件：s.s_id&#x3D;cc.s_id</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.sname,<span class="built_in">count</span>(c_id) <span class="keyword">from</span> student s <span class="keyword">join</span> chosen_class cc <span class="keyword">on</span> s.s_id<span class="operator">=</span>cc.s_id <span class="keyword">group</span> <span class="keyword">by</span> s.sname <span class="keyword">having</span> <span class="built_in">count</span>(c_id) <span class="operator">&gt;</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure></li></ol><p>![](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg?x-oss-process&#x3D;image%2Fresize%2Cw_1177%2Climit_0%2Finterlace%2C1%2Finterlace%2C1#averageHue&#x3D;%23f9f8f8&amp;from&#x3D;url&amp;id&#x3D;KSbuE&amp;originHeight&#x3D;66&amp;originWidth&#x3D;1177&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;title&#x3D;)</p><h1 id="第九题"><a href="#第九题" class="headerlink" title="第九题"></a>第九题</h1><p>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680403903386-c1b30b13-93ed-4b1a-a331-e4107c17d411.png#averageHue&#x3D;%239f9ea3&amp;clientId&#x3D;u170b2320-f065-4&amp;from&#x3D;paste&amp;height&#x3D;460&amp;id&#x3D;uc48a45dc&amp;originHeight&#x3D;460&amp;originWidth&#x3D;556&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;171582&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;ue743e685-010a-4d7d-88d4-fb389bafa94&amp;title&#x3D;&amp;width&#x3D;556)<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1688106505123-a5edeb3b-0cdb-4ee3-befd-4a462fccbddd.png#averageHue&#x3D;%23f6f4f3&amp;clientId&#x3D;u5ffc187d-9c9e-4&amp;from&#x3D;paste&amp;height&#x3D;275&amp;id&#x3D;u5ecb421a&amp;originHeight&#x3D;275&amp;originWidth&#x3D;461&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;17297&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;uc5832d94-4aea-449c-a8e5-af7238887f0&amp;title&#x3D;&amp;width&#x3D;461)<br>要转换成：<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1688106694493-9f831520-223c-4904-963a-3df0a7edb66a.png#averageHue&#x3D;%23ca9c57&amp;clientId&#x3D;u5ffc187d-9c9e-4&amp;from&#x3D;paste&amp;height&#x3D;82&amp;id&#x3D;u6c20837f&amp;originHeight&#x3D;82&amp;originWidth&#x3D;391&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;3574&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;uf2fa2d09-dc7d-4be0-bdc8-c9f4d5e4ef5&amp;title&#x3D;&amp;width&#x3D;391)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">第九题</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_temp;</span><br><span class="line"><span class="keyword">create table</span> t_temp(</span><br><span class="line"><span class="keyword">year</span> <span class="type">int</span>,</span><br><span class="line">season <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">count <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> t_temp <span class="keyword">values</span>(<span class="number">2010</span>,<span class="string">&#x27;一季度&#x27;</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_temp <span class="keyword">values</span>(<span class="number">2010</span>,<span class="string">&#x27;二季度&#x27;</span>,<span class="number">200</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_temp <span class="keyword">values</span>(<span class="number">2010</span>,<span class="string">&#x27;三季度&#x27;</span>,<span class="number">300</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_temp <span class="keyword">values</span>(<span class="number">2010</span>,<span class="string">&#x27;四季度&#x27;</span>,<span class="number">400</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_temp <span class="keyword">values</span>(<span class="number">2011</span>,<span class="string">&#x27;一季度&#x27;</span>,<span class="number">150</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_temp <span class="keyword">values</span>(<span class="number">2011</span>,<span class="string">&#x27;二季度&#x27;</span>,<span class="number">250</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_temp <span class="keyword">values</span>(<span class="number">2011</span>,<span class="string">&#x27;三季度&#x27;</span>,<span class="number">350</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_temp <span class="keyword">values</span>(<span class="number">2011</span>,<span class="string">&#x27;四季度&#x27;</span>,<span class="number">450</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_temp;</span><br></pre></td></tr></table></figure><h2 id="MySQL行转列"><a href="#MySQL行转列" class="headerlink" title="MySQL行转列"></a>MySQL行转列</h2><p>MySQL行转列又叫做<strong>数据透视</strong>。什么叫做行转列？将原本横向排列的数据透视成纵向排列的数据，进而进行计算、分析、展示等操作。</p><p>假设有一个学生选课成绩表，包含学生姓名（stu_name）、课程名称（course_name）和分数（score）三个字段。在原始数据中，每个学生在不同的课程中都有自己的得分情况，数据样例如下：</p><table><thead><tr><th>stu_name</th><th>course_name</th><th>score</th></tr></thead><tbody><tr><td>张三</td><td>数学</td><td>80</td></tr><tr><td>张三</td><td>英语</td><td>85</td></tr><tr><td>张三</td><td>历史</td><td>90</td></tr><tr><td>李四</td><td>数学</td><td>75</td></tr><tr><td>李四</td><td>英语</td><td>92</td></tr><tr><td>李四</td><td>历史</td><td>85</td></tr><tr><td>王五</td><td>数学</td><td>88</td></tr><tr><td>王五</td><td>英语</td><td>90</td></tr><tr><td>王五</td><td>历史</td><td>95</td></tr></tbody></table><p>可以使用行转列操作，将每个学生在不同课程中的分数拆分成多条记录，每条记录包含一个课程以及对应的分数。转换后的数据样例如下：</p><table><thead><tr><th>stu_name</th><th>数学</th><th>英语</th><th>历史</th></tr></thead><tbody><tr><td>张三</td><td>80</td><td>85</td><td>90</td></tr><tr><td>李四</td><td>75</td><td>92</td><td>85</td></tr><tr><td>王五</td><td>88</td><td>90</td><td>95</td></tr></tbody></table><p>从上表中可以看出，在行转列之后，每一行记录都表示了一个学生在不同课程中的分数。这样更便于对不同科目的分数进行比较、计算平均值等分析操作。</p><h3 id="使用case-when-group-by完成"><a href="#使用case-when-group-by完成" class="headerlink" title="使用case when+group by完成"></a>使用case when+group by完成</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_student;</span><br><span class="line"><span class="keyword">create table</span> t_student(</span><br><span class="line">  stu_name <span class="type">varchar</span>(<span class="number">10</span>),</span><br><span class="line">  course_name <span class="type">varchar</span>(<span class="number">10</span>),</span><br><span class="line">  score <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> t_student(stu_name, course_name, score) <span class="keyword">values</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="number">80</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_student(stu_name, course_name, score) <span class="keyword">values</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>, <span class="number">85</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_student(stu_name, course_name, score) <span class="keyword">values</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;历史&#x27;</span>, <span class="number">90</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_student(stu_name, course_name, score) <span class="keyword">values</span>(<span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="number">75</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_student(stu_name, course_name, score) <span class="keyword">values</span>(<span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>, <span class="number">92</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_student(stu_name, course_name, score) <span class="keyword">values</span>(<span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;历史&#x27;</span>, <span class="number">85</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_student(stu_name, course_name, score) <span class="keyword">values</span>(<span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="number">88</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_student(stu_name, course_name, score) <span class="keyword">values</span>(<span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>, <span class="number">90</span>);</span><br><span class="line"><span class="keyword">insert into</span> t_student(stu_name, course_name, score) <span class="keyword">values</span>(<span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;历史&#x27;</span>, <span class="number">95</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_student;</span><br></pre></td></tr></table></figure><p>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1688106054073-451f919c-a97a-4c49-af03-991c86d78107.png#averageHue&#x3D;%23f5f3f2&amp;clientId&#x3D;u5ffc187d-9c9e-4&amp;from&#x3D;paste&amp;height&#x3D;297&amp;id&#x3D;u9e9bf1f5&amp;originHeight&#x3D;297&amp;originWidth&#x3D;362&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;16318&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u17210bc5-00ed-4815-96ea-db8ea540918&amp;title&#x3D;&amp;width&#x3D;362)<br>行转列后的效果是：<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1688106114109-3c583e45-5324-47f7-b53c-f90e31dcdc82.png#averageHue&#x3D;%23d8ad68&amp;clientId&#x3D;u5ffc187d-9c9e-4&amp;from&#x3D;paste&amp;height&#x3D;107&amp;id&#x3D;u69df24d2&amp;originHeight&#x3D;107&amp;originWidth&#x3D;337&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;4879&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u712979ed-c054-40d3-97fe-a85e23959e9&amp;title&#x3D;&amp;width&#x3D;337)<br>sql如下：</p><p>当course_name为数学时输出成绩，否则都输出0，然后输出最大值，就筛选出来了，列的名字都是后面起名字获得</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">stu_name,</span><br><span class="line"><span class="built_in">max</span>(<span class="keyword">case</span> course_name <span class="keyword">when</span> <span class="string">&#x27;数学&#x27;</span> <span class="keyword">then</span> score <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;数学&#x27;</span>,</span><br><span class="line"><span class="built_in">max</span>(<span class="keyword">case</span> course_name <span class="keyword">when</span> <span class="string">&#x27;英语&#x27;</span> <span class="keyword">then</span> score <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;英语&#x27;</span>, </span><br><span class="line"><span class="built_in">max</span>(<span class="keyword">case</span> course_name <span class="keyword">when</span> <span class="string">&#x27;历史&#x27;</span> <span class="keyword">then</span> score <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;历史&#x27;</span> </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">t_student</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> </span><br><span class="line">stu_name;</span><br></pre></td></tr></table></figure><p>通过以上内容的学习，我们这个面试题就迎刃而解了：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="keyword">year</span>,</span><br><span class="line"><span class="built_in">max</span>(<span class="keyword">case</span> season <span class="keyword">when</span> <span class="string">&#x27;一季度&#x27;</span> <span class="keyword">then</span> count <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;一季度&#x27;</span>,</span><br><span class="line"><span class="built_in">max</span>(<span class="keyword">case</span> season <span class="keyword">when</span> <span class="string">&#x27;二季度&#x27;</span> <span class="keyword">then</span> count <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;二季度&#x27;</span>,</span><br><span class="line"><span class="built_in">max</span>(<span class="keyword">case</span> season <span class="keyword">when</span> <span class="string">&#x27;三季度&#x27;</span> <span class="keyword">then</span> count <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;三季度&#x27;</span>,</span><br><span class="line"><span class="built_in">max</span>(<span class="keyword">case</span> season <span class="keyword">when</span> <span class="string">&#x27;四季度&#x27;</span> <span class="keyword">then</span> count <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;四季度&#x27;</span></span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">t_temp </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> </span><br><span class="line"><span class="keyword">year</span>;</span><br></pre></td></tr></table></figure><p>![](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1692002570088-3338946f-42b3-4174-8910-7e749c31e950.jpeg?x-oss-process&#x3D;image%2Fresize%2Cw_1177%2Climit_0%2Finterlace%2C1%2Finterlace%2C1#averageHue&#x3D;%23f9f8f8&amp;from&#x3D;url&amp;id&#x3D;wulES&amp;originHeight&#x3D;66&amp;originWidth&#x3D;1177&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;title&#x3D;)</p><h1 id="第十题"><a href="#第十题" class="headerlink" title="第十题"></a>第十题</h1><p>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1680403550525-8f28573a-a583-4aaa-9e91-b5dde5ffa2f3.png#averageHue&#x3D;%23909092&amp;clientId&#x3D;u170b2320-f065-4&amp;from&#x3D;paste&amp;height&#x3D;424&amp;id&#x3D;YlEzc&amp;originHeight&#x3D;424&amp;originWidth&#x3D;578&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;224946&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;uce0f516b-9d95-40ed-bd7a-e9dfc0c9591&amp;title&#x3D;&amp;width&#x3D;578)</p><p>建表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t;</span><br><span class="line"><span class="keyword">create table</span> t(</span><br><span class="line">A <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert into</span> t <span class="keyword">values</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert into</span> t <span class="keyword">values</span>(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert into</span> t <span class="keyword">values</span>(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">insert into</span> t <span class="keyword">values</span>(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">insert into</span> t <span class="keyword">values</span>(<span class="number">6</span>);</span><br><span class="line"><span class="keyword">insert into</span> t <span class="keyword">values</span>(<span class="number">7</span>);</span><br><span class="line"><span class="keyword">insert into</span> t <span class="keyword">values</span>(<span class="number">8</span>);</span><br><span class="line"><span class="keyword">insert into</span> t <span class="keyword">values</span>(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t;</span><br></pre></td></tr></table></figure><p>答案：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a,(<span class="built_in">lag</span>(a) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> a)) <span class="keyword">as</span> per_a <span class="keyword">from</span> t;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">将以上sql语句执行结果当做临时表m，上面的表对比a可以发现规律</span></span><br><span class="line"><span class="comment">筛选条件：m.a-m.per_a &lt;&gt; 1 or m.pre_a is null </span></span><br><span class="line"><span class="comment">执行完就是左边的a表为135，右表可以先用row_number生成123</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> m.a,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> m.a)<span class="keyword">as</span> rownum <span class="keyword">from</span> (<span class="keyword">select</span> a,(<span class="built_in">lag</span>(a) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> a)) <span class="keyword">as</span> per_a <span class="keyword">from</span> t) m <span class="keyword">where</span> m.a<span class="operator">-</span>m.per_a <span class="operator">&lt;&gt;</span> <span class="number">1</span> <span class="keyword">or</span> m.per_a <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> a,(<span class="built_in">lead</span>(a) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> a)) <span class="keyword">as</span> pre_a <span class="keyword">from</span> t;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">将以上sql查询结果当做临时表n，这个规律可以借鉴上面的，后减前</span></span><br><span class="line"><span class="comment">筛选条件：n.pre_a - n.a &lt;&gt; 1 or n.pre_a is null</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> n.a,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> n.a) <span class="keyword">as</span> rownum <span class="keyword">from</span> (<span class="keyword">select</span> a,(<span class="built_in">lead</span>(a) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> a)) <span class="keyword">as</span> pre_a <span class="keyword">from</span> t) n <span class="keyword">where</span> n.pre_a <span class="operator">-</span> n.a <span class="operator">&lt;&gt;</span> <span class="number">1</span> <span class="keyword">or</span> n.pre_a <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">将以上两个最终的查询结果看做两张表：x和y </span></span><br><span class="line"><span class="comment">连接条件：x.rownum=y.rownum </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> x.a <span class="keyword">as</span> 开始数字,y.a <span class="keyword">as</span> 结束数字</span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> m.a,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> m.a)<span class="keyword">as</span> rownum <span class="keyword">from</span> (<span class="keyword">select</span> a,(<span class="built_in">lag</span>(a) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> a)) <span class="keyword">as</span> per_a <span class="keyword">from</span> t) m <span class="keyword">where</span> m.a<span class="operator">-</span>m.per_a <span class="operator">&lt;&gt;</span> <span class="number">1</span> <span class="keyword">or</span> m.per_a <span class="keyword">is</span> <span class="keyword">null</span>) x </span><br><span class="line"><span class="keyword">join</span> (<span class="keyword">select</span> n.a,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> n.a) <span class="keyword">as</span> rownum <span class="keyword">from</span> (<span class="keyword">select</span> a,(<span class="built_in">lead</span>(a) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> a)) <span class="keyword">as</span> pre_a <span class="keyword">from</span> t) n <span class="keyword">where</span> n.pre_a <span class="operator">-</span> n.a <span class="operator">&lt;&gt;</span> <span class="number">1</span> <span class="keyword">or</span> n.pre_a <span class="keyword">is</span> <span class="keyword">null</span>) y </span><br><span class="line"><span class="keyword">on</span> x.rownum<span class="operator">=</span>y.rownum;</span><br></pre></td></tr></table></figure><p>解答上面这个题目需要具备以下知识点：</p><ul><li>lag函数</li><li>lead函数</li><li>row_number函数</li></ul><p><strong>lag函数</strong>：获取当前行的上一行数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal,(<span class="built_in">lag</span>(sal) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">asc</span>)) <span class="keyword">as</span> pre_sal <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1688354808296-69cf1cf1-34e3-4b99-b4a2-2c575b0e2378.png#averageHue&#x3D;%23d8a762&amp;clientId&#x3D;ub653133f-848a-4&amp;from&#x3D;paste&amp;height&#x3D;344&amp;id&#x3D;u978c2e7e&amp;originHeight&#x3D;344&amp;originWidth&#x3D;327&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;16336&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u52f42846-9936-4b59-9c02-e28399e5d6b&amp;title&#x3D;&amp;width&#x3D;327)<br>注意：over函数用来指定“在…..范围内”，通常和lag函数联用。</p><p><strong>lead函数</strong>：获取当前行的下一行数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal,(<span class="built_in">lead</span>(sal) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">asc</span>)) <span class="keyword">as</span> next_sal <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1688355552758-57bb77a0-65d4-4717-8410-35c1f6c13e0e.png#averageHue&#x3D;%23d7a864&amp;clientId&#x3D;ub653133f-848a-4&amp;from&#x3D;paste&amp;height&#x3D;343&amp;id&#x3D;u0d08f238&amp;originHeight&#x3D;343&amp;originWidth&#x3D;329&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;16211&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u50f77934-4edb-48ad-bf11-7d04a74c054&amp;title&#x3D;&amp;width&#x3D;329)<br>注意：over函数用来指定“在…..范围内”，通常和lead函数联用。</p><p><strong>row_number函数</strong>：可以为查询结果集生成行号：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> sal) <span class="keyword">as</span> rownum <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1688372778734-b8b7d759-d86d-43d5-807a-8447c8de7da4.png#averageHue&#x3D;%23d7a763&amp;clientId&#x3D;ub653133f-848a-4&amp;from&#x3D;paste&amp;height&#x3D;339&amp;id&#x3D;u33ad221d&amp;originHeight&#x3D;339&amp;originWidth&#x3D;321&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;15785&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;ue2446e9a-2f9b-477d-ac3d-9750607746e&amp;title&#x3D;&amp;width&#x3D;321)</p><p>利用row_number函数，将两个不相关的列拼接在一起显示：<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1688372898512-55c19a9b-401d-49db-8ad3-10e64b2fc161.png#averageHue&#x3D;%23f5f4f4&amp;clientId&#x3D;ub653133f-848a-4&amp;from&#x3D;paste&amp;height&#x3D;157&amp;id&#x3D;u7722567c&amp;originHeight&#x3D;157&amp;originWidth&#x3D;320&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;6920&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;ueb29a45f-3cd8-425f-abe2-44a5d1f2562&amp;title&#x3D;&amp;width&#x3D;320)<br>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1688372915619-8c9bb2e9-7023-43e7-88f1-ca17090825f0.png#averageHue&#x3D;%23f5f4f3&amp;clientId&#x3D;ub653133f-848a-4&amp;from&#x3D;paste&amp;height&#x3D;162&amp;id&#x3D;uec70c452&amp;originHeight&#x3D;162&amp;originWidth&#x3D;320&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;7053&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u1451081a-dda0-4561-a99e-c924529106b&amp;title&#x3D;&amp;width&#x3D;320)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">x.a, y.b </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(<span class="keyword">select</span> a,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> a) <span class="keyword">as</span> rownum <span class="keyword">from</span> t1) x </span><br><span class="line"><span class="keyword">join</span> </span><br><span class="line">(<span class="keyword">select</span> b,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> b) <span class="keyword">as</span> rownum <span class="keyword">from</span> t2) y </span><br><span class="line"><span class="keyword">on</span> </span><br><span class="line">x.rownum <span class="operator">=</span> y.rownum;</span><br></pre></td></tr></table></figure><p>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1688373063344-4437fa76-e5b6-4747-b189-9c3ae2ace4c0.png#averageHue&#x3D;%23d0a25e&amp;clientId&#x3D;ub653133f-848a-4&amp;from&#x3D;paste&amp;height&#x3D;97&amp;id&#x3D;udf41357f&amp;originHeight&#x3D;97&amp;originWidth&#x3D;169&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;1520&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;u538f43c4-e174-4c86-bd55-b7ee900cf9f&amp;title&#x3D;&amp;width&#x3D;169)</p><p>CTE语法（公用表表达式）：Common Table Expression。创建临时表的一种语法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询每个部门平均工资的工资等级</span></span><br><span class="line"><span class="comment">-- 第一种写法</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">t.deptno,t.avgsal,s.grade </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(<span class="keyword">select</span> deptno,<span class="built_in">avg</span>(sal) <span class="keyword">as</span> avgsal <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno) t </span><br><span class="line"><span class="keyword">join</span> </span><br><span class="line">salgrade s </span><br><span class="line"><span class="keyword">on</span> </span><br><span class="line">t.avgsal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第二种写法：使用CTE语法</span></span><br><span class="line"><span class="keyword">with</span> cte_exp <span class="keyword">as</span>(<span class="keyword">select</span> deptno,<span class="built_in">avg</span>(sal) <span class="keyword">as</span> avgsal <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno)</span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">cte_exp.deptno,cte_exp.avgsal,s.grade</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">cte_exp</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">salgrade s</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">cte_exp.avgsal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;</span><br></pre></td></tr></table></figure><p>partition by：将数据分区，和group by区别是：group by是分组，然后和分组函数一起用。partition by分区不需要和分组函数一起使用</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno, empno,ename,sal,(<span class="built_in">lag</span>(sal) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> deptno <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">asc</span>)) <span class="keyword">as</span> pre_sal <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p>![image.png](.&#x2F;images&#x2F;第11章 企业真题&#x2F;1688355470071-e5e90e50-2b69-4126-bd79-a2118fb80e66.png#averageHue&#x3D;%23f7f5f1&amp;clientId&#x3D;ub653133f-848a-4&amp;from&#x3D;paste&amp;height&#x3D;346&amp;id&#x3D;u1ce2bd86&amp;originHeight&#x3D;346&amp;originWidth&#x3D;421&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;20420&amp;status&#x3D;done&amp;style&#x3D;shadow&amp;taskId&#x3D;uf20a1c61-b9cb-47d4-a110-070aa47ecc4&amp;title&#x3D;&amp;width&#x3D;421)</p><p>MySQL 8.0及以上版本中支持如下常用的窗口函数：</p><ol><li>ROW_NUMBER()：排名函数，返回当前结果集中每个行的行号；</li><li>RANK()：排名函数，计算分组结果中的排名，相同的行排名相同且没有空缺，下一个行排名跳过空缺；</li><li>DENSE_RANK()：排名函数，计算分组结果中的排名，相同的行排名相同，排名连续，没有空缺；</li><li>NTILE()：将分组结果等分为指定的组数，计算每组的大小；</li><li>LAG()：返回分组内前一行的值；</li><li>LEAD()：返回分组内后一行的值；</li><li>FIRST_VALUE()：返回分组内第一个值；</li><li>LAST_VALUE()：返回分组内最后一个值；</li><li>AVG()、SUM()、COUNT()、MIN()、MAX()：聚合函数，可以配合OVER()进行窗口操作。</li></ol><p>需要注意的是，MySQL的窗口函数和其他DBMS中的窗口函数相比较，可能略有不同，需要根据MySQL的文档进行使用。 </p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sql Java </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>留言板</title>
      <link href="/comments/index.html"/>
      <url>/comments/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/custom.css"/>
      <url>/css/custom.css</url>
      
        <content type="html"><![CDATA[/* font-face {  font-family: Candyhome;  src:url(https://cdn.cbd.int/anzhiyu-blog@latest/fonts/Candyhome.ttf);  font-display: swap;  font-weight: lighter;} */ /* 谷歌字体 */  @font-face {    font-family: ZhuZiAYuanJWD;    src:url(https://cdn.cbd,int/anzhiyu-blog@latest/fonts/ZhuZiAWan.woff2);    font-display: swap;    font-weight: lighter;  }  @import url(https://fonts.googleapis.com/css2?family=ZC00L+KuaiLe&display=swap);  /* 这里应该是站点最上面那个字体 */  div#menus {    font-family:'ZhuZiAYuanJWD';  }  h1#site-title {    font-family: ZhuZiAYuanJWD;    font-size: 3em !important;  }  a.article-title,  a.blog-slider__title,  a.categoryBar-list-link,  h1.post-title {    font-family: ZhuZiAYuanJwD;   }  .iconfont {    font-family:'iconfont' !important;    font-size: 3em;    /*可以定义图标大小 */    font-style: normal;    -webkit-font-smoothing:antialiased;    -moz-osx-font-smoothing:grayscale;  }    /*时间轴生肖icon */  svg.icon {    /* 这里定义svg.icon，避免和Butterfly自带的note标签冲突 */    width: 1em;    height: 1em;    /* width和height定义图标的默认宽度和高度*/    vertical-align:-0.15em;    fill: currentColor;    overflow: hidden;  }  .icon-zhongbiao::before {    color: #f7c768;  }  /* bilibli番剧插件 */  .bangumi-active {    background:#dbecfe !important;    border-radius: 10px !important;  }  a.bangumi-tab:hover {    text-decoration: none !important;  }  .bangumi-button:hover {    background:#dbecfe !important;    border-radius: 10px !important;  }  a.bangumi-button.bangumi-nextpage:hover {    text-decoration: none !important;  }  .bangumi-button {    padding: 5px 10px !important;  }  a.bangumi-tab {    padding: 5px 10px !important;  }  svg.icon.faa-tada {    font-size: 1.1em;  }  /* 解决artitalk的图标问题 */  #uploadSource > svg {    width: 1.19em;    height: 1.5em;  }  /*top-img黑色透明玻璃效果移除，不建议加，除非你执着于完全一图流或者背景图对比色明显 */  #page-header:not(.not-top-img):before {    background-color: transparent !important;  }  /* 首页文章卡片 */  #recent-posts > .recent-post-item {    background:rgba(255,255,255,0.9);  }  /* 首页侧栏卡片 */  #aside-content .card-widget {    background:rgba(255,255,255,0.9);  }  /* 文章页面正文背景 **/  div#post {    background:rgba(255,255,255,0.9);  }  /*分页页面 */  div#page {    background:rgba(255,255,255,0.9);  }  /* 归档页面 */  div#archive {    background:■rgba(255,255,255,0.9);  }  /* 标签页面 */  div#tag {    background:rgba(255,255,255,0.9);  }  /*分类页面 */  div#category {    background:rgba(255,255,255,0.9);  }  /*夜间模式伪类遮罩层透明*/  [data-theme='dark']#recent-posts > .recent-post-item {    background: #121212;  }  [data-theme='dark'] .card-widget {    background: #121212 !important;  }  [data-theme='dark'] div#post {    background: #121212 !important;  }  [data-theme='dark'] div#tag {    background: #121212 !important;  }  [data-theme='dark'] div#archive {    background: #121212 !important;  }  [data-theme='dark'] div#page {    background: #121212 !important;  }  [data-theme='dark'] div#category {    background: #121212 !important;  }  [data-theme='dark'] div#category {    background: transparent !important;  }  /* 页脚透明 */  #footer {    background: transparent !important;  }  /* 头图透明 */  #page-header {    background: transparent !important;  }  #rightside > div > button {    border-radius: 5px;  }  /* 滚动条的一些设置 */  ::-webkit-scrollbar {    width: 10px;    height: 10px;  }  ::-webkit-scrollbar-thumb {    background-color: #49b1f5;    border-radius: 2em;  }  ::-webkit-scrollbar-corner {    background-color: transparent;  }  ::-moz-selection {    color: ■#fff;    background-color: #49b1f5;  }  /* 音乐播放器 */  /* .aplayer .aplayer-lrc {    display: none !important;  }*/  .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {    left: -66px !important;    transition: all 0.3s;    /* 默认情况下缩进左侧66px，只留一点箭头部分 */  }  .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {    left: 0 !important;    transition: all 0.3s;    /* 鼠标悬停是左侧缩进归零，完全显示按钮 */  }  .aplayer.aplayer-fixed {    z-index: 999999 !important;  }  /* 评论框  .vwrap {    box-shadow:2px2px5px #bbb;    background:口rgba(255，255，255，0.3);    border-radius: 8px;    padding: 30px;    margin:30px 0px 30px px;  }  /* 设置评论框 */  .vcard {    box-shadow: 2px 2px 5px #bbb;    background: rgba(255,255,255,0.3);    border-radius: 8px;    padding: 30px;    margin: 30px 0px 0px 0px;  }  /* 鼠标图标 */  body {    cursor: url('/img/x1.cur'), auto;  }    a,    [type='button']:not(:disabled),    [type='reset']:not(:disabled),    [type='submit']:not(:disabled),    button:not(:disabled) {      cursor: url('/img/x2.cur'), auto !important;    }    /* md网站下划线 */    #article-container a:hover {      text-decoration: none !important;    }    #article-container #hpp_talk p img {      display: inline;    }  /* 404页面 */  #error-wrap {    position: absolute;    top: 40%;    right: 0;    left: 0;    margin: 0 auto;    padding:0 1rem;    max-width: 1000px;    transform: translate(0, -50%);  }  #error-wrap .error-content {    display: flex;    flex-direction: row;    justify-content: center;    align-items: center;    margin:0 1rem;    height: 18rem;    border-radius:8px;    background: var(--card-bg);    box-shadow: var(--card-box-shadow);    transition: all 0.3s;  }  #error-wrap .error-content .error-img {    box-flex: 1;    flex: 1;    height: 100%;    border-top-left-radius: 8px;    border-bottom-left-radius:8px;    background-color: 口#49b1f5;    background-position:center;    background-size: cover;  }  #error-wrap .error-content .error-info {    box-flex: 1;    flex: 1;    padding: 0.5rem;    text-align: center;    font-size: 14px;    font-family: Titillium Web, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft JhengHei', 'Microsoft YaHei',    sans-serif;  }      #error-wrap .error-contenr .error-info .error_title {    margin-top:-4rem;    font-size: 9em;  }  #error-wrap .error-content .error-info .error_subtitle {    margin-top:-3.5rem;    word-break: break-word;    font-size: 1.6em;  }  #error-wrap .error-content .error-info a {    display: inline-block;    margin-top: 0.5rem;    padding: 0.3rem 1.5rem;    background: var(--btn-bg);    color: var(--btn-color);  }  #body-wrap.error .aside-list {    display: flex;    flex-direction: row;    flex-wrap: nowrap;    bottom: 0px;    position: absolute;    padding: 1rem;    width: 100%;    overflow: scroll;  }  #body-wrap.error .aside-list .aside-list-group {    display: flex;    flex-direction: row;    flex-wrap: nowrap;    max-width:1200px;    margin: 0 auto;  }  #body-wrap.error .aside-list .aside-list-item {    padding: 0.5rem;  }  #body-wrap.error .aside-list .aside-list-item img {    width: 100%;    object-fit: cover;    border-radius:12px;  }  #body-wrap.error .aside-list .aside-list-item .thumbnail {    overflow: hidden;    width: 230px;    height: 143px;    background: var(--heo-card-bg);    display: flex;  }  #body-wrap.error .aside-list .aside-list-item .content .title {    -webkit-line-clamp:2;    overflow: hidden;    display: -webkit-box;    -webkit-box-orient: vertical;    line-height: 1.5;    justify-content: center;    align-items: flex-end;    align-content:center;    padding-top: 0.5rem;    color: white;  }  #body-wrap.error .aside-list .aside-list-item .content time {    display: none;  }  /* 代码框主题 */  #article-container figure.highlight {    border-radius:10px;  }]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/img/manifest.json"/>
      <url>/img/manifest.json</url>
      
        <content type="html"><![CDATA[{"name":"Shelter的博客","short_name":"Shelter","theme_color":"#49b1f5","background _color":"#49b1f5","display":"standalone","scope":"/","start_url":"/","icons":[{"src":"/img/siteicon/16.png","sizes":"16x16","type":"image/png"},{"src":"/img/siteicon/32.png","sizes":"32x32","type":"image/png"},{"src":"/img/siteicon/64.png","sizes":"64x64","type":"image/png"},{"src":"/img/siteicon/128.png","sizes":"128x128","type":"image/png"},{"src":"/img/siteicon/144.png","sizes":"144x144","type":"image/png"},{"src":"/img/siteicon/512.png","sizes":"512x512","type":"image/png"}],"splash_pages":null}]]></content>
      
    </entry>
    
    
  
</search>
